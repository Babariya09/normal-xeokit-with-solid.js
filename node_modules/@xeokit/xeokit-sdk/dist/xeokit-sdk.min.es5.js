var e,t=o().mark(wv),i=o().mark(Mv),s=o().mark(By);function r(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=d(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var s=0,r=function(){};return{s:r,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,a=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){a=!0,n=e},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw n}}}}function o(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */o=function(){return e};var e={},t=Object.prototype,i=t.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},r=s.iterator||"@@iterator",n=s.asyncIterator||"@@asyncIterator",a=s.toStringTag||"@@toStringTag";function u(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,i){return e[t]=i}}function h(e,t,i,s){var r=t&&t.prototype instanceof p?t:p,n=Object.create(r.prototype),o=new M(s||[]);return n._invoke=function(e,t,i){var s="suspendedStart";return function(r,n){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===r)throw n;return C()}for(i.method=r,i.arg=n;;){var o=i.delegate;if(o){var a=x(o,i);if(a){if(a===c)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===s)throw s="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);s="executing";var u=l(e,t,i);if("normal"===u.type){if(s=i.done?"completed":"suspendedYield",u.arg===c)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(s="completed",i.method="throw",i.arg=u.arg)}}}(e,i,o),n}function l(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}e.wrap=h;var c={};function p(){}function d(){}function f(){}var m={};u(m,r,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(I([])));g&&g!==t&&i.call(g,r)&&(m=g);var _=f.prototype=p.prototype=Object.create(m);function y(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function s(r,n,o,a){var u=l(e[r],e,n);if("throw"!==u.type){var h=u.arg,c=h.value;return c&&"object"==T(c)&&i.call(c,"__await")?t.resolve(c.__await).then((function(e){s("next",e,o,a)}),(function(e){s("throw",e,o,a)})):t.resolve(c).then((function(e){h.value=e,o(h)}),(function(e){return s("throw",e,o,a)}))}a(u.arg)}var r;this._invoke=function(e,i){function n(){return new t((function(t,r){s(e,i,t,r)}))}return r=r?r.then(n,n):n()}}function x(e,t){var i=e.iterator[t.method];if(void 0===i){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var s=l(i,e.iterator,t.arg);if("throw"===s.type)return t.method="throw",t.arg=s.arg,t.delegate=null,c;var r=s.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function I(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var s=-1,n=function t(){for(;++s<e.length;)if(i.call(e,s))return t.value=e[s],t.done=!1,t;return t.value=void 0,t.done=!0,t};return n.next=n}}return{next:C}}function C(){return{value:void 0,done:!0}}return d.prototype=f,u(_,"constructor",f),u(f,"constructor",d),d.displayName=u(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,a,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},y(b.prototype),u(b.prototype,n,(function(){return this})),e.AsyncIterator=b,e.async=function(t,i,s,r,n){void 0===n&&(n=Promise);var o=new b(h(t,i,s,r),n);return e.isGeneratorFunction(i)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},y(_),u(_,a,"Generator"),u(_,r,(function(){return this})),u(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var i in e)t.push(i);return t.reverse(),function i(){for(;t.length;){var s=t.pop();if(s in e)return i.value=s,i.done=!1,i}return i.done=!0,i}},e.values=I,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function s(i,s){return o.type="throw",o.arg=e,t.next=i,s&&(t.method="next",t.arg=void 0),!!s}for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r],o=n.completion;if("root"===n.tryLoc)return s("end");if(n.tryLoc<=this.prev){var a=i.call(n,"catchLoc"),u=i.call(n,"finallyLoc");if(a&&u){if(this.prev<n.catchLoc)return s(n.catchLoc,!0);if(this.prev<n.finallyLoc)return s(n.finallyLoc)}else if(a){if(this.prev<n.catchLoc)return s(n.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<n.finallyLoc)return s(n.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var r=this.tryEntries[s];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var n=r;break}}n&&("break"===e||"continue"===e)&&n.tryLoc<=t&&t<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=e,o.arg=t,n?(this.method="next",this.next=n.finallyLoc,c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),w(i),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var s=i.completion;if("throw"===s.type){var r=s.arg;w(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:I(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=void 0),c}},e}function a(e,t,i,s,r,n,o){try{var a=e[n](o),u=a.value}catch(e){return void i(e)}a.done?t(u):Promise.resolve(u).then(s,r)}function u(e){return function(){var t=this,i=arguments;return new Promise((function(s,r){var n=e.apply(t,i);function o(e){a(n,s,r,o,u,"next",e)}function u(e){a(n,s,r,o,u,"throw",e)}o(void 0)}))}}function h(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?h(Object(i),!0).forEach((function(t){c(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function c(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==i)return;var s,r,n=[],o=!0,a=!1;try{for(i=i.call(e);!(o=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);o=!0);}catch(e){a=!0,r=e}finally{try{o||null==i.return||i.return()}finally{if(a)throw r}}return n}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){if(e){if("string"==typeof e)return f(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?f(e,t):void 0}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function m(){return m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var s=v(e,t);if(s){var r=Object.getOwnPropertyDescriptor(s,t);return r.get?r.get.call(arguments.length<3?e:i):r.value}},m.apply(this,arguments)}function v(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}function _(e,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(e,t)}function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,s=P(e);if(t){var r=P(this).constructor;i=Reflect.construct(s,arguments,r)}else i=s.apply(this,arguments);return b(this,i)}}function b(e,t){if(t&&("object"===T(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return x(e)}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},P(e)}function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function w(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function M(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function I(e,t,i){return t&&M(e.prototype,t),i&&M(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function C(e){return new k(e)}function D(e){return function(){return new A(e.apply(this,arguments))}}function A(e){var t,i;function s(t,i){try{var n=e[t](i),o=n.value,a=o instanceof k;Promise.resolve(a?o.wrapped:o).then((function(e){a?s("return"===t?"return":"next",e):r(n.done?"return":"normal",e)}),(function(e){s("throw",e)}))}catch(e){r("throw",e)}}function r(e,r){switch(e){case"return":t.resolve({value:r,done:!0});break;case"throw":t.reject(r);break;default:t.resolve({value:r,done:!1})}(t=t.next)?s(t.key,t.arg):i=null}this._invoke=function(e,r){return new Promise((function(n,o){var a={key:e,arg:r,resolve:n,reject:o,next:null};i?i=i.next=a:(t=i=a,s(e,r))}))},"function"!=typeof e.return&&(this.return=void 0)}function k(e){this.wrapped=e}function E(e){var t,i,s,r=2;for("undefined"!=typeof Symbol&&(i=Symbol.asyncIterator,s=Symbol.iterator);r--;){if(i&&null!=(t=e[i]))return t.call(e);if(s&&null!=(t=e[s]))return new F(t.call(e));i="@@asyncIterator",s="@@iterator"}throw new TypeError("Object is not async iterable")}function F(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return F=function(e){this.s=e,this.n=e.next},F.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var i=this.s.return;return void 0===i?Promise.resolve({value:e,done:!0}):t(i.apply(this.s,arguments))},throw:function(e){var i=this.s.return;return void 0===i?Promise.reject(e):t(i.apply(this.s,arguments))}},new F(e)}A.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},A.prototype.next=function(e){return this._invoke("next",e)},A.prototype.throw=function(e){return this._invoke("throw",e)},A.prototype.return=function(e){return this._invoke("return",e)};var R,S,O,B,L,N,j,G=function(){function e(t,i){w(this,e),this.items=t||[],this._lastUniqueId=(i||0)+1}return I(e,[{key:"addItem",value:function(){var e;if(2===arguments.length){var t=arguments[0];if(e=arguments[1],this.items[t])throw"ID clash: '"+t+"'";return this.items[t]=e,t}for(e=arguments[0]||{};;){var i=this._lastUniqueId++;if(!this.items[i])return this.items[i]=e,i}}},{key:"removeItem",value:function(e){var t=this.items[e];return delete this.items[e],t}}]),e}(),H=new G,U=I((function e(t){w(this,e),this.id=t,this.parentItem=null,this.groups=[],this.menuElement=null,this.shown=!1,this.mouseOver=0})),V=I((function e(){w(this,e),this.items=[]})),z=I((function e(t,i,s,r,n){w(this,e),this.id=t,this.getTitle=i,this.doAction=s,this.getEnabled=r,this.getShown=n,this.itemElement=null,this.subMenu=null,this.enabled=!0})),W=function(){function e(){var t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};w(this,e),this._id=H.addItem(),this._context=null,this._enabled=!1,this._itemsCfg=[],this._rootMenu=null,this._menuList=[],this._menuMap={},this._itemList=[],this._itemMap={},this._shown=!1,this._nextId=0,this._eventSubs={},!1!==i.hideOnMouseDown&&(document.addEventListener("mousedown",(function(e){e.target.classList.contains("xeokit-context-menu-item")||t.hide()})),document.addEventListener("touchstart",this._canvasTouchStartHandler=function(e){e.target.classList.contains("xeokit-context-menu-item")||t.hide()})),i.items&&(this.items=i.items),this._hideOnAction=!1!==i.hideOnAction,this.context=i.context,this.enabled=!1!==i.enabled,this.hide()}return I(e,[{key:"on",value:function(e,t){var i=this._eventSubs[e];i||(i=[],this._eventSubs[e]=i),i.push(t)}},{key:"fire",value:function(e,t){var i=this._eventSubs[e];if(i)for(var s=0,r=i.length;s<r;s++)i[s](t)}},{key:"items",get:function(){return this._itemsCfg},set:function(e){this._clear(),this._itemsCfg=e||[],this._parseItems(e),this._createUI()}},{key:"enabled",get:function(){return this._enabled},set:function(e){(e=!!e)!==this._enabled&&(this._enabled=e,this._enabled||this.hide())}},{key:"context",get:function(){return this._context},set:function(e){this._context=e}},{key:"show",value:function(e,t){this._context?this._enabled&&(this._shown||(this._hideAllMenus(),this._updateItemsTitles(),this._updateItemsEnabledStatus(),this._showMenu(this._rootMenu.id,e,t),this._shown=!0,this.fire("shown",{}))):console.error("ContextMenu cannot be shown without a context - set context first")}},{key:"shown",get:function(){return this._shown}},{key:"hide",value:function(){this._enabled&&this._shown&&(this._hideAllMenus(),this._shown=!1,this.fire("hidden",{}))}},{key:"destroy",value:function(){this._context=null,this._clear(),null!==this._id&&(H.removeItem(this._id),this._id=null)}},{key:"_clear",value:function(){for(var e=0,t=this._menuList.length;e<t;e++){var i=this._menuList[e].menuElement;i.parentElement.removeChild(i)}this._itemsCfg=[],this._rootMenu=null,this._menuList=[],this._menuMap={},this._itemList=[],this._itemMap={}}},{key:"_parseItems",value:function(e){var t=this;this._rootMenu=function e(i){for(var s=t._getNextId(),r=new U(s),n=0,o=i.length;n<o;n++){var a=i[n],u=new V;r.groups.push(u);for(var h=function(i,s){var n=a[i],o=n.items,h=o&&o.length>0,l=t._getNextId(),c=n.getTitle||function(){return n.title||""},p=n.doAction||n.callback||function(){},d=n.getEnabled||function(){return!0},f=n.getShown||function(){return!0},m=new z(l,c,p,d,f);if(m.parentMenu=r,u.items.push(m),h){var v=e(o);m.subMenu=v,v.parentItem=m}t._itemList.push(m),t._itemMap[m.id]=m},l=0,c=a.length;l<c;l++)h(l)}return t._menuList.push(r),t._menuMap[r.id]=r,r}(e)}},{key:"_getNextId",value:function(){return"ContextMenu_"+this._id+"_"+this._nextId++}},{key:"_createUI",value:function(){var e=this;!function t(i){e._createMenuUI(i);for(var s=i.groups,r=0,n=s.length;r<n;r++)for(var o=s[r].items,a=0,u=o.length;a<u;a++){var h=o[a].subMenu;h&&t(h)}}(this._rootMenu)}},{key:"_createMenuUI",value:function(e){var t=this,i=e.groups,s=[];if(s.push('<div class="xeokit-context-menu '+e.id+'" style="z-index:300000; position: absolute;">'),s.push("<ul>"),i)for(var r=0,n=i.length;r<n;r++){var o=r,a=n,u=i[r].items;if(u)for(var h=0,l=u.length;h<l;h++){var c=u[h],p=c.subMenu,d=c.title||"";p?s.push('<li id="'+c.id+'" class="xeokit-context-menu-item" style="'+(o===a-1||h<l-1?"border-bottom: 0":"border-bottom: 1px solid black")+'">'+d+" [MORE]</li>"):s.push('<li id="'+c.id+'" class="xeokit-context-menu-item" style="'+(o===a-1||h<l-1?"border-bottom: 0":"border-bottom: 1px solid black")+'">'+d+"</li>")}}s.push("</ul>"),s.push("</div>");var f=s.join("");document.body.insertAdjacentHTML("beforeend",f);var m=document.querySelector("."+e.id);e.menuElement=m,m.style["border-radius"]="4px",m.style.display="none",m.style["z-index"]=3e5,m.style.background="white",m.style.border="1px solid black",m.style["box-shadow"]="0 4px 5px 0 gray",m.oncontextmenu=function(e){e.preventDefault()};var v=this,g=null;if(i)for(var _=0,y=i.length;_<y;_++){var b=i[_].items;if(b)for(var x=function(e,i){var s=b[e],r=s.subMenu;if(s.itemElement=document.getElementById(s.id),!s.itemElement)return console.error("ContextMenu item element not found: "+s.id),"continue";s.itemElement.addEventListener("mouseenter",(function(e){e.preventDefault();var t=s.subMenu;if(t){if(g&&g.id!==t.id&&(v._hideMenu(g.id),g=null),!1!==s.enabled){var i=s.itemElement,r=t.menuElement,n=i.getBoundingClientRect();r.getBoundingClientRect();n.right+200>window.innerWidth?v._showMenu(t.id,n.left-200,n.top-1):v._showMenu(t.id,n.right-5,n.top-1),g=t}}else g&&(v._hideMenu(g.id),g=null)})),r||(s.itemElement.addEventListener("click",(function(e){e.preventDefault(),v._context&&!1!==s.enabled&&(s.doAction&&s.doAction(v._context),t._hideOnAction?v.hide():(v._updateItemsTitles(),v._updateItemsEnabledStatus()))})),s.itemElement.addEventListener("mouseenter",(function(e){e.preventDefault(),!1!==s.enabled&&s.doHover&&s.doHover(v._context)})))},P=0,T=b.length;P<T;P++)x(P)}}},{key:"_updateItemsTitles",value:function(){if(this._context)for(var e=0,t=this._itemList.length;e<t;e++){var i=this._itemList[e],s=i.itemElement;if(s){var r=i.getShown;if(r&&r(this._context)){var n=i.getTitle(this._context);i.subMenu,s.innerText=n}}}}},{key:"_updateItemsEnabledStatus",value:function(){if(this._context)for(var e=0,t=this._itemList.length;e<t;e++){var i=this._itemList[e],s=i.itemElement;if(s){var r=i.getEnabled;if(r){var n=i.getShown;if(n){var o=n(this._context);if(i.shown=o,o){s.style.visibility="visible",s.style.height="auto",s.style.padding=null;var a=r(this._context);i.enabled=a,a?s.classList.remove("disabled"):s.classList.add("disabled")}else s.style.visibility="hidden",s.style.height="0",s.style.padding="0"}}}}}},{key:"_showMenu",value:function(e,t,i){var s=this._menuMap[e];if(s){if(!s.shown){var r=s.menuElement;r&&(this._showMenuElement(r,t,i),s.shown=!0)}}else console.error("Menu not found: "+e)}},{key:"_hideMenu",value:function(e){var t=this._menuMap[e];if(t){if(t.shown){var i=t.menuElement;i&&(this._hideMenuElement(i),t.shown=!1)}}else console.error("Menu not found: "+e)}},{key:"_hideAllMenus",value:function(){for(var e=0,t=this._menuList.length;e<t;e++){var i=this._menuList[e];this._hideMenu(i.id)}}},{key:"_showMenuElement",value:function(e,t,i){e.style.display="block";var s=e.offsetHeight,r=e.offsetWidth;i+s>window.innerHeight&&(i=window.innerHeight-s),t+r>window.innerWidth&&(t=window.innerWidth-r),e.style.left=t+"px",e.style.top=i+"px"}},{key:"_hideMenuElement",value:function(e){e.style.display="none"}}]),e}(),X=function(){function e(t,i,s){w(this,e),this.id=s&&s.id?s.id:t,this.viewer=i,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._eventSubsNum=null,this._events=null,this._eventCallDepth=0,i.addPlugin(this)}return I(e,[{key:"fire",value:function(e,t,i){this._events||(this._events={}),this._eventSubs||(this._eventSubs={},this._eventSubsNum={}),!0!==i&&(this._events[e]=t||!0);var s,r=this._eventSubs[e];if(r)for(var n in r)r.hasOwnProperty(n)&&(s=r[n],this._eventCallDepth++,this._eventCallDepth<300?s.callback.call(s.scope,t):this.error("fire: potential stack overflow from recursive event '"+e+"' - dropping this event"),this._eventCallDepth--)}},{key:"on",value:function(e,t,i){this._events||(this._events={}),this._subIdMap||(this._subIdMap=new G),this._subIdEvents||(this._subIdEvents={}),this._eventSubs||(this._eventSubs={}),this._eventSubsNum||(this._eventSubsNum={});var s=this._eventSubs[e];s?this._eventSubsNum[e]++:(s={},this._eventSubs[e]=s,this._eventSubsNum[e]=1);var r=this._subIdMap.addItem();s[r]={callback:t,scope:i||this},this._subIdEvents[r]=e;var n=this._events[e];return void 0!==n&&t.call(i||this,n),r}},{key:"off",value:function(e){if(null!=e&&this._subIdEvents){var t=this._subIdEvents[e];if(t){delete this._subIdEvents[e];var i=this._eventSubs[t];i&&(delete i[e],this._eventSubsNum[t]--),this._subIdMap.removeItem(e)}}}},{key:"once",value:function(e,t,i){var s=this,r=this.on(e,(function(e){s.off(r),t.call(i||this,e)}),i)}},{key:"hasSubs",value:function(e){return this._eventSubsNum&&this._eventSubsNum[e]>0}},{key:"log",value:function(e){console.log("[xeokit plugin ".concat(this.id,"]: ").concat(e))}},{key:"warn",value:function(e){console.warn("[xeokit plugin ".concat(this.id,"]: ").concat(e))}},{key:"error",value:function(e){console.error("[xeokit plugin ".concat(this.id,"]: ").concat(e))}},{key:"send",value:function(e,t){}},{key:"destroy",value:function(){this.viewer.removePlugin(this)}}]),e}(),Y=!0,K=Y?Float64Array:Float32Array,J=new K(16),Z=new K(16),Q=new K(4),q={setDoublePrecisionEnabled:function(e){K=(Y=e)?Float64Array:Float32Array},getDoublePrecisionEnabled:function(){return Y},MIN_DOUBLE:-Number.MAX_SAFE_INTEGER,MAX_DOUBLE:Number.MAX_SAFE_INTEGER,DEGTORAD:.0174532925,RADTODEG:57.295779513,unglobalizeObjectId:function(e,t){var i=t.indexOf("#");return i===e.length&&t.startsWith(e)?t.substring(i+1):t},globalizeObjectId:function(e,t){return e+"#"+t},vec2:function(e){return new K(e||2)},vec3:function(e){return new K(e||3)},vec4:function(e){return new K(e||4)},mat3:function(e){return new K(e||9)},mat3ToMat4:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new K(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4:function(e){return new K(e||16)},mat4ToMat3:function(e,t){},doublesToFloats:function(e,t,i){for(var s=new K(2),r=0,n=e.length;r<n;r++)q.splitDouble(e[r],s),t[r]=s[0],i[r]=s[1]},splitDouble:function(e,t){var i=K.from([e])[0],s=e-i;t[0]=i,t[1]=s},createUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return"".concat(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255],"-").concat(e[255&i]).concat(e[i>>8&255],"-").concat(e[i>>16&15|64]).concat(e[i>>24&255],"-").concat(e[63&s|128]).concat(e[s>>8&255],"-").concat(e[s>>16&255]).concat(e[s>>24&255]).concat(e[255&r]).concat(e[r>>8&255]).concat(e[r>>16&255]).concat(e[r>>24&255])}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},fmod:function(e,t){if(e<t)return console.error("math.fmod : Attempting to find modulus within negative range - would be infinite loop - ignoring"),e;for(;t<=e;)e-=t;return e},compareVec3:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},negateVec3:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},negateVec4:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},addVec4:function(e,t,i){return i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i},addVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i[3]=e[3]+t,i},addVec3:function(e,t,i){return i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i},addVec3Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i},subVec4:function(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i},subVec3:function(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i},subVec2:function(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i},geometricMeanVec2:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];for(var s=new K(t[0]),r=1;r<t.length;r++)s[0]+=t[r][0],s[1]+=t[r][1];return s[0]/=t.length,s[1]/=t.length,s},subVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]-t,i[3]=e[3]-t,i},subScalarVec4:function(e,t,i){return i||(i=e),i[0]=t-e[0],i[1]=t-e[1],i[2]=t-e[2],i[3]=t-e[3],i},mulVec4:function(e,t,i){return i||(i=e),i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i[3]=e[3]*t[3],i},mulVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i},mulVec3Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i},mulVec2Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i},divVec3:function(e,t,i){return i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i},divVec4:function(e,t,i){return i||(i=e),i[0]=e[0]/t[0],i[1]=e[1]/t[1],i[2]=e[2]/t[2],i[3]=e[3]/t[3],i},divScalarVec3:function(e,t,i){return i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i},divVec3Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i},divVec4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]/t,i[1]=e[1]/t,i[2]=e[2]/t,i[3]=e[3]/t,i},divScalarVec4:function(e,t,i){return i||(i=t),i[0]=e/t[0],i[1]=e/t[1],i[2]=e/t[2],i[3]=e/t[3],i},dotVec4:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},cross3Vec4:function(e,t){var i=e[0],s=e[1],r=e[2],n=t[0],o=t[1],a=t[2];return[s*a-r*o,r*n-i*a,i*o-s*n,0]},cross3Vec3:function(e,t,i){i||(i=e);var s=e[0],r=e[1],n=e[2],o=t[0],a=t[1],u=t[2];return i[0]=r*u-n*a,i[1]=n*o-s*u,i[2]=s*a-r*o,i},sqLenVec4:function(e){return q.dotVec4(e,e)},lenVec4:function(e){return Math.sqrt(q.sqLenVec4(e))},dotVec3:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},dotVec2:function(e,t){return e[0]*t[0]+e[1]*t[1]},sqLenVec3:function(e){return q.dotVec3(e,e)},sqLenVec2:function(e){return q.dotVec2(e,e)},lenVec3:function(e){return Math.sqrt(q.sqLenVec3(e))},distVec3:(j=new K(3),function(e,t){return q.lenVec3(q.subVec3(e,t,j))}),lenVec2:function(e){return Math.sqrt(q.sqLenVec2(e))},distVec2:function(){var e=new K(2);return function(t,i){return q.lenVec2(q.subVec2(t,i,e))}}(),rcpVec3:function(e,t){return q.divScalarVec3(1,e,t)},normalizeVec4:function(e,t){var i=1/q.lenVec4(e);return q.mulVec4Scalar(e,i,t)},normalizeVec3:function(e,t){var i=1/q.lenVec3(e);return q.mulVec3Scalar(e,i,t)},normalizeVec2:function(e,t){var i=1/q.lenVec2(e);return q.mulVec2Scalar(e,i,t)},angleVec3:function(e,t){var i=q.dotVec3(e,t)/Math.sqrt(q.sqLenVec3(e)*q.sqLenVec3(t));return i=i<-1?-1:i>1?1:i,Math.acos(i)},vec3FromMat4Scale:function(){var e=new K(3);return function(t,i){return e[0]=t[0],e[1]=t[1],e[2]=t[2],i[0]=q.lenVec3(e),e[0]=t[4],e[1]=t[5],e[2]=t[6],i[1]=q.lenVec3(e),e[0]=t[8],e[1]=t[9],e[2]=t[10],i[2]=q.lenVec3(e),i}}(),vecToArray:function(){function e(e){return Math.round(1e5*e)/1e5}return function(t){for(var i=0,s=(t=Array.prototype.slice.call(t)).length;i<s;i++)t[i]=e(t[i]);return t}}(),xyzArrayToObject:function(e){return{x:e[0],y:e[1],z:e[2]}},xyzObjectToArray:function(e,t){return(t=t||q.vec3())[0]=e.x,t[1]=e.y,t[2]=e.z,t},dupMat4:function(e){return e.slice(0,16)},mat4To3:function(e){return[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]},m4s:function(e){return[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e]},setMat4ToZeroes:function(){return q.m4s(0)},setMat4ToOnes:function(){return q.m4s(1)},diagonalMat4v:function(e){return new K([e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,e[3]])},diagonalMat4c:function(e,t,i,s){return q.diagonalMat4v([e,t,i,s])},diagonalMat4s:function(e){return q.diagonalMat4c(e,e,e,e)},identityMat4:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new K(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},identityMat3:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new K(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},isIdentityMat4:function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]},negateMat4:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},addMat4:function(e,t,i){return i||(i=e),i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i[4]=e[4]+t[4],i[5]=e[5]+t[5],i[6]=e[6]+t[6],i[7]=e[7]+t[7],i[8]=e[8]+t[8],i[9]=e[9]+t[9],i[10]=e[10]+t[10],i[11]=e[11]+t[11],i[12]=e[12]+t[12],i[13]=e[13]+t[13],i[14]=e[14]+t[14],i[15]=e[15]+t[15],i},addMat4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]+t,i[1]=e[1]+t,i[2]=e[2]+t,i[3]=e[3]+t,i[4]=e[4]+t,i[5]=e[5]+t,i[6]=e[6]+t,i[7]=e[7]+t,i[8]=e[8]+t,i[9]=e[9]+t,i[10]=e[10]+t,i[11]=e[11]+t,i[12]=e[12]+t,i[13]=e[13]+t,i[14]=e[14]+t,i[15]=e[15]+t,i},addScalarMat4:function(e,t,i){return q.addMat4Scalar(t,e,i)},subMat4:function(e,t,i){return i||(i=e),i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[3]=e[3]-t[3],i[4]=e[4]-t[4],i[5]=e[5]-t[5],i[6]=e[6]-t[6],i[7]=e[7]-t[7],i[8]=e[8]-t[8],i[9]=e[9]-t[9],i[10]=e[10]-t[10],i[11]=e[11]-t[11],i[12]=e[12]-t[12],i[13]=e[13]-t[13],i[14]=e[14]-t[14],i[15]=e[15]-t[15],i},subMat4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]-t,i[1]=e[1]-t,i[2]=e[2]-t,i[3]=e[3]-t,i[4]=e[4]-t,i[5]=e[5]-t,i[6]=e[6]-t,i[7]=e[7]-t,i[8]=e[8]-t,i[9]=e[9]-t,i[10]=e[10]-t,i[11]=e[11]-t,i[12]=e[12]-t,i[13]=e[13]-t,i[14]=e[14]-t,i[15]=e[15]-t,i},subScalarMat4:function(e,t,i){return i||(i=t),i[0]=e-t[0],i[1]=e-t[1],i[2]=e-t[2],i[3]=e-t[3],i[4]=e-t[4],i[5]=e-t[5],i[6]=e-t[6],i[7]=e-t[7],i[8]=e-t[8],i[9]=e-t[9],i[10]=e-t[10],i[11]=e-t[11],i[12]=e-t[12],i[13]=e-t[13],i[14]=e-t[14],i[15]=e-t[15],i},mulMat4:function(e,t,i){i||(i=e);var s=e[0],r=e[1],n=e[2],o=e[3],a=e[4],u=e[5],h=e[6],l=e[7],c=e[8],p=e[9],d=e[10],f=e[11],m=e[12],v=e[13],g=e[14],_=e[15],y=t[0],b=t[1],x=t[2],P=t[3],T=t[4],w=t[5],M=t[6],I=t[7],C=t[8],D=t[9],A=t[10],k=t[11],E=t[12],F=t[13],R=t[14],S=t[15];return i[0]=y*s+b*a+x*c+P*m,i[1]=y*r+b*u+x*p+P*v,i[2]=y*n+b*h+x*d+P*g,i[3]=y*o+b*l+x*f+P*_,i[4]=T*s+w*a+M*c+I*m,i[5]=T*r+w*u+M*p+I*v,i[6]=T*n+w*h+M*d+I*g,i[7]=T*o+w*l+M*f+I*_,i[8]=C*s+D*a+A*c+k*m,i[9]=C*r+D*u+A*p+k*v,i[10]=C*n+D*h+A*d+k*g,i[11]=C*o+D*l+A*f+k*_,i[12]=E*s+F*a+R*c+S*m,i[13]=E*r+F*u+R*p+S*v,i[14]=E*n+F*h+R*d+S*g,i[15]=E*o+F*l+R*f+S*_,i},mulMat3:function(e,t,i){i||(i=new K(9));var s=e[0],r=e[3],n=e[6],o=e[1],a=e[4],u=e[7],h=e[2],l=e[5],c=e[8],p=t[0],d=t[3],f=t[6],m=t[1],v=t[4],g=t[7],_=t[2],y=t[5],b=t[8];return i[0]=s*p+r*m+n*_,i[3]=s*d+r*v+n*y,i[6]=s*f+r*g+n*b,i[1]=o*p+a*m+u*_,i[4]=o*d+a*v+u*y,i[7]=o*f+a*g+u*b,i[2]=h*p+l*m+c*_,i[5]=h*d+l*v+c*y,i[8]=h*f+l*g+c*b,i},mulMat4Scalar:function(e,t,i){return i||(i=e),i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i[4]=e[4]*t,i[5]=e[5]*t,i[6]=e[6]*t,i[7]=e[7]*t,i[8]=e[8]*t,i[9]=e[9]*t,i[10]=e[10]*t,i[11]=e[11]*t,i[12]=e[12]*t,i[13]=e[13]*t,i[14]=e[14]*t,i[15]=e[15]*t,i},mulMat4v4:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.vec4(),s=t[0],r=t[1],n=t[2],o=t[3];return i[0]=e[0]*s+e[4]*r+e[8]*n+e[12]*o,i[1]=e[1]*s+e[5]*r+e[9]*n+e[13]*o,i[2]=e[2]*s+e[6]*r+e[10]*n+e[14]*o,i[3]=e[3]*s+e[7]*r+e[11]*n+e[15]*o,i},transposeMat4:function(e,t){var i=e[4],s=e[14],r=e[8],n=e[13],o=e[12],a=e[9];if(!t||e===t){var u=e[1],h=e[2],l=e[3],c=e[6],p=e[7],d=e[11];return e[1]=i,e[2]=r,e[3]=o,e[4]=u,e[6]=a,e[7]=n,e[8]=h,e[9]=c,e[11]=s,e[12]=l,e[13]=p,e[14]=d,e}return t[0]=e[0],t[1]=i,t[2]=r,t[3]=o,t[4]=e[1],t[5]=e[5],t[6]=a,t[7]=n,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=s,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},transposeMat3:function(e,t){if(t===e){var i=e[1],s=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=s,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},determinantMat4:function(e){var t=e[0],i=e[1],s=e[2],r=e[3],n=e[4],o=e[5],a=e[6],u=e[7],h=e[8],l=e[9],c=e[10],p=e[11],d=e[12],f=e[13],m=e[14],v=e[15];return d*l*a*r-h*f*a*r-d*o*c*r+n*f*c*r+h*o*m*r-n*l*m*r-d*l*s*u+h*f*s*u+d*i*c*u-t*f*c*u-h*i*m*u+t*l*m*u+d*o*s*p-n*f*s*p-d*i*a*p+t*f*a*p+n*i*m*p-t*o*m*p-h*o*s*v+n*l*s*v+h*i*a*v-t*l*a*v-n*i*c*v+t*o*c*v},inverseMat4:function(e,t){t||(t=e);var i=e[0],s=e[1],r=e[2],n=e[3],o=e[4],a=e[5],u=e[6],h=e[7],l=e[8],c=e[9],p=e[10],d=e[11],f=e[12],m=e[13],v=e[14],g=e[15],_=i*a-s*o,y=i*u-r*o,b=i*h-n*o,x=s*u-r*a,P=s*h-n*a,T=r*h-n*u,w=l*m-c*f,M=l*v-p*f,I=l*g-d*f,C=c*v-p*m,D=c*g-d*m,A=p*g-d*v,k=1/(_*A-y*D+b*C+x*I-P*M+T*w);return t[0]=(a*A-u*D+h*C)*k,t[1]=(-s*A+r*D-n*C)*k,t[2]=(m*T-v*P+g*x)*k,t[3]=(-c*T+p*P-d*x)*k,t[4]=(-o*A+u*I-h*M)*k,t[5]=(i*A-r*I+n*M)*k,t[6]=(-f*T+v*b-g*y)*k,t[7]=(l*T-p*b+d*y)*k,t[8]=(o*D-a*I+h*w)*k,t[9]=(-i*D+s*I-n*w)*k,t[10]=(f*P-m*b+g*_)*k,t[11]=(-l*P+c*b-d*_)*k,t[12]=(-o*C+a*M-u*w)*k,t[13]=(i*C-s*M+r*w)*k,t[14]=(-f*x+m*y-v*_)*k,t[15]=(l*x-c*y+p*_)*k,t},traceMat4:function(e){return e[0]+e[5]+e[10]+e[15]},translationMat4v:function(e,t){var i=t||q.identityMat4();return i[12]=e[0],i[13]=e[1],i[14]=e[2],i},translationMat3v:function(e,t){var i=t||q.identityMat3();return i[6]=e[0],i[7]=e[1],i},translationMat4c:(N=new K(3),function(e,t,i,s){return N[0]=e,N[1]=t,N[2]=i,q.translationMat4v(N,s)}),translationMat4s:function(e,t){return q.translationMat4c(e,e,e,t)},translateMat4v:function(e,t){return q.translateMat4c(e[0],e[1],e[2],t)},translateMat4c:function(e,t,i,s){var r=s[3];s[0]+=r*e,s[1]+=r*t,s[2]+=r*i;var n=s[7];s[4]+=n*e,s[5]+=n*t,s[6]+=n*i;var o=s[11];s[8]+=o*e,s[9]+=o*t,s[10]+=o*i;var a=s[15];return s[12]+=a*e,s[13]+=a*t,s[14]+=a*i,s},setMat4Translation:function(e,t,i){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=e[15],i},rotationMat4v:function(e,t,i){var s,r,n,o,a,u,h=q.normalizeVec4([t[0],t[1],t[2],0],[]),l=Math.sin(e),c=Math.cos(e),p=1-c,d=h[0],f=h[1],m=h[2];return s=d*f,r=f*m,n=m*d,o=d*l,a=f*l,u=m*l,(i=i||q.mat4())[0]=p*d*d+c,i[1]=p*s+u,i[2]=p*n-a,i[3]=0,i[4]=p*s-u,i[5]=p*f*f+c,i[6]=p*r+o,i[7]=0,i[8]=p*n+a,i[9]=p*r-o,i[10]=p*m*m+c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},rotationMat4c:function(e,t,i,s,r){return q.rotationMat4v(e,[t,i,s],r)},scalingMat4v:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.identityMat4();return t[0]=e[0],t[5]=e[1],t[10]=e[2],t},scalingMat3v:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.identityMat3();return t[0]=e[0],t[4]=e[1],t},scalingMat4c:function(){var e=new K(3);return function(t,i,s,r){return e[0]=t,e[1]=i,e[2]=s,q.scalingMat4v(e,r)}}(),scaleMat4c:function(e,t,i,s){return s[0]*=e,s[4]*=t,s[8]*=i,s[1]*=e,s[5]*=t,s[9]*=i,s[2]*=e,s[6]*=t,s[10]*=i,s[3]*=e,s[7]*=t,s[11]*=i,s},scaleMat4v:function(e,t){var i=e[0],s=e[1],r=e[2];return t[0]*=i,t[4]*=s,t[8]*=r,t[1]*=i,t[5]*=s,t[9]*=r,t[2]*=i,t[6]*=s,t[10]*=r,t[3]*=i,t[7]*=s,t[11]*=r,t},scalingMat4s:function(e){return q.scalingMat4c(e,e,e)},rotationTranslationMat4:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.mat4(),s=e[0],r=e[1],n=e[2],o=e[3],a=s+s,u=r+r,h=n+n,l=s*a,c=s*u,p=s*h,d=r*u,f=r*h,m=n*h,v=o*a,g=o*u,_=o*h;return i[0]=1-(d+m),i[1]=c+_,i[2]=p-g,i[3]=0,i[4]=c-_,i[5]=1-(l+m),i[6]=f+v,i[7]=0,i[8]=p+g,i[9]=f-v,i[10]=1-(l+d),i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i},mat4ToEuler:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.vec4(),s=q.clamp,r=e[0],n=e[4],o=e[8],a=e[1],u=e[5],h=e[9],l=e[2],c=e[6],p=e[10];return"XYZ"===t?(i[1]=Math.asin(s(o,-1,1)),Math.abs(o)<.99999?(i[0]=Math.atan2(-h,p),i[2]=Math.atan2(-n,r)):(i[0]=Math.atan2(c,u),i[2]=0)):"YXZ"===t?(i[0]=Math.asin(-s(h,-1,1)),Math.abs(h)<.99999?(i[1]=Math.atan2(o,p),i[2]=Math.atan2(a,u)):(i[1]=Math.atan2(-l,r),i[2]=0)):"ZXY"===t?(i[0]=Math.asin(s(c,-1,1)),Math.abs(c)<.99999?(i[1]=Math.atan2(-l,p),i[2]=Math.atan2(-n,u)):(i[1]=0,i[2]=Math.atan2(a,r))):"ZYX"===t?(i[1]=Math.asin(-s(l,-1,1)),Math.abs(l)<.99999?(i[0]=Math.atan2(c,p),i[2]=Math.atan2(a,r)):(i[0]=0,i[2]=Math.atan2(-n,u))):"YZX"===t?(i[2]=Math.asin(s(a,-1,1)),Math.abs(a)<.99999?(i[0]=Math.atan2(-h,u),i[1]=Math.atan2(-l,r)):(i[0]=0,i[1]=Math.atan2(o,p))):"XZY"===t&&(i[2]=Math.asin(-s(n,-1,1)),Math.abs(n)<.99999?(i[0]=Math.atan2(c,u),i[1]=Math.atan2(o,r)):(i[0]=Math.atan2(-h,p),i[1]=0)),i},composeMat4:function(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.mat4();return q.quaternionToRotationMat4(t,s),q.scaleMat4v(i,s),q.translateMat4v(e,s),s},decomposeMat4:function(){var e=new K(3),t=new K(16);return function(i,s,r,n){e[0]=i[0],e[1]=i[1],e[2]=i[2];var o=q.lenVec3(e);e[0]=i[4],e[1]=i[5],e[2]=i[6];var a=q.lenVec3(e);e[8]=i[8],e[9]=i[9],e[10]=i[10];var u=q.lenVec3(e);q.determinantMat4(i)<0&&(o=-o),s[0]=i[12],s[1]=i[13],s[2]=i[14],t.set(i);var h=1/o,l=1/a,c=1/u;return t[0]*=h,t[1]*=h,t[2]*=h,t[4]*=l,t[5]*=l,t[6]*=l,t[8]*=c,t[9]*=c,t[10]*=c,q.mat4ToQuaternion(t,r),n[0]=o,n[1]=a,n[2]=u,this}}(),getColMat4:function(e,t){var i=4*t;return[e[i],e[i+1],e[i+2],e[i+3]]},setRowMat4:function(e,t,i){e[t]=i[0],e[t+4]=i[1],e[t+8]=i[2],e[t+12]=i[3]},lookAtMat4v:function(e,t,i,s){s||(s=q.mat4());var r,n,o,a,u,h,l,c,p,d,f=e[0],m=e[1],v=e[2],g=i[0],_=i[1],y=i[2],b=t[0],x=t[1],P=t[2];return f===b&&m===x&&v===P?q.identityMat4():(r=f-b,n=m-x,o=v-P,a=_*(o*=d=1/Math.sqrt(r*r+n*n+o*o))-y*(n*=d),u=y*(r*=d)-g*o,h=g*n-_*r,(d=Math.sqrt(a*a+u*u+h*h))?(a*=d=1/d,u*=d,h*=d):(a=0,u=0,h=0),l=n*h-o*u,c=o*a-r*h,p=r*u-n*a,(d=Math.sqrt(l*l+c*c+p*p))?(l*=d=1/d,c*=d,p*=d):(l=0,c=0,p=0),s[0]=a,s[1]=l,s[2]=r,s[3]=0,s[4]=u,s[5]=c,s[6]=n,s[7]=0,s[8]=h,s[9]=p,s[10]=o,s[11]=0,s[12]=-(a*f+u*m+h*v),s[13]=-(l*f+c*m+p*v),s[14]=-(r*f+n*m+o*v),s[15]=1,s)},lookAtMat4c:function(e,t,i,s,r,n,o,a,u){return q.lookAtMat4v([e,t,i],[s,r,n],[o,a,u],[])},orthoMat4c:function(e,t,i,s,r,n,o){o||(o=q.mat4());var a=t-e,u=s-i,h=n-r;return o[0]=2/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/u,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/h,o[11]=0,o[12]=-(e+t)/a,o[13]=-(s+i)/u,o[14]=-(n+r)/h,o[15]=1,o},frustumMat4v:function(e,t,i){i||(i=q.mat4());var s=[e[0],e[1],e[2],0],r=[t[0],t[1],t[2],0];q.addVec4(r,s,J),q.subVec4(r,s,Z);var n=2*s[2],o=Z[0],a=Z[1],u=Z[2];return i[0]=n/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n/a,i[6]=0,i[7]=0,i[8]=J[0]/o,i[9]=J[1]/a,i[10]=-J[2]/u,i[11]=-1,i[12]=0,i[13]=0,i[14]=-n*r[2]/u,i[15]=0,i},frustumMat4:function(e,t,i,s,r,n,o){o||(o=q.mat4());var a=t-e,u=s-i,h=n-r;return o[0]=2*r/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*r/u,o[6]=0,o[7]=0,o[8]=(t+e)/a,o[9]=(s+i)/u,o[10]=-(n+r)/h,o[11]=-1,o[12]=0,o[13]=0,o[14]=-n*r*2/h,o[15]=0,o},perspectiveMat4:function(e,t,i,s,r){var n=[],o=[];return n[2]=i,o[2]=s,o[1]=n[2]*Math.tan(e/2),n[1]=-o[1],o[0]=o[1]*t,n[0]=-o[0],q.frustumMat4v(n,o,r)},compareMat4:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},transformPoint3:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.vec3(),s=t[0],r=t[1],n=t[2];return i[0]=e[0]*s+e[4]*r+e[8]*n+e[12],i[1]=e[1]*s+e[5]*r+e[9]*n+e[13],i[2]=e[2]*s+e[6]*r+e[10]*n+e[14],i},transformPoint4:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.vec4();return i[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],i[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],i[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],i[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],i},transformPoints3:function(e,t,i){for(var s,r,n,o,a,u=i||[],h=t.length,l=e[0],c=e[1],p=e[2],d=e[3],f=e[4],m=e[5],v=e[6],g=e[7],_=e[8],y=e[9],b=e[10],x=e[11],P=e[12],T=e[13],w=e[14],M=e[15],I=0;I<h;++I)s=(o=t[I])[0],r=o[1],n=o[2],(a=u[I]||(u[I]=[0,0,0]))[0]=l*s+f*r+_*n+P,a[1]=c*s+m*r+y*n+T,a[2]=p*s+v*r+b*n+w,a[3]=d*s+g*r+x*n+M;return u.length=h,u},transformPositions3:function(e,t){var i,s,r,n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,a=t.length,u=e[0],h=e[1],l=e[2];e[3];var c=e[4],p=e[5],d=e[6];e[7];var f=e[8],m=e[9],v=e[10];e[11];var g=e[12],_=e[13],y=e[14];for(e[15],i=0;i<a;i+=3)s=t[i+0],r=t[i+1],n=t[i+2],o[i+0]=u*s+c*r+f*n+g,o[i+1]=h*s+p*r+m*n+_,o[i+2]=l*s+d*r+v*n+y;return o},transformPositions4:function(e,t){var i,s,r,n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,a=t.length,u=e[0],h=e[1],l=e[2],c=e[3],p=e[4],d=e[5],f=e[6],m=e[7],v=e[8],g=e[9],_=e[10],y=e[11],b=e[12],x=e[13],P=e[14],T=e[15];for(i=0;i<a;i+=4)s=t[i+0],r=t[i+1],n=t[i+2],o[i+0]=u*s+p*r+v*n+b,o[i+1]=h*s+d*r+g*n+x,o[i+2]=l*s+f*r+_*n+P,o[i+3]=c*s+m*r+y*n+T;return o},transformVec3:function(e,t,i){var s=t[0],r=t[1],n=t[2];return(i=i||this.vec3())[0]=e[0]*s+e[4]*r+e[8]*n,i[1]=e[1]*s+e[5]*r+e[9]*n,i[2]=e[2]*s+e[6]*r+e[10]*n,i},transformVec4:function(e,t,i){var s=t[0],r=t[1],n=t[2],o=t[3];return(i=i||q.vec4())[0]=e[0]*s+e[4]*r+e[8]*n+e[12]*o,i[1]=e[1]*s+e[5]*r+e[9]*n+e[13]*o,i[2]=e[2]*s+e[6]*r+e[10]*n+e[14]*o,i[3]=e[3]*s+e[7]*r+e[11]*n+e[15]*o,i},rotateVec2:function(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e,r=Math.cos(i),n=Math.sin(i),o=e[0]-t[0],a=e[1]-t[1];return s[0]=o*r-a*n+t[0],s[1]=o*n+a*r+t[1],e},rotateVec3X:function(e,t,i,s){var r=[],n=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],n[0]=r[0],n[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),n[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),s[0]=n[0]+t[0],s[1]=n[1]+t[1],s[2]=n[2]+t[2],s},rotateVec3Y:function(e,t,i,s){var r=[],n=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],n[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),n[1]=r[1],n[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),s[0]=n[0]+t[0],s[1]=n[1]+t[1],s[2]=n[2]+t[2],s},rotateVec3Z:function(e,t,i,s){var r=[],n=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],n[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),n[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),n[2]=r[2],s[0]=n[0]+t[0],s[1]=n[1]+t[1],s[2]=n[2]+t[2],s},projectVec4:function(e,t){var i=1/e[3];return(t=t||q.vec2())[0]=e[0]*i,t[1]=e[1]*i,t},unprojectVec3:(O=new K(16),B=new K(16),L=new K(16),function(e,t,i,s){return this.transformVec3(this.mulMat4(this.inverseMat4(t,O),this.inverseMat4(i,B),L),e,s)}),lerpVec3:function(e,t,i,s,r,n){var o=n||q.vec3(),a=(e-t)/(i-t);return o[0]=s[0]+a*(r[0]-s[0]),o[1]=s[1]+a*(r[1]-s[1]),o[2]=s[2]+a*(r[2]-s[2]),o},lerpMat4:function(e,t,i,s,r,n){var o=n||q.mat4(),a=(e-t)/(i-t);return o[0]=s[0]+a*(r[0]-s[0]),o[1]=s[1]+a*(r[1]-s[1]),o[2]=s[2]+a*(r[2]-s[2]),o[3]=s[3]+a*(r[3]-s[3]),o[4]=s[4]+a*(r[4]-s[4]),o[5]=s[5]+a*(r[5]-s[5]),o[6]=s[6]+a*(r[6]-s[6]),o[7]=s[7]+a*(r[7]-s[7]),o[8]=s[8]+a*(r[8]-s[8]),o[9]=s[9]+a*(r[9]-s[9]),o[10]=s[10]+a*(r[10]-s[10]),o[11]=s[11]+a*(r[11]-s[11]),o[12]=s[12]+a*(r[12]-s[12]),o[13]=s[13]+a*(r[13]-s[13]),o[14]=s[14]+a*(r[14]-s[14]),o[15]=s[15]+a*(r[15]-s[15]),o},flatten:function(e){var t,i,s,r,n,o=[];for(t=0,i=e.length;t<i;t++)for(s=0,r=(n=e[t]).length;s<r;s++)o.push(n[s]);return o},identityQuaternion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.vec4();return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},eulerToQuaternion:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.vec4(),s=e[0]*q.DEGTORAD/2,r=e[1]*q.DEGTORAD/2,n=e[2]*q.DEGTORAD/2,o=Math.cos(s),a=Math.cos(r),u=Math.cos(n),h=Math.sin(s),l=Math.sin(r),c=Math.sin(n);return"XYZ"===t?(i[0]=h*a*u+o*l*c,i[1]=o*l*u-h*a*c,i[2]=o*a*c+h*l*u,i[3]=o*a*u-h*l*c):"YXZ"===t?(i[0]=h*a*u+o*l*c,i[1]=o*l*u-h*a*c,i[2]=o*a*c-h*l*u,i[3]=o*a*u+h*l*c):"ZXY"===t?(i[0]=h*a*u-o*l*c,i[1]=o*l*u+h*a*c,i[2]=o*a*c+h*l*u,i[3]=o*a*u-h*l*c):"ZYX"===t?(i[0]=h*a*u-o*l*c,i[1]=o*l*u+h*a*c,i[2]=o*a*c-h*l*u,i[3]=o*a*u+h*l*c):"YZX"===t?(i[0]=h*a*u+o*l*c,i[1]=o*l*u+h*a*c,i[2]=o*a*c-h*l*u,i[3]=o*a*u-h*l*c):"XZY"===t&&(i[0]=h*a*u-o*l*c,i[1]=o*l*u-h*a*c,i[2]=o*a*c+h*l*u,i[3]=o*a*u+h*l*c),i},mat4ToQuaternion:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.vec4(),s=e[0],r=e[4],n=e[8],o=e[1],a=e[5],u=e[9],h=e[2],l=e[6],c=e[10],p=s+a+c;return p>0?(t=.5/Math.sqrt(p+1),i[3]=.25/t,i[0]=(l-u)*t,i[1]=(n-h)*t,i[2]=(o-r)*t):s>a&&s>c?(t=2*Math.sqrt(1+s-a-c),i[3]=(l-u)/t,i[0]=.25*t,i[1]=(r+o)/t,i[2]=(n+h)/t):a>c?(t=2*Math.sqrt(1+a-s-c),i[3]=(n-h)/t,i[0]=(r+o)/t,i[1]=.25*t,i[2]=(u+l)/t):(t=2*Math.sqrt(1+c-s-a),i[3]=(o-r)/t,i[0]=(n+h)/t,i[1]=(u+l)/t,i[2]=.25*t),i},vec3PairToQuaternion:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.vec4(),s=Math.sqrt(q.dotVec3(e,e)*q.dotVec3(t,t)),r=s+q.dotVec3(e,t);return r<1e-8*s?(r=0,Math.abs(e[0])>Math.abs(e[2])?(i[0]=-e[1],i[1]=e[0],i[2]=0):(i[0]=0,i[1]=-e[2],i[2]=e[1])):q.cross3Vec3(e,t,i),i[3]=r,q.normalizeQuaternion(i)},angleAxisToQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.vec4(),i=e[3]/2,s=Math.sin(i);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(i),t},quaternionToEuler:function(){var e=new K(16);return function(t,i,s){return s=s||q.vec3(),q.quaternionToRotationMat4(t,e),q.mat4ToEuler(e,i,s),s}}(),mulQuaternions:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.vec4(),s=e[0],r=e[1],n=e[2],o=e[3],a=t[0],u=t[1],h=t[2],l=t[3];return i[0]=o*a+s*l+r*h-n*u,i[1]=o*u+r*l+n*a-s*h,i[2]=o*h+n*l+s*u-r*a,i[3]=o*l-s*a-r*u-n*h,i},vec3ApplyQuaternion:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.vec3(),s=t[0],r=t[1],n=t[2],o=e[0],a=e[1],u=e[2],h=e[3],l=h*s+a*n-u*r,c=h*r+u*s-o*n,p=h*n+o*r-a*s,d=-o*s-a*r-u*n;return i[0]=l*h+d*-o+c*-u-p*-a,i[1]=c*h+d*-a+p*-o-l*-u,i[2]=p*h+d*-u+l*-a-c*-o,i},quaternionToMat4:function(e,t){t=q.identityMat4(t);var i=e[0],s=e[1],r=e[2],n=e[3],o=2*i,a=2*s,u=2*r,h=o*n,l=a*n,c=u*n,p=o*i,d=a*i,f=u*i,m=a*s,v=u*s,g=u*r;return t[0]=1-(m+g),t[1]=d+c,t[2]=f-l,t[4]=d-c,t[5]=1-(p+g),t[6]=v+h,t[8]=f+l,t[9]=v-h,t[10]=1-(p+m),t},quaternionToRotationMat4:function(e,t){var i=e[0],s=e[1],r=e[2],n=e[3],o=i+i,a=s+s,u=r+r,h=i*o,l=i*a,c=i*u,p=s*a,d=s*u,f=r*u,m=n*o,v=n*a,g=n*u;return t[0]=1-(p+f),t[4]=l-g,t[8]=c+v,t[1]=l+g,t[5]=1-(h+f),t[9]=d-m,t[2]=c-v,t[6]=d+m,t[10]=1-(h+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},normalizeQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,i=q.lenVec4([e[0],e[1],e[2],e[3]]);return t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i,t[3]=e[3]/i,t},conjugateQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},inverseQuaternion:function(e,t){return q.normalizeQuaternion(q.conjugateQuaternion(e,t))},quaternionToAngleAxis:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.vec4(),i=(e=q.normalizeQuaternion(e,Q))[3],s=2*Math.acos(i),r=Math.sqrt(1-i*i);return r<.001?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r),t[3]=s,t},AABB3:function(e){return new K(e||6)},AABB2:function(e){return new K(e||4)},OBB3:function(e){return new K(e||32)},OBB2:function(e){return new K(e||16)},Sphere3:function(e,t,i,s){return new K([e,t,i,s])},transformOBB3:function(e,t){var i,s,r,n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,a=t.length,u=e[0],h=e[1],l=e[2],c=e[3],p=e[4],d=e[5],f=e[6],m=e[7],v=e[8],g=e[9],_=e[10],y=e[11],b=e[12],x=e[13],P=e[14],T=e[15];for(i=0;i<a;i+=4)s=t[i+0],r=t[i+1],n=t[i+2],o[i+0]=u*s+p*r+v*n+b,o[i+1]=h*s+d*r+g*n+x,o[i+2]=l*s+f*r+_*n+P,o[i+3]=c*s+m*r+y*n+T;return o},containsAABB3:function(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&t[4]<=e[4]&&e[2]<=t[2]&&t[5]<=e[5]},getAABB3Diag:function(){var e=new K(3),t=new K(3),i=new K(3);return function(s){return e[0]=s[0],e[1]=s[1],e[2]=s[2],t[0]=s[3],t[1]=s[4],t[2]=s[5],q.subVec3(t,e,i),Math.abs(q.lenVec3(i))}}(),getAABB3DiagPoint:function(){var e=new K(3),t=new K(3),i=new K(3);return function(s,r){e[0]=s[0],e[1]=s[1],e[2]=s[2],t[0]=s[3],t[1]=s[4],t[2]=s[5];var n=q.subVec3(t,e,i),o=r[0]-s[0],a=s[3]-r[0],u=r[1]-s[1],h=s[4]-r[1],l=r[2]-s[2],c=s[5]-r[2];return n[0]+=o>a?o:a,n[1]+=u>h?u:h,n[2]+=l>c?l:c,Math.abs(q.lenVec3(n))}}(),getAABB3Area:function(e){return(e[3]-e[0])*(e[4]-e[1])*(e[5]-e[2])},getAABB3Center:function(e,t){var i=t||q.vec3();return i[0]=(e[0]+e[3])/2,i[1]=(e[1]+e[4])/2,i[2]=(e[2]+e[5])/2,i},getAABB2Center:function(e,t){var i=t||q.vec2();return i[0]=(e[2]+e[0])/2,i[1]=(e[3]+e[1])/2,i},collapseAABB3:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.AABB3();return e[0]=q.MAX_DOUBLE,e[1]=q.MAX_DOUBLE,e[2]=q.MAX_DOUBLE,e[3]=q.MIN_DOUBLE,e[4]=q.MIN_DOUBLE,e[5]=q.MIN_DOUBLE,e},AABB3ToOBB3:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.OBB3();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t},positions3ToAABB3:function(){var e=new K(3);return function(t,i,s){i=i||q.AABB3();for(var r,n,o,a=q.MAX_DOUBLE,u=q.MAX_DOUBLE,h=q.MAX_DOUBLE,l=q.MIN_DOUBLE,c=q.MIN_DOUBLE,p=q.MIN_DOUBLE,d=0,f=t.length;d<f;d+=3)s?(e[0]=t[d+0],e[1]=t[d+1],e[2]=t[d+2],q.decompressPosition(e,s,e),r=e[0],n=e[1],o=e[2]):(r=t[d+0],n=t[d+1],o=t[d+2]),r<a&&(a=r),n<u&&(u=n),o<h&&(h=o),r>l&&(l=r),n>c&&(c=n),o>p&&(p=o);return i[0]=a,i[1]=u,i[2]=h,i[3]=l,i[4]=c,i[5]=p,i}}(),OBB3ToAABB3:function(e){for(var t,i,s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.AABB3(),n=q.MAX_DOUBLE,o=q.MAX_DOUBLE,a=q.MAX_DOUBLE,u=q.MIN_DOUBLE,h=q.MIN_DOUBLE,l=q.MIN_DOUBLE,c=0,p=e.length;c<p;c+=4)(t=e[c+0])<n&&(n=t),(i=e[c+1])<o&&(o=i),(s=e[c+2])<a&&(a=s),t>u&&(u=t),i>h&&(h=i),s>l&&(l=s);return r[0]=n,r[1]=o,r[2]=a,r[3]=u,r[4]=h,r[5]=l,r},points3ToAABB3:function(e){for(var t,i,s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.AABB3(),n=q.MAX_DOUBLE,o=q.MAX_DOUBLE,a=q.MAX_DOUBLE,u=q.MIN_DOUBLE,h=q.MIN_DOUBLE,l=q.MIN_DOUBLE,c=0,p=e.length;c<p;c++)(t=e[c][0])<n&&(n=t),(i=e[c][1])<o&&(o=i),(s=e[c][2])<a&&(a=s),t>u&&(u=t),i>h&&(h=i),s>l&&(l=s);return r[0]=n,r[1]=o,r[2]=a,r[3]=u,r[4]=h,r[5]=l,r},points3ToSphere3:function(){var e=new K(3);return function(t,i){i=i||q.vec4();var s,r=0,n=0,o=0,a=t.length;for(s=0;s<a;s++)r+=t[s][0],n+=t[s][1],o+=t[s][2];i[0]=r/a,i[1]=n/a,i[2]=o/a;var u,h=0;for(s=0;s<a;s++)(u=Math.abs(q.lenVec3(q.subVec3(t[s],i,e))))>h&&(h=u);return i[3]=h,i}}(),positions3ToSphere3:function(){var e=new K(3),t=new K(3);return function(i,s){s=s||q.vec4();var r,n=0,o=0,a=0,u=i.length,h=0;for(r=0;r<u;r+=3)n+=i[r],o+=i[r+1],a+=i[r+2];var l,c=u/3;for(s[0]=n/c,s[1]=o/c,s[2]=a/c,r=0;r<u;r+=3)e[0]=i[r],e[1]=i[r+1],e[2]=i[r+2],(l=Math.abs(q.lenVec3(q.subVec3(e,s,t))))>h&&(h=l);return s[3]=h,s}}(),OBB3ToSphere3:function(){var e=new K(3),t=new K(3);return function(i,s){s=s||q.vec4();var r,n=0,o=0,a=0,u=i.length,h=u/4;for(r=0;r<u;r+=4)n+=i[r+0],o+=i[r+1],a+=i[r+2];s[0]=n/h,s[1]=o/h,s[2]=a/h;var l,c=0;for(r=0;r<u;r+=4)e[0]=i[r+0],e[1]=i[r+1],e[2]=i[r+2],(l=Math.abs(q.lenVec3(q.subVec3(e,s,t))))>c&&(c=l);return s[3]=c,s}}(),getSphere3Center:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.vec3();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},getPositionsCenter:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.vec3(),i=0,s=0,r=0,n=0,o=e.length;n<o;n+=3)i+=e[n+0],s+=e[n+1],r+=e[n+2];var a=e.length/3;return t[0]=i/a,t[1]=s/a,t[2]=r/a,t},expandAABB3:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e},expandAABB3Point3:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e},expandAABB3Points3:function(e,t){for(var i,s,r,n=0,o=t.length;n<o;n+=3)i=t[n],s=t[n+1],r=t[n+2],e[0]>i&&(e[0]=i),e[1]>s&&(e[1]=s),e[2]>r&&(e[2]=r),e[3]<i&&(e[3]=i),e[4]<s&&(e[4]=s),e[5]<r&&(e[5]=r);return e},collapseAABB2:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.AABB2();return e[0]=q.MAX_DOUBLE,e[1]=q.MAX_DOUBLE,e[2]=q.MIN_DOUBLE,e[3]=q.MIN_DOUBLE,e},point3AABB3Intersect:function(e,t){return e[0]>t[0]||e[3]<t[0]||e[1]>t[1]||e[4]<t[1]||e[2]>t[2]||e[5]<t[2]},planeAABB3Intersect:function(e,t,i){var s,r;return e[0]>0?(s=e[0]*i[0],r=e[0]*i[3]):(s=e[0]*i[3],r=e[0]*i[0]),e[1]>0?(s+=e[1]*i[1],r+=e[1]*i[4]):(s+=e[1]*i[4],r+=e[1]*i[1]),e[2]>0?(s+=e[2]*i[2],r+=e[2]*i[5]):(s+=e[2]*i[5],r+=e[2]*i[2]),s<=-t&&r<=-t?-1:s>=-t&&r>=-t?1:0},OBB3ToAABB2:function(e){for(var t,i,s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.AABB2(),n=q.MAX_DOUBLE,o=q.MAX_DOUBLE,a=q.MIN_DOUBLE,u=q.MIN_DOUBLE,h=0,l=e.length;h<l;h+=4)t=e[h+0],i=e[h+1],(t*=s=1/(e[h+3]||1))<n&&(n=t),(i*=s)<o&&(o=i),t>a&&(a=t),i>u&&(u=i);return r[0]=n,r[1]=o,r[2]=a,r[3]=u,r},expandAABB2:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e},expandAABB2Point2:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1]),e},AABB2ToCanvas:function(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e,r=.5*(e[0]+1),n=.5*(e[1]+1),o=.5*(e[2]+1),a=.5*(e[3]+1);return s[0]=Math.floor(r*t),s[1]=i-Math.floor(a*i),s[2]=Math.floor(o*t),s[3]=i-Math.floor(n*i),s},tangentQuadraticBezier:function(e,t,i,s){return 2*(1-e)*(i-t)+2*e*(s-i)},tangentQuadraticBezier3:function(e,t,i,s,r){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*s*(1-e)-3*e*e*s+3*e*e*r},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},catmullRomInterpolate:function(e,t,i,s,r){var n=.5*(i-e),o=.5*(s-t),a=r*r;return(2*t-2*i+n+o)*(r*a)+(-3*t+3*i-2*n-o)*a+n*r+t},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,s){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,s)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,s,r){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,s)+this.b3p3(e,r)},triangleNormal:function(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.vec3(),r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2],a=i[0]-e[0],u=i[1]-e[1],h=i[2]-e[2],l=n*h-o*u,c=o*a-r*h,p=r*u-n*a,d=Math.sqrt(l*l+c*c+p*p);return 0===d?(s[0]=0,s[1]=0,s[2]=0):(s[0]=l/d,s[1]=c/d,s[2]=p/d),s},rayTriangleIntersect:function(){var e=new K(3),t=new K(3),i=new K(3),s=new K(3),r=new K(3);return function(n,o,a,u,h,l){l=l||q.vec3();var c=q.subVec3(u,a,e),p=q.subVec3(h,a,t),d=q.cross3Vec3(o,p,i),f=q.dotVec3(c,d);if(f<1e-6)return null;var m=q.subVec3(n,a,s),v=q.dotVec3(m,d);if(v<0||v>f)return null;var g=q.cross3Vec3(m,c,r),_=q.dotVec3(o,g);if(_<0||v+_>f)return null;var y=q.dotVec3(p,g)/f;return l[0]=n[0]+y*o[0],l[1]=n[1]+y*o[1],l[2]=n[2]+y*o[2],l}}(),rayPlaneIntersect:function(){var e=new K(3),t=new K(3),i=new K(3),s=new K(3);return function(r,n,o,a,u,h){h=h||q.vec3(),n=q.normalizeVec3(n,e);var l=q.subVec3(a,o,t),c=q.subVec3(u,o,i),p=q.cross3Vec3(l,c,s);q.normalizeVec3(p,p);var d=-q.dotVec3(o,p),f=-(q.dotVec3(r,p)+d)/q.dotVec3(n,p);return h[0]=r[0]+f*n[0],h[1]=r[1]+f*n[1],h[2]=r[2]+f*n[2],h}}(),cartesianToBarycentric:function(){var e=new K(3),t=new K(3),i=new K(3);return function(s,r,n,o,a){var u=q.subVec3(o,r,e),h=q.subVec3(n,r,t),l=q.subVec3(s,r,i),c=q.dotVec3(u,u),p=q.dotVec3(u,h),d=q.dotVec3(u,l),f=q.dotVec3(h,h),m=q.dotVec3(h,l),v=c*f-p*p;if(0===v)return null;var g=1/v,_=(f*d-p*m)*g,y=(c*m-p*d)*g;return a[0]=1-_-y,a[1]=y,a[2]=_,a}}(),barycentricInsideTriangle:function(e){var t=e[1],i=e[2];return i>=0&&t>=0&&i+t<1},barycentricToCartesian:function(e,t,i,s){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:q.vec3(),n=e[0],o=e[1],a=e[2];return r[0]=t[0]*n+i[0]*o+s[0]*a,r[1]=t[1]*n+i[1]*o+s[1]*a,r[2]=t[2]*n+i[2]*o+s[2]*a,r},mergeVertices:function(e,t,i,s){var r,n,o,a,u,h,l={},c=[],p=[],d=t?[]:null,f=i?[]:null,m=[],v=Math.pow(10,4),g=0;for(u=0,h=e.length;u<h;u+=3)r=e[u],n=e[u+1],o=e[u+2],void 0===l[a="".concat(Math.round(r*v),"_").concat(Math.round(n*v),"_").concat(Math.round(o*v))]&&(l[a]=p.length/3,p.push(r),p.push(n),p.push(o),t&&(d.push(t[u]),d.push(t[u+1]),d.push(t[u+2])),i&&(f.push(i[g]),f.push(i[g+1]))),c[u/3]=l[a],g+=2;for(u=0,h=s.length;u<h;u++)m[u]=c[s[u]];var _={positions:p,indices:m};return d&&(_.normals=d),f&&(_.uv=f),_},buildNormals:function(){var e=new K(3),t=new K(3),i=new K(3),s=new K(3),r=new K(3),n=new K(3);return function(o,a,u){var h,l,c,p,d,f,m,v,g,_=new Array(o.length/3);for(h=0,l=a.length;h<l;h+=3){c=a[h],p=a[h+1],d=a[h+2],e[0]=o[3*c],e[1]=o[3*c+1],e[2]=o[3*c+2],t[0]=o[3*p],t[1]=o[3*p+1],t[2]=o[3*p+2],i[0]=o[3*d],i[1]=o[3*d+1],i[2]=o[3*d+2],q.subVec3(t,e,s),q.subVec3(i,e,r);var y=q.vec3();q.normalizeVec3(q.cross3Vec3(s,r,n),y),_[c]||(_[c]=[]),_[p]||(_[p]=[]),_[d]||(_[d]=[]),_[c].push(y),_[p].push(y),_[d].push(y)}for(u=u&&u.length===o.length?u:new Float32Array(o.length),h=0,l=_.length;h<l;h++){f=_[h].length,m=0,v=0,g=0;for(var b=0;b<f;b++)m+=_[h][b][0],v+=_[h][b][1],g+=_[h][b][2];u[3*h]=m/f,u[3*h+1]=v/f,u[3*h+2]=g/f}return u}}(),buildTangents:function(){var e=new K(3),t=new K(3),i=new K(3),s=new K(3),r=new K(3),n=new K(3),o=new K(3);return function(a,u,h){for(var l=new Float32Array(a.length),c=0;c<u.length;c+=3){var p=u[c],d=a.subarray(3*p,3*p+3),f=h.subarray(2*p,2*p+2);p=u[c+1];var m=a.subarray(3*p,3*p+3),v=h.subarray(2*p,2*p+2);p=u[c+2];for(var g=a.subarray(3*p,3*p+3),_=h.subarray(2*p,2*p+2),y=q.subVec3(m,d,e),b=q.subVec3(g,d,t),x=q.subVec2(v,f,i),P=q.subVec2(_,f,s),T=1/(x[0]*P[1]-x[1]*P[0]),w=q.mulVec3Scalar(q.subVec3(q.mulVec3Scalar(y,P[1],r),q.mulVec3Scalar(b,x[1],n),o),T,n),M=void 0,I=0;I<3;I++)l[M=3*u[c+I]]+=w[0],l[M+1]+=w[1],l[M+2]+=w[2]}return l}}(),buildPickTriangles:function(e,t,i){for(var s,r,n,o,a,u=t.length,h=i?new Uint16Array(9*u):new Float32Array(9*u),l=new Uint8Array(12*u),c=0,p=0,d=0,f=0;f<u;f+=3)a=c>>24&255,o=c>>16&255,n=c>>8&255,r=255&c,s=3*t[f],h[p++]=e[s],h[p++]=e[s+1],h[p++]=e[s+2],l[d++]=r,l[d++]=n,l[d++]=o,l[d++]=a,s=3*t[f+1],h[p++]=e[s],h[p++]=e[s+1],h[p++]=e[s+2],l[d++]=r,l[d++]=n,l[d++]=o,l[d++]=a,s=3*t[f+2],h[p++]=e[s],h[p++]=e[s+1],h[p++]=e[s+2],l[d++]=r,l[d++]=n,l[d++]=o,l[d++]=a,c++;return{positions:h,colors:l}},faceToVertexNormals:function(e,t){var i,s,r,n,o,a,u,h,l,c,p,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=d.smoothNormalsAngleThreshold||20,m={},v=[],g={},_=4,y=Math.pow(10,_);for(u=0,l=e.length;u<l;u+=3){a=u/3,s=e[u],r=e[u+1],n=e[u+2],void 0===m[o="".concat(Math.round(s*y),"_").concat(Math.round(r*y),"_").concat(Math.round(n*y))]?m[o]=[a]:m[o].push(a);var b=q.normalizeVec3([t[u],t[u+1],t[u+2]]);v[a]=b,i=q.vec4([b[0],b[1],b[2],1]),g[a]=i}for(o in m)if(m.hasOwnProperty(o)){var x=m[o],P=x.length;for(u=0;u<P;u++){var T=x[u];for(i=g[T],h=0;h<P;h++)if(u!==h){var w=x[h];c=v[T],p=v[w];var M=Math.abs(q.angleVec3(c,p)/q.DEGTORAD);M<f&&(i[0]+=p[0],i[1]+=p[1],i[2]+=p[2],i[3]+=1)}}}for(u=0,l=t.length;u<l;u+=3)i=g[u/3],t[u+0]=i[0]/i[3],t[u+1]=i[1]/i[3],t[u+2]=i[2]/i[3]},transformRay:function(){var e=new K(4),t=new K(4);return function(i,s,r,n,o){e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=1,q.transformVec4(i,e,t),n[0]=t[0],n[1]=t[1],n[2]=t[2],e[0]=r[0],e[1]=r[1],e[2]=r[2],q.transformVec3(i,e,t),q.normalizeVec3(t),o[0]=t[0],o[1]=t[1],o[2]=t[2]}}(),canvasPosToWorldRay:function(){var e=new K(16),t=new K(16),i=new K(4),s=new K(4),r=new K(4),n=new K(4);return function(o,a,u,h,l,c){var p=q.mulMat4(u,a,e),d=q.inverseMat4(p,t),f=o.width,m=o.height,v=(h[0]-f/2)/(f/2),g=-(h[1]-m/2)/(m/2);i[0]=v,i[1]=g,i[2]=-1,i[3]=1,q.transformVec4(d,i,s),q.mulVec4Scalar(s,1/s[3]),r[0]=v,r[1]=g,r[2]=1,r[3]=1,q.transformVec4(d,r,n),q.mulVec4Scalar(n,1/n[3]),l[0]=n[0],l[1]=n[1],l[2]=n[2],q.subVec3(n,s,c),q.normalizeVec3(c)}}(),canvasPosToLocalRay:(R=new K(3),S=new K(3),function(e,t,i,s,r,n,o){q.canvasPosToWorldRay(e,t,i,r,R,S),q.worldRayToLocalRay(s,R,S,n,o)}),worldRayToLocalRay:function(){var e=new K(16),t=new K(4),i=new K(4);return function(s,r,n,o,a){var u=q.inverseMat4(s,e);t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=1,q.transformVec4(u,t,i),o[0]=i[0],o[1]=i[1],o[2]=i[2],q.transformVec3(u,n,a)}}(),buildKDTree:function(){var e=new Float32Array;function t(i,s,r,n){var o,a,u=new K(6),h={triangles:null,left:null,right:null,leaf:!1,splitDim:0,aabb:u};for(u[0]=u[1]=u[2]=Number.POSITIVE_INFINITY,u[3]=u[4]=u[5]=Number.NEGATIVE_INFINITY,o=0,a=i.length;o<a;++o)for(var l=3*i[o],c=0;c<3;++c){var p=3*s[l+c];r[p]<u[0]&&(u[0]=r[p]),r[p]>u[3]&&(u[3]=r[p]),r[p+1]<u[1]&&(u[1]=r[p+1]),r[p+1]>u[4]&&(u[4]=r[p+1]),r[p+2]<u[2]&&(u[2]=r[p+2]),r[p+2]>u[5]&&(u[5]=r[p+2])}if(i.length<20||n>10)return h.triangles=i,h.leaf=!0,h;e[0]=u[3]-u[0],e[1]=u[4]-u[1],e[2]=u[5]-u[2];var d=0;e[1]>e[d]&&(d=1),e[2]>e[d]&&(d=2),h.splitDim=d;var f=(u[d]+u[d+3])/2,m=new Array(i.length),v=0,g=new Array(i.length),_=0;for(o=0,a=i.length;o<a;++o){var y=s[l=3*i[o]],b=3*s[l+1],x=3*s[l+2];r[3*y+d]<=f||r[b+d]<=f||r[x+d]<=f?m[v++]=i[o]:g[_++]=i[o]}return m.length=v,g.length=_,h.left=t(m,s,r,n+1),h.right=t(g,s,r,n+1),h}return function(e,i){for(var s=e.length/3,r=new Array(s),n=0;n<s;++n)r[n]=n;return t(r,e,i,0)}}(),decompressPosition:function(e,t,i){(i=i||e)[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14]},decompressPositions:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Float32Array(e.length),s=0,r=e.length;s<r;s+=3)i[s+0]=e[s+0]*t[0]+t[12],i[s+1]=e[s+1]*t[5]+t[13],i[s+2]=e[s+2]*t[10]+t[14];return i},decompressUV:function(e,t,i){i[0]=e[0]*t[0]+t[6],i[1]=e[1]*t[4]+t[7]},decompressUVs:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Float32Array(e.length),s=0,r=e.length;s<r;s+=3)i[s+0]=e[s+0]*t[0]+t[6],i[s+1]=e[s+1]*t[4]+t[7];return i},octDecodeVec2:function(e,t){var i=e[0],s=e[1];i=(2*i+1)/255,s=(2*s+1)/255;var r=1-Math.abs(i)-Math.abs(s);r<0&&(i=(1-Math.abs(s))*(i>=0?1:-1),s=(1-Math.abs(i))*(s>=0?1:-1));var n=Math.sqrt(i*i+s*s+r*r);return t[0]=i/n,t[1]=s/n,t[2]=r/n,t},octDecodeVec2s:function(e,t){for(var i=0,s=0,r=e.length;i<r;i+=2){var n=e[i+0],o=e[i+1];n=(2*n+1)/255,o=(2*o+1)/255;var a=1-Math.abs(n)-Math.abs(o);a<0&&(n=(1-Math.abs(o))*(n>=0?1:-1),o=(1-Math.abs(n))*(o>=0?1:-1));var u=Math.sqrt(n*n+o*o+a*a);t[s+0]=n/u,t[s+1]=o/u,t[s+2]=a/u,s+=3}return t}};q.buildEdgeIndices=function(){var e=[],t=[],i=[],s=[],r=[],n=0,o=new Uint16Array(3),a=new Uint16Array(3),u=new Uint16Array(3),h=q.vec3(),l=q.vec3(),c=q.vec3(),p=q.vec3(),d=q.vec3(),f=q.vec3(),m=q.vec3();return function(v,g,_,y){!function(r,n){var o,a,u,h,l,c,p={},d=Math.pow(10,4),f=0;for(l=0,c=r.length;l<c;l+=3)o=r[l],a=r[l+1],u=r[l+2],void 0===p[h=Math.round(o*d)+"_"+Math.round(a*d)+"_"+Math.round(u*d)]&&(p[h]=f/3,e[f++]=o,e[f++]=a,e[f++]=u),t[l/3]=p[h];for(l=0,c=n.length;l<c;l++)s[l]=t[n[l]],i[s[l]]=n[l]}(v,g),function(t,i){n=0;for(var v=0,g=t;v<g;v+=3){var _=3*s[v],y=3*s[v+1],b=3*s[v+2];i?(o[0]=e[_],o[1]=e[_+1],o[2]=e[_+2],a[0]=e[y],a[1]=e[y+1],a[2]=e[y+2],u[0]=e[b],u[1]=e[b+1],u[2]=e[b+2],q.decompressPosition(o,i,h),q.decompressPosition(a,i,l),q.decompressPosition(u,i,c)):(h[0]=e[_],h[1]=e[_+1],h[2]=e[_+2],l[0]=e[y],l[1]=e[y+1],l[2]=e[y+2],c[0]=e[b],c[1]=e[b+1],c[2]=e[b+2]),q.subVec3(c,l,p),q.subVec3(h,l,d),q.cross3Vec3(p,d,f),q.normalizeVec3(f,m);var x=r[n]||(r[n]={normal:q.vec3()});x.normal[0]=m[0],x.normal[1]=m[1],x.normal[2]=m[2],n++}}(g.length,_);for(var b,x,P,T,w,M,I,C,D,A,k=[],E=Math.cos(q.DEGTORAD*y),F={},R=!1,S=0,O=g.length;S<O;S+=3)for(var B=S/3,L=0;L<3;L++)b=s[S+L],x=s[S+(L+1)%3],void 0===F[w=(P=Math.min(b,x))+","+(T=Math.max(b,x))]?F[w]={index1:P,index2:T,face1:B,face2:void 0}:F[w].face2=B;for(w in F)void 0!==(M=F[w]).face2&&(I=r[M.face1].normal,C=r[M.face2].normal,q.dotVec3(I,C)>E)||(D=i[M.index1],A=i[M.index2],(!R&&D>65535||A>65535)&&(R=!0),k.push(D),k.push(A));return R?new Uint32Array(k):new Uint16Array(k)}}();var $=function(){function e(){w(this,e),this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}return I(e,[{key:"length",get:function(){return this._length}},{key:"shift",value:function(){if(this._index>=this._headLength){var e=this._head;if(e.length=0,this._head=this._tail,this._tail=e,this._index=0,this._headLength=this._head.length,!this._headLength)return}var t=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,t}},{key:"push",value:function(e){return this._length++,this._tail.push(e),this}},{key:"unshift",value:function(e){return this._head[--this._index]=e,this._length++,this}}]),e}(),ee={build:{version:"0.8"},client:{browser:navigator&&navigator.userAgent?navigator.userAgent:"n/a"},components:{scenes:0,models:0,meshes:0,objects:0},memory:{meshes:0,positions:0,colors:0,normals:0,uvs:0,indices:0,textures:0,transforms:0,materials:0,programs:0},frame:{frameCount:0,fps:0,useProgram:0,bindTexture:0,bindArray:0,drawElements:0,drawArrays:0,tasksRun:0,tasksScheduled:0}};var te=[["0",10],["A",26],["a",26],["_",1],["$",1]].map((function(e){for(var t=[],i=e[0].charCodeAt(0),s=i+e[1],r=i;r<s;++r)t.push(r);return String.fromCharCode.apply(null,t)})).join("");function ie(e,t){return(t&&4!==t?[0,6]:[0,6,12,18]).map((function(t){return te.substr(parseInt(e/(1<<t))%64,1)})).reverse().join("")}var se=function(){for(var e={},t=window.location.search.substring(1).split("&"),i=0;i<t.length;i++){var s=t[i].split("=");if(void 0===e[s[0]])e[s[0]]=decodeURIComponent(s[1]);else if("string"==typeof e[s[0]]){var r=[e[s[0]],decodeURIComponent(s[1])];e[s[0]]=r}else e[s[0]].push(decodeURIComponent(s[1]))}return e}();var re={xmlToJson:function e(t,i){if(t.nodeType===t.TEXT_NODE){var s=t.nodeValue;if(null===s.match(/^\s+$/))return s}else if(t.nodeType===t.ELEMENT_NODE||t.nodeType===t.DOCUMENT_NODE){var r={type:t.nodeName,children:[]};if(t.nodeType===t.ELEMENT_NODE)for(var n=0;n<t.attributes.length;n++){var o=t.attributes[n];r[i[o.nodeName]||o.nodeName]=o.nodeValue}for(var a=0;a<t.childNodes.length;a++){(n=e(t.childNodes[a],i))&&r.children.push(n)}return r}},clone:function(e){return JSON.parse(JSON.stringify(e))},compressGuid:function(e){var t=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map((function(t){return parseInt(e.substr(t,2),16)}));return ie(t[0],2)+[1,4,7,10,13].map((function(e){return ie((t[e]<<16)+(t[e+1]<<8)+t[e+2])})).join("")},findNodeOfType:function(e,t){var i=[];return function e(s){s.type===t&&i.push(s),(s.children||[]).forEach((function(t){e(t)}))}(e),i},timeout:function(e){return new Promise((function(t,i){setTimeout(t,e)}))},httpRequest:function(e){return new Promise((function(t,i){var s=new XMLHttpRequest;s.open(e.method||"GET",e.url,!0),s.onload=function(r){console.log(e.url,s.readyState,s.status),4===s.readyState&&(200===s.status?t(s.responseXML):i(s.statusText))},s.send(null)}))},loadJSON:function(e,t,i){var s=function(e){};t=t||s,i=i||s;var r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.open("GET",e,!0),r.addEventListener("load",(function(e){var s=e.target.response;if(200===this.status){var r;try{r=JSON.parse(s)}catch(e){i("utils.loadJSON(): Failed to parse JSON response - ".concat(e))}t(r)}else if(0===this.status){console.warn("loadFile: HTTP Status 0 received.");try{t(JSON.parse(s))}catch(e){i("utils.loadJSON(): Failed to parse JSON response - ".concat(e))}}else i(e)}),!1),r.addEventListener("error",(function(e){i(e)}),!1),r.send(null)},loadArraybuffer:function(e,t,i){var s=function(e){};t=t||s,i=i||s;var r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){var n=!!r[2],o=r[3];o=window.decodeURIComponent(o),n&&(o=window.atob(o));try{for(var a=new ArrayBuffer(o.length),u=new Uint8Array(a),h=0;h<o.length;h++)u[h]=o.charCodeAt(h);window.setTimeout((function(){t(a)}),0)}catch(e){window.setTimeout((function(){i(e)}),0)}}else{var l=new XMLHttpRequest;l.open("GET",e,!0),l.responseType="arraybuffer",l.onreadystatechange=function(){4===l.readyState&&(200===l.status?t(l.response):i("loadArrayBuffer error : "+l.response))},l.send(null)}},queryString:se,isArray:function(e){return e&&!e.propertyIsEnumerable("length")&&"object"===T(e)&&"number"==typeof e.length},isString:function(e){return"string"==typeof e||e instanceof String},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isID:function(e){return re.isString(e)||re.isNumeric(e)},isSameComponent:function(e,t){return!(!e||!t)&&(re.isNumeric(e)||re.isString(e)?"".concat(e):e.id)===(re.isNumeric(t)||re.isString(t)?"".concat(t):t.id)},isFunction:function(e){return"function"==typeof e},isObject:function(e){var t={}.constructor;return!!e&&e.constructor===t},copy:function(e){return re.apply(e,{})},apply:function(e,t){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},apply2:function(e,t){for(var i in e)e.hasOwnProperty(i)&&void 0!==e[i]&&null!==e[i]&&(t[i]=e[i]);return t},applyIf:function(e,t){for(var i in e)e.hasOwnProperty(i)&&(void 0!==t[i]&&null!==t[i]||(t[i]=e[i]));return t},isEmptyObject:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},inQuotes:function(e){return re.isNumeric(e)?"".concat(e):"'".concat(e,"'")},concat:function(e,t){var i=new e.constructor(e.length+t.length);return i.set(e),i.set(t,e.length),i},flattenParentChildHierarchy:function(e){var t=[];return function e(i){i.id=i.uuid,delete i.oid,t.push(i);var s=i.children;if(s)for(var r=0,n=s.length;r<n;r++){s[r].parent=i.id,e(s[r])}i.children=[]}(e),t}},ne={},oe=new G,ae=new $,ue={sceneId:null,time:null,startTime:null,prevTime:null,deltaTime:null},he=[],le=0,ce=0;var pe=new function(){this.version="1.0.0",this.scenes={},this._superTypes={},this._addScene=function(e){if(e.id){if(pe.scenes[e.id])return void console.error("[ERROR] Scene ".concat(re.inQuotes(e.id)," already exists"))}else e.id=oe.addItem({});pe.scenes[e.id]=e;var t=e.ticksPerOcclusionTest,i=e.ticksPerRender;ne[e.id]={ticksPerOcclusionTest:t,ticksPerRender:i,renderCountdown:i},ee.components.scenes++,e.once("destroyed",(function(){oe.removeItem(e.id),delete pe.scenes[e.id],delete ne[e.id],ee.components.scenes--}))},this.clear=function(){var e;for(var t in pe.scenes)pe.scenes.hasOwnProperty(t)&&(e=pe.scenes[t],"default.scene"===t?e.clear():(e.destroy(),delete pe.scenes[e.id]))},this.scheduleTask=function(e,t){ae.push(e),ae.push(t)},this.runTasks=function(){for(var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,s=(new Date).getTime(),r=0;ae.length>0&&(i<0||s<i);)e=ae.shift(),(t=ae.shift())?e.call(t):e(),s=(new Date).getTime(),r++;return r},this.getNumTasks=function(){return ae.length}},de=function e(){var t=Date.now();if(le>0){var i=1e3/(t-le);ce+=i,he.push(i),he.length>=30&&(ce-=he.shift()),ee.frame.fps=Math.round(ce/he.length)}!function(e){var t=pe.runTasks(e+10),i=pe.getNumTasks();ee.frame.tasksRun=t,ee.frame.tasksScheduled=i,ee.frame.tasksBudget=10}(t),function(e){for(var t in ue.time=e,pe.scenes)if(pe.scenes.hasOwnProperty(t)){var i=pe.scenes[t];ue.sceneId=t,ue.startTime=i.startTime,ue.deltaTime=null!=ue.prevTime?ue.time-ue.prevTime:0,i.fire("tick",ue,!0)}ue.prevTime=e}(t),function(){var e,t,i,s,r,n=pe.scenes,o=!1;for(r in n)n.hasOwnProperty(r)&&(e=n[r],(t=ne[r])||(t=ne[r]={}),i=e.ticksPerOcclusionTest,t.ticksPerOcclusionTest!==i&&(t.ticksPerOcclusionTest=i,t.renderCountdown=i),--e.occlusionTestCountdown<=0&&(e.doOcclusionTest(),e.occlusionTestCountdown=i),s=e.ticksPerRender,t.ticksPerRender!==s&&(t.ticksPerRender=s,t.renderCountdown=s),0==--t.renderCountdown&&(e.render(o),t.renderCountdown=s))}(),le=t,void 0!==window.requestPostAnimationFrame?window.requestPostAnimationFrame(e):requestAnimationFrame(e)};void 0!==window.requestPostAnimationFrame?window.requestPostAnimationFrame(de):requestAnimationFrame(de);var fe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(w(this,e),this.scene=null,"Scene"===this.type)this.scene=this,this.viewer=i.viewer;else{if("Scene"===t.type)this.scene=t;else{if(!(t instanceof e))throw"Invalid param: owner must be a Component";this.scene=t.scene}this._owner=t}this._dontClear=!!i.dontClear,this._renderer=this.scene._renderer,this.meta=i.meta||{},this.id=i.id,this.destroyed=!1,this._attached={},this._attachments=null,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._eventSubsNum=null,this._events=null,this._eventCallDepth=0,this._ownedComponents=null,this!==this.scene&&this.scene._addComponent(this),this._updateScheduled=!1,t&&t._own(this)}return I(e,[{key:"type",get:function(){return"Component"}},{key:"isComponent",get:function(){return!0}},{key:"glRedraw",value:function(){this._renderer&&(this._renderer.imageDirty(),this.castsShadow&&this._renderer.shadowsDirty())}},{key:"glResort",value:function(){this._renderer&&this._renderer.needStateSort()}},{key:"owner",get:function(){return this._owner}},{key:"isType",value:function(e){return this.type===e}},{key:"fire",value:function(e,t,i){this._events||(this._events={}),this._eventSubs||(this._eventSubs={},this._eventSubsNum={}),!0!==i&&(this._events[e]=t||!0);var s,r=this._eventSubs[e];if(r)for(var n in r)r.hasOwnProperty(n)&&(s=r[n],this._eventCallDepth++,this._eventCallDepth<300?s.callback.call(s.scope,t):this.error("fire: potential stack overflow from recursive event '"+e+"' - dropping this event"),this._eventCallDepth--)}},{key:"on",value:function(e,t,i){this._events||(this._events={}),this._subIdMap||(this._subIdMap=new G),this._subIdEvents||(this._subIdEvents={}),this._eventSubs||(this._eventSubs={}),this._eventSubsNum||(this._eventSubsNum={});var s=this._eventSubs[e];s?this._eventSubsNum[e]++:(s={},this._eventSubs[e]=s,this._eventSubsNum[e]=1);var r=this._subIdMap.addItem();s[r]={callback:t,scope:i||this},this._subIdEvents[r]=e;var n=this._events[e];return void 0!==n&&t.call(i||this,n),r}},{key:"off",value:function(e){if(null!=e&&this._subIdEvents){var t=this._subIdEvents[e];if(t){delete this._subIdEvents[e];var i=this._eventSubs[t];i&&(delete i[e],this._eventSubsNum[t]--),this._subIdMap.removeItem(e)}}}},{key:"once",value:function(e,t,i){var s=this,r=this.on(e,(function(e){s.off(r),t.call(i||this,e)}),i)}},{key:"hasSubs",value:function(e){return this._eventSubsNum&&this._eventSubsNum[e]>0}},{key:"log",value:function(e){e="[LOG]"+this._message(e),window.console.log(e),this.scene.fire("log",e)}},{key:"_message",value:function(e){return" ["+this.type+" "+re.inQuotes(this.id)+"]: "+e}},{key:"warn",value:function(e){e="[WARN]"+this._message(e),window.console.warn(e),this.scene.fire("warn",e)}},{key:"error",value:function(e){e="[ERROR]"+this._message(e),window.console.error(e),this.scene.fire("error",e)}},{key:"_attach",value:function(e){var t=e.name;if(t){var i=e.component,s=e.sceneDefault,r=e.sceneSingleton,n=e.type,o=e.on,a=!1!==e.recompiles;if(i&&(re.isNumeric(i)||re.isString(i))){var u=i;if(!(i=this.scene.components[u]))return void this.error("Component not found: "+re.inQuotes(u))}if(!i)if(!0===r){var h=this.scene.types[n];for(var l in h)if(h.hasOwnProperty){i=h[l];break}if(!i)return this.error("Scene has no default component for '"+t+"'"),null}else if(!0===s&&!(i=this.scene[t]))return this.error("Scene has no default component for '"+t+"'"),null;if(i){if(i.scene.id!==this.scene.id)return void this.error("Not in same scene: "+i.type+" "+re.inQuotes(i.id));if(n&&!i.isType(n))return void this.error("Expected a "+n+" type or subtype: "+i.type+" "+re.inQuotes(i.id))}this._attachments||(this._attachments={});var c,p,d,f=this._attached[t];if(f){if(i&&f.id===i.id)return;var m=this._attachments[f.id];for(p=0,d=(c=m.subs).length;p<d;p++)f.off(c[p]);delete this._attached[t],delete this._attachments[f.id];var v=m.params.onDetached;v&&(re.isFunction(v)?v(f):v.scope?v.callback.call(v.scope,f):v.callback(f)),m.managingLifecycle&&f.destroy()}if(i){var g={params:e,component:i,subs:[],managingLifecycle:!1};g.subs.push(i.once("destroyed",(function(){g.params.component=null,this._attach(g.params)}),this)),a&&g.subs.push(i.on("dirty",(function(){this.fire("dirty",this)}),this)),this._attached[t]=i,this._attachments[i.id]=g;var _,y,b,x,P=e.onAttached;if(P&&(re.isFunction(P)?P(i):P.scope?P.callback.call(P.scope,i):P.callback(i)),o)for(_ in o)if(o.hasOwnProperty(_)){if(y=o[_],re.isFunction(y)?(b=y,x=null):(b=y.callback,x=y.scope),!b)continue;g.subs.push(i.on(_,b,x))}}return a&&this.fire("dirty",this),this.fire(t,i),i}this.error("Component 'name' expected")}},{key:"_checkComponent",value:function(e,t){if(!t.isComponent){if(!re.isID(t))return void this.error("Expected a Component or ID");var i=t;if(!(t=this.scene.components[i]))return void this.error("Component not found: "+i)}if(e===t.type){if(t.scene.id===this.scene.id)return t;this.error("Not in same scene: "+t.type)}else this.error("Expected a "+e+" Component")}},{key:"_checkComponent2",value:function(e,t){if(!t.isComponent){if(!re.isID(t))return void this.error("Expected a Component or ID");var i=t;if(!(t=this.scene.components[i]))return void this.error("Component not found: "+i)}if(t.scene.id===this.scene.id){for(var s=0,r=e.length;s<r;s++)if(e[s]===t.type)return t;return this.error("Expected component types: "+e),null}this.error("Not in same scene: "+t.type)}},{key:"_own",value:function(e){var t=this;this._ownedComponents||(this._ownedComponents={}),this._ownedComponents[e.id]||(this._ownedComponents[e.id]=e),e.once("destroyed",(function(){delete t._ownedComponents[e.id]}),this)}},{key:"_needUpdate",value:function(e){this._updateScheduled||(this._updateScheduled=!0,0===e?this._doUpdate():pe.scheduleTask(this._doUpdate,this))}},{key:"_doUpdate",value:function(){this._updateScheduled&&(this._updateScheduled=!1,this._update&&this._update())}},{key:"_update",value:function(){}},{key:"clear",value:function(){if(this._ownedComponents)for(var e in this._ownedComponents){if(this._ownedComponents.hasOwnProperty(e))this._ownedComponents[e].destroy(),delete this._ownedComponents[e]}}},{key:"destroy",value:function(){if(!this.destroyed){var e,t,i,s,r,n;if(this.fire("destroyed",this.destroyed=!0),this._attachments)for(e in this._attachments)if(this._attachments.hasOwnProperty(e)){for(i=(t=this._attachments[e]).component,r=0,n=(s=t.subs).length;r<n;r++)i.off(s[r]);t.managingLifecycle&&i.destroy()}if(this._ownedComponents)for(e in this._ownedComponents)this._ownedComponents.hasOwnProperty(e)&&((i=this._ownedComponents[e]).destroy(),delete this._ownedComponents[e]);this.scene._removeComponent(this),this._attached={},this._attachments=null,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._events=null,this._eventCallDepth=0,this._ownedComponents=null,this._updateScheduled=!1}}}]),e}(),me=1,ve=4,ge=8,_e=16,ye=32,be=256,xe=512,Pe=1024,Te=2048,we=new Float32Array([0,0,0]),Me=new Uint16Array([0,0,0]),Ie=function(){function e(t,i,s,r,n,o){w(this,e),this._isObject=i,this.scene=t.scene,this.model=t,this.meshes=r,this._numTriangles=0;for(var a=0,u=this.meshes.length;a<u;a++){var h=this.meshes[a];h.parent=this,this._numTriangles+=h.numTriangles}this.id=s,this.originalSystemId=q.unglobalizeObjectId(t.id,s),this._flags=n,this._aabb=o,this._offsetAABB=q.AABB3(o),this._offset=q.vec3(),this._colorizeUpdated=!1,this._opacityUpdated=!1,this._culled=!1,this._culledVFC=!1,this._culledLOD=!1,this._isObject&&t.scene._registerObject(this)}return I(e,[{key:"isEntity",get:function(){return!0}},{key:"isModel",get:function(){return!1}},{key:"isObject",get:function(){return this._isObject}},{key:"aabb",get:function(){return this._offsetAABB}},{key:"numTriangles",get:function(){return this._numTriangles}},{key:"visible",get:function(){return this._getFlag(me)},set:function(e){if(!!(this._flags&me)!==e){this._flags=e?this._flags|me:this._flags&~me;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setVisible(this._flags);this._isObject&&this.model.scene._objectVisibilityUpdated(this),this.model.glRedraw()}}},{key:"highlighted",get:function(){return this._getFlag(xe)},set:function(e){if(!!(this._flags&xe)!==e){this._flags=e?this._flags|xe:this._flags&~xe;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setHighlighted(this._flags);this._isObject&&this.model.scene._objectHighlightedUpdated(this),this.model.glRedraw()}}},{key:"xrayed",get:function(){return this._getFlag(be)},set:function(e){if(!!(this._flags&be)!==e){this._flags=e?this._flags|be:this._flags&~be;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setXRayed(this._flags);this._isObject&&this.model.scene._objectXRayedUpdated(this),this.model.glRedraw()}}},{key:"selected",get:function(){return this._getFlag(Pe)},set:function(e){if(!!(this._flags&Pe)!==e){this._flags=e?this._flags|Pe:this._flags&~Pe;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setSelected(this._flags);this._isObject&&this.model.scene._objectSelectedUpdated(this),this.model.glRedraw()}}},{key:"edges",get:function(){return this._getFlag(Te)},set:function(e){if(!!(this._flags&Te)!==e){this._flags=e?this._flags|Te:this._flags&~Te;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setEdges(this._flags);this.model.glRedraw()}}},{key:"culledVFC",get:function(){return!!this._culledVFC},set:function(e){this._culledVFC=e,this.internalSetCulled()}},{key:"culledLOD",get:function(){return!!this._culledLOD},set:function(e){this._culledLOD=e,this.internalSetCulled()}},{key:"culled",get:function(){return!!this._culled},set:function(e){this._culled=e,this.internalSetCulled()}},{key:"internalSetCulled",value:function(){var e=!!this._culled||!!this._culledLOD||!!this._culledVFC;if(!!(this._flags&ve)!==e){this._flags=e?this._flags|ve:this._flags&~ve;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setCulled(this._flags);this.model.glRedraw()}}},{key:"clippable",get:function(){return this._getFlag(_e)},set:function(e){if(!!(this._flags&_e)!==e){this._flags=e?this._flags|_e:this._flags&~_e;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setClippable(this._flags);this.model.glRedraw()}}},{key:"collidable",get:function(){return this._getFlag(ye)},set:function(e){if(!!(this._flags&ye)!==e){this._flags=e?this._flags|ye:this._flags&~ye;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setCollidable(this._flags)}}},{key:"pickable",get:function(){return this._getFlag(ge)},set:function(e){if(!!(this._flags&ge)!==e){this._flags=e?this._flags|ge:this._flags&~ge;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setPickable(this._flags)}}},{key:"colorize",get:function(){if(0===this.meshes.length)return null;var e=this.meshes[0]._colorize;return we[0]=e[0]/255,we[1]=e[1]/255,we[2]=e[2]/255,we},set:function(e){if(e){Me[0]=Math.floor(255*e[0]),Me[1]=Math.floor(255*e[1]),Me[2]=Math.floor(255*e[2]);for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setColorize(Me)}else for(var s=0,r=this.meshes.length;s<r;s++)this.meshes[s]._setColorize(null);if(this._isObject){var n=!!e;this.scene._objectColorizeUpdated(this,n),this._colorizeUpdated=n}this.model.glRedraw()}},{key:"opacity",get:function(){return this.meshes.length>0?this.meshes[0]._colorize[3]/255:1},set:function(e){if(0!==this.meshes.length){var t=null!=e,i=this.meshes[0]._colorize[3],s=255;if(t){if(e<0?e=0:e>1&&(e=1),i===(s=Math.floor(255*e)))return}else if(i===(s=255))return;for(var r=0,n=this.meshes.length;r<n;r++)this.meshes[r]._setOpacity(s,this._flags);this._isObject&&(this.scene._objectOpacityUpdated(this,t),this._opacityUpdated=t),this.model.glRedraw()}}},{key:"offset",get:function(){return this._offset},set:function(e){e?(this._offset[0]=e[0],this._offset[1]=e[1],this._offset[2]=e[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setOffset(this._offset);this._offsetAABB[0]=this._aabb[0]+this._offset[0],this._offsetAABB[1]=this._aabb[1]+this._offset[1],this._offsetAABB[2]=this._aabb[2]+this._offset[2],this._offsetAABB[3]=this._aabb[3]+this._offset[0],this._offsetAABB[4]=this._aabb[4]+this._offset[1],this._offsetAABB[5]=this._aabb[5]+this._offset[2],this.scene._aabbDirty=!0,this.scene._objectOffsetUpdated(this,e),this.model._aabbDirty=!0,this.model.glRedraw()}},{key:"castsShadow",get:function(){return!1},set:function(e){}},{key:"receivesShadow",get:function(){return!1},set:function(e){}},{key:"saoEnabled",get:function(){return this.model.saoEnabled}},{key:"_getFlag",value:function(e){return!!(this._flags&e)}},{key:"_finalize",value:function(){var e=this.model.scene;this._isObject&&(this.visible&&e._objectVisibilityUpdated(this),this.highlighted&&e._objectHighlightedUpdated(this),this.xrayed&&e._objectXRayedUpdated(this),this.selected&&e._objectSelectedUpdated(this));for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._finalize(this._flags)}},{key:"_finalize2",value:function(){for(var e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._finalize2()}},{key:"_destroy",value:function(){var e=this.model.scene;this._isObject&&(e._deregisterObject(this),this.visible&&e._objectVisibilityUpdated(this,!1),this.xrayed&&e._objectXRayedUpdated(this),this.selected&&e._objectSelectedUpdated(this),this.highlighted&&e._objectHighlightedUpdated(this),this._opacityUpdated&&this.scene._objectColorizeUpdated(this,!1),this._opacityUpdated&&this.scene._objectOpacityUpdated(this,!1),this.scene._objectOffsetUpdated(this,!1));for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._destroy();e._aabbDirty=!0}}]),e}(),Ce=q.vec3(),De=function(){var e=new Float64Array(16),t=new Float64Array(4),i=new Float64Array(4);return function(s,r,n){return n=n||e,t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=1,q.transformVec4(s,t,i),q.setMat4Translation(s,i,n),n.slice()}}();function Ae(e,t,i){var s=Float32Array.from([e[0]])[0],r=e[0]-s,n=Float32Array.from([e[1]])[0],o=e[1]-n,a=Float32Array.from([e[2]])[0],u=e[2]-a;t[0]=s,t[1]=n,t[2]=a,i[0]=r,i[1]=o,i[2]=u}function ke(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3,r=q.getPositionsCenter(e,Ce),n=Math.round(r[0]/s)*s,o=Math.round(r[1]/s)*s,a=Math.round(r[2]/s)*s;i[0]=n,i[1]=o,i[2]=a;var u=0!==i[0]||0!==i[1]||0!==i[2];if(u)for(var h=0,l=e.length;h<l;h+=3)t[h+0]=e[h+0]-n,t[h+1]=e[h+1]-o,t[h+2]=e[h+2]-a;return u}function Ee(e,t,i,s){var r=q.dotVec3(t,i)+e,n=q.normalizeVec3(t,Ce);return q.mulVec3Scalar(n,-r,s),s}var Fe=q.vec4(),Re=q.vec4(),Se=function(e){g(i,fe);var t=y(i);function i(e,s){var r;return w(this,i),(r=t.call(this,e,s))._entity=null,r._visible=null,r._worldPos=q.vec3(),r._origin=q.vec3(),r._rtcPos=q.vec3(),r._viewPos=q.vec3(),r._canvasPos=q.vec2(),r._occludable=!1,r._onCameraViewMatrix=r.scene.camera.on("matrix",(function(){r._viewPosDirty=!0,r._needUpdate()})),r._onCameraProjMatrix=r.scene.camera.on("projMatrix",(function(){r._canvasPosDirty=!0,r._needUpdate()})),r._onEntityDestroyed=null,r._onEntityModelDestroyed=null,r._renderer.addMarker(x(r)),r.entity=s.entity,r.worldPos=s.worldPos,r.occludable=s.occludable,r}return I(i,[{key:"_update",value:function(){if(this._viewPosDirty&&(q.transformPoint3(this.scene.camera.viewMatrix,this._worldPos,this._viewPos),this._viewPosDirty=!1,this._canvasPosDirty=!0,this.fire("viewPos",this._viewPos)),this._canvasPosDirty){Fe.set(this._viewPos),Fe[3]=1,q.transformPoint4(this.scene.camera.projMatrix,Fe,Re);var e=this.scene.canvas.boundary;this._canvasPos[0]=Math.floor((1+Re[0]/Re[3])*e[2]/2),this._canvasPos[1]=Math.floor((1-Re[1]/Re[3])*e[3]/2),this._canvasPosDirty=!1,this.fire("canvasPos",this._canvasPos)}}},{key:"_setVisible",value:function(e){this._visible,this._visible=e,this.fire("visible",this._visible)}},{key:"entity",get:function(){return this._entity},set:function(e){var t=this;if(this._entity){if(this._entity===e)return;null!==this._onEntityDestroyed&&(this._entity.off(this._onEntityDestroyed),this._onEntityDestroyed=null),null!==this._onEntityModelDestroyed&&(this._entity.model.off(this._onEntityModelDestroyed),this._onEntityModelDestroyed=null)}this._entity=e,this._entity&&(this._entity instanceof Ie?this._onEntityModelDestroyed=this._entity.model.on("destroyed",(function(){t._entity=null,t._onEntityModelDestroyed=null})):this._onEntityDestroyed=this._entity.on("destroyed",(function(){t._entity=null,t._onEntityDestroyed=null}))),this.fire("entity",this._entity,!0)}},{key:"occludable",get:function(){return this._occludable},set:function(e){(e=!!e)!==this._occludable&&(this._occludable=e)}},{key:"worldPos",get:function(){return this._worldPos},set:function(e){this._worldPos.set(e||[0,0,0]),Ae(this._worldPos,this._origin,this._rtcPos),this._occludable&&this._renderer.markerWorldPosUpdated(this),this._viewPosDirty=!0,this.fire("worldPos",this._worldPos),this._needUpdate()}},{key:"origin",get:function(){return this._origin}},{key:"rtcPos",get:function(){return this._rtcPos}},{key:"viewPos",get:function(){return this._update(),this._viewPos}},{key:"canvasPos",get:function(){return this._update(),this._canvasPos}},{key:"visible",get:function(){return!!this._visible}},{key:"destroy",value:function(){this.fire("destroyed",!0),this.scene.camera.off(this._onCameraViewMatrix),this.scene.camera.off(this._onCameraProjMatrix),this._entity&&(null!==this._onEntityDestroyed&&this._entity.off(this._onEntityDestroyed),null!==this._onEntityModelDestroyed&&this._entity.model.off(this._onEntityModelDestroyed)),this._renderer.removeMarker(this),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),Oe=function(){function e(t){var i=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,e),this._color=s.color||"black",this._highlightClass="viewer-ruler-wire-highlighted",this._wire=document.createElement("div"),this._wire.className+=this._wire.className?" viewer-ruler-wire":"viewer-ruler-wire",this._wireClickable=document.createElement("div"),this._wireClickable.className+=this._wireClickable.className?" viewer-ruler-wire-clickable":"viewer-ruler-wire-clickable",this._thickness=s.thickness||1,this._thicknessClickable=s.thicknessClickable||6;var r=this._wire,n=r.style;n.border="solid "+this._thickness+"px "+this._color,n.position="absolute",n["z-index"]=void 0===s.zIndex?"2000001":s.zIndex,n.width="0px",n.height="0px",n.visibility="visible",n.top="0px",n.left="0px",n["-webkit-transform-origin"]="0 0",n["-moz-transform-origin"]="0 0",n["-ms-transform-origin"]="0 0",n["-o-transform-origin"]="0 0",n["transform-origin"]="0 0",n["-webkit-transform"]="rotate(0deg)",n["-moz-transform"]="rotate(0deg)",n["-ms-transform"]="rotate(0deg)",n["-o-transform"]="rotate(0deg)",n.transform="rotate(0deg)",n.opacity=1,n["pointer-events"]="none",s.onContextMenu,t.appendChild(r);var o=this._wireClickable,a=o.style;a.border="solid "+this._thicknessClickable+"px "+this._color,a.position="absolute",a["z-index"]=void 0===s.zIndex?"2000002":s.zIndex+1,a.width="0px",a.height="0px",a.visibility="visible",a.top="0px",a.left="0px",a["-webkit-transform-origin"]="0 0",a["-moz-transform-origin"]="0 0",a["-ms-transform-origin"]="0 0",a["-o-transform-origin"]="0 0",a["transform-origin"]="0 0",a["-webkit-transform"]="rotate(0deg)",a["-moz-transform"]="rotate(0deg)",a["-ms-transform"]="rotate(0deg)",a["-o-transform"]="rotate(0deg)",a.transform="rotate(0deg)",a.opacity=0,a["pointer-events"]="none",s.onContextMenu,t.appendChild(o),s.onMouseOver&&o.addEventListener("mouseover",(function(e){s.onMouseOver(e,i)})),s.onMouseLeave&&o.addEventListener("mouseleave",(function(e){s.onMouseLeave(e,i)})),s.onMouseWheel&&o.addEventListener("wheel",(function(e){s.onMouseWheel(e,i)})),s.onContextMenu&&o.addEventListener("contextmenu",(function(e){s.onContextMenu(e,i),e.preventDefault()})),this._x1=0,this._y1=0,this._x2=0,this._y2=0,this._update()}return I(e,[{key:"_visible",get:function(){return"visible"===this._wire.style.visibility}},{key:"_update",value:function(){var e=Math.abs(Math.sqrt((this._x1-this._x2)*(this._x1-this._x2)+(this._y1-this._y2)*(this._y1-this._y2))),t=180*Math.atan2(this._y2-this._y1,this._x2-this._x1)/Math.PI,i=this._wire.style;i.width=Math.round(e)+"px",i.left=Math.round(this._x1)+"px",i.top=Math.round(this._y1)+"px",i["-webkit-transform"]="rotate("+t+"deg)",i["-moz-transform"]="rotate("+t+"deg)",i["-ms-transform"]="rotate("+t+"deg)",i["-o-transform"]="rotate("+t+"deg)",i.transform="rotate("+t+"deg)";var s=this._wireClickable.style;s.width=Math.round(e)+"px",s.left=Math.round(this._x1)+"px",s.top=Math.round(this._y1)+"px",s["-webkit-transform"]="rotate("+t+"deg)",s["-moz-transform"]="rotate("+t+"deg)",s["-ms-transform"]="rotate("+t+"deg)",s["-o-transform"]="rotate("+t+"deg)",s.transform="rotate("+t+"deg)"}},{key:"setStartAndEnd",value:function(e,t,i,s){this._x1=e,this._y1=t,this._x2=i,this._y2=s,this._update()}},{key:"setColor",value:function(e){this._color=e||"black",this._wire.style.border="solid "+this._thickness+"px "+this._color}},{key:"setOpacity",value:function(e){this._wire.style.opacity=e}},{key:"setVisible",value:function(e){e=!!e,this._visible!==e&&(this._wire.style.visibility=e?"visible":"hidden")}},{key:"setClickable",value:function(e){this._wireClickable.style["pointer-events"]=e?"all":"none"}},{key:"setHighlighted",value:function(e){this._highlighted!==e&&(this._highlighted=!!e,this._highlighted?this._wire.classList.add(this._highlightClass):this._wire.classList.remove(this._highlightClass))}},{key:"destroy",value:function(e){this._wire.parentElement&&this._wire.parentElement.removeChild(this._wire),this._wireClickable.parentElement&&this._wireClickable.parentElement.removeChild(this._wireClickable)}}]),e}(),Be=function(){function e(t){var i=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,e),this._highlightClass="viewer-ruler-dot-highlighted",this._x=0,this._y=0,this._visible=!0,this._dot=document.createElement("div"),this._dot.className+=this._dot.className?" viewer-ruler-dot":"viewer-ruler-dot",this._dotClickable=document.createElement("div"),this._dotClickable.className+=this._dotClickable.className?" viewer-ruler-dot-clickable":"viewer-ruler-dot-clickable";var r=this._dot,n=r.style;n["border-radius"]="25px",n.border="solid 2px white",n.background="lightgreen",n.position="absolute",n["z-index"]=void 0===s.zIndex?"40000005":s.zIndex,n.width="8px",n.height="8px",n.visibility=!1!==s.visible?"visible":"hidden",n.top="0px",n.left="0px",n["box-shadow"]="0 2px 5px 0 #182A3D;",n.opacity=1,n["pointer-events"]="none",s.onContextMenu,t.appendChild(r);var o=this._dotClickable,a=o.style;a["border-radius"]="35px",a.border="solid 10px white",a.position="absolute",a["z-index"]=void 0===s.zIndex?"40000007":s.zIndex+1,a.width="8px",a.height="8px",a.visibility="visible",a.top="0px",a.left="0px",a.opacity=0,a["pointer-events"]="none",s.onContextMenu,t.appendChild(o),s.onMouseOver&&o.addEventListener("mouseover",(function(e){s.onMouseOver(e,i)})),s.onMouseLeave&&o.addEventListener("mouseleave",(function(e){s.onMouseLeave(e,i)})),s.onMouseWheel&&o.addEventListener("wheel",(function(e){s.onMouseWheel(e,i)})),s.onContextMenu&&o.addEventListener("contextmenu",(function(e){s.onContextMenu(e,i),e.preventDefault()})),this.setPos(s.x||0,s.y||0),this.setFillColor(s.fillColor),this.setBorderColor(s.borderColor)}return I(e,[{key:"setPos",value:function(e,t){this._x=e,this._y=t;var i=this._dot.style;i.left=Math.round(e)-4+"px",i.top=Math.round(t)-4+"px";var s=this._dotClickable.style;s.left=Math.round(e)-9+"px",s.top=Math.round(t)-9+"px"}},{key:"setFillColor",value:function(e){this._dot.style.background=e||"lightgreen"}},{key:"setBorderColor",value:function(e){this._dot.style.border="solid 2px"+(e||"black")}},{key:"setOpacity",value:function(e){this._dot.style.opacity=e}},{key:"setVisible",value:function(e){this._visible!==e&&(this._visible=!!e,this._dot.style.visibility=this._visible?"visible":"hidden")}},{key:"setClickable",value:function(e){this._dotClickable.style["pointer-events"]=e?"all":"none"}},{key:"setHighlighted",value:function(e){this._highlighted!==e&&(this._highlighted=!!e,this._highlighted?this._dot.classList.add(this._highlightClass):this._dot.classList.remove(this._highlightClass))}},{key:"destroy",value:function(){this.setVisible(!1),this._dot.parentElement&&this._dot.parentElement.removeChild(this._dot),this._dotClickable.parentElement&&this._dotClickable.parentElement.removeChild(this._dotClickable)}}]),e}(),Le=function(){function e(t){var i=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,e),this._highlightClass="viewer-ruler-label-highlighted",this._prefix=s.prefix||"",this._x=0,this._y=0,this._visible=!0,this._culled=!1,this._label=document.createElement("div"),this._label.className+=this._label.className?" viewer-ruler-label":"viewer-ruler-label";var r=this._label,n=r.style;n["border-radius"]="5px",n.color="white",n.padding="4px",n.border="solid 1px",n.background="lightgreen",n.position="absolute",n["z-index"]=void 0===s.zIndex?"5000005":s.zIndex,n.width="auto",n.height="auto",n.visibility="visible",n.top="0px",n.left="0px",n["pointer-events"]="all",n.opacity=1,s.onContextMenu,r.innerText="",t.appendChild(r),this.setPos(s.x||0,s.y||0),this.setFillColor(s.fillColor),this.setBorderColor(s.fillColor),this.setText(s.text),s.onMouseOver&&r.addEventListener("mouseover",(function(e){s.onMouseOver(e,i),e.preventDefault()})),s.onMouseLeave&&r.addEventListener("mouseleave",(function(e){s.onMouseLeave(e,i),e.preventDefault()})),s.onMouseWheel&&r.addEventListener("wheel",(function(e){s.onMouseWheel(e,i)})),s.onContextMenu&&r.addEventListener("contextmenu",(function(e){s.onContextMenu(e,i),e.preventDefault()}))}return I(e,[{key:"setPos",value:function(e,t){this._x=e,this._y=t;var i=this._label.style;i.left=Math.round(e)-20+"px",i.top=Math.round(t)-12+"px"}},{key:"setPosOnWire",value:function(e,t,i,s){var r=e+.5*(i-e),n=t+.5*(s-t),o=this._label.style;o.left=Math.round(r)-20+"px",o.top=Math.round(n)-12+"px"}},{key:"setPosBetweenWires",value:function(e,t,i,s,r,n){var o=(e+i+r)/3,a=(t+s+n)/3,u=this._label.style;u.left=Math.round(o)-20+"px",u.top=Math.round(a)-12+"px"}},{key:"setText",value:function(e){this._label.innerHTML=this._prefix+(e||"")}},{key:"setFillColor",value:function(e){this._fillColor=e||"lightgreen",this._label.style.background=this._fillColor}},{key:"setBorderColor",value:function(e){this._borderColor=e||"black",this._label.style.border="solid 1px "+this._borderColor}},{key:"setOpacity",value:function(e){this._label.style.opacity=e}},{key:"setVisible",value:function(e){this._visible!==e&&(this._visible=!!e,this._label.style.visibility=this._visible&&!this._culled?"visible":"hidden")}},{key:"setCulled",value:function(e){this._culled!==e&&(this._culled=!!e,this._label.style.visibility=this._visible&&!this._culled?"visible":"hidden")}},{key:"setHighlighted",value:function(e){this._highlighted!==e&&(this._highlighted=!!e,this._highlighted?this._label.classList.add(this._highlightClass):this._label.classList.remove(this._highlightClass))}},{key:"setClickable",value:function(e){this._label.style["pointer-events"]=e?"all":"none"}},{key:"destroy",value:function(){this._label.parentElement&&this._label.parentElement.removeChild(this._label)}}]),e}(),Ne=q.vec3(),je=q.vec3(),Ge=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(w(this,i),(s=t.call(this,e.viewer.scene,r)).plugin=e,s._container=r.container,!s._container)throw"config missing: container";s._color=r.color||e.defaultColor;var n=s.plugin.viewer.scene;s._originMarker=new Se(n,r.origin),s._cornerMarker=new Se(n,r.corner),s._targetMarker=new Se(n,r.target),s._originWorld=q.vec3(),s._cornerWorld=q.vec3(),s._targetWorld=q.vec3(),s._wp=new Float64Array(12),s._vp=new Float64Array(12),s._pp=new Float64Array(12),s._cp=new Int16Array(6);var o=r.onMouseOver?function(e){r.onMouseOver(e,x(s))}:null,a=r.onMouseLeave?function(e){r.onMouseLeave(e,x(s))}:null,u=r.onContextMenu?function(e){r.onContextMenu(e,x(s))}:null,h=function(e){s.plugin.viewer.scene.canvas.canvas.dispatchEvent(new WheelEvent("wheel",e))};return s._originDot=new Be(s._container,{fillColor:s._color,zIndex:void 0!==e.zIndex?e.zIndex+2:void 0,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._cornerDot=new Be(s._container,{fillColor:s._color,zIndex:void 0!==e.zIndex?e.zIndex+2:void 0,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._targetDot=new Be(s._container,{fillColor:s._color,zIndex:void 0!==e.zIndex?e.zIndex+2:void 0,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._originWire=new Oe(s._container,{color:s._color||"blue",thickness:1,zIndex:e.zIndex,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._targetWire=new Oe(s._container,{color:s._color||"red",thickness:1,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._angleLabel=new Le(s._container,{fillColor:s._color||"#00BBFF",prefix:"",text:"",zIndex:e.zIndex+2,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._wpDirty=!1,s._vpDirty=!1,s._cpDirty=!1,s._visible=!1,s._originVisible=!1,s._cornerVisible=!1,s._targetVisible=!1,s._originWireVisible=!1,s._targetWireVisible=!1,s._angleVisible=!1,s._labelsVisible=!1,s._clickable=!1,s._originMarker.on("worldPos",(function(e){s._originWorld.set(e||[0,0,0]),s._wpDirty=!0,s._needUpdate(0)})),s._cornerMarker.on("worldPos",(function(e){s._cornerWorld.set(e||[0,0,0]),s._wpDirty=!0,s._needUpdate(0)})),s._targetMarker.on("worldPos",(function(e){s._targetWorld.set(e||[0,0,0]),s._wpDirty=!0,s._needUpdate(0)})),s._onViewMatrix=n.camera.on("viewMatrix",(function(){s._vpDirty=!0,s._needUpdate(0)})),s._onProjMatrix=n.camera.on("projMatrix",(function(){s._cpDirty=!0,s._needUpdate()})),s._onCanvasBoundary=n.canvas.on("boundary",(function(){s._cpDirty=!0,s._needUpdate(0)})),s.approximate=r.approximate,s.visible=r.visible,s.originVisible=r.originVisible,s.cornerVisible=r.cornerVisible,s.targetVisible=r.targetVisible,s.originWireVisible=r.originWireVisible,s.targetWireVisible=r.targetWireVisible,s.angleVisible=r.angleVisible,s.labelsVisible=r.labelsVisible,s}return I(i,[{key:"_update",value:function(){if(this._visible){var e=this.plugin.viewer.scene;if(this._wpDirty&&(this._wp[0]=this._originWorld[0],this._wp[1]=this._originWorld[1],this._wp[2]=this._originWorld[2],this._wp[3]=1,this._wp[4]=this._cornerWorld[0],this._wp[5]=this._cornerWorld[1],this._wp[6]=this._cornerWorld[2],this._wp[7]=1,this._wp[8]=this._targetWorld[0],this._wp[9]=this._targetWorld[1],this._wp[10]=this._targetWorld[2],this._wp[11]=1,this._wpDirty=!1,this._vpDirty=!0),this._vpDirty&&(q.transformPositions4(e.camera.viewMatrix,this._wp,this._vp),this._vp[3]=1,this._vp[7]=1,this._vp[11]=1,this._vpDirty=!1,this._cpDirty=!0),this._cpDirty){var t=-.3,i=this._originMarker.viewPos[2],s=this._cornerMarker.viewPos[2],r=this._targetMarker.viewPos[2];if(i>t||s>t||r>t)return this._originDot.setVisible(!1),this._cornerDot.setVisible(!1),this._targetDot.setVisible(!1),this._originWire.setVisible(!1),this._targetWire.setVisible(!1),void this._angleLabel.setCulled(!0);q.transformPositions4(e.camera.project.matrix,this._vp,this._pp);for(var n=this._pp,o=this._cp,a=e.canvas.canvas.getBoundingClientRect(),u=this._container.getBoundingClientRect(),h=a.top-u.top,l=a.left-u.left,c=e.canvas.boundary,p=c[2],d=c[3],f=0,m=0,v=n.length;m<v;m+=4)o[f]=l+Math.floor((1+n[m+0]/n[m+3])*p/2),o[f+1]=h+Math.floor((1-n[m+1]/n[m+3])*d/2),f+=2;if(this._originDot.setPos(o[0],o[1]),this._cornerDot.setPos(o[2],o[3]),this._targetDot.setPos(o[4],o[5]),this._originWire.setStartAndEnd(o[0],o[1],o[2],o[3]),this._targetWire.setStartAndEnd(o[2],o[3],o[4],o[5]),this._angleLabel.setPosBetweenWires(o[0],o[1],o[2],o[3],o[4],o[5]),q.subVec3(this._originWorld,this._cornerWorld,Ne),q.subVec3(this._targetWorld,this._cornerWorld,je),!(0===Ne[0]&&0===Ne[1]&&0===Ne[2]||0===je[0]&&0===je[1]&&0===je[2])){var g=this._approximate?" ~ ":" = ";q.normalizeVec3(Ne),q.normalizeVec3(je);var _=Math.abs(q.angleVec3(Ne,je));this._angle=_/q.DEGTORAD,this._angleLabel.setText(g+this._angle.toFixed(2)+"°")}else this._angleLabel.setText("");this._originDot.setVisible(this._visible&&this._originVisible),this._cornerDot.setVisible(this._visible&&this._cornerVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._originWire.setVisible(this._visible&&this._originWireVisible),this._targetWire.setVisible(this._visible&&this._targetWireVisible),this._angleLabel.setCulled(!(this._visible&&this._angleVisible&&this.labelsVisible)),this._cpDirty=!1}}}},{key:"approximate",get:function(){return this._approximate},set:function(e){e=!1!==e,this._approximate!==e&&(this._approximate=e,this._cpDirty=!0,this._needUpdate(0))}},{key:"origin",get:function(){return this._originMarker}},{key:"corner",get:function(){return this._cornerMarker}},{key:"target",get:function(){return this._targetMarker}},{key:"angle",get:function(){return this._update(),this._angle}},{key:"color",get:function(){return this._color},set:function(e){this._originDot.setFillColor(e),this._cornerDot.setFillColor(e),this._targetDot.setFillColor(e),this._originWire.setColor(e||"blue"),this._targetWire.setColor(e||"red"),this._angleLabel.setFillColor(e||"#00BBFF"),this._color=e}},{key:"visible",get:function(){return this._visible},set:function(e){e=!1!==e,this._visible=e,this._originDot.setVisible(this._visible&&this._originVisible),this._cornerDot.setVisible(this._visible&&this._cornerVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._originWire.setVisible(this._visible&&this._originWireVisible),this._targetWire.setVisible(this._visible&&this._targetWireVisible),this._angleLabel.setVisible(this._visible&&this._angleVisible),this._cpDirty=!0,this._needUpdate()}},{key:"originVisible",get:function(){return this._originVisible},set:function(e){e=!1!==e,this._originVisible=e,this._originDot.setVisible(this._visible&&this._originVisible),this._cpDirty=!0,this._needUpdate()}},{key:"cornerVisible",get:function(){return this._cornerVisible},set:function(e){e=!1!==e,this._cornerVisible=e,this._cornerDot.setVisible(this._visible&&this._cornerVisible),this._cpDirty=!0,this._needUpdate()}},{key:"targetVisible",get:function(){return this._targetVisible},set:function(e){e=!1!==e,this._targetVisible=e,this._targetDot.setVisible(this._visible&&this._targetVisible),this._cpDirty=!0,this._needUpdate()}},{key:"originWireVisible",get:function(){return this._originWireVisible},set:function(e){e=!1!==e,this._originWireVisible=e,this._originWire.setVisible(this._visible&&this._originWireVisible),this._cpDirty=!0,this._needUpdate()}},{key:"targetWireVisible",get:function(){return this._targetWireVisible},set:function(e){e=!1!==e,this._targetWireVisible=e,this._targetWire.setVisible(this._visible&&this._targetWireVisible),this._cpDirty=!0,this._needUpdate()}},{key:"angleVisible",get:function(){return this._angleVisible},set:function(e){e=!1!==e,this._angleVisible=e,this._angleLabel.setVisible(this._visible&&this._angleVisible),this._cpDirty=!0,this._needUpdate()}},{key:"labelsVisible",get:function(){return this._labelsVisible},set:function(e){e=void 0!==e?Boolean(e):this.plugin.defaultLabelsVisible,this._labelsVisible=e;var t=this._visible&&this._labelsVisible;this._angleLabel.setVisible(t),this._cpDirty=!0,this._needUpdate()}},{key:"setHighlighted",value:function(e){this._originDot.setHighlighted(e),this._cornerDot.setHighlighted(e),this._targetDot.setHighlighted(e),this._originWire.setHighlighted(e),this._targetWire.setHighlighted(e),this._angleLabel.setHighlighted(e)}},{key:"clickable",get:function(){return this._clickable},set:function(e){e=!!e,this._clickable=e,this._originDot.setClickable(this._clickable),this._cornerDot.setClickable(this._clickable),this._targetDot.setClickable(this._clickable),this._originWire.setClickable(this._clickable),this._targetWire.setClickable(this._clickable),this._angleLabel.setClickable(this._clickable)}},{key:"destroy",value:function(){var e=this.plugin.viewer.scene;this._onViewMatrix&&e.camera.off(this._onViewMatrix),this._onProjMatrix&&e.camera.off(this._onProjMatrix),this._onCanvasBoundary&&e.canvas.off(this._onCanvasBoundary),this._originDot.destroy(),this._cornerDot.destroy(),this._targetDot.destroy(),this._originWire.destroy(),this._targetWire.destroy(),this._angleLabel.destroy(),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),He=function(e){g(i,fe);var t=y(i);function i(e){var s;return w(this,i),(s=t.call(this,e.viewer.scene)).plugin=e,s._active=!1,s._state=0,s._currentAngleMeasurement=null,s._onMouseHoverSurface=null,s._onHoverNothing=null,s._onMouseHoverOff=null,s._onPickedNothing=null,s._onPickedSurface=null,s._onInputMouseDown=null,s._onInputMouseUp=null,s._onCanvasTouchStart=null,s._onCanvasTouchEnd=null,s}return I(i,[{key:"active",get:function(){return this._active}},{key:"activate",value:function(){var e=this;if(!this._active){var t,i,s=this.plugin,r=this.scene,n=s.viewer.cameraControl,o=r.canvas.canvas,a=r.input,u=r.pickSurfacePrecisionEnabled,h=!1,l=null,c=q.vec3(),p=q.vec2(),d=q.vec2(),f=q.vec2();q.vec3(),this._onMouseHoverSurface=n.on("hoverSurface",(function(t){if(h=!0,l=t.entity,c.set(t.worldPos),p.set(t.canvasPos),e._currentAngleMeasurement)switch(e._state){case 1:e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.cornerVisible=!0,e._currentAngleMeasurement.angleVisible=!1,e._currentAngleMeasurement.corner.entity=t.entity,e._currentAngleMeasurement.corner.worldPos=t.worldPos,o.style.cursor="pointer";break;case 2:e._currentAngleMeasurement.targetWireVisible=!0,e._currentAngleMeasurement.targetVisible=!0,e._currentAngleMeasurement.angleVisible=!0,e._currentAngleMeasurement.target.entity=t.entity,e._currentAngleMeasurement.target.worldPos=t.worldPos,o.style.cursor="pointer"}})),this._onInputMouseDown=a.on("mousedown",(function(e){t=e[0],i=e[1]})),this._onInputMouseUp=a.on("mouseup",(function(s){if(!(s[0]>t+5||s[0]<t-5||s[1]>i+5||s[1]<i-5))switch(e._state){case 0:if(h){if(u){var n=r.pick({canvasPos:p,pickSurface:!0,pickSurfacePrecision:u});n&&n.worldPos&&worldPos.set(n.worldPos)}e._currentAngleMeasurement=e.plugin.createMeasurement({id:q.createUUID(),origin:{entity:l,worldPos:c},corner:{entity:l,worldPos:c},target:{entity:l,worldPos:c},approximate:!0}),e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.cornerVisible=!1,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.targetVisible=!1,e._currentAngleMeasurement.angleVisible=!1,e._state=1,e.fire("measurementStart",e._currentAngleMeasurement)}break;case 1:if(h){if(u){var o=r.pick({canvasPos:p,pickSurface:!0,pickSurfacePrecision:!0});o&&o.worldPos&&(e._currentAngleMeasurement.corner.worldPos=o.worldPos)}e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.targetVisible=!0,e._currentAngleMeasurement.angleVisible=!0,e._state=2}else e._currentAngleMeasurement&&(e._currentAngleMeasurement.destroy(),e._currentAngleMeasurement=null,e._state=0,e.fire("measurementCancel",e._currentAngleMeasurement));break;case 2:if(h){if(u){var a=r.pick({canvasPos:p,pickSurface:!0,pickSurfacePrecision:!0});a&&a.worldPos&&(e._currentAngleMeasurement.target.worldPos=a.worldPos,e._currentAngleMeasurement.approximate=!1)}e._currentAngleMeasurement.targetVisible=!0,e._currentAngleMeasurement.angleVisible=!0,e.fire("measurementEnd",e._currentAngleMeasurement),e._currentAngleMeasurement=null,e._state=0}else e._currentAngleMeasurement&&(e._currentAngleMeasurement.destroy(),e._currentAngleMeasurement=null,e._state=0,e.fire("measurementCancel",e._currentAngleMeasurement))}})),this._onHoverNothing=n.on("hoverOff",(function(t){if(h=!1,e._currentAngleMeasurement){switch(e._state){case 0:e._currentAngleMeasurement.originVisible=!1;break;case 1:e._currentAngleMeasurement.cornerVisible=!1,e._currentAngleMeasurement.originWireVisible=!1,e._currentAngleMeasurement.targetVisible=!1,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.angleVisible=!1;break;case 2:e._currentAngleMeasurement.targetVisible=!1,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.angleVisible=!1}o.style.cursor="default"}})),o.addEventListener("touchstart",this._onCanvasTouchStart=function(e){var t=e.touches,i=e.changedTouches;1===t.length&&1===i.length&&Ue(t[0],d)},{passive:!0}),o.addEventListener("touchend",this._onCanvasTouchEnd=function(t){var i=t.touches,s=t.changedTouches;if(0===i.length&&1===s.length){if(Ue(s[0],f),f[0]>d[0]+5||f[0]<d[0]-5||f[1]>d[1]+5||f[1]<d[1]-5)return;var n=r.pick({canvasPos:f,pickSurface:!0,pickSurfacePrecision:!1});if(n&&n.worldPos)switch(e._state){case 0:e._currentAngleMeasurement=e.plugin.createMeasurement({id:q.createUUID(),origin:{entity:n.entity,worldPos:n.worldPos},corner:{entity:n.entity,worldPos:n.worldPos},target:{entity:n.entity,worldPos:n.worldPos},approximate:!0}),e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.cornerVisible=!1,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.targetVisible=!1,e._currentAngleMeasurement.angleVisible=!1,e._currentAngleMeasurement.clickable=!1,e._state=1,e.fire("measurementStart",e._currentAngleMeasurement);break;case 1:e._currentAngleMeasurement.corner.worldPos=n.worldPos,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.targetVisible=!0,e._currentAngleMeasurement.angleVisible=!0,e._state=2;break;case 2:e._currentAngleMeasurement.target.worldPos=n.worldPos,e._currentAngleMeasurement.targetVisible=!0,e._currentAngleMeasurement.angleVisible=!0,e._currentAngleMeasurement.clickable=!0,e.fire("measurementEnd",e._currentAngleMeasurement),e._currentAngleMeasurement=null,e._state=0}else e._currentAngleMeasurement&&(e._currentAngleMeasurement.destroy(),e._currentAngleMeasurement=null,e._state=0,e.fire("measurementCancel",e._currentAngleMeasurement))}},{passive:!0}),this._active=!0}}},{key:"deactivate",value:function(){if(this._active){this.reset();var e=this.plugin.viewer.scene.input,t=this.plugin.viewer.cameraControl,i=this.plugin.viewer.scene.canvas.canvas;e.off(this._onInputMouseDown),e.off(this._onInputMouseUp),t.off(this._onMouseHoverSurface),t.off(this._onPickedSurface),t.off(this._onHoverNothing),t.off(this._onPickedNothing),i.removeEventListener("touchstart",this._onCanvasTouchStart),i.removeEventListener("touchend",this._onCanvasTouchEnd),this._currentAngleMeasurement=null,this._active=!1}}},{key:"reset",value:function(){this._active&&(this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null),this._state=0)}},{key:"destroy",value:function(){this.deactivate(),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),Ue=function(e,t){if(e){for(var i=e.target,s=0,r=0;i.offsetParent;)s+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-s,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t},Ve=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,"AngleMeasurements",e))._container=r.container||document.body,s._control=new He(x(s)),s._measurements={},s.defaultColor=void 0!==r.defaultColor?r.defaultColor:"#00BBFF",s.defaultLabelsVisible=!1!==r.defaultLabelsVisible,s.zIndex=r.zIndex||1e4,s._onMouseOver=function(e,t){s.fire("mouseOver",{plugin:x(s),angleMeasurement:t,measurement:t,event:e})},s._onMouseLeave=function(e,t){s.fire("mouseLeave",{plugin:x(s),angleMeasurement:t,measurement:t,event:e})},s._onContextMenu=function(e,t){s.fire("contextMenu",{plugin:x(s),angleMeasurement:t,measurement:t,event:e})},s}return I(i,[{key:"send",value:function(e,t){}},{key:"control",get:function(){return this._control}},{key:"measurements",get:function(){return this._measurements}},{key:"createMeasurement",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.viewer.scene.components[t.id]&&(this.error("Viewer scene component with this ID already exists: "+t.id),delete t.id);var i=t.origin,s=t.corner,r=t.target,n=new Ge(this,{id:t.id,plugin:this,container:this._container,origin:{entity:i.entity,worldPos:i.worldPos},corner:{entity:s.entity,worldPos:s.worldPos},target:{entity:r.entity,worldPos:r.worldPos},visible:t.visible,originVisible:!0,originWireVisible:!0,cornerVisible:!0,targetWireVisible:!0,targetVisible:!0,onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave,onContextMenu:this._onContextMenu});return this._measurements[n.id]=n,n.on("destroyed",(function(){delete e._measurements[n.id]})),this.fire("measurementCreated",n),n}},{key:"destroyMeasurement",value:function(e){var t=this._measurements[e];t?(t.destroy(),this.fire("measurementDestroyed",t)):this.log("AngleMeasurement not found: "+e)}},{key:"setLabelsShown",value:function(e){for(var t=0,i=Object.entries(this.measurements);t<i.length;t++){var s=p(i[t],2);s[0];s[1].labelShown=e}}},{key:"clear",value:function(){for(var e=Object.keys(this._measurements),t=0,i=e.length;t<i;t++)this.destroyMeasurement(e[t])}},{key:"destroy",value:function(){this.clear(),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),ze=function(e){g(i,Se);var t=y(i);function i(e,s){var r;if(w(this,i),(r=t.call(this,e,s)).plugin=s.plugin,r._container=s.container,!r._container)throw"config missing: container";if(!s.markerElement&&!s.markerHTML)throw"config missing: need either markerElement or markerHTML";if(!s.labelElement&&!s.labelHTML)throw"config missing: need either labelElement or labelHTML";return r._htmlDirty=!1,s.markerElement?(r._marker=s.markerElement,r._marker.addEventListener("click",r._onMouseClickedExternalMarker=function(){r.plugin.fire("markerClicked",x(r))}),r._marker.addEventListener("mouseenter",r._onMouseEnterExternalMarker=function(){r.plugin.fire("markerMouseEnter",x(r))}),r._marker.addEventListener("mouseleave",r._onMouseLeaveExternalMarker=function(){r.plugin.fire("markerMouseLeave",x(r))}),r._markerExternal=!0):(r._markerHTML=s.markerHTML,r._htmlDirty=!0,r._markerExternal=!1),s.labelElement?(r._label=s.labelElement,r._labelExternal=!0):(r._labelHTML=s.labelHTML,r._htmlDirty=!0,r._labelExternal=!1),r._markerShown=!!s.markerShown,r._labelShown=!!s.labelShown,r._values=s.values||{},r._layoutDirty=!0,r._visibilityDirty=!0,r._buildHTML(),r._onTick=r.scene.on("tick",(function(){r._htmlDirty&&(r._buildHTML(),r._htmlDirty=!1,r._layoutDirty=!0,r._visibilityDirty=!0),(r._layoutDirty||r._visibilityDirty)&&(r._markerShown||r._labelShown)&&(r._updatePosition(),r._layoutDirty=!1),r._visibilityDirty&&(r._marker.style.visibility=r.visible&&r._markerShown?"visible":"hidden",r._label.style.visibility=r.visible&&r._markerShown&&r._labelShown?"visible":"hidden",r._visibilityDirty=!1)})),r.on("canvasPos",(function(){r._layoutDirty=!0})),r.on("visible",(function(){r._visibilityDirty=!0})),r.setMarkerShown(!1!==s.markerShown),r.setLabelShown(s.labelShown),r.eye=s.eye?s.eye.slice():null,r.look=s.look?s.look.slice():null,r.up=s.up?s.up.slice():null,r.projection=s.projection,r}return I(i,[{key:"_buildHTML",value:function(){var e=this;if(!this._markerExternal){this._marker&&(this._container.removeChild(this._marker),this._marker=null);var t=this._markerHTML||"<p></p>";re.isArray(t)&&(t=t.join("")),t=this._renderTemplate(t);var i=document.createRange().createContextualFragment(t);this._marker=i.firstChild,this._container.appendChild(this._marker),this._marker.style.visibility=this._markerShown?"visible":"hidden",this._marker.addEventListener("click",(function(){e.plugin.fire("markerClicked",e)})),this._marker.addEventListener("mouseenter",(function(){e.plugin.fire("markerMouseEnter",e)})),this._marker.addEventListener("mouseleave",(function(){e.plugin.fire("markerMouseLeave",e)})),this._marker.addEventListener("wheel",(function(t){e.plugin.viewer.scene.canvas.canvas.dispatchEvent(new WheelEvent("wheel",t))}))}if(!this._labelExternal){this._label&&(this._container.removeChild(this._label),this._label=null);var s=this._labelHTML||"<p></p>";re.isArray(s)&&(s=s.join("")),s=this._renderTemplate(s);var r=document.createRange().createContextualFragment(s);this._label=r.firstChild,this._container.appendChild(this._label),this._label.style.visibility=this._markerShown&&this._labelShown?"visible":"hidden",this._label.addEventListener("wheel",(function(t){e.plugin.viewer.scene.canvas.canvas.dispatchEvent(new WheelEvent("wheel",t))}))}}},{key:"_updatePosition",value:function(){var e=this.scene.canvas.boundary,t=e[0],i=e[1],s=this.canvasPos;this._marker.style.left=Math.floor(t+s[0])-12+"px",this._marker.style.top=Math.floor(i+s[1])-12+"px",this._marker.style["z-index"]=90005+Math.floor(this._viewPos[2])+1;this._label.style.left=20+Math.floor(t+s[0]+20)+"px",this._label.style.top=Math.floor(i+s[1]+-17)+"px",this._label.style["z-index"]=90005+Math.floor(this._viewPos[2])+1}},{key:"_renderTemplate",value:function(e){for(var t in this._values)if(this._values.hasOwnProperty(t)){var i=this._values[t];e=e.replace(new RegExp("{{"+t+"}}","g"),i)}return e}},{key:"setMarkerShown",value:function(e){e=!!e,this._markerShown!==e&&(this._markerShown=e,this._visibilityDirty=!0)}},{key:"getMarkerShown",value:function(){return this._markerShown}},{key:"setLabelShown",value:function(e){e=!!e,this._labelShown!==e&&(this._labelShown=e,this._visibilityDirty=!0)}},{key:"getLabelShown",value:function(){return this._labelShown}},{key:"setField",value:function(e,t){this._values[e]=t||"",this._htmlDirty=!0}},{key:"getField",value:function(e){return this._values[e]}},{key:"setValues",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];this.setField(t,i)}}},{key:"getValues",value:function(){return this._values}},{key:"destroy",value:function(){this._marker&&(this._markerExternal?(this._marker.removeEventListener("click",this._onMouseClickedExternalMarker),this._marker.removeEventListener("mouseenter",this._onMouseEnterExternalMarker),this._marker.removeEventListener("mouseleave",this._onMouseLeaveExternalMarker),this._marker=null):this._marker.parentNode.removeChild(this._marker)),this._label&&(this._labelExternal||this._label.parentNode.removeChild(this._label),this._label=null),this.scene.off(this._onTick),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),We=q.vec3(),Xe=q.vec3(),Ye=q.vec3(),Ke=function(e){g(i,X);var t=y(i);function i(e,s){var r;return w(this,i),(r=t.call(this,"Annotations",e))._labelHTML=s.labelHTML||"<div></div>",r._markerHTML=s.markerHTML||"<div></div>",r._container=s.container||document.body,r._values=s.values||{},r.annotations={},r.surfaceOffset=s.surfaceOffset,r}return I(i,[{key:"send",value:function(e,t){if("clearAnnotations"===e)this.clear()}},{key:"surfaceOffset",get:function(){return this._surfaceOffset},set:function(e){null==e&&(e=.3),this._surfaceOffset=e}},{key:"createAnnotation",value:function(e){var t,i,s=this;if(this.viewer.scene.components[e.id]&&(this.error("Viewer component with this ID already exists: "+e.id),delete e.id),e.pickResult=e.pickResult||e.pickRecord,e.pickResult){var r=e.pickResult;if(r.worldPos&&r.worldNormal){var n=q.normalizeVec3(r.worldNormal,We),o=q.mulVec3Scalar(n,this._surfaceOffset,Xe);t=q.addVec3(r.worldPos,o,Ye),i=r.entity}else this.error("Param 'pickResult' does not have both worldPos and worldNormal")}else t=e.worldPos,i=e.entity;var a=null;e.markerElementId&&((a=document.getElementById(e.markerElementId))||this.error("Can't find DOM element for 'markerElementId' value '"+e.markerElementId+"' - defaulting to internally-generated empty DIV"));var u=null;e.labelElementId&&((u=document.getElementById(e.labelElementId))||this.error("Can't find DOM element for 'labelElementId' value '"+e.labelElementId+"' - defaulting to internally-generated empty DIV"));var h=new ze(this.viewer.scene,{id:e.id,plugin:this,entity:i,worldPos:t,container:this._container,markerElement:a,labelElement:u,markerHTML:e.markerHTML||this._markerHTML,labelHTML:e.labelHTML||this._labelHTML,occludable:e.occludable,values:re.apply(e.values,re.apply(this._values,{})),markerShown:e.markerShown,labelShown:e.labelShown,eye:e.eye,look:e.look,up:e.up,projection:e.projection,visible:!1!==e.visible});return this.annotations[h.id]=h,h.on("destroyed",(function(){delete s.annotations[h.id],s.fire("annotationDestroyed",h.id)})),this.fire("annotationCreated",h.id),h}},{key:"destroyAnnotation",value:function(e){var t=this.annotations[e];t?t.destroy():this.log("Annotation not found: "+e)}},{key:"clear",value:function(){for(var e=Object.keys(this.annotations),t=0,i=e.length;t<i;t++)this.destroyAnnotation(e[t])}},{key:"destroy",value:function(){this.clear(),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),Je=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._canvas=r.canvas,s._element=null,s._isCustom=!1,r.elementId&&(s._element=document.getElementById(r.elementId),s._element?s._adjustPosition():s.error("Can't find given Spinner HTML element: '"+r.elementId+"' - will automatically create default element")),s._element||s._createDefaultSpinner(),s.processes=0,s}return I(i,[{key:"type",get:function(){return"Spinner"}},{key:"_createDefaultSpinner",value:function(){this._injectDefaultCSS();var e=document.createElement("div"),t=e.style;t["z-index"]="9000",t.position="absolute",e.innerHTML='<div class="sk-fading-circle">                <div class="sk-circle1 sk-circle"></div>                <div class="sk-circle2 sk-circle"></div>                <div class="sk-circle3 sk-circle"></div>                <div class="sk-circle4 sk-circle"></div>                <div class="sk-circle5 sk-circle"></div>                <div class="sk-circle6 sk-circle"></div>                <div class="sk-circle7 sk-circle"></div>                <div class="sk-circle8 sk-circle"></div>                <div class="sk-circle9 sk-circle"></div>                <div class="sk-circle10 sk-circle"></div>                <div class="sk-circle11 sk-circle"></div>                <div class="sk-circle12 sk-circle"></div>                </div>',this._canvas.parentElement.appendChild(e),this._element=e,this._isCustom=!1,this._adjustPosition()}},{key:"_injectDefaultCSS",value:function(){var e="xeokit-spinner-css";if(!document.getElementById(e)){var t=document.createElement("style");t.innerHTML=".sk-fading-circle {        background: transparent;        margin: 20px auto;        width: 50px;        height:50px;        position: relative;        }        .sk-fading-circle .sk-circle {        width: 120%;        height: 120%;        position: absolute;        left: 0;        top: 0;        }        .sk-fading-circle .sk-circle:before {        content: '';        display: block;        margin: 0 auto;        width: 15%;        height: 15%;        background-color: #ff8800;        border-radius: 100%;        -webkit-animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;        animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;        }        .sk-fading-circle .sk-circle2 {        -webkit-transform: rotate(30deg);        -ms-transform: rotate(30deg);        transform: rotate(30deg);    }    .sk-fading-circle .sk-circle3 {        -webkit-transform: rotate(60deg);        -ms-transform: rotate(60deg);        transform: rotate(60deg);    }    .sk-fading-circle .sk-circle4 {        -webkit-transform: rotate(90deg);        -ms-transform: rotate(90deg);        transform: rotate(90deg);    }    .sk-fading-circle .sk-circle5 {        -webkit-transform: rotate(120deg);        -ms-transform: rotate(120deg);        transform: rotate(120deg);    }    .sk-fading-circle .sk-circle6 {        -webkit-transform: rotate(150deg);        -ms-transform: rotate(150deg);        transform: rotate(150deg);    }    .sk-fading-circle .sk-circle7 {        -webkit-transform: rotate(180deg);        -ms-transform: rotate(180deg);        transform: rotate(180deg);    }    .sk-fading-circle .sk-circle8 {        -webkit-transform: rotate(210deg);        -ms-transform: rotate(210deg);        transform: rotate(210deg);    }    .sk-fading-circle .sk-circle9 {        -webkit-transform: rotate(240deg);        -ms-transform: rotate(240deg);        transform: rotate(240deg);    }    .sk-fading-circle .sk-circle10 {        -webkit-transform: rotate(270deg);        -ms-transform: rotate(270deg);        transform: rotate(270deg);    }    .sk-fading-circle .sk-circle11 {        -webkit-transform: rotate(300deg);        -ms-transform: rotate(300deg);        transform: rotate(300deg);    }    .sk-fading-circle .sk-circle12 {        -webkit-transform: rotate(330deg);        -ms-transform: rotate(330deg);        transform: rotate(330deg);    }    .sk-fading-circle .sk-circle2:before {        -webkit-animation-delay: -1.1s;        animation-delay: -1.1s;    }    .sk-fading-circle .sk-circle3:before {        -webkit-animation-delay: -1s;        animation-delay: -1s;    }    .sk-fading-circle .sk-circle4:before {        -webkit-animation-delay: -0.9s;        animation-delay: -0.9s;    }    .sk-fading-circle .sk-circle5:before {        -webkit-animation-delay: -0.8s;        animation-delay: -0.8s;    }    .sk-fading-circle .sk-circle6:before {        -webkit-animation-delay: -0.7s;        animation-delay: -0.7s;    }    .sk-fading-circle .sk-circle7:before {        -webkit-animation-delay: -0.6s;        animation-delay: -0.6s;    }    .sk-fading-circle .sk-circle8:before {        -webkit-animation-delay: -0.5s;        animation-delay: -0.5s;    }    .sk-fading-circle .sk-circle9:before {        -webkit-animation-delay: -0.4s;        animation-delay: -0.4s;    }    .sk-fading-circle .sk-circle10:before {        -webkit-animation-delay: -0.3s;        animation-delay: -0.3s;    }    .sk-fading-circle .sk-circle11:before {        -webkit-animation-delay: -0.2s;        animation-delay: -0.2s;    }    .sk-fading-circle .sk-circle12:before {        -webkit-animation-delay: -0.1s;        animation-delay: -0.1s;    }    @-webkit-keyframes sk-circleFadeDelay {        0%, 39%, 100% { opacity: 0; }        40% { opacity: 1; }    }    @keyframes sk-circleFadeDelay {        0%, 39%, 100% { opacity: 0; }        40% { opacity: 1; }    }",t.id=e,document.body.appendChild(t)}}},{key:"_adjustPosition",value:function(){if(!this._isCustom){var e=this._canvas,t=this._element,i=t.style;i.left=e.offsetLeft+.5*e.clientWidth-.5*t.clientWidth+"px",i.top=e.offsetTop+.5*e.clientHeight-.5*t.clientHeight+"px"}}},{key:"processes",get:function(){return this._processes},set:function(e){if(e=e||0,this._processes!==e&&!(e<0)){var t=this._processes;this._processes=e;var i=this._element;i&&(i.style.visibility=this._processes>0?"visible":"hidden"),this.fire("processes",this._processes),0===this._processes&&this._processes!==t&&this.fire("zeroProcesses",this._processes)}}},{key:"_destroy",value:function(){this._element&&!this._isCustom&&(this._element.parentNode.removeChild(this._element),this._element=null);var e=document.getElementById("xeokit-spinner-css");e&&e.parentNode.removeChild(e)}}]),i}(),Ze={WEBGL:!1,SUPPORTED_EXTENSIONS:{}},Qe=document.createElement("canvas");if(Qe){var qe=Qe.getContext("webgl",{antialias:!0})||Qe.getContext("experimental-webgl",{antialias:!0});Ze.WEBGL=!!qe,Ze.WEBGL&&(Ze.ANTIALIAS=qe.getContextAttributes().antialias,qe.getShaderPrecisionFormat?qe.getShaderPrecisionFormat(qe.FRAGMENT_SHADER,qe.HIGH_FLOAT).precision>0?Ze.FS_MAX_FLOAT_PRECISION="highp":qe.getShaderPrecisionFormat(qe.FRAGMENT_SHADER,qe.MEDIUM_FLOAT).precision>0?Ze.FS_MAX_FLOAT_PRECISION="mediump":Ze.FS_MAX_FLOAT_PRECISION="lowp":Ze.FS_MAX_FLOAT_PRECISION="mediump",Ze.DEPTH_BUFFER_BITS=qe.getParameter(qe.DEPTH_BITS),Ze.MAX_TEXTURE_SIZE=qe.getParameter(qe.MAX_TEXTURE_SIZE),Ze.MAX_CUBE_MAP_SIZE=qe.getParameter(qe.MAX_CUBE_MAP_TEXTURE_SIZE),Ze.MAX_RENDERBUFFER_SIZE=qe.getParameter(qe.MAX_RENDERBUFFER_SIZE),Ze.MAX_TEXTURE_UNITS=qe.getParameter(qe.MAX_COMBINED_TEXTURE_IMAGE_UNITS),Ze.MAX_TEXTURE_IMAGE_UNITS=qe.getParameter(qe.MAX_TEXTURE_IMAGE_UNITS),Ze.MAX_VERTEX_ATTRIBS=qe.getParameter(qe.MAX_VERTEX_ATTRIBS),Ze.MAX_VERTEX_UNIFORM_VECTORS=qe.getParameter(qe.MAX_VERTEX_UNIFORM_VECTORS),Ze.MAX_FRAGMENT_UNIFORM_VECTORS=qe.getParameter(qe.MAX_FRAGMENT_UNIFORM_VECTORS),Ze.MAX_VARYING_VECTORS=qe.getParameter(qe.MAX_VARYING_VECTORS),qe.getSupportedExtensions().forEach((function(e){Ze.SUPPORTED_EXTENSIONS[e]=!0})))}var $e=["webgl2","experimental-webgl","webkit-3d","moz-webgl","moz-glweb20"],et=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,i),(s=t.call(this,e,r))._backgroundColor=q.vec3([r.backgroundColor?r.backgroundColor[0]:1,r.backgroundColor?r.backgroundColor[1]:1,r.backgroundColor?r.backgroundColor[2]:1]),s._backgroundColorFromAmbientLight=!!r.backgroundColorFromAmbientLight,s.canvas=r.canvas,s.gl=null,s.webgl2=!1,s.transparent=!!r.transparent,s.optimizeResizeDetection=!0,s.contextAttr=r.contextAttr||{},s.contextAttr.alpha=s.transparent,s.contextAttr.preserveDrawingBuffer=!!s.contextAttr.preserveDrawingBuffer,s.contextAttr.stencil=!1,s.contextAttr.premultipliedAlpha=!!s.contextAttr.premultipliedAlpha,s.contextAttr.antialias=!1!==s.contextAttr.antialias,s.resolutionScale=r.resolutionScale,s.canvas.width=Math.round(s.canvas.clientWidth*s._resolutionScale),s.canvas.height=Math.round(s.canvas.clientHeight*s._resolutionScale),s.boundary=[s.canvas.offsetLeft,s.canvas.offsetTop,s.canvas.clientWidth,s.canvas.clientHeight],s._initWebGL(r);var n=x(s);s.canvas.addEventListener("webglcontextlost",s._webglcontextlostListener=function(e){console.time("webglcontextrestored"),n.scene._webglContextLost(),n.fire("webglcontextlost"),e.preventDefault()},!1),s.canvas.addEventListener("webglcontextrestored",s._webglcontextrestoredListener=function(e){n._initWebGL(),n.gl&&(n.scene._webglContextRestored(n.gl),n.fire("webglcontextrestored",n.gl),e.preventDefault()),console.timeEnd("webglcontextrestored")},!1);var o=null,a=null,u=null,h=null,l=null,c=null,p=null,d=null,f=0;return s._tick=s.scene.on("tick",(function(){if(f++,n._canvasSizeChanged=!1,!(n.optimizeResizeDetection&&f<10)){f=0;var e=s.canvas,t=s._resolutionScale!==o,i=window.innerWidth!==a||window.innerHeight!==u,r=e.clientWidth!==h||e.clientHeight!==l,m=e.offsetLeft!==c||e.offsetTop!==p,v=e.parentElement;if(t||i||r||m||v!==d){if(n._canvasSizeChanged=!0,s._spinner._adjustPosition(),t||r||m){var g=e.clientWidth,_=e.clientHeight;if(t||r){var y,b=0;for(var x in pe.scenes)pe.scenes.hasOwnProperty(x)&&(y=pe.scenes[x],b+=Math.round(y.canvas.canvas.clientWidth*s._resolutionScale*(y.canvas.canvas.clientHeight*s._resolutionScale)));ee.memory.pixels=b,e.width=Math.round(e.clientWidth*s._resolutionScale),e.height=Math.round(e.clientHeight*s._resolutionScale)}var P=s.boundary;P[0]=e.offsetLeft,P[1]=e.offsetTop,P[2]=g,P[3]=_,t||s.fire("boundary",P),h=g,l=_}t&&(o=s._resolutionScale),i&&(a=window.innerWidth,u=window.innerHeight),m&&(c=e.offsetLeft,p=e.offsetTop),d=v}}})),s._spinner=new Je(s.scene,{canvas:s.canvas,elementId:r.spinnerElementId}),s}return I(i,[{key:"type",get:function(){return"Canvas"}},{key:"backgroundColorFromAmbientLight",get:function(){return this._backgroundColorFromAmbientLight},set:function(e){this._backgroundColorFromAmbientLight=!1!==e,this.glRedraw()}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(e){e?(this._backgroundColor[0]=e[0],this._backgroundColor[1]=e[1],this._backgroundColor[2]=e[2]):(this._backgroundColor[0]=1,this._backgroundColor[1]=1,this._backgroundColor[2]=1),this.glRedraw()}},{key:"resolutionScale",get:function(){return this._resolutionScale},set:function(e){if((e=e||1)!==this._resolutionScale){this._resolutionScale=e;var t=this.canvas;t.width=Math.round(t.clientWidth*this._resolutionScale),t.height=Math.round(t.clientHeight*this._resolutionScale),this.glRedraw()}}},{key:"spinner",get:function(){return this._spinner}},{key:"_createCanvas",value:function(){var e="xeokit-canvas-"+q.createUUID(),t=document.getElementsByTagName("body")[0],i=document.createElement("div"),s=i.style;s.height="100%",s.width="100%",s.padding="0",s.margin="0",s.background="rgba(0,0,0,0);",s.float="left",s.left="0",s.top="0",s.position="absolute",s.opacity="1.0",s["z-index"]="-10000",i.innerHTML+='<canvas id="'+e+'" style="width: 100%; height: 100%; float: left; margin: 0; padding: 0;"></canvas>',t.appendChild(i),this.canvas=document.getElementById(e)}},{key:"_getElementXY",value:function(e){for(var t=0,i=0;e;)t+=e.offsetLeft-e.scrollLeft,i+=e.offsetTop-e.scrollTop,e=e.offsetParent;return{x:t,y:i}}},{key:"_initWebGL",value:function(){if(!this.gl)for(var e=0;!this.gl&&e<$e.length;e++)try{this.gl=this.canvas.getContext($e[e],this.contextAttr)}catch(e){}this.gl||(this.error("Failed to get a WebGL context"),this.fire("webglContextFailed",!0,!0));var t=this.gl,i="__",s=t.activeTexture;t.activeTexture=function(e){i!==e&&(i=e,s.call(this,e))};var r={},n=t.bindTexture;t.bindTexture=function(e,t){r[i]!==t&&(r[i]=t,n.call(this,e,t))},this.gl&&this.webgl2&&(this.gl.hint(this.gl.FRAGMENT_SHADER_DERIVATIVE_HINT,this.gl.FASTEST),this.gl,WebGL2RenderingContext)}},{key:"getSnapshot",value:function(e){throw"Canvas#getSnapshot() has been replaced by Viewer#getSnapshot() - use that method instead."}},{key:"readPixels",value:function(e,t,i,s){return this.scene._renderer.readPixels(e,t,i,s)}},{key:"loseWebGLContext",value:function(){this.canvas.loseContext&&this.canvas.loseContext()}},{key:"destroy",value:function(){this.scene.off(this._tick),this._spinner._destroy(),this.canvas.removeEventListener("webglcontextlost",this._webglcontextlostListener),this.canvas.removeEventListener("webglcontextrestored",this._webglcontextrestoredListener),this.gl=null,m(P(i.prototype),"destroy",this).call(this)}}]),i}(),tt=function(){function e(t){w(this,e),this._scene=t,this._matPool=[],this._matPoolNextFreeIndex=0,this._rtcViewMats={},this._rtcPickViewMats={},this.reset()}return I(e,[{key:"reset",value:function(){this._matPoolNextFreeIndex=0,this._rtcViewMats={},this._rtcPickViewMats={},this.gl=this._scene.canvas.gl,this.lastProgramId=null,this.pbrEnabled=!1,this.colorTextureEnabled=!1,this.withSAO=!1,this.backfaces=!1,this.frontface=!0,this.textureUnit=0,this.drawElements=0,this.drawArrays=0,this.useProgram=0,this.bindTexture=0,this.bindArray=0,this.pass=0,this.shadowViewMatrix=null,this.shadowProjMatrix=null,this.pickViewMatrix=null,this.pickProjMatrix=null,this.pickZNear=.01,this.pickZFar=5e3,this.pickInvisible=!1,this.lineWidth=1}},{key:"getRTCViewMatrix",value:function(e,t){var i=this._rtcViewMats[e];return i||(i=this._getNewMat(),De(this._scene.camera.viewMatrix,t,i),this._rtcViewMats[e]=i),i}},{key:"getRTCPickViewMatrix",value:function(e,t){var i=this._rtcPickViewMats[e];if(!i){i=this._getNewMat();var s=this.pickViewMatrix||this._scene.camera.viewMatrix;De(s,t,i),this._rtcPickViewMats[e]=i}return i}},{key:"_getNewMat",value:function(){var e=this._matPool[this._matPoolNextFreeIndex];return e||(e=q.mat4(),this._matPool[this._matPoolNextFreeIndex]=e),this._matPoolNextFreeIndex++,e}}]),e}(),it=function(){function e(){w(this,e),this.entity=null,this.primitive=null,this.primIndex=-1,this.pickSurfacePrecision=!1,this.touchInput=!1,this._canvasPos=new Int16Array([0,0]),this._origin=new Float64Array([0,0,0]),this._direction=new Float64Array([0,0,0]),this._indices=new Int32Array(3),this._localPos=new Float64Array([0,0,0]),this._worldPos=new Float64Array([0,0,0]),this._viewPos=new Float64Array([0,0,0]),this._bary=new Float64Array([0,0,0]),this._worldNormal=new Float64Array([0,0,0]),this._uv=new Float64Array([0,0]),this.reset()}return I(e,[{key:"canvasPos",get:function(){return this._gotCanvasPos?this._canvasPos:null},set:function(e){e?(this._canvasPos[0]=e[0],this._canvasPos[1]=e[1],this._gotCanvasPos=!0):this._gotCanvasPos=!1}},{key:"origin",get:function(){return this._gotOrigin?this._origin:null},set:function(e){e?(this._origin[0]=e[0],this._origin[1]=e[1],this._origin[2]=e[2],this._gotOrigin=!0):this._gotOrigin=!1}},{key:"direction",get:function(){return this._gotDirection?this._direction:null},set:function(e){e?(this._direction[0]=e[0],this._direction[1]=e[1],this._direction[2]=e[2],this._gotDirection=!0):this._gotDirection=!1}},{key:"indices",get:function(){return this.entity&&this._gotIndices?this._indices:null},set:function(e){e?(this._indices[0]=e[0],this._indices[1]=e[1],this._indices[2]=e[2],this._gotIndices=!0):this._gotIndices=!1}},{key:"localPos",get:function(){return this.entity&&this._gotLocalPos?this._localPos:null},set:function(e){e?(this._localPos[0]=e[0],this._localPos[1]=e[1],this._localPos[2]=e[2],this._gotLocalPos=!0):this._gotLocalPos=!1}},{key:"worldPos",get:function(){return this.entity&&this._gotWorldPos?this._worldPos:null},set:function(e){e?(this._worldPos[0]=e[0],this._worldPos[1]=e[1],this._worldPos[2]=e[2],this._gotWorldPos=!0):this._gotWorldPos=!1}},{key:"viewPos",get:function(){return this.entity&&this._gotViewPos?this._viewPos:null},set:function(e){e?(this._viewPos[0]=e[0],this._viewPos[1]=e[1],this._viewPos[2]=e[2],this._gotViewPos=!0):this._gotViewPos=!1}},{key:"bary",get:function(){return this.entity&&this._gotBary?this._bary:null},set:function(e){e?(this._bary[0]=e[0],this._bary[1]=e[1],this._bary[2]=e[2],this._gotBary=!0):this._gotBary=!1}},{key:"worldNormal",get:function(){return this.entity&&this._gotWorldNormal?this._worldNormal:null},set:function(e){e?(this._worldNormal[0]=e[0],this._worldNormal[1]=e[1],this._worldNormal[2]=e[2],this._gotWorldNormal=!0):this._gotWorldNormal=!1}},{key:"uv",get:function(){return this.entity&&this._gotUV?this._uv:null},set:function(e){e?(this._uv[0]=e[0],this._uv[1]=e[1],this._gotUV=!0):this._gotUV=!1}},{key:"reset",value:function(){this.entity=null,this.primIndex=-1,this.primitive=null,this.pickSurfacePrecision=!1,this._gotCanvasPos=!1,this._gotOrigin=!1,this._gotDirection=!1,this._gotIndices=!1,this._gotLocalPos=!1,this._gotWorldPos=!1,this._gotViewPos=!1,this._gotBary=!1,this._gotWorldNormal=!1,this._gotUV=!1,this.touchInput=!1}}]),e}(),st=function(){function e(t,i,s){if(w(this,e),this.allocated=!1,this.compiled=!1,this.handle=t.createShader(i),this.handle){if(this.allocated=!0,t.shaderSource(this.handle,s),t.compileShader(this.handle),this.compiled=t.getShaderParameter(this.handle,t.COMPILE_STATUS),!this.compiled&&!t.isContextLost()){for(var r=s.split("\n"),n=[],o=0;o<r.length;o++)n.push(o+1+": "+r[o]+"\n");this.errors=[],this.errors.push(""),this.errors.push(t.getShaderInfoLog(this.handle)),this.errors=this.errors.concat(n.join(""))}}else this.errors=["Failed to allocate"]}return I(e,[{key:"destroy",value:function(){}}]),e}(),rt=I((function e(t,i){w(this,e),this.bindTexture=function(e,s){return!!e.bind(s)&&(t.uniform1i(i,s),!0)}})),nt=function(){function e(t,i){w(this,e),this._gl=t,this.location=i}return I(e,[{key:"bindArrayBuffer",value:function(e){e&&(e.bind(),this._gl.enableVertexAttribArray(this.location),this._gl.vertexAttribPointer(this.location,e.itemSize,e.itemType,e.normalized,e.stride,e.offset))}}]),e}(),ot=new G({});function at(e){for(var t,i,s=[],r=0,n=e.length;r<n;r++)(i=(t=e[r]).indexOf("/"))>0&&"/"===t.charAt(i+1)&&(t=t.substring(0,i)),s.push(t);return s.join("\n")}function ut(e){console.error(e.join("\n"))}var ht=function(){function e(t,i){w(this,e),this.id=ot.addItem({}),this.source=i,this.init(t)}return I(e,[{key:"init",value:function(e){if(this.gl=e,this.allocated=!1,this.compiled=!1,this.linked=!1,this.validated=!1,this.errors=null,this.uniforms={},this.samplers={},this.attributes={},this._vertexShader=new st(e,e.VERTEX_SHADER,at(this.source.vertex)),this._fragmentShader=new st(e,e.FRAGMENT_SHADER,at(this.source.fragment)),!this._vertexShader.allocated)return this.errors=["Vertex shader failed to allocate"].concat(this._vertexShader.errors),void ut(this.errors);if(!this._fragmentShader.allocated)return this.errors=["Fragment shader failed to allocate"].concat(this._fragmentShader.errors),void ut(this.errors);if(this.allocated=!0,!this._vertexShader.compiled)return this.errors=["Vertex shader failed to compile"].concat(this._vertexShader.errors),void ut(this.errors);if(!this._fragmentShader.compiled)return this.errors=["Fragment shader failed to compile"].concat(this._fragmentShader.errors),void ut(this.errors);var t,i,s,r,n;if(this.compiled=!0,this.handle=e.createProgram(),this.handle){if(e.attachShader(this.handle,this._vertexShader.handle),e.attachShader(this.handle,this._fragmentShader.handle),e.linkProgram(this.handle),this.linked=e.getProgramParameter(this.handle,e.LINK_STATUS),this.validated=!0,!this.linked||!this.validated)return this.errors=[],this.errors.push(""),this.errors.push(e.getProgramInfoLog(this.handle)),this.errors.push("\nVertex shader:\n"),this.errors=this.errors.concat(this.source.vertex),this.errors.push("\nFragment shader:\n"),this.errors=this.errors.concat(this.source.fragment),void ut(this.errors);var o=e.getProgramParameter(this.handle,e.ACTIVE_UNIFORMS);for(i=0;i<o;++i)(s=e.getActiveUniform(this.handle,i))&&("\0"===(r=s.name)[r.length-1]&&(r=r.substr(0,r.length-1)),n=e.getUniformLocation(this.handle,r),s.type===e.SAMPLER_2D||s.type===e.SAMPLER_CUBE||35682===s.type||e instanceof WebGL2RenderingContext&&(s.type===e.UNSIGNED_INT_SAMPLER_2D||s.type===e.INT_SAMPLER_2D)?this.samplers[r]=new rt(e,n):this.uniforms[r]=n);var a=e.getProgramParameter(this.handle,e.ACTIVE_ATTRIBUTES);for(i=0;i<a;i++)(t=e.getActiveAttrib(this.handle,i))&&(n=e.getAttribLocation(this.handle,t.name),this.attributes[t.name]=new nt(e,n));this.allocated=!0}else this.errors=["Failed to allocate program"]}},{key:"bind",value:function(){this.allocated&&this.gl.useProgram(this.handle)}},{key:"getLocation",value:function(e){if(this.allocated)return this.uniforms[e]}},{key:"getAttribute",value:function(e){if(this.allocated)return this.attributes[e]}},{key:"bindTexture",value:function(e,t,i){if(!this.allocated)return!1;var s=this.samplers[e];return!!s&&s.bindTexture(t,i)}},{key:"destroy",value:function(){this.allocated&&(ot.removeItem(this.id),this.gl.deleteProgram(this.handle),this.gl.deleteShader(this._vertexShader.handle),this.gl.deleteShader(this._fragmentShader.handle),this.handle=null,this.attributes=null,this.uniforms=null,this.samplers=null,this.allocated=!1)}}]),e}(),lt=function(){function e(t,i,s,r,n,o,a,u,h){switch(w(this,e),this._gl=t,this.type=i,this.allocated=!1,s.constructor){case Uint8Array:this.itemType=t.UNSIGNED_BYTE,this.itemByteSize=1;break;case Int8Array:this.itemType=t.BYTE,this.itemByteSize=1;break;case Uint16Array:this.itemType=t.UNSIGNED_SHORT,this.itemByteSize=2;break;case Int16Array:this.itemType=t.SHORT,this.itemByteSize=2;break;case Uint32Array:this.itemType=t.UNSIGNED_INT,this.itemByteSize=4;break;case Int32Array:this.itemType=t.INT,this.itemByteSize=4;break;default:this.itemType=t.FLOAT,this.itemByteSize=4}this.usage=o,this.length=0,this.dataLength=r,this.numItems=0,this.itemSize=n,this.normalized=!!a,this.stride=u||0,this.offset=h||0,this._allocate(s)}return I(e,[{key:"_allocate",value:function(e){if(this.allocated=!1,this._handle=this._gl.createBuffer(),!this._handle)throw"Failed to allocate WebGL ArrayBuffer";this._handle&&(this._gl.bindBuffer(this.type,this._handle),this._gl.bufferData(this.type,e.length>this.dataLength?e.slice(0,this.dataLength):e,this.usage),this._gl.bindBuffer(this.type,null),this.length=e.length,this.numItems=this.length/this.itemSize,this.allocated=!0)}},{key:"setData",value:function(e,t){this.allocated&&(e.length+(t||0)>this.length?(this.destroy(),this._allocate(e)):(this._gl.bindBuffer(this.type,this._handle),t||0===t?this._gl.bufferSubData(this.type,t*this.itemByteSize,e):this._gl.bufferData(this.type,e,this.usage),this._gl.bindBuffer(this.type,null)))}},{key:"bind",value:function(){this.allocated&&this._gl.bindBuffer(this.type,this._handle)}},{key:"unbind",value:function(){this.allocated&&this._gl.bindBuffer(this.type,null)}},{key:"destroy",value:function(){this.allocated&&(this._gl.deleteBuffer(this._handle),this._handle=null,this.allocated=!1)}}]),e}(),ct=function(){function e(t,i){w(this,e),this.scene=t,this.aabb=q.AABB3(),this.origin=q.vec3(i),this.originHash=this.origin.join(),this.numMarkers=0,this.markers={},this.markerList=[],this.markerIndices={},this.positions=[],this.indices=[],this.positionsBuf=null,this.lenPositionsBuf=0,this.indicesBuf=null,this.sectionPlanesActive=[],this.culledBySectionPlanes=!1,this.occlusionTestList=[],this.lenOcclusionTestList=0,this.pixels=[],this.aabbDirty=!1,this.markerListDirty=!1,this.positionsDirty=!0,this.occlusionTestListDirty=!1}return I(e,[{key:"addMarker",value:function(e){this.markers[e.id]=e,this.markerListDirty=!0,this.numMarkers++}},{key:"markerWorldPosUpdated",value:function(e){if(this.markers[e.id]){var t=this.markerIndices[e.id];this.positions[3*t+0]=e.worldPos[0],this.positions[3*t+1]=e.worldPos[1],this.positions[3*t+2]=e.worldPos[2],this.positionsDirty=!0}}},{key:"removeMarker",value:function(e){delete this.markers[e.id],this.markerListDirty=!0,this.numMarkers--}},{key:"update",value:function(){this.markerListDirty&&(this._buildMarkerList(),this.markerListDirty=!1,this.positionsDirty=!0,this.occlusionTestListDirty=!0),this.positionsDirty&&(this._buildPositions(),this.positionsDirty=!1,this.aabbDirty=!0,this.vbosDirty=!0),this.aabbDirty&&(this._buildAABB(),this.aabbDirty=!1),this.vbosDirty&&(this._buildVBOs(),this.vbosDirty=!1),this.occlusionTestListDirty&&this._buildOcclusionTestList(),this._updateActiveSectionPlanes()}},{key:"_buildMarkerList",value:function(){for(var e in this.numMarkers=0,this.markers)this.markers.hasOwnProperty(e)&&(this.markerList[this.numMarkers]=this.markers[e],this.markerIndices[e]=this.numMarkers,this.numMarkers++);this.markerList.length=this.numMarkers}},{key:"_buildPositions",value:function(){for(var e=0,t=0;t<this.numMarkers;t++)if(this.markerList[t]){var i=this.markerList[t].worldPos;this.positions[e++]=i[0],this.positions[e++]=i[1],this.positions[e++]=i[2],this.indices[t]=t}this.positions.length=3*this.numMarkers,this.indices.length=this.numMarkers}},{key:"_buildAABB",value:function(){var e=this.aabb;q.collapseAABB3(e),q.expandAABB3Points3(e,this.positions);var t=this.origin;e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[0],e[4]+=t[1],e[5]+=t[2]}},{key:"_buildVBOs",value:function(){if(this.positionsBuf){if(this.lenPositionsBuf===this.positions.length)return void this.positionsBuf.setData(this.positions);this.positionsBuf.destroy(),this.positionsBuf=null,this.indicesBuf.destroy(),this.indicesBuf=null}var e=this.scene.canvas.gl,t=3*this.numMarkers,i=this.numMarkers;this.positionsBuf=new lt(e,e.ARRAY_BUFFER,new Float32Array(this.positions),t,3,e.STATIC_DRAW),this.indicesBuf=new lt(e,e.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),i,1,e.STATIC_DRAW),this.lenPositionsBuf=this.positions.length}},{key:"_buildOcclusionTestList",value:function(){var e=this.scene.canvas,t=this.scene.camera.perspective.near,i=e.boundary,s=i[2],r=i[3],n=0;this.lenOcclusionTestList=0;for(var o=0;o<this.numMarkers;o++){var a=this.markerList[o];if(a.viewPos[2]>-t)a._setVisible(!1);else{var u=a.canvasPos,h=u[0],l=u[1];h+10<0||l+10<0||h-10>s||l-10>r?a._setVisible(!1):!a.entity||a.entity.visible?a.occludable?(this.occlusionTestList[this.lenOcclusionTestList++]=a,this.pixels[n++]=h,this.pixels[n++]=l):a._setVisible(!0):a._setVisible(!1)}}}},{key:"_updateActiveSectionPlanes",value:function(){var e=this.scene._sectionPlanesState.sectionPlanes,t=e.length;if(t>0)for(var i=0;i<t;i++){var s=e[i];if(s.active){var r=q.planeAABB3Intersect(s.dir,s.dist,this.aabb);if(-1===r)return void(this.culledBySectionPlanes=!0);var n=0===r;this.sectionPlanesActive[i]=n}else this.sectionPlanesActive[i]=!1}this.culledBySectionPlanes=!1}},{key:"destroy",value:function(){this.markers={},this.markerList.length=0,this.positionsBuf&&this.positionsBuf.destroy(),this.indicesBuf&&this.indicesBuf.destroy()}}]),e}(),pt=q.vec3([1,0,0]),dt=q.vec3(),ft=function(){function e(t,i){var s=this;w(this,e),this._scene=t,this._renderBufferManager=i,this._occlusionLayers={},this._occlusionLayersList=[],this._occlusionLayersListDirty=!1,this._shaderSource=null,this._program=null,this._shaderSourceHash=null,this._shaderSourceDirty=!0,this._programDirty=!1,this._markersToOcclusionLayersMap={},this._onCameraViewMatrix=t.camera.on("viewMatrix",(function(){s._occlusionTestListDirty=!0})),this._onCameraProjMatrix=t.camera.on("projMatrix",(function(){s._occlusionTestListDirty=!0})),this._onCanvasBoundary=t.canvas.on("boundary",(function(){s._occlusionTestListDirty=!0}))}return I(e,[{key:"addMarker",value:function(e){var t=e.origin.join(),i=this._occlusionLayers[t];i||(i=new ct(this._scene,e.origin),this._occlusionLayers[i.originHash]=i,this._occlusionLayersListDirty=!0),i.addMarker(e),this._markersToOcclusionLayersMap[e.id]=i,this._occlusionTestListDirty=!0}},{key:"markerWorldPosUpdated",value:function(e){var t=this._markersToOcclusionLayersMap[e.id];if(t){var i=e.origin.join();if(i!==t.originHash){1===t.numMarkers?(t.destroy(),delete this._occlusionLayers[t.originHash],this._occlusionLayersListDirty=!0):t.removeMarker(e);var s=this._occlusionLayers[i];s||(s=new ct(this._scene,e.origin),this._occlusionLayers[i]=t,this._occlusionLayersListDirty=!0),s.addMarker(e),this._markersToOcclusionLayersMap[e.id]=s}else t.markerWorldPosUpdated(e)}else e.error("Marker has not been added to OcclusionTester")}},{key:"removeMarker",value:function(e){var t=e.origin.join(),i=this._occlusionLayers[t];i&&(1===i.numMarkers?(i.destroy(),delete this._occlusionLayers[i.originHash],this._occlusionLayersListDirty=!0):i.removeMarker(e),delete this._markersToOcclusionLayersMap[e.id])}},{key:"needOcclusionTest",get:function(){return this._occlusionTestListDirty}},{key:"bindRenderBuf",value:function(){var e=[this._scene.canvas.canvas.id,this._scene._sectionPlanesState.getHash()].join(";");if(e!==this._shaderSourceHash&&(this._shaderSourceHash=e,this._shaderSourceDirty=!0),this._shaderSourceDirty&&(this._buildShaderSource(),this._shaderSourceDirty=!1,this._programDirty=!0),this._programDirty&&(this._buildProgram(),this._programDirty=!1,this._occlusionTestListDirty=!0),this._occlusionLayersListDirty&&(this._buildOcclusionLayersList(),this._occlusionLayersListDirty=!1),this._occlusionTestListDirty){for(var t=0,i=this._occlusionLayersList.length;t<i;t++){this._occlusionLayersList[t].occlusionTestListDirty=!0}this._occlusionTestListDirty=!1}this._readPixelBuf=this._renderBufferManager.getRenderBuffer("occlusionReadPix"),this._readPixelBuf.bind(),this._readPixelBuf.clear()}},{key:"_buildOcclusionLayersList",value:function(){var e=0;for(var t in this._occlusionLayers)this._occlusionLayers.hasOwnProperty(t)&&(this._occlusionLayersList[e++]=this._occlusionLayers[t]);this._occlusionLayersList.length=e}},{key:"_buildShaderSource",value:function(){this._shaderSource={vertex:this._buildVertexShaderSource(),fragment:this._buildFragmentShaderSource()}}},{key:"_buildVertexShaderSource",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// OcclusionTester vertex shader"),i.push("in vec3 position;"),i.push("uniform mat4 modelMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),t&&i.push("out vec4 vWorldPosition;"),i.push("void main(void) {"),i.push("vec4 worldPosition = vec4(position, 1.0); "),i.push("   vec4 viewPosition = viewMatrix * worldPosition;"),t&&i.push("   vWorldPosition = worldPosition;"),i.push("   vec4 clipPos = projMatrix * viewPosition;"),i.push("   gl_PointSize = 20.0;"),e.logarithmicDepthBufferEnabled?i.push("vFragDepth = 1.0 + clipPos.w;"):i.push("clipPos.z += -0.001;"),i.push("   gl_Position = clipPos;"),i.push("}"),i}},{key:"_buildFragmentShaderSource",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// OcclusionTester fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("if (sectionPlaneActive"+n+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }")}return e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("   outColor = vec4(1.0, 0.0, 0.0, 1.0); "),s.push("}"),s}},{key:"_buildProgram",value:function(){this._program&&this._program.destroy();var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._shaderSource),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"drawMarkers",value:function(){var e=this._scene,t=e.canvas.gl,i=this._program,s=e._sectionPlanesState,r=e.camera,n=e.camera.project;if(i.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,r._project._state.matrix),e.logarithmicDepthBufferEnabled){var o=2/(Math.log(n.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,o)}for(var a=0,u=this._occlusionLayersList.length;a<u;a++){var h=this._occlusionLayersList[a];if(h.update(),!h.culledBySectionPlanes){var l=h.origin;t.uniformMatrix4fv(this._uViewMatrix,!1,De(r.viewMatrix,l));var c=s.sectionPlanes.length;if(c>0)for(var p=s.sectionPlanes,d=0;d<c;d++){var f=this._uSectionPlanes[d];if(f){var m=h.sectionPlanesActive[d];if(t.uniform1i(f.active,m?1:0),m){var v=p[d];t.uniform3fv(f.pos,Ee(v.dist,v.dir,l,dt)),t.uniform3fv(f.dir,v.dir)}}}this._aPosition.bindArrayBuffer(h.positionsBuf);var g=h.indicesBuf;g.bind(),t.drawElements(t.POINTS,g.numItems,g.itemType,0)}}}},{key:"doOcclusionTest",value:function(){for(var e=this._scene.canvas.resolutionScale,t=255*pt[0],i=255*pt[1],s=255*pt[2],r=0,n=this._occlusionLayersList.length;r<n;r++)for(var o=this._occlusionLayersList[r],a=0;a<o.lenOcclusionTestList;a++){var u=o.occlusionTestList[a],h=2*a,l=this._readPixelBuf.read(Math.round(o.pixels[h]*e),Math.round(o.pixels[h+1]*e)),c=l[0]===t&&l[1]===i&&l[2]===s;u._setVisible(c)}}},{key:"unbindRenderBuf",value:function(){this._readPixelBuf.unbind()}},{key:"destroy",value:function(){if(!this.destroyed){for(var e=0,t=this._occlusionLayersList.length;e<t;e++){this._occlusionLayersList[e].destroy()}this._program&&this._program.destroy(),this._scene.camera.off(this._onCameraViewMatrix),this._scene.camera.off(this._onCameraProjMatrix),this._scene.canvas.off(this._onCanvasBoundary),this.destroyed=!0}}}]),e}(),mt=q.vec2(),vt=function(){function e(t){w(this,e),this._scene=t,this._numSamples=null,this._program=null,this._programError=!1,this._aPosition=null,this._aUV=null,this._uDepthTexture="uDepthTexture",this._uCameraNear=null,this._uCameraFar=null,this._uCameraProjectionMatrix=null,this._uCameraInverseProjectionMatrix=null,this._uScale=null,this._uIntensity=null,this._uBias=null,this._uKernelRadius=null,this._uMinResolution=null,this._uRandomSeed=null,this._uvBuf=null,this._positionsBuf=null,this._indicesBuf=null}return I(e,[{key:"render",value:function(e){var t=this;if(this._build(),!this._programError){this._getInverseProjectMat||(this._getInverseProjectMat=function(){var e=!0;t._scene.camera.on("projMatrix",(function(){e=!0}));var i=q.mat4();return function(){return e&&q.inverseMat4(r.camera.projMatrix,i),i}}());var i=this._scene.canvas.gl,s=this._program,r=this._scene,n=r.sao,o=i.drawingBufferWidth,a=i.drawingBufferHeight,u=r.camera.project._state,h=u.near,l=u.far,c=u.matrix,p=this._getInverseProjectMat(),d=Math.random(),f="perspective"===r.camera.projection;mt[0]=o,mt[1]=a,i.viewport(0,0,o,a),i.clearColor(0,0,0,1),i.disable(i.DEPTH_TEST),i.disable(i.BLEND),i.frontFace(i.CCW),i.clear(i.COLOR_BUFFER_BIT),s.bind(),i.uniform1f(this._uCameraNear,h),i.uniform1f(this._uCameraFar,l),i.uniformMatrix4fv(this._uCameraProjectionMatrix,!1,c),i.uniformMatrix4fv(this._uCameraInverseProjectionMatrix,!1,p),i.uniform1i(this._uPerspective,f),i.uniform1f(this._uScale,n.scale*(l/5)),i.uniform1f(this._uIntensity,n.intensity),i.uniform1f(this._uBias,n.bias),i.uniform1f(this._uKernelRadius,n.kernelRadius),i.uniform1f(this._uMinResolution,n.minResolution),i.uniform2fv(this._uViewport,mt),i.uniform1f(this._uRandomSeed,d);var m=e.getDepthTexture();s.bindTexture(this._uDepthTexture,m,0),this._aUV.bindArrayBuffer(this._uvBuf),this._aPosition.bindArrayBuffer(this._positionsBuf),this._indicesBuf.bind(),i.drawElements(i.TRIANGLES,this._indicesBuf.numItems,this._indicesBuf.itemType,0)}}},{key:"_build",value:function(){var e=!1,t=this._scene.sao;if(t.numSamples!==this._numSamples&&(this._numSamples=Math.floor(t.numSamples),e=!0),e){var i=this._scene.canvas.gl;if(this._program&&(this._program.destroy(),this._program=null),this._program=new ht(i,{vertex:["#version 300 es\n                    precision highp float;\n                    precision highp int;\n                    \n                    in vec3 aPosition;\n                    in vec2 aUV;            \n                    \n                    out vec2 vUV;\n                    \n                    void main () {\n                        gl_Position = vec4(aPosition, 1.0);\n                        vUV = aUV;\n                    }"],fragment:["#version 300 es      \n                precision highp float;\n                precision highp int;           \n                \n                #define NORMAL_TEXTURE 0\n                #define PI 3.14159265359\n                #define PI2 6.28318530718\n                #define EPSILON 1e-6\n                #define NUM_SAMPLES ".concat(this._numSamples,"\n                #define NUM_RINGS 4              \n            \n                in vec2        vUV;\n            \n                uniform sampler2D   uDepthTexture;\n               \n                uniform float       uCameraNear;\n                uniform float       uCameraFar;\n                uniform mat4        uProjectMatrix;\n                uniform mat4        uInverseProjectMatrix;\n                \n                uniform bool        uPerspective;\n\n                uniform float       uScale;\n                uniform float       uIntensity;\n                uniform float       uBias;\n                uniform float       uKernelRadius;\n                uniform float       uMinResolution;\n                uniform vec2        uViewport;\n                uniform float       uRandomSeed;\n\n                float pow2( const in float x ) { return x*x; }\n                \n                highp float rand( const in vec2 uv ) {\n                    const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n                    highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n                    return fract(sin(sn) * c);\n                }\n\n                vec3 packNormalToRGB( const in vec3 normal ) {\n                    return normalize( normal ) * 0.5 + 0.5;\n                }\n\n                vec3 unpackRGBToNormal( const in vec3 rgb ) {\n                    return 2.0 * rgb.xyz - 1.0;\n                }\n\n                const float packUpscale = 256. / 255.;\n                const float unpackDownScale = 255. / 256.; \n\n                const vec3 packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\n                const vec4 unPackFactors = unpackDownScale / vec4( packFactors, 1. );   \n\n                const float shiftRights = 1. / 256.;\n\n                vec4 packFloatToRGBA( const in float v ) {\n                    vec4 r = vec4( fract( v * packFactors ), v );\n                    r.yzw -= r.xyz * shiftRights; \n                    return r * packUpscale;\n                }\n\n                float unpackRGBAToFloat( const in vec4 v ) {                   \n                    return dot( floor( v * 255.0 + 0.5 ) / 255.0, unPackFactors );\n                }\n                \n                float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n                    return ( near * far ) / ( ( far - near ) * invClipZ - far );\n                }\n\n                float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n                    return linearClipZ * ( near - far ) - near;\n                }\n                \n                float getDepth( const in vec2 screenPosition ) {\n                    return vec4(texture(uDepthTexture, screenPosition)).r;\n                }\n\n                float getViewZ( const in float depth ) {\n                     if (uPerspective) {\n                         return perspectiveDepthToViewZ( depth, uCameraNear, uCameraFar );\n                     } else {\n                        return orthographicDepthToViewZ( depth, uCameraNear, uCameraFar );\n                     }\n                }\n\n                vec3 getViewPos( const in vec2 screenPos, const in float depth, const in float viewZ ) {\n                \tfloat clipW = uProjectMatrix[2][3] * viewZ + uProjectMatrix[3][3];\n                \tvec4 clipPosition = vec4( ( vec3( screenPos, depth ) - 0.5 ) * 2.0, 1.0 );\n                \tclipPosition *= clipW; \n                \treturn ( uInverseProjectMatrix * clipPosition ).xyz;\n                }\n\n                vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPos ) {               \n                    return normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );\n                }\n\n                float scaleDividedByCameraFar;\n                float minResolutionMultipliedByCameraFar;\n\n                float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {\n                \tvec3 viewDelta = sampleViewPosition - centerViewPosition;\n                \tfloat viewDistance = length( viewDelta );\n                \tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;\n                \treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - uBias) / (1.0 + pow2( scaledScreenDistance ) );\n                }\n\n                const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );\n                const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );\n\n                float getAmbientOcclusion( const in vec3 centerViewPosition ) {\n            \n                \tscaleDividedByCameraFar = uScale / uCameraFar;\n                \tminResolutionMultipliedByCameraFar = uMinResolution * uCameraFar;\n                \tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUV );\n\n                \tfloat angle = rand( vUV + uRandomSeed ) * PI2;\n                \tvec2 radius = vec2( uKernelRadius * INV_NUM_SAMPLES ) / uViewport;\n                \tvec2 radiusStep = radius;\n\n                \tfloat occlusionSum = 0.0;\n                \tfloat weightSum = 0.0;\n\n                \tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {\n                \t\tvec2 sampleUv = vUV + vec2( cos( angle ), sin( angle ) ) * radius;\n                \t\tradius += radiusStep;\n                \t\tangle += ANGLE_STEP;\n\n                \t\tfloat sampleDepth = getDepth( sampleUv );\n                \t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {\n                \t\t\tcontinue;\n                \t\t}\n\n                \t\tfloat sampleViewZ = getViewZ( sampleDepth );\n                \t\tvec3 sampleViewPosition = getViewPos( sampleUv, sampleDepth, sampleViewZ );\n                \t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );\n                \t\tweightSum += 1.0;\n                \t}\n\n                \tif( weightSum == 0.0 ) discard;\n\n                \treturn occlusionSum * ( uIntensity / weightSum );\n                }\n\n                out vec4 outColor;\n   \n                void main() {\n                \n                \tfloat centerDepth = getDepth( vUV );\n                \t\n                \tif( centerDepth >= ( 1.0 - EPSILON ) ) {\n                \t\tdiscard;\n                \t}\n\n                \tfloat centerViewZ = getViewZ( centerDepth );\n                \tvec3 viewPosition = getViewPos( vUV, centerDepth, centerViewZ );\n\n                \tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );\n                \n                \toutColor = packFloatToRGBA(  1.0- ambientOcclusion );\n                }")]}),this._program.errors)return console.error(this._program.errors.join("\n")),void(this._programError=!0);var s=new Float32Array([1,1,0,1,0,0,1,0]),r=new Float32Array([1,1,0,-1,1,0,-1,-1,0,1,-1,0]),n=new Uint32Array([0,1,2,0,2,3]);this._positionsBuf=new lt(i,i.ARRAY_BUFFER,r,r.length,3,i.STATIC_DRAW),this._uvBuf=new lt(i,i.ARRAY_BUFFER,s,s.length,2,i.STATIC_DRAW),this._indicesBuf=new lt(i,i.ELEMENT_ARRAY_BUFFER,n,n.length,1,i.STATIC_DRAW),this._program.bind(),this._uCameraNear=this._program.getLocation("uCameraNear"),this._uCameraFar=this._program.getLocation("uCameraFar"),this._uCameraProjectionMatrix=this._program.getLocation("uProjectMatrix"),this._uCameraInverseProjectionMatrix=this._program.getLocation("uInverseProjectMatrix"),this._uPerspective=this._program.getLocation("uPerspective"),this._uScale=this._program.getLocation("uScale"),this._uIntensity=this._program.getLocation("uIntensity"),this._uBias=this._program.getLocation("uBias"),this._uKernelRadius=this._program.getLocation("uKernelRadius"),this._uMinResolution=this._program.getLocation("uMinResolution"),this._uViewport=this._program.getLocation("uViewport"),this._uRandomSeed=this._program.getLocation("uRandomSeed"),this._aPosition=this._program.getAttribute("aPosition"),this._aUV=this._program.getAttribute("aUV"),this._dirty=!1}}},{key:"destroy",value:function(){this._program&&(this._program.destroy(),this._program=null)}}]),e}(),gt=new Float32Array(Tt(17,[0,1])),_t=new Float32Array(Tt(17,[1,0])),yt=new Float32Array(function(e,t){for(var i=[],s=0;s<=e;s++)i.push(Pt(s,t));return i}(17,4)),bt=new Float32Array(2),xt=function(){function e(t){w(this,e),this._scene=t,this._program=null,this._programError=!1,this._aPosition=null,this._aUV=null,this._uDepthTexture="uDepthTexture",this._uOcclusionTexture="uOcclusionTexture",this._uViewport=null,this._uCameraNear=null,this._uCameraFar=null,this._uCameraProjectionMatrix=null,this._uCameraInverseProjectionMatrix=null,this._uvBuf=null,this._positionsBuf=null,this._indicesBuf=null,this.init()}return I(e,[{key:"init",value:function(){var e=this._scene.canvas.gl;if(this._program=new ht(e,{vertex:["#version 300 es\n                precision highp float;\n                precision highp int;\n                    \n                in vec3 aPosition;\n                in vec2 aUV;\n                uniform vec2 uViewport;\n                out vec2 vUV;\n                out vec2 vInvSize;\n                void main () {\n                    vUV = aUV;\n                    vInvSize = 1.0 / uViewport;\n                    gl_Position = vec4(aPosition, 1.0);\n                }"],fragment:["#version 300 es\n                precision highp float;\n                precision highp int;\n                    \n                #define PI 3.14159265359\n                #define PI2 6.28318530718\n                #define EPSILON 1e-6\n\n                #define KERNEL_RADIUS ".concat(16,"\n\n                in vec2        vUV;\n                in vec2        vInvSize;\n            \n                uniform sampler2D   uDepthTexture;\n                uniform sampler2D   uOcclusionTexture;              \n               \n                uniform float       uCameraNear;\n                uniform float       uCameraFar;               \n                uniform float       uDepthCutoff;\n\n                uniform vec2        uSampleOffsets[ KERNEL_RADIUS + 1 ];\n                uniform float       uSampleWeights[ KERNEL_RADIUS + 1 ];\n\n                const float         unpackDownscale = 255. / 256.; \n\n                const vec3          packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\n                const vec4          unpackFactors = unpackDownscale / vec4( packFactors, 1. );   \n\n                const float packUpscale = 256. / 255.;\n       \n                const float shiftRights = 1. / 256.;\n                \n                float unpackRGBAToFloat( const in vec4 v ) {\n                    return dot( floor( v * 255.0 + 0.5 ) / 255.0, unpackFactors );\n                }               \n\n                vec4 packFloatToRGBA( const in float v ) {\n                    vec4 r = vec4( fract( v * packFactors ), v );\n                    r.yzw -= r.xyz * shiftRights; \n                    return r * packUpscale;\n                }\n\n                float viewZToOrthographicDepth( const in float viewZ) {\n                    return ( viewZ + uCameraNear ) / ( uCameraNear - uCameraFar );\n                }\n              \n                float orthographicDepthToViewZ( const in float linearClipZ) {\n                    return linearClipZ * ( uCameraNear - uCameraFar ) - uCameraNear;\n                }\n\n                float viewZToPerspectiveDepth( const in float viewZ) {\n                    return (( uCameraNear + viewZ ) * uCameraFar ) / (( uCameraFar - uCameraNear ) * viewZ );\n                }\n                \n                float perspectiveDepthToViewZ( const in float invClipZ) {\n                    return ( uCameraNear * uCameraFar ) / ( ( uCameraFar - uCameraNear ) * invClipZ - uCameraFar );\n                }\n\n                float getDepth( const in vec2 screenPosition ) {\n                    return vec4(texture(uDepthTexture, screenPosition)).r;\n                }\n\n                float getViewZ( const in float depth ) {\n                     return perspectiveDepthToViewZ( depth );\n                }\n\n                out vec4 outColor;\n        \n                void main() {\n                \n                    float depth = getDepth( vUV );\n                    if( depth >= ( 1.0 - EPSILON ) ) {\n                        discard;\n                    }\n\n                    float centerViewZ = -getViewZ( depth );\n                    bool rBreak = false;\n                    bool lBreak = false;\n\n                    float weightSum = uSampleWeights[0];\n                    float occlusionSum = unpackRGBAToFloat(texture( uOcclusionTexture, vUV )) * weightSum;\n\n                    for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {\n\n                        float sampleWeight = uSampleWeights[i];\n                        vec2 sampleUVOffset = uSampleOffsets[i] * vInvSize;\n\n                        vec2 sampleUV = vUV + sampleUVOffset;\n                        float viewZ = -getViewZ( getDepth( sampleUV ) );\n\n                        if( abs( viewZ - centerViewZ ) > uDepthCutoff ) {\n                            rBreak = true;\n                        }\n\n                        if( ! rBreak ) {\n                            occlusionSum += unpackRGBAToFloat(texture( uOcclusionTexture, sampleUV )) * sampleWeight;\n                            weightSum += sampleWeight;\n                        }\n\n                        sampleUV = vUV - sampleUVOffset;\n                        viewZ = -getViewZ( getDepth( sampleUV ) );\n\n                        if( abs( viewZ - centerViewZ ) > uDepthCutoff ) {\n                            lBreak = true;\n                        }\n\n                        if( ! lBreak ) {\n                            occlusionSum += unpackRGBAToFloat(texture( uOcclusionTexture, sampleUV )) * sampleWeight;\n                            weightSum += sampleWeight;\n                        }\n                    }\n\n                    outColor = packFloatToRGBA(occlusionSum / weightSum);\n                }")]}),this._program.errors)return console.error(this._program.errors.join("\n")),void(this._programError=!0);var t=new Float32Array([1,1,0,1,0,0,1,0]),i=new Float32Array([1,1,0,-1,1,0,-1,-1,0,1,-1,0]),s=new Uint32Array([0,1,2,0,2,3]);this._positionsBuf=new lt(e,e.ARRAY_BUFFER,i,i.length,3,e.STATIC_DRAW),this._uvBuf=new lt(e,e.ARRAY_BUFFER,t,t.length,2,e.STATIC_DRAW),this._indicesBuf=new lt(e,e.ELEMENT_ARRAY_BUFFER,s,s.length,1,e.STATIC_DRAW),this._program.bind(),this._uViewport=this._program.getLocation("uViewport"),this._uCameraNear=this._program.getLocation("uCameraNear"),this._uCameraFar=this._program.getLocation("uCameraFar"),this._uDepthCutoff=this._program.getLocation("uDepthCutoff"),this._uSampleOffsets=e.getUniformLocation(this._program.handle,"uSampleOffsets"),this._uSampleWeights=e.getUniformLocation(this._program.handle,"uSampleWeights"),this._aPosition=this._program.getAttribute("aPosition"),this._aUV=this._program.getAttribute("aUV")}},{key:"render",value:function(e,t,i){var s=this;if(!this._programError){this._getInverseProjectMat||(this._getInverseProjectMat=function(){var e=!0;s._scene.camera.on("projMatrix",(function(){e=!0}));var t=q.mat4();return function(){return e&&q.inverseMat4(o.camera.projMatrix,t),t}}());var r=this._scene.canvas.gl,n=this._program,o=this._scene,a=r.drawingBufferWidth,u=r.drawingBufferHeight,h=o.camera.project._state,l=h.near,c=h.far;r.viewport(0,0,a,u),r.clearColor(0,0,0,1),r.enable(r.DEPTH_TEST),r.disable(r.BLEND),r.frontFace(r.CCW),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),n.bind(),bt[0]=a,bt[1]=u,r.uniform2fv(this._uViewport,bt),r.uniform1f(this._uCameraNear,l),r.uniform1f(this._uCameraFar,c),r.uniform1f(this._uDepthCutoff,.01),0===i?r.uniform2fv(this._uSampleOffsets,_t):r.uniform2fv(this._uSampleOffsets,gt),r.uniform1fv(this._uSampleWeights,yt);var p=e.getDepthTexture(),d=t.getTexture();n.bindTexture(this._uDepthTexture,p,0),n.bindTexture(this._uOcclusionTexture,d,1),this._aUV.bindArrayBuffer(this._uvBuf),this._aPosition.bindArrayBuffer(this._positionsBuf),this._indicesBuf.bind(),r.drawElements(r.TRIANGLES,this._indicesBuf.numItems,this._indicesBuf.itemType,0)}}},{key:"destroy",value:function(){this._program.destroy()}}]),e}();function Pt(e,t){return Math.exp(-e*e/(t*t*2))/(Math.sqrt(2*Math.PI)*t)}function Tt(e,t){for(var i=[],s=0;s<=e;s++)i.push(t[0]*s),i.push(t[1]*s);return i}var wt=function(){var e=document.createElement("canvas"),t=String.fromCharCode;if(!e.getContext)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};var i=!!e.getContext("2d").getImageData,s=!!e.toDataURL,r=!!window.btoa,n=function(e){var i="",s=e.width,r=e.height;i+="BM";var n=s*r*4+54;i+=t(n%256),n=Math.floor(n/256),i+=t(n%256),n=Math.floor(n/256),i+=t(n%256),n=Math.floor(n/256),i+=t(n%256),i+=t(0,0,0,0,54,0,0,0),i+=t(40,0,0,0);var o=s;i+=t(o%256),o=Math.floor(o/256),i+=t(o%256),o=Math.floor(o/256),i+=t(o%256),o=Math.floor(o/256),i+=t(o%256);var a=r;i+=t(a%256),a=Math.floor(a/256),i+=t(a%256),a=Math.floor(a/256),i+=t(a%256),a=Math.floor(a/256),i+=t(a%256),i+=t(1,0,32,0),i+=t(0,0,0,0);var u=s*r*4;i+=t(u%256),u=Math.floor(u/256),i+=t(u%256),u=Math.floor(u/256),i+=t(u%256),u=Math.floor(u/256),i+=t(u%256),i+=t(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var h,l,c,p,d=e.data,f="",m=r;do{for(c=s*(m-1)*4,p="",h=0;h<s;h++)p+=t(d[c+(l=4*h)+2],d[c+l+1],d[c+l],d[c+l+3]);f+=p}while(--m);return function(e){var i,s,r="";if("string"==typeof e)r=e;else for(s=e,i=0;i<s.length;i++)r+=t(s[i]);return btoa(r)}(i+f)},o=function(e){window.open(e)||(document.location.href=e)},a=function(e,t){return"data:"+t+";base64,"+e},u=function(e){var t=document.createElement("img");return t.src=e,t},h=function(e,t,i,s){if(t&&i){var r=document.createElement("canvas");r.width=t,r.height=i,r.style.width=t+"px",r.style.height=i+"px";var n=r.getContext("2d");return s?(n.save(),n.scale(1,-1),n.imageSmoothingEnabled=!0,n.drawImage(e,0,0,e.width,e.height,0,0,t,-i),n.restore()):(n.imageSmoothingEnabled=!0,n.drawImage(e,0,0,e.width,e.height,0,0,t,i)),r}return e};return{saveAsPNG:function(e,t,i,r,n){if(!s)return!1;var a=h(e,i,r,n).toDataURL("image/png");return t?u(a):(o(a),!0)},saveAsJPEG:function(e,t,i,r,n){if(!s)return!1;var a="image/jpeg",l=h(e,i,r,n).toDataURL(a);return 5==l.indexOf(a)&&(t?u(l):(o(l),!0))},saveAsBMP:function(e,t,l,c,p){if(!(s&&i&&r))return!1;var d="image/bmp",f=function(e){var t=parseInt(e.width),i=parseInt(e.height);return e.getContext("2d").getImageData(0,0,t,i)}(h(e,l,c,p)),m=n(f);return t?u(a(m,d)):(o(a(m,d)),!0)}}}(),Mt=function(){function e(t,i,s){w(this,e),s=s||{},this.gl=i,this.allocated=!1,this.canvas=t,this.buffer=null,this.bound=!1,this.size=s.size,this._hasDepthTexture=!!s.depthTexture}return I(e,[{key:"setSize",value:function(e){this.size=e}},{key:"webglContextRestored",value:function(e){this.gl=e,this.buffer=null,this.allocated=!1,this.bound=!1}},{key:"bind",value:function(){if(this._touch(),!this.bound){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.buffer.framebuf),this.bound=!0}}},{key:"_touch",value:function(){var e,t,i=this.gl;if(this.size?(e=this.size[0],t=this.size[1]):(e=i.drawingBufferWidth,t=i.drawingBufferHeight),this.buffer){if(this.buffer.width===e&&this.buffer.height===t)return;i.deleteTexture(this.buffer.texture),i.deleteFramebuffer(this.buffer.framebuf),i.deleteRenderbuffer(this.buffer.renderbuf)}var s,r=i.createTexture();i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),this._hasDepthTexture&&(s=i.createTexture(),i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.DEPTH_COMPONENT32F,e,t,0,i.DEPTH_COMPONENT,i.FLOAT,null));var n=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,n),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT32F,e,t);var o=i.createFramebuffer();if(i.bindFramebuffer(i.FRAMEBUFFER,o),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,r,0),this._hasDepthTexture?i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,s,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,n),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,o),!i.isFramebuffer(o))throw"Invalid framebuffer";i.bindFramebuffer(i.FRAMEBUFFER,null);var a=i.checkFramebufferStatus(i.FRAMEBUFFER);switch(a){case i.FRAMEBUFFER_COMPLETE:break;case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case i.FRAMEBUFFER_UNSUPPORTED:throw"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED";default:throw"Incomplete framebuffer: "+a}this.buffer={framebuf:o,renderbuf:n,texture:r,depthTexture:s,width:e,height:t},this.bound=!1}},{key:"clear",value:function(){if(!this.bound)throw"Render buffer not bound";var e=this.gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},{key:"read",value:function(e,t){var i=e,s=this.gl.drawingBufferHeight-t,r=new Uint8Array(4),n=this.gl;return n.readPixels(i,s,1,1,n.RGBA,n.UNSIGNED_BYTE,r),r}},{key:"readImage",value:function(e){var t=this.gl,i=this._getImageDataCache(),s=i.pixelData,r=i.canvas,n=i.imageData,o=i.context;t.readPixels(0,0,this.buffer.width,this.buffer.height,t.RGBA,t.UNSIGNED_BYTE,s),n.data.set(s),o.putImageData(n,0,0);var a,u=e.width||r.width,h=e.height||r.height,l=e.format||"jpeg",c=!0;switch(l){case"jpeg":a=wt.saveAsJPEG(r,!0,u,h,c);break;case"png":a=wt.saveAsPNG(r,!0,u,h,c);break;case"bmp":a=wt.saveAsBMP(r,!0,u,h,c);break;default:console.error("Unsupported image format: '"+l+"' - supported types are 'jpeg', 'bmp' and 'png' - defaulting to 'jpeg'"),a=wt.saveAsJPEG(r,!0,u,h,c)}return a.src}},{key:"_getImageDataCache",value:function(){var e=this.buffer.width,t=this.buffer.height,i=this._imageDataCache;if(i&&(i.width===e&&i.height===t||(this._imageDataCache=null,i=null)),!i){var s=document.createElement("canvas");s.width=e,s.height=t;var r=s.getContext("2d"),n=r.createImageData(e,t);i={pixelData:new Uint8Array(e*t*4),canvas:s,context:r,imageData:n,width:e,height:t},this._imageDataCache=i}return i}},{key:"unbind",value:function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),this.bound=!1}},{key:"getTexture",value:function(){var e=this;return this._texture||(this._texture={renderBuffer:this,bind:function(t){return!(!e.buffer||!e.buffer.texture)&&(e.gl.activeTexture(e.gl["TEXTURE"+t]),e.gl.bindTexture(e.gl.TEXTURE_2D,e.buffer.texture),!0)},unbind:function(t){e.buffer&&e.buffer.texture&&(e.gl.activeTexture(e.gl["TEXTURE"+t]),e.gl.bindTexture(e.gl.TEXTURE_2D,null))}})}},{key:"hasDepthTexture",value:function(){return this._hasDepthTexture}},{key:"getDepthTexture",value:function(){if(!this._hasDepthTexture)return null;var e=this;return this._depthTexture||(this._dethTexture={renderBuffer:this,bind:function(t){return!(!e.buffer||!e.buffer.depthTexture)&&(e.gl.activeTexture(e.gl["TEXTURE"+t]),e.gl.bindTexture(e.gl.TEXTURE_2D,e.buffer.depthTexture),!0)},unbind:function(t){e.buffer&&e.buffer.depthTexture&&(e.gl.activeTexture(e.gl["TEXTURE"+t]),e.gl.bindTexture(e.gl.TEXTURE_2D,null))}})}},{key:"destroy",value:function(){if(this.allocated){var e=this.gl;e.deleteTexture(this.buffer.texture),e.deleteTexture(this.buffer.depthTexture),e.deleteFramebuffer(this.buffer.framebuf),e.deleteRenderbuffer(this.buffer.renderbuf),this.allocated=!1,this.buffer=null,this.bound=!1}this._imageDataCache=null,this._texture=null,this._depthTexture=null}}]),e}(),It=function(){function e(t){w(this,e),this.scene=t,this._renderBuffersBasic={},this._renderBuffersScaled={}}return I(e,[{key:"getRenderBuffer",value:function(e,t){var i=1===this.scene.canvas.resolutionScale?this._renderBuffersBasic:this._renderBuffersScaled,s=i[e];return s||(s=new Mt(this.scene.canvas.canvas,this.scene.canvas.gl,t),i[e]=s),s}},{key:"destroy",value:function(){for(var e in this._renderBuffersBasic)this._renderBuffersBasic[e].destroy();for(var t in this._renderBuffersScaled)this._renderBuffersScaled[t].destroy()}}]),e}();function Ct(e,t){if(void 0===e._cachedExtensions&&(e._cachedExtensions={}),void 0!==e._cachedExtensions[t])return e._cachedExtensions[t];var i;switch(t){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(t)}return e._cachedExtensions[t]=i,i}var Dt=function(){var e=[],t=[],i=[],s=[],r=[],n=0,o=new Uint16Array(3),a=new Uint16Array(3),u=new Uint16Array(3),h=q.vec3(),l=q.vec3(),c=q.vec3(),p=q.vec3(),d=q.vec3(),f=q.vec3(),m=q.vec3();return function(v,g,_,y){!function(r,n){var o,a,u,h,l,c,p={},d=Math.pow(10,4),f=0;for(l=0,c=r.length;l<c;l+=3)o=r[l],a=r[l+1],u=r[l+2],void 0===p[h=Math.round(o*d)+"_"+Math.round(a*d)+"_"+Math.round(u*d)]&&(p[h]=f/3,e[f++]=o,e[f++]=a,e[f++]=u),t[l/3]=p[h];for(l=0,c=n.length;l<c;l++)s[l]=t[n[l]],i[s[l]]=n[l]}(v,g),function(t,i){n=0;for(var v=0,g=t;v<g;v+=3){var _=3*s[v],y=3*s[v+1],b=3*s[v+2];i?(o[0]=e[_],o[1]=e[_+1],o[2]=e[_+2],a[0]=e[y],a[1]=e[y+1],a[2]=e[y+2],u[0]=e[b],u[1]=e[b+1],u[2]=e[b+2],q.decompressPosition(o,i,h),q.decompressPosition(a,i,l),q.decompressPosition(u,i,c)):(h[0]=e[_],h[1]=e[_+1],h[2]=e[_+2],l[0]=e[y],l[1]=e[y+1],l[2]=e[y+2],c[0]=e[b],c[1]=e[b+1],c[2]=e[b+2]),q.subVec3(c,l,p),q.subVec3(h,l,d),q.cross3Vec3(p,d,f),q.normalizeVec3(f,m);var x=r[n]||(r[n]={normal:q.vec3()});x.normal[0]=m[0],x.normal[1]=m[1],x.normal[2]=m[2],n++}}(g.length,_);for(var b,x,P,T,w,M,I,C,D,A,k=[],E=Math.cos(q.DEGTORAD*y),F={},R=!1,S=0,O=g.length;S<O;S+=3)for(var B=S/3,L=0;L<3;L++)b=s[S+L],x=s[S+(L+1)%3],void 0===F[w=(P=Math.min(b,x))+","+(T=Math.max(b,x))]?F[w]={index1:P,index2:T,face1:B,face2:void 0}:F[w].face2=B;for(w in F)void 0!==(M=F[w]).face2&&(I=r[M.face1].normal,C=r[M.face2].normal,q.dotVec3(I,C)>E)||(D=i[M.index1],A=i[M.index2],(!R&&D>65535||A>65535)&&(R=!0),k.push(D),k.push(A));return R?new Uint32Array(k):new Uint16Array(k)}}(),At=function(){function e(t,i,s,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;w(this,e),this.model=t,this.object=null,this.parent=null,this.id=i,this.pickId=this.model.scene._renderer.getPickID(this),this.aabb=q.AABB3(),this._layer=n,this._portionId=o,this._color=[s[0],s[1],s[2],r],this._colorize=[s[0],s[1],s[2],r],this._colorizing=!1,this._transparent=r<255,this.numTriangles=0,this.origin=null}return I(e,[{key:"_finalize",value:function(e){this._layer.initFlags(this._portionId,e,this._transparent)}},{key:"_finalize2",value:function(){this._layer.flushInitFlags&&this._layer.flushInitFlags()}},{key:"_setVisible",value:function(e){this._layer.setVisible(this._portionId,e,this._transparent)}},{key:"_setColor",value:function(e){this._color[0]=e[0],this._color[1]=e[1],this._color[2]=e[2],this._colorizing||this._layer.setColor(this._portionId,this._color,!1)}},{key:"_setColorize",value:function(e){e?(this._colorize[0]=e[0],this._colorize[1]=e[1],this._colorize[2]=e[2],this._layer.setColor(this._portionId,this._colorize,false),this._colorizing=!0):(this._layer.setColor(this._portionId,this._color,false),this._colorizing=!1)}},{key:"_setOpacity",value:function(e,t){var i=e<255,s=this._transparent!==i;this._color[3]=e,this._colorize[3]=e,this._transparent=i,this._colorizing?this._layer.setColor(this._portionId,this._colorize):this._layer.setColor(this._portionId,this._color),s&&this._layer.setTransparent(this._portionId,t,i)}},{key:"_setOffset",value:function(e){this._layer.setOffset(this._portionId,e)}},{key:"_setHighlighted",value:function(e){this._layer.setHighlighted(this._portionId,e,this._transparent)}},{key:"_setXRayed",value:function(e){this._layer.setXRayed(this._portionId,e,this._transparent)}},{key:"_setSelected",value:function(e){this._layer.setSelected(this._portionId,e,this._transparent)}},{key:"_setEdges",value:function(e){this._layer.setEdges(this._portionId,e,this._transparent)}},{key:"_setClippable",value:function(e){this._layer.setClippable(this._portionId,e,this._transparent)}},{key:"_setCollidable",value:function(e){this._layer.setCollidable(this._portionId,e)}},{key:"_setPickable",value:function(e){this._layer.setPickable(this._portionId,e,this._transparent)}},{key:"_setCulled",value:function(e){this._layer.setCulled(this._portionId,e,this._transparent)}},{key:"canPickTriangle",value:function(){return!1}},{key:"drawPickTriangles",value:function(e,t){}},{key:"pickTriangleSurface",value:function(e){}},{key:"precisionRayPickSurface",value:function(e,t,i,s){return!!this._layer.precisionRayPickSurface&&this._layer.precisionRayPickSurface(this._portionId,e,t,i,s)}},{key:"canPickWorldPos",value:function(){return!0}},{key:"drawPickDepths",value:function(e){this.model.drawPickDepths(e)}},{key:"drawPickNormals",value:function(e){this.model.drawPickNormals(e)}},{key:"delegatePickedEntity",value:function(){return this.parent}},{key:"_destroy",value:function(){this.model.scene._renderer.putPickID(this.pickId)}}]),e}(),kt=1,Et=4,Ft=8,Rt=16,St=32,Ot=256,Bt=512,Lt=1024,Nt=2048,jt=new Float32Array([0,0,0]),Gt=new Uint16Array([0,0,0]),Ht=function(){function e(t,i,s,r,n,o){w(this,e),this._isObject=i,this.scene=t.scene,this.model=t,this.meshes=r,this._numTriangles=0;for(var a=0,u=this.meshes.length;a<u;a++){var h=this.meshes[a];h.parent=this,this._numTriangles+=h.numTriangles}this.id=s,this.originalSystemId=q.unglobalizeObjectId(t.id,s),this._flags=n,this._aabb=o,this._offsetAABB=q.AABB3(o),this._offset=q.vec3(),this._colorizeUpdated=!1,this._opacityUpdated=!1,this._culled=!1,this._culledVFC=!1,this._culledLOD=!1,this._isObject&&t.scene._registerObject(this)}return I(e,[{key:"isEntity",get:function(){return!0}},{key:"isModel",get:function(){return!1}},{key:"isObject",get:function(){return this._isObject}},{key:"aabb",get:function(){return this._offsetAABB}},{key:"numTriangles",get:function(){return this._numTriangles}},{key:"visible",get:function(){return this._getFlag(kt)},set:function(e){if(!!(this._flags&kt)!==e){this._flags=e?this._flags|kt:this._flags&~kt;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setVisible(this._flags);this._isObject&&this.model.scene._objectVisibilityUpdated(this),this.model.glRedraw()}}},{key:"highlighted",get:function(){return this._getFlag(Bt)},set:function(e){if(!!(this._flags&Bt)!==e){this._flags=e?this._flags|Bt:this._flags&~Bt;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setHighlighted(this._flags);this._isObject&&this.model.scene._objectHighlightedUpdated(this),this.model.glRedraw()}}},{key:"xrayed",get:function(){return this._getFlag(Ot)},set:function(e){if(!!(this._flags&Ot)!==e){this._flags=e?this._flags|Ot:this._flags&~Ot;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setXRayed(this._flags);this._isObject&&this.model.scene._objectXRayedUpdated(this),this.model.glRedraw()}}},{key:"selected",get:function(){return this._getFlag(Lt)},set:function(e){if(!!(this._flags&Lt)!==e){this._flags=e?this._flags|Lt:this._flags&~Lt;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setSelected(this._flags);this._isObject&&this.model.scene._objectSelectedUpdated(this),this.model.glRedraw()}}},{key:"edges",get:function(){return this._getFlag(Nt)},set:function(e){if(!!(this._flags&Nt)!==e){this._flags=e?this._flags|Nt:this._flags&~Nt;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setEdges(this._flags);this.model.glRedraw()}}},{key:"culledVFC",get:function(){return!!this._culledVFC},set:function(e){this._culledVFC=e,this.internalSetCulled()}},{key:"culledLOD",get:function(){return!!this._culledLOD},set:function(e){this._culledLOD=e,this.internalSetCulled()}},{key:"culled",get:function(){return!!this._culled},set:function(e){this._culled=e,this.internalSetCulled()}},{key:"internalSetCulled",value:function(){var e=!!this._culled||!!this._culledLOD||!!this._culledVFC;if(!!(this._flags&Et)!==e){this._flags=e?this._flags|Et:this._flags&~Et;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setCulled(this._flags);this.model.glRedraw()}}},{key:"clippable",get:function(){return this._getFlag(Rt)},set:function(e){if(!!(this._flags&Rt)!==e){this._flags=e?this._flags|Rt:this._flags&~Rt;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setClippable(this._flags);this.model.glRedraw()}}},{key:"collidable",get:function(){return this._getFlag(St)},set:function(e){if(!!(this._flags&St)!==e){this._flags=e?this._flags|St:this._flags&~St;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setCollidable(this._flags)}}},{key:"pickable",get:function(){return this._getFlag(Ft)},set:function(e){if(!!(this._flags&Ft)!==e){this._flags=e?this._flags|Ft:this._flags&~Ft;for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setPickable(this._flags)}}},{key:"colorize",get:function(){if(0===this.meshes.length)return null;var e=this.meshes[0]._colorize;return jt[0]=e[0]/255,jt[1]=e[1]/255,jt[2]=e[2]/255,jt},set:function(e){if(e){Gt[0]=Math.floor(255*e[0]),Gt[1]=Math.floor(255*e[1]),Gt[2]=Math.floor(255*e[2]);for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setColorize(Gt)}else for(var s=0,r=this.meshes.length;s<r;s++)this.meshes[s]._setColorize(null);if(this._isObject){var n=!!e;this.scene._objectColorizeUpdated(this,n),this._colorizeUpdated=n}this.model.glRedraw()}},{key:"opacity",get:function(){return this.meshes.length>0?this.meshes[0]._colorize[3]/255:1},set:function(e){if(0!==this.meshes.length){var t=null!=e,i=this.meshes[0]._colorize[3],s=255;if(t){if(e<0?e=0:e>1&&(e=1),i===(s=Math.floor(255*e)))return}else if(i===(s=255))return;for(var r=0,n=this.meshes.length;r<n;r++)this.meshes[r]._setOpacity(s,this._flags);this._isObject&&(this.scene._objectOpacityUpdated(this,t),this._opacityUpdated=t),this.model.glRedraw()}}},{key:"offset",get:function(){return this._offset},set:function(e){e?(this._offset[0]=e[0],this._offset[1]=e[1],this._offset[2]=e[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._setOffset(this._offset);this._offsetAABB[0]=this._aabb[0]+this._offset[0],this._offsetAABB[1]=this._aabb[1]+this._offset[1],this._offsetAABB[2]=this._aabb[2]+this._offset[2],this._offsetAABB[3]=this._aabb[3]+this._offset[0],this._offsetAABB[4]=this._aabb[4]+this._offset[1],this._offsetAABB[5]=this._aabb[5]+this._offset[2],this.scene._aabbDirty=!0,this.scene._objectOffsetUpdated(this,e),this.model._aabbDirty=!0,this.model.glRedraw()}},{key:"castsShadow",get:function(){return!1},set:function(e){}},{key:"receivesShadow",get:function(){return!1},set:function(e){}},{key:"saoEnabled",get:function(){return this.model.saoEnabled}},{key:"_getFlag",value:function(e){return!!(this._flags&e)}},{key:"_finalize",value:function(){var e=this.model.scene;this._isObject&&(this.visible&&e._objectVisibilityUpdated(this),this.highlighted&&e._objectHighlightedUpdated(this),this.xrayed&&e._objectXRayedUpdated(this),this.selected&&e._objectSelectedUpdated(this));for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._finalize(this._flags)}},{key:"_finalize2",value:function(){for(var e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._finalize2()}},{key:"_destroy",value:function(){var e=this.model.scene;this._isObject&&(e._deregisterObject(this),this.visible&&e._objectVisibilityUpdated(this,!1),this.xrayed&&e._objectXRayedUpdated(this),this.selected&&e._objectSelectedUpdated(this),this.highlighted&&e._objectHighlightedUpdated(this),this._opacityUpdated&&this.scene._objectColorizeUpdated(this,!1),this._opacityUpdated&&this.scene._objectOpacityUpdated(this,!1),this.scene._objectOffsetUpdated(this,!1));for(var t=0,i=this.meshes.length;t<i;t++)this.meshes[t]._destroy();e._aabbDirty=!0}}]),e}(),Ut=0,Vt=1,zt=2,Wt=3,Xt=4,Yt=5,Kt=6,Jt=7,Zt=8,Qt=9,qt=10,$t=11,ei=new G({}),ti=function(){function e(t){for(var i in w(this,e),this.id=ei.addItem({}),t)t.hasOwnProperty(i)&&(this[i]=t[i])}return I(e,[{key:"destroy",value:function(){ei.removeItem(this.id)}}]),e}();var ii=function(){var e=q.mat4(),t=q.mat4();return function(i,s){s=s||q.mat4();var r=i[0],n=i[1],o=i[2],a=i[3]-r,u=i[4]-n,h=i[5]-o,l=65535;return q.identityMat4(e),q.translationMat4v(i,e),q.identityMat4(t),q.scalingMat4v([a/l,u/l,h/l],t),q.mulMat4(e,t,s),s}}(),si=function(){var e=q.mat4(),t=q.mat4();return function(i,s,r){var n,o=new Uint16Array(i.length),a=new Float32Array([r[0]!==s[0]?65535/(r[0]-s[0]):0,r[1]!==s[1]?65535/(r[1]-s[1]):0,r[2]!==s[2]?65535/(r[2]-s[2]):0]);for(n=0;n<i.length;n+=3)o[n+0]=Math.max(0,Math.min(65535,Math.floor((i[n+0]-s[0])*a[0]))),o[n+1]=Math.max(0,Math.min(65535,Math.floor((i[n+1]-s[1])*a[1]))),o[n+2]=Math.max(0,Math.min(65535,Math.floor((i[n+2]-s[2])*a[2])));return q.identityMat4(e),q.translationMat4v(s,e),q.identityMat4(t),q.scalingMat4v([(r[0]-s[0])/65535,(r[1]-s[1])/65535,(r[2]-s[2])/65535],t),{quantized:o,decodeMatrix:q.mulMat4(e,t,q.identityMat4())}}}();var ri=function(){var e=q.mat3(),t=q.mat3();return function(i,s,r){var n,o=new Uint16Array(i.length),a=new Float32Array([65535/(r[0]-s[0]),65535/(r[1]-s[1])]);for(n=0;n<i.length;n+=2)o[n+0]=Math.max(0,Math.min(65535,Math.floor((i[n+0]-s[0])*a[0]))),o[n+1]=Math.max(0,Math.min(65535,Math.floor((i[n+1]-s[1])*a[1])));return q.identityMat3(e),q.translationMat3v(s,e),q.identityMat3(t),q.scalingMat3v([(r[0]-s[0])/65535,(r[1]-s[1])/65535],t),{quantized:o,decodeMatrix:q.mulMat3(e,t,q.identityMat3())}}}();function ni(e,t,i,s){var r=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),n=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){var o=(1-Math.abs(n))*(r>=0?1:-1),a=(1-Math.abs(r))*(n>=0?1:-1);r=o,n=a}return new Int8Array([Math[i](127.5*r+(r<0?-1:0)),Math[s](127.5*n+(n<0?-1:0))])}function oi(e){var t=e[0],i=e[1];t/=t<0?127:128,i/=i<0?127:128;var s=1-Math.abs(t)-Math.abs(i);s<0&&(t=(1-Math.abs(i))*(t>=0?1:-1),i=(1-Math.abs(t))*(i>=0?1:-1));var r=Math.sqrt(t*t+i*i+s*s);return[t/r,i/r,s/r]}function ai(e,t,i){return e[t]*i[0]+e[t+1]*i[1]+e[t+2]*i[2]}var ui={getPositionsBounds:function(e){var t,i,s=new Float32Array(3),r=new Float32Array(3);for(t=0;t<3;t++)s[t]=Number.MAX_VALUE,r[t]=-Number.MAX_VALUE;for(t=0;t<e.length;t+=3)for(i=0;i<3;i++)s[i]=Math.min(s[i],e[t+i]),r[i]=Math.max(r[i],e[t+i]);return{min:s,max:r}},createPositionsDecodeMatrix:ii,compressPositions:si,compressPosition:function(e,t,i){var s=new Float32Array([t[3]!==t[0]?65535/(t[3]-t[0]):0,t[4]!==t[1]?65535/(t[4]-t[1]):0,t[5]!==t[2]?65535/(t[5]-t[2]):0]);i[0]=Math.max(0,Math.min(65535,Math.floor((e[0]-t[0])*s[0]))),i[1]=Math.max(0,Math.min(65535,Math.floor((e[1]-t[1])*s[1]))),i[2]=Math.max(0,Math.min(65535,Math.floor((e[2]-t[2])*s[2])))},decompressPositions:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Float32Array(e.length),s=0,r=e.length;s<r;s+=3)i[s+0]=e[s+0]*t[0]+t[12],i[s+1]=e[s+1]*t[5]+t[13],i[s+2]=e[s+2]*t[10]+t[14];return i},decompressPosition:function(e,t,i){return i[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14],i},decompressAABB:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;return i[0]=e[0]*t[0]+t[12],i[1]=e[1]*t[5]+t[13],i[2]=e[2]*t[10]+t[14],i[3]=e[3]*t[0]+t[12],i[4]=e[4]*t[5]+t[13],i[5]=e[5]*t[10]+t[14],i},getUVBounds:function(e){var t,i,s=new Float32Array(2),r=new Float32Array(2);for(t=0;t<2;t++)s[t]=Number.MAX_VALUE,r[t]=-Number.MAX_VALUE;for(t=0;t<e.length;t+=2)for(i=0;i<2;i++)s[i]=Math.min(s[i],e[t+i]),r[i]=Math.max(r[i],e[t+i]);return{min:s,max:r}},compressUVs:ri,decompressUVs:function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Float32Array(e.length),s=0,r=e.length;s<r;s+=3)i[s+0]=e[s+0]*t[0]+t[6],i[s+1]=e[s+1]*t[4]+t[7];return i},decompressUV:function(e,t,i){i[0]=e[0]*t[0]+t[6],i[1]=e[1]*t[4]+t[7]},compressNormals:function(e){for(var t,i,s,r,n=new Int8Array(e.length),o=0;o<e.length;o+=3)i=t=ni(e,o,"floor","floor"),s=r=ai(e,o,oi(t)),(s=ai(e,o,oi(t=ni(e,o,"ceil","floor"))))>r&&(i=t,r=s),(s=ai(e,o,oi(t=ni(e,o,"floor","ceil"))))>r&&(i=t,r=s),(s=ai(e,o,oi(t=ni(e,o,"ceil","ceil"))))>r&&(i=t,r=s),n[o]=i[0],n[o+1]=i[1];return n},decompressNormals:function(e,t){for(var i=0,s=0,r=e.length;i<r;i+=2){var n=e[i+0],o=e[i+1];n=(2*n+1)/255,o=(2*o+1)/255;var a=1-Math.abs(n)-Math.abs(o);a<0&&(n=(1-Math.abs(o))*(n>=0?1:-1),o=(1-Math.abs(n))*(o>=0?1:-1));var u=Math.sqrt(n*n+o*o+a*a);t[s+0]=n/u,t[s+1]=o/u,t[s+2]=a/u,s+=3}return t},decompressNormal:function(e,t){var i=e[0],s=e[1];i=(2*i+1)/255,s=(2*s+1)/255;var r=1-Math.abs(i)-Math.abs(s);r<0&&(i=(1-Math.abs(s))*(i>=0?1:-1),s=(1-Math.abs(i))*(s>=0?1:-1));var n=Math.sqrt(i*i+s*s+r*r);return t[0]=i/n,t[1]=s/n,t[2]=r/n,t}},hi=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r)).camera=e,s._state=new ti({matrix:q.mat4(),inverseMatrix:q.mat4(),transposedMatrix:q.mat4(),near:.1,far:2e3}),s._inverseMatrixDirty=!0,s._transposedMatrixDirty=!0,s._fov=60,s._canvasResized=s.scene.canvas.on("boundary",s._needUpdate,x(s)),s.fov=r.fov,s.fovAxis=r.fovAxis,s.near=r.near,s.far=r.far,s}return I(i,[{key:"type",get:function(){return"Perspective"}},{key:"_update",value:function(){var e=this.scene.viewport.boundary,t=e[2]/e[3],i=this._fovAxis,s=this._fov;("x"===i||"min"===i&&t<1||"max"===i&&t>1)&&(s/=t),s=Math.min(s,120),q.perspectiveMat4(s*(Math.PI/180),t,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}},{key:"fov",get:function(){return this._fov},set:function(e){(e=null!=e?e:60)!==this._fov&&(this._fov=e,this._needUpdate(0),this.fire("fov",this._fov))}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(e){e=e||"min",this._fovAxis!==e&&("x"!==e&&"y"!==e&&"min"!==e&&(this.error("Unsupported value for 'fovAxis': "+e+" - defaulting to 'min'"),e="min"),this._fovAxis=e,this._needUpdate(0),this.fire("fovAxis",this._fovAxis))}},{key:"near",get:function(){return this._state.near},set:function(e){var t=null!=e?e:.1;this._state.near!==t&&(this._state.near=t,this._needUpdate(0),this.fire("near",this._state.near))}},{key:"far",get:function(){return this._state.far},set:function(e){var t=null!=e?e:2e3;this._state.far!==t&&(this._state.far=t,this._needUpdate(0),this.fire("far",this._state.far))}},{key:"matrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}},{key:"inverseMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(q.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}},{key:"transposedMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(q.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}},{key:"unproject",value:function(e,t,i,s,r){var n=this.scene.canvas.canvas,o=n.offsetWidth/2,a=n.offsetHeight/2;return i[0]=(e[0]-o)/o,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,q.mulMat4v4(this.inverseMatrix,i,s),q.mulVec3Scalar(s,1/s[3]),s[3]=1,s[1]*=-1,q.mulMat4v4(this.camera.inverseViewMatrix,s,r),r}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy(),this.scene.canvas.off(this._canvasResized)}}]),i}(),li=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r)).camera=e,s._state=new ti({matrix:q.mat4(),inverseMatrix:q.mat4(),transposedMatrix:q.mat4(),near:.1,far:2e3}),s._inverseMatrixDirty=!0,s._transposedMatrixDirty=!0,s.scale=r.scale,s.near=r.near,s.far=r.far,s._onCanvasBoundary=s.scene.canvas.on("boundary",s._needUpdate,x(s)),s}return I(i,[{key:"type",get:function(){return"Ortho"}},{key:"_update",value:function(){var e,t,i,s,r=this.scene,n=.5*this._scale,o=r.viewport.boundary,a=o[2],u=o[3],h=a/u;a>u?(e=-n,t=n,i=n/h,s=-n/h):(e=-n*h,t=n*h,i=n,s=-n),q.orthoMat4c(e,t,s,i,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}},{key:"scale",get:function(){return this._scale},set:function(e){null==e&&(e=1),e<=0&&(e=.01),this._scale=e,this._needUpdate(0),this.fire("scale",this._scale)}},{key:"near",get:function(){return this._state.near},set:function(e){var t=null!=e?e:.1;this._state.near!==t&&(this._state.near=t,this._needUpdate(0),this.fire("near",this._state.near))}},{key:"far",get:function(){return this._state.far},set:function(e){var t=null!=e?e:2e3;this._state.far!==t&&(this._state.far=t,this._needUpdate(0),this.fire("far",this._state.far))}},{key:"matrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}},{key:"inverseMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(q.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}},{key:"transposedMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(q.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}},{key:"unproject",value:function(e,t,i,s,r){var n=this.scene.canvas.canvas,o=n.offsetWidth/2,a=n.offsetHeight/2;return i[0]=(e[0]-o)/o,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,q.mulMat4v4(this.inverseMatrix,i,s),q.mulVec3Scalar(s,1/s[3]),s[3]=1,s[1]*=-1,q.mulMat4v4(this.camera.inverseViewMatrix,s,r),r}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy(),this.scene.canvas.off(this._onCanvasBoundary)}}]),i}(),ci=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r)).camera=e,s._state=new ti({matrix:q.mat4(),inverseMatrix:q.mat4(),transposedMatrix:q.mat4(),near:.1,far:1e4}),s._left=-1,s._right=1,s._bottom=-1,s._top=1,s._inverseMatrixDirty=!0,s._transposedMatrixDirty=!0,s.left=r.left,s.right=r.right,s.bottom=r.bottom,s.top=r.top,s.near=r.near,s.far=r.far,s}return I(i,[{key:"type",get:function(){return"Frustum"}},{key:"_update",value:function(){q.frustumMat4(this._left,this._right,this._bottom,this._top,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}},{key:"left",get:function(){return this._left},set:function(e){this._left=null!=e?e:-1,this._needUpdate(0),this.fire("left",this._left)}},{key:"right",get:function(){return this._right},set:function(e){this._right=null!=e?e:1,this._needUpdate(0),this.fire("right",this._right)}},{key:"top",get:function(){return this._top},set:function(e){this._top=null!=e?e:1,this._needUpdate(0),this.fire("top",this._top)}},{key:"bottom",get:function(){return this._bottom},set:function(e){this._bottom=null!=e?e:-1,this._needUpdate(0),this.fire("bottom",this._bottom)}},{key:"near",get:function(){return this._state.near},set:function(e){this._state.near=null!=e?e:.1,this._needUpdate(0),this.fire("near",this._state.near)}},{key:"far",get:function(){return this._state.far},set:function(e){this._state.far=null!=e?e:1e4,this._needUpdate(0),this.fire("far",this._state.far)}},{key:"matrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}},{key:"inverseMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(q.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}},{key:"transposedMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(q.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}},{key:"unproject",value:function(e,t,i,s,r){var n=this.scene.canvas.canvas,o=n.offsetWidth/2,a=n.offsetHeight/2;return i[0]=(e[0]-o)/o,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,q.mulMat4v4(this.inverseMatrix,i,s),q.mulVec3Scalar(s,1/s[3]),s[3]=1,s[1]*=-1,q.mulMat4v4(this.camera.inverseViewMatrix,s,r),r}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy(),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),pi=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r)).camera=e,s._state=new ti({matrix:q.mat4(),inverseMatrix:q.mat4(),transposedMatrix:q.mat4()}),s._inverseMatrixDirty=!0,s._transposedMatrixDirty=!1,s.matrix=r.matrix,s}return I(i,[{key:"type",get:function(){return"CustomProjection"}},{key:"matrix",get:function(){return this._state.matrix},set:function(e){this._state.matrix.set(e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}},{key:"inverseMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(q.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}},{key:"transposedMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(q.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}},{key:"unproject",value:function(e,t,i,s,r){var n=this.scene.canvas.canvas,o=n.offsetWidth/2,a=n.offsetHeight/2;return i[0]=(e[0]-o)/o,i[1]=(e[1]-a)/a,i[2]=t,i[3]=1,q.mulMat4v4(this.inverseMatrix,i,s),q.mulVec3Scalar(s,1/s[3]),s[3]=1,s[1]*=-1,q.mulMat4v4(this.camera.inverseViewMatrix,s,r),r}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy()}}]),i}(),di=q.vec3(),fi=q.vec3(),mi=q.vec3(),vi=q.vec3(),gi=q.vec3(),_i=q.vec3(),yi=q.mat4(),bi=q.mat4(),xi=q.vec3(),Pi=q.vec3(),Ti=q.vec3(),wi=q.vec3(),Mi=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._state=new ti({deviceMatrix:q.mat4(),hasDeviceMatrix:!1,matrix:q.mat4(),normalMatrix:q.mat4(),inverseMatrix:q.mat4()}),s._perspective=new hi(x(s)),s._ortho=new li(x(s)),s._frustum=new ci(x(s)),s._customProjection=new pi(x(s)),s._project=s._perspective,s._eye=q.vec3([0,0,10]),s._look=q.vec3([0,0,0]),s._up=q.vec3([0,1,0]),s._worldUp=q.vec3([0,1,0]),s._worldRight=q.vec3([1,0,0]),s._worldForward=q.vec3([0,0,-1]),s.deviceMatrix=r.deviceMatrix,s.eye=r.eye,s.look=r.look,s.up=r.up,s.worldAxis=r.worldAxis,s.gimbalLock=r.gimbalLock,s.constrainPitch=r.constrainPitch,s.projection=r.projection,s._perspective.on("matrix",(function(){"perspective"===s._projectionType&&s.fire("projMatrix",s._perspective.matrix)})),s._ortho.on("matrix",(function(){"ortho"===s._projectionType&&s.fire("projMatrix",s._ortho.matrix)})),s._frustum.on("matrix",(function(){"frustum"===s._projectionType&&s.fire("projMatrix",s._frustum.matrix)})),s._customProjection.on("matrix",(function(){"customProjection"===s._projectionType&&s.fire("projMatrix",s._customProjection.matrix)})),s}return I(i,[{key:"type",get:function(){return"Camera"}},{key:"_update",value:function(){var e,t=this._state;"ortho"===this.projection?(q.subVec3(this._eye,this._look,xi),q.normalizeVec3(xi,Pi),q.mulVec3Scalar(Pi,1e3,Ti),q.addVec3(this._look,Ti,wi),e=wi):e=this._eye,t.hasDeviceMatrix?(q.lookAtMat4v(e,this._look,this._up,bi),q.mulMat4(t.deviceMatrix,bi,t.matrix)):q.lookAtMat4v(e,this._look,this._up,t.matrix),q.inverseMat4(this._state.matrix,this._state.inverseMatrix),q.transposeMat4(this._state.inverseMatrix,this._state.normalMatrix),this.glRedraw(),this.fire("matrix",this._state.matrix),this.fire("viewMatrix",this._state.matrix)}},{key:"orbitYaw",value:function(e){var t=q.subVec3(this._eye,this._look,di);q.rotationMat4v(.0174532925*e,this._gimbalLock?this._worldUp:this._up,yi),t=q.transformPoint3(yi,t,fi),this.eye=q.addVec3(this._look,t,mi),this.up=q.transformPoint3(yi,this._up,vi)}},{key:"orbitPitch",value:function(e){if(!(this._constrainPitch&&(e=q.dotVec3(this._up,this._worldUp)/q.DEGTORAD)<1)){var t=q.subVec3(this._eye,this._look,di),i=q.cross3Vec3(q.normalizeVec3(t,fi),q.normalizeVec3(this._up,mi));q.rotationMat4v(.0174532925*e,i,yi),t=q.transformPoint3(yi,t,vi),this.up=q.transformPoint3(yi,this._up,gi),this.eye=q.addVec3(t,this._look,_i)}}},{key:"yaw",value:function(e){var t=q.subVec3(this._look,this._eye,di);q.rotationMat4v(.0174532925*e,this._gimbalLock?this._worldUp:this._up,yi),t=q.transformPoint3(yi,t,fi),this.look=q.addVec3(t,this._eye,mi),this._gimbalLock&&(this.up=q.transformPoint3(yi,this._up,vi))}},{key:"pitch",value:function(e){if(!(this._constrainPitch&&(e=q.dotVec3(this._up,this._worldUp)/q.DEGTORAD)<1)){var t=q.subVec3(this._look,this._eye,di),i=q.cross3Vec3(q.normalizeVec3(t,fi),q.normalizeVec3(this._up,mi));q.rotationMat4v(.0174532925*e,i,yi),this.up=q.transformPoint3(yi,this._up,_i),t=q.transformPoint3(yi,t,vi),this.look=q.addVec3(t,this._eye,gi)}}},{key:"pan",value:function(e){var t,i=q.subVec3(this._eye,this._look,di),s=[0,0,0];if(0!==e[0]){var r=q.cross3Vec3(q.normalizeVec3(i,[]),q.normalizeVec3(this._up,fi));t=q.mulVec3Scalar(r,e[0]),s[0]+=t[0],s[1]+=t[1],s[2]+=t[2]}0!==e[1]&&(t=q.mulVec3Scalar(q.normalizeVec3(this._up,mi),e[1]),s[0]+=t[0],s[1]+=t[1],s[2]+=t[2]),0!==e[2]&&(t=q.mulVec3Scalar(q.normalizeVec3(i,vi),e[2]),s[0]+=t[0],s[1]+=t[1],s[2]+=t[2]),this.eye=q.addVec3(this._eye,s,gi),this.look=q.addVec3(this._look,s,_i)}},{key:"zoom",value:function(e){var t=q.subVec3(this._eye,this._look,di),i=Math.abs(q.lenVec3(t,fi)),s=Math.abs(i+e);if(!(s<.5)){var r=q.normalizeVec3(t,mi);this.eye=q.addVec3(this._look,q.mulVec3Scalar(r,s),vi)}}},{key:"eye",get:function(){return this._eye},set:function(e){this._eye.set(e||[0,0,10]),this._needUpdate(0),this.fire("eye",this._eye)}},{key:"look",get:function(){return this._look},set:function(e){this._look.set(e||[0,0,0]),this._needUpdate(0),this.fire("look",this._look)}},{key:"up",get:function(){return this._up},set:function(e){this._up.set(e||[0,1,0]),this._needUpdate(0),this.fire("up",this._up)}},{key:"deviceMatrix",get:function(){return this._state.deviceMatrix},set:function(e){this._state.deviceMatrix.set(e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._state.hasDeviceMatrix=!!e,this._needUpdate(0),this.fire("deviceMatrix",this._state.deviceMatrix)}},{key:"worldAxis",get:function(){return this._worldAxis},set:function(e){e=e||[1,0,0,0,1,0,0,0,1],this._worldAxis?this._worldAxis.set(e):this._worldAxis=q.vec3(e),this._worldRight[0]=this._worldAxis[0],this._worldRight[1]=this._worldAxis[1],this._worldRight[2]=this._worldAxis[2],this._worldUp[0]=this._worldAxis[3],this._worldUp[1]=this._worldAxis[4],this._worldUp[2]=this._worldAxis[5],this._worldForward[0]=this._worldAxis[6],this._worldForward[1]=this._worldAxis[7],this._worldForward[2]=this._worldAxis[8],this.fire("worldAxis",this._worldAxis)}},{key:"worldUp",get:function(){return this._worldUp}},{key:"xUp",get:function(){return this._worldUp[0]>this._worldUp[1]&&this._worldUp[0]>this._worldUp[2]}},{key:"yUp",get:function(){return this._worldUp[1]>this._worldUp[0]&&this._worldUp[1]>this._worldUp[2]}},{key:"zUp",get:function(){return this._worldUp[2]>this._worldUp[0]&&this._worldUp[2]>this._worldUp[1]}},{key:"worldRight",get:function(){return this._worldRight}},{key:"worldForward",get:function(){return this._worldForward}},{key:"gimbalLock",get:function(){return this._gimbalLock},set:function(e){this._gimbalLock=!1!==e,this.fire("gimbalLock",this._gimbalLock)}},{key:"constrainPitch",set:function(e){this._constrainPitch=!!e,this.fire("constrainPitch",this._constrainPitch)}},{key:"eyeLookDist",get:function(){return q.lenVec3(q.subVec3(this._look,this._eye,di))}},{key:"matrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}},{key:"viewMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}},{key:"normalMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.normalMatrix}},{key:"viewNormalMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.normalMatrix}},{key:"inverseViewMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.inverseMatrix}},{key:"projMatrix",get:function(){return this[this.projection].matrix}},{key:"perspective",get:function(){return this._perspective}},{key:"ortho",get:function(){return this._ortho}},{key:"frustum",get:function(){return this._frustum}},{key:"customProjection",get:function(){return this._customProjection}},{key:"projection",get:function(){return this._projectionType},set:function(e){e=e||"perspective",this._projectionType!==e&&("perspective"===e?this._project=this._perspective:"ortho"===e?this._project=this._ortho:"frustum"===e?this._project=this._frustum:"customProjection"===e?this._project=this._customProjection:(this.error("Unsupported value for 'projection': "+e+" defaulting to 'perspective'"),this._project=this._perspective,e="perspective"),this._project._update(),this._projectionType=e,this.glRedraw(),this._update(),this.fire("dirty"),this.fire("projection",this._projectionType),this.fire("projMatrix",this._project.matrix))}},{key:"project",get:function(){return this._project}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy()}}]),i}(),Ii=q.vec4(),Ci=q.vec3(),Di=function(){function e(t,i){w(this,e),this._scene=t,this._withSAO=i,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){var e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}},{key:"drawLayer",value:function(e,t,i){var s=this._scene,r=s.camera,n=t.model,o=s.canvas.gl,a=t._state,u=a.textureState,h=t._state.origin;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e,a)),u.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets);var l=r.eye;e.pickViewMatrix&&(u.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),l=e.pickOrigin||l);var c=[l[0]-h[0],l[1]-h[1],l[2]-h[2]];o.uniform3fv(this._uCameraEyeRtc,c),o.uniform1i(this._uRenderPass,i);var p=s._sectionPlanesState.sectionPlanes.length;if(p>0)for(var d=s._sectionPlanesState.sectionPlanes,f=t.layerIndex*p,m=n.renderFlags,v=0;v<p;v++){var g=this._uSectionPlanes[v];if(g){var _=m.sectionPlanesActivePerLayer[f+v];if(o.uniform1i(g.active,_?1:0),_){var y=d[v];if(h){var b=Ee(y.dist,y.dir,h,Ci);o.uniform3fv(g.pos,b)}else o.uniform3fv(g.pos,y.pos);o.uniform3fv(g.dir,y.dir)}}}a.numIndices8Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,8),o.drawArrays(o.TRIANGLES,0,a.numIndices8Bits)),a.numIndices16Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,16),o.drawArrays(o.TRIANGLES,0,a.numIndices16Bits)),a.numIndices32Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,32),o.drawArrays(o.TRIANGLES,0,a.numIndices32Bits)),e.drawElements++}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];for(var r=i.lights,n=0,o=r.length;n<o;n++)switch(r[n].type){case"dir":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=null,this._uLightDir[n]=s.getLocation("lightDir"+n);break;case"point":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=null,this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n);break;case"spot":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=s.getLocation("lightDir"+n),this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n)}this._uSectionPlanes=[];for(var a=0,u=e._sectionPlanesState.sectionPlanes.length;a<u;a++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+a),pos:s.getLocation("sectionPlanePos"+a),dir:s.getLocation("sectionPlaneDir"+a)});this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdNormals="uTexturePerPolygonIdNormals",this._uTexturePerPolygonIdIndices="uTexturePerPolygonIdIndices",this._uTexturePerPolygonIdPortionIds="uTexturePerPolygonIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets",this._uCameraEyeRtc=s.getLocation("uCameraEyeRtc")}}},{key:"_bindProgram",value:function(e){var t=this._scene,i=t.canvas.gl,s=this._program,r=t._lightsState.lights,n=t.camera.project;s.bind(),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(var o=0,a=r.length;o<a;o++){var u=r[o];this._uLightColor[o]&&i.uniform4f(this._uLightColor[o],u.color[0],u.color[1],u.color[2],u.intensity),this._uLightPos[o]&&(i.uniform3fv(this._uLightPos[o],u.pos),this._uLightAttenuation[o]&&i.uniform1f(this._uLightAttenuation[o],u.attenuation)),this._uLightDir[o]&&i.uniform3fv(this._uLightDir[o],u.dir)}if(this._withSAO){var h=t.sao;if(h.possible){var l=i.drawingBufferWidth,c=i.drawingBufferHeight;Ii[0]=l,Ii[1]=c,Ii[2]=h.blendCutoff,Ii[3]=h.blendFactor,i.uniform4fv(this._uSAOParams,Ii),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,10)}}if(t.logarithmicDepthBufferEnabled){var p=2/(Math.log(n.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,p)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e,t=this._scene,i=t._sectionPlanesState,s=t._lightsState,r=i.sectionPlanes.length>0,n=[];n.push("#version 300 es"),n.push("// Triangles dataTexture draw vertex shader"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("precision highp usampler2D;"),n.push("precision highp isampler2D;"),n.push("precision highp sampler2D;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("precision mediump usampler2D;"),n.push("precision mediump isampler2D;"),n.push("precision mediump sampler2D;"),n.push("#endif"),n.push("uniform int renderPass;"),t.entityOffsetsEnabled&&n.push("in vec3 offset;"),n.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),n.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),n.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),n.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),n.push("uniform highp usampler2D uTexturePerPolygonIdIndices;"),n.push("uniform mediump usampler2D uTexturePerPolygonIdPortionIds;"),n.push("uniform highp sampler2D uTextureCameraMatrices;"),n.push("uniform highp sampler2D uTextureModelMatrices;"),n.push("uniform vec3 uCameraEyeRtc;"),n.push("vec3 positions[3];"),t.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),n.push("out float vFragDepth;"),n.push("out float isPerspective;")),n.push("bool isPerspectiveMatrix(mat4 m) {"),n.push("    return (m[2][3] == - 1.0);"),n.push("}"),n.push("uniform vec4 lightAmbient;");for(var o=0,a=s.lights.length;o<a;o++)"ambient"!==(e=s.lights[o]).type&&(n.push("uniform vec4 lightColor"+o+";"),"dir"===e.type&&n.push("uniform vec3 lightDir"+o+";"),"point"===e.type&&n.push("uniform vec3 lightPos"+o+";"),"spot"===e.type&&(n.push("uniform vec3 lightPos"+o+";"),n.push("uniform vec3 lightDir"+o+";")));r&&(n.push("out vec4 vWorldPosition;"),n.push("flat out uint vFlags2;")),n.push("out vec4 vColor;"),n.push("void main(void) {"),n.push("int polygonIndex = gl_VertexID / 3;"),n.push("int h_packed_object_id_index = (polygonIndex >> 3) & 4095;"),n.push("int v_packed_object_id_index = (polygonIndex >> 3) >> 12;"),n.push("int objectIndex = int(texelFetch(uTexturePerPolygonIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),n.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),n.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),n.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),n.push("if (int(flags.x) != renderPass) {"),n.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),n.push("   return;"),n.push("} else {"),n.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),n.push("mat4 viewNormalMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 1), 0));"),n.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),n.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),n.push("mat4 worldNormalMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 1), 0), texelFetch (uTextureModelMatrices, ivec2(1, 1), 0), texelFetch (uTextureModelMatrices, ivec2(2, 1), 0), texelFetch (uTextureModelMatrices, ivec2(3, 1), 0));"),n.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),n.push("ivec4 packedIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0));"),n.push("int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;"),n.push("int h_index = (polygonIndex - indexBaseOffset) & 4095;"),n.push("int v_index = (polygonIndex - indexBaseOffset) >> 12;"),n.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdIndices, ivec2(h_index, v_index), 0));"),n.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),n.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),n.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),n.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),n.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),n.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),n.push("uint solid = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0).r;"),n.push("positions[0] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.r, indexPositionV.r), 0));"),n.push("positions[1] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.g, indexPositionV.g), 0));"),n.push("positions[2] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.b, indexPositionV.b), 0));"),n.push("uvec4 color = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0);"),n.push("if (color.a == 0u) {"),n.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),n.push("   return;"),n.push("};"),n.push("vec3 normal = normalize(cross(positions[2] - positions[0], positions[1] - positions[0]));"),n.push("vec3 position;"),n.push("position = positions[gl_VertexID % 3];"),n.push("vec3 viewNormal = -normalize((transpose(inverse(viewMatrix*positionsDecodeMatrix)) * vec4(normal,1)).xyz);"),n.push("if (solid != 1u) {"),n.push("if (isPerspectiveMatrix(projMatrix)) {"),n.push("vec3 uCameraEyeRtcInQuantizedSpace = (inverse(worldMatrix * positionsDecodeMatrix) * vec4(uCameraEyeRtc, 1)).xyz;"),n.push("if (dot(position.xyz - uCameraEyeRtcInQuantizedSpace, normal) < 0.0) {"),n.push("position = positions[2 - (gl_VertexID % 3)];"),n.push("viewNormal = -viewNormal;"),n.push("}"),n.push("} else {"),n.push("if (viewNormal.z < 0.0) {"),n.push("position = positions[2 - (gl_VertexID % 3)];"),n.push("viewNormal = -viewNormal;"),n.push("}"),n.push("}"),n.push("}"),n.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),n.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),n.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),n.push("vec4 viewPosition = viewMatrix * worldPosition; "),n.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),n.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),n.push("float lambertian = 1.0;");for(var u=0,h=s.lights.length;u<h;u++)if("ambient"!==(e=s.lights[u]).type){if("dir"===e.type)"view"===e.space?n.push("viewLightDir = normalize(lightDir"+u+");"):n.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+u+", 0.0)).xyz);");else if("point"===e.type)"view"===e.space?n.push("viewLightDir = -normalize(lightPos"+u+" - viewPosition.xyz);"):n.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+u+", 0.0)).xyz);");else{if("spot"!==e.type)continue;"view"===e.space?n.push("viewLightDir = normalize(lightDir"+u+");"):n.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+u+", 0.0)).xyz);")}n.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),n.push("reflectedColor += lambertian * (lightColor"+u+".rgb * lightColor"+u+".a);")}return n.push("vec3 rgb = vec3(color.rgb) / 255.0;"),n.push("vColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),n.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(n.push("vFragDepth = 1.0 + clipPos.w;"),n.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),r&&(n.push("vWorldPosition = worldPosition;"),n.push("vFlags2 = flags2.r;")),n.push("gl_Position = clipPos;"),n.push("}"),n.push("}"),n}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Triangles dataTexture draw fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),this._withSAO&&(s.push("uniform sampler2D uOcclusionTexture;"),s.push("uniform vec4      uSAOParams;"),s.push("const float       packUpscale = 256. / 255.;"),s.push("const float       unpackDownScale = 255. / 256.;"),s.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),s.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),s.push("float unpackRGBToFloat( const in vec4 v ) {"),s.push("    return dot( v, unPackFactors );"),s.push("}")),i){s.push("in vec4 vWorldPosition;"),s.push("flat in uint vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = vFlags2 > 0u;"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { "),s.push("      discard;"),s.push("  }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),this._withSAO?(s.push("   float viewportWidth     = uSAOParams[0];"),s.push("   float viewportHeight    = uSAOParams[1];"),s.push("   float blendCutoff       = uSAOParams[2];"),s.push("   float blendFactor       = uSAOParams[3];"),s.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),s.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),s.push("   outColor            = vec4(vColor.rgb * ambient, 1.0);")):s.push("   outColor            = vColor;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Ai=new Float32Array([1,1,1]);q.vec4();var ki=q.vec3(),Ei=function(){function e(t,i){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=this._scene,r=s.camera,n=t.model,o=s.canvas.gl,a=t._state,u=a.textureState,h=t._state.origin;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e,a)),u.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets);var l=r.eye;e.pickViewMatrix&&(u.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),l=e.pickOrigin||l);var c=[l[0]-h[0],l[1]-h[1],l[2]-h[2]];if(o.uniform3fv(this._uCameraEyeRtc,c),o.uniform1i(this._uRenderPass,i),i===Yt){var p=s.xrayMaterial._state,d=p.fillColor,f=p.fillAlpha;o.uniform4f(this._uColor,d[0],d[1],d[2],f)}else if(i===Wt){var m=s.highlightMaterial._state,v=m.fillColor,g=m.fillAlpha;o.uniform4f(this._uColor,v[0],v[1],v[2],g)}else if(i===Xt){var _=s.selectedMaterial._state,y=_.fillColor,b=_.fillAlpha;o.uniform4f(this._uColor,y[0],y[1],y[2],b)}else o.uniform4fv(this._uColor,Ai);var x=s._sectionPlanesState.sectionPlanes.length;if(x>0)for(var P=s._sectionPlanesState.sectionPlanes,T=t.layerIndex*x,w=n.renderFlags,M=0;M<x;M++){var I=this._uSectionPlanes[M];if(I){var C=w.sectionPlanesActivePerLayer[T+M];if(o.uniform1i(I.active,C?1:0),C){var D=P[M];if(h){var A=Ee(D.dist,D.dir,h,ki);o.uniform3fv(I.pos,A)}else o.uniform3fv(I.pos,D.pos);o.uniform3fv(I.dir,D.dir)}}}a.numIndices8Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,8),o.drawArrays(o.TRIANGLES,0,a.numIndices8Bits)),a.numIndices16Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,16),o.drawArrays(o.TRIANGLES,0,a.numIndices16Bits)),a.numIndices32Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,32),o.drawArrays(o.TRIANGLES,0,a.numIndices32Bits)),e.drawElements++}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uColor=i.getLocation("color"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdNormals="uTexturePerPolygonIdNormals",this._uTexturePerPolygonIdIndices="uTexturePerPolygonIdIndices",this._uTexturePerPolygonIdPortionIds="uTexturePerPolygonIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets",this._uCameraEyeRtc=i.getLocation("uCameraEyeRtc")}}},{key:"_bindProgram",value:function(e){var t=this._scene,i=t.canvas.gl,s=t.camera.project;if(this._program.bind(),t.logarithmicDepthBufferEnabled){var r=2/(Math.log(s.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,r)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles dataTexture silhouette vertex shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("precision highp usampler2D;"),i.push("precision highp isampler2D;"),i.push("precision highp sampler2D;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("precision mediump usampler2D;"),i.push("precision mediump isampler2D;"),i.push("precision mediump sampler2D;"),i.push("#endif"),i.push("uniform int renderPass;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),i.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),i.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),i.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),i.push("uniform highp usampler2D uTexturePerPolygonIdIndices;"),i.push("uniform mediump usampler2D uTexturePerPolygonIdPortionIds;"),i.push("uniform highp sampler2D uTextureCameraMatrices;"),i.push("uniform highp sampler2D uTextureModelMatrices;"),i.push("uniform vec3 uCameraEyeRtc;"),i.push("vec3 positions[3];"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("out float isPerspective;")),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;"),t&&(i.push("out vec4 vWorldPosition;"),i.push("flat out uint vFlags2;")),i.push("void main(void) {"),i.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),i.push("mat4 viewNormalMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 1), 0));"),i.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),i.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),i.push("mat4 worldNormalMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 1), 0), texelFetch (uTextureModelMatrices, ivec2(1, 1), 0), texelFetch (uTextureModelMatrices, ivec2(2, 1), 0), texelFetch (uTextureModelMatrices, ivec2(3, 1), 0));"),i.push("int polygonIndex = gl_VertexID / 3;"),i.push("int h_packed_object_id_index = (polygonIndex >> 3) & 4095;"),i.push("int v_packed_object_id_index = (polygonIndex >> 3) >> 12;"),i.push("int objectIndex = int(texelFetch(uTexturePerPolygonIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),i.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),i.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),i.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),i.push("if (int(flags.y) != renderPass) {"),i.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),i.push("   return;"),i.push("} else {"),i.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),i.push("ivec4 packedIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0));"),i.push("int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;"),i.push("int h_index = (polygonIndex - indexBaseOffset) & 4095;"),i.push("int v_index = (polygonIndex - indexBaseOffset) >> 12;"),i.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdIndices, ivec2(h_index, v_index), 0));"),i.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),i.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),i.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),i.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),i.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),i.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),i.push("uint solid = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0).r;"),i.push("positions[0] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.r, indexPositionV.r), 0));"),i.push("positions[1] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.g, indexPositionV.g), 0));"),i.push("positions[2] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.b, indexPositionV.b), 0));"),i.push("vec3 normal = normalize(cross(positions[2] - positions[0], positions[1] - positions[0]));"),i.push("vec3 position;"),i.push("position = positions[gl_VertexID % 3];"),i.push("vec3 viewNormal = -normalize((transpose(inverse(viewMatrix*positionsDecodeMatrix)) * vec4(normal,1)).xyz);"),i.push("if (solid != 1u) {"),i.push("if (isPerspectiveMatrix(projMatrix)) {"),i.push("vec3 uCameraEyeRtcInQuantizedSpace = (inverse(worldMatrix * positionsDecodeMatrix) * vec4(uCameraEyeRtc, 1)).xyz;"),i.push("if (dot(position.xyz - uCameraEyeRtcInQuantizedSpace, normal) < 0.0) {"),i.push("position = positions[2 - (gl_VertexID % 3)];"),i.push("viewNormal = -viewNormal;"),i.push("}"),i.push("} else {"),i.push("if (viewNormal.z < 0.0) {"),i.push("position = positions[2 - (gl_VertexID % 3)];"),i.push("viewNormal = -viewNormal;"),i.push("}"),i.push("}"),i.push("}"),i.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),i.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),i.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),i.push("vec4 viewPosition = viewMatrix * worldPosition; "),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2.r;")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Triangles dataTexture draw fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("flat in uint vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("uniform vec4 color;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = vFlags2 > 0u;"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { "),s.push("      discard;"),s.push("  }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    outColor = color;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Fi=q.vec3(),Ri=new Float32Array([0,0,0,1]),Si=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.textureState,h=t._state.origin;if(this._program||(this._allocate(t),!this.errors)){if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),u.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets),e.pickViewMatrix&&u.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),o.uniform1i(this._uRenderPass,i),i===qt){var l=r.xrayMaterial._state,c=l.edgeColor,p=l.edgeAlpha;o.uniform4f(this._uColor,c[0],c[1],c[2],p)}else if(i===Zt){var d=r.highlightMaterial._state,f=d.edgeColor,m=d.edgeAlpha;o.uniform4f(this._uColor,f[0],f[1],f[2],m)}else if(i===Qt){var v=r.selectedMaterial._state,g=v.edgeColor,_=v.edgeAlpha;o.uniform4f(this._uColor,g[0],g[1],g[2],_)}else o.uniform4fv(this._uColor,Ri);o.uniformMatrix4fv(this._uViewMatrix,!1,h?De(n.viewMatrix,h):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var y=r._sectionPlanesState.sectionPlanes.length;if(y>0)for(var b=r._sectionPlanesState.sectionPlanes,x=t.layerIndex*y,P=s.renderFlags,T=0;T<y;T++){var w=this._uSectionPlanes[T];if(w){var M=P.sectionPlanesActivePerLayer[x+T];if(o.uniform1i(w.active,M?1:0),M){var I=b[T];if(h){var C=Ee(I.dist,I.dir,h,Fi);o.uniform3fv(w.pos,C)}else o.uniform3fv(w.pos,I.pos);o.uniform3fv(w.dir,I.dir)}}}a.numEdgeIndices8Bits>0&&(u.bindEdgeIndicesTextures(this._program,this._uTexturePerEdgeIdPortionIds,this._uTexturePerPolygonIdEdgeIndices,8),o.drawArrays(o.LINES,0,a.numEdgeIndices8Bits)),a.numEdgeIndices16Bits>0&&(u.bindEdgeIndicesTextures(this._program,this._uTexturePerEdgeIdPortionIds,this._uTexturePerPolygonIdEdgeIndices,16),o.drawArrays(o.LINES,0,a.numEdgeIndices16Bits)),a.numEdgeIndices32Bits>0&&(u.bindEdgeIndicesTextures(this._program,this._uTexturePerEdgeIdPortionIds,this._uTexturePerPolygonIdEdgeIndices,32),o.drawArrays(o.LINES,0,a.numEdgeIndices32Bits)),e.drawElements++}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uColor=i.getLocation("color"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdEdgeIndices="uTexturePerPolygonIdEdgeIndices",this._uTexturePerEdgeIdPortionIds="uTexturePerEdgeIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets"}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=this._program,s=e.camera.project;if(i.bind(),e.logarithmicDepthBufferEnabled){var r=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,r)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Batched geometry edges drawing vertex shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("precision highp usampler2D;"),i.push("precision highp isampler2D;"),i.push("precision highp sampler2D;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("precision mediump usampler2D;"),i.push("precision mediump isampler2D;"),i.push("precision mediump sampler2D;"),i.push("#endif"),i.push("uniform int renderPass;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),i.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),i.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),i.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),i.push("uniform highp usampler2D uTexturePerPolygonIdEdgeIndices;"),i.push("uniform mediump usampler2D uTexturePerEdgeIdPortionIds;"),i.push("uniform highp sampler2D uTextureCameraMatrices;"),i.push("uniform highp sampler2D uTextureModelMatrices;"),i.push("uniform vec4 color;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("flat out uint vFlags2;")),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),i.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),i.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),i.push("int edgeIndex = gl_VertexID / 2;"),i.push("int h_packed_object_id_index = (edgeIndex >> 3) & 4095;"),i.push("int v_packed_object_id_index = (edgeIndex >> 3) >> 12;"),i.push("int objectIndex = int(texelFetch(uTexturePerEdgeIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),i.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),i.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),i.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),i.push("if (int(flags.z) != renderPass) {"),i.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),i.push("   return;"),i.push("} else {"),i.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),i.push("ivec4 packedEdgeIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0));"),i.push("int edgeIndexBaseOffset = (packedEdgeIndexBaseOffset.r << 24) + (packedEdgeIndexBaseOffset.g << 16) + (packedEdgeIndexBaseOffset.b << 8) + packedEdgeIndexBaseOffset.a;"),i.push("int h_index = (edgeIndex - edgeIndexBaseOffset) & 4095;"),i.push("int v_index = (edgeIndex - edgeIndexBaseOffset) >> 12;"),i.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdEdgeIndices, ivec2(h_index, v_index), 0));"),i.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),i.push("int indexPositionH = uniqueVertexIndexes[gl_VertexID % 2] & 4095;"),i.push("int indexPositionV = uniqueVertexIndexes[gl_VertexID % 2] >> 12;"),i.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),i.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),i.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),i.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),i.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),i.push("vec3 position = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH, indexPositionV), 0));"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),i.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),i.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("  vWorldPosition = worldPosition;"),i.push("  vFlags2 = flags2.r;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("vColor = vec4(color.r, color.g, color.b, color.a);"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Batched geometry edges drawing fragment shader"),e.logarithmicDepthBufferEnabled&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("flat in uint vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = vFlags2 > 0u;"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("   outColor            = vColor;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Oi=q.vec3(),Bi=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene;r.camera;var n=r.canvas.gl,o=t._state,a=o.textureState,u=t._state.origin;if(this._program||(this._allocate(t),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets),e.pickViewMatrix&&a.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),n.uniform1i(this._uRenderPass,i);var h=r._sectionPlanesState.sectionPlanes.length;if(h>0)for(var l=r._sectionPlanesState.sectionPlanes,c=t.layerIndex*h,p=s.renderFlags,d=0;d<h;d++){var f=this._uSectionPlanes[d];if(f){var m=p.sectionPlanesActivePerLayer[c+d];if(n.uniform1i(f.active,m?1:0),m){var v=l[d];if(u){var g=Ee(v.dist,v.dir,u,Oi);n.uniform3fv(f.pos,g)}else n.uniform3fv(f.pos,v.pos);n.uniform3fv(f.dir,v.dir)}}}o.numEdgeIndices8Bits>0&&(a.bindEdgeIndicesTextures(this._program,this._uTexturePerEdgeIdPortionIds,this._uTexturePerPolygonIdEdgeIndices,8),n.drawArrays(n.LINES,0,o.numEdgeIndices8Bits)),o.numEdgeIndices16Bits>0&&(a.bindEdgeIndicesTextures(this._program,this._uTexturePerEdgeIdPortionIds,this._uTexturePerPolygonIdEdgeIndices,16),n.drawArrays(n.LINES,0,o.numEdgeIndices16Bits)),o.numEdgeIndices32Bits>0&&(a.bindEdgeIndicesTextures(this._program,this._uTexturePerEdgeIdPortionIds,this._uTexturePerPolygonIdEdgeIndices,32),n.drawArrays(n.LINES,0,o.numEdgeIndices32Bits)),e.drawElements++}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdEdgeIndices="uTexturePerPolygonIdEdgeIndices",this._uTexturePerEdgeIdPortionIds="uTexturePerEdgeIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets"}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=this._program,s=e.camera.project;if(i.bind(),e.logarithmicDepthBufferEnabled){var r=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,r)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Batched geometry edges drawing vertex shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("precision highp usampler2D;"),i.push("precision highp isampler2D;"),i.push("precision highp sampler2D;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("precision mediump usampler2D;"),i.push("precision mediump isampler2D;"),i.push("precision mediump sampler2D;"),i.push("#endif"),i.push("uniform int renderPass;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),i.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),i.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),i.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),i.push("uniform highp usampler2D uTexturePerPolygonIdEdgeIndices;"),i.push("uniform mediump usampler2D uTexturePerEdgeIdPortionIds;"),i.push("uniform highp sampler2D uTextureCameraMatrices;"),i.push("uniform highp sampler2D uTextureModelMatrices;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("flat out uint vFlags2;")),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),i.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),i.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),i.push("int edgeIndex = gl_VertexID / 2;"),i.push("int h_packed_object_id_index = (edgeIndex >> 3) & 4095;"),i.push("int v_packed_object_id_index = (edgeIndex >> 3) >> 12;"),i.push("int objectIndex = int(texelFetch(uTexturePerEdgeIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),i.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),i.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),i.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),i.push("if (int(flags.z) != renderPass) {"),i.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),i.push("   return;"),i.push("} else {"),i.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),i.push("ivec4 packedEdgeIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0));"),i.push("int edgeIndexBaseOffset = (packedEdgeIndexBaseOffset.r << 24) + (packedEdgeIndexBaseOffset.g << 16) + (packedEdgeIndexBaseOffset.b << 8) + packedEdgeIndexBaseOffset.a;"),i.push("int h_index = (edgeIndex - edgeIndexBaseOffset) & 4095;"),i.push("int v_index = (edgeIndex - edgeIndexBaseOffset) >> 12;"),i.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdEdgeIndices, ivec2(h_index, v_index), 0));"),i.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),i.push("int indexPositionH = uniqueVertexIndexes[gl_VertexID % 2] & 4095;"),i.push("int indexPositionV = uniqueVertexIndexes[gl_VertexID % 2] >> 12;"),i.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),i.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),i.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),i.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),i.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),i.push("vec3 position = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH, indexPositionV), 0));"),i.push("uvec4 color = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0);"),i.push("if (color.a == 0u) {"),i.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),i.push("   return;"),i.push("};"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),i.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),i.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("  vWorldPosition = worldPosition;"),i.push("  vFlags2 = flags2.r;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("vec4 rgb = vec4(color.rgba);"),i.push("vColor = vec4(float(rgb.r*0.5) / 255.0, float(rgb.g*0.5) / 255.0, float(rgb.b*0.5) / 255.0, float(rgb.a) / 255.0);"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Batched geometry edges drawing fragment shader"),e.logarithmicDepthBufferEnabled&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("flat in uint vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = vFlags2 > 0u;"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("   outColor            = vColor;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Li=q.vec3(),Ni=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.textureState,h=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),u.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets);var l=n.eye;e.pickViewMatrix&&(u.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),l=e.pickOrigin||l);var c=[l[0]-h[0],l[1]-h[1],l[2]-h[2]];if(o.uniform3fv(this._uCameraEyeRtc,c),o.uniform1i(this._uRenderPass,i),r.logarithmicDepthBufferEnabled){var p=2/(Math.log(n.project.far+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,p)}var d=r._sectionPlanesState.sectionPlanes.length;if(d>0)for(var f=r._sectionPlanesState.sectionPlanes,m=t.layerIndex*d,v=s.renderFlags,g=0;g<d;g++){var _=this._uSectionPlanes[g];if(_){var y=v.sectionPlanesActivePerLayer[m+g];if(o.uniform1i(_.active,y?1:0),y){var b=f[g];if(h){var x=Ee(b.dist,b.dir,h,Li);o.uniform3fv(_.pos,x)}else o.uniform3fv(_.pos,b.pos);o.uniform3fv(_.dir,b.dir)}}}a.numIndices8Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,8),o.drawArrays(o.TRIANGLES,0,a.numIndices8Bits)),a.numIndices16Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,16),o.drawArrays(o.TRIANGLES,0,a.numIndices16Bits)),a.numIndices32Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,32),o.drawArrays(o.TRIANGLES,0,a.numIndices32Bits)),e.drawElements++}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdNormals="uTexturePerPolygonIdNormals",this._uTexturePerPolygonIdIndices="uTexturePerPolygonIdIndices",this._uTexturePerPolygonIdPortionIds="uTexturePerPolygonIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets",this._uCameraEyeRtc=i.getLocation("uCameraEyeRtc")}}},{key:"_bindProgram",value:function(e){var t=this._scene.canvas.gl;this._program.bind(),t.uniform1i(this._uPickInvisible,e.pickInvisible)}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Batched geometry picking vertex shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("precision highp usampler2D;"),i.push("precision highp isampler2D;"),i.push("precision highp sampler2D;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("precision mediump usampler2D;"),i.push("precision mediump isampler2D;"),i.push("precision mediump sampler2D;"),i.push("#endif"),i.push("uniform int renderPass;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("uniform bool pickInvisible;"),i.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),i.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),i.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),i.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),i.push("uniform highp usampler2D uTexturePerPolygonIdIndices;"),i.push("uniform mediump usampler2D uTexturePerPolygonIdPortionIds;"),i.push("uniform highp sampler2D uTextureCameraMatrices;"),i.push("uniform highp sampler2D uTextureModelMatrices;"),i.push("uniform vec3 uCameraEyeRtc;"),i.push("vec3 positions[3];"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("out float isPerspective;")),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),t&&(i.push("smooth out vec4 vWorldPosition;"),i.push("flat out uvec4 vFlags2;")),i.push("out vec4 vPickColor;"),i.push("void main(void) {"),i.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),i.push("mat4 viewNormalMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 1), 0));"),i.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),i.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),i.push("mat4 worldNormalMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 1), 0), texelFetch (uTextureModelMatrices, ivec2(1, 1), 0), texelFetch (uTextureModelMatrices, ivec2(2, 1), 0), texelFetch (uTextureModelMatrices, ivec2(3, 1), 0));"),i.push("int polygonIndex = gl_VertexID / 3;"),i.push("int h_packed_object_id_index = (polygonIndex >> 3) & 4095;"),i.push("int v_packed_object_id_index = (polygonIndex >> 3) >> 12;"),i.push("int objectIndex = int(texelFetch(uTexturePerPolygonIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),i.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),i.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),i.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),i.push("   return;"),i.push("} else {"),i.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),i.push("ivec4 packedIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0));"),i.push("int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;"),i.push("int h_index = (polygonIndex - indexBaseOffset) & 4095;"),i.push("int v_index = (polygonIndex - indexBaseOffset) >> 12;"),i.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdIndices, ivec2(h_index, v_index), 0));"),i.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),i.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),i.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),i.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),i.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),i.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),i.push("uint solid = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0).r;"),i.push("positions[0] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.r, indexPositionV.r), 0));"),i.push("positions[1] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.g, indexPositionV.g), 0));"),i.push("positions[2] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.b, indexPositionV.b), 0));"),i.push("uvec4 color = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0);"),i.push("if (color.a == 0u) {"),i.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),i.push("   return;"),i.push("};"),i.push("vPickColor = vec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0)) / 255.0;"),i.push("vec3 normal = normalize(cross(positions[2] - positions[0], positions[1] - positions[0]));"),i.push("vec3 position;"),i.push("position = positions[gl_VertexID % 3];"),i.push("if (solid != 1u) {"),i.push("if (isPerspectiveMatrix(projMatrix)) {"),i.push("vec3 uCameraEyeRtcInQuantizedSpace = (inverse(worldMatrix * positionsDecodeMatrix) * vec4(uCameraEyeRtc, 1)).xyz;"),i.push("if (dot(position.xyz - uCameraEyeRtcInQuantizedSpace, normal) < 0.0) {"),i.push("position = positions[2 - (gl_VertexID % 3)];"),i.push("}"),i.push("} else {"),i.push("vec3 viewNormal = -normalize((transpose(inverse(viewMatrix*positionsDecodeMatrix)) * vec4(normal,1)).xyz);"),i.push("if (viewNormal.z < 0.0) {"),i.push("position = positions[2 - (gl_VertexID % 3)];"),i.push("}"),i.push("}"),i.push("}"),i.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),i.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),i.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),i.push("vec4 viewPosition = viewMatrix * worldPosition; "),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Batched geometry picking fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("flat in uvec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vPickColor;"),s.push("out vec4 outPickColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("   outPickColor = vPickColor; "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),ji=q.vec3(),Gi=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.textureState,h=t._state.origin;this._program||this._allocate(),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),u.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets);var l=n.eye;e.pickViewMatrix&&(u.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),l=e.pickOrigin||l);var c=[l[0]-h[0],l[1]-h[1],l[2]-h[2]];if(o.uniform3fv(this._uCameraEyeRtc,c),o.uniform1i(this._uRenderPass,i),o.uniform1i(this._uPickInvisible,e.pickInvisible),o.uniform1f(this._uPickZNear,e.pickZNear),o.uniform1f(this._uPickZFar,e.pickZFar),r.logarithmicDepthBufferEnabled){var p=2/(Math.log(e.pickZFar+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,p)}var d=r._sectionPlanesState.sectionPlanes.length;if(d>0)for(var f=r._sectionPlanesState.sectionPlanes,m=t.layerIndex*d,v=s.renderFlags,g=0;g<d;g++){var _=this._uSectionPlanes[g];if(_){var y=v.sectionPlanesActivePerLayer[m+g];if(o.uniform1i(_.active,y?1:0),y){var b=f[g];if(h){var x=Ee(b.dist,b.dir,h,ji);o.uniform3fv(_.pos,x)}else o.uniform3fv(_.pos,b.pos);o.uniform3fv(_.dir,b.dir)}}}a.numIndices8Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,8),o.drawArrays(o.TRIANGLES,0,a.numIndices8Bits)),a.numIndices16Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,16),o.drawArrays(o.TRIANGLES,0,a.numIndices16Bits)),a.numIndices32Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,32),o.drawArrays(o.TRIANGLES,0,a.numIndices32Bits)),e.drawElements++}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPackedVertexId=i.getAttribute("packedVertexId"),this._uPickZNear=i.getLocation("pickZNear"),this._uPickZFar=i.getLocation("pickZFar"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdNormals="uTexturePerPolygonIdNormals",this._uTexturePerPolygonIdIndices="uTexturePerPolygonIdIndices",this._uTexturePerPolygonIdPortionIds="uTexturePerPolygonIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets",this._uCameraEyeRtc=i.getLocation("uCameraEyeRtc")}}},{key:"_bindProgram",value:function(){this._program.bind()}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles dataTexture pick depth vertex shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("precision highp usampler2D;"),i.push("precision highp isampler2D;"),i.push("precision highp sampler2D;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("precision mediump usampler2D;"),i.push("precision mediump isampler2D;"),i.push("precision mediump sampler2D;"),i.push("#endif"),i.push("uniform int renderPass;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("uniform bool pickInvisible;"),i.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),i.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),i.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),i.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),i.push("uniform highp usampler2D uTexturePerPolygonIdIndices;"),i.push("uniform mediump usampler2D uTexturePerPolygonIdPortionIds;"),i.push("uniform highp sampler2D uTextureCameraMatrices;"),i.push("uniform highp sampler2D uTextureModelMatrices;"),i.push("uniform vec3 uCameraEyeRtc;"),i.push("vec3 positions[3];"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("out float isPerspective;")),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),t&&(i.push("out vec4 vWorldPosition;"),i.push("flat out uint vFlags2;")),i.push("out vec4 vViewPosition;"),i.push("void main(void) {"),i.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),i.push("mat4 viewNormalMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 1), 0));"),i.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),i.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),i.push("mat4 worldNormalMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 1), 0), texelFetch (uTextureModelMatrices, ivec2(1, 1), 0), texelFetch (uTextureModelMatrices, ivec2(2, 1), 0), texelFetch (uTextureModelMatrices, ivec2(3, 1), 0));"),i.push("int polygonIndex = gl_VertexID / 3;"),i.push("int h_packed_object_id_index = (polygonIndex >> 3) & 4095;"),i.push("int v_packed_object_id_index = (polygonIndex >> 3) >> 12;"),i.push("int objectIndex = int(texelFetch(uTexturePerPolygonIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),i.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),i.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),i.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),i.push("   return;"),i.push("} else {"),i.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),i.push("ivec4 packedIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0));"),i.push("int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;"),i.push("int h_index = (polygonIndex - indexBaseOffset) & 4095;"),i.push("int v_index = (polygonIndex - indexBaseOffset) >> 12;"),i.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdIndices, ivec2(h_index, v_index), 0));"),i.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),i.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),i.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),i.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),i.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),i.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),i.push("uint solid = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0).r;"),i.push("positions[0] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.r, indexPositionV.r), 0));"),i.push("positions[1] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.g, indexPositionV.g), 0));"),i.push("positions[2] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.b, indexPositionV.b), 0));"),i.push("uvec4 color = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0);"),i.push("if (color.a == 0u) {"),i.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),i.push("   return;"),i.push("};"),i.push("vec3 normal = normalize(cross(positions[2] - positions[0], positions[1] - positions[0]));"),i.push("vec3 position;"),i.push("position = positions[gl_VertexID % 3];"),i.push("if (solid != 1u) {"),i.push("if (isPerspectiveMatrix(projMatrix)) {"),i.push("vec3 uCameraEyeRtcInQuantizedSpace = (inverse(worldMatrix * positionsDecodeMatrix) * vec4(uCameraEyeRtc, 1)).xyz;"),i.push("if (dot(position.xyz - uCameraEyeRtcInQuantizedSpace, normal) < 0.0) {"),i.push("position = positions[2 - (gl_VertexID % 3)];"),i.push("}"),i.push("} else {"),i.push("vec3 viewNormal = -normalize((transpose(inverse(viewMatrix*positionsDecodeMatrix)) * vec4(normal,1)).xyz);"),i.push("if (viewNormal.z < 0.0) {"),i.push("position = positions[2 - (gl_VertexID % 3)];"),i.push("}"),i.push("}"),i.push("}"),i.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),i.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),i.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),i.push("vec4 viewPosition = viewMatrix * worldPosition; "),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2.r;")),i.push("vViewPosition = viewPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Triangles dataTexture pick depth fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),s.push("uniform float pickZNear;"),s.push("uniform float pickZFar;"),i){s.push("in vec4 vWorldPosition;"),s.push("flat in uint vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vViewPosition;"),s.push("vec4 packDepth(const in float depth) {"),s.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),s.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),s.push("  vec4 res = fract(depth * bitShift);"),s.push("  res -= res.xxyz * bitMask;"),s.push("  return res;"),s.push("}"),s.push("out vec4 outPackedDepth;"),s.push("void main(void) {"),i){s.push("  bool clippable = vFlags2 > 0u;"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),s.push("    outPackedDepth = packDepth(zNormalizedDepth); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Hi=q.vec3(),Ui=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.textureState,h=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),u.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets);var l=n.eye;e.pickViewMatrix&&(u.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),l=e.pickOrigin||l);var c=[l[0]-h[0],l[1]-h[1],l[2]-h[2]];if(o.uniform3fv(this._uCameraEyeRtc,c),o.uniform1i(this._uRenderPass,i),o.uniform3fv(this._uCameraEyeRtc,c),o.uniform1i(this._uPickInvisible,e.pickInvisible),r.logarithmicDepthBufferEnabled){var p=2/(Math.log(n.project.far+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,p)}var d=r._sectionPlanesState.sectionPlanes.length;if(d>0)for(var f=r._sectionPlanesState.sectionPlanes,m=t.layerIndex*d,v=s.renderFlags,g=0;g<d;g++){var _=this._uSectionPlanes[g];if(_){var y=v.sectionPlanesActivePerLayer[m+g];if(o.uniform1i(_.active,y?1:0),y){var b=f[g];if(h){var x=Ee(b.dist,b.dir,h,Hi);o.uniform3fv(_.pos,x)}else o.uniform3fv(_.pos,b.pos);o.uniform3fv(_.dir,b.dir)}}}a.numIndices8Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,8),o.drawArrays(o.TRIANGLES,0,a.numIndices8Bits)),a.numIndices16Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,16),o.drawArrays(o.TRIANGLES,0,a.numIndices16Bits)),a.numIndices32Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,32),o.drawArrays(o.TRIANGLES,0,a.numIndices32Bits)),e.drawElements++}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdNormals="uTexturePerPolygonIdNormals",this._uTexturePerPolygonIdIndices="uTexturePerPolygonIdIndices",this._uTexturePerPolygonIdPortionIds="uTexturePerPolygonIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets",this._uCameraEyeRtc=i.getLocation("uCameraEyeRtc")}}},{key:"_bindProgram",value:function(){this._program.bind()}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles dataTexture pick normals vertex shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("precision highp usampler2D;"),i.push("precision highp isampler2D;"),i.push("precision highp sampler2D;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("precision mediump usampler2D;"),i.push("precision mediump isampler2D;"),i.push("precision mediump sampler2D;"),i.push("#endif"),i.push("uniform int renderPass;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("uniform bool pickInvisible;"),i.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),i.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),i.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),i.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),i.push("uniform highp usampler2D uTexturePerPolygonIdIndices;"),i.push("uniform mediump usampler2D uTexturePerPolygonIdPortionIds;"),i.push("uniform highp sampler2D uTextureCameraMatrices;"),i.push("uniform highp sampler2D uTextureModelMatrices;"),i.push("uniform vec3 uCameraEyeRtc;"),i.push("vec3 positions[3];"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("out float isPerspective;")),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),t&&(i.push("out vec4 vWorldPosition;"),i.push("flat out uint vFlags2;")),i.push("out vec3 vWorldNormal;"),i.push("void main(void) {"),i.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),i.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),i.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),i.push("int polygonIndex = gl_VertexID / 3;"),i.push("int h_packed_object_id_index = (polygonIndex >> 3) & 4095;"),i.push("int v_packed_object_id_index = (polygonIndex >> 3) >> 12;"),i.push("int objectIndex = int(texelFetch(uTexturePerPolygonIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),i.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),i.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),i.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),i.push("   return;"),i.push("} else {"),i.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),i.push("ivec4 packedIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0));"),i.push("int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;"),i.push("int h_index = (polygonIndex - indexBaseOffset) & 4095;"),i.push("int v_index = (polygonIndex - indexBaseOffset) >> 12;"),i.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdIndices, ivec2(h_index, v_index), 0));"),i.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),i.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),i.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),i.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),i.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),i.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),i.push("uint solid = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0).r;"),i.push("positions[0] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.r, indexPositionV.r), 0));"),i.push("positions[1] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.g, indexPositionV.g), 0));"),i.push("positions[2] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.b, indexPositionV.b), 0));"),i.push("vec3 normal = normalize(cross(positions[2] - positions[0], positions[1] - positions[0]));"),i.push("vec3 position;"),i.push("position = positions[gl_VertexID % 3];"),i.push("if (solid != 1u) {"),i.push("if (isPerspectiveMatrix(projMatrix)) {"),i.push("vec3 uCameraEyeRtcInQuantizedSpace = (inverse(worldMatrix * positionsDecodeMatrix) * vec4(uCameraEyeRtc, 1)).xyz;"),i.push("if (dot(position.xyz - uCameraEyeRtcInQuantizedSpace, normal) < 0.0) {"),i.push("position = positions[2 - (gl_VertexID % 3)];"),i.push("normal = -normal;"),i.push("}"),i.push("} else {"),i.push("vec3 viewNormal = -normalize((transpose(inverse(viewMatrix*positionsDecodeMatrix)) * vec4(normal,1)).xyz);"),i.push("if (viewNormal.z < 0.0) {"),i.push("position = positions[2 - (gl_VertexID % 3)];"),i.push("normal = -normal;"),i.push("}"),i.push("}"),i.push("}"),i.push("normal = -normal;"),i.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),i.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),i.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),i.push("vec4 viewPosition = viewMatrix * worldPosition; "),i.push("vWorldNormal = normal.xyz;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2.w;")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Triangles dataTexture pick normals fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("flat in uint vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec3 vWorldNormal;"),s.push("out vec4 outNormal;"),s.push("void main(void) {"),i){s.push("  bool clippable = vFlags2 > 0u;"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    outNormal = vec4((vWorldNormal * 0.5) + 0.5, 1.0);"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}();q.vec3();var Vi=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Triangles dataTexture occlusion vertex shader"),e.logarithmicDepthBufferEnabled&&Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Triangles dataTexture occlusion fragment shader"),e.logarithmicDepthBufferEnabled&&Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("      if (sectionPlaneActive"+n+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("   gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}();q.vec4();var zi=q.vec3(),Wi=function(){function e(t){w(this,e),this._scene=t,this._allocate(),this._hash=this._getHash()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=this._scene,r=s.camera,n=t.model,o=s.canvas.gl,a=t._state,u=a.textureState,h=t._state.origin;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e,a)),u.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets);var l=r.eye;e.pickViewMatrix&&(u.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),l=e.pickOrigin||l);var c=[l[0]-h[0],l[1]-h[1],l[2]-h[2]];o.uniform3fv(this._uCameraEyeRtc,c),o.uniform1i(this._uRenderPass,i);var p=s._sectionPlanesState.sectionPlanes.length;if(p>0)for(var d=s._sectionPlanesState.sectionPlanes,f=t.layerIndex*p,m=n.renderFlags,v=0;v<p;v++){var g=this._uSectionPlanes[v];if(g){var _=m.sectionPlanesActivePerLayer[f+v];if(o.uniform1i(g.active,_?1:0),_){var y=d[v];if(h){var b=Ee(y.dist,y.dir,h,zi);o.uniform3fv(g.pos,b)}else o.uniform3fv(g.pos,y.pos);o.uniform3fv(g.dir,y.dir)}}}a.numIndices8Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,8),o.drawArrays(o.TRIANGLES,0,a.numIndices8Bits)),a.numIndices16Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,16),o.drawArrays(o.TRIANGLES,0,a.numIndices16Bits)),a.numIndices32Bits>0&&(u.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,32),o.drawArrays(o.TRIANGLES,0,a.numIndices32Bits)),e.drawElements++}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdNormals="uTexturePerPolygonIdNormals",this._uTexturePerPolygonIdIndices="uTexturePerPolygonIdIndices",this._uTexturePerPolygonIdPortionIds="uTexturePerPolygonIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets",this._uCameraEyeRtc=i.getLocation("uCameraEyeRtc")}}},{key:"_bindProgram",value:function(e){var t=this._scene,i=t.canvas.gl,s=this._program,r=t.camera.project;if(s.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),t.logarithmicDepthBufferEnabled){var n=2/(Math.log(r.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,n)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState;e._lightsState;var i=t.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles dataTexture draw vertex shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("precision highp usampler2D;"),s.push("precision highp isampler2D;"),s.push("precision highp sampler2D;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("precision mediump usampler2D;"),s.push("precision mediump isampler2D;"),s.push("precision mediump sampler2D;"),s.push("#endif"),s.push("uniform int renderPass;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),s.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),s.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),s.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),s.push("uniform highp usampler2D uTexturePerPolygonIdIndices;"),s.push("uniform mediump usampler2D uTexturePerPolygonIdPortionIds;"),s.push("uniform highp sampler2D uTextureCameraMatrices;"),s.push("uniform highp sampler2D uTextureModelMatrices;"),s.push("uniform vec3 uCameraEyeRtc;"),s.push("vec3 positions[3];"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("out float isPerspective;")),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out highp vec2 vHighPrecisionZW;"),i&&(s.push("out vec4 vWorldPosition;"),s.push("flat out uint vFlags2;")),s.push("void main(void) {"),s.push("int polygonIndex = gl_VertexID / 3;"),s.push("int h_packed_object_id_index = (polygonIndex >> 3) & 4095;"),s.push("int v_packed_object_id_index = (polygonIndex >> 3) >> 12;"),s.push("int objectIndex = int(texelFetch(uTexturePerPolygonIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),s.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),s.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),s.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),s.push("   return;"),s.push("} else {"),s.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),s.push("mat4 viewNormalMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 1), 0));"),s.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),s.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),s.push("mat4 worldNormalMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 1), 0), texelFetch (uTextureModelMatrices, ivec2(1, 1), 0), texelFetch (uTextureModelMatrices, ivec2(2, 1), 0), texelFetch (uTextureModelMatrices, ivec2(3, 1), 0));"),s.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),s.push("ivec4 packedIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0));"),s.push("int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;"),s.push("int h_index = (polygonIndex - indexBaseOffset) & 4095;"),s.push("int v_index = (polygonIndex - indexBaseOffset) >> 12;"),s.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdIndices, ivec2(h_index, v_index), 0));"),s.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),s.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),s.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),s.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),s.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),s.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),s.push("uint solid = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0).r;"),s.push("positions[0] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.r, indexPositionV.r), 0));"),s.push("positions[1] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.g, indexPositionV.g), 0));"),s.push("positions[2] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.b, indexPositionV.b), 0));"),s.push("uvec4 color = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0);"),s.push("if (color.a == 0u) {"),s.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),s.push("   return;"),s.push("};"),s.push("vec3 normal = normalize(cross(positions[2] - positions[0], positions[1] - positions[0]));"),s.push("vec3 position;"),s.push("position = positions[gl_VertexID % 3];"),s.push("vec3 viewNormal = -normalize((transpose(inverse(viewMatrix*positionsDecodeMatrix)) * vec4(normal,1)).xyz);"),s.push("if (solid != 1u) {"),s.push("if (isPerspectiveMatrix(projMatrix)) {"),s.push("vec3 uCameraEyeRtcInQuantizedSpace = (inverse(worldMatrix * positionsDecodeMatrix) * vec4(uCameraEyeRtc, 1)).xyz;"),s.push("if (dot(position.xyz - uCameraEyeRtcInQuantizedSpace, normal) < 0.0) {"),s.push("position = positions[2 - (gl_VertexID % 3)];"),s.push("viewNormal = -viewNormal;"),s.push("}"),s.push("} else {"),s.push("if (viewNormal.z < 0.0) {"),s.push("position = positions[2 - (gl_VertexID % 3)];"),s.push("viewNormal = -viewNormal;"),s.push("}"),s.push("}"),s.push("}"),s.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),s.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),s.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),s.push("vec4 viewPosition = viewMatrix * worldPosition; "),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2.r;")),s.push("gl_Position = clipPos;"),s.push("vHighPrecisionZW = gl_Position.zw;"),s.push("}"),s.push("}"),s}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Triangles dataTexture draw fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),s.push("in highp vec2 vHighPrecisionZW;"),s.push("out vec4 outColor;"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("flat in uint vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("void main(void) {"),i){s.push("  bool clippable = vFlags2 > 0u;"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { "),s.push("      discard;"),s.push("  }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;"),s.push("    outColor = vec4(vec3(1.0 - fragCoordZ), 1.0); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Xi=q.vec3(),Yi=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin;if(this._program||(this._allocate(t),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(t)),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(n.viewMatrix,u):n.viewMatrix),o.uniformMatrix4fv(this._uViewNormalMatrix,!1,n.viewNormalMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.uniformMatrix4fv(this._uWorldNormalMatrix,!1,s.worldNormalMatrix);var h=r._sectionPlanesState.sectionPlanes.length;if(h>0)for(var l=r._sectionPlanesState.sectionPlanes,c=t.layerIndex*h,p=s.renderFlags,d=0;d<h;d++){var f=this._uSectionPlanes[d];if(f){var m=p.sectionPlanesActivePerLayer[c+d];if(o.uniform1i(f.active,m?1:0),m){var v=l[d];if(u){var g=Ee(v.dist,v.dir,u,Xi);o.uniform3fv(f.pos,g)}else o.uniform3fv(f.pos,v.pos);o.uniform3fv(f.dir,v.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aNormal.bindArrayBuffer(a.normalsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),o.drawElements(o.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aNormal=i.getAttribute("normal"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2&&(this._aFlags2=i.getAttribute("flags2")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Batched geometry normals vertex shader"),e.logarithmicDepthBufferEnabled&&Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec3 normal;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 worldNormalMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 viewNormalMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("varying float isPerspective;")),i.push("vec3 octDecode(vec2 oct) {"),i.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),i.push("    if (v.z < 0.0) {"),i.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),i.push("    }"),i.push("    return normalize(v);"),i.push("}"),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec3 vViewNormal;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition   = viewMatrix * worldPosition; "),i.push("      vec4 worldNormal    = worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),i.push("      vec3 viewNormal     = normalize((viewNormalMatrix * worldNormal).xyz);"),t&&(i.push("      vWorldPosition  = worldPosition;"),i.push("      vFlags2         = flags2;")),i.push("      vViewNormal = viewNormal;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;")),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("// Batched geometry normals fragment shader"),e.logarithmicDepthBufferEnabled&&Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(s.push("varying float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("varying float vFragDepth;")),i){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("varying vec3 vViewNormal;"),s.push("vec3 packNormalToRGB( const in vec3 normal ) {"),s.push("    return normalize( normal ) * 0.5 + 0.5;"),s.push("}"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("      if (sectionPlaneActive"+n+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    gl_FragColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}();q.vec3();var Ki=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t){}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uShadowViewMatrix=s.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=s.getLocation("shadowProjMatrix"),e.logarithmicDepthBufferEnabled&&(this._uZFar=s.getLocation("zFar")),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2")}}},{key:"_bindProgram",value:function(e){var t=this._scene.canvas.gl;this._program.bind(),t.uniformMatrix4fv(this._uShadowViewMatrix,!1,e.shadowViewMatrix),t.uniformMatrix4fv(this._uShadowProjMatrix,!1,e.shadowProjMatrix),this._lastLightId=null}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("// Batched geometry shadow vertex shader"),i.push("attribute vec3 position;"),e.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform mat4 shadowViewMatrix;"),i.push("uniform mat4 shadowProjMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),t&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vViewPosition;"),i.push("void main(void) {"),i.push("  bool visible        = (float(flags.x) > 0.0);"),i.push("  bool transparent    = ((float(color.a) / 255.0) < 1.0);"),i.push("  if (!visible || transparent) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = shadowViewMatrix * worldPosition; "),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("      vViewPosition = viewPosition;"),i.push("      gl_Position = shadowProjMatrix * viewPosition;"),i.push("  }"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene._sectionPlanesState,t=e.sectionPlanes.length>0,i=[];if(i.push("// Batched geometry shadow fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(var s=0;s<e.sectionPlanes.length;s++)i.push("uniform bool sectionPlaneActive"+s+";"),i.push("uniform vec3 sectionPlanePos"+s+";"),i.push("uniform vec3 sectionPlaneDir"+s+";")}if(i.push("varying vec4 vViewPosition;"),i.push("vec4 encodeFloat( const in float v ) {"),i.push("  const vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);"),i.push("  const vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);"),i.push("  vec4 comp = fract(v * bitShift);"),i.push("  comp -= comp.xxyz * bitMask;"),i.push("  return comp;"),i.push("}"),i.push("void main(void) {"),t){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(var r=0;r<e.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return i.push("    gl_FragColor = encodeFloat( gl_FragCoord.z); "),i.push("}"),i}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Ji=q.vec4(),Zi=q.vec3(),Qi={linear:"linearToLinear",sRGB:"sRGBToLinear",gamma:"gammaToLinear"},qi=function(){function e(t,i){w(this,e),this._scene=t,this._withSAO=i,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){var e=this._scene;return[e.gammaOutput,e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}},{key:"drawLayer",value:function(e,t,i){var s=this._scene,r=s.camera,n=t.model,o=s.canvas.gl,a=t._state,u=t._state.origin;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(r.viewMatrix,u):r.viewMatrix),o.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.viewNormalMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,n.worldMatrix),o.uniformMatrix4fv(this._uWorldNormalMatrix,!1,n.worldNormalMatrix);var h=s._sectionPlanesState.sectionPlanes.length;if(h>0)for(var l=s._sectionPlanesState.sectionPlanes,c=t.layerIndex*h,p=n.renderFlags,d=0;d<h;d++){var f=this._uSectionPlanes[d];if(f){var m=p.sectionPlanesActivePerLayer[c+d];if(o.uniform1i(f.active,m?1:0),m){var v=l[d];if(u){var g=Ee(v.dist,v.dir,u,Zi);o.uniform3fv(f.pos,g)}else o.uniform3fv(f.pos,v.pos);o.uniform3fv(f.dir,v.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(a.normalsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),this._aMetallicRoughness&&this._aMetallicRoughness.bindArrayBuffer(a.metallicRoughnessBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),a.indicesBuf.bind(),o.drawElements(o.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0),e.drawElements++}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uGammaFactor=s.getLocation("gammaFactor"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];for(var r=i.lights,n=0,o=r.length;n<o;n++)switch(r[n].type){case"dir":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=null,this._uLightDir[n]=s.getLocation("lightDir"+n);break;case"point":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=null,this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n);break;case"spot":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=s.getLocation("lightDir"+n),this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n)}i.reflectionMaps.length>0&&(this._uReflectionMap="reflectionMap"),i.lightMaps.length>0&&(this._uLightMap="lightMap"),this._uSectionPlanes=[];for(var a=0,u=e._sectionPlanesState.sectionPlanes.length;a<u;a++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+a),pos:s.getLocation("sectionPlanePos"+a),dir:s.getLocation("sectionPlaneDir"+a)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aColor=s.getAttribute("color"),this._aMetallicRoughness=s.getAttribute("metallicRoughness"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(e){var t=Ze.MAX_TEXTURE_UNITS,i=this._scene,s=i.canvas.gl,r=this._program,n=i._lightsState,o=n.lights,a=i.camera.project;r.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,a.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,i._lightsState.getAmbientColorAndIntensity());for(var u=0,h=o.length;u<h;u++){var l=o[u];this._uLightColor[u]&&s.uniform4f(this._uLightColor[u],l.color[0],l.color[1],l.color[2],l.intensity),this._uLightPos[u]&&(s.uniform3fv(this._uLightPos[u],l.pos),this._uLightAttenuation[u]&&s.uniform1f(this._uLightAttenuation[u],l.attenuation)),this._uLightDir[u]&&s.uniform3fv(this._uLightDir[u],l.dir)}if(n.reflectionMaps.length>0&&n.reflectionMaps[0].texture&&this._uReflectionMap&&(r.bindTexture(this._uReflectionMap,n.reflectionMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++),n.lightMaps.length>0&&n.lightMaps[0].texture&&this._uLightMap&&(r.bindTexture(this._uLightMap,n.lightMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++),this._withSAO){var c=i.sao;if(c.possible){var p=s.drawingBufferWidth,d=s.drawingBufferHeight;Ji[0]=p,Ji[1]=d,Ji[2]=c.blendCutoff,Ji[3]=c.blendFactor,s.uniform4fv(this._uSAOParams,Ji),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++}}if(i.logarithmicDepthBufferEnabled){var f=2/(Math.log(a.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,f)}this._uGammaFactor&&s.uniform1f(this._uGammaFactor,i.gammaFactor)}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=e._lightsState,s=t.sectionPlanes.length>0,r=t.clippingCaps,n=[];return n.push("// Triangles dataTexture quality draw vertex shader"),e.logarithmicDepthBufferEnabled&&Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("#extension GL_EXT_frag_depth : enable"),n.push("uniform int renderPass;"),n.push("attribute vec3 position;"),n.push("attribute vec3 normal;"),n.push("attribute vec4 color;"),n.push("attribute vec2 metallicRoughness;"),n.push("attribute vec4 flags;"),n.push("attribute vec4 flags2;"),e.entityOffsetsEnabled&&n.push("attribute vec3 offset;"),n.push("uniform mat4 worldMatrix;"),n.push("uniform mat4 worldNormalMatrix;"),n.push("uniform mat4 viewMatrix;"),n.push("uniform mat4 projMatrix;"),n.push("uniform mat4 viewNormalMatrix;"),n.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("varying float vFragDepth;"),n.push("bool isPerspectiveMatrix(mat4 m) {"),n.push("    return (m[2][3] == - 1.0);"),n.push("}"),n.push("varying float isPerspective;")),n.push("vec3 octDecode(vec2 oct) {"),n.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),n.push("    if (v.z < 0.0) {"),n.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),n.push("    }"),n.push("    return normalize(v);"),n.push("}"),n.push("varying vec4 vViewPosition;"),n.push("varying vec3 vViewNormal;"),n.push("varying vec4 vColor;"),n.push("varying vec2 vMetallicRoughness;"),i.lightMaps.length>0&&n.push("varying vec3 vWorldNormal;"),s&&(n.push("varying vec4 vWorldPosition;"),n.push("varying vec4 vFlags2;"),r&&n.push("varying vec4 vClipPosition;")),n.push("void main(void) {"),n.push("if (int(flags.x) != renderPass) {"),n.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),n.push("} else {"),n.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&n.push("worldPosition.xyz = worldPosition.xyz + offset;"),n.push("vec4 viewPosition  = viewMatrix * worldPosition; "),n.push("vec4 worldNormal =  worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),n.push("vec3 viewNormal = normalize((viewNormalMatrix * worldNormal).xyz);"),n.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(n.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"),Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth?n.push("vFragDepth = 1.0 + clipPos.w;"):(n.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),n.push("clipPos.z *= clipPos.w;"))),s&&(n.push("vWorldPosition = worldPosition;"),n.push("vFlags2 = flags2;"),r&&n.push("vClipPosition = clipPos;")),n.push("vViewPosition = viewPosition;"),n.push("vViewNormal = viewNormal;"),n.push("vColor = color;"),n.push("vMetallicRoughness = metallicRoughness;"),i.lightMaps.length>0&&n.push("vWorldNormal = worldNormal.xyz;"),n.push("gl_Position = clipPos;"),n.push("}"),n.push("}"),n}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e.gammaOutput,i=e._sectionPlanesState,s=e._lightsState,r=i.sectionPlanes.length>0,n=i.clippingCaps,o=[];o.push("// Triangles dataTexture quality draw fragment shader"),e.logarithmicDepthBufferEnabled&&Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),e.logarithmicDepthBufferEnabled&&Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("varying float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;")),o.push("varying vec4 vViewPosition;"),o.push("varying vec3 vViewNormal;"),o.push("varying vec4 vColor;"),o.push("varying vec2 vMetallicRoughness;"),s.lightMaps.length>0&&o.push("varying vec3 vWorldNormal;"),o.push("uniform mat4 viewMatrix;"),s.reflectionMaps.length>0&&o.push("uniform samplerCube reflectionMap;"),s.lightMaps.length>0&&o.push("uniform samplerCube lightMap;"),o.push("uniform vec4 lightAmbient;");for(var a=0,u=s.lights.length;a<u;a++){var h=s.lights[a];"ambient"!==h.type&&(o.push("uniform vec4 lightColor"+a+";"),"dir"===h.type&&o.push("uniform vec3 lightDir"+a+";"),"point"===h.type&&o.push("uniform vec3 lightPos"+a+";"),"spot"===h.type&&(o.push("uniform vec3 lightPos"+a+";"),o.push("uniform vec3 lightDir"+a+";")))}if(this._withSAO&&(o.push("uniform sampler2D uOcclusionTexture;"),o.push("uniform vec4      uSAOParams;"),o.push("const float       packUpscale = 256. / 255.;"),o.push("const float       unpackDownScale = 255. / 256.;"),o.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),o.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),o.push("float unpackRGBAToDepth( const in vec4 v ) {"),o.push("    return dot( v, unPackFactors );"),o.push("}")),o.push("uniform float gammaFactor;"),o.push("vec4 linearToLinear( in vec4 value ) {"),o.push("  return value;"),o.push("}"),o.push("vec4 sRGBToLinear( in vec4 value ) {"),o.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),o.push("}"),o.push("vec4 gammaToLinear( in vec4 value) {"),o.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),o.push("}"),t&&(o.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),o.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),o.push("}")),r){o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),n&&o.push("varying vec4 vClipPosition;");for(var l=0,c=i.sectionPlanes.length;l<c;l++)o.push("uniform bool sectionPlaneActive"+l+";"),o.push("uniform vec3 sectionPlanePos"+l+";"),o.push("uniform vec3 sectionPlaneDir"+l+";")}if(o.push("#define PI 3.14159265359"),o.push("#define RECIPROCAL_PI 0.31830988618"),o.push("#define RECIPROCAL_PI2 0.15915494"),o.push("#define EPSILON 1e-6"),o.push("#define saturate(a) clamp( a, 0.0, 1.0 )"),o.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),o.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),o.push("}"),o.push("struct IncidentLight {"),o.push("   vec3 color;"),o.push("   vec3 direction;"),o.push("};"),o.push("struct ReflectedLight {"),o.push("   vec3 diffuse;"),o.push("   vec3 specular;"),o.push("};"),o.push("struct Geometry {"),o.push("   vec3 position;"),o.push("   vec3 viewNormal;"),o.push("   vec3 worldNormal;"),o.push("   vec3 viewEyeDir;"),o.push("};"),o.push("struct Material {"),o.push("   vec3    diffuseColor;"),o.push("   float   specularRoughness;"),o.push("   vec3    specularColor;"),o.push("   float   shine;"),o.push("};"),o.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),o.push("   float r = ggxRoughness + 0.0001;"),o.push("   return (2.0 / (r * r) - 2.0);"),o.push("}"),o.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {"),o.push("   float maxMIPLevelScalar = float( maxMIPLevel );"),o.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );"),o.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );"),o.push("}"),s.reflectionMaps.length>0&&(o.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),o.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),o.push("   vec3 envMapColor = "+Qi[s.reflectionMaps[0].encoding]+"(textureCube(reflectionMap, reflectVec, mipLevel)).rgb;"),o.push("  return envMapColor;"),o.push("}")),o.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),o.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),o.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),o.push("}"),o.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),o.push("   float a2 = ( alpha * alpha );"),o.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),o.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),o.push("   return 1.0 / ( gl * gv );"),o.push("}"),o.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),o.push("   float a2 = ( alpha * alpha );"),o.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),o.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),o.push("   return 0.5 / max( gv + gl, EPSILON );"),o.push("}"),o.push("float D_GGX(const in float alpha, const in float dotNH) {"),o.push("   float a2 = ( alpha * alpha );"),o.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),o.push("   return RECIPROCAL_PI * a2 / ( denom * denom);"),o.push("}"),o.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),o.push("   float alpha = ( roughness * roughness );"),o.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),o.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),o.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),o.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),o.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),o.push("   vec3  F = F_Schlick( specularColor, dotLH );"),o.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),o.push("   float D = D_GGX( alpha, dotNH );"),o.push("   return F * (G * D);"),o.push("}"),o.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),o.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),o.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),o.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),o.push("   vec4 r = roughness * c0 + c1;"),o.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),o.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),o.push("   return specularColor * AB.x + AB.y;"),o.push("}"),(s.lightMaps.length>0||s.reflectionMaps.length>0)&&(o.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),s.lightMaps.length>0&&(o.push("   vec3 irradiance = "+Qi[s.lightMaps[0].encoding]+"(textureCube(lightMap, geometry.worldNormal)).rgb;"),o.push("   irradiance *= PI;"),o.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),o.push("   reflectedLight.diffuse +=  irradiance * diffuseBRDFContrib;")),s.reflectionMaps.length>0&&(o.push("   vec3 reflectVec             = reflect(geometry.viewEyeDir, geometry.viewNormal);"),o.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),o.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),o.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),o.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),o.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),o.push("}")),o.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),o.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),o.push("   vec3 irradiance = dotNL * incidentLight.color * PI;"),o.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),o.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),o.push("}"),o.push("void main(void) {"),r){o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;");for(var p=0,d=i.sectionPlanes.length;p<d;p++)o.push("if (sectionPlaneActive"+p+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+p+".xyz, vWorldPosition.xyz - sectionPlanePos"+p+".xyz), 0.0, 1000.0);"),o.push("}");n?(o.push("  if (dist > (0.002 * vClipPosition.w)) {"),o.push("      discard;"),o.push("  }"),o.push("  if (dist > 0.0) { "),o.push("      gl_FragColor=vec4(1.0, 0.0, 0.0, 1.0);"),e.logarithmicDepthBufferEnabled&&Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("  gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("  return;"),o.push("}")):(o.push("  if (dist > 0.0) { "),o.push("      discard;"),o.push("  }")),o.push("}")}o.push("IncidentLight  light;"),o.push("Material       material;"),o.push("Geometry       geometry;"),o.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),o.push("vec3 rgb = (vec3(float(vColor.r) / 255.0, float(vColor.g) / 255.0, float(vColor.b) / 255.0));"),o.push("float alpha = float(vColor.a) / 255.0;"),o.push("vec3  diffuseColor = rgb;"),o.push("float specularF0 = 1.0;"),o.push("float metallic = float(vMetallicRoughness.r) / 255.0;"),o.push("float roughness = float(vMetallicRoughness.g) / 255.0;"),o.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),o.push("material.diffuseColor      = diffuseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),o.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),o.push("material.specularColor     = mix(vec3(dielectricSpecular), diffuseColor, metallic);"),o.push("geometry.position      = vViewPosition.xyz;"),o.push("geometry.viewNormal    = -normalize(vViewNormal);"),o.push("geometry.viewEyeDir    = normalize(vViewPosition.xyz);"),s.lightMaps.length>0&&o.push("geometry.worldNormal   = normalize(vWorldNormal);"),(s.lightMaps.length>0||s.reflectionMaps.length>0)&&o.push("computePBRLightMapping(geometry, material, reflectedLight);");for(var f=0,m=s.lights.length;f<m;f++){var v=s.lights[f];if("ambient"!==v.type){if("dir"===v.type)"view"===v.space?o.push("light.direction =  normalize(lightDir"+f+");"):o.push("light.direction =  normalize((viewMatrix * vec4(lightDir"+f+", 0.0)).xyz);");else if("point"===v.type)"view"===v.space?o.push("light.direction =  normalize(lightPos"+f+" - vViewPosition.xyz);"):o.push("light.direction =  normalize((viewMatrix * vec4(lightPos"+f+", 0.0)).xyz);");else{if("spot"!==v.type)continue;"view"===v.space?o.push("light.direction =  normalize(lightDir"+f+");"):o.push("light.direction =  normalize((viewMatrix * vec4(lightDir"+f+", 0.0)).xyz);")}o.push("light.color =  lightColor"+f+".rgb * lightColor"+f+".a;"),o.push("computePBRLighting(light, geometry, material, reflectedLight);")}}return o.push("vec3 outgoingLight = (lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedLight.diffuse) + (reflectedLight.specular);"),o.push("vec4 fragColor;"),this._withSAO?(o.push("   float viewportWidth     = uSAOParams[0];"),o.push("   float viewportHeight    = uSAOParams[1];"),o.push("   float blendCutoff       = uSAOParams[2];"),o.push("   float blendFactor       = uSAOParams[3];"),o.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),o.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBAToDepth(texture2D(uOcclusionTexture, uv))) * blendFactor;"),o.push("   fragColor               = vec4(outgoingLight.rgb * ambient, alpha);")):o.push("   fragColor            = vec4(outgoingLight.rgb, alpha);"),t&&o.push("fragColor = linearToGamma(fragColor, gammaFactor);"),o.push("gl_FragColor = fragColor;"),e.logarithmicDepthBufferEnabled&&Ze.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("}"),o}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),$i=q.vec3(),es=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),this._program.bindTexture(this._uTexturePerObjectIdPositionsDecodeMatrix,{bind:function(e){return o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,a.texturePerObjectIdPositionsDecodeMatrix),!0},unbind:function(e){o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,null)}},1),this._program.bindTexture(this._uTexturePerVertexIdCoordinates,{bind:function(e){return o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,a.texturePerVertexIdCoordinates),!0},unbind:function(e){o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,null)}},2),this._program.bindTexture(this._uTexturePerObjectIdColorsAndFlags,{bind:function(e){return o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,a.texturePerObjectIdColorsAndFlags),!0},unbind:function(e){o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,null)}},3),o.uniform1i(this._uRenderPass,i),o.uniform1i(this._uPickInvisible,e.pickInvisible),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var h=e.pickViewMatrix||n.viewMatrix,l=u?De(h,u):h;if(o.uniformMatrix4fv(this._uViewMatrix,!1,l),o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),r.logarithmicDepthBufferEnabled){var c=2/(Math.log(n.project.far+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,c)}var p=r._sectionPlanesState.sectionPlanes.length;if(p>0)for(var d=r._sectionPlanesState.sectionPlanes,f=t.layerIndex*p,m=s.renderFlags,v=0;v<p;v++){var g=this._uSectionPlanes[v],_=m.sectionPlanesActivePerLayer[f+v];if(o.uniform1i(g.active,_?1:0),_){var y=d[v];if(u){var b=Ee(y.dist,y.dir,u,$i);o.uniform3fv(g.pos,b)}else o.uniform3fv(g.pos,y.pos);o.uniform3fv(g.dir,y.dir)}}a.numIndices8Bits>0&&(this._program.bindTexture(this._uTexturePerPolygonIdPortionIds,{bind:function(e){return o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,a.texturePerPolygonIdPortionIds8Bits),!0},unbind:function(e){o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,null)}},4),this._program.bindTexture(this._uTexturePerPolygonIdIndices,{bind:function(e){return o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,a.texturePerPolygonIdIndices8Bits),!0},unbind:function(e){o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,null)}},5),o.drawArrays(o.TRIANGLES,0,a.numIndices8Bits)),a.numIndices16Bits>0&&(this._program.bindTexture(this._uTexturePerPolygonIdPortionIds,{bind:function(e){return o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,a.texturePerPolygonIdPortionIds16Bits),!0},unbind:function(e){o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,null)}},4),this._program.bindTexture(this._uTexturePerPolygonIdIndices,{bind:function(e){return o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,a.texturePerPolygonIdIndices16Bits),!0},unbind:function(e){o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,null)}},5),o.drawArrays(o.TRIANGLES,0,a.numIndices16Bits)),a.numIndices32Bits>0&&(this._program.bindTexture(this._uTexturePerPolygonIdPortionIds,{bind:function(e){return o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,a.texturePerPolygonIdPortionIds32Bits),!0},unbind:function(e){o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,null)}},4),this._program.bindTexture(this._uTexturePerPolygonIdIndices,{bind:function(e){return o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,a.texturePerPolygonIdIndices32Bits),!0},unbind:function(e){o.activeTexture(o["TEXTURE"+e]),o.bindTexture(o.TEXTURE_2D,null)}},5),o.drawArrays(o.TRIANGLES,0,a.numIndices32Bits)),e.drawElements++}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPackedVertexId=i.getAttribute("packedVertexId"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdNormals="uTexturePerPolygonIdNormals",this._uTexturePerPolygonIdIndices="uTexturePerPolygonIdIndices",this._uTexturePerPolygonIdPortionIds="uTexturePerPolygonIdPortionIds"}}},{key:"_bindProgram",value:function(){this._program.bind()}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles dataTexture pick flat normals vertex shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("precision highp usampler2D;"),i.push("precision highp isampler2D;"),i.push("precision highp sampler2D;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("precision mediump usampler2D;"),i.push("precision mediump isampler2D;"),i.push("precision mediump sampler2D;"),i.push("#endif"),i.push("uniform int renderPass;"),i.push("in uvec3 packedVertexId;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),i.push("uniform usampler2D uTexturePerObjectIdColorsAndFlags;"),i.push("uniform usampler2D uTexturePerVertexIdCoordinates;"),i.push("uniform usampler2D uTexturePerPolygonIdIndices;"),i.push("uniform isampler2D uTexturePerPolygonIdNormals;"),i.push("uniform usampler2D uTexturePerPolygonIdPortionIds;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),i.push("out vec4 vWorldPosition;"),t&&i.push("out int vFlags2;"),i.push("void main(void) {"),i.push("int polygonIndex = gl_VertexID / 3;"),i.push("int h_normal_index = polygonIndex & 4095;"),i.push("int v_normal_index = polygonIndex >> 12;"),i.push("int h_packed_object_id_index = ((polygonIndex >> 3) / 2) & 4095;"),i.push("int v_packed_object_id_index = ((polygonIndex >> 3) / 2) >> 12;"),i.push("ivec3 packedObjectId = ivec3(texelFetch(uTexturePerPolygonIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).rgb);"),i.push("int objectIndex;"),i.push("if (((polygonIndex >> 3) % 2) == 0) {"),i.push("  objectIndex = (packedObjectId.r << 4) + (packedObjectId.g >> 4);"),i.push("} else {"),i.push("  objectIndex = ((packedObjectId.g & 15) << 8) + packedObjectId.b;"),i.push("}"),i.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),i.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),i.push("int h_index = polygonIndex & 4095;"),i.push("int v_index = polygonIndex >> 12;"),i.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdIndices, ivec2(h_index, v_index), 0));"),i.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),i.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),i.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),i.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),i.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),i.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),i.push("vec3 position1 = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.r, indexPositionV.r), 0));"),i.push("vec3 position2 = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.g, indexPositionV.g), 0));"),i.push("vec3 position3 = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.b, indexPositionV.b), 0));"),i.push("vec3 normal = normalize(cross(position3 - position1, position2 - position1));"),i.push("int vertexNumber = gl_VertexID % 3;"),i.push("vec3 position;"),i.push("if (vertexNumber == 0) position = position1;"),i.push("else if (vertexNumber == 1) position = position2;"),i.push("else position = position3;"),i.push("if (int(flags.w) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("      vWorldPosition = worldPosition;"),t&&i.push("      vFlags2 = flags2.r;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Triangles dataTexture pick flat normals fragment shader"),s.push("#extension GL_OES_standard_derivatives : enable"),e.logarithmicDepthBufferEnabled&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),s.push("in vec4 vWorldPosition;"),i){s.push("in int vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("out vec4 outNormal;"),s.push("void main(void) {"),i){s.push("  bool clippable = vFlags2 > 0;"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("  vec3 xTangent = dFdx( vWorldPosition.xyz );"),s.push("  vec3 yTangent = dFdy( vWorldPosition.xyz );"),s.push("  vec3 worldNormal = normalize( cross( xTangent, yTangent ) );"),s.push("  outNormal = vec4((worldNormal * 0.5) + 0.5, 1.0);"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),ts=function(){function e(t){w(this,e),this._scene=t}return I(e,[{key:"_compile",value:function(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._colorRendererWithSAO&&!this._colorRendererWithSAO.getValid()&&(this._colorRendererWithSAO.destroy(),this._colorRendererWithSAO=null),this._flatColorRenderer&&!this._flatColorRenderer.getValid()&&(this._flatColorRenderer.destroy(),this._flatColorRenderer=null),this._flatColorRendererWithSAO&&!this._flatColorRendererWithSAO.getValid()&&(this._flatColorRendererWithSAO.destroy(),this._flatColorRendererWithSAO=null),this._colorQualityRenderer&&!this._colorQualityRenderer.getValid()&&(this._colorQualityRenderer.destroy(),this._colorQualityRenderer=null),this._colorQualityRendererWithSAO&&!this._colorQualityRendererWithSAO.getValid()&&(this._colorQualityRendererWithSAO.destroy(),this._colorQualityRendererWithSAO=null),this._depthRenderer&&!this._depthRenderer.getValid()&&(this._depthRenderer.destroy(),this._depthRenderer=null),this._normalsRenderer&&!this._normalsRenderer.getValid()&&(this._normalsRenderer.destroy(),this._normalsRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._edgesRenderer&&!this._edgesRenderer.getValid()&&(this._edgesRenderer.destroy(),this._edgesRenderer=null),this._edgesColorRenderer&&!this._edgesColorRenderer.getValid()&&(this._edgesColorRenderer.destroy(),this._edgesColorRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._pickNormalsRenderer&&!1===this._pickNormalsRenderer.getValid()&&(this._pickNormalsRenderer.destroy(),this._pickNormalsRenderer=null),this._pickNormalsFlatRenderer&&!1===this._pickNormalsFlatRenderer.getValid()&&(this._pickNormalsFlatRenderer.destroy(),this._pickNormalsFlatRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null),this._shadowRenderer&&!this._shadowRenderer.getValid()&&(this._shadowRenderer.destroy(),this._shadowRenderer=null)}},{key:"colorRenderer",get:function(){return this._colorRenderer||(this._colorRenderer=new Di(this._scene,!1)),this._colorRenderer}},{key:"colorRendererWithSAO",get:function(){return this._colorRendererWithSAO||(this._colorRendererWithSAO=new Di(this._scene,!0)),this._colorRendererWithSAO}},{key:"colorQualityRenderer",get:function(){return this._colorQualityRenderer||(this._colorQualityRenderer=new qi(this._scene,!1)),this._colorQualityRenderer}},{key:"colorQualityRendererWithSAO",get:function(){return this._colorQualityRendererWithSAO||(this._colorQualityRendererWithSAO=new qi(this._scene,!0)),this._colorQualityRendererWithSAO}},{key:"silhouetteRenderer",get:function(){return this._silhouetteRenderer||(this._silhouetteRenderer=new Ei(this._scene)),this._silhouetteRenderer}},{key:"depthRenderer",get:function(){return this._depthRenderer||(this._depthRenderer=new Wi(this._scene)),this._depthRenderer}},{key:"normalsRenderer",get:function(){return this._normalsRenderer||(this._normalsRenderer=new Yi(this._scene)),this._normalsRenderer}},{key:"edgesRenderer",get:function(){return this._edgesRenderer||(this._edgesRenderer=new Si(this._scene)),this._edgesRenderer}},{key:"edgesColorRenderer",get:function(){return this._edgesColorRenderer||(this._edgesColorRenderer=new Bi(this._scene)),this._edgesColorRenderer}},{key:"pickMeshRenderer",get:function(){return this._pickMeshRenderer||(this._pickMeshRenderer=new Ni(this._scene)),this._pickMeshRenderer}},{key:"pickNormalsRenderer",get:function(){return this._pickNormalsRenderer||(this._pickNormalsRenderer=new Ui(this._scene)),this._pickNormalsRenderer}},{key:"pickNormalsFlatRenderer",get:function(){return this._pickNormalsFlatRenderer||(this._pickNormalsFlatRenderer=new es(this._scene)),this._pickNormalsFlatRenderer}},{key:"pickDepthRenderer",get:function(){return this._pickDepthRenderer||(this._pickDepthRenderer=new Gi(this._scene)),this._pickDepthRenderer}},{key:"occlusionRenderer",get:function(){return this._occlusionRenderer||(this._occlusionRenderer=new Vi(this._scene)),this._occlusionRenderer}},{key:"shadowRenderer",get:function(){return this._shadowRenderer||(this._shadowRenderer=new Ki(this._scene)),this._shadowRenderer}},{key:"_destroy",value:function(){this._colorRenderer&&this._colorRenderer.destroy(),this._colorRendererWithSAO&&this._colorRendererWithSAO.destroy(),this._flatColorRenderer&&this._flatColorRenderer.destroy(),this._flatColorRendererWithSAO&&this._flatColorRendererWithSAO.destroy(),this._colorQualityRenderer&&this._colorQualityRenderer.destroy(),this._colorQualityRendererWithSAO&&this._colorQualityRendererWithSAO.destroy(),this._depthRenderer&&this._depthRenderer.destroy(),this._normalsRenderer&&this._normalsRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._edgesRenderer&&this._edgesRenderer.destroy(),this._edgesColorRenderer&&this._edgesColorRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._pickNormalsRenderer&&this._pickNormalsRenderer.destroy(),this._pickNormalsFlatRenderer&&this._pickNormalsFlatRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy(),this._shadowRenderer&&this._shadowRenderer.destroy()}}]),e}(),is={};Ze.SUPPORTED_EXTENSIONS.OES_element_index_uint;var ss=I((function e(){w(this,e),this.positions=[],this.metallicRoughness=[],this.indices8Bits=[],this.indices16Bits=[],this.indices32Bits=[],this.edgeIndices8Bits=[],this.edgeIndices16Bits=[],this.edgeIndices32Bits=[],this.perObjectColors=[],this.perObjectPickColors=[],this.perObjectSolid=[],this.perObjectOffsets=[],this.perObjectPositionsDecodeMatrices=[],this.perObjectInstancePositioningMatrices=[],this.perObjectVertexBases=[],this.perObjectIndexBaseOffsets=[],this.perObjectEdgeIndexBaseOffsets=[],this.perTriangleNumberPortionId8Bits=[],this.perTriangleNumberPortionId16Bits=[],this.perTriangleNumberPortionId32Bits=[],this.perEdgeNumberPortionId8Bits=[],this.perEdgeNumberPortionId16Bits=[],this.perEdgeNumberPortionId32Bits=[]})),rs=null;
/**
 * @author https://github.com/tmarti, with support from https://tribia.com/
 * @license MIT
 * 
 * This file takes a geometry given by { positions, indices }, and returns
 * equivalent { positions, indices } arrays but which only contain unique
 * positions.
 * 
 * The time is O(N logN) with the number of positions due to a pre-sorting
 * step, but is much more GC-friendly and actually faster than the classic O(N)
 * approach based in keeping a hash-based LUT to identify unique positions.
 */function ns(e,t){for(var i,s=0;s<3;s++)if(0!=(i=rs[3*e+s]-rs[3*t+s]))return i;return 0}var os=null;function as(e){var t=e.positions,i=e.indices,s=e.edgeIndices;!function(e){if(!(null!==os&&os.length>=e)){os=new Uint32Array(e);for(var t=0;t<e;t++)os[t]=t}}(t.length/3);var r=os.slice(0,t.length/3),n=os.slice(0,t.length/3);rs=t,r.sort(ns);var o=0;n[r[0]]=0;for(var a=1,u=r.length;a<u;a++)0!=ns(r[a],r[a-1])&&o++,n[r[a]]=o;var h=new Uint16Array(3*(o+1));h[3*(o=0)+0]=t[3*r[0]+0],h[3*o+1]=t[3*r[0]+1],h[3*o+2]=t[3*r[0]+2];for(var l=1,c=r.length;l<c;l++)0!=ns(r[l],r[l-1])&&(h[3*++o+0]=t[3*r[l]+0],h[3*o+1]=t[3*r[l]+1],h[3*o+2]=t[3*r[l]+2]),n[r[l]]=o;rs=null;for(var p=new Uint32Array(i.length),d=0,f=i.length;d<f;d++)p[d]=n[i[d]];for(var m=new Uint32Array(s.length),v=0,g=s.length;v<g;v++)m[v]=n[s[v]];return[h,p,m]}
/**
 * @author https://github.com/tmarti, with support from https://tribia.com/
 * @license MIT
 **/var us=null;function hs(e,t){var i,s,r,n,o,a,u=3*e,h=3*t,l=Math.min(i=us[u],s=us[u+1],r=us[u+2]),c=Math.min(n=us[h],o=us[h+1],a=us[h+2]);if(l!=c)return l-c;var p=Math.max(i,s,r),d=Math.max(n,o,a);return p!=d?p-d:0}function ls(e,t){for(var i=new Int32Array(e.length/3),s=0,r=i.length;s<r;s++)i[s]=s;us=new Int32Array(e.length);for(var n=0,o=e.length;n<o;n++)us[n]=e[n]>>t;i.sort(hs);for(var a=new Int32Array(e.length),u=0,h=i.length;u<h;u++)a[3*u+0]=e[3*i[u]+0],a[3*u+1]=e[3*i[u]+1],a[3*u+2]=e[3*i[u]+2];return a}var cs=null;function ps(e,t){var i=cs[2*e]-cs[2*t];return 0!=i?i:cs[2*e+1]-cs[2*t+1]}function ds(e){if(0==(e||[]).length)return[];for(var t=new Int32Array(e.length/2),i=0,s=t.length;i<s;i++)t[i]=i;for(var r=0,n=e.length;r<n;r+=2)if(e[r]>e[r+1]){var o=e[r];e[r]=e[r+1],e[r+1]=o}cs=new Int32Array(e),t.sort(ps);for(var a=new Int32Array(e.length),u=0,h=t.length;u<h;u++)a[2*u+0]=e[2*t[u]+0],a[2*u+1]=e[2*t[u]+1];return a}function fs(e,t){var i={},s={};e.forEach((function(e){for(var t=e.indices,r=e.edgeIndices,n=e.positions,o=0,a=t.length;o<a;o+=3){var u=n[3*t[o]]+"_"+n[3*t[o]+1]+"_"+n[3*t[o]+2]+"/"+n[3*t[o+1]]+"_"+n[3*t[o+1]+1]+"_"+n[3*t[o+1]+2]+"/"+n[3*t[o+2]]+"_"+n[3*t[o+2]+1]+"_"+n[3*t[o+2]+2];i[u]=!0}e.edgeIndices.length/2;for(o=0,a=r.length;o<a;o+=2){u=n[3*r[o]]+"_"+n[3*r[o]+1]+"_"+n[3*r[o]+2]+"/"+n[3*r[o+1]]+"_"+n[3*r[o+1]+1]+"_"+n[3*r[o+1]+2]+"/";s[u]=!0}}));var r=t.indices;t.edgeIndices;for(var n=t.positions,o=0,a=r.length;o<a;o+=3){var u=n[3*r[o]]+"_"+n[3*r[o]+1]+"_"+n[3*r[o]+2]+"/"+n[3*r[o+1]]+"_"+n[3*r[o+1]+1]+"_"+n[3*r[o+1]+2]+"/"+n[3*r[o+2]]+"_"+n[3*r[o+2]+1]+"_"+n[3*r[o+2]+2];if(!(u in i))throw console.log("Not found "+u),"Ohhhh!"}}var ms={sizeDataColorsAndFlags:0,sizeDataPositionDecodeMatrices:0,sizeDataTextureOffsets:0,sizeDataTexturePositions:0,sizeDataTextureIndices:0,sizeDataTextureEdgeIndices:0,sizeDataTexturePortionIds:0,numberOfGeometries:0,numberOfPortions:0,numberOfLayers:0,numberOfTextures:0,totalPolygons:0,totalPolygons8Bits:0,totalPolygons16Bits:0,totalPolygons32Bits:0,totalEdges:0,totalEdges8Bits:0,totalEdges16Bits:0,totalEdges32Bits:0,cannotCreatePortion:{because10BitsObjectId:0,becauseTextureSize:0},overheadSizeAlignementIndices:0,overheadSizeAlignementEdgeIndices:0};window.printDataTextureRamStats=function(){console.log(JSON.stringify(ms,null,4));var e=0;Object.keys(ms).forEach((function(t){t.startsWith("size")&&(e+=ms[t])})),console.log("Total size ".concat(e," bytes (").concat((e/1e3/1e3).toFixed(2)," MB)")),console.log("Avg bytes / triangle: ".concat((e/ms.totalPolygons).toFixed(2)));var t={};Object.keys(ms).forEach((function(i){i.startsWith("size")&&(t[i]="".concat((ms[i]/e*100).toFixed(2)," % of total"))})),console.log(JSON.stringify({percentualRamUsage:t},null,4))};var vs=function(){function e(t,i,s,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;w(this,e),this._gl=t,this._texture=i,this._textureWidth=s,this._textureHeight=r,this._textureData=n}return I(e,[{key:"bindTexture",value:function(e,t,i){return e.bindTexture(t,this,i)}},{key:"bind",value:function(e){return this._gl.activeTexture(this._gl["TEXTURE"+e]),this._gl.bindTexture(this._gl.TEXTURE_2D,this._texture),!0}},{key:"unbind",value:function(e){}}]),e}(),gs=function(){function e(){w(this,e),this.texturePerObjectIdColorsAndFlags=null,this.texturePerObjectIdOffsets=null,this.texturePerObjectIdPositionsDecodeMatrix=null,this.texturePerVertexIdCoordinates=null,this.texturePerPolygonIdPortionIds8Bits=null,this.texturePerPolygonIdPortionIds16Bits=null,this.texturePerPolygonIdPortionIds32Bits=null,this.texturePerEdgeIdPortionIds8Bits=null,this.texturePerEdgeIdPortionIds16Bits=null,this.texturePerEdgeIdPortionIds32Bits=null,this.texturePerPolygonIdIndices8Bits=null,this.texturePerPolygonIdIndices16Bits=null,this.texturePerPolygonIdIndices32Bits=null,this.texturePerPolygonIdEdgeIndices8Bits=null,this.texturePerPolygonIdEdgeIndices16Bits=null,this.texturePerPolygonIdEdgeIndices32Bits=null,this.textureCameraMatrices=null,this.texturePickCameraMatrices=null,this.textureModelMatrices=null}return I(e,[{key:"finalize",value:function(){this.indicesPerBitnessTextures={8:this.texturePerPolygonIdIndices8Bits,16:this.texturePerPolygonIdIndices16Bits,32:this.texturePerPolygonIdIndices32Bits},this.indicesPortionIdsPerBitnessTextures={8:this.texturePerPolygonIdPortionIds8Bits,16:this.texturePerPolygonIdPortionIds16Bits,32:this.texturePerPolygonIdPortionIds32Bits},this.edgeIndicesPerBitnessTextures={8:this.texturePerPolygonIdEdgeIndices8Bits,16:this.texturePerPolygonIdEdgeIndices16Bits,32:this.texturePerPolygonIdEdgeIndices32Bits},this.edgeIndicesPortionIdsPerBitnessTextures={8:this.texturePerEdgeIdPortionIds8Bits,16:this.texturePerEdgeIdPortionIds16Bits,32:this.texturePerEdgeIdPortionIds32Bits}}},{key:"bindCommonTextures",value:function(e,t,i,s,r,n,o){this.texturePerObjectIdPositionsDecodeMatrix.bindTexture(e,t,1),this.texturePerVertexIdCoordinates.bindTexture(e,i,2),this.texturePerObjectIdColorsAndFlags.bindTexture(e,s,3),this.textureCameraMatrices.bindTexture(e,r,4),this.textureModelMatrices.bindTexture(e,n,5),this.texturePerObjectIdOffsets.bindTexture(e,o,6)}},{key:"bindPickCameraTexture",value:function(e,t){this.texturePickCameraMatrices.bindTexture(e,t,4)}},{key:"bindTriangleIndicesTextures",value:function(e,t,i,s){this.indicesPortionIdsPerBitnessTextures[s].bindTexture(e,t,7),this.indicesPerBitnessTextures[s].bindTexture(e,i,8)}},{key:"bindEdgeIndicesTextures",value:function(e,t,i,s){this.edgeIndicesPortionIdsPerBitnessTextures[s].bindTexture(e,t,7),this.edgeIndicesPerBitnessTextures[s].bindTexture(e,i,8)}}]),e}(),_s=function(){function e(){w(this,e)}return I(e,[{key:"disableBindedTextureFiltering",value:function(e){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}},{key:"generateCameraDataTexture",value:function(e,t,i,s){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],n=4,o=3,a=e.createTexture();e.bindTexture(e.TEXTURE_2D,a),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA32F,n,o),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null);var u=new vs(e,a,n,o),h=!0;if(u._updateViewMatrix=function(i,r){e.bindTexture(e.TEXTURE_2D,u._texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,4,1,e.RGBA,e.FLOAT,new Float32Array(s?De(i,s):i)),e.texSubImage2D(e.TEXTURE_2D,0,0,1,4,1,e.RGBA,e.FLOAT,new Float32Array(t.viewNormalMatrix)),e.texSubImage2D(e.TEXTURE_2D,0,0,2,4,1,e.RGBA,e.FLOAT,new Float32Array(r))},r){var l=function(){h&&(h=!1,u._updateViewMatrix(t.viewMatrix,t.project.matrix))};t.on("matrix",(function(){return h=!0})),i.on("rendering",l),l()}return u}},{key:"generatePeformanceModelDataTexture",value:function(e,t){var i=e.createTexture();return e.bindTexture(e.TEXTURE_2D,i),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA32F,4,2),e.texSubImage2D(e.TEXTURE_2D,0,0,0,4,1,e.RGBA,e.FLOAT,new Float32Array(t.worldMatrix)),e.texSubImage2D(e.TEXTURE_2D,0,0,1,4,1,e.RGBA,e.FLOAT,new Float32Array(t.worldNormalMatrix)),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null),new vs(e,i,4,2)}},{key:"generateTextureForColorsAndFlags",value:function(e,t,i,s,r,n,o){var a=t.length;this.numPortions=a;var u=4096,h=Math.ceil(a/512);if(0==h)throw"texture height == 0";var l=new Uint8Array(16384*h);ms.sizeDataColorsAndFlags+=l.byteLength,ms.numberOfTextures++;for(var c=0;c<a;c++)l.set(t[c],32*c+0),l.set(i[c],32*c+4),l.set([0,0,0,0],32*c+8),l.set([0,0,0,0],32*c+12),l.set([s[c]>>24&255,s[c]>>16&255,s[c]>>8&255,255&s[c]],32*c+16),l.set([r[c]>>24&255,r[c]>>16&255,r[c]>>8&255,255&r[c]],32*c+20),l.set([n[c]>>24&255,n[c]>>16&255,n[c]>>8&255,255&n[c]],32*c+24),l.set([o[c]?1:0,0,0,0],32*c+28);var p=e.createTexture();return e.bindTexture(e.TEXTURE_2D,p),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8UI,u,h),e.texSubImage2D(e.TEXTURE_2D,0,0,0,u,h,e.RGBA_INTEGER,e.UNSIGNED_BYTE,l,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new vs(e,p,u,h,l)}},{key:"generateTextureForObjectOffsets",value:function(e,t){var i=512,s=Math.ceil(t/i);if(0==s)throw"texture height == 0";var r=new Float32Array(1536*s).fill(0);ms.sizeDataTextureOffsets+=r.byteLength,ms.numberOfTextures++;var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32F,i,s),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,s,e.RGB,e.FLOAT,r,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new vs(e,n,i,s,r)}},{key:"generateTextureForPositionsDecodeMatrices",value:function(e,t,i){var s=t.length;if(0==s)throw"num decode+entity matrices == 0";var r=4096,n=Math.ceil(s/512),o=new Float32Array(16384*n);ms.sizeDataPositionDecodeMatrices+=o.byteLength,ms.numberOfTextures++;for(var a=0;a<t.length;a++)o.set(t[a],32*a),o.set(i[a],32*a+16);var u=e.createTexture();return e.bindTexture(e.TEXTURE_2D,u),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA32F,r,n),e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,n,e.RGBA,e.FLOAT,o,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new vs(e,u,r,n)}},{key:"generateTextureFor8BitIndices",value:function(e,t){if(0==t.length)return{texture:null,textureHeight:0};var i=4096,s=Math.ceil(t.length/3/i);if(0==s)throw"texture height == 0";var r=new Uint8Array(i*s*3);ms.sizeDataTextureIndices+=r.byteLength,ms.numberOfTextures++,r.fill(0),r.set(t,0);var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RGB8UI,i,s),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,s,e.RGB_INTEGER,e.UNSIGNED_BYTE,r,0),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null),new vs(e,n,i,s)}},{key:"generateTextureFor16BitIndices",value:function(e,t){if(0==t.length)return{texture:null,textureHeight:0};var i=4096,s=Math.ceil(t.length/3/i);if(0==s)throw"texture height == 0";var r=new Uint16Array(i*s*3);ms.sizeDataTextureIndices+=r.byteLength,ms.numberOfTextures++,r.fill(0),r.set(t,0);var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,s),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,s,e.RGB_INTEGER,e.UNSIGNED_SHORT,r,0),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null),new vs(e,n,i,s)}},{key:"generateTextureFor32BitIndices",value:function(e,t){if(0==t.length)return{texture:null,textureHeight:0};var i=4096,s=Math.ceil(t.length/3/i);if(0==s)throw"texture height == 0";var r=new Uint32Array(i*s*3);ms.sizeDataTextureIndices+=r.byteLength,ms.numberOfTextures++,r.fill(0),r.set(t,0);var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32UI,i,s),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,s,e.RGB_INTEGER,e.UNSIGNED_INT,r,0),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null),new vs(e,n,i,s)}},{key:"generateTextureFor8BitsEdgeIndices",value:function(e,t){if(0==t.length)return{texture:null,textureHeight:0};var i=4096,s=Math.ceil(t.length/2/i);if(0==s)throw"texture height == 0";var r=new Uint8Array(i*s*2);ms.sizeDataTextureEdgeIndices+=r.byteLength,ms.numberOfTextures++,r.fill(0),r.set(t,0);var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RG8UI,i,s),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,s,e.RG_INTEGER,e.UNSIGNED_BYTE,r,0),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null),new vs(e,n,i,s)}},{key:"generateTextureFor16BitsEdgeIndices",value:function(e,t){if(0==t.length)return{texture:null,textureHeight:0};var i=4096,s=Math.ceil(t.length/2/i);if(0==s)throw"texture height == 0";var r=new Uint16Array(i*s*2);ms.sizeDataTextureEdgeIndices+=r.byteLength,ms.numberOfTextures++,r.fill(0),r.set(t,0);var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RG16UI,i,s),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,s,e.RG_INTEGER,e.UNSIGNED_SHORT,r,0),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null),new vs(e,n,i,s)}},{key:"generateTextureFor32BitsEdgeIndices",value:function(e,t){if(0==t.length)return{texture:null,textureHeight:0};var i=4096,s=Math.ceil(t.length/2/i);if(0==s)throw"texture height == 0";var r=new Uint32Array(i*s*2);ms.sizeDataTextureEdgeIndices+=r.byteLength,ms.numberOfTextures++,r.fill(0),r.set(t,0);var n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RG32UI,i,s),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,s,e.RG_INTEGER,e.UNSIGNED_INT,r,0),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null),new vs(e,n,i,s)}},{key:"generateTextureForPositions",value:function(e,t){var i=t.length/3,s=4096,r=Math.ceil(i/s);if(0==r)throw"texture height == 0";var n=new Uint16Array(s*r*3);ms.sizeDataTexturePositions+=n.byteLength,ms.numberOfTextures++,n.fill(0),n.set(t,0);var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,s,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,s,r,e.RGB_INTEGER,e.UNSIGNED_SHORT,n,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new vs(e,o,s,r)}},{key:"generateTextureForPackedPortionIds",value:function(e,t){if(0==t.length)return{texture:null,textureHeight:0};var i=t.length,s=4096,r=Math.ceil(i/s);if(0==r)throw"texture height == 0";var n=new Uint16Array(s*r);n.set(t,0),ms.sizeDataTexturePortionIds+=n.byteLength,ms.numberOfTextures++;var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.R16UI,s,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,s,r,e.RED_INTEGER,e.UNSIGNED_SHORT,n,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new vs(e,o,s,r)}}]),e}(),ys=q.identityMat4();q.mat4(),q.mat4();var bs=q.vec4([0,0,0,1]),xs=q.vec4([0,0,0,1]),Ps=q.vec4([0,0,0,1]),Ts=q.OBB3(),ws=new Uint8Array(4),Ms=new Float32Array(3),Is=q.vec3(),Cs=q.vec3(),Ds=q.vec3(),As=q.vec3(),ks=q.vec3(),Es=q.vec3(),Fs=q.vec3(),Rs=0,Ss=function(){function e(t,i){var s,r,n;w(this,e),this._layerNumber=Rs++,ms.numberOfLayers++,this.sortId="TrianglesDataTextureLayer-".concat(this._layerNumber),this.layerIndex=i.layerIndex,this._dataTextureRenderers=(s=t.scene,r=s.id,(n=is[r])||(n=new ts(s),is[r]=n,n._compile(),s.on("compile",(function(){n._compile()})),s.on("destroyed",(function(){delete is[r],n._destroy()}))),n),this.model=t,this._buffer=new ss,this._dataTextureState=new gs,this.dataTextureGenerator=new _s,this._state=new ti({metallicRoughnessBuf:null,positionsDecodeMatrix:q.mat4(),textureState:this._dataTextureState,numIndices8Bits:0,numIndices16Bits:0,numIndices32Bits:0,numEdgeIndices8Bits:0,numEdgeIndices16Bits:0,numEdgeIndices32Bits:0,numVertices:0}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numSelectedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._modelAABB=q.collapseAABB3(),this._portions=[],this._finalized=!1,this._subPortionIdMapping=[],this._instancedGeometrySubPortionData={},this.aabb=q.collapseAABB3(),this.numUpdatesInFrame=0}return I(e,[{key:"canCreatePortion",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._finalized)throw"Already finalized";var i=this._state,s=e.preparedBuckets.length;this._numPortions+s>65536&&ms.cannotCreatePortion.because10BitsObjectId++;var r=this._numPortions+s<=65536,n=null!==t&&t+"#0"in this._instancedGeometrySubPortionData;if(!n){var o=Math.max(i.numIndices8Bits,i.numIndices16Bits,i.numIndices32Bits),a=0,u=e.indices.length/3;e.preparedBuckets.forEach((function(e){a+=e.positions.length/3})),(i.numVertices+a>16777216||o+u>16777216)&&ms.cannotCreatePortion.becauseTextureSize++,r&&(r=i.numVertices+a<=16777216&&o+u<=16777216)}return r}},{key:"createPortion",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._finalized)throw"Already finalized";var s=null!==i,r=this._subPortionIdMapping.length,n=[];this._subPortionIdMapping.push(n);var o=s?i.aabb:e.aabb;return e.preparedBuckets.forEach((function(r,a){var u;if(s){var h=e.id+"#"+a;h in t._instancedGeometrySubPortionData||(t._instancedGeometrySubPortionData[h]=t.createSubPortionGeometry(r)),u=t._instancedGeometrySubPortionData[h]}else u=t.createSubPortionGeometry(r);var l=q.collapseAABB3(),c=t.createSubPortionObject(s?i:e,u,r.positions,e.positionsDecodeMatrix,s?i.origin:e.origin,l,s,e.solid);q.expandAABB3(o,l),n.push(c)})),this.model.numPortions++,r}},{key:"createSubPortionGeometry",value:function(e){var t=this._state;if(e.indices){var i=8*Math.ceil(e.indices.length/3/8)*3;ms.overheadSizeAlignementIndices+=2*(i-e.indices.length);var s=new Uint32Array(i);s.fill(0),s.set(e.indices),e.indices=s}if(e.edgeIndices){var r=8*Math.ceil(e.edgeIndices.length/2/8)*2;ms.overheadSizeAlignementEdgeIndices+=2*(r-e.edgeIndices.length);var n=new Uint32Array(r);n.fill(0),n.set(e.edgeIndices),e.edgeIndices=n}for(var o,a=e.positions,u=e.indices,h=e.edgeIndices,l=this._buffer,c=l.positions.length/3,p=a.length/3,d=0,f=a.length;d<f;d++)l.positions.push(a[d]);var m,v=0;if(u){var g;v=u.length/3,o=(g=p<=256?l.indices8Bits:p<=65536?l.indices16Bits:l.indices32Bits).length/3;for(var _=0,y=u.length;_<y;_++)g.push(u[_])}var b=0;if(h){var x;b=h.length/2,m=(x=p<=256?l.edgeIndices8Bits:p<=65536?l.edgeIndices16Bits:l.edgeIndices32Bits).length/2;for(var P=0,T=h.length;P<T;P++)x.push(h[P])}return t.numVertices+=p,ms.numberOfGeometries++,{vertexBase:c,numVertices:p,numTriangles:v,numEdges:b,indicesBase:o,edgeIndicesBase:m}}},{key:"createSubPortionObject",value:function(e,t,i,s,r,n,o,a){var u=e.color;e.metallic,e.roughness;var h=e.colors,l=e.opacity,c=e.meshMatrix,p=e.worldMatrix,d=e.pickColor;this.model.scene;var f,m,v=this._buffer,g=this._state;if(v.perObjectPositionsDecodeMatrices.push(s),o?v.perObjectInstancePositioningMatrices.push(c):v.perObjectInstancePositioningMatrices.push(ys),o){var _=q.collapseAABB3();q.expandAABB3Points3(_,i),ui.decompressAABB(_,s);for(var y=q.AABB3ToOBB3(_),b=0,x=y.length;b<x;b+=4)bs[0]=y[b+0],bs[1]=y[b+1],bs[2]=y[b+2],q.transformPoint4(c,bs,xs),p?(q.transformPoint4(p,xs,Ps),q.expandAABB3Point3(n,Ps)):q.expandAABB3Point3(n,xs)}else if(s){var P=ui.getPositionsBounds(i),T=ui.decompressPosition(P.min,s,[]),w=ui.decompressPosition(P.max,s,[]);n[0]=T[0],n[1]=T[1],n[2]=T[2],n[3]=w[0],n[4]=w[1],n[5]=w[2],p&&(q.AABB3ToOBB3(n,Ts),q.transformOBB3(p,Ts),q.OBB3ToAABB3(Ts,n))}else if(c)for(var M=0,I=i.length;M<I;M+=3)bs[0]=i[M+0],bs[1]=i[M+1],bs[2]=i[M+2],q.transformPoint4(c,bs,xs),i[M+0]=xs[0],i[M+1]=xs[1],i[M+2]=xs[2],q.expandAABB3Point3(this._modelAABB,xs),p?(q.transformPoint4(p,xs,Ps),q.expandAABB3Point3(n,Ps)):q.expandAABB3Point3(n,xs);else for(var C=0,D=i.length;C<D;C+=3)bs[0]=i[C+0],bs[1]=i[C+1],bs[2]=i[C+2],q.expandAABB3Point3(this._modelAABB,bs),p?(q.transformPoint4(p,bs,xs),q.expandAABB3Point3(n,xs)):q.expandAABB3Point3(n,bs);r&&(this._state.origin=r,n[0]+=r[0],n[1]+=r[1],n[2]+=r[2],n[3]+=r[0],n[4]+=r[1],n[5]+=r[2]),q.expandAABB3(this.aabb,n),v.perObjectSolid.push(a),h?v.perObjectColors.push([255*h[0],255*h[1],255*h[2],255]):u&&v.perObjectColors.push([u[0],u[1],u[2],l]),v.perObjectPickColors.push(d),v.perObjectVertexBases.push(t.vertexBase),f=t.numVertices<=256?g.numIndices8Bits:t.numVertices<=65536?g.numIndices16Bits:g.numIndices32Bits,v.perObjectIndexBaseOffsets.push(f/3-t.indicesBase),m=t.numVertices<=256?g.numEdgeIndices8Bits:t.numVertices<=65536?g.numEdgeIndices16Bits:g.numEdgeIndices32Bits,v.perObjectEdgeIndexBaseOffsets.push(m/2-t.edgeIndicesBase);var A=this._portions.length;if(t.numTriangles>0){var k,E=3*t.numTriangles;t.numVertices<=256?(k=v.perTriangleNumberPortionId8Bits,g.numIndices8Bits+=E,ms.totalPolygons8Bits+=t.numTriangles):t.numVertices<=65536?(k=v.perTriangleNumberPortionId16Bits,g.numIndices16Bits+=E,ms.totalPolygons16Bits+=t.numTriangles):(k=v.perTriangleNumberPortionId32Bits,g.numIndices32Bits+=E,ms.totalPolygons32Bits+=t.numTriangles),ms.totalPolygons+=t.numTriangles;for(var F=0;F<t.numTriangles;F+=8)k.push(A)}if(t.numEdges>0){var R,S=2*t.numEdges;t.numVertices<=256?(R=v.perEdgeNumberPortionId8Bits,g.numEdgeIndices8Bits+=S,ms.totalEdges8Bits+=t.numEdges):t.numVertices<=65536?(R=v.perEdgeNumberPortionId16Bits,g.numEdgeIndices16Bits+=S,ms.totalEdges16Bits+=t.numEdges):(R=v.perEdgeNumberPortionId32Bits,g.numEdgeIndices32Bits+=S,ms.totalEdges32Bits+=t.numEdges),ms.totalEdges+=t.numEdges;for(var O=0;O<t.numEdges;O+=8)R.push(A)}return v.perObjectOffsets.push([0,0,0]),this._portions.push({numVerts:t.numTriangles}),this._numPortions++,ms.numberOfPortions++,A}},{key:"finalize",value:function(){if(this._finalized)this.model.error("Already finalized");else{var e=this._state,t=this._dataTextureState,i=this.model.scene.canvas.gl,s=this._buffer;e.gl=i,t.texturePerObjectIdColorsAndFlags=this.dataTextureGenerator.generateTextureForColorsAndFlags(i,s.perObjectColors,s.perObjectPickColors,s.perObjectVertexBases,s.perObjectIndexBaseOffsets,s.perObjectEdgeIndexBaseOffsets,s.perObjectSolid),t.texturePerObjectIdOffsets=this.dataTextureGenerator.generateTextureForObjectOffsets(i,this._numPortions),t.texturePerObjectIdPositionsDecodeMatrix=this.dataTextureGenerator.generateTextureForPositionsDecodeMatrices(i,s.perObjectPositionsDecodeMatrices,s.perObjectInstancePositioningMatrices),t.texturePerVertexIdCoordinates=this.dataTextureGenerator.generateTextureForPositions(i,s.positions),t.texturePerPolygonIdPortionIds8Bits=this.dataTextureGenerator.generateTextureForPackedPortionIds(i,s.perTriangleNumberPortionId8Bits),t.texturePerPolygonIdPortionIds16Bits=this.dataTextureGenerator.generateTextureForPackedPortionIds(i,s.perTriangleNumberPortionId16Bits),t.texturePerPolygonIdPortionIds32Bits=this.dataTextureGenerator.generateTextureForPackedPortionIds(i,s.perTriangleNumberPortionId32Bits),s.perEdgeNumberPortionId8Bits.length>0&&(t.texturePerEdgeIdPortionIds8Bits=this.dataTextureGenerator.generateTextureForPackedPortionIds(i,s.perEdgeNumberPortionId8Bits)),s.perEdgeNumberPortionId16Bits.length>0&&(t.texturePerEdgeIdPortionIds16Bits=this.dataTextureGenerator.generateTextureForPackedPortionIds(i,s.perEdgeNumberPortionId16Bits)),s.perEdgeNumberPortionId32Bits.length>0&&(t.texturePerEdgeIdPortionIds32Bits=this.dataTextureGenerator.generateTextureForPackedPortionIds(i,s.perEdgeNumberPortionId32Bits)),s.indices8Bits.length>0&&(t.texturePerPolygonIdIndices8Bits=this.dataTextureGenerator.generateTextureFor8BitIndices(i,s.indices8Bits)),s.indices16Bits.length>0&&(t.texturePerPolygonIdIndices16Bits=this.dataTextureGenerator.generateTextureFor16BitIndices(i,s.indices16Bits)),s.indices32Bits.length>0&&(t.texturePerPolygonIdIndices32Bits=this.dataTextureGenerator.generateTextureFor32BitIndices(i,s.indices32Bits)),s.edgeIndices8Bits.length>0&&(t.texturePerPolygonIdEdgeIndices8Bits=this.dataTextureGenerator.generateTextureFor8BitsEdgeIndices(i,s.edgeIndices8Bits)),s.edgeIndices16Bits.length>0&&(t.texturePerPolygonIdEdgeIndices16Bits=this.dataTextureGenerator.generateTextureFor16BitsEdgeIndices(i,s.edgeIndices16Bits)),s.edgeIndices32Bits.length>0&&(t.texturePerPolygonIdEdgeIndices32Bits=this.dataTextureGenerator.generateTextureFor32BitsEdgeIndices(i,s.edgeIndices32Bits)),this.model._modelMatricesTexture||(this.model._modelMatricesTexture=this.dataTextureGenerator.generatePeformanceModelDataTexture(i,this.model)),t.textureModelMatrices=this.model._modelMatricesTexture,this.model.cameraTexture||(this.model.cameraTexture=this.dataTextureGenerator.generateCameraDataTexture(this.model.scene.canvas.gl,this.model.scene.camera,this.model.scene,this._state.origin.slice())),t.textureCameraMatrices=this.model.cameraTexture,this.model.pickCameraTexture||(this.model.pickCameraTexture=this.dataTextureGenerator.generateCameraDataTexture(this.model.scene.canvas.gl,this.model.scene.camera,this.model.scene,this._state.origin.slice(),!1)),t.texturePickCameraMatrices=this.model.pickCameraTexture,t.finalize(),this._buffer=null,this._instancedGeometrySubPortionData={},this._finalized=!0}}},{key:"attachToRenderingEvent",value:function(){var e=this;this.model.scene.on("rendering",(function(){e._deferredSetFlagsDirty&&e.commitDeferredFlags(),e.numUpdatesInFrame=0}))}},{key:"isEmpty",value:function(){return 0==this._numPortions}},{key:"initFlags",value:function(e,t,i){t&kt&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&Bt&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&Ot&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&Lt&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&Rt&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&Nt&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&Ft&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&Et&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),i&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++);this._setFlags(e,t,i,true),this._setFlags2(e,t,true)}},{key:"flushInitFlags",value:function(){this._setDeferredFlags(),this._setDeferredFlags2()}},{key:"setVisible",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&kt?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,i)}},{key:"setHighlighted",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Bt?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,i)}},{key:"setXRayed",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Ot?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,i)}},{key:"setSelected",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Lt?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,i)}},{key:"setEdges",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Nt?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,i)}},{key:"setClippable",value:function(e,t){if(!this._finalized)throw"Not finalized";t&Rt?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}},{key:"beginDeferredFlags",value:function(){this._deferredSetFlagsActive=!0}},{key:"commitDeferredFlags",value:function(){if(this._deferredSetFlagsActive=!1,this._deferredSetFlagsDirty){this._deferredSetFlagsDirty=!1;var e=this.model.scene.canvas.gl,t=this._dataTextureState;e.bindTexture(e.TEXTURE_2D,t.texturePerObjectIdColorsAndFlags._texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.texturePerObjectIdColorsAndFlags._textureWidth,t.texturePerObjectIdColorsAndFlags._textureHeight,e.RGBA_INTEGER,e.UNSIGNED_BYTE,t.texturePerObjectIdColorsAndFlags._textureData),e.bindTexture(e.TEXTURE_2D,t.texturePerObjectIdOffsets._texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.texturePerObjectIdOffsets._textureWidth,t.texturePerObjectIdOffsets._textureHeight,e.RGB,e.FLOAT,t.texturePerObjectIdOffsets._textureData)}}},{key:"setCulled",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Et?(this._numCulledLayerPortions+=this._subPortionIdMapping[e].length,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions-=this._subPortionIdMapping[e].length,this.model.numCulledLayerPortions--),this._setFlags(e,t,i)}},{key:"setCollidable",value:function(e,t){if(!this._finalized)throw"Not finalized"}},{key:"setPickable",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Ft?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(e,t,i)}},{key:"setColor",value:function(e,t){for(var i=this._subPortionIdMapping[e],s=0,r=i.length;s<r;s++)this._subPortionSetColor(i[s],t)}},{key:"_subPortionSetColor",value:function(e,t){if(!this._finalized)throw"Not finalized";var i=this._dataTextureState,s=this.model.scene.canvas.gl;ws[0]=t[0],ws[1]=t[1],ws[2]=t[2],ws[3]=t[3],i.texturePerObjectIdColorsAndFlags._textureData.set(ws,32*e),this._deferredSetFlagsActive?this._deferredSetFlagsDirty=!0:(++this.numUpdatesInFrame>=10&&this.beginDeferredFlags(),s.bindTexture(s.TEXTURE_2D,i.texturePerObjectIdColorsAndFlags._texture),s.texSubImage2D(s.TEXTURE_2D,0,e%512*8,Math.floor(e/512),1,1,s.RGBA_INTEGER,s.UNSIGNED_BYTE,ws))}},{key:"setTransparent",value:function(e,t,i){i?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,i)}},{key:"_setFlags",value:function(e,t,i){for(var s=this._subPortionIdMapping[e],r=0,n=s.length;r<n;r++)this._subPortionSetFlags(s[r],t,i)}},{key:"_subPortionSetFlags",value:function(e,t,i){if(!this._finalized)throw"Not finalized";var s,r,n=!!(t&kt),o=!!(t&Ot),a=!!(t&Bt),u=!!(t&Lt),h=!!(t&Nt),l=!!(t&Ft),c=!!(t&Et);s=!n||c||o?Ut:i?zt:Vt,r=!n||c?Ut:u?Xt:a?Wt:o?Yt:Ut;var p=0;p=!n||c?Ut:u?Qt:a?Zt:o?qt:h?i?Jt:Kt:Ut;var d=n&&!c&&l?$t:Ut,f=this._dataTextureState,m=this.model.scene.canvas.gl;ws[0]=s,ws[1]=r,ws[2]=p,ws[3]=d,f.texturePerObjectIdColorsAndFlags._textureData.set(ws,32*e+8),this._deferredSetFlagsActive?this._deferredSetFlagsDirty=!0:(++this.numUpdatesInFrame>=10&&this.beginDeferredFlags(),m.bindTexture(m.TEXTURE_2D,f.texturePerObjectIdColorsAndFlags._texture),m.texSubImage2D(m.TEXTURE_2D,0,e%512*8+2,Math.floor(e/512),1,1,m.RGBA_INTEGER,m.UNSIGNED_BYTE,ws))}},{key:"_setDeferredFlags",value:function(){}},{key:"_setFlags2",value:function(e,t){for(var i=this._subPortionIdMapping[e],s=0,r=i.length;s<r;s++)this._subPortionSetFlags2(i[s],t)}},{key:"_subPortionSetFlags2",value:function(e,t){if(!this._finalized)throw"Not finalized";var i=t&Rt?255:0,s=this._dataTextureState,r=this.model.scene.canvas.gl;ws[0]=i,ws[1]=0,ws[2]=1,ws[3]=2,s.texturePerObjectIdColorsAndFlags._textureData.set(ws,32*e+12),this._deferredSetFlagsActive?this._deferredSetFlagsDirty=!0:(++this.numUpdatesInFrame>=10&&this.beginDeferredFlags(),r.bindTexture(r.TEXTURE_2D,s.texturePerObjectIdColorsAndFlags._texture),r.texSubImage2D(r.TEXTURE_2D,0,e%512*8+3,Math.floor(e/512),1,1,r.RGBA_INTEGER,r.UNSIGNED_BYTE,ws))}},{key:"_setDeferredFlags2",value:function(){}},{key:"setOffset",value:function(e,t){for(var i=this._subPortionIdMapping[e],s=0,r=i.length;s<r;s++)this._subPortionSetOffset(i[s],t)}},{key:"_subPortionSetOffset",value:function(e,t){if(!this._finalized)throw"Not finalized";var i=this._dataTextureState,s=this.model.scene.canvas.gl;Ms[0]=t[0],Ms[1]=t[1],Ms[2]=t[2],i.texturePerObjectIdOffsets._textureData.set(Ms,3*e),this._deferredSetFlagsActive?this._deferredSetFlagsDirty=!0:(++this.numUpdatesInFrame>=10&&this.beginDeferredFlags(),s.bindTexture(s.TEXTURE_2D,i.texturePerObjectIdOffsets._texture),s.texSubImage2D(s.TEXTURE_2D,0,0,e,1,1,s.RGB,s.FLOAT,Ms))}},{key:"drawColorOpaque",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),t.withSAO&&this.model.saoEnabled?t.pbrEnabled&&this.model.pbrEnabled?this._dataTextureRenderers.colorQualityRendererWithSAO&&this._dataTextureRenderers.colorQualityRendererWithSAO.drawLayer(t,this,Vt):this._dataTextureRenderers.colorRendererWithSAO&&this._dataTextureRenderers.colorRendererWithSAO.drawLayer(t,this,Vt):t.pbrEnabled&&this.model.pbrEnabled?this._dataTextureRenderers.colorQualityRenderer&&this._dataTextureRenderers.colorQualityRenderer.drawLayer(t,this,Vt):this._dataTextureRenderers.colorRenderer&&this._dataTextureRenderers.colorRenderer.drawLayer(t,this,Vt))}},{key:"_updateBackfaceCull",value:function(e,t){var i=this.model.backfaces||e.sectioned;if(t.backfaces!==i){var s=t.gl;i?s.disable(s.CULL_FACE):s.enable(s.CULL_FACE),t.backfaces=i}}},{key:"drawColorTransparent",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),t.pbrEnabled&&this.model.pbrEnabled?this._dataTextureRenderers.colorQualityRenderer&&this._dataTextureRenderers.colorQualityRenderer.drawLayer(t,this,zt):this._dataTextureRenderers.colorRenderer&&this._dataTextureRenderers.colorRenderer.drawLayer(t,this,zt))}},{key:"drawDepth",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.depthRenderer&&this._dataTextureRenderers.depthRenderer.drawLayer(t,this,Vt))}},{key:"drawNormals",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.normalsRenderer&&this._dataTextureRenderers.normalsRenderer.drawLayer(t,this,Vt))}},{key:"drawSilhouetteXRayed",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.silhouetteRenderer&&this._dataTextureRenderers.silhouetteRenderer.drawLayer(t,this,Yt))}},{key:"drawSilhouetteHighlighted",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.silhouetteRenderer&&this._dataTextureRenderers.silhouetteRenderer.drawLayer(t,this,Wt))}},{key:"drawSilhouetteSelected",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.silhouetteRenderer&&this._dataTextureRenderers.silhouetteRenderer.drawLayer(t,this,Xt))}},{key:"drawEdgesColorOpaque",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&this._dataTextureRenderers.edgesColorRenderer&&this._dataTextureRenderers.edgesColorRenderer.drawLayer(t,this,Kt)}},{key:"drawEdgesColorTransparent",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&0!==this._numTransparentLayerPortions&&this._dataTextureRenderers.edgesColorRenderer&&this._dataTextureRenderers.edgesColorRenderer.drawLayer(t,this,Jt)}},{key:"drawEdgesHighlighted",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._dataTextureRenderers.edgesRenderer&&this._dataTextureRenderers.edgesRenderer.drawLayer(t,this,Zt)}},{key:"drawEdgesSelected",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._dataTextureRenderers.edgesRenderer&&this._dataTextureRenderers.edgesRenderer.drawLayer(t,this,Qt)}},{key:"drawEdgesXRayed",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._dataTextureRenderers.edgesRenderer&&this._dataTextureRenderers.edgesRenderer.drawLayer(t,this,qt)}},{key:"drawOcclusion",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.occlusionRenderer&&this._dataTextureRenderers.occlusionRenderer.drawLayer(t,this,Vt))}},{key:"drawShadow",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.shadowRenderer&&this._dataTextureRenderers.shadowRenderer.drawLayer(t,this,Vt))}},{key:"drawPickMesh",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.pickMeshRenderer&&this._dataTextureRenderers.pickMeshRenderer.drawLayer(t,this,$t))}},{key:"drawPickDepths",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.pickDepthRenderer&&this._dataTextureRenderers.pickDepthRenderer.drawLayer(t,this,$t))}},{key:"drawPickNormals",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.pickNormalsRenderer&&this._dataTextureRenderers.pickNormalsRenderer.drawLayer(t,this,$t))}},{key:"precisionRayPickSurface",value:function(e,t,i,s,r){if(!this.model.scene.pickSurfacePrecisionEnabled)return!1;var n=this._state,o=this._portions[e];if(!o)return this.model.error("portion not found: "+e),!1;var a=o.quantizedPositions,u=o.indices,h=n.origin,l=o.offset,c=Is,p=Cs;c.set(h?q.subVec3(t,h,Ds):t),p.set(i),l&&q.subVec3(c,l),q.transformRay(this.model.worldNormalMatrix,c,p,c,p);for(var d=As,f=ks,m=Es,v=!1,g=0,_=Fs,y=0,b=u.length;y<b;y+=3){var x=3*u[y],P=3*u[y+1],T=3*u[y+2];if(d[0]=a[x],d[1]=a[x+1],d[2]=a[x+2],f[0]=a[P],f[1]=a[P+1],f[2]=a[P+2],m[0]=a[T],m[1]=a[T+1],m[2]=a[T+2],q.decompressPosition(d,n.positionsDecodeMatrix),q.decompressPosition(f,n.positionsDecodeMatrix),q.decompressPosition(m,n.positionsDecodeMatrix),q.rayTriangleIntersect(c,p,d,f,m,_)){q.transformPoint3(this.model.worldMatrix,_,_),l&&q.addVec3(_,l),h&&q.addVec3(_,h);var w=Math.abs(q.lenVec3(q.subVec3(_,t,[])));(!v||w>g)&&(g=w,s.set(_),r&&q.triangleNormal(d,f,m,r),v=!0)}}return v&&r&&(q.transformVec3(this.model.worldNormalMatrix,r,r),q.normalizeVec3(r)),v}},{key:"destroy",value:function(){var e=this._state;e.metallicRoughnessBuf&&(e.metallicRoughnessBuf.destroy(),e.metallicRoughnessBuf=null),e.destroy()}}]),e}();function Os(e,t,i){var s,r,n,o;if(t){var a=p(as({positions:e.positions,indices:e.indices,edgeIndices:e.edgeIndices}),3);s=a[0],r=a[1],n=a[2]}else s=e.positions,r=e.indices,n=e.edgeIndices;i?o=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=e.positions||[],r=ls(e.indices||[],t),n=ds(e.edgeIndices||[]);function o(e,t){if(e>t){var i=e;e=t,t=i}function s(i,s){return i!=e?e-i:s!=t?t-s:0}for(var r=0,o=(n.length>>1)-1;r<=o;){var a=o+r>>1,u=s(n[2*a],n[2*a+1]);if(u>0)r=a+1;else{if(!(u<0))return a;o=a-1}}return-r-1}var a=new Int32Array(n.length/2);a.fill(0);var u=s.length/3;if(u>8*(1<<t))return[e];var h=new Int32Array(u);h.fill(-1);var l=[];function c(){h.fill(-1);var e={positions:[],indices:[],edgeIndices:[],maxNumPositions:(1<<t)-t,numPositions:0,bucketNumber:l.length};return l.push(e),e}for(var p=c(),d=0,f=r.length;d<f;d+=3){var m=0,v=r[d],g=r[d+1],_=r[d+2];if(-1==h[v]&&m++,-1==h[g]&&m++,-1==h[_]&&m++,m+p.numPositions>p.maxNumPositions&&(p=c()),p.bucketNumber>8)return[e];-1==h[v]&&(h[v]=p.numPositions++,p.positions.push(s[3*v]),p.positions.push(s[3*v+1]),p.positions.push(s[3*v+2])),-1==h[g]&&(h[g]=p.numPositions++,p.positions.push(s[3*g]),p.positions.push(s[3*g+1]),p.positions.push(s[3*g+2])),-1==h[_]&&(h[_]=p.numPositions++,p.positions.push(s[3*_]),p.positions.push(s[3*_+1]),p.positions.push(s[3*_+2])),p.indices.push(h[v]),p.indices.push(h[g]),p.indices.push(h[_]);var y=void 0;(y=o(v,g))>=0&&0==a[y]&&(a[y]=1,p.edgeIndices.push(h[n[2*y]]),p.edgeIndices.push(h[n[2*y+1]])),(y=o(v,_))>=0&&0==a[y]&&(a[y]=1,p.edgeIndices.push(h[n[2*y]]),p.edgeIndices.push(h[n[2*y+1]])),(y=o(g,_))>=0&&0==a[y]&&(a[y]=1,p.edgeIndices.push(h[n[2*y]]),p.edgeIndices.push(h[n[2*y+1]]))}var b=t/8*2,x=t/8,P=2*s.length+(r.length+n.length)*b,T=0;return s.length,l.forEach((function(e){T+=2*e.positions.length+(e.indices.length+e.edgeIndices.length)*x,e.positions.length})),T>P?[e]:(i&&fs(l,e),l)}({positions:s,indices:r,edgeIndices:n},s.length/3>65536?16:8):o=[{positions:s,indices:r,edgeIndices:n}];return e.preparedBuckets=o,e}var Bs=function(){function e(){w(this,e),this.visibleLayers=[],this.sectionPlanesActivePerLayer=[],this.reset()}return I(e,[{key:"reset",value:function(){this.culled=!1,this.sectioned=!1,this.numLayers=0,this.numVisibleLayers=0,this.colorOpaque=!1,this.colorTransparent=!1,this.edgesOpaque=!1,this.edgesTransparent=!1,this.xrayedSilhouetteOpaque=!1,this.xrayedEdgesOpaque=!1,this.xrayedSilhouetteTransparent=!1,this.xrayedEdgesTransparent=!1,this.highlightedSilhouetteOpaque=!1,this.highlightedEdgesOpaque=!1,this.highlightedSilhouetteTransparent=!1,this.highlightedEdgesTransparent=!1,this.selectedSilhouetteOpaque=!1,this.selectedEdgesOpaque=!1,this.selectedSilhouetteTransparent=!1,this.selectedEdgesTransparent=!1}}]),e}(),Ls=!1,Ns=[];var js=function(){function e(t,i){w(this,e),this.triangleLODLevels=t,this.nodesInLOD={},this.triangleCountInLOD={},this.targetFps=i,this.lodLevelIndex=0,this.consecutiveFramesWithTargetFps=0,this.consecutiveFramesWithoutTargetFps=0}return I(e,[{key:"initializeLodState",value:function(e){if(0!==e._nodeList.length){for(var t=e._nodeList,i={},s={},r=0,n=t.length;r<n;r++){var o,a=t[r],u=void 0;for(u=0,o=this.triangleLODLevels.length;u<o&&!(a.numTriangles>=this.triangleLODLevels[u]);u++);var h=this.triangleLODLevels[u]||0;h in i||(i[h]=[]),i[h].push(a),h in s||(s[h]=0),s[h]+=a.numTriangles}this.nodesInLOD=i,this.triangleCountInLOD=s}}}]),e}(),Gs=function(){function e(t,i,s){w(this,e),this.model=t,this.lodState=new js(i,s),this.lodState.initializeLodState(t),function(e,t){if(!Ls){Ls=!0;var i=new Array(4),s=0,r=-1,n=Date.now(),o=0;e.on("rendering",(function(){if(-1!==r)for(var e=0,t=Ns.length;e<t;e++)Ns[e].applyLodCulling(r)})),e.on("rendered",(function(){n=Date.now(),window.requestAnimationFrame((function(){s++;var e=Date.now();o=e-n,n=e,i[s%4]=o;var t=0;if(s>4){for(var a=0;a<4;a++)t+=i[a];r=4/t*1e3}}))}));var a=0,u=a;e.camera.on("matrix",(function(){u=a})),e.on("tick",(function(){if(a-u>3)for(var e=0,t=Ns.length;e<t;e++)Ns[e].resetLodCulling();a++}))}Ns.push(t)}(this.model.scene,this)}return I(e,[{key:"_increaseLODLevelIndex",value:function(){var e=this.lodState;if(e.lodLevelIndex===e.triangleLODLevels.length)return!1;for(var t=e.nodesInLOD[e.triangleLODLevels[e.lodLevelIndex]]||[],i=0,s=t.length;i<s;i++)t[i].culledLOD=!0;return e.lodLevelIndex++,!0}},{key:"_decreaseLODLevelIndex",value:function(){var e=this.lodState;if(0===e.lodLevelIndex)return!1;for(var t=e.nodesInLOD[e.triangleLODLevels[e.lodLevelIndex-1]]||[],i=0,s=t.length;i<s;i++)t[i].culledLOD=!1;return e.lodLevelIndex--,!0}},{key:"applyLodCulling",value:function(e){var t=this.lodState;this.model;var i=!1;return e<t.targetFps?++t.consecutiveFramesWithoutTargetFps>0&&(t.consecutiveFramesWithoutTargetFps=0,i=this._increaseLODLevelIndex()):e>t.targetFps+4&&++t.consecutiveFramesWithTargetFps>1&&(t.consecutiveFramesWithTargetFps=0,i=this._decreaseLODLevelIndex()),i}},{key:"resetLodCulling",value:function(){this.model;var e=!1,t=!1;do{e|=t=this._decreaseLODLevelIndex()}while(t);return e}}]),e}(),Hs={},Us={};!function(e){if("object"===T(Us)&&void 0!==Hs)Hs.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).RBush3D=e()}}((function(){return function e(t,i,s){function r(o,a){if(!i[o]){if(!t[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(n)return n(o,!0);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}var l=i[o]={exports:{}};t[o][0].call(l.exports,(function(e){return r(t[o][1][e]||e)}),l,l.exports,e,t,i,s)}return i[o].exports}for(var n="function"==typeof require&&require,o=0;o<s.length;o++)r(s[o]);return r}({1:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var s=e("quickselect"),r=[],n=function(e){return r.push(e)},o=function e(t){t&&(n(t),l(t)||t.children.forEach(e))},a=function(e){var t=r.pop();return t?(t.children=e,t.height=1,t.leaf=!0,t.minX=1/0,t.minY=1/0,t.minZ=1/0,t.maxX=-1/0,t.maxY=-1/0,t.maxZ=-1/0):t={children:e,height:1,leaf:!0,minX:1/0,minY:1/0,minZ:1/0,maxX:-1/0,maxY:-1/0,maxZ:-1/0},t},u=[],h=function(e,t){var i=u.pop();return i?(i.dist=e,i.node=t):i={dist:e,node:t},i},l=function(e){return e.leaf},c=function(e,t){return e.leaf},p=function(e,t,i){if(!i)return t.indexOf(e);for(var s=0;s<t.length;s++)if(i(e,t[s]))return s;return-1},d=function(e){f(e,0,e.children.length,e)},f=function(e,t,i,s){var r=s;r?(r.minX=1/0,r.minY=1/0,r.minZ=1/0,r.maxX=-1/0,r.maxY=-1/0,r.maxZ=-1/0):r=a([]);for(var n=t,o=void 0;n<i;n++)o=e.children[n],m(r,o);return r},m=function(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.minZ=Math.min(e.minZ,t.minZ),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e.maxZ=Math.max(e.maxZ,t.maxZ),e},v=function(e){return(e.maxX-e.minX)*(e.maxY-e.minY)*(e.maxZ-e.minZ)},g=function(e){return e.maxX-e.minX+(e.maxY-e.minY)+(e.maxZ-e.minZ)},_=function(e,t){var i=Math.min(e.minX,t.minX),s=Math.min(e.minY,t.minY),r=Math.min(e.minZ,t.minZ);return(Math.max(e.maxX,t.maxX)-i)*(Math.max(e.maxY,t.maxY)-s)*(Math.max(e.maxZ,t.maxZ)-r)},y=function(e,t){var i=Math.max(e.minX,t.minX),s=Math.max(e.minY,t.minY),r=Math.max(e.minZ,t.minZ),n=Math.min(e.maxX,t.maxX),o=Math.min(e.maxY,t.maxY),a=Math.min(e.maxZ,t.maxZ);return Math.max(0,n-i)*Math.max(0,o-s)*Math.max(0,a-r)},b=function(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&e.minZ<=t.minZ&&t.maxX<=e.maxX&&t.maxY<=e.maxY&&t.maxZ<=e.maxZ};i.intersects=function(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.minZ<=e.maxZ&&t.maxX>=e.minX&&t.maxY>=e.minY&&t.maxZ>=e.minZ},i.boxRayIntersects=function(e,t,i,s,r,n,o){var a=(e.minX-t)*r,u=(e.maxX-t)*r,h=(e.minY-i)*n,l=(e.maxY-i)*n,c=(e.minZ-s)*o,p=(e.maxZ-s)*o,d=Math.min(c,p),f=Math.max(c,p),m=Math.min(h,l),v=Math.max(h,l),g=Math.min(a,u),_=Math.max(a,u),y=Math.max(0,g,m,d);return Math.min(_,v,f)>=y?y:1/0};var x=function(e,t,i,r,n){for(var o,a=[t,i];a.length;)(i=a.pop())-(t=a.pop())<=r||(o=t+Math.ceil((i-t)/r/2)*r,s(e,o,t,i,n),a.push(t,o,o,i))},P=function(e,t){return e.minX-t.minX},T=function(e,t){return e.minY-t.minY},w=function(e,t){return e.minZ-t.minZ},M=function(){function e(e){void 0===e&&(e=16),this.maxEntries=Math.max(e,8),this.minEntries=Math.max(4,Math.ceil(.4*this.maxEntries)),this.clear()}return e.alloc=function(){return this.pool.pop()||new this},e.free=function(e){e.clear(),this.pool.push(e)},e.prototype.searchCustom=function(e,t){var i=this.data,s=[];if(!e(i,c(i)))return s;for(var r=[];i;){for(var n=0,o=i.children.length;n<o;n++){var a=i.children[n];e(a,c(i))&&(c(i)?s.push(a):t(a)?this._all(a,s):r.push(a))}i=r.pop()}return s},e.prototype.analyzeTriangles=function(e){void 0===e&&(e=this.data);var t=0;if(l(e))for(var i=0,s=e.children.length;i<s;i++)t+=e.children[i].numTriangles;else for(i=0,s=e.children.length;i<s;i++)t+=this.analyzeTriangles(e.children[i]);return e.totalTriangles=t},e.prototype.groupNodesByNumTrianglesThreshold=function(e,t){void 0===t&&(this.analyzeTriangles(),t=this.data);for(var i=[],s=0,r=t.children.length;s<r;s++){var n=t.children[s];i.push({item:n,triangles:n.totalTriangles||n.numTriangles})}i.sort((function(e,t){return-(e.item.triangles-t.item.triangles)}));var o=[],a=[],u=0;for(s=0,r=i.length;s<r;s++){var h=i[s];if(u+h.triangles<e)a.push(h),u+=h.triangles;else if(a.length&&(o.push(a),a=[],u=0),u+h.triangles<e)s--;else if(c(t,h.item))o.push([h]);else{for(var l=this.groupNodesByNumTrianglesThreshold(e,h.item),p=[],d=0,f=0,m=l.length;f<m-1;f++)o.push(l[s]);if(l.length>1){for(f=0,m=(l=l[l.length-1]).length;f<m;f++)(d+=l[f].triangles)<e?p.push(l[f]):(0==d&&p.push(l[f]),o.push(p),d=0,p=[]);p.forEach((function(e){a.push(e),u+=e.triangles}))}}}return a.length&&o.push(a),o},e.prototype.search=function(e){var t=this.data,s=[];if(!i.intersects(e,t))return s;for(var r=[];t;){for(var n=0,o=t.children.length;n<o;n++){var a=t.children[n];i.intersects(e,a)&&(c(t)?s.push(a):b(e,a)?this._all(a,s):r.push(a))}t=r.pop()}return s},e.prototype.collides=function(e){var t=this.data;if(!i.intersects(e,t))return!1;for(var s=[];t;){for(var r=0,n=t.children.length;r<n;r++){var o=t.children[r];if(i.intersects(e,o)){if(c(t)||b(e,o))return!0;s.push(o)}}t=s.pop()}return!1},e.prototype.raycastInv=function(e,t,s,r,n,o,a){void 0===a&&(a=1/0);var l=this.data;if(r===1/0&&n===1/0&&o===1/0)return h(1/0,void 0);if(i.boxRayIntersects(l,e,t,s,r,n,o)===1/0)return h(1/0,void 0);for(var p,d=[h(0,l)],f=function(e,t){var i=d[e];d[e]=d[t],d[t]=i},m=function(){var e=d[0],t=d.length-1;d[0]=d[t],d.length=t;for(var i=0;;){var s=i<<1|1;if(s>=t)break;var r=s+1;if(r<t&&d[r].dist<d[s].dist&&(s=r),d[i].dist<d[s].dist)break;f(i,s),i=s}return function(e){u.push(e)}(e),e.node},v=function(e,t){var i=d.length;for(d.push(h(e,t));i>0;){var s=i-1>>1;if(d[s].dist<=d[i].dist)break;f(i,s),i=s}},g=a;d.length&&d[0].dist<g;)for(var _=0,y=(l=m()).children.length;_<y;_++){var b=l.children[_],x=i.boxRayIntersects(b,e,t,s,r,n,o);if(c(l)){if(x<g){if(0===x)return h(x,b);g=x,p=b}}else v(x,b)}return h(g<a?g:1/0,p)},e.prototype.raycast=function(e,t,i,s,r,n,o){return void 0===o&&(o=1/0),this.raycastInv(e,t,i,1/s,1/r,1/n,o)},e.prototype.all=function(){return this._all(this.data,[])},e.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this.minEntries){for(var t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}var s=this.build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===s.height)this.splitRoot(this.data,s);else{if(this.data.height<s.height){var r=this.data;this.data=s,s=r}this._insert(s,this.data.height-s.height-1,!0)}else this.data=s;return this},e.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},e.prototype.clear=function(){return this.data&&o(this.data),this.data=a([]),this},e.prototype.remove=function(e,t){if(!e)return this;for(var i,s,r=this.data,n=0,o=!1,a=[],u=[];r||a.length;){if(r||(r=a.pop(),n=u.pop(),s=a[a.length-1],o=!0),l(r)&&-1!==(i=p(e,r.children,t)))return r.children.splice(i,1),a.push(r),this.condense(a),this;o||l(r)||!b(r,e)?s?(n++,r=s.children[n],o=!1):r=void 0:(a.push(r),u.push(n),n=0,s=r,r=r.children[0])}return this},e.prototype.toJSON=function(){return this.data},e.prototype.fromJSON=function(e){return o(this.data),this.data=e,this},e.prototype.build=function(e,t,i,s){var r,n=i-t+1,o=this.maxEntries;if(n<=o)return r=a(e.slice(t,i+1)),d(r),r;s||(s=Math.ceil(Math.log(n)/Math.log(o)),o=Math.ceil(n/Math.pow(o,s-1))),(r=a([])).leaf=!1,r.height=s;var u=Math.ceil(n/o),h=u*Math.ceil(Math.pow(o,2/3)),l=u*Math.ceil(Math.pow(o,1/3));x(e,t,i,l,P);for(var c=t;c<=i;c+=l){var p=Math.min(c+l-1,i);x(e,c,p,h,T);for(var f=c;f<=p;f+=h){var m=Math.min(f+h-1,p);x(e,f,m,u,w);for(var v=f;v<=m;v+=u){var g=Math.min(v+u-1,m);r.children.push(this.build(e,v,g,s-1))}}}return d(r),r},e.prototype._all=function(e,t){for(var i=[];e;)l(e)?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},e.prototype.chooseSubtree=function(e,t,i,s){for(var r,n,o;s.push(t),!l(t)&&s.length-1!==i;){r=n=1/0;for(var a=0,u=t.children.length;a<u;a++){var h=t.children[a],c=v(h),p=_(e,h)-c;p<n?(n=p,r=c<r?c:r,o=h):p===n&&c<r&&(r=c,o=h)}t=o||t.children[0]}return t},e.prototype.split=function(e,t){var i=e[t],s=i.children.length,r=this.minEntries;this.chooseSplitAxis(i,r,s);var n=this.chooseSplitIndex(i,r,s),o=a(i.children.splice(n,i.children.length-n));o.height=i.height,o.leaf=i.leaf,d(i),d(o),t?e[t-1].children.push(o):this.splitRoot(i,o)},e.prototype.splitRoot=function(e,t){this.data=a([e,t]),this.data.height=e.height+1,this.data.leaf=!1,d(this.data)},e.prototype.chooseSplitIndex=function(e,t,i){for(var s,r=1/0,n=1/0,o=t;o<=i-t;o++){var a=f(e,0,o),u=f(e,o,i),h=y(a,u),l=v(a)+v(u);h<r?(r=h,s=o,n=l<n?l:n):h===r&&l<n&&(n=l,s=o)}return s},e.prototype.chooseSplitAxis=function(e,t,i){var s=this.allDistMargin(e,t,i,P),r=this.allDistMargin(e,t,i,T),n=this.allDistMargin(e,t,i,w);s<r&&s<n?e.children.sort(P):r<s&&r<n&&e.children.sort(T)},e.prototype.allDistMargin=function(e,t,i,s){e.children.sort(s);for(var r=f(e,0,t),n=f(e,i-t,i),o=g(r)+g(n),a=t;a<i-t;a++){var u=e.children[a];m(r,u),o+=g(r)}for(a=i-t-1;a>=t;a--){u=e.children[a];m(n,u),o+=g(n)}return o},e.prototype.adjustParentBBoxes=function(e,t,i){for(var s=i;s>=0;s--)m(t[s],e)},e.prototype.condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e[t].children.length?t>0?((i=e[t-1].children).splice(i.indexOf(e[t]),1),n(e[t])):this.clear():d(e[t])},e.prototype._insert=function(e,t,i){var s=[],r=this.chooseSubtree(e,this.data,t,s);for(r.children.push(e),m(r,e);t>=0&&s[t].children.length>this.maxEntries;)this.split(s,t),t--;this.adjustParentBBoxes(e,s,t)},e.pool=[],e}();i.RBush3D=M},{quickselect:2}],2:[function(e,t,i){!function(e,s){"object"===T(i)&&void 0!==t?t.exports=s():e.quickselect=s()}(this,(function(){function e(i,s,r,n,o){for(;n>r;){if(n-r>600){var a=n-r+1,u=s-r+1,h=Math.log(a),l=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*l*(a-l)/a)*(u-a/2<0?-1:1);e(i,s,Math.max(r,Math.floor(s-u*l/a+c)),Math.min(n,Math.floor(s+(a-u)*l/a+c)),o)}var p=i[s],d=r,f=n;for(t(i,r,s),o(i[n],p)>0&&t(i,r,n);d<f;){for(t(i,d,f),d++,f--;o(i[d],p)<0;)d++;for(;o(i[f],p)>0;)f--}0===o(i[r],p)?t(i,r,f):t(i,++f,n),f<=s&&(r=f+1),s<=f&&(n=f-1)}}function t(e,t,i){var s=e[t];e[t]=e[i],e[i]=s}function i(e,t){return e<t?-1:e>t?1:0}return function(t,s,r,n,o){e(t,s,r||0,n||t.length-1,o||i)}}))},{}]},{},[1])(1)}));var Vs=Hs.exports.RBush3D,zs=function(e){function t(e){var t=0;return e.meshes.forEach((function(e){t+=e.numTriangles})),t}function i(e,t){var i={pos:{x:0,y:0},left:0,right:e,top:0,bottom:t,dir:0};function s(){(0==i.dir&&i.pos.x+1>=i.right||1==i.dir&&i.pos.y+1>=i.bottom||2==i.dir&&i.pos.x-1<=i.left-1||3==i.dir&&i.pos.y-1<=i.top-1)&&(i.dir=(i.dir+1)%4,0==i.dir&&i.left++,1==i.dir&&i.top++,2==i.dir&&i.right--,3==i.dir&&i.bottom--),0==i.dir&&i.pos.x++,1==i.dir&&i.pos.y++,2==i.dir&&i.pos.x--,3==i.dir&&i.pos.y--}for(var r=[],n=e*t;r.length<n;s())r.push(i.pos.x+"_"+i.pos.y);return r}var s,r,n,o,a=0,u=(r=function(t,i){for(var s=i||function(e){return!0},r=(e.aabbTree.data.maxX-e.aabbTree.data.minX)/10,n=(e.aabbTree.data.maxZ-e.aabbTree.data.minZ)/10,o=[],a=e.aabbTree.data.minX,u=0;u<10;u++,a+=r)for(var h=e.aabbTree.data.minZ,l=0;l<10;l++,h+=n)o.push({minX:a,maxX:a+r,minY:-1e8,maxY:1e8,minZ:h,maxZ:h+n,indexX:u,indexZ:l});var c={cellsByEntity:{},entitiesByCell:{},cellsX:10,cellsZ:10};return(o||[]).forEach((function(t){e.aabbTree.search(t).filter((function(e){return s(e.entity)})).forEach((function(e){var i=e.entity.id;c.cellsByEntity[i]=c.cellsByEntity[i]||{cells:[],entity:e.entity},c.cellsByEntity[i].cells.push(t);var s=t.indexX+"_"+t.indexZ;c.entitiesByCell[s]=c.entitiesByCell[s]||{entities:[],cell:t},c.entitiesByCell[s].entities.push(e.entity)}))})),c}((s={cellSideInMeters:.05,entityFilterFunc:function(e){return!0},maxPolygonsPerCluster:9e4,minPercentOfClustredPolygons:.9}).cellSideInMeters,s.entityFilterFunc),n=function(e,i){var s={},r=0;Object.keys(i).forEach((function(e){var n=i[e].cells.length,o=t(i[e].entity);s[n]=(s[n]||0)+o,r+=o}));var n=Object.keys(s);n.sort((function(e,t){return e-t}));for(var o=0,a=0,u=0;u<n.length&&a<e;u++)o=n[u],a+=s[o]/r;return{maxCellsPerEntity:o,polygonStats:{percentClustered:a,numberClustered:Math.round(a*r),numberUnclustered:r-Math.round(a*r)}}}(s.minPercentOfClustredPolygons,r.cellsByEntity),o=function(e,s,r,n,o,a){var u={},h={accumEntities:[]},l=[];i(e,s).forEach((function(e){var i=function(e,t,i,s){return(i[e]||{entities:[]}).entities.filter((function(e){return s[e.id].cells.length<=t}))}(e,r,n,o).filter((function(e){return!(e.id in u)}));i.forEach((function(e){u[e.id]=!0})),i.sort((function(e,i){return t(e)-t(i)}));var s=h.accumEntities.concat(i),c=[],p=a,d=0;do{for(;d<s.length;d++){var f=s[d],m=t(f);m>p&&(l.push(c),c=[],p=a),c.push(f),p-=m}}while(d<s.length);h.accumEntities=c})),h.accumEntities.length&&l.push(h.accumEntities);var c=[];Object.keys(o).forEach((function(e){e in u||c.push(o[e].entity)}));var p=a,d=[];c.forEach((function(e){var i=t(e);i>p&&(l.push(d),d=[],p=a),d.push(e),p-=i})),d.length&&l.push(d);var f={};return l.forEach((function(e,t){e.forEach((function(e){f[e.id]=t}))})),{clusters:l,entityIdToClusterIdMapping:f}}(r.cellsX,r.cellsZ,n.maxCellsPerEntity,r.entitiesByCell,r.cellsByEntity,s.maxPolygonsPerCluster),{clusters:{total:o.clusters.length},clusteringResult:o});a+=u.clusters.total,console.log("Total clusters: "+a);var h=[];return u.clusteringResult.clusters.forEach((function(e){e.forEach((function(e){h.push(e.id)}))})),u.orderedEntityIds=h,u};
/**
 * @author https://github.com/tmarti, with support from https://tribia.com/
 * @license MIT
 */function Ws(e,t){t.length;var i=e.length,s=[],r=[];for(var n=function(i){var n=e[i];if(function(e){for(var i=0,s=e.meshIds.length;i<s;i++)if(t[e.meshIds[i]].geometryId)return!0;return!1}(n))return r.push(i),"continue";var o=q.collapseAABB3(),a=0;n.meshIds.forEach((function(e){var i=t[e],s=ui.getPositionsBounds(i.positions),r=ui.decompressPosition(s.min,i.positionsDecodeMatrix,[]),n=ui.decompressPosition(s.max,i.positionsDecodeMatrix,[]);r[0]+=i.origin[0],r[1]+=i.origin[1],r[2]+=i.origin[2],n[0]+=i.origin[0],n[1]+=i.origin[1],n[2]+=i.origin[2],q.expandAABB3Point3(o,r),q.expandAABB3Point3(o,n),a+=Math.round(i.indices.length/3)})),s[i]={aabb:o,numTriangles:a,entityId:n.id}},o=0;o<i;o++)n(o);var a,u=[],h={};if(Object.keys(s).length>0){a=
/**
 * @author https://github.com/tmarti, with support from https://tribia.com/
 * @license MIT
 */
function(e){for(var t=[],i=0,s=e.length;i<s;i++){var r=e[i];r&&t.push({minX:r.aabb[0],minY:r.aabb[1],minZ:r.aabb[2],maxX:r.aabb[3],maxY:r.aabb[4],maxZ:r.aabb[5],entity:{id:i,xeokitId:r.entityId,meshes:[{numTriangles:r.numTriangles}]},numTriangles:r.numTriangles})}var n=new Vs(4);return n.load(t),n}(s);var l=zs({aabbTree:a});u=l.orderedEntityIds,h=l.clusteringResult.entityIdToClusterIdMapping}return{orderedClusteredIndexes:u,entityIdToClusterIdMapping:h,instancedIndexes:r,rTreeBasedAabbTree:a}}for(var Xs=q.vec3(),Ys=180/Math.PI,Ks=new Float32Array(262144),Js=-256;Js<256;Js++)for(var Zs=-256;Zs<256;Zs++){var Qs=(Js+256<<9)+(Zs+256),qs=Math.max(Math.abs(Js),Math.abs(Zs));Ks[Qs]=Math.atan2(Js/qs,Zs/qs)}function $s(e,t){var i=256/Math.max(Math.abs(e),Math.abs(t)),s=Math.round(e*i)+255,r=Math.round(t*i)+255;return Ks[(s<<9)+r]}var er=function(){function e(){w(this,e),this._aabbTree=null,this._orderedMeshList=[],this._orderedEntityList=[],this._frustumProps={dirty:!0,wMultiply:1,hMultiply:1},this._cullFrame=0,this.finalized=!1}return I(e,[{key:"initializeVfcState",value:function(e,t){if(this.finalized)throw"Already finalized";var i=Ws(e,t);this._aabbTree=i.rTreeBasedAabbTree;for(var s=0,r=i.orderedClusteredIndexes.length;s<r;s++){for(var n=i.orderedClusteredIndexes[s],o=i.entityIdToClusterIdMapping[n],a=e[n],u=[],h=0,l=a.meshIds.length;h<l;h++){var c=a.meshIds[h];t[c].id=this._orderedMeshList.length,u.push(this._orderedMeshList.length),this._orderedMeshList.push({clusterNumber:o,mesh:t[c]})}a.meshIds=u,this._orderedEntityList.push(a)}for(var p=0,d=i.instancedIndexes.length;p<d;p++){for(var f=e[i.instancedIndexes[p]],m=[],v=0,g=f.meshIds.length;v<g;v++){var _=f.meshIds[v];t[_].id=this._orderedMeshList.length,m.push(this._orderedMeshList.length),this._orderedMeshList.push({clusterNumber:99999,mesh:t[_]})}f.meshIds=m,this._orderedEntityList.push(f)}}},{key:"finalize",value:function(e,t){if(this.finalized)throw"Already finalized";for(var i=-1,s=0,r=this._orderedMeshList.length;s<r;s++){var n=this._orderedMeshList[s],o=n.clusterNumber,a=n.mesh;-1!=i&&i!=o&&t.call(e),e.createMesh(a),i=o}for(var u=0,h=this._orderedEntityList.length;u<h;u++)e.createEntity(this._orderedEntityList[u]);this._orderedMeshList=[],this._orderedEntityList=[],this.finalized=!0}},{key:"applyViewFrustumCulling",value:function(e){if(!this.finalized)throw"Not finalized";if(this._aabbTree){this._canvasElement||(this._canvasElement=e.scene.canvas.canvas),this._camera||(this._camera=e.scene.camera),this._ensureFrustumPropsUpdated(e),this._initializeCullingDataIfNeeded(e);var t=this._searchVisibleNodesWithFrustumCulling();this._cullFrame++,this._markVisibleFrameOfVisibleNodes(t,this._cullFrame),this._cullNonVisibleNodes(e,this._cullFrame)}}},{key:"_initializeCullingDataIfNeeded",value:function(e){if(!this._internalNodesList&&this._aabbTree){var t=this._aabbTree.all(),i=0;t.forEach((function(e){i=Math.max(i,e.entity.id)}));var s=new Array(i+1);t.forEach((function(t){s[t.entity.id]=e._nodes[t.entity.xeokitId]})),this._internalNodesList=s,this._lastVisibleFrameOfNodes=new Array(s.length),this._lastVisibleFrameOfNodes.fill(0)}}},{key:"_searchVisibleNodesWithFrustumCulling",value:function(){var e=this;return this._aabbTree.searchCustom((function(t,i){return e._aabbIntersectsCameraFrustum(t,i)}),(function(t){return e._aabbContainedInCameraFrustum(t)}))}},{key:"_markVisibleFrameOfVisibleNodes",value:function(e,t){for(var i=this._lastVisibleFrameOfNodes,s=0,r=e.length;s<r;s++)i[e[s].entity.id]=t}},{key:"_cullNonVisibleNodes",value:function(e,t){for(var i=this._internalNodesList,s=this._lastVisibleFrameOfNodes,r=0,n=i.length;r<n;r++)i[r]&&(i[r].culledVFC=s[r]!==t)}},{key:"_getPointsForBBox",value:function(e){for(var t=[],i=0;i<8;i++)t.push([1&i?e.maxX:e.minX,2&i?e.maxY:e.minY,4&i?e.maxZ:e.minZ]);return t}},{key:"_aabbIntersectsCameraFrustum",value:function(e,t){if(t)return!0;if("ortho"==this._camera.projection)return this._frustumProps.dirty=!1,!0;var i=this._aabbIntersectsCameraFrustum_internal(e);return!!((4096&i||!(1&i||2&i)||1&i)&&(8192&i||!(16&i||32&i)||16&i)&&(16384&i||!(256&i||512&i)||256&i))}},{key:"_aabbContainedInCameraFrustum",value:function(e){if("ortho"==this._camera.projection)return this._frustumProps.dirty=!1,!0;var t=e._check;return 1&t&&16&t&&256&t}},{key:"_ensureFrustumPropsUpdated",value:function(e){var t=Math.min(this._canvasElement.width,this._canvasElement.height);this._frustumProps.wMultiply=this._canvasElement.width/t,this._frustumProps.hMultiply=this._canvasElement.height/t;var i=this._canvasElement.width/this._canvasElement.height,s=this._camera.perspective.fov;i<1&&(s/=i),s=Math.min(s,120),this._frustumProps.fov=s;var r=q.inverseMat4(e.worldMatrix,q.mat4()),n=q.transformVec3(this._camera.eye,r,[0,0,0]),o=q.transformVec3(this._camera.look,r,[0,0,0]);this._frustumProps.forward=q.normalizeVec3(q.subVec3(o,n,[0,0,0]),[0,0,0]),this._frustumProps.up=q.normalizeVec3(this._camera.up,[0,0,0]),this._frustumProps.right=q.normalizeVec3(q.cross3Vec3(this._frustumProps.forward,this._frustumProps.up,[0,0,0]),[0,0,0]),this._frustumProps.eye=n.slice(),this._frustumProps.CAM_FACTOR_1=this._frustumProps.fov/2*this._frustumProps.wMultiply/Ys,this._frustumProps.CAM_FACTOR_2=this._frustumProps.fov/2*this._frustumProps.hMultiply/Ys}},{key:"_aabbIntersectsCameraFrustum_internal",value:function(e){var t=e._points||this._getPointsForBBox(e);e._points=t;var i=819;window._debug&&(window._debug=!1);for(var s=0,r=t.length;s<r;s++){var n=t[s],o=Xs;o[0]=n[0]-this._frustumProps.eye[0],o[1]=n[1]-this._frustumProps.eye[1],o[2]=n[2]-this._frustumProps.eye[2];var a=q.dotVec3(o,this._frustumProps.forward);a<0?(i|=4,i&=-2):(i|=8,i&=-3);var u=$s(q.dotVec3(o,this._frustumProps.right),a);Math.abs(u)>this._frustumProps.CAM_FACTOR_1?(i|=u<0?64:128,i&=-17):i&=-33;var h=$s(q.dotVec3(o,this._frustumProps.up),a);Math.abs(h)>this._frustumProps.CAM_FACTOR_2?(i|=h<0?1024:2048,i&=-257):i&=-513}return 4&i&&8&i&&(i|=4096),64&i&&128&i&&(i|=8192),1024&i&&2048&i&&(i|=16384),e._check=i,i}}]),e}(),tr=function(){function e(t){w(this,e),this.model=t,this.entities=[],this.meshes=[],this.finalized=!1}return I(e,[{key:"addEntity",value:function(e){if(this.finalized)throw"Already finalized";this.entities.push(e)}},{key:"addMesh",value:function(e){if(this.finalized)throw"Already finalized";this.meshes.push(e)}},{key:"finalize",value:function(e){var t=this;if(this.finalized)throw"Already finalized";this.finalized=!0,this.vfcState=new er,console.time("initializeVfcState"),this.vfcState.initializeVfcState(this.entities,this.meshes),console.timeEnd("initializeVfcState"),console.time("finalizeVfcState"),this.vfcState.finalize(this.model,e),console.timeEnd("finalizeVfcState");var i=this;this.model.scene.on("rendering",(function(){return t.applyViewFrustumCulling.call(i)}))}},{key:"applyViewFrustumCulling",value:function(){if(!this.finalized)throw"Not finalized";this.vfcState.applyViewFrustumCulling(this.model)}}]),e}();Ze.SUPPORTED_EXTENSIONS.ANGLE_instanced_arrays;var ir=q.vec3(),sr=q.mat4(),rr=q.vec3([1,1,1]),nr=q.vec3([0,0,0]),or=q.vec3([0,0,0]),ar=q.identityQuaternion(),ur=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(w(this,i),!((s=t.call(this,e,r)).scene.canvas.gl instanceof WebGL2RenderingContext))throw"Using a DataTextureSceneModel requires the usage of webgl2";return s._enableVertexWelding=!r.disableVertexWelding,s._enableIndexRebucketing=!r.disableIndexRebucketing,s._targetLodFps=r.targetLodFps,r.enableViewFrustumCulling&&(s._vfcManager=new tr(x(s))),s._aabb=q.collapseAABB3(),s._aabbDirty=!1,s._layerList=[],s._nodeList=[],s._currentDataTextureLayer=null,s._instancingGeometries={},s._preparedInstancingGeometries={},s._meshes={},s._nodes={},s.renderFlags=new Bs,s.numGeometries=0,s.numPortions=0,s.numVisibleLayerPortions=0,s.numTransparentLayerPortions=0,s.numXRayedLayerPortions=0,s.numHighlightedLayerPortions=0,s.numSelectedLayerPortions=0,s.numEdgesLayerPortions=0,s.numPickableLayerPortions=0,s.numClippableLayerPortions=0,s.numCulledLayerPortions=0,s.numEntities=0,s._numTriangles=0,s._edgeThreshold=r.edgeThreshold||10,s.visible=r.visible,s.culled=r.culled,s.pickable=r.pickable,s.clippable=r.clippable,s.collidable=r.collidable,s.castsShadow=r.castsShadow,s.receivesShadow=r.receivesShadow,s.xrayed=r.xrayed,s.highlighted=r.highlighted,s.selected=r.selected,s.edges=r.edges,s.colorize=r.colorize,s.opacity=r.opacity,s.backfaces=r.backfaces,s._origin=q.vec3(r.origin||[0,0,0]),s._position=q.vec3(r.position||[0,0,0]),s._rotation=q.vec3(r.rotation||[0,0,0]),s._quaternion=q.vec4(r.quaternion||[0,0,0,1]),r.rotation&&q.eulerToQuaternion(s._rotation,"XYZ",s._quaternion),s._scale=q.vec3(r.scale||[1,1,1]),s._worldMatrix=q.mat4(),q.composeMat4(s._position,s._quaternion,s._scale,s._worldMatrix),s._worldNormalMatrix=q.mat4(),q.inverseMat4(s._worldMatrix,s._worldNormalMatrix),q.transposeMat4(s._worldNormalMatrix),(r.matrix||r.position||r.rotation||r.scale||r.quaternion)&&(s._viewMatrix=q.mat4(),s._viewNormalMatrix=q.mat4(),s._viewMatrixDirty=!0,s._worldMatrixNonIdentity=!0),s._opacity=1,s._colorize=[1,1,1],s._saoEnabled=!1!==r.saoEnabled,s._pbrEnabled=!1,s._isModel=r.isModel,s._isModel&&s.scene._registerModel(x(s)),s._onCameraViewMatrix=s.scene.camera.on("matrix",(function(){s._viewMatrixDirty=!0})),s}return I(i,[{key:"isPerformanceModel",get:function(){return!0}},{key:"objects",get:function(){return this._nodes}},{key:"origin",get:function(){return this._origin}},{key:"position",get:function(){return this._position}},{key:"rotation",get:function(){return this._rotation}},{key:"quaternion",get:function(){return this._quaternion}},{key:"scale",get:function(){return this._scale}},{key:"matrix",get:function(){return this._worldMatrix}},{key:"worldMatrix",get:function(){return this._worldMatrix}},{key:"worldNormalMatrix",get:function(){return this._worldNormalMatrix}},{key:"viewMatrix",get:function(){return this._viewMatrix?(this._viewMatrixDirty&&(q.mulMat4(this.scene.camera.viewMatrix,this._worldMatrix,this._viewMatrix),q.inverseMat4(this._viewMatrix,this._viewNormalMatrix),q.transposeMat4(this._viewNormalMatrix),this._viewMatrixDirty=!1),this._viewMatrix):this.scene.camera.viewMatrix}},{key:"viewNormalMatrix",get:function(){return this._viewNormalMatrix?(this._viewMatrixDirty&&(q.mulMat4(this.scene.camera.viewMatrix,this._worldMatrix,this._viewMatrix),q.inverseMat4(this._viewMatrix,this._viewNormalMatrix),q.transposeMat4(this._viewNormalMatrix),this._viewMatrixDirty=!1),this._viewNormalMatrix):this.scene.camera.viewNormalMatrix}},{key:"backfaces",get:function(){return this._backfaces},set:function(e){e=!!e,this._backfaces=e,this.glRedraw()}},{key:"entityList",get:function(){return this._nodeList}},{key:"isEntity",get:function(){return!0}},{key:"isModel",get:function(){return this._isModel}},{key:"isObject",get:function(){return!1}},{key:"aabb",get:function(){return this._aabbDirty&&this._rebuildAABB(),this._aabb}},{key:"numTriangles",get:function(){return this._numTriangles}},{key:"numLines",get:function(){return 0}},{key:"numPoints",get:function(){return 0}},{key:"visible",get:function(){return this.numVisibleLayerPortions>0},set:function(e){e=!1!==e,this._visible=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].visible=e;this.glRedraw()}},{key:"xrayed",get:function(){return this.numXRayedLayerPortions>0},set:function(e){e=!!e,this._xrayed=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].xrayed=e;this.glRedraw()}},{key:"highlighted",get:function(){return this.numHighlightedLayerPortions>0},set:function(e){e=!!e,this._highlighted=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].highlighted=e;this.glRedraw()}},{key:"selected",get:function(){return this.numSelectedLayerPortions>0},set:function(e){e=!!e,this._selected=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].selected=e;this.glRedraw()}},{key:"edges",get:function(){return this.numEdgesLayerPortions>0},set:function(e){e=!!e,this._edges=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].edges=e;this.glRedraw()}},{key:"culled",get:function(){return this._culled},set:function(e){e=!!e,this._culled=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].culled=e;this.glRedraw()}},{key:"clippable",get:function(){return this._clippable},set:function(e){e=!1!==e,this._clippable=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].clippable=e;this.glRedraw()}},{key:"collidable",get:function(){return this._collidable},set:function(e){e=!1!==e,this._collidable=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].collidable=e}},{key:"pickable",get:function(){return this.numPickableLayerPortions>0},set:function(e){e=!1!==e,this._pickable=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].pickable=e}},{key:"colorize",get:function(){return this._colorize},set:function(e){this._colorize=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].colorize=e}},{key:"opacity",get:function(){return this._opacity},set:function(e){this._opacity=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].opacity=e}},{key:"castsShadow",get:function(){return this._castsShadow},set:function(e){(e=!1!==e)!==this._castsShadow&&(this._castsShadow=e,this.glRedraw())}},{key:"receivesShadow",get:function(){return this._receivesShadow},set:function(e){(e=!1!==e)!==this._receivesShadow&&(this._receivesShadow=e,this.glRedraw())}},{key:"saoEnabled",get:function(){return this._saoEnabled}},{key:"pbrEnabled",get:function(){return this._pbrEnabled}},{key:"isDrawable",get:function(){return!0}},{key:"isStateSortable",get:function(){return!1}},{key:"xrayMaterial",get:function(){return this.scene.xrayMaterial}},{key:"highlightMaterial",get:function(){return this.scene.highlightMaterial}},{key:"selectedMaterial",get:function(){return this.scene.selectedMaterial}},{key:"edgeMaterial",get:function(){return this.scene.edgeMaterial}},{key:"getPickViewMatrix",value:function(e){return this._viewMatrix?this._viewMatrix:e}},{key:"createGeometry",value:function(e){e.positionsCompressed&&!e.positions&&(e.positions=e.positionsCompressed);var t=e.id;if(null!=t)if(t in this._instancingGeometries)this.error("Geometry already created: "+t);else{var i=e.primitive;if(null!=i){var s=e.origin||e.rtcCenter,r=s?q.addVec3(this._origin,s,ir):this._origin;switch(i){case"triangles":case"solid":case"surface":this._instancingGeometries[e.id]=re.apply({origin:r,layerIndex:0},e),this._numTriangles+=e.indices?Math.round(e.indices.length/3):0;break;case"lines":case"points":throw"Not supported at the moment"}this.numGeometries++}else this.error("Config missing: primitive")}else this.error("Config missing: id")}},{key:"createMesh",value:function(e){if(e.positionsCompressed&&!e.positions&&(e.positions=e.positionsCompressed),this._vfcManager&&!this._vfcManager.finalized)return e.color&&(e.color=e.color.slice()),e.positionsDecodeMatrix&&(e.positionsDecodeMatrix=e.positionsDecodeMatrix.slice()),void this._vfcManager.addMesh(e);var t=e.id;if(null!=t)if(this._meshes[t])this.error("DataTextureSceneModel already has a Mesh with this ID: "+t);else{var i=e.geometryId,s=void 0!==i,r=null;r=s?this._instancingGeometries[i]:e;var n=null;if(s&&i in this._preparedInstancingGeometries)n=this._preparedInstancingGeometries[i];else{var o=r.primitive||"triangles";"triangles"!==o&&"solid"!==o&&"surface"!==o&&(this.error("Unsupported value for 'primitive': '".concat(o,"' - supported values are 'triangles', 'solid' and 'surface'. Defaulting to 'triangles'.")),o="triangles");var a=r.positions;if(!a)return this.error("Config missing: positions (no meshIds provided, so expecting geometry arrays instead)"),null;var u=r.indices,h=r.edgeIndices;if(!r.indices&&"triangles"===o)return this.error("Config missing for triangles primitive: indices (no meshIds provided, so expecting geometry arrays instead)"),null;h||(h=Dt(a,u,null,this._edgeThreshold)),r.edgeIndices=h,n=Os(r,this._enableVertexWelding,this._enableIndexRebucketing),s&&(this._preparedInstancingGeometries[i]=n)}var l,c=this._currentDataTextureLayer;null===c||c.canCreatePortion(n,s?i:null)||(c.finalize(),delete this._currentDataTextureLayer,c=null),c||(c=new Ss(this,{layerIndex:0,origin:e.origin}),this._layerList.push(c),this._currentDataTextureLayer=c);var p=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):[255,255,255],d=void 0!==e.opacity&&null!==e.opacity?Math.floor(255*e.opacity):255,f=void 0!==e.metallic&&null!==e.metallic?Math.floor(255*e.metallic):0,m=void 0!==e.roughness&&null!==e.roughness?Math.floor(255*e.roughness):255,v=new At(this,t,p,d),g=v.pickId,_=new Uint8Array([255&g,g>>8&255,g>>16&255,g>>24&255]),y=q.collapseAABB3();if(n.solid="solid"==n.primitive,s){var b,x=this._worldMatrixNonIdentity?this._worldMatrix:null;if(e.matrix)b=e.matrix;else{var P=e.scale||rr,T=e.position||nr,w=e.rotation||or;q.eulerToQuaternion(w,"XYZ",ar),b=q.composeMat4(T,ar,P,sr)}l=c.createPortion(n,{origin:e.origin,geometryId:i,color:p,metallic:f,roughness:m,opacity:d,meshMatrix:b,worldMatrix:x,aabb:y,pickColor:_}),q.expandAABB3(this._aabb,y),this._numTriangles+=n.indices.length/3,v.numTriangles=n.indices.length/3,v.origin=n.origin}else{var M=null;if(!e.positionsDecodeMatrix){var I=q.vec3(),C=[];ke(positions,C,I)&&(positions=C,M=q.addVec3(this._origin,I,I))}var D=e.origin||e.rtcCenter;M=D?M?q.addVec3(this._origin,D,ir):D:this._origin;var A,k=this._worldMatrixNonIdentity?this._worldMatrix:null;if(!e.positionsDecodeMatrix)if(e.matrix)A=e.matrix;else{var E=e.scale||rr,F=e.position||nr,R=e.rotation||or;q.eulerToQuaternion(R,"XYZ",ar),A=q.composeMat4(F,ar,E,sr)}switch(e.primitive||"triangles"){case"triangles":case"solid":case"surface":l=c.createPortion(re.apply({origin:M,color:p,metallic:f,roughness:m,colors:e.colors,colorsCompressed:e.colorsCompressed,opacity:d,meshMatrix:A,worldMatrix:k,aabb:y,pickColor:_},n));var S=Math.round(n.indices.length/3);this._numTriangles+=S,v.numTriangles=S;break;case"lines":case"points":throw"Not supported at the moment"}q.expandAABB3(this._aabb,y),this.numGeometries++,v.origin=M}v.parent=null,v._layer=c,v._portionId=l,v.aabb=y,this._meshes[t]=v}else this.error("Config missing: id")}},{key:"createEntity",value:function(e){if(!this._vfcManager||this._vfcManager.finalized){var t=e.id;void 0===t?t=q.createUUID():this.scene.components[t]&&(this.error("Scene already has a Component with this ID: "+t+" - will assign random ID"),t=q.createUUID());var i=e.meshIds;if(void 0!==i){for(var s=[],r=0,n=i.length;r<n;r++){var o=i[r],a=this._meshes[o];a?a.parent?this.error("Mesh with ID "+o+" already belongs to object with ID "+a.parent.id+" - ignoring this mesh"):s.push(a):this.error("Mesh with this ID not found: "+o+" - ignoring this mesh")}var u,h=0;if(this._visible&&!1!==e.visible&&(h|=kt),this._pickable&&!1!==e.pickable&&(h|=Ft),this._culled&&!1!==e.culled&&(h|=Et),this._clippable&&!1!==e.clippable&&(h|=Rt),this._collidable&&!1!==e.collidable&&(h|=St),this._edges&&!1!==e.edges&&(h|=Nt),this._xrayed&&!1!==e.xrayed&&(h|=Ot),this._highlighted&&!1!==e.highlighted&&(h|=Bt),this._selected&&!1!==e.selected&&(h|=Lt),1===s.length)u=s[0].aabb;else{u=q.collapseAABB3();for(var l=0,c=s.length;l<c;l++)q.expandAABB3(u,s[l].aabb)}var p=new Ht(this,e.isObject,t,s,h,u);return this._nodeList.push(p),this._nodes[t]=p,this.numEntities++,p}this.error("Config missing: meshIds")}else this._vfcManager.addEntity(e)}},{key:"finalize",value:function(){if(!this.destroyed){this._vfcManager&&this._vfcManager.finalize((function(){this._currentDataTextureLayer&&(this._currentDataTextureLayer.finalize(),delete this._currentDataTextureLayer,this._currentDataTextureLayer=null)})),this._currentDataTextureLayer&&this._currentDataTextureLayer.finalize();for(var e=0,t=this._nodeList.length;e<t;e++){this._nodeList[e]._finalize()}for(var i=0,s=this._nodeList.length;i<s;i++){this._nodeList[i]._finalize2()}this._layerList.sort((function(e,t){return e.sortId<t.sortId?-1:e.sortId>t.sortId?1:0}));for(var r=0,n=this._layerList.length;r<n;r++){this._layerList[r].layerIndex=r}this.glRedraw(),this.scene._aabbDirty=!0,this._instancingGeometries={},this._preparedInstancingGeometries={},this._targetLodFps&&(this.lodCullingManager=new Gs(this,[2e3,600,150,80,20],this._targetLodFps));for(var o=0,a=this._layerList.length;o<a;o++){this._layerList[o].attachToRenderingEvent()}}}},{key:"_rebuildAABB",value:function(){q.collapseAABB3(this._aabb);for(var e=0,t=this._nodeList.length;e<t;e++){var i=this._nodeList[e];q.expandAABB3(this._aabb,i.aabb)}this._aabbDirty=!1}},{key:"stateSortCompare",value:function(e,t){}},{key:"rebuildRenderFlags",value:function(){this.renderFlags.reset(),this._updateRenderFlagsVisibleLayers(),this.renderFlags.numLayers>0&&0===this.renderFlags.numVisibleLayers?this.renderFlags.culled=!0:this._updateRenderFlags()}},{key:"_updateRenderFlagsVisibleLayers",value:function(){var e=this.renderFlags;e.numLayers=this._layerList.length,e.numVisibleLayers=0;for(var t=0,i=this._layerList.length;t<i;t++){var s=this._layerList[t];this._getActiveSectionPlanesForLayer(s)&&(e.visibleLayers[e.numVisibleLayers++]=t)}}},{key:"_getActiveSectionPlanesForLayer",value:function(e){var t=this.renderFlags,i=this.scene._sectionPlanesState.sectionPlanes,s=i.length,r=e.layerIndex*s;if(s>0)for(var n=0;n<s;n++){i[n].active?(t.sectionPlanesActivePerLayer[r+n]=!0,t.sectioned=!0):t.sectionPlanesActivePerLayer[r+n]=!1}return!0}},{key:"_updateRenderFlags",value:function(){if(0!==this.numVisibleLayerPortions&&this.numCulledLayerPortions!==this.numPortions){var e=this.renderFlags;if(e.colorOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.colorTransparent=!0),this.numXRayedLayerPortions>0){var t=this.scene.xrayMaterial._state;t.fill&&(t.fillAlpha<1?e.xrayedSilhouetteTransparent=!0:e.xrayedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.xrayedEdgesTransparent=!0:e.xrayedEdgesOpaque=!0)}if(this.numEdgesLayerPortions>0)this.scene.edgeMaterial._state.edges&&(e.edgesOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.edgesTransparent=!0));if(this.numSelectedLayerPortions>0){var i=this.scene.selectedMaterial._state;i.fill&&(i.fillAlpha<1?e.selectedSilhouetteTransparent=!0:e.selectedSilhouetteOpaque=!0),i.edges&&(i.edgeAlpha<1?e.selectedEdgesTransparent=!0:e.selectedEdgesOpaque=!0)}if(this.numHighlightedLayerPortions>0){var s=this.scene.highlightMaterial._state;s.fill&&(s.fillAlpha<1?e.highlightedSilhouetteTransparent=!0:e.highlightedSilhouetteOpaque=!0),s.edges&&(s.edgeAlpha<1?e.highlightedEdgesTransparent=!0:e.highlightedEdgesOpaque=!0)}}}},{key:"drawColorOpaque",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawColorOpaque(t,e)}}},{key:"drawColorTransparent",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawColorTransparent(t,e)}}},{key:"drawDepth",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawDepth(t,e)}}},{key:"drawNormals",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawNormals(t,e)}}},{key:"drawSilhouetteXRayed",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawSilhouetteXRayed(t,e)}}},{key:"drawSilhouetteHighlighted",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawSilhouetteHighlighted(t,e)}}},{key:"drawSilhouetteSelected",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawSilhouetteSelected(t,e)}}},{key:"drawEdgesColorOpaque",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawEdgesColorOpaque(t,e)}}},{key:"drawEdgesColorTransparent",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawEdgesColorTransparent(t,e)}}},{key:"drawEdgesXRayed",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawEdgesXRayed(t,e)}}},{key:"drawEdgesHighlighted",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawEdgesHighlighted(t,e)}}},{key:"drawEdgesSelected",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawEdgesSelected(t,e)}}},{key:"drawOcclusion",value:function(e){if(0!==this.numVisibleLayerPortions)for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawOcclusion(t,e)}}},{key:"drawShadow",value:function(e){if(0!==this.numVisibleLayerPortions)for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawShadow(t,e)}}},{key:"drawPickMesh",value:function(e){if(0!==this.numVisibleLayerPortions)for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawPickMesh(t,e)}}},{key:"drawPickDepths",value:function(e){if(0!==this.numVisibleLayerPortions)for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawPickDepths(t,e)}}},{key:"drawPickNormals",value:function(e){if(0!==this.numVisibleLayerPortions)for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawPickNormals(t,e)}}},{key:"destroy",value:function(){this.scene.camera.off(this._onCameraViewMatrix);for(var e=0,t=this._layerList.length;e<t;e++)this._layerList[e].destroy();for(var s=0,r=this._nodeList.length;s<r;s++)this._nodeList[s]._destroy();this.scene._aabbDirty=!0,this._isModel&&this.scene._deregisterModel(this),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),hr=function(e,t){t=t||{};var i=new tt(e),s=e.canvas.canvas,r=e.canvas.gl,n=!!t.transparent,o=t.alphaDepthMask,a=new G({}),u={},h={},l=!0,c=!0,p=!0,d=!0,f=!0,m=!0,v=!0,g=!0,_=new It(e),y=!1,b=new vt(e),x=new xt(e);function P(){l&&(!function(){for(var e in u)if(u.hasOwnProperty(e)){var t=u[e],i=t.drawableMap,s=t.drawableListPreCull,r=0;for(var n in i)i.hasOwnProperty(n)&&(s[r++]=i[n]);s.length=r}}(),l=!1,c=!0),c&&(!function(){for(var e in u)if(u.hasOwnProperty(e)){var t=u[e];t.isStateSortable&&t.drawableListPreCull.sort(t.stateSortCompare)}}(),c=!1,p=!0),p&&function(){for(var e in u)if(u.hasOwnProperty(e)){for(var t=u[e],i=t.drawableListPreCull,s=t.drawableList,r=0,n=0,o=i.length;n<o;n++){var a=i[n];a.rebuildRenderFlags(),a.renderFlags.culled||(s[r++]=a)}s.length=r}}()}function T(e){if(e.castsShadow){var t=e.getShadowRenderBuf();if(t){for(var s in t.bind(),i.reset(),i.backfaces=!0,i.frontface=!0,i.shadowViewMatrix=e.getShadowViewMatrix(),i.shadowProjMatrix=e.getShadowProjMatrix(),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clearColor(0,0,0,1),r.enable(r.DEPTH_TEST),r.disable(r.BLEND),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),u)if(u.hasOwnProperty(s))for(var n=u[s].drawableList,o=0,a=n.length;o<a;o++){var h=n[o];!1!==h.visible&&h.castsShadow&&h.drawShadow&&(h.renderFlags.colorOpaque&&h.drawShadow(i))}t.unbind()}}}function w(t,s,n,o,h,l){i.reset(),i.backfaces=!0,i.frontface=!0,i.pickOrigin=l.origin,i.pickViewMatrix=n,i.pickProjMatrix=o,i.pickInvisible=!!h.pickInvisible,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clearColor(0,0,0,0),r.enable(r.DEPTH_TEST),r.disable(r.CULL_FACE),r.disable(r.BLEND),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);var c=h.includeEntityIds,p=h.excludeEntityIds;for(var d in u)if(u.hasOwnProperty(d))for(var f=u[d].drawableList,m=0,v=f.length;m<v;m++){var g=f[m];!g.drawPickMesh||!0===g.culled||!0!==h.pickInvisible&&!1===g.visible||!1===g.pickable||(c&&!c[g.id]||p&&p[g.id]||g.drawPickMesh(i))}var _=e.canvas.resolutionScale,y=t.read(Math.round(s[0]*_),Math.round(s[1]*_)),b=y[0]+256*y[1]+256*y[2]*256+256*y[3]*256*256;if(!(b<0))return a.items[b]}function M(t,s,n,o,a,u){if(s.drawPickTriangles){i.reset(),i.backfaces=!0,i.frontface=!0,i.pickOrigin=u.origin,i.pickViewMatrix=o,i.pickProjMatrix=a,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clearColor(0,0,0,0),r.enable(r.DEPTH_TEST),r.disable(r.CULL_FACE),r.disable(r.BLEND),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),s.drawPickTriangles(i);var h=e.canvas.resolutionScale,l=t.read(Math.round(n[0]*h),Math.round(n[1]*h)),c=l[0]+256*l[1]+256*l[2]*256+256*l[3]*256*256;c*=3,u.primIndex=c}}this._occlusionTester=null,this.capabilities={astcSupported:!!Ct(r,"WEBGL_compressed_texture_astc"),etc1Supported:!0,etc2Supported:!!Ct(r,"WEBGL_compressed_texture_etc"),dxtSupported:!!Ct(r,"WEBGL_compressed_texture_s3tc"),bptcSupported:!!Ct(r,"EXT_texture_compression_bptc"),pvrtcSupported:!(!Ct(r,"WEBGL_compressed_texture_pvrtc")&&!Ct(r,"WEBKIT_WEBGL_compressed_texture_pvrtc"))},this.setTransparentEnabled=function(e){d=e,p=!0},this.setEdgesEnabled=function(e){f=e,p=!0},this.setSAOEnabled=function(e){m=e,p=!0},this.setPBREnabled=function(e){v=e,p=!0},this.setColorTextureEnabled=function(e){g=e,p=!0},this.needStateSort=function(){c=!0},this.shadowsDirty=function(){},this.imageDirty=function(){p=!0},this.webglContextLost=function(){},this.webglContextRestored=function(e){b.init(),x.init(),p=!0},this.addDrawable=function(e,t){var i=t.type;if(i){var s=u[i];s||(s={type:t.type,count:0,isStateSortable:t.isStateSortable,stateSortCompare:t.stateSortCompare,drawableMap:{},drawableListPreCull:[],drawableList:[]},u[i]=s),s.count++,s.drawableMap[e]=t,h[e]=t,l=!0}else console.error("Renderer#addDrawable() : drawable with ID "+e+" has no 'type' - ignoring")},this.removeDrawable=function(e){var t=h[e];if(t){var i=t.type,s=u[i];--s.count<=0?delete u[i]:delete s.drawableMap[e],delete h[e],l=!0}else console.error("Renderer#removeDrawable() : drawable not found with ID "+e+" - ignoring")},this.getPickID=function(e){return a.addItem(e)},this.putPickID=function(e){a.removeItem(e)},this.clear=function(t){if(r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),n)r.clearColor(1,1,1,1);else{var i=e.canvas.backgroundColorFromAmbientLight?this.lights.getAmbientColorAndIntensity():e.canvas.backgroundColor;r.clearColor(i[0],i[1],i[2],1)}r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)},this.needsRender=function(){return p||l||c},this.render=function(t){(t=t||{}).force&&(p=!0),P(),p&&(!function(t){var s=e.sao;m&&s.possible&&function(t){var s=e.sao,n=_.getRenderBuffer("saoDepth",{depthTexture:!0});n.bind(),n.clear(),function(e){i.reset(),i.pass=e.pass,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clearColor(0,0,0,0),r.enable(r.DEPTH_TEST),r.frontFace(r.CCW),r.enable(r.CULL_FACE),r.depthMask(!0),!1!==e.clear&&r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);for(var t in u)if(u.hasOwnProperty(t))for(var s=u[t].drawableList,n=0,o=s.length;n<o;n++){var a=s[n];!0!==a.culled&&!1!==a.visible&&a.drawDepth&&a.saoEnabled&&(a.renderFlags.colorOpaque&&a.drawDepth(i))}}(t),n.unbind();var o=_.getRenderBuffer("saoOcclusion");if(o.bind(),o.clear(),b.render(n),o.unbind(),s.blur){var a=_.getRenderBuffer("saoOcclusion2");a.bind(),a.clear(),x.render(n,o,0),a.unbind(),o.bind(),o.clear(),x.render(n,a,1),o.unbind()}}(t);(function(){for(var t=e._lightsState.lights,i=0,s=t.length;i<s;i++){var r=t[i];r.castsShadow&&T(r)}})(),function(t){var s=[],a=[],h=[],l=[],c=[],p=[],y=[],b=[],x=[],P=[],T=[],w=[],M=[],I=[],C=[],D=[],A=e._lightsState.getAmbientColorAndIntensity();if(i.reset(),i.pass=t.pass,i.withSAO=!1,i.pbrEnabled=v&&!!e.pbrEnabled,i.colorTextureEnabled=g&&!!e.colorTextureEnabled,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),n)r.clearColor(0,0,0,0);else{var k=e.canvas.backgroundColorFromAmbientLight?A:e.canvas.backgroundColor;r.clearColor(k[0],k[1],k[2],1)}r.enable(r.DEPTH_TEST),r.frontFace(r.CCW),r.enable(r.CULL_FACE),r.depthMask(!0),r.lineWidth(1),i.lineWidth=1;var E,F,R,S=e.sao.possible;if(m&&S){var O=_.getRenderBuffer("saoOcclusion");i.occlusionTexture=O?O.getTexture():null}else i.occlusionTexture=null;var B=Date.now();!1!==t.clear&&r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);var L=0,N=0,j=0,G=0,H=0,U=0,V=0,z=0,W=0,X=0,Y=0,K=0,J=0,Z=0,Q=0,q=0;for(var $ in u)if(u.hasOwnProperty($)){var te=u[$].drawableList;for(E=0,F=te.length;E<F;E++)if(!0!==(R=te[E]).culled&&!1!==R.visible){var ie=R.renderFlags;ie.colorOpaque&&(m&&S&&R.saoEnabled?s[L++]=R:R.drawColorOpaque(i)),d&&ie.colorTransparent&&(h[j++]=R),ie.xrayedSilhouetteTransparent&&(y[V++]=R),ie.xrayedSilhouetteOpaque&&(c[H++]=R),ie.highlightedSilhouetteTransparent&&(T[Y++]=R),ie.highlightedSilhouetteOpaque&&(x[W++]=R),ie.selectedSilhouetteTransparent&&(C[Q++]=R),ie.selectedSilhouetteOpaque&&(M[J++]=R),f&&(ie.edgesOpaque&&(a[N++]=R),ie.edgesTransparent&&(l[G++]=R)),ie.selectedEdgesTransparent&&(D[q++]=R),ie.selectedEdgesOpaque&&(I[Z++]=R),ie.xrayedEdgesTransparent&&(b[z++]=R),ie.xrayedEdgesOpaque&&(p[U++]=R),ie.highlightedEdgesTransparent&&(w[K++]=R),ie.highlightedEdgesOpaque&&(P[X++]=R)}}if(L>0)for(i.withSAO=!0,E=0;E<L;E++)s[E].drawColorOpaque(i);if(N>0)for(E=0;E<N;E++)a[E].drawEdgesColorOpaque(i);if(H>0)for(E=0;E<H;E++)c[E].drawSilhouetteXRayed(i);if(U>0)for(E=0;E<U;E++)p[E].drawEdgesXRayed(i);if(V>0||z>0||j>0||G>0){if(r.enable(r.CULL_FACE),r.enable(r.BLEND),n?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):(r.blendEquation(r.FUNC_ADD),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA)),i.backfaces=!1,o||r.depthMask(!1),(j>0||G>0)&&r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),G>0)for(E=0;E<G;E++)(R=l[E]).drawEdgesColorTransparent(i);if(j>0)for(E=0;E<j;E++)(R=h[E]).drawColorTransparent(i);if(z>0)for(E=0;E<z;E++)b[E].drawEdgesXRayed(i);if(V>0)for(E=0;E<V;E++)y[E].drawSilhouetteXRayed(i);r.disable(r.BLEND),o||r.depthMask(!0)}if(W>0||X>0){if(i.lastProgramId=null,e.highlightMaterial.glowThrough&&r.clear(r.DEPTH_BUFFER_BIT),X>0)for(E=0;E<X;E++)P[E].drawEdgesHighlighted(i);if(W>0)for(E=0;E<W;E++)x[E].drawSilhouetteHighlighted(i)}if(Y>0||K>0||W>0){if(i.lastProgramId=null,e.selectedMaterial.glowThrough&&r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),n?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.enable(r.CULL_FACE),K>0)for(E=0;E<K;E++)w[E].drawEdgesHighlighted(i);if(Y>0)for(E=0;E<Y;E++)T[E].drawSilhouetteHighlighted(i);r.disable(r.BLEND)}if(J>0||Z>0){if(i.lastProgramId=null,e.selectedMaterial.glowThrough&&r.clear(r.DEPTH_BUFFER_BIT),Z>0)for(E=0;E<Z;E++)I[E].drawEdgesSelected(i);if(J>0)for(E=0;E<J;E++)M[E].drawSilhouetteSelected(i)}if(Q>0||q>0){if(i.lastProgramId=null,e.selectedMaterial.glowThrough&&r.clear(r.DEPTH_BUFFER_BIT),r.enable(r.CULL_FACE),r.enable(r.BLEND),n?(r.blendEquation(r.FUNC_ADD),r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA)):r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),q>0)for(E=0;E<q;E++)D[E].drawEdgesSelected(i);if(Q>0)for(E=0;E<Q;E++)C[E].drawSilhouetteSelected(i);r.disable(r.BLEND)}var se=Date.now(),re=ee.frame;re.renderTime=(se-B)/1e3,re.drawElements=i.drawElements,re.drawArrays=i.drawArrays,re.useProgram=i.useProgram,re.bindTexture=i.bindTexture,re.bindArray=i.bindArray;for(var ne=Ze.MAX_TEXTURE_IMAGE_UNITS,oe=0;oe<ne;oe++)r.activeTexture(r.TEXTURE0+oe);r.bindTexture(r.TEXTURE_CUBE_MAP,null),r.bindTexture(r.TEXTURE_2D,null);for(var ae=Ze.MAX_VERTEX_ATTRIBS,ue=0;ue<ae;ue++)r.disableVertexAttribArray(ue)}(t)}(t),ee.frame.frameCount++,p=!1)},this.pick=function(){var t=q.vec3(),i=q.mat4(),r=q.mat4(),n=q.vec3(),o=q.vec3([0,1,0]),a=new it,h=q.vec2(),l=q.vec3(),c=q.vec3(),p=q.vec3(),d=q.vec3(),f=q.vec3();return function(m){var v,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a;g.reset(),P();var y=null,b=null;if(g.pickSurface=m.pickSurface,m.canvasPos)l[0]=m.canvasPos[0],l[1]=m.canvasPos[1],y=e.camera.viewMatrix,b=e.camera.projMatrix,g.canvasPos=m.canvasPos;else{var x=q.frustumMat4(-1,1,-1,1,.01,e.camera.project.far,i);m.matrix?(y=m.matrix,b=x):(c.set(m.origin||[0,0,0]),p.set(m.direction||[0,0,1]),v=q.addVec3(c,p,t),n[0]=Math.random(),n[1]=Math.random(),n[2]=Math.random(),q.normalizeVec3(n),q.cross3Vec3(p,n,o),y=q.lookAtMat4v(c,v,o,r),b=x,g.origin=c,g.direction=p),l[0]=.5*s.clientWidth,l[1]=.5*s.clientHeight}if(null!==y)for(var T in u)if(u.hasOwnProperty(T))for(var D=u[T].drawableList,A=0,k=D.length;A<k;A++){var E=D[A];E instanceof ur&&E.pickCameraTexture&&E.pickCameraTexture._updateViewMatrix(y,b)}var F=_.getRenderBuffer("pick");F.bind();var R=w(F,l,y,b,m,g);if(!R)return F.unbind(),null;var S=R.delegatePickedEntity?R.delegatePickedEntity():R;return S?(m.pickSurface&&(m.pickSurfacePrecision&&e.pickSurfacePrecisionEnabled?(m.canvasPos&&q.canvasPosToWorldRay(e.canvas.canvas,y,b,l,c,p),R.precisionRayPickSurface(c,p,d,f)&&(g.worldPos=d,!1!==m.pickSurfaceNormal&&(g.worldNormal=f),g.pickSurfacePrecision=!0)):R.canPickTriangle&&R.canPickTriangle()?(M(F,R,l,y,b,g),R.pickTriangleSurface(y,b,g),g.pickSurfacePrecision=!1):R.canPickWorldPos&&R.canPickWorldPos()&&(h[0]=e.camera.project.near,h[1]=e.camera.project.far,I(F,R,l,y,b,h,g),!1!==m.pickSurfaceNormal&&C(F,R,l,y,b,g),g.pickSurfacePrecision=!1)),F.unbind(),g.entity=S,g):(F.unbind(),null)}}();var I=function(){var t=q.vec4(),n=q.vec4(),o=q.vec4(),a=q.vec4(),u=q.vec4(),h=q.mat4(),l=q.mat4(),c=q.mat4();return function(p,d,f,m,v,g,_){i.reset(),i.backfaces=!0,i.frontface=!0,i.pickOrigin=_.origin,i.pickViewMatrix=m,i.pickProjMatrix=v,i.pickZNear=g[0],i.pickZFar=g[1],r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clearColor(0,0,0,0),r.enable(r.DEPTH_TEST),r.disable(r.CULL_FACE),r.disable(r.BLEND),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),d.drawPickDepths(i);var y,b=e.canvas.resolutionScale,x=function(e){var t=[e[0]/256,e[1]/256,e[2]/256,e[3]/256],i=[1/16777216,1/65536,1/256,1];return q.dotVec4(t,i)}(p.read(Math.round(f[0]*b),Math.round(f[1]*b))),P=(f[0]-s.clientWidth/2)/(s.clientWidth/2),T=-(f[1]-s.clientHeight/2)/(s.clientHeight/2),w=d.origin;if(w){var M=De(m,w,h);y=q.mulMat4(v,M,l)}else y=q.mulMat4(v,m,l);var I=q.inverseMat4(y,c);t[0]=P,t[1]=T,t[2]=-1,t[3]=1;var C=q.transformVec4(I,t);C=q.mulVec4Scalar(C,1/C[3]),n[0]=P,n[1]=T,n[2]=1,n[3]=1;var D=q.transformVec4(I,n);D=q.mulVec4Scalar(D,1/D[3]);var A=q.subVec3(D,C,o),k=q.addVec3(C,q.mulVec4Scalar(A,x,a),u);w&&q.addVec3(k,w),_.worldPos=k}}();function C(t,s,n,o,a,u){i.reset(),i.backfaces=!0,i.frontface=!0,i.pickOrigin=u.origin,i.pickViewMatrix=o,i.pickProjMatrix=a,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clearColor(0,0,0,0),r.enable(r.DEPTH_TEST),r.disable(r.CULL_FACE),r.disable(r.BLEND),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),s.drawPickNormals(i);var h=e.canvas.resolutionScale,l=t.read(Math.round(n[0]*h),Math.round(n[1]*h)),c=[l[0]/256-.5,l[1]/256-.5,l[2]/256-.5];q.normalizeVec3(c),u.worldNormal=c}this.addMarker=function(t){this._occlusionTester=this._occlusionTester||new ft(e,_),this._occlusionTester.addMarker(t),e.occlusionTestCountdown=0},this.markerWorldPosUpdated=function(e){this._occlusionTester.markerWorldPosUpdated(e)},this.removeMarker=function(e){this._occlusionTester.removeMarker(e)},this.doOcclusionTest=function(){if(this._occlusionTester&&this._occlusionTester.needOcclusionTest){for(var e in P(),this._occlusionTester.bindRenderBuf(),i.reset(),i.backfaces=!0,i.frontface=!0,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clearColor(0,0,0,0),r.enable(r.DEPTH_TEST),r.disable(r.CULL_FACE),r.disable(r.BLEND),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),u)if(u.hasOwnProperty(e))for(var t=u[e].drawableList,s=0,n=t.length;s<n;s++){var o=t[s];o.drawOcclusion&&!0!==o.culled&&!1!==o.visible&&!1!==o.pickable&&o.drawOcclusion(i)}this._occlusionTester.drawMarkers(i),this._occlusionTester.doOcclusionTest(),this._occlusionTester.unbindRenderBuf()}},this.readPixels=function(e,t,i,s){var r,n,o,a,u=_.getRenderBuffer("snapshot");for(u.bind(),u.clear(),this.render({force:!0,opaqueOnly:s}),n=0;n<i;n++)o=2*n,a=4*n,r=u.read(e[o],e[o+1]),t[a]=r[0],t[a+1]=r[1],t[a+2]=r[2],t[a+3]=r[3];u.unbind(),p=!0},this.beginSnapshot=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=_.getRenderBuffer("snapshot");e.width&&e.height&&t.setSize([e.width,e.height]),t.bind(),t.clear(),y=!0},this.renderSnapshot=function(){y&&(_.getRenderBuffer("snapshot").clear(),this.render({force:!0,opaqueOnly:!1}),p=!0)},this.readSnapshot=function(e){return _.getRenderBuffer("snapshot").readImage(e)},this.endSnapshot=function(){y&&(_.getRenderBuffer("snapshot").unbind(),y=!1)},this.destroy=function(){u={},h={},_.destroy(),b.destroy(),x.destroy(),this._occlusionTester&&this._occlusionTester.destroy()}},lr=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r)).KEY_BACKSPACE=8,s.KEY_TAB=9,s.KEY_ENTER=13,s.KEY_SHIFT=16,s.KEY_CTRL=17,s.KEY_ALT=18,s.KEY_PAUSE_BREAK=19,s.KEY_CAPS_LOCK=20,s.KEY_ESCAPE=27,s.KEY_PAGE_UP=33,s.KEY_PAGE_DOWN=34,s.KEY_END=35,s.KEY_HOME=36,s.KEY_LEFT_ARROW=37,s.KEY_UP_ARROW=38,s.KEY_RIGHT_ARROW=39,s.KEY_DOWN_ARROW=40,s.KEY_INSERT=45,s.KEY_DELETE=46,s.KEY_NUM_0=48,s.KEY_NUM_1=49,s.KEY_NUM_2=50,s.KEY_NUM_3=51,s.KEY_NUM_4=52,s.KEY_NUM_5=53,s.KEY_NUM_6=54,s.KEY_NUM_7=55,s.KEY_NUM_8=56,s.KEY_NUM_9=57,s.KEY_A=65,s.KEY_B=66,s.KEY_C=67,s.KEY_D=68,s.KEY_E=69,s.KEY_F=70,s.KEY_G=71,s.KEY_H=72,s.KEY_I=73,s.KEY_J=74,s.KEY_K=75,s.KEY_L=76,s.KEY_M=77,s.KEY_N=78,s.KEY_O=79,s.KEY_P=80,s.KEY_Q=81,s.KEY_R=82,s.KEY_S=83,s.KEY_T=84,s.KEY_U=85,s.KEY_V=86,s.KEY_W=87,s.KEY_X=88,s.KEY_Y=89,s.KEY_Z=90,s.KEY_LEFT_WINDOW=91,s.KEY_RIGHT_WINDOW=92,s.KEY_SELECT_KEY=93,s.KEY_NUMPAD_0=96,s.KEY_NUMPAD_1=97,s.KEY_NUMPAD_2=98,s.KEY_NUMPAD_3=99,s.KEY_NUMPAD_4=100,s.KEY_NUMPAD_5=101,s.KEY_NUMPAD_6=102,s.KEY_NUMPAD_7=103,s.KEY_NUMPAD_8=104,s.KEY_NUMPAD_9=105,s.KEY_MULTIPLY=106,s.KEY_ADD=107,s.KEY_SUBTRACT=109,s.KEY_DECIMAL_POINT=110,s.KEY_DIVIDE=111,s.KEY_F1=112,s.KEY_F2=113,s.KEY_F3=114,s.KEY_F4=115,s.KEY_F5=116,s.KEY_F6=117,s.KEY_F7=118,s.KEY_F8=119,s.KEY_F9=120,s.KEY_F10=121,s.KEY_F11=122,s.KEY_F12=123,s.KEY_NUM_LOCK=144,s.KEY_SCROLL_LOCK=145,s.KEY_SEMI_COLON=186,s.KEY_EQUAL_SIGN=187,s.KEY_COMMA=188,s.KEY_DASH=189,s.KEY_PERIOD=190,s.KEY_FORWARD_SLASH=191,s.KEY_GRAVE_ACCENT=192,s.KEY_OPEN_BRACKET=219,s.KEY_BACK_SLASH=220,s.KEY_CLOSE_BRACKET=221,s.KEY_SINGLE_QUOTE=222,s.KEY_SPACE=32,s.element=r.element,s.altDown=!1,s.ctrlDown=!1,s.mouseDownLeft=!1,s.mouseDownMiddle=!1,s.mouseDownRight=!1,s.keyDown=[],s.enabled=!0,s.keyboardEnabled=!0,s.mouseover=!1,s.mouseCanvasPos=q.vec2(),s._keyboardEventsElement=r.keyboardEventsElement||document,s._bindEvents(),s}return I(i,[{key:"_bindEvents",value:function(){var e=this;if(!this._eventsBound){this._keyboardEventsElement.addEventListener("keydown",this._keyDownListener=function(t){e.enabled&&e.keyboardEnabled&&"INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&(t.keyCode===e.KEY_CTRL?e.ctrlDown=!0:t.keyCode===e.KEY_ALT?e.altDown=!0:t.keyCode===e.KEY_SHIFT&&(e.shiftDown=!0),e.keyDown[t.keyCode]=!0,e.fire("keydown",t.keyCode,!0))},!1),this._keyboardEventsElement.addEventListener("keyup",this._keyUpListener=function(t){e.enabled&&e.keyboardEnabled&&"INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&(t.keyCode===e.KEY_CTRL?e.ctrlDown=!1:t.keyCode===e.KEY_ALT?e.altDown=!1:t.keyCode===e.KEY_SHIFT&&(e.shiftDown=!1),e.keyDown[t.keyCode]=!1,e.fire("keyup",t.keyCode,!0))}),this.element.addEventListener("mouseenter",this._mouseEnterListener=function(t){e.enabled&&(e.mouseover=!0,e._getMouseCanvasPos(t),e.fire("mouseenter",e.mouseCanvasPos,!0))}),this.element.addEventListener("mouseleave",this._mouseLeaveListener=function(t){e.enabled&&(e.mouseover=!1,e._getMouseCanvasPos(t),e.fire("mouseleave",e.mouseCanvasPos,!0))}),this.element.addEventListener("mousedown",this._mouseDownListener=function(t){if(e.enabled){switch(t.which){case 1:e.mouseDownLeft=!0;break;case 2:e.mouseDownMiddle=!0;break;case 3:e.mouseDownRight=!0}e._getMouseCanvasPos(t),e.element.focus(),e.fire("mousedown",e.mouseCanvasPos,!0),e.mouseover&&t.preventDefault()}}),document.addEventListener("mouseup",this._mouseUpListener=function(t){if(e.enabled){switch(t.which){case 1:e.mouseDownLeft=!1;break;case 2:e.mouseDownMiddle=!1;break;case 3:e.mouseDownRight=!1}e.fire("mouseup",e.mouseCanvasPos,!0)}},!0),document.addEventListener("click",this._clickListener=function(t){if(e.enabled){switch(t.which){case 1:case 3:e.mouseDownLeft=!1,e.mouseDownRight=!1;break;case 2:e.mouseDownMiddle=!1}e._getMouseCanvasPos(t),e.fire("click",e.mouseCanvasPos,!0),e.mouseover&&t.preventDefault()}}),document.addEventListener("dblclick",this._dblClickListener=function(t){if(e.enabled){switch(t.which){case 1:case 3:e.mouseDownLeft=!1,e.mouseDownRight=!1;break;case 2:e.mouseDownMiddle=!1}e._getMouseCanvasPos(t),e.fire("dblclick",e.mouseCanvasPos,!0),e.mouseover&&t.preventDefault()}}),this.element.addEventListener("mousemove",this._mouseMoveListener=function(t){e.enabled&&(e._getMouseCanvasPos(t),e.fire("mousemove",e.mouseCanvasPos,!0),e.mouseover&&t.preventDefault())}),this.element.addEventListener("wheel",this._mouseWheelListener=function(t,i){if(e.enabled){var s=Math.max(-1,Math.min(1,40*-t.deltaY));e.fire("mousewheel",s,!0)}},{passive:!0});var t,i;this.on("mousedown",(function(e){t=e[0],i=e[1]})),this.on("mouseup",(function(s){t>=s[0]-2&&t<=s[0]+2&&i>=s[1]-2&&i<=s[1]+2&&e.fire("mouseclicked",s,!0)})),this._eventsBound=!0}}},{key:"_unbindEvents",value:function(){this._eventsBound&&(this._keyboardEventsElement.removeEventListener("keydown",this._keyDownListener),this._keyboardEventsElement.removeEventListener("keyup",this._keyUpListener),this.element.removeEventListener("mouseenter",this._mouseEnterListener),this.element.removeEventListener("mouseleave",this._mouseLeaveListener),this.element.removeEventListener("mousedown",this._mouseDownListener),document.removeEventListener("mouseup",this._mouseDownListener),document.removeEventListener("click",this._clickListener),document.removeEventListener("dblclick",this._dblClickListener),this.element.removeEventListener("mousemove",this._mouseMoveListener),this.element.removeEventListener("wheel",this._mouseWheelListener),window.OrientationChangeEvent&&window.removeEventListener("orientationchange",this._orientationchangedListener),window.DeviceMotionEvent&&window.removeEventListener("devicemotion",this._deviceMotionListener),window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",this._deviceOrientListener),this._eventsBound=!1)}},{key:"_getMouseCanvasPos",value:function(e){if(e){for(var t=e.target,i=0,s=0;t.offsetParent;)i+=t.offsetLeft,s+=t.offsetTop,t=t.offsetParent;this.mouseCanvasPos[0]=e.pageX-i,this.mouseCanvasPos[1]=e.pageY-s}else e=window.event,this.mouseCanvasPos[0]=e.x,this.mouseCanvasPos[1]=e.y}},{key:"setEnabled",value:function(e){this.enabled!==e&&this.fire("enabled",this.enabled=e)}},{key:"getEnabled",value:function(){return this.enabled}},{key:"setKeyboardEnabled",value:function(e){this.keyboardEnabled=e}},{key:"getKeyboardEnabled",value:function(){return this.keyboardEnabled}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._unbindEvents()}}]),i}(),cr=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._state=new ti({boundary:[0,0,100,100]}),s.boundary=r.boundary,s.autoBoundary=r.autoBoundary,s}return I(i,[{key:"type",get:function(){return"Viewport"}},{key:"boundary",get:function(){return this._state.boundary},set:function(e){if(!this._autoBoundary){if(!e){var t=this.scene.canvas.boundary;e=[0,0,t[2],t[3]]}this._state.boundary=e,this.glRedraw(),this.fire("boundary",this._state.boundary)}}},{key:"autoBoundary",get:function(){return this._autoBoundary},set:function(e){(e=!!e)!==this._autoBoundary&&(this._autoBoundary=e,this._autoBoundary?this._onCanvasSize=this.scene.canvas.on("boundary",(function(e){var t=e[2],i=e[3];this._state.boundary=[0,0,t,i],this.glRedraw(),this.fire("boundary",this._state.boundary)}),this):this._onCanvasSize&&(this.scene.canvas.off(this._onCanvasSize),this._onCanvasSize=null),this.fire("autoBoundary",this._autoBoundary))}},{key:"_getState",value:function(){return this._state}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy()}}]),i}(),pr=function(e){g(i,fe);var t=y(i);function i(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),t.call(this,e,s)}return I(i,[{key:"type",get:function(){return"Light"}},{key:"isLight",get:function(){return!0}}]),i}(),dr=function(e){g(i,pr);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,i),(s=t.call(this,e,r))._shadowRenderBuf=null,s._shadowViewMatrix=null,s._shadowProjMatrix=null,s._shadowViewMatrixDirty=!0,s._shadowProjMatrixDirty=!0;var n=s.scene.camera,o=s.scene.canvas;return s._onCameraViewMatrix=n.on("viewMatrix",(function(){s._shadowViewMatrixDirty=!0})),s._onCameraProjMatrix=n.on("projMatrix",(function(){s._shadowProjMatrixDirty=!0})),s._onCanvasBoundary=o.on("boundary",(function(){s._shadowProjMatrixDirty=!0})),s._state=new ti({type:"dir",dir:q.vec3([1,1,1]),color:q.vec3([.7,.7,.8]),intensity:1,space:r.space||"view",castsShadow:!1,getShadowViewMatrix:function(){if(s._shadowViewMatrixDirty){s._shadowViewMatrix||(s._shadowViewMatrix=q.identityMat4());var e=s.scene.camera,t=s._state.dir,i=e.look,r=[i[0]-t[0],i[1]-t[1],i[2]-t[2]];q.lookAtMat4v(r,i,[0,1,0],s._shadowViewMatrix),s._shadowViewMatrixDirty=!1}return s._shadowViewMatrix},getShadowProjMatrix:function(){return s._shadowProjMatrixDirty&&(s._shadowProjMatrix||(s._shadowProjMatrix=q.identityMat4()),q.orthoMat4c(-40,40,-40,40,-40,80,s._shadowProjMatrix),s._shadowProjMatrixDirty=!1),s._shadowProjMatrix},getShadowRenderBuf:function(){return s._shadowRenderBuf||(s._shadowRenderBuf=new Mt(s.scene.canvas.canvas,s.scene.canvas.gl,{size:[1024,1024]})),s._shadowRenderBuf}}),s.dir=r.dir,s.color=r.color,s.intensity=r.intensity,s.castsShadow=r.castsShadow,s.scene._lightCreated(x(s)),s}return I(i,[{key:"type",get:function(){return"DirLight"}},{key:"dir",get:function(){return this._state.dir},set:function(e){this._state.dir.set(e||[1,1,1]),this._shadowViewMatrixDirty=!0,this.glRedraw()}},{key:"color",get:function(){return this._state.color},set:function(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}},{key:"intensity",get:function(){return this._state.intensity},set:function(e){e=void 0!==e?e:1,this._state.intensity=e,this.glRedraw()}},{key:"castsShadow",get:function(){return this._state.castsShadow},set:function(e){e=!!e,this._state.castsShadow!==e&&(this._state.castsShadow=e,this._shadowViewMatrixDirty=!0,this.glRedraw())}},{key:"destroy",value:function(){var e=this.scene.camera,t=this.scene.canvas;e.off(this._onCameraViewMatrix),e.off(this._onCameraProjMatrix),t.off(this._onCanvasBoundary),m(P(i.prototype),"destroy",this).call(this),this._state.destroy(),this._shadowRenderBuf&&this._shadowRenderBuf.destroy(),this.scene._lightDestroyed(this),this.glRedraw()}}]),i}(),fr=function(e){g(i,pr);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._state={type:"ambient",color:q.vec3([.7,.7,.7]),intensity:1},s.color=r.color,s.intensity=r.intensity,s.scene._lightCreated(x(s)),s}return I(i,[{key:"type",get:function(){return"AmbientLight"}},{key:"color",get:function(){return this._state.color},set:function(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}},{key:"intensity",get:function(){return this._state.intensity},set:function(e){this._state.intensity=void 0!==e?e:1,this.glRedraw()}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this.scene._lightDestroyed(this)}}]),i}(),mr=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),s=t.call(this,e,r),ee.memory.meshes++,s}return I(i,[{key:"type",get:function(){return"Geometry"}},{key:"isGeometry",get:function(){return!0}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),ee.memory.meshes--}}]),i}(),vr=ee.memory,gr=q.AABB3(),_r=function(e){g(i,mr);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,i),(s=t.call(this,e,r))._state=new ti({compressGeometry:!!r.compressGeometry,primitive:null,primitiveName:null,positions:null,normals:null,colors:null,uv:null,indices:null,positionsDecodeMatrix:null,uvDecodeMatrix:null,positionsBuf:null,normalsBuf:null,colorsbuf:null,uvBuf:null,indicesBuf:null,hash:""}),s._numTriangles=0,s._edgeThreshold=r.edgeThreshold||10,s._edgeIndicesBuf=null,s._pickTrianglePositionsBuf=null,s._pickTriangleColorsBuf=null,s._aabbDirty=!0,s._boundingSphere=!0,s._aabb=null,s._aabbDirty=!0,s._obb=null,s._obbDirty=!0;var n=s._state,o=s.scene.canvas.gl;switch(r.primitive=r.primitive||"triangles",r.primitive){case"points":n.primitive=o.POINTS,n.primitiveName=r.primitive;break;case"lines":n.primitive=o.LINES,n.primitiveName=r.primitive;break;case"line-loop":n.primitive=o.LINE_LOOP,n.primitiveName=r.primitive;break;case"line-strip":n.primitive=o.LINE_STRIP,n.primitiveName=r.primitive;break;case"triangles":n.primitive=o.TRIANGLES,n.primitiveName=r.primitive;break;case"triangle-strip":n.primitive=o.TRIANGLE_STRIP,n.primitiveName=r.primitive;break;case"triangle-fan":n.primitive=o.TRIANGLE_FAN,n.primitiveName=r.primitive;break;default:s.error("Unsupported value for 'primitive': '"+r.primitive+"' - supported values are 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'. Defaulting to 'triangles'."),n.primitive=o.TRIANGLES,n.primitiveName=r.primitive}if(r.positions)if(s._state.compressGeometry){var a=ui.getPositionsBounds(r.positions),u=ui.compressPositions(r.positions,a.min,a.max);n.positions=u.quantized,n.positionsDecodeMatrix=u.decodeMatrix}else n.positions=r.positions.constructor===Float32Array?r.positions:new Float32Array(r.positions);if(r.colors&&(n.colors=r.colors.constructor===Float32Array?r.colors:new Float32Array(r.colors)),r.uv)if(s._state.compressGeometry){var h=ui.getUVBounds(r.uv),l=ui.compressUVs(r.uv,h.min,h.max);n.uv=l.quantized,n.uvDecodeMatrix=l.decodeMatrix}else n.uv=r.uv.constructor===Float32Array?r.uv:new Float32Array(r.uv);return r.normals&&(s._state.compressGeometry?n.normals=ui.compressNormals(r.normals):n.normals=r.normals.constructor===Float32Array?r.normals:new Float32Array(r.normals)),r.indices&&(n.indices=r.indices.constructor===Uint32Array||r.indices.constructor===Uint16Array?r.indices:new Uint32Array(r.indices),"triangles"===s._state.primitiveName&&(s._numTriangles=r.indices.length/3)),s._buildHash(),vr.meshes++,s._buildVBOs(),s}return I(i,[{key:"type",get:function(){return"ReadableGeometry"}},{key:"isReadableGeometry",get:function(){return!0}},{key:"_buildVBOs",value:function(){var e=this._state,t=this.scene.canvas.gl;if(e.indices&&(e.indicesBuf=new lt(t,t.ELEMENT_ARRAY_BUFFER,e.indices,e.indices.length,1,t.STATIC_DRAW),vr.indices+=e.indicesBuf.numItems),e.positions&&(e.positionsBuf=new lt(t,t.ARRAY_BUFFER,e.positions,e.positions.length,3,t.STATIC_DRAW),vr.positions+=e.positionsBuf.numItems),e.normals){var i=e.compressGeometry;e.normalsBuf=new lt(t,t.ARRAY_BUFFER,e.normals,e.normals.length,3,t.STATIC_DRAW,i),vr.normals+=e.normalsBuf.numItems}e.colors&&(e.colorsBuf=new lt(t,t.ARRAY_BUFFER,e.colors,e.colors.length,4,t.STATIC_DRAW),vr.colors+=e.colorsBuf.numItems),e.uv&&(e.uvBuf=new lt(t,t.ARRAY_BUFFER,e.uv,e.uv.length,2,t.STATIC_DRAW),vr.uvs+=e.uvBuf.numItems)}},{key:"_buildHash",value:function(){var e=this._state,t=["/g"];t.push("/"+e.primitive+";"),e.positions&&t.push("p"),e.colors&&t.push("c"),(e.normals||e.autoVertexNormals)&&t.push("n"),e.uv&&t.push("u"),e.compressGeometry&&t.push("cp"),t.push(";"),e.hash=t.join("")}},{key:"_getEdgeIndices",value:function(){return this._edgeIndicesBuf||this._buildEdgeIndices(),this._edgeIndicesBuf}},{key:"_getPickTrianglePositions",value:function(){return this._pickTrianglePositionsBuf||this._buildPickTriangleVBOs(),this._pickTrianglePositionsBuf}},{key:"_getPickTriangleColors",value:function(){return this._pickTriangleColorsBuf||this._buildPickTriangleVBOs(),this._pickTriangleColorsBuf}},{key:"_buildEdgeIndices",value:function(){var e=this._state;if(e.positions&&e.indices){var t=this.scene.canvas.gl,i=Dt(e.positions,e.indices,e.positionsDecodeMatrix,this._edgeThreshold);this._edgeIndicesBuf=new lt(t,t.ELEMENT_ARRAY_BUFFER,i,i.length,1,t.STATIC_DRAW),vr.indices+=this._edgeIndicesBuf.numItems}}},{key:"_buildPickTriangleVBOs",value:function(){var e=this._state;if(e.positions&&e.indices){var t=this.scene.canvas.gl,i=q.buildPickTriangles(e.positions,e.indices,e.compressGeometry),s=i.positions,r=i.colors;this._pickTrianglePositionsBuf=new lt(t,t.ARRAY_BUFFER,s,s.length,3,t.STATIC_DRAW),this._pickTriangleColorsBuf=new lt(t,t.ARRAY_BUFFER,r,r.length,4,t.STATIC_DRAW,!0),vr.positions+=this._pickTrianglePositionsBuf.numItems,vr.colors+=this._pickTriangleColorsBuf.numItems}}},{key:"_buildPickVertexVBOs",value:function(){}},{key:"_webglContextLost",value:function(){this._sceneVertexBufs&&this._sceneVertexBufs.webglContextLost()}},{key:"_webglContextRestored",value:function(){this._sceneVertexBufs&&this._sceneVertexBufs.webglContextRestored(),this._buildVBOs(),this._edgeIndicesBuf=null,this._pickVertexPositionsBuf=null,this._pickTrianglePositionsBuf=null,this._pickTriangleColorsBuf=null,this._pickVertexPositionsBuf=null,this._pickVertexColorsBuf=null}},{key:"primitive",get:function(){return this._state.primitiveName}},{key:"compressGeometry",get:function(){return this._state.compressGeometry}},{key:"positions",get:function(){return this._state.positions?this._state.compressGeometry?(this._decompressedPositions||(this._decompressedPositions=new Float32Array(this._state.positions.length),ui.decompressPositions(this._state.positions,this._state.positionsDecodeMatrix,this._decompressedPositions)),this._decompressedPositions):this._state.positions:null},set:function(e){var t=this._state,i=t.positions;if(i)if(i.length===e.length){if(this._state.compressGeometry){var s=ui.getPositionsBounds(e),r=ui.compressPositions(e,s.min,s.max);e=r.quantized,t.positionsDecodeMatrix=r.decodeMatrix}i.set(e),t.positionsBuf&&t.positionsBuf.setData(i),this._setAABBDirty(),this.glRedraw()}else this.error("can't update geometry positions - new positions are wrong length");else this.error("can't update geometry positions - geometry has no positions")}},{key:"normals",get:function(){if(this._state.normals){if(!this._state.compressGeometry)return this._state.normals;if(!this._decompressedNormals){var e=this._state.normals.length,t=e+e/2;this._decompressedNormals=new Float32Array(t),ui.decompressNormals(this._state.normals,this._decompressedNormals)}return this._decompressedNormals}},set:function(e){if(this._state.compressGeometry)this.error("can't update geometry normals - quantized geometry is immutable");else{var t=this._state,i=t.normals;i?i.length===e.length?(i.set(e),t.normalsBuf&&t.normalsBuf.setData(i),this.glRedraw()):this.error("can't update geometry normals - new normals are wrong length"):this.error("can't update geometry normals - geometry has no normals")}}},{key:"uv",get:function(){return this._state.uv?this._state.compressGeometry?(this._decompressedUV||(this._decompressedUV=new Float32Array(this._state.uv.length),ui.decompressUVs(this._state.uv,this._state.uvDecodeMatrix,this._decompressedUV)),this._decompressedUV):this._state.uv:null},set:function(e){if(this._state.compressGeometry)this.error("can't update geometry UVs - quantized geometry is immutable");else{var t=this._state,i=t.uv;i?i.length===e.length?(i.set(e),t.uvBuf&&t.uvBuf.setData(i),this.glRedraw()):this.error("can't update geometry UVs - new UVs are wrong length"):this.error("can't update geometry UVs - geometry has no UVs")}}},{key:"colors",get:function(){return this._state.colors},set:function(e){if(this._state.compressGeometry)this.error("can't update geometry colors - quantized geometry is immutable");else{var t=this._state,i=t.colors;i?i.length===e.length?(i.set(e),t.colorsBuf&&t.colorsBuf.setData(i),this.glRedraw()):this.error("can't update geometry colors - new colors are wrong length"):this.error("can't update geometry colors - geometry has no colors")}}},{key:"indices",get:function(){return this._state.indices}},{key:"aabb",get:function(){return this._aabbDirty&&(this._aabb||(this._aabb=q.AABB3()),q.positions3ToAABB3(this._state.positions,this._aabb,this._state.positionsDecodeMatrix),this._aabbDirty=!1),this._aabb}},{key:"obb",get:function(){return this._obbDirty&&(this._obb||(this._obb=q.OBB3()),q.positions3ToAABB3(this._state.positions,gr,this._state.positionsDecodeMatrix),q.AABB3ToOBB3(gr,this._obb),this._obbDirty=!1),this._obb}},{key:"numTriangles",get:function(){return this._numTriangles}},{key:"_setAABBDirty",value:function(){this._aabbDirty||(this._aabbDirty=!0,this._aabbDirty=!0,this._obbDirty=!0)}},{key:"_getState",value:function(){return this._state}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this);var e=this._state;e.indicesBuf&&e.indicesBuf.destroy(),e.positionsBuf&&e.positionsBuf.destroy(),e.normalsBuf&&e.normalsBuf.destroy(),e.uvBuf&&e.uvBuf.destroy(),e.colorsBuf&&e.colorsBuf.destroy(),this._edgeIndicesBuf&&this._edgeIndicesBuf.destroy(),this._pickTrianglePositionsBuf&&this._pickTrianglePositionsBuf.destroy(),this._pickTriangleColorsBuf&&this._pickTriangleColorsBuf.destroy(),this._pickVertexPositionsBuf&&this._pickVertexPositionsBuf.destroy(),this._pickVertexColorsBuf&&this._pickVertexColorsBuf.destroy(),e.destroy(),vr.meshes--}}]),i}();function yr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var i=e.ySize||1;i<0&&(console.error("negative ySize not allowed - will invert"),i*=-1);var s=e.zSize||1;s<0&&(console.error("negative zSize not allowed - will invert"),s*=-1);var r=e.center,n=r?r[0]:0,o=r?r[1]:0,a=r?r[2]:0,u=-t+n,h=-i+o,l=-s+a,c=t+n,p=i+o,d=s+a;return re.apply(e,{positions:[c,p,d,u,p,d,u,h,d,c,h,d,c,p,d,c,h,d,c,h,l,c,p,l,c,p,d,c,p,l,u,p,l,u,p,d,u,p,d,u,p,l,u,h,l,u,h,d,u,h,l,c,h,l,c,h,d,u,h,d,c,h,l,u,h,l,u,p,l,c,p,l],normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],uv:[1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]})}var br=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),s=t.call(this,e,r),ee.memory.materials++,s}return I(i,[{key:"type",get:function(){return"Material"}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),ee.memory.materials--}}]),i}(),xr={opaque:0,mask:1,blend:2},Pr=["opaque","mask","blend"],Tr=function(e){g(i,br);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._state=new ti({type:"PhongMaterial",ambient:q.vec3([1,1,1]),diffuse:q.vec3([1,1,1]),specular:q.vec3([1,1,1]),emissive:q.vec3([0,0,0]),alpha:null,shininess:null,reflectivity:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),s.ambient=r.ambient,s.diffuse=r.diffuse,s.specular=r.specular,s.emissive=r.emissive,s.alpha=r.alpha,s.shininess=r.shininess,s.reflectivity=r.reflectivity,s.lineWidth=r.lineWidth,s.pointSize=r.pointSize,r.ambientMap&&(s._ambientMap=s._checkComponent("Texture",r.ambientMap)),r.diffuseMap&&(s._diffuseMap=s._checkComponent("Texture",r.diffuseMap)),r.specularMap&&(s._specularMap=s._checkComponent("Texture",r.specularMap)),r.emissiveMap&&(s._emissiveMap=s._checkComponent("Texture",r.emissiveMap)),r.alphaMap&&(s._alphaMap=s._checkComponent("Texture",r.alphaMap)),r.reflectivityMap&&(s._reflectivityMap=s._checkComponent("Texture",r.reflectivityMap)),r.normalMap&&(s._normalMap=s._checkComponent("Texture",r.normalMap)),r.occlusionMap&&(s._occlusionMap=s._checkComponent("Texture",r.occlusionMap)),r.diffuseFresnel&&(s._diffuseFresnel=s._checkComponent("Fresnel",r.diffuseFresnel)),r.specularFresnel&&(s._specularFresnel=s._checkComponent("Fresnel",r.specularFresnel)),r.emissiveFresnel&&(s._emissiveFresnel=s._checkComponent("Fresnel",r.emissiveFresnel)),r.alphaFresnel&&(s._alphaFresnel=s._checkComponent("Fresnel",r.alphaFresnel)),r.reflectivityFresnel&&(s._reflectivityFresnel=s._checkComponent("Fresnel",r.reflectivityFresnel)),s.alphaMode=r.alphaMode,s.alphaCutoff=r.alphaCutoff,s.backfaces=r.backfaces,s.frontface=r.frontface,s._makeHash(),s}return I(i,[{key:"type",get:function(){return"PhongMaterial"}},{key:"_makeHash",value:function(){var e=this._state,t=["/p"];this._normalMap&&(t.push("/nm"),this._normalMap.hasMatrix&&t.push("/mat")),this._ambientMap&&(t.push("/am"),this._ambientMap.hasMatrix&&t.push("/mat"),t.push("/"+this._ambientMap.encoding)),this._diffuseMap&&(t.push("/dm"),this._diffuseMap.hasMatrix&&t.push("/mat"),t.push("/"+this._diffuseMap.encoding)),this._specularMap&&(t.push("/sm"),this._specularMap.hasMatrix&&t.push("/mat")),this._emissiveMap&&(t.push("/em"),this._emissiveMap.hasMatrix&&t.push("/mat"),t.push("/"+this._emissiveMap.encoding)),this._alphaMap&&(t.push("/opm"),this._alphaMap.hasMatrix&&t.push("/mat")),this._reflectivityMap&&(t.push("/rm"),this._reflectivityMap.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap.hasMatrix&&t.push("/mat")),this._diffuseFresnel&&t.push("/df"),this._specularFresnel&&t.push("/sf"),this._emissiveFresnel&&t.push("/ef"),this._alphaFresnel&&t.push("/of"),this._reflectivityFresnel&&t.push("/rf"),t.push(";"),e.hash=t.join("")}},{key:"ambient",get:function(){return this._state.ambient},set:function(e){var t=this._state.ambient;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.ambient=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}},{key:"diffuse",get:function(){return this._state.diffuse},set:function(e){var t=this._state.diffuse;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.diffuse=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}},{key:"specular",get:function(){return this._state.specular},set:function(e){var t=this._state.specular;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.specular=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}},{key:"emissive",get:function(){return this._state.emissive},set:function(e){var t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}},{key:"alpha",get:function(){return this._state.alpha},set:function(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}},{key:"shininess",get:function(){return this._state.shininess},set:function(e){this._state.shininess=void 0!==e?e:80,this.glRedraw()}},{key:"lineWidth",get:function(){return this._state.lineWidth},set:function(e){this._state.lineWidth=e||1,this.glRedraw()}},{key:"pointSize",get:function(){return this._state.pointSize},set:function(e){this._state.pointSize=e||1,this.glRedraw()}},{key:"reflectivity",get:function(){return this._state.reflectivity},set:function(e){this._state.reflectivity=void 0!==e?e:1,this.glRedraw()}},{key:"normalMap",get:function(){return this._normalMap}},{key:"ambientMap",get:function(){return this._ambientMap}},{key:"diffuseMap",get:function(){return this._diffuseMap}},{key:"specularMap",get:function(){return this._specularMap}},{key:"emissiveMap",get:function(){return this._emissiveMap}},{key:"alphaMap",get:function(){return this._alphaMap}},{key:"reflectivityMap",get:function(){return this._reflectivityMap}},{key:"occlusionMap",get:function(){return this._occlusionMap}},{key:"diffuseFresnel",get:function(){return this._diffuseFresnel}},{key:"specularFresnel",get:function(){return this._specularFresnel}},{key:"emissiveFresnel",get:function(){return this._emissiveFresnel}},{key:"alphaFresnel",get:function(){return this._alphaFresnel}},{key:"reflectivityFresnel",get:function(){return this._reflectivityFresnel}},{key:"alphaMode",get:function(){return Pr[this._state.alphaMode]},set:function(e){var t=xr[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" - defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}},{key:"alphaCutoff",get:function(){return this._state.alphaCutoff},set:function(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}},{key:"backfaces",get:function(){return this._state.backfaces},set:function(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}},{key:"frontface",get:function(){return this._state.frontface?"ccw":"cw"},set:function(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy()}}]),i}(),wr={default:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1},defaultWhiteBG:{fill:!0,fillColor:[1,1,1],fillAlpha:.6,edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultLightBG:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1},defaultDarkBG:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.5,.5,.5],edgeAlpha:.5,edgeWidth:1},phosphorous:{fill:!0,fillColor:[0,0,0],fillAlpha:.4,edges:!0,edgeColor:[.9,.9,.9],edgeAlpha:.5,edgeWidth:2},sunset:{fill:!0,fillColor:[.9,.9,.6],fillAlpha:.2,edges:!0,edgeColor:[.9,.9,.9],edgeAlpha:.5,edgeWidth:1},vectorscope:{fill:!0,fillColor:[0,0,0],fillAlpha:.7,edges:!0,edgeColor:[.2,1,.2],edgeAlpha:1,edgeWidth:2},battlezone:{fill:!0,fillColor:[0,0,0],fillAlpha:1,edges:!0,edgeColor:[.2,1,.2],edgeAlpha:1,edgeWidth:3},sepia:{fill:!0,fillColor:[.970588207244873,.7965892553329468,.6660899519920349],fillAlpha:.4,edges:!0,edgeColor:[.529411792755127,.4577854573726654,.4100345969200134],edgeAlpha:1,edgeWidth:1},yellowHighlight:{fill:!0,fillColor:[1,1,0],fillAlpha:.5,edges:!0,edgeColor:[.529411792755127,.4577854573726654,.4100345969200134],edgeAlpha:1,edgeWidth:1},greenSelected:{fill:!0,fillColor:[0,1,0],fillAlpha:.5,edges:!0,edgeColor:[.4577854573726654,.529411792755127,.4100345969200134],edgeAlpha:1,edgeWidth:1},gamegrid:{fill:!0,fillColor:[.2,.2,.7],fillAlpha:.9,edges:!0,edgeColor:[.4,.4,1.6],edgeAlpha:.8,edgeWidth:3}},Mr=function(e){g(i,br);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._state=new ti({type:"EmphasisMaterial",fill:null,fillColor:null,fillAlpha:null,edges:null,edgeColor:null,edgeAlpha:null,edgeWidth:null,backfaces:!0,glowThrough:!0}),s._preset="default",r.preset?(s.preset=r.preset,void 0!==r.fill&&(s.fill=r.fill),r.fillColor&&(s.fillColor=r.fillColor),void 0!==r.fillAlpha&&(s.fillAlpha=r.fillAlpha),void 0!==r.edges&&(s.edges=r.edges),r.edgeColor&&(s.edgeColor=r.edgeColor),void 0!==r.edgeAlpha&&(s.edgeAlpha=r.edgeAlpha),void 0!==r.edgeWidth&&(s.edgeWidth=r.edgeWidth),void 0!==r.backfaces&&(s.backfaces=r.backfaces),void 0!==r.glowThrough&&(s.glowThrough=r.glowThrough)):(s.fill=r.fill,s.fillColor=r.fillColor,s.fillAlpha=r.fillAlpha,s.edges=r.edges,s.edgeColor=r.edgeColor,s.edgeAlpha=r.edgeAlpha,s.edgeWidth=r.edgeWidth,s.backfaces=r.backfaces,s.glowThrough=r.glowThrough),s}return I(i,[{key:"type",get:function(){return"EmphasisMaterial"}},{key:"presets",get:function(){return wr}},{key:"fill",get:function(){return this._state.fill},set:function(e){e=!1!==e,this._state.fill!==e&&(this._state.fill=e,this.glRedraw())}},{key:"fillColor",get:function(){return this._state.fillColor},set:function(e){var t=this._state.fillColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.fillColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.4,t[1]=.4,t[2]=.4),this.glRedraw()}},{key:"fillAlpha",get:function(){return this._state.fillAlpha},set:function(e){e=null!=e?e:.2,this._state.fillAlpha!==e&&(this._state.fillAlpha=e,this.glRedraw())}},{key:"edges",get:function(){return this._state.edges},set:function(e){e=!1!==e,this._state.edges!==e&&(this._state.edges=e,this.glRedraw())}},{key:"edgeColor",get:function(){return this._state.edgeColor},set:function(e){var t=this._state.edgeColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.edgeColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}},{key:"edgeAlpha",get:function(){return this._state.edgeAlpha},set:function(e){e=null!=e?e:.5,this._state.edgeAlpha!==e&&(this._state.edgeAlpha=e,this.glRedraw())}},{key:"edgeWidth",get:function(){return this._state.edgeWidth},set:function(e){this._state.edgeWidth=e||1,this.glRedraw()}},{key:"backfaces",get:function(){return this._state.backfaces},set:function(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}},{key:"glowThrough",get:function(){return this._state.glowThrough},set:function(e){e=!1!==e,this._state.glowThrough!==e&&(this._state.glowThrough=e,this.glRedraw())}},{key:"preset",get:function(){return this._preset},set:function(e){if(e=e||"default",this._preset!==e){var t=wr[e];t?(this.fill=t.fill,this.fillColor=t.fillColor,this.fillAlpha=t.fillAlpha,this.edges=t.edges,this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth,this.glowThrough=t.glowThrough,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(wr).join(", "))}}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy()}}]),i}(),Ir={default:{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1},defaultWhiteBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultLightBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultDarkBG:{edgeColor:[.5,.5,.5],edgeAlpha:1,edgeWidth:1}},Cr=function(e){g(i,br);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._state=new ti({type:"EdgeMaterial",edges:null,edgeColor:null,edgeAlpha:null,edgeWidth:null}),s._preset="default",r.preset?(s.preset=r.preset,r.edgeColor&&(s.edgeColor=r.edgeColor),void 0!==r.edgeAlpha&&(s.edgeAlpha=r.edgeAlpha),void 0!==r.edgeWidth&&(s.edgeWidth=r.edgeWidth)):(s.edgeColor=r.edgeColor,s.edgeAlpha=r.edgeAlpha,s.edgeWidth=r.edgeWidth),s.edges=!1!==r.edges,s}return I(i,[{key:"type",get:function(){return"EdgeMaterial"}},{key:"presets",get:function(){return Ir}},{key:"edges",get:function(){return this._state.edges},set:function(e){e=!1!==e,this._state.edges!==e&&(this._state.edges=e,this.glRedraw())}},{key:"edgeColor",get:function(){return this._state.edgeColor},set:function(e){var t=this._state.edgeColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.edgeColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}},{key:"edgeAlpha",get:function(){return this._state.edgeAlpha},set:function(e){e=null!=e?e:1,this._state.edgeAlpha!==e&&(this._state.edgeAlpha=e,this.glRedraw())}},{key:"edgeWidth",get:function(){return this._state.edgeWidth},set:function(e){this._state.edgeWidth=e||1,this.glRedraw()}},{key:"preset",get:function(){return this._preset},set:function(e){if(e=e||"default",this._preset!==e){var t=Ir[e];t?(this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(Ir).join(", "))}}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy()}}]),i}(),Dr={meters:{abbrev:"m"},metres:{abbrev:"m"},centimeters:{abbrev:"cm"},centimetres:{abbrev:"cm"},millimeters:{abbrev:"mm"},millimetres:{abbrev:"mm"},yards:{abbrev:"yd"},feet:{abbrev:"ft"},inches:{abbrev:"in"}},Ar=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._units="meters",s._scale=1,s._origin=q.vec3([0,0,0]),s.units=r.units,s.scale=r.scale,s.origin=r.origin,s}return I(i,[{key:"unitsInfo",get:function(){return Dr}},{key:"units",get:function(){return this._units},set:function(e){e||(e="meters"),Dr[e]||(this.error("Unsupported value for 'units': "+e+" defaulting to 'meters'"),e="meters"),this._units=e,this.fire("units",this._units)}},{key:"scale",get:function(){return this._scale},set:function(e){(e=e||1)<=0?this.error("scale value should be larger than zero"):(this._scale=e,this.fire("scale",this._scale))}},{key:"origin",get:function(){return this._origin},set:function(e){if(!e)return this._origin[0]=0,this._origin[1]=0,void(this._origin[2]=0);this._origin[0]=e[0],this._origin[1]=e[1],this._origin[2]=e[2],this.fire("origin",this._origin)}},{key:"worldToRealPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.vec3(3);t[0]=this._origin[0]+this._scale*e[0],t[1]=this._origin[1]+this._scale*e[1],t[2]=this._origin[2]+this._scale*e[2]}},{key:"realToWorldPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q.vec3(3);return t[0]=(e[0]-this._origin[0])/this._scale,t[1]=(e[1]-this._origin[1])/this._scale,t[2]=(e[2]-this._origin[2])/this._scale,t}}]),i}(),kr=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._supported=Ze.SUPPORTED_EXTENSIONS.OES_standard_derivatives,s.enabled=r.enabled,s.kernelRadius=r.kernelRadius,s.intensity=r.intensity,s.bias=r.bias,s.scale=r.scale,s.minResolution=r.minResolution,s.numSamples=r.numSamples,s.blur=r.blur,s.blendCutoff=r.blendCutoff,s.blendFactor=r.blendFactor,s}return I(i,[{key:"supported",get:function(){return this._supported}},{key:"enabled",get:function(){return this._enabled},set:function(e){e=!!e,this._enabled!==e&&(this._enabled=e,this.glRedraw())}},{key:"possible",get:function(){if(!this._supported)return!1;if(!this._enabled)return!1;var e=this.scene.camera.projection;return"customProjection"!==e&&"frustum"!==e}},{key:"active",get:function(){return this._active}},{key:"kernelRadius",get:function(){return this._kernelRadius},set:function(e){null==e&&(e=100),this._kernelRadius!==e&&(this._kernelRadius=e,this.glRedraw())}},{key:"intensity",get:function(){return this._intensity},set:function(e){null==e&&(e=.15),this._intensity!==e&&(this._intensity=e,this.glRedraw())}},{key:"bias",get:function(){return this._bias},set:function(e){null==e&&(e=.5),this._bias!==e&&(this._bias=e,this.glRedraw())}},{key:"scale",get:function(){return this._scale},set:function(e){null==e&&(e=1),this._scale!==e&&(this._scale=e,this.glRedraw())}},{key:"minResolution",get:function(){return this._minResolution},set:function(e){null==e&&(e=0),this._minResolution!==e&&(this._minResolution=e,this.glRedraw())}},{key:"numSamples",get:function(){return this._numSamples},set:function(e){null==e&&(e=10),this._numSamples!==e&&(this._numSamples=e,this.glRedraw())}},{key:"blur",get:function(){return this._blur},set:function(e){e=!1!==e,this._blur!==e&&(this._blur=e,this.glRedraw())}},{key:"blendCutoff",get:function(){return this._blendCutoff},set:function(e){null==e&&(e=.3),this._blendCutoff!==e&&(this._blendCutoff=e,this.glRedraw())}},{key:"blendFactor",get:function(){return this._blendFactor},set:function(e){null==e&&(e=1),this._blendFactor!==e&&(this._blendFactor=e,this.glRedraw())}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this)}}]),i}(),Er={default:{pointSize:4,roundPoints:!0,perspectivePoints:!0},square:{pointSize:4,roundPoints:!1,perspectivePoints:!0},round:{pointSize:4,roundPoints:!0,perspectivePoints:!0}},Fr=function(e){g(i,br);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._state=new ti({type:"PointsMaterial",pointSize:null,roundPoints:null,perspectivePoints:null,minPerspectivePointSize:null,maxPerspectivePointSize:null,filterIntensity:null,minIntensity:null,maxIntensity:null}),r.preset?(s.preset=r.preset,void 0!==r.pointSize&&(s.pointSize=r.pointSize),void 0!==r.roundPoints&&(s.roundPoints=r.roundPoints),void 0!==r.perspectivePoints&&(s.perspectivePoints=r.perspectivePoints),void 0!==r.minPerspectivePointSize&&(s.minPerspectivePointSize=r.minPerspectivePointSize),void 0!==r.maxPerspectivePointSize&&(s.maxPerspectivePointSize=r.minPerspectivePointSize)):(s._preset="default",s.pointSize=r.pointSize,s.roundPoints=r.roundPoints,s.perspectivePoints=r.perspectivePoints,s.minPerspectivePointSize=r.minPerspectivePointSize,s.maxPerspectivePointSize=r.maxPerspectivePointSize),s.filterIntensity=r.filterIntensity,s.minIntensity=r.minIntensity,s.maxIntensity=r.maxIntensity,s}return I(i,[{key:"type",get:function(){return"PointsMaterial"}},{key:"presets",get:function(){return Er}},{key:"pointSize",get:function(){return this._state.pointSize},set:function(e){this._state.pointSize=e||2,this.glRedraw()}},{key:"roundPoints",get:function(){return this._state.roundPoints},set:function(e){e=!1!==e,this._state.roundPoints!==e&&(this._state.roundPoints=e,this.scene._needRecompile=!0,this.glRedraw())}},{key:"perspectivePoints",get:function(){return this._state.perspectivePoints},set:function(e){e=!1!==e,this._state.perspectivePoints!==e&&(this._state.perspectivePoints=e,this.scene._needRecompile=!0,this.glRedraw())}},{key:"minPerspectivePointSize",get:function(){return this._state.minPerspectivePointSize},set:function(e){this._state.minPerspectivePointSize=e||1,this.scene._needRecompile=!0,this.glRedraw()}},{key:"maxPerspectivePointSize",get:function(){return this._state.maxPerspectivePointSize},set:function(e){this._state.maxPerspectivePointSize=e||6,this.scene._needRecompile=!0,this.glRedraw()}},{key:"filterIntensity",get:function(){return this._state.filterIntensity},set:function(e){e=!1!==e,this._state.filterIntensity!==e&&(this._state.filterIntensity=e,this.scene._needRecompile=!0,this.glRedraw())}},{key:"minIntensity",get:function(){return this._state.minIntensity},set:function(e){this._state.minIntensity=null!=e?e:0,this.glRedraw()}},{key:"maxIntensity",get:function(){return this._state.maxIntensity},set:function(e){this._state.maxIntensity=null!=e?e:1,this.glRedraw()}},{key:"preset",get:function(){return this._preset},set:function(e){if(e=e||"default",this._preset!==e){var t=Er[e];t?(this.pointSize=t.pointSize,this.roundPoints=t.roundPoints,this.perspectivePoints=t.perspectivePoints,this.minPerspectivePointSize=t.minPerspectivePointSize,this.maxPerspectivePointSize=t.maxPerspectivePointSize,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(Er).join(", "))}}},{key:"hash",get:function(){return[this.pointSize,this.roundPoints,this.perspectivePoints,this.minPerspectivePointSize,this.maxPerspectivePointSize,this.filterIntensity].join(";")}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy()}}]),i}(),Rr={default:{lineWidth:1},thick:{lineWidth:2},thicker:{lineWidth:4}},Sr=function(e){g(i,br);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._state=new ti({type:"LinesMaterial",lineWidth:null}),r.preset?(s.preset=r.preset,void 0!==r.lineWidth&&(s.lineWidth=r.lineWidth)):(s._preset="default",s.lineWidth=r.lineWidth),s}return I(i,[{key:"type",get:function(){return"LinesMaterial"}},{key:"presets",get:function(){return Rr}},{key:"lineWidth",get:function(){return this._state.lineWidth},set:function(e){this._state.lineWidth=e||1,this.glRedraw()}},{key:"preset",get:function(){return this._preset},set:function(e){if(e=e||"default",this._preset!==e){var t=Rr[e];t?(this.lineWidth=t.lineWidth,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(Rr).join(", "))}}},{key:"hash",get:function(){return[""+this.lineWidth].join(";")}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy()}}]),i}();function Or(e,t){for(var i,s,r={},n=0,o=t.length;n<o;n++)i=t[n],(s=e.component[i])?s.isEntity?r[i]=!0:e.warn("pick(): Component is not an Entity: "+i):e.warn("pick(): Component not found: "+i);return r}var Br=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,i),s=t.call(this,null,r);var n=r.canvasElement||document.getElementById(r.canvasId);if(!(n instanceof HTMLCanvasElement))throw"Mandatory config expected: valid canvasId or canvasElement";var o=!!r.transparent,a=!!r.alphaDepthMask;return s._aabbDirty=!0,s.viewer=e,s.occlusionTestCountdown=0,s.loading=0,s.startTime=(new Date).getTime(),s.models={},s.objects={},s._numObjects=0,s.visibleObjects={},s._numVisibleObjects=0,s.xrayedObjects={},s._numXRayedObjects=0,s.highlightedObjects={},s._numHighlightedObjects=0,s.selectedObjects={},s._numSelectedObjects=0,s.colorizedObjects={},s._numColorizedObjects=0,s.opacityObjects={},s._numOpacityObjects=0,s.offsetObjects={},s._numOffsetObjects=0,s._modelIds=null,s._objectIds=null,s._visibleObjectIds=null,s._xrayedObjectIds=null,s._highlightedObjectIds=null,s._selectedObjectIds=null,s._colorizedObjectIds=null,s._opacityObjectIds=null,s._offsetObjectIds=null,s._collidables={},s._compilables={},s._needRecompile=!1,s.types={},s.components={},s.sectionPlanes={},s.lights={},s.lightMaps={},s.reflectionMaps={},s.bitmaps={},s.lineSets={},s.realWorldOffset=r.realWorldOffset||new Float64Array([0,0,0]),s.canvas=new et(x(s),{dontClear:!0,canvas:n,spinnerElementId:r.spinnerElementId,transparent:o,webgl2:!1!==r.webgl2,contextAttr:r.contextAttr||{},backgroundColor:r.backgroundColor,backgroundColorFromAmbientLight:r.backgroundColorFromAmbientLight,premultipliedAlpha:r.premultipliedAlpha}),s.canvas.on("boundary",(function(){s.glRedraw()})),s.canvas.on("webglContextFailed",(function(){alert("xeokit failed to find WebGL!")})),s._renderer=new hr(x(s),{transparent:o,alphaDepthMask:a}),s._sectionPlanesState=new function(){this.sectionPlanes=[],this.clippingCaps=!1;var e=null;this.getHash=function(){if(e)return e;var t=this.sectionPlanes;if(0===t.length)return this.hash=";";for(var i=[],s=0,r=t.length;s<r;s++)i.push("cp");return i.push(";"),e=i.join("")},this.addSectionPlane=function(t){this.sectionPlanes.push(t),e=null},this.removeSectionPlane=function(t){for(var i=0,s=this.sectionPlanes.length;i<s;i++)if(this.sectionPlanes[i].id===t.id)return this.sectionPlanes.splice(i,1),void(e=null)}},s._lightsState=new function(){var e=q.vec4([0,0,0,0]),t=q.vec4();this.lights=[],this.reflectionMaps=[],this.lightMaps=[];var i=null,s=null;this.getHash=function(){if(i)return i;for(var e,t=[],s=this.lights,r=0,n=s.length;r<n;r++)e=s[r],t.push("/"),t.push(e.type),t.push("world"===e.space?"w":"v"),e.castsShadow&&t.push("sh");return this.lightMaps.length>0&&t.push("/lm"),this.reflectionMaps.length>0&&t.push("/rm"),t.push(";"),i=t.join("")},this.addLight=function(e){this.lights.push(e),s=null,i=null},this.removeLight=function(e){for(var t=0,r=this.lights.length;t<r;t++){if(this.lights[t].id===e.id)return this.lights.splice(t,1),s&&s.id===e.id&&(s=null),void(i=null)}},this.addReflectionMap=function(e){this.reflectionMaps.push(e),i=null},this.removeReflectionMap=function(e){for(var t=0,s=this.reflectionMaps.length;t<s;t++)if(this.reflectionMaps[t].id===e.id)return this.reflectionMaps.splice(t,1),void(i=null)},this.addLightMap=function(e){this.lightMaps.push(e),i=null},this.removeLightMap=function(e){for(var t=0,s=this.lightMaps.length;t<s;t++)if(this.lightMaps[t].id===e.id)return this.lightMaps.splice(t,1),void(i=null)},this.getAmbientColorAndIntensity=function(){if(!s)for(var i=0,r=this.lights.length;i<r;i++){var n=this.lights[i];if("ambient"===n.type){s=n;break}}if(s){var o=s.color,a=s.intensity;return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=a,t}return e}},s.input=new lr(x(s),{dontClear:!0,element:s.canvas.canvas,keyboardEventsElement:r.keyboardEventsElement}),s.metrics=new Ar(x(s),{units:r.units,scale:r.scale,origin:r.origin}),s.sao=new kr(x(s),{enabled:r.saoEnabled}),s.ticksPerRender=r.ticksPerRender,s.ticksPerOcclusionTest=r.ticksPerOcclusionTest,s.passes=r.passes,s.clearEachPass=r.clearEachPass,s.gammaInput=r.gammaInput,s.gammaOutput=r.gammaOutput,s.gammaFactor=r.gammaFactor,s._entityOffsetsEnabled=!!r.entityOffsetsEnabled,s._pickSurfacePrecisionEnabled=!!r.pickSurfacePrecisionEnabled,s._logarithmicDepthBufferEnabled=!!r.logarithmicDepthBufferEnabled,s._pbrEnabled=!!r.pbrEnabled,s._colorTextureEnabled=!1!==r.colorTextureEnabled,pe._addScene(x(s)),s._initDefaults(),s._viewport=new cr(x(s),{id:"default.viewport",autoBoundary:!0,dontClear:!0}),s._camera=new Mi(x(s),{id:"default.camera",dontClear:!0}),new fr(x(s),{color:[1,1,1],intensity:.7}),new dr(x(s),{dir:[.8,-.5,-.5],color:[.67,.67,1],intensity:.7,space:"world"}),new dr(x(s),{dir:[-.8,-1,.5],color:[1,1,.9],intensity:.9,space:"world"}),s._camera.on("dirty",(function(){s._renderer.imageDirty()})),s}return I(i,[{key:"type",get:function(){return"Scene"}},{key:"_initDefaults",value:function(){}},{key:"_addComponent",value:function(e){if(e.id&&this.components[e.id]&&(this.error("Component "+re.inQuotes(e.id)+" already exists in Scene - ignoring ID, will randomly-generate instead"),e.id=null),!e.id)for(void 0===window.nextID&&(window.nextID=0),e.id="__"+window.nextID++;this.components[e.id];)e.id=q.createUUID();this.components[e.id]=e;var t=e.type,i=this.types[e.type];i||(i=this.types[t]={}),i[e.id]=e,e.compile&&(this._compilables[e.id]=e),e.isDrawable&&(this._renderer.addDrawable(e.id,e),this._collidables[e.id]=e)}},{key:"_removeComponent",value:function(e){var t=e.id,i=e.type;delete this.components[t];var s=this.types[i];s&&(delete s[t],re.isEmptyObject(s)&&delete this.types[i]),e.compile&&delete this._compilables[e.id],e.isDrawable&&(this._renderer.removeDrawable(e.id),delete this._collidables[e.id])}},{key:"_sectionPlaneCreated",value:function(e){this.sectionPlanes[e.id]=e,this.scene._sectionPlanesState.addSectionPlane(e._state),this.scene.fire("sectionPlaneCreated",e,!0),this._needRecompile=!0}},{key:"_bitmapCreated",value:function(e){this.bitmaps[e.id]=e,this.scene.fire("bitmapCreated",e,!0)}},{key:"_lineSetCreated",value:function(e){this.lineSets[e.id]=e,this.scene.fire("lineSetCreated",e,!0)}},{key:"_lightCreated",value:function(e){this.lights[e.id]=e,this.scene._lightsState.addLight(e._state),this._needRecompile=!0}},{key:"_lightMapCreated",value:function(e){this.lightMaps[e.id]=e,this.scene._lightsState.addLightMap(e._state),this._needRecompile=!0}},{key:"_reflectionMapCreated",value:function(e){this.reflectionMaps[e.id]=e,this.scene._lightsState.addReflectionMap(e._state),this._needRecompile=!0}},{key:"_sectionPlaneDestroyed",value:function(e){delete this.sectionPlanes[e.id],this.scene._sectionPlanesState.removeSectionPlane(e._state),this.scene.fire("sectionPlaneDestroyed",e,!0),this._needRecompile=!0}},{key:"_bitmapDestroyed",value:function(e){delete this.bitmaps[e.id],this.scene.fire("bitmapDestroyed",e,!0)}},{key:"_lineSetDestroyed",value:function(e){delete this.lineSets[e.id],this.scene.fire("lineSetDestroyed",e,!0)}},{key:"_lightDestroyed",value:function(e){delete this.lights[e.id],this.scene._lightsState.removeLight(e._state),this._needRecompile=!0}},{key:"_lightMapDestroyed",value:function(e){delete this.lightMaps[e.id],this.scene._lightsState.removeLightMap(e._state),this._needRecompile=!0}},{key:"_reflectionMapDestroyed",value:function(e){delete this.reflectionMaps[e.id],this.scene._lightsState.removeReflectionMap(e._state),this._needRecompile=!0}},{key:"_registerModel",value:function(e){this.models[e.id]=e,this._modelIds=null}},{key:"_deregisterModel",value:function(e){var t=e.id;delete this.models[t],this._modelIds=null,this.fire("modelUnloaded",t)}},{key:"_registerObject",value:function(e){this.objects[e.id]=e,this._numObjects++,this._objectIds=null}},{key:"_deregisterObject",value:function(e){delete this.objects[e.id],this._numObjects--,this._objectIds=null}},{key:"_objectVisibilityUpdated",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.visible?(this.visibleObjects[e.id]=e,this._numVisibleObjects++):(delete this.visibleObjects[e.id],this._numVisibleObjects--),this._visibleObjectIds=null,t&&this.fire("objectVisibility",e,!0)}},{key:"_objectXRayedUpdated",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.xrayed?(this.xrayedObjects[e.id]=e,this._numXRayedObjects++):(delete this.xrayedObjects[e.id],this._numXRayedObjects--),this._xrayedObjectIds=null,t&&this.fire("objectXRayed",e,!0)}},{key:"_objectHighlightedUpdated",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.highlighted?(this.highlightedObjects[e.id]=e,this._numHighlightedObjects++):(delete this.highlightedObjects[e.id],this._numHighlightedObjects--),this._highlightedObjectIds=null,t&&this.fire("objectHighlighted",e,!0)}},{key:"_objectSelectedUpdated",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.selected?(this.selectedObjects[e.id]=e,this._numSelectedObjects++):(delete this.selectedObjects[e.id],this._numSelectedObjects--),this._selectedObjectIds=null,t&&this.fire("objectSelected",e,!0)}},{key:"_objectColorizeUpdated",value:function(e,t){t?(this.colorizedObjects[e.id]=e,this._numColorizedObjects++):(delete this.colorizedObjects[e.id],this._numColorizedObjects--),this._colorizedObjectIds=null}},{key:"_objectOpacityUpdated",value:function(e,t){t?(this.opacityObjects[e.id]=e,this._numOpacityObjects++):(delete this.opacityObjects[e.id],this._numOpacityObjects--),this._opacityObjectIds=null}},{key:"_objectOffsetUpdated",value:function(e,t){!t||0===t[0]&&0===t[1]&&0===t[2]?(this.offsetObjects[e.id]=e,this._numOffsetObjects++):(delete this.offsetObjects[e.id],this._numOffsetObjects--),this._offsetObjectIds=null}},{key:"_webglContextLost",value:function(){for(var e in this.canvas.spinner.processes++,this.components)if(this.components.hasOwnProperty(e)){var t=this.components[e];t._webglContextLost&&t._webglContextLost()}this._renderer.webglContextLost()}},{key:"_webglContextRestored",value:function(){var e=this.canvas.gl;for(var t in this.components)if(this.components.hasOwnProperty(t)){var i=this.components[t];i._webglContextRestored&&i._webglContextRestored(e)}this._renderer.webglContextRestored(e),this.canvas.spinner.processes--}},{key:"capabilities",get:function(){return this._renderer.capabilities}},{key:"entityOffsetsEnabled",get:function(){return this._entityOffsetsEnabled}},{key:"pickSurfacePrecisionEnabled",get:function(){return this._pickSurfacePrecisionEnabled}},{key:"logarithmicDepthBufferEnabled",get:function(){return this._logarithmicDepthBufferEnabled}},{key:"pbrEnabled",get:function(){return this._pbrEnabled},set:function(e){this._pbrEnabled=!!e,this.glRedraw()}},{key:"colorTextureEnabled",get:function(){return this._colorTextureEnabled},set:function(e){this._colorTextureEnabled=!!e,this.glRedraw()}},{key:"doOcclusionTest",value:function(){this._needRecompile&&(this._recompile(),this._needRecompile=!1),this._renderer.doOcclusionTest()}},{key:"render",value:function(e){e&&pe.runTasks();var t={sceneId:null,pass:0};if(this._needRecompile&&(this._recompile(),this._renderer.imageDirty(),this._needRecompile=!1),e||this._renderer.needsRender()){t.sceneId=this.id;var i,s,r=this._passes,n=this._clearEachPass;for(i=0;i<r;i++)t.pass=i,this.fire("rendering",t,!0),s=n||0===i,this._renderer.render({pass:i,clear:s,force:e}),this.fire("rendered",t,!0);this._saveAmbientColor()}}},{key:"_recompile",value:function(){for(var e in this._compilables)this._compilables.hasOwnProperty(e)&&this._compilables[e].compile();this._renderer.shadowsDirty(),this.fire("compile",this,!0)}},{key:"_saveAmbientColor",value:function(){var e=this.canvas;if(e.transparent||e.backgroundImage||e.backgroundColor)this._lastAmbientColor=null;else{var t=this._lightsState.getAmbientColorAndIntensity();this._lastAmbientColor&&this._lastAmbientColor[0]===t[0]&&this._lastAmbientColor[1]===t[1]&&this._lastAmbientColor[2]===t[2]&&this._lastAmbientColor[3]===t[3]||(e.backgroundColor=t,this._lastAmbientColor||(this._lastAmbientColor=q.vec4([0,0,0,1])),this._lastAmbientColor.set(t))}}},{key:"modelIds",get:function(){return this._modelIds||(this._modelIds=Object.keys(this.models)),this._modelIds}},{key:"numObjects",get:function(){return this._numObjects}},{key:"objectIds",get:function(){return this._objectIds||(this._objectIds=Object.keys(this.objects)),this._objectIds}},{key:"numVisibleObjects",get:function(){return this._numVisibleObjects}},{key:"visibleObjectIds",get:function(){return this._visibleObjectIds||(this._visibleObjectIds=Object.keys(this.visibleObjects)),this._visibleObjectIds}},{key:"numXRayedObjects",get:function(){return this._numXRayedObjects}},{key:"xrayedObjectIds",get:function(){return this._xrayedObjectIds||(this._xrayedObjectIds=Object.keys(this.xrayedObjects)),this._xrayedObjectIds}},{key:"numHighlightedObjects",get:function(){return this._numHighlightedObjects}},{key:"highlightedObjectIds",get:function(){return this._highlightedObjectIds||(this._highlightedObjectIds=Object.keys(this.highlightedObjects)),this._highlightedObjectIds}},{key:"numSelectedObjects",get:function(){return this._numSelectedObjects}},{key:"selectedObjectIds",get:function(){return this._selectedObjectIds||(this._selectedObjectIds=Object.keys(this.selectedObjects)),this._selectedObjectIds}},{key:"numColorizedObjects",get:function(){return this._numColorizedObjects}},{key:"colorizedObjectIds",get:function(){return this._colorizedObjectIds||(this._colorizedObjectIds=Object.keys(this.colorizedObjects)),this._colorizedObjectIds}},{key:"opacityObjectIds",get:function(){return this._opacityObjectIds||(this._opacityObjectIds=Object.keys(this.opacityObjects)),this._opacityObjectIds}},{key:"offsetObjectIds",get:function(){return this._offsetObjectIds||(this._offsetObjectIds=Object.keys(this.offsetObjects)),this._offsetObjectIds}},{key:"ticksPerRender",get:function(){return this._ticksPerRender},set:function(e){null==e?e=1:(!re.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'ticksPerRender': '"+e+"' - should be an integer greater than zero."),e=1),e!==this._ticksPerRender&&(this._ticksPerRender=e)}},{key:"ticksPerOcclusionTest",get:function(){return this._ticksPerOcclusionTest},set:function(e){null==e?e=20:(!re.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'ticksPerOcclusionTest': '"+e+"' - should be an integer greater than zero."),e=20),e!==this._ticksPerOcclusionTest&&(this._ticksPerOcclusionTest=e)}},{key:"passes",get:function(){return this._passes},set:function(e){null==e?e=1:(!re.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'passes': '"+e+"' - should be an integer greater than zero."),e=1),e!==this._passes&&(this._passes=e,this.glRedraw())}},{key:"clearEachPass",get:function(){return this._clearEachPass},set:function(e){(e=!!e)!==this._clearEachPass&&(this._clearEachPass=e,this.glRedraw())}},{key:"gammaInput",get:function(){return this._renderer.gammaInput},set:function(e){(e=!1!==e)!==this._renderer.gammaInput&&(this._renderer.gammaInput=e,this._needRecompile=!0,this.glRedraw())}},{key:"gammaOutput",get:function(){return this._renderer.gammaOutput},set:function(e){(e=!!e)!==this._renderer.gammaOutput&&(this._renderer.gammaOutput=e,this._needRecompile=!0,this.glRedraw())}},{key:"gammaFactor",get:function(){return this._renderer.gammaFactor},set:function(e){(e=null==e?2.2:e)!==this._renderer.gammaFactor&&(this._renderer.gammaFactor=e,this.glRedraw())}},{key:"geometry",get:function(){return this.components["default.geometry"]||yr(_r)}},{key:"material",get:function(){return this.components["default.material"]||new Tr(this,{id:"default.material",emissive:[.4,.4,.4],dontClear:!0})}},{key:"xrayMaterial",get:function(){return this.components["default.xrayMaterial"]||new Mr(this,{id:"default.xrayMaterial",preset:"sepia",dontClear:!0})}},{key:"highlightMaterial",get:function(){return this.components["default.highlightMaterial"]||new Mr(this,{id:"default.highlightMaterial",preset:"yellowHighlight",dontClear:!0})}},{key:"selectedMaterial",get:function(){return this.components["default.selectedMaterial"]||new Mr(this,{id:"default.selectedMaterial",preset:"greenSelected",dontClear:!0})}},{key:"edgeMaterial",get:function(){return this.components["default.edgeMaterial"]||new Cr(this,{id:"default.edgeMaterial",preset:"default",edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1,dontClear:!0})}},{key:"pointsMaterial",get:function(){return this.components["default.pointsMaterial"]||new Fr(this,{id:"default.pointsMaterial",preset:"default",dontClear:!0})}},{key:"linesMaterial",get:function(){return this.components["default.linesMaterial"]||new Sr(this,{id:"default.linesMaterial",preset:"default",dontClear:!0})}},{key:"viewport",get:function(){return this._viewport}},{key:"camera",get:function(){return this._camera}},{key:"center",get:function(){if(this._aabbDirty||!this._center){this._center&&this._center||(this._center=q.vec3());var e=this.aabb;this._center[0]=(e[0]+e[3])/2,this._center[1]=(e[1]+e[4])/2,this._center[2]=(e[2]+e[5])/2}return this._center}},{key:"aabb",get:function(){if(this._aabbDirty){this._aabb||(this._aabb=q.AABB3());var e,t,i=q.MAX_DOUBLE,s=q.MAX_DOUBLE,r=q.MAX_DOUBLE,n=q.MIN_DOUBLE,o=q.MIN_DOUBLE,a=q.MIN_DOUBLE,u=this._collidables,h=!1;for(var l in u)if(u.hasOwnProperty(l)){if(!1===(t=u[l]).collidable)continue;(e=t.aabb)[0]<i&&(i=e[0]),e[1]<s&&(s=e[1]),e[2]<r&&(r=e[2]),e[3]>n&&(n=e[3]),e[4]>o&&(o=e[4]),e[5]>a&&(a=e[5]),h=!0}h||(i=-100,s=-100,r=-100,n=100,o=100,a=100),this._aabb[0]=i,this._aabb[1]=s,this._aabb[2]=r,this._aabb[3]=n,this._aabb[4]=o,this._aabb[5]=a,this._aabbDirty=!1}return this._aabb}},{key:"_setAABBDirty",value:function(){this._aabbDirty=!0,this.fire("boundary")}},{key:"pick",value:function(e,t){if(0===this.canvas.boundary[2]||0===this.canvas.boundary[3])return this.error("Picking not allowed while canvas has zero width or height"),null;(e=e||{}).pickSurface=e.pickSurface||e.rayPick,e.canvasPos||e.matrix||e.origin&&e.direction||this.warn("picking without canvasPos, matrix, or ray origin and direction");var i=e.includeEntities||e.include;i&&(e.includeEntityIds=Or(this,i));var s=e.excludeEntities||e.exclude;return s&&(e.excludeEntityIds=Or(this,s)),this._needRecompile&&(this._recompile(),this._renderer.imageDirty(),this._needRecompile=!1),(t=this._renderer.pick(e,t))?(t.entity&&t.entity.fire&&t.entity.fire("picked",t),t):void 0}},{key:"clear",value:function(){var e;for(var t in this.components)this.components.hasOwnProperty(t)&&((e=this.components[t])._dontClear||e.destroy())}},{key:"clearLights",value:function(){for(var e=Object.keys(this.lights),t=0,i=e.length;t<i;t++)this.lights[e[t]].destroy()}},{key:"clearSectionPlanes",value:function(){for(var e=Object.keys(this.sectionPlanes),t=0,i=e.length;t<i;t++)this.sectionPlanes[e[t]].destroy()}},{key:"clearBitmaps",value:function(){for(var e=Object.keys(this.bitmaps),t=0,i=e.length;t<i;t++)this.bitmaps[e[t]].destroy()}},{key:"clearLines",value:function(){for(var e=Object.keys(this.lineSets),t=0,i=e.length;t<i;t++)this.lineSets[e[t]].destroy()}},{key:"getAABB",value:function(e){if(void 0===e)return this.aabb;if(re.isString(e)){var t=this.objects[e];if(t&&t.aabb)return t.aabb;e=[e]}if(0===e.length)return this.aabb;var i,s=q.MAX_DOUBLE,r=q.MAX_DOUBLE,n=q.MAX_DOUBLE,o=q.MIN_DOUBLE,a=q.MIN_DOUBLE,u=q.MIN_DOUBLE;if(this.withObjects(e,(function(e){if(e.collidable){var t=e.aabb;t[0]<s&&(s=t[0]),t[1]<r&&(r=t[1]),t[2]<n&&(n=t[2]),t[3]>o&&(o=t[3]),t[4]>a&&(a=t[4]),t[5]>u&&(u=t[5]),i=!0}})),i){var h=q.AABB3();return h[0]=s,h[1]=r,h[2]=n,h[3]=o,h[4]=a,h[5]=u,h}return this.aabb}},{key:"setObjectsVisible",value:function(e,t){return this.withObjects(e,(function(e){var i=e.visible!==t;return e.visible=t,i}))}},{key:"setObjectsCollidable",value:function(e,t){return this.withObjects(e,(function(e){var i=e.collidable!==t;return e.collidable=t,i}))}},{key:"setObjectsCulled",value:function(e,t){return this.withObjects(e,(function(e){var i=e.culled!==t;return e.culled=t,i}))}},{key:"setObjectsSelected",value:function(e,t){return this.withObjects(e,(function(e){var i=e.selected!==t;return e.selected=t,i}))}},{key:"setObjectsHighlighted",value:function(e,t){return this.withObjects(e,(function(e){var i=e.highlighted!==t;return e.highlighted=t,i}))}},{key:"setObjectsXRayed",value:function(e,t){return this.withObjects(e,(function(e){var i=e.xrayed!==t;return e.xrayed=t,i}))}},{key:"setObjectsEdges",value:function(e,t){return this.withObjects(e,(function(e){var i=e.edges!==t;return e.edges=t,i}))}},{key:"setObjectsColorized",value:function(e,t){return this.withObjects(e,(function(e){e.colorize=t}))}},{key:"setObjectsOpacity",value:function(e,t){return this.withObjects(e,(function(e){var i=e.opacity!==t;return e.opacity=t,i}))}},{key:"setObjectsPickable",value:function(e,t){return this.withObjects(e,(function(e){var i=e.pickable!==t;return e.pickable=t,i}))}},{key:"setObjectsOffset",value:function(e,t){this.withObjects(e,(function(e){e.offset=t}))}},{key:"withObjects",value:function(e,t){re.isString(e)&&(e=[e]);for(var i=!1,s=0,r=e.length;s<r;s++){var n=e[s],o=this.objects[n];if(o)i=t(o)||i;else for(var a=this.modelIds,u=0,h=a.length;u<h;u++){var l=a[u],c=q.globalizeObjectId(l,n);(o=this.objects[c])&&(i=t(o)||i)}}return i}},{key:"destroy",value:function(){for(var e in m(P(i.prototype),"destroy",this).call(this),this.components)this.components.hasOwnProperty(e)&&this.components[e].destroy();this.canvas.gl=null,this.components=null,this.models=null,this.objects=null,this.visibleObjects=null,this.xrayedObjects=null,this.highlightedObjects=null,this.selectedObjects=null,this.colorizedObjects=null,this.opacityObjects=null,this.sectionPlanes=null,this.lights=null,this.lightMaps=null,this.reflectionMaps=null,this._objectIds=null,this._visibleObjectIds=null,this._xrayedObjectIds=null,this._highlightedObjectIds=null,this._selectedObjectIds=null,this._colorizedObjectIds=null,this.types=null,this.components=null,this.canvas=null,this._renderer=null,this.input=null,this._viewport=null,this._camera=null}}]),i}(),Lr=1e3,Nr=1001,jr=1002,Gr=1003,Hr=1004,Ur=1004,Vr=1005,zr=1005,Wr=1006,Xr=1007,Yr=1007,Kr=1008,Jr=1008,Zr=1009,Qr=1010,qr=1011,$r=1012,en=1013,tn=1014,sn=1015,rn=1016,nn=1017,on=1018,an=1020,un=1021,hn=1022,ln=1023,cn=1024,pn=1025,dn=1026,fn=1027,mn=1028,vn=1029,gn=1030,_n=1031,yn=1033,bn=33776,xn=33777,Pn=33778,Tn=33779,wn=35840,Mn=35841,In=35842,Cn=35843,Dn=36196,An=37492,kn=37496,En=37808,Fn=37809,Rn=37810,Sn=37811,On=37812,Bn=37813,Ln=37814,Nn=37815,jn=37816,Gn=37817,Hn=37818,Un=37819,Vn=37820,zn=37821,Wn=36492,Xn=3e3,Yn=3001,Kn=1e4,Jn=10001,Zn=10002,Qn=10003,qn=function(e){"LambertMaterial"===e._material._state.type?(this.vertex=function(e){var t=e.scene,i=e.scene._sectionPlanesState,s=e.scene._lightsState,r=e._geometry._state,n=e._state.billboard,o=e._state.stationary,a=i.sectionPlanes.length>0,u=!!r.compressGeometry,h=[];h.push("#version 300 es"),h.push("// Lambertian drawing vertex shader"),h.push("in vec3 position;"),h.push("uniform mat4 modelMatrix;"),h.push("uniform mat4 viewMatrix;"),h.push("uniform mat4 projMatrix;"),h.push("uniform vec4 colorize;"),h.push("uniform vec3 offset;"),u&&h.push("uniform mat4 positionsDecodeMatrix;");t.logarithmicDepthBufferEnabled&&(h.push("uniform float logDepthBufFC;"),h.push("out float vFragDepth;"),h.push("bool isPerspectiveMatrix(mat4 m) {"),h.push("    return (m[2][3] == - 1.0);"),h.push("}"),h.push("out float isPerspective;"));a&&h.push("out vec4 vWorldPosition;");if(h.push("uniform vec4 lightAmbient;"),h.push("uniform vec4 materialColor;"),h.push("uniform vec3 materialEmissive;"),r.normalsBuf){h.push("in vec3 normal;"),h.push("uniform mat4 modelNormalMatrix;"),h.push("uniform mat4 viewNormalMatrix;");for(var l=0,c=s.lights.length;l<c;l++){var p=s.lights[l];"ambient"!==p.type&&(h.push("uniform vec4 lightColor"+l+";"),"dir"===p.type&&h.push("uniform vec3 lightDir"+l+";"),"point"===p.type&&h.push("uniform vec3 lightPos"+l+";"),"spot"===p.type&&(h.push("uniform vec3 lightPos"+l+";"),h.push("uniform vec3 lightDir"+l+";")))}u&&(h.push("vec3 octDecode(vec2 oct) {"),h.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),h.push("    if (v.z < 0.0) {"),h.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),h.push("    }"),h.push("    return normalize(v);"),h.push("}"))}h.push("out vec4 vColor;"),"points"===r.primitiveName&&h.push("uniform float pointSize;");"spherical"!==n&&"cylindrical"!==n||(h.push("void billboard(inout mat4 mat) {"),h.push("   mat[0][0] = 1.0;"),h.push("   mat[0][1] = 0.0;"),h.push("   mat[0][2] = 0.0;"),"spherical"===n&&(h.push("   mat[1][0] = 0.0;"),h.push("   mat[1][1] = 1.0;"),h.push("   mat[1][2] = 0.0;")),h.push("   mat[2][0] = 0.0;"),h.push("   mat[2][1] = 0.0;"),h.push("   mat[2][2] =1.0;"),h.push("}"));h.push("void main(void) {"),h.push("vec4 localPosition = vec4(position, 1.0); "),h.push("vec4 worldPosition;"),u&&h.push("localPosition = positionsDecodeMatrix * localPosition;");r.normalsBuf&&(u?h.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):h.push("vec4 localNormal = vec4(normal, 0.0); "),h.push("mat4 modelNormalMatrix2 = modelNormalMatrix;"),h.push("mat4 viewNormalMatrix2 = viewNormalMatrix;"));h.push("mat4 viewMatrix2 = viewMatrix;"),h.push("mat4 modelMatrix2 = modelMatrix;"),o&&h.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===n||"cylindrical"===n?(h.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),h.push("billboard(modelMatrix2);"),h.push("billboard(viewMatrix2);"),h.push("billboard(modelViewMatrix);"),r.normalsBuf&&(h.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),h.push("billboard(modelNormalMatrix2);"),h.push("billboard(viewNormalMatrix2);"),h.push("billboard(modelViewNormalMatrix);")),h.push("worldPosition = modelMatrix2 * localPosition;"),h.push("worldPosition.xyz = worldPosition.xyz + offset;"),h.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(h.push("worldPosition = modelMatrix2 * localPosition;"),h.push("worldPosition.xyz = worldPosition.xyz + offset;"),h.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));r.normalsBuf&&h.push("vec3 viewNormal = normalize((viewNormalMatrix2 * modelNormalMatrix2 * localNormal).xyz);");if(h.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),h.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),h.push("float lambertian = 1.0;"),r.normalsBuf)for(var d=0,f=s.lights.length;d<f;d++){var m=s.lights[d];if("ambient"!==m.type){if("dir"===m.type)"view"===m.space?h.push("viewLightDir = normalize(lightDir"+d+");"):h.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+d+", 0.0)).xyz);");else if("point"===m.type)"view"===m.space?h.push("viewLightDir = -normalize(lightPos"+d+" - viewPosition.xyz);"):h.push("viewLightDir = -normalize((viewMatrix2 * vec4(lightPos"+d+", 0.0)).xyz);");else{if("spot"!==m.type)continue;"view"===m.space?h.push("viewLightDir = normalize(lightDir"+d+");"):h.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+d+", 0.0)).xyz);")}h.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),h.push("reflectedColor += lambertian * (lightColor"+d+".rgb * lightColor"+d+".a);")}}h.push("vColor = vec4((lightAmbient.rgb * lightAmbient.a * materialColor.rgb) + materialEmissive.rgb + (reflectedColor * materialColor.rgb), materialColor.a) * colorize;"),a&&h.push("vWorldPosition = worldPosition;");"points"===r.primitiveName&&h.push("gl_PointSize = pointSize;");h.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(h.push("vFragDepth = 1.0 + clipPos.w;"),h.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return h.push("gl_Position = clipPos;"),h.push("}"),h}(e),this.fragment=function(e){var t=e.scene,i=t._sectionPlanesState;e._material._state;var s=e._geometry._state,r=i.sectionPlanes.length>0,n=t.gammaOutput,o=[];o.push("#version 300 es"),o.push("// Lambertian drawing fragment shader"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),t.logarithmicDepthBufferEnabled&&(o.push("in float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("in float vFragDepth;"));if(r){o.push("in vec4 vWorldPosition;"),o.push("uniform bool clippable;");for(var a=0,u=i.sectionPlanes.length;a<u;a++)o.push("uniform bool sectionPlaneActive"+a+";"),o.push("uniform vec3 sectionPlanePos"+a+";"),o.push("uniform vec3 sectionPlaneDir"+a+";")}o.push("in vec4 vColor;"),n&&(o.push("uniform float gammaFactor;"),o.push("    vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),o.push("    return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),o.push("}"));if(o.push("out vec4 outColor;"),o.push("void main(void) {"),r){o.push("if (clippable) {"),o.push("  float dist = 0.0;");for(var h=0,l=i.sectionPlanes.length;h<l;h++)o.push("if (sectionPlaneActive"+h+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+h+".xyz, vWorldPosition.xyz - sectionPlanePos"+h+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { discard; }"),o.push("}")}"points"===s.primitiveName&&(o.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),o.push("float r = dot(cxy, cxy);"),o.push("if (r > 1.0) {"),o.push("   discard;"),o.push("}"));t.logarithmicDepthBufferEnabled&&o.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");n?o.push("outColor = linearToGamma(vColor, gammaFactor);"):o.push("outColor = vColor;");return o.push("}"),o}(e)):(this.vertex=function(e){var t=e.scene;e._material;var i,s=e._state,r=t._sectionPlanesState,n=e._geometry._state,o=t._lightsState,a=s.billboard,u=s.background,h=s.stationary,l=function(e){if(!e._geometry._state.uvBuf)return!1;var t=e._material;return!!(t._ambientMap||t._occlusionMap||t._baseColorMap||t._diffuseMap||t._alphaMap||t._specularMap||t._glossinessMap||t._specularGlossinessMap||t._emissiveMap||t._metallicMap||t._roughnessMap||t._metallicRoughnessMap||t._reflectivityMap||t._normalMap)}(e),c=to(e),p=r.sectionPlanes.length>0,d=eo(e),f=!!n.compressGeometry,m=[];m.push("#version 300 es"),m.push("// Drawing vertex shader"),m.push("in  vec3 position;"),f&&m.push("uniform mat4 positionsDecodeMatrix;");m.push("uniform  mat4 modelMatrix;"),m.push("uniform  mat4 viewMatrix;"),m.push("uniform  mat4 projMatrix;"),m.push("out  vec3 vViewPosition;"),m.push("uniform  vec3 offset;"),p&&m.push("out vec4 vWorldPosition;");t.logarithmicDepthBufferEnabled&&(m.push("uniform float logDepthBufFC;"),m.push("out float vFragDepth;"),m.push("bool isPerspectiveMatrix(mat4 m) {"),m.push("    return (m[2][3] == - 1.0);"),m.push("}"),m.push("out float isPerspective;"));o.lightMaps.length>0&&m.push("out    vec3 vWorldNormal;");if(c){m.push("in  vec3 normal;"),m.push("uniform    mat4 modelNormalMatrix;"),m.push("uniform    mat4 viewNormalMatrix;"),m.push("out    vec3 vViewNormal;");for(var v=0,g=o.lights.length;v<g;v++)"ambient"!==(i=o.lights[v]).type&&("dir"===i.type&&m.push("uniform vec3 lightDir"+v+";"),"point"===i.type&&m.push("uniform vec3 lightPos"+v+";"),"spot"===i.type&&(m.push("uniform vec3 lightPos"+v+";"),m.push("uniform vec3 lightDir"+v+";")),"dir"===i.type&&"view"===i.space||m.push("out vec4 vViewLightReverseDirAndDist"+v+";"));f&&(m.push("vec3 octDecode(vec2 oct) {"),m.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),m.push("    if (v.z < 0.0) {"),m.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),m.push("    }"),m.push("    return normalize(v);"),m.push("}"))}l&&(m.push("in vec2 uv;"),m.push("out vec2 vUV;"),f&&m.push("uniform mat3 uvDecodeMatrix;"));n.colors&&(m.push("in vec4 color;"),m.push("out vec4 vColor;"));"points"===n.primitiveName&&m.push("uniform float pointSize;");"spherical"!==a&&"cylindrical"!==a||(m.push("void billboard(inout mat4 mat) {"),m.push("   mat[0][0] = 1.0;"),m.push("   mat[0][1] = 0.0;"),m.push("   mat[0][2] = 0.0;"),"spherical"===a&&(m.push("   mat[1][0] = 0.0;"),m.push("   mat[1][1] = 1.0;"),m.push("   mat[1][2] = 0.0;")),m.push("   mat[2][0] = 0.0;"),m.push("   mat[2][1] = 0.0;"),m.push("   mat[2][2] =1.0;"),m.push("}"));if(d){m.push("const mat4 texUnitConverter = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);");for(var _=0,y=o.lights.length;_<y;_++)o.lights[_].castsShadow&&(m.push("uniform mat4 shadowViewMatrix"+_+";"),m.push("uniform mat4 shadowProjMatrix"+_+";"),m.push("out vec4 vShadowPosFromLight"+_+";"))}m.push("void main(void) {"),m.push("vec4 localPosition = vec4(position, 1.0); "),m.push("vec4 worldPosition;"),f&&m.push("localPosition = positionsDecodeMatrix * localPosition;");c&&(f?m.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):m.push("vec4 localNormal = vec4(normal, 0.0); "),m.push("mat4 modelNormalMatrix2    = modelNormalMatrix;"),m.push("mat4 viewNormalMatrix2     = viewNormalMatrix;"));m.push("mat4 viewMatrix2           = viewMatrix;"),m.push("mat4 modelMatrix2          = modelMatrix;"),h?m.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;"):u&&m.push("viewMatrix2[3] = vec4(0.0, 0.0, 0.0 ,1.0);");"spherical"===a||"cylindrical"===a?(m.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),m.push("billboard(modelMatrix2);"),m.push("billboard(viewMatrix2);"),m.push("billboard(modelViewMatrix);"),c&&(m.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),m.push("billboard(modelNormalMatrix2);"),m.push("billboard(viewNormalMatrix2);"),m.push("billboard(modelViewNormalMatrix);")),m.push("worldPosition = modelMatrix2 * localPosition;"),m.push("worldPosition.xyz = worldPosition.xyz + offset;"),m.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(m.push("worldPosition = modelMatrix2 * localPosition;"),m.push("worldPosition.xyz = worldPosition.xyz + offset;"),m.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));if(c){m.push("vec3 worldNormal = (modelNormalMatrix2 * localNormal).xyz; "),o.lightMaps.length>0&&m.push("vWorldNormal = worldNormal;"),m.push("vViewNormal = normalize((viewNormalMatrix2 * vec4(worldNormal, 1.0)).xyz);"),m.push("vec3 tmpVec3;"),m.push("float lightDist;");for(var b=0,x=o.lights.length;b<x;b++)"ambient"!==(i=o.lights[b]).type&&("dir"===i.type&&"world"===i.space&&(m.push("tmpVec3 = vec3(viewMatrix2 * vec4(lightDir"+b+", 0.0) ).xyz;"),m.push("vViewLightReverseDirAndDist"+b+" = vec4(-tmpVec3, 0.0);")),"point"===i.type&&("world"===i.space?(m.push("tmpVec3 = (viewMatrix2 * vec4(lightPos"+b+", 1.0)).xyz - viewPosition.xyz;"),m.push("lightDist = abs(length(tmpVec3));")):(m.push("tmpVec3 = lightPos"+b+".xyz - viewPosition.xyz;"),m.push("lightDist = abs(length(tmpVec3));")),m.push("vViewLightReverseDirAndDist"+b+" = vec4(tmpVec3, lightDist);")))}l&&(f?m.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"):m.push("vUV = uv;"));n.colors&&m.push("vColor = color;");"points"===n.primitiveName&&m.push("gl_PointSize = pointSize;");p&&m.push("vWorldPosition = worldPosition;");m.push("   vViewPosition = viewPosition.xyz;"),m.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(m.push("vFragDepth = 1.0 + clipPos.w;"),m.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));u&&m.push("clipPos.z = clipPos.w;");if(m.push("gl_Position = clipPos;"),d){m.push("const mat4 texUnitConverter = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);"),m.push("vec4 tempx; ");for(var P=0,T=o.lights.length;P<T;P++)o.lights[P].castsShadow&&m.push("vShadowPosFromLight"+P+" = texUnitConverter * shadowProjMatrix"+P+" * (shadowViewMatrix"+P+" * worldPosition); ")}return m.push("}"),m}(e),this.fragment=function(e){var t=e.scene;t.canvas.gl;var i=e._material,s=e._geometry._state,r=e.scene._sectionPlanesState,n=e.scene._lightsState,o=e._material._state,a=r.sectionPlanes.length>0,u=to(e),h=s.uvBuf,l="PhongMaterial"===o.type,c="MetallicMaterial"===o.type,p="SpecularMaterial"===o.type,d=eo(e);t.gammaInput;var f=t.gammaOutput,m=[];m.push("#version 300 es"),m.push("// Drawing fragment shader"),m.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),m.push("precision highp float;"),m.push("precision highp int;"),m.push("#else"),m.push("precision mediump float;"),m.push("precision mediump int;"),m.push("#endif"),t.logarithmicDepthBufferEnabled&&(m.push("in float isPerspective;"),m.push("uniform float logDepthBufFC;"),m.push("in float vFragDepth;"));d&&(m.push("float unpackDepth (vec4 color) {"),m.push("  const vec4 bitShift = vec4(1.0, 1.0/256.0, 1.0/(256.0 * 256.0), 1.0/(256.0*256.0*256.0));"),m.push("  return dot(color, bitShift);"),m.push("}"));m.push("uniform float gammaFactor;"),m.push("vec4 linearToLinear( in vec4 value ) {"),m.push("  return value;"),m.push("}"),m.push("vec4 sRGBToLinear( in vec4 value ) {"),m.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),m.push("}"),m.push("vec4 gammaToLinear( in vec4 value) {"),m.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),m.push("}"),f&&(m.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),m.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),m.push("}"));if(a){m.push("in vec4 vWorldPosition;"),m.push("uniform bool clippable;");for(var v=0;v<r.sectionPlanes.length;v++)m.push("uniform bool sectionPlaneActive"+v+";"),m.push("uniform vec3 sectionPlanePos"+v+";"),m.push("uniform vec3 sectionPlaneDir"+v+";")}u&&(n.lightMaps.length>0&&(m.push("uniform samplerCube lightMap;"),m.push("uniform mat4 viewNormalMatrix;")),n.reflectionMaps.length>0&&m.push("uniform samplerCube reflectionMap;"),(n.lightMaps.length>0||n.reflectionMaps.length>0)&&m.push("uniform mat4 viewMatrix;"),m.push("#define PI 3.14159265359"),m.push("#define RECIPROCAL_PI 0.31830988618"),m.push("#define RECIPROCAL_PI2 0.15915494"),m.push("#define EPSILON 1e-6"),m.push("#define saturate(a) clamp( a, 0.0, 1.0 )"),m.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),m.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),m.push("}"),m.push("struct IncidentLight {"),m.push("   vec3 color;"),m.push("   vec3 direction;"),m.push("};"),m.push("struct ReflectedLight {"),m.push("   vec3 diffuse;"),m.push("   vec3 specular;"),m.push("};"),m.push("struct Geometry {"),m.push("   vec3 position;"),m.push("   vec3 viewNormal;"),m.push("   vec3 worldNormal;"),m.push("   vec3 viewEyeDir;"),m.push("};"),m.push("struct Material {"),m.push("   vec3    diffuseColor;"),m.push("   float   specularRoughness;"),m.push("   vec3    specularColor;"),m.push("   float   shine;"),m.push("};"),l&&((n.lightMaps.length>0||n.reflectionMaps.length>0)&&(m.push("void computePhongLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),n.lightMaps.length>0&&(m.push("   vec3 irradiance = "+$n[n.lightMaps[0].encoding]+"(texture(lightMap, geometry.worldNormal)).rgb;"),m.push("   irradiance *= PI;"),m.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),m.push("   reflectedLight.diffuse += irradiance * diffuseBRDFContrib;")),n.reflectionMaps.length>0&&(m.push("   vec3 reflectVec             = reflect(-geometry.viewEyeDir, geometry.viewNormal);"),m.push("   vec3 radiance               = texture(reflectionMap, reflectVec).rgb * 0.2;"),m.push("   radiance *= PI;"),m.push("   reflectedLight.specular     += radiance;")),m.push("}")),m.push("void computePhongLighting(const in IncidentLight directLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),m.push("   float dotNL     = saturate(dot(geometry.viewNormal, directLight.direction));"),m.push("   vec3 irradiance = dotNL * directLight.color * PI;"),m.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),m.push("   reflectedLight.specular += directLight.color * material.specularColor * pow(max(dot(reflect(-directLight.direction, -geometry.viewNormal), geometry.viewEyeDir), 0.0), material.shine);"),m.push("}")),(c||p)&&(m.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),m.push("   float r = ggxRoughness + 0.0001;"),m.push("   return (2.0 / (r * r) - 2.0);"),m.push("}"),m.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {"),m.push("   float maxMIPLevelScalar = float( maxMIPLevel );"),m.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );"),m.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );"),m.push("}"),n.reflectionMaps.length>0&&(m.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),m.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),m.push("   vec3 envMapColor = "+$n[n.reflectionMaps[0].encoding]+"(texture(reflectionMap, reflectVec, mipLevel)).rgb;"),m.push("  return envMapColor;"),m.push("}")),m.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),m.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),m.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),m.push("}"),m.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),m.push("   float a2 = ( alpha * alpha );"),m.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),m.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),m.push("   return 1.0 / ( gl * gv );"),m.push("}"),m.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),m.push("   float a2 = ( alpha * alpha );"),m.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),m.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),m.push("   return 0.5 / max( gv + gl, EPSILON );"),m.push("}"),m.push("float D_GGX(const in float alpha, const in float dotNH) {"),m.push("   float a2 = ( alpha * alpha );"),m.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),m.push("   return RECIPROCAL_PI * a2 / ( denom * denom);"),m.push("}"),m.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),m.push("   float alpha = ( roughness * roughness );"),m.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),m.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),m.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),m.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),m.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),m.push("   vec3  F = F_Schlick( specularColor, dotLH );"),m.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),m.push("   float D = D_GGX( alpha, dotNH );"),m.push("   return F * (G * D);"),m.push("}"),m.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),m.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),m.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),m.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),m.push("   vec4 r = roughness * c0 + c1;"),m.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),m.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),m.push("   return specularColor * AB.x + AB.y;"),m.push("}"),(n.lightMaps.length>0||n.reflectionMaps.length>0)&&(m.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),n.lightMaps.length>0&&(m.push("   vec3 irradiance = sRGBToLinear(texture(lightMap, geometry.worldNormal)).rgb;"),m.push("   irradiance *= PI;"),m.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),m.push("   reflectedLight.diffuse += irradiance * diffuseBRDFContrib;")),n.reflectionMaps.length>0&&(m.push("   vec3 reflectVec             = reflect(-geometry.viewEyeDir, geometry.viewNormal);"),m.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),m.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),m.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),m.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),m.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),m.push("}")),m.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),m.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),m.push("   vec3 irradiance = dotNL * incidentLight.color * PI;"),m.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),m.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),m.push("}")));m.push("in vec3 vViewPosition;"),s.colors&&m.push("in vec4 vColor;");h&&(u&&i._normalMap||i._ambientMap||i._baseColorMap||i._diffuseMap||i._emissiveMap||i._metallicMap||i._roughnessMap||i._metallicRoughnessMap||i._specularMap||i._glossinessMap||i._specularGlossinessMap||i._occlusionMap||i._alphaMap)&&m.push("in vec2 vUV;");u&&(n.lightMaps.length>0&&m.push("in vec3 vWorldNormal;"),m.push("in vec3 vViewNormal;"));o.ambient&&m.push("uniform vec3 materialAmbient;");o.baseColor&&m.push("uniform vec3 materialBaseColor;");void 0!==o.alpha&&null!==o.alpha&&m.push("uniform vec4 materialAlphaModeCutoff;");o.emissive&&m.push("uniform vec3 materialEmissive;");o.diffuse&&m.push("uniform vec3 materialDiffuse;");void 0!==o.glossiness&&null!==o.glossiness&&m.push("uniform float materialGlossiness;");void 0!==o.shininess&&null!==o.shininess&&m.push("uniform float materialShininess;");o.specular&&m.push("uniform vec3 materialSpecular;");void 0!==o.metallic&&null!==o.metallic&&m.push("uniform float materialMetallic;");void 0!==o.roughness&&null!==o.roughness&&m.push("uniform float materialRoughness;");void 0!==o.specularF0&&null!==o.specularF0&&m.push("uniform float materialSpecularF0;");h&&i._ambientMap&&(m.push("uniform sampler2D ambientMap;"),i._ambientMap._state.matrix&&m.push("uniform mat4 ambientMapMatrix;"));h&&i._baseColorMap&&(m.push("uniform sampler2D baseColorMap;"),i._baseColorMap._state.matrix&&m.push("uniform mat4 baseColorMapMatrix;"));h&&i._diffuseMap&&(m.push("uniform sampler2D diffuseMap;"),i._diffuseMap._state.matrix&&m.push("uniform mat4 diffuseMapMatrix;"));h&&i._emissiveMap&&(m.push("uniform sampler2D emissiveMap;"),i._emissiveMap._state.matrix&&m.push("uniform mat4 emissiveMapMatrix;"));u&&h&&i._metallicMap&&(m.push("uniform sampler2D metallicMap;"),i._metallicMap._state.matrix&&m.push("uniform mat4 metallicMapMatrix;"));u&&h&&i._roughnessMap&&(m.push("uniform sampler2D roughnessMap;"),i._roughnessMap._state.matrix&&m.push("uniform mat4 roughnessMapMatrix;"));u&&h&&i._metallicRoughnessMap&&(m.push("uniform sampler2D metallicRoughnessMap;"),i._metallicRoughnessMap._state.matrix&&m.push("uniform mat4 metallicRoughnessMapMatrix;"));u&&i._normalMap&&(m.push("uniform sampler2D normalMap;"),i._normalMap._state.matrix&&m.push("uniform mat4 normalMapMatrix;"),m.push("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),m.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),m.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),m.push("      vec2 st0 = dFdx( uv.st );"),m.push("      vec2 st1 = dFdy( uv.st );"),m.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),m.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),m.push("      vec3 N = normalize( surf_norm );"),m.push("      vec3 mapN = texture( normalMap, uv ).xyz * 2.0 - 1.0;"),m.push("      mat3 tsn = mat3( S, T, N );"),m.push("      return normalize( tsn * mapN );"),m.push("}"));h&&i._occlusionMap&&(m.push("uniform sampler2D occlusionMap;"),i._occlusionMap._state.matrix&&m.push("uniform mat4 occlusionMapMatrix;"));h&&i._alphaMap&&(m.push("uniform sampler2D alphaMap;"),i._alphaMap._state.matrix&&m.push("uniform mat4 alphaMapMatrix;"));u&&h&&i._specularMap&&(m.push("uniform sampler2D specularMap;"),i._specularMap._state.matrix&&m.push("uniform mat4 specularMapMatrix;"));u&&h&&i._glossinessMap&&(m.push("uniform sampler2D glossinessMap;"),i._glossinessMap._state.matrix&&m.push("uniform mat4 glossinessMapMatrix;"));u&&h&&i._specularGlossinessMap&&(m.push("uniform sampler2D materialSpecularGlossinessMap;"),i._specularGlossinessMap._state.matrix&&m.push("uniform mat4 materialSpecularGlossinessMapMatrix;"));u&&(i._diffuseFresnel||i._specularFresnel||i._alphaFresnel||i._emissiveFresnel||i._reflectivityFresnel)&&(m.push("float fresnel(vec3 eyeDir, vec3 normal, float edgeBias, float centerBias, float power) {"),m.push("    float fr = abs(dot(eyeDir, normal));"),m.push("    float finalFr = clamp((fr - edgeBias) / (centerBias - edgeBias), 0.0, 1.0);"),m.push("    return pow(finalFr, power);"),m.push("}"),i._diffuseFresnel&&(m.push("uniform float  diffuseFresnelCenterBias;"),m.push("uniform float  diffuseFresnelEdgeBias;"),m.push("uniform float  diffuseFresnelPower;"),m.push("uniform vec3   diffuseFresnelCenterColor;"),m.push("uniform vec3   diffuseFresnelEdgeColor;")),i._specularFresnel&&(m.push("uniform float  specularFresnelCenterBias;"),m.push("uniform float  specularFresnelEdgeBias;"),m.push("uniform float  specularFresnelPower;"),m.push("uniform vec3   specularFresnelCenterColor;"),m.push("uniform vec3   specularFresnelEdgeColor;")),i._alphaFresnel&&(m.push("uniform float  alphaFresnelCenterBias;"),m.push("uniform float  alphaFresnelEdgeBias;"),m.push("uniform float  alphaFresnelPower;"),m.push("uniform vec3   alphaFresnelCenterColor;"),m.push("uniform vec3   alphaFresnelEdgeColor;")),i._reflectivityFresnel&&(m.push("uniform float  materialSpecularF0FresnelCenterBias;"),m.push("uniform float  materialSpecularF0FresnelEdgeBias;"),m.push("uniform float  materialSpecularF0FresnelPower;"),m.push("uniform vec3   materialSpecularF0FresnelCenterColor;"),m.push("uniform vec3   materialSpecularF0FresnelEdgeColor;")),i._emissiveFresnel&&(m.push("uniform float  emissiveFresnelCenterBias;"),m.push("uniform float  emissiveFresnelEdgeBias;"),m.push("uniform float  emissiveFresnelPower;"),m.push("uniform vec3   emissiveFresnelCenterColor;"),m.push("uniform vec3   emissiveFresnelEdgeColor;")));if(m.push("uniform vec4   lightAmbient;"),u)for(var g=0,_=n.lights.length;g<_;g++){var y=n.lights[g];"ambient"!==y.type&&(m.push("uniform vec4 lightColor"+g+";"),"point"===y.type&&m.push("uniform vec3 lightAttenuation"+g+";"),"dir"===y.type&&"view"===y.space&&m.push("uniform vec3 lightDir"+g+";"),"point"===y.type&&"view"===y.space?m.push("uniform vec3 lightPos"+g+";"):m.push("in vec4 vViewLightReverseDirAndDist"+g+";"))}if(d)for(var b=0,x=n.lights.length;b<x;b++)n.lights[b].castsShadow&&(m.push("in vec4 vShadowPosFromLight"+b+";"),m.push("uniform sampler2D shadowMap"+b+";"));if(m.push("uniform vec4 colorize;"),m.push("out vec4 outColor;"),m.push("void main(void) {"),a){m.push("if (clippable) {"),m.push("  float dist = 0.0;");for(v=0;v<r.sectionPlanes.length;v++)m.push("if (sectionPlaneActive"+v+") {"),m.push("   dist += clamp(dot(-sectionPlaneDir"+v+".xyz, vWorldPosition.xyz - sectionPlanePos"+v+".xyz), 0.0, 1000.0);"),m.push("}");m.push("  if (dist > 0.0) { discard; }"),m.push("}")}"points"===s.primitiveName&&(m.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),m.push("float r = dot(cxy, cxy);"),m.push("if (r > 1.0) {"),m.push("   discard;"),m.push("}"));m.push("float occlusion = 1.0;"),o.ambient?m.push("vec3 ambientColor = materialAmbient;"):m.push("vec3 ambientColor = vec3(1.0, 1.0, 1.0);");o.diffuse?m.push("vec3 diffuseColor = materialDiffuse;"):o.baseColor?m.push("vec3 diffuseColor = materialBaseColor;"):m.push("vec3 diffuseColor = vec3(1.0, 1.0, 1.0);");s.colors&&m.push("diffuseColor *= vColor.rgb;");o.emissive?m.push("vec3 emissiveColor = materialEmissive;"):m.push("vec3  emissiveColor = vec3(0.0, 0.0, 0.0);");o.specular?m.push("vec3 specular = materialSpecular;"):m.push("vec3 specular = vec3(1.0, 1.0, 1.0);");void 0!==o.alpha?m.push("float alpha = materialAlphaModeCutoff[0];"):m.push("float alpha = 1.0;");s.colors&&m.push("alpha *= vColor.a;");void 0!==o.glossiness?m.push("float glossiness = materialGlossiness;"):m.push("float glossiness = 1.0;");void 0!==o.metallic?m.push("float metallic = materialMetallic;"):m.push("float metallic = 1.0;");void 0!==o.roughness?m.push("float roughness = materialRoughness;"):m.push("float roughness = 1.0;");void 0!==o.specularF0?m.push("float specularF0 = materialSpecularF0;"):m.push("float specularF0 = 1.0;");h&&(u&&i._normalMap||i._ambientMap||i._baseColorMap||i._diffuseMap||i._occlusionMap||i._emissiveMap||i._metallicMap||i._roughnessMap||i._metallicRoughnessMap||i._specularMap||i._glossinessMap||i._specularGlossinessMap||i._alphaMap)&&(m.push("vec4 texturePos = vec4(vUV.s, vUV.t, 1.0, 1.0);"),m.push("vec2 textureCoord;"));h&&i._ambientMap&&(i._ambientMap._state.matrix?m.push("textureCoord = (ambientMapMatrix * texturePos).xy;"):m.push("textureCoord = texturePos.xy;"),m.push("vec4 ambientTexel = texture(ambientMap, textureCoord).rgb;"),m.push("ambientTexel = "+$n[i._ambientMap._state.encoding]+"(ambientTexel);"),m.push("ambientColor *= ambientTexel.rgb;"));h&&i._diffuseMap&&(i._diffuseMap._state.matrix?m.push("textureCoord = (diffuseMapMatrix * texturePos).xy;"):m.push("textureCoord = texturePos.xy;"),m.push("vec4 diffuseTexel = texture(diffuseMap, textureCoord);"),m.push("diffuseTexel = "+$n[i._diffuseMap._state.encoding]+"(diffuseTexel);"),m.push("diffuseColor *= diffuseTexel.rgb;"),m.push("alpha *= diffuseTexel.a;"));h&&i._baseColorMap&&(i._baseColorMap._state.matrix?m.push("textureCoord = (baseColorMapMatrix * texturePos).xy;"):m.push("textureCoord = texturePos.xy;"),m.push("vec4 baseColorTexel = texture(baseColorMap, textureCoord);"),m.push("baseColorTexel = "+$n[i._baseColorMap._state.encoding]+"(baseColorTexel);"),m.push("diffuseColor *= baseColorTexel.rgb;"),m.push("alpha *= baseColorTexel.a;"));h&&i._emissiveMap&&(i._emissiveMap._state.matrix?m.push("textureCoord = (emissiveMapMatrix * texturePos).xy;"):m.push("textureCoord = texturePos.xy;"),m.push("vec4 emissiveTexel = texture(emissiveMap, textureCoord);"),m.push("emissiveTexel = "+$n[i._emissiveMap._state.encoding]+"(emissiveTexel);"),m.push("emissiveColor = emissiveTexel.rgb;"));h&&i._alphaMap&&(i._alphaMap._state.matrix?m.push("textureCoord = (alphaMapMatrix * texturePos).xy;"):m.push("textureCoord = texturePos.xy;"),m.push("alpha *= texture(alphaMap, textureCoord).r;"));h&&i._occlusionMap&&(i._occlusionMap._state.matrix?m.push("textureCoord = (occlusionMapMatrix * texturePos).xy;"):m.push("textureCoord = texturePos.xy;"),m.push("occlusion *= texture(occlusionMap, textureCoord).r;"));if(u&&(n.lights.length>0||n.lightMaps.length>0||n.reflectionMaps.length>0)){h&&i._normalMap?(i._normalMap._state.matrix?m.push("textureCoord = (normalMapMatrix * texturePos).xy;"):m.push("textureCoord = texturePos.xy;"),m.push("vec3 viewNormal = perturbNormal2Arb( vViewPosition, normalize(vViewNormal), textureCoord );")):m.push("vec3 viewNormal = normalize(vViewNormal);"),h&&i._specularMap&&(i._specularMap._state.matrix?m.push("textureCoord = (specularMapMatrix * texturePos).xy;"):m.push("textureCoord = texturePos.xy;"),m.push("specular *= texture(specularMap, textureCoord).rgb;")),h&&i._glossinessMap&&(i._glossinessMap._state.matrix?m.push("textureCoord = (glossinessMapMatrix * texturePos).xy;"):m.push("textureCoord = texturePos.xy;"),m.push("glossiness *= texture(glossinessMap, textureCoord).r;")),h&&i._specularGlossinessMap&&(i._specularGlossinessMap._state.matrix?m.push("textureCoord = (materialSpecularGlossinessMapMatrix * texturePos).xy;"):m.push("textureCoord = texturePos.xy;"),m.push("vec4 specGlossRGB = texture(materialSpecularGlossinessMap, textureCoord).rgba;"),m.push("specular *= specGlossRGB.rgb;"),m.push("glossiness *= specGlossRGB.a;")),h&&i._metallicMap&&(i._metallicMap._state.matrix?m.push("textureCoord = (metallicMapMatrix * texturePos).xy;"):m.push("textureCoord = texturePos.xy;"),m.push("metallic *= texture(metallicMap, textureCoord).r;")),h&&i._roughnessMap&&(i._roughnessMap._state.matrix?m.push("textureCoord = (roughnessMapMatrix * texturePos).xy;"):m.push("textureCoord = texturePos.xy;"),m.push("roughness *= texture(roughnessMap, textureCoord).r;")),h&&i._metallicRoughnessMap&&(i._metallicRoughnessMap._state.matrix?m.push("textureCoord = (metallicRoughnessMapMatrix * texturePos).xy;"):m.push("textureCoord = texturePos.xy;"),m.push("vec3 metalRoughRGB = texture(metallicRoughnessMap, textureCoord).rgb;"),m.push("metallic *= metalRoughRGB.b;"),m.push("roughness *= metalRoughRGB.g;")),m.push("vec3 viewEyeDir = normalize(-vViewPosition);"),i._diffuseFresnel&&(m.push("float diffuseFresnel = fresnel(viewEyeDir, viewNormal, diffuseFresnelEdgeBias, diffuseFresnelCenterBias, diffuseFresnelPower);"),m.push("diffuseColor *= mix(diffuseFresnelEdgeColor, diffuseFresnelCenterColor, diffuseFresnel);")),i._specularFresnel&&(m.push("float specularFresnel = fresnel(viewEyeDir, viewNormal, specularFresnelEdgeBias, specularFresnelCenterBias, specularFresnelPower);"),m.push("specular *= mix(specularFresnelEdgeColor, specularFresnelCenterColor, specularFresnel);")),i._alphaFresnel&&(m.push("float alphaFresnel = fresnel(viewEyeDir, viewNormal, alphaFresnelEdgeBias, alphaFresnelCenterBias, alphaFresnelPower);"),m.push("alpha *= mix(alphaFresnelEdgeColor.r, alphaFresnelCenterColor.r, alphaFresnel);")),i._emissiveFresnel&&(m.push("float emissiveFresnel = fresnel(viewEyeDir, viewNormal, emissiveFresnelEdgeBias, emissiveFresnelCenterBias, emissiveFresnelPower);"),m.push("emissiveColor *= mix(emissiveFresnelEdgeColor, emissiveFresnelCenterColor, emissiveFresnel);")),m.push("if (materialAlphaModeCutoff[1] == 1.0 && alpha < materialAlphaModeCutoff[2]) {"),m.push("   discard;"),m.push("}"),m.push("IncidentLight  light;"),m.push("Material       material;"),m.push("Geometry       geometry;"),m.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),m.push("vec3           viewLightDir;"),l&&(m.push("material.diffuseColor      = diffuseColor;"),m.push("material.specularColor     = specular;"),m.push("material.shine             = materialShininess;")),p&&(m.push("float oneMinusSpecularStrength = 1.0 - max(max(specular.r, specular.g ),specular.b);"),m.push("material.diffuseColor      = diffuseColor * oneMinusSpecularStrength;"),m.push("material.specularRoughness = clamp( 1.0 - glossiness, 0.04, 1.0 );"),m.push("material.specularColor     = specular;")),c&&(m.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),m.push("material.diffuseColor      = diffuseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),m.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),m.push("material.specularColor     = mix(vec3(dielectricSpecular), diffuseColor, metallic);")),m.push("geometry.position      = vViewPosition;"),n.lightMaps.length>0&&m.push("geometry.worldNormal   = normalize(vWorldNormal);"),m.push("geometry.viewNormal    = viewNormal;"),m.push("geometry.viewEyeDir    = viewEyeDir;"),l&&(n.lightMaps.length>0||n.reflectionMaps.length>0)&&m.push("computePhongLightMapping(geometry, material, reflectedLight);"),(p||c)&&(n.lightMaps.length>0||n.reflectionMaps.length>0)&&m.push("computePBRLightMapping(geometry, material, reflectedLight);"),m.push("float shadow = 1.0;"),m.push("float shadowAcneRemover = 0.007;"),m.push("vec3 fragmentDepth;"),m.push("float texelSize = 1.0 / 1024.0;"),m.push("float amountInLight = 0.0;"),m.push("vec3 shadowCoord;"),m.push("vec4 rgbaDepth;"),m.push("float depth;");for(var P=0,T=n.lights.length;P<T;P++){var w=n.lights[P];"ambient"!==w.type&&("dir"===w.type&&"view"===w.space?m.push("viewLightDir = -normalize(lightDir"+P+");"):"point"===w.type&&"view"===w.space?m.push("viewLightDir = normalize(lightPos"+P+" - vViewPosition);"):m.push("viewLightDir = normalize(vViewLightReverseDirAndDist"+P+".xyz);"),d&&w.castsShadow?(m.push("shadow = 0.0;"),m.push("fragmentDepth = vShadowPosFromLight"+P+".xyz;"),m.push("fragmentDepth.z -= shadowAcneRemover;"),m.push("for (int x = -3; x <= 3; x++) {"),m.push("  for (int y = -3; y <= 3; y++) {"),m.push("      float texelDepth = unpackDepth(texture(shadowMap"+P+", fragmentDepth.xy + vec2(x, y) * texelSize));"),m.push("      if (fragmentDepth.z < texelDepth) {"),m.push("          shadow += 1.0;"),m.push("      }"),m.push("  }"),m.push("}"),m.push("shadow = shadow / 9.0;"),m.push("light.color =  lightColor"+P+".rgb * (lightColor"+P+".a * shadow);")):m.push("light.color =  lightColor"+P+".rgb * (lightColor"+P+".a );"),m.push("light.direction = viewLightDir;"),l&&m.push("computePhongLighting(light, geometry, material, reflectedLight);"),(p||c)&&m.push("computePBRLighting(light, geometry, material, reflectedLight);"))}l?m.push("vec3 outgoingLight = (lightAmbient.rgb * lightAmbient.a * diffuseColor) + ((occlusion * (( reflectedLight.diffuse + reflectedLight.specular)))) + emissiveColor;"):m.push("vec3 outgoingLight = (occlusion * (reflectedLight.diffuse)) + (occlusion * reflectedLight.specular) + emissiveColor;")}else m.push("ambientColor *= (lightAmbient.rgb * lightAmbient.a);"),m.push("vec3 outgoingLight = emissiveColor + ambientColor;");m.push("vec4 fragColor = vec4(outgoingLight, alpha) * colorize;"),f&&m.push("fragColor = linearToGamma(fragColor, gammaFactor);");m.push("outColor = fragColor;"),t.logarithmicDepthBufferEnabled&&m.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");return m.push("}"),m}(e))},$n={};function eo(e){if(!e.receivesShadow)return!1;var t=e.scene._lightsState.lights;if(!t||0===t.length)return!1;for(var i=0,s=t.length;i<s;i++)if(t[i].castsShadow)return!0;return!1}function to(e){var t=e._geometry._state.primitiveName;return!(!e._geometry._state.autoVertexNormals&&!e._geometry._state.normalsBuf||"triangles"!==t&&"triangle-strip"!==t&&"triangle-fan"!==t)}$n[3e3]="linearToLinear",$n[3001]="sRGBToLinear";var io=q.vec3(),so=new G({}),ro=function(e,t){this.id=so.addItem({}),this._hash=e,this._scene=t.scene,this._useCount=0,this._shaderSource=new qn(t),this._allocate(t)},no={};ro.get=function(e){var t=e.scene,i=[t.canvas.canvas.id,(t.gammaInput?"gi;":";")+(t.gammaOutput?"go":""),t._lightsState.getHash(),t._sectionPlanesState.getHash(),e._geometry._state.hash,e._material._state.hash,e._state.drawHash].join(";"),s=no[i];if(!s){if((s=new ro(i,e)).errors)return console.log(s.errors.join("\n")),null;no[i]=s,ee.memory.programs++}return s._useCount++,s},ro.prototype.put=function(){0==--this._useCount&&(so.removeItem(this.id),this._program&&this._program.destroy(),delete no[this._hash],ee.memory.programs--)},ro.prototype.webglContextRestored=function(){this._program=null},ro.prototype.drawMesh=function(e,t){this._program||this._allocate(t);var i=Ze.MAX_TEXTURE_UNITS,s=t.scene,r=t._material,n=s.canvas.gl,o=this._program,a=t._state,u=t._material._state,h=t._geometry._state,l=s.camera,c=t.origin,p=a.background;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,p&&n.depthFunc(n.LEQUAL),this._bindProgram(e)),n.uniformMatrix4fv(this._uViewMatrix,!1,c?e.getRTCViewMatrix(a.originHash,c):l.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,l.viewNormalMatrix),a.clippable){var d=s._sectionPlanesState.sectionPlanes.length;if(d>0)for(var f=s._sectionPlanesState.sectionPlanes,m=t.renderFlags,v=0;v<d;v++){var g=this._uSectionPlanes[v];if(g){var _=m.sectionPlanesActivePerLayer[v];if(n.uniform1i(g.active,_?1:0),_){var y=f[v];n.uniform3fv(g.pos,c?Ee(y.dist,y.dir,c,io):y.pos),n.uniform3fv(g.dir,y.dir)}}}}if(u.id!==this._lastMaterialId){e.textureUnit=this._baseTextureUnit;var b=u.backfaces;e.backfaces!==b&&(b?n.disable(n.CULL_FACE):n.enable(n.CULL_FACE),e.backfaces=b);var x=u.frontface;switch(e.frontface!==x&&(x?n.frontFace(n.CCW):n.frontFace(n.CW),e.frontface=x),e.lineWidth!==u.lineWidth&&(n.lineWidth(u.lineWidth),e.lineWidth=u.lineWidth),this._uPointSize&&n.uniform1f(this._uPointSize,u.pointSize),u.type){case"LambertMaterial":this._uMaterialAmbient&&n.uniform3fv(this._uMaterialAmbient,u.ambient),this._uMaterialColor&&n.uniform4f(this._uMaterialColor,u.color[0],u.color[1],u.color[2],u.alpha),this._uMaterialEmissive&&n.uniform3fv(this._uMaterialEmissive,u.emissive);break;case"PhongMaterial":this._uMaterialShininess&&n.uniform1f(this._uMaterialShininess,u.shininess),this._uMaterialAmbient&&n.uniform3fv(this._uMaterialAmbient,u.ambient),this._uMaterialDiffuse&&n.uniform3fv(this._uMaterialDiffuse,u.diffuse),this._uMaterialSpecular&&n.uniform3fv(this._uMaterialSpecular,u.specular),this._uMaterialEmissive&&n.uniform3fv(this._uMaterialEmissive,u.emissive),this._uAlphaModeCutoff&&n.uniform4f(this._uAlphaModeCutoff,1*u.alpha,1===u.alphaMode?1:0,u.alphaCutoff,0),r._ambientMap&&r._ambientMap._state.texture&&this._uMaterialAmbientMap&&(o.bindTexture(this._uMaterialAmbientMap,r._ambientMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uMaterialAmbientMapMatrix&&n.uniformMatrix4fv(this._uMaterialAmbientMapMatrix,!1,r._ambientMap._state.matrix)),r._diffuseMap&&r._diffuseMap._state.texture&&this._uDiffuseMap&&(o.bindTexture(this._uDiffuseMap,r._diffuseMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uDiffuseMapMatrix&&n.uniformMatrix4fv(this._uDiffuseMapMatrix,!1,r._diffuseMap._state.matrix)),r._specularMap&&r._specularMap._state.texture&&this._uSpecularMap&&(o.bindTexture(this._uSpecularMap,r._specularMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uSpecularMapMatrix&&n.uniformMatrix4fv(this._uSpecularMapMatrix,!1,r._specularMap._state.matrix)),r._emissiveMap&&r._emissiveMap._state.texture&&this._uEmissiveMap&&(o.bindTexture(this._uEmissiveMap,r._emissiveMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uEmissiveMapMatrix&&n.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,r._emissiveMap._state.matrix)),r._alphaMap&&r._alphaMap._state.texture&&this._uAlphaMap&&(o.bindTexture(this._uAlphaMap,r._alphaMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uAlphaMapMatrix&&n.uniformMatrix4fv(this._uAlphaMapMatrix,!1,r._alphaMap._state.matrix)),r._reflectivityMap&&r._reflectivityMap._state.texture&&this._uReflectivityMap&&(o.bindTexture(this._uReflectivityMap,r._reflectivityMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,this._uReflectivityMapMatrix&&n.uniformMatrix4fv(this._uReflectivityMapMatrix,!1,r._reflectivityMap._state.matrix)),r._normalMap&&r._normalMap._state.texture&&this._uNormalMap&&(o.bindTexture(this._uNormalMap,r._normalMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uNormalMapMatrix&&n.uniformMatrix4fv(this._uNormalMapMatrix,!1,r._normalMap._state.matrix)),r._occlusionMap&&r._occlusionMap._state.texture&&this._uOcclusionMap&&(o.bindTexture(this._uOcclusionMap,r._occlusionMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uOcclusionMapMatrix&&n.uniformMatrix4fv(this._uOcclusionMapMatrix,!1,r._occlusionMap._state.matrix)),r._diffuseFresnel&&(this._uDiffuseFresnelEdgeBias&&n.uniform1f(this._uDiffuseFresnelEdgeBias,r._diffuseFresnel.edgeBias),this._uDiffuseFresnelCenterBias&&n.uniform1f(this._uDiffuseFresnelCenterBias,r._diffuseFresnel.centerBias),this._uDiffuseFresnelEdgeColor&&n.uniform3fv(this._uDiffuseFresnelEdgeColor,r._diffuseFresnel.edgeColor),this._uDiffuseFresnelCenterColor&&n.uniform3fv(this._uDiffuseFresnelCenterColor,r._diffuseFresnel.centerColor),this._uDiffuseFresnelPower&&n.uniform1f(this._uDiffuseFresnelPower,r._diffuseFresnel.power)),r._specularFresnel&&(this._uSpecularFresnelEdgeBias&&n.uniform1f(this._uSpecularFresnelEdgeBias,r._specularFresnel.edgeBias),this._uSpecularFresnelCenterBias&&n.uniform1f(this._uSpecularFresnelCenterBias,r._specularFresnel.centerBias),this._uSpecularFresnelEdgeColor&&n.uniform3fv(this._uSpecularFresnelEdgeColor,r._specularFresnel.edgeColor),this._uSpecularFresnelCenterColor&&n.uniform3fv(this._uSpecularFresnelCenterColor,r._specularFresnel.centerColor),this._uSpecularFresnelPower&&n.uniform1f(this._uSpecularFresnelPower,r._specularFresnel.power)),r._alphaFresnel&&(this._uAlphaFresnelEdgeBias&&n.uniform1f(this._uAlphaFresnelEdgeBias,r._alphaFresnel.edgeBias),this._uAlphaFresnelCenterBias&&n.uniform1f(this._uAlphaFresnelCenterBias,r._alphaFresnel.centerBias),this._uAlphaFresnelEdgeColor&&n.uniform3fv(this._uAlphaFresnelEdgeColor,r._alphaFresnel.edgeColor),this._uAlphaFresnelCenterColor&&n.uniform3fv(this._uAlphaFresnelCenterColor,r._alphaFresnel.centerColor),this._uAlphaFresnelPower&&n.uniform1f(this._uAlphaFresnelPower,r._alphaFresnel.power)),r._reflectivityFresnel&&(this._uReflectivityFresnelEdgeBias&&n.uniform1f(this._uReflectivityFresnelEdgeBias,r._reflectivityFresnel.edgeBias),this._uReflectivityFresnelCenterBias&&n.uniform1f(this._uReflectivityFresnelCenterBias,r._reflectivityFresnel.centerBias),this._uReflectivityFresnelEdgeColor&&n.uniform3fv(this._uReflectivityFresnelEdgeColor,r._reflectivityFresnel.edgeColor),this._uReflectivityFresnelCenterColor&&n.uniform3fv(this._uReflectivityFresnelCenterColor,r._reflectivityFresnel.centerColor),this._uReflectivityFresnelPower&&n.uniform1f(this._uReflectivityFresnelPower,r._reflectivityFresnel.power)),r._emissiveFresnel&&(this._uEmissiveFresnelEdgeBias&&n.uniform1f(this._uEmissiveFresnelEdgeBias,r._emissiveFresnel.edgeBias),this._uEmissiveFresnelCenterBias&&n.uniform1f(this._uEmissiveFresnelCenterBias,r._emissiveFresnel.centerBias),this._uEmissiveFresnelEdgeColor&&n.uniform3fv(this._uEmissiveFresnelEdgeColor,r._emissiveFresnel.edgeColor),this._uEmissiveFresnelCenterColor&&n.uniform3fv(this._uEmissiveFresnelCenterColor,r._emissiveFresnel.centerColor),this._uEmissiveFresnelPower&&n.uniform1f(this._uEmissiveFresnelPower,r._emissiveFresnel.power));break;case"MetallicMaterial":this._uBaseColor&&n.uniform3fv(this._uBaseColor,u.baseColor),this._uMaterialMetallic&&n.uniform1f(this._uMaterialMetallic,u.metallic),this._uMaterialRoughness&&n.uniform1f(this._uMaterialRoughness,u.roughness),this._uMaterialSpecularF0&&n.uniform1f(this._uMaterialSpecularF0,u.specularF0),this._uMaterialEmissive&&n.uniform3fv(this._uMaterialEmissive,u.emissive),this._uAlphaModeCutoff&&n.uniform4f(this._uAlphaModeCutoff,1*u.alpha,1===u.alphaMode?1:0,u.alphaCutoff,0);var P=r._baseColorMap;P&&P._state.texture&&this._uBaseColorMap&&(o.bindTexture(this._uBaseColorMap,P._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uBaseColorMapMatrix&&n.uniformMatrix4fv(this._uBaseColorMapMatrix,!1,P._state.matrix));var T=r._metallicMap;T&&T._state.texture&&this._uMetallicMap&&(o.bindTexture(this._uMetallicMap,T._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uMetallicMapMatrix&&n.uniformMatrix4fv(this._uMetallicMapMatrix,!1,T._state.matrix));var w=r._roughnessMap;w&&w._state.texture&&this._uRoughnessMap&&(o.bindTexture(this._uRoughnessMap,w._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uRoughnessMapMatrix&&n.uniformMatrix4fv(this._uRoughnessMapMatrix,!1,w._state.matrix));var M=r._metallicRoughnessMap;M&&M._state.texture&&this._uMetallicRoughnessMap&&(o.bindTexture(this._uMetallicRoughnessMap,M._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uMetallicRoughnessMapMatrix&&n.uniformMatrix4fv(this._uMetallicRoughnessMapMatrix,!1,M._state.matrix)),(A=r._emissiveMap)&&A._state.texture&&this._uEmissiveMap&&(o.bindTexture(this._uEmissiveMap,A._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uEmissiveMapMatrix&&n.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,A._state.matrix)),(k=r._occlusionMap)&&r._occlusionMap._state.texture&&this._uOcclusionMap&&(o.bindTexture(this._uOcclusionMap,k._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uOcclusionMapMatrix&&n.uniformMatrix4fv(this._uOcclusionMapMatrix,!1,k._state.matrix)),(E=r._alphaMap)&&E._state.texture&&this._uAlphaMap&&(o.bindTexture(this._uAlphaMap,E._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uAlphaMapMatrix&&n.uniformMatrix4fv(this._uAlphaMapMatrix,!1,E._state.matrix)),(F=r._normalMap)&&F._state.texture&&this._uNormalMap&&(o.bindTexture(this._uNormalMap,F._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uNormalMapMatrix&&n.uniformMatrix4fv(this._uNormalMapMatrix,!1,F._state.matrix));break;case"SpecularMaterial":this._uMaterialDiffuse&&n.uniform3fv(this._uMaterialDiffuse,u.diffuse),this._uMaterialSpecular&&n.uniform3fv(this._uMaterialSpecular,u.specular),this._uMaterialGlossiness&&n.uniform1f(this._uMaterialGlossiness,u.glossiness),this._uMaterialReflectivity&&n.uniform1f(this._uMaterialReflectivity,u.reflectivity),this._uMaterialEmissive&&n.uniform3fv(this._uMaterialEmissive,u.emissive),this._uAlphaModeCutoff&&n.uniform4f(this._uAlphaModeCutoff,1*u.alpha,1===u.alphaMode?1:0,u.alphaCutoff,0);var I=r._diffuseMap;I&&I._state.texture&&this._uDiffuseMap&&(o.bindTexture(this._uDiffuseMap,I._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uDiffuseMapMatrix&&n.uniformMatrix4fv(this._uDiffuseMapMatrix,!1,I._state.matrix));var C=r._specularMap;C&&C._state.texture&&this._uSpecularMap&&(o.bindTexture(this._uSpecularMap,C._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uSpecularMapMatrix&&n.uniformMatrix4fv(this._uSpecularMapMatrix,!1,C._state.matrix));var D=r._glossinessMap;D&&D._state.texture&&this._uGlossinessMap&&(o.bindTexture(this._uGlossinessMap,D._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uGlossinessMapMatrix&&n.uniformMatrix4fv(this._uGlossinessMapMatrix,!1,D._state.matrix));var A,k,E,F,R=r._specularGlossinessMap;R&&R._state.texture&&this._uSpecularGlossinessMap&&(o.bindTexture(this._uSpecularGlossinessMap,R._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uSpecularGlossinessMapMatrix&&n.uniformMatrix4fv(this._uSpecularGlossinessMapMatrix,!1,R._state.matrix)),(A=r._emissiveMap)&&A._state.texture&&this._uEmissiveMap&&(o.bindTexture(this._uEmissiveMap,A._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uEmissiveMapMatrix&&n.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,A._state.matrix)),(k=r._occlusionMap)&&k._state.texture&&this._uOcclusionMap&&(o.bindTexture(this._uOcclusionMap,k._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uOcclusionMapMatrix&&n.uniformMatrix4fv(this._uOcclusionMapMatrix,!1,k._state.matrix)),(E=r._alphaMap)&&E._state.texture&&this._uAlphaMap&&(o.bindTexture(this._uAlphaMap,E._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uAlphaMapMatrix&&n.uniformMatrix4fv(this._uAlphaMapMatrix,!1,E._state.matrix)),(F=r._normalMap)&&F._state.texture&&this._uNormalMap&&(o.bindTexture(this._uNormalMap,F._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++,this._uNormalMapMatrix&&n.uniformMatrix4fv(this._uNormalMapMatrix,!1,F._state.matrix))}this._lastMaterialId=u.id}if(n.uniformMatrix4fv(this._uModelMatrix,n.FALSE,t.worldMatrix),this._uModelNormalMatrix&&n.uniformMatrix4fv(this._uModelNormalMatrix,n.FALSE,t.worldNormalMatrix),this._uClippable&&n.uniform1i(this._uClippable,a.clippable),this._uColorize){var S=a.colorize,O=this._lastColorize;O[0]===S[0]&&O[1]===S[1]&&O[2]===S[2]&&O[3]===S[3]||(n.uniform4fv(this._uColorize,S),O[0]=S[0],O[1]=S[1],O[2]=S[2],O[3]=S[3])}n.uniform3fv(this._uOffset,a.offset),h.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._uUVDecodeMatrix&&n.uniformMatrix3fv(this._uUVDecodeMatrix,!1,h.uvDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(h.positionsBuf),e.bindArray++),this._aNormal&&(this._aNormal.bindArrayBuffer(h.normalsBuf),e.bindArray++),this._aUV&&(this._aUV.bindArrayBuffer(h.uvBuf),e.bindArray++),this._aColor&&(this._aColor.bindArrayBuffer(h.colorsBuf),e.bindArray++),this._aFlags&&(this._aFlags.bindArrayBuffer(h.flagsBuf),e.bindArray++),h.indicesBuf&&(h.indicesBuf.bind(),e.bindArray++),this._lastGeometryId=h.id),h.indicesBuf?(n.drawElements(h.primitive,h.indicesBuf.numItems,h.indicesBuf.itemType,0),e.drawElements++):h.positions&&(n.drawArrays(n.TRIANGLES,0,h.positions.numItems),e.drawArrays++),p&&n.depthFunc(n.LESS)},ro.prototype._allocate=function(e){var t=e.scene,i=t.canvas.gl,s=e._material,r=t._lightsState,n=t._sectionPlanesState,o=e._material._state;if(this._program=new ht(i,this._shaderSource),this._program.errors)this.errors=this._program.errors;else{var a=this._program;this._uPositionsDecodeMatrix=a.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=a.getLocation("uvDecodeMatrix"),this._uModelMatrix=a.getLocation("modelMatrix"),this._uModelNormalMatrix=a.getLocation("modelNormalMatrix"),this._uViewMatrix=a.getLocation("viewMatrix"),this._uViewNormalMatrix=a.getLocation("viewNormalMatrix"),this._uProjMatrix=a.getLocation("projMatrix"),this._uGammaFactor=a.getLocation("gammaFactor"),this._uLightAmbient=[],this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[],this._uShadowViewMatrix=[],this._uShadowProjMatrix=[],t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=a.getLocation("logDepthBufFC"));for(var u,h=r.lights,l=0,c=h.length;l<c;l++){switch((u=h[l]).type){case"ambient":this._uLightAmbient[l]=a.getLocation("lightAmbient");break;case"dir":this._uLightColor[l]=a.getLocation("lightColor"+l),this._uLightPos[l]=null,this._uLightDir[l]=a.getLocation("lightDir"+l);break;case"point":this._uLightColor[l]=a.getLocation("lightColor"+l),this._uLightPos[l]=a.getLocation("lightPos"+l),this._uLightDir[l]=null,this._uLightAttenuation[l]=a.getLocation("lightAttenuation"+l);break;case"spot":this._uLightColor[l]=a.getLocation("lightColor"+l),this._uLightPos[l]=a.getLocation("lightPos"+l),this._uLightDir[l]=a.getLocation("lightDir"+l),this._uLightAttenuation[l]=a.getLocation("lightAttenuation"+l)}u.castsShadow&&(this._uShadowViewMatrix[l]=a.getLocation("shadowViewMatrix"+l),this._uShadowProjMatrix[l]=a.getLocation("shadowProjMatrix"+l))}r.lightMaps.length>0&&(this._uLightMap="lightMap"),r.reflectionMaps.length>0&&(this._uReflectionMap="reflectionMap"),this._uSectionPlanes=[];for(l=0,c=n.sectionPlanes.length;l<c;l++)this._uSectionPlanes.push({active:a.getLocation("sectionPlaneActive"+l),pos:a.getLocation("sectionPlanePos"+l),dir:a.getLocation("sectionPlaneDir"+l)});switch(this._uPointSize=a.getLocation("pointSize"),o.type){case"LambertMaterial":this._uMaterialColor=a.getLocation("materialColor"),this._uMaterialEmissive=a.getLocation("materialEmissive"),this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff");break;case"PhongMaterial":this._uMaterialAmbient=a.getLocation("materialAmbient"),this._uMaterialDiffuse=a.getLocation("materialDiffuse"),this._uMaterialSpecular=a.getLocation("materialSpecular"),this._uMaterialEmissive=a.getLocation("materialEmissive"),this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff"),this._uMaterialShininess=a.getLocation("materialShininess"),s._ambientMap&&(this._uMaterialAmbientMap="ambientMap",this._uMaterialAmbientMapMatrix=a.getLocation("ambientMapMatrix")),s._diffuseMap&&(this._uDiffuseMap="diffuseMap",this._uDiffuseMapMatrix=a.getLocation("diffuseMapMatrix")),s._specularMap&&(this._uSpecularMap="specularMap",this._uSpecularMapMatrix=a.getLocation("specularMapMatrix")),s._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=a.getLocation("emissiveMapMatrix")),s._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=a.getLocation("alphaMapMatrix")),s._reflectivityMap&&(this._uReflectivityMap="reflectivityMap",this._uReflectivityMapMatrix=a.getLocation("reflectivityMapMatrix")),s._normalMap&&(this._uNormalMap="normalMap",this._uNormalMapMatrix=a.getLocation("normalMapMatrix")),s._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=a.getLocation("occlusionMapMatrix")),s._diffuseFresnel&&(this._uDiffuseFresnelEdgeBias=a.getLocation("diffuseFresnelEdgeBias"),this._uDiffuseFresnelCenterBias=a.getLocation("diffuseFresnelCenterBias"),this._uDiffuseFresnelEdgeColor=a.getLocation("diffuseFresnelEdgeColor"),this._uDiffuseFresnelCenterColor=a.getLocation("diffuseFresnelCenterColor"),this._uDiffuseFresnelPower=a.getLocation("diffuseFresnelPower")),s._specularFresnel&&(this._uSpecularFresnelEdgeBias=a.getLocation("specularFresnelEdgeBias"),this._uSpecularFresnelCenterBias=a.getLocation("specularFresnelCenterBias"),this._uSpecularFresnelEdgeColor=a.getLocation("specularFresnelEdgeColor"),this._uSpecularFresnelCenterColor=a.getLocation("specularFresnelCenterColor"),this._uSpecularFresnelPower=a.getLocation("specularFresnelPower")),s._alphaFresnel&&(this._uAlphaFresnelEdgeBias=a.getLocation("alphaFresnelEdgeBias"),this._uAlphaFresnelCenterBias=a.getLocation("alphaFresnelCenterBias"),this._uAlphaFresnelEdgeColor=a.getLocation("alphaFresnelEdgeColor"),this._uAlphaFresnelCenterColor=a.getLocation("alphaFresnelCenterColor"),this._uAlphaFresnelPower=a.getLocation("alphaFresnelPower")),s._reflectivityFresnel&&(this._uReflectivityFresnelEdgeBias=a.getLocation("reflectivityFresnelEdgeBias"),this._uReflectivityFresnelCenterBias=a.getLocation("reflectivityFresnelCenterBias"),this._uReflectivityFresnelEdgeColor=a.getLocation("reflectivityFresnelEdgeColor"),this._uReflectivityFresnelCenterColor=a.getLocation("reflectivityFresnelCenterColor"),this._uReflectivityFresnelPower=a.getLocation("reflectivityFresnelPower")),s._emissiveFresnel&&(this._uEmissiveFresnelEdgeBias=a.getLocation("emissiveFresnelEdgeBias"),this._uEmissiveFresnelCenterBias=a.getLocation("emissiveFresnelCenterBias"),this._uEmissiveFresnelEdgeColor=a.getLocation("emissiveFresnelEdgeColor"),this._uEmissiveFresnelCenterColor=a.getLocation("emissiveFresnelCenterColor"),this._uEmissiveFresnelPower=a.getLocation("emissiveFresnelPower"));break;case"MetallicMaterial":this._uBaseColor=a.getLocation("materialBaseColor"),this._uMaterialMetallic=a.getLocation("materialMetallic"),this._uMaterialRoughness=a.getLocation("materialRoughness"),this._uMaterialSpecularF0=a.getLocation("materialSpecularF0"),this._uMaterialEmissive=a.getLocation("materialEmissive"),this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff"),s._baseColorMap&&(this._uBaseColorMap="baseColorMap",this._uBaseColorMapMatrix=a.getLocation("baseColorMapMatrix")),s._metallicMap&&(this._uMetallicMap="metallicMap",this._uMetallicMapMatrix=a.getLocation("metallicMapMatrix")),s._roughnessMap&&(this._uRoughnessMap="roughnessMap",this._uRoughnessMapMatrix=a.getLocation("roughnessMapMatrix")),s._metallicRoughnessMap&&(this._uMetallicRoughnessMap="metallicRoughnessMap",this._uMetallicRoughnessMapMatrix=a.getLocation("metallicRoughnessMapMatrix")),s._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=a.getLocation("emissiveMapMatrix")),s._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=a.getLocation("occlusionMapMatrix")),s._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=a.getLocation("alphaMapMatrix")),s._normalMap&&(this._uNormalMap="normalMap",this._uNormalMapMatrix=a.getLocation("normalMapMatrix"));break;case"SpecularMaterial":this._uMaterialDiffuse=a.getLocation("materialDiffuse"),this._uMaterialSpecular=a.getLocation("materialSpecular"),this._uMaterialGlossiness=a.getLocation("materialGlossiness"),this._uMaterialReflectivity=a.getLocation("reflectivityFresnel"),this._uMaterialEmissive=a.getLocation("materialEmissive"),this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff"),s._diffuseMap&&(this._uDiffuseMap="diffuseMap",this._uDiffuseMapMatrix=a.getLocation("diffuseMapMatrix")),s._specularMap&&(this._uSpecularMap="specularMap",this._uSpecularMapMatrix=a.getLocation("specularMapMatrix")),s._glossinessMap&&(this._uGlossinessMap="glossinessMap",this._uGlossinessMapMatrix=a.getLocation("glossinessMapMatrix")),s._specularGlossinessMap&&(this._uSpecularGlossinessMap="materialSpecularGlossinessMap",this._uSpecularGlossinessMapMatrix=a.getLocation("materialSpecularGlossinessMapMatrix")),s._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=a.getLocation("emissiveMapMatrix")),s._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=a.getLocation("occlusionMapMatrix")),s._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=a.getLocation("alphaMapMatrix")),s._normalMap&&(this._uNormalMap="normalMap",this._uNormalMapMatrix=a.getLocation("normalMapMatrix"))}this._aPosition=a.getAttribute("position"),this._aNormal=a.getAttribute("normal"),this._aUV=a.getAttribute("uv"),this._aColor=a.getAttribute("color"),this._aFlags=a.getAttribute("flags"),this._uClippable=a.getLocation("clippable"),this._uColorize=a.getLocation("colorize"),this._uOffset=a.getLocation("offset"),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,this._lastColorize=new Float32Array(4),this._baseTextureUnit=0}},ro.prototype._bindProgram=function(e){var t,i=Ze.MAX_TEXTURE_UNITS,s=this._scene,r=s.canvas.gl,n=s._lightsState,o=s.camera.project,a=this._program;if(a.bind(),e.useProgram++,e.textureUnit=0,this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,this._lastColorize[0]=-1,this._lastColorize[1]=-1,this._lastColorize[2]=-1,this._lastColorize[3]=-1,r.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),s.logarithmicDepthBufferEnabled){var u=2/(Math.log(o.far+1)/Math.LN2);r.uniform1f(this._uLogDepthBufFC,u)}for(var h=0,l=n.lights.length;h<l;h++)if(t=n.lights[h],this._uLightAmbient[h])r.uniform4f(this._uLightAmbient[h],t.color[0],t.color[1],t.color[2],t.intensity);else if(this._uLightColor[h]&&r.uniform4f(this._uLightColor[h],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[h]&&(r.uniform3fv(this._uLightPos[h],t.pos),this._uLightAttenuation[h]&&r.uniform1f(this._uLightAttenuation[h],t.attenuation)),this._uLightDir[h]&&r.uniform3fv(this._uLightDir[h],t.dir),t.castsShadow){this._uShadowViewMatrix[h]&&r.uniformMatrix4fv(this._uShadowViewMatrix[h],!1,t.getShadowViewMatrix()),this._uShadowProjMatrix[h]&&r.uniformMatrix4fv(this._uShadowProjMatrix[h],!1,t.getShadowProjMatrix());var c=t.getShadowRenderBuf();c&&(a.bindTexture("shadowMap"+h,c.getTexture(),e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++)}n.lightMaps.length>0&&n.lightMaps[0].texture&&this._uLightMap&&(a.bindTexture(this._uLightMap,n.lightMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++),n.reflectionMaps.length>0&&n.reflectionMaps[0].texture&&this._uReflectionMap&&(a.bindTexture(this._uReflectionMap,n.reflectionMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++),this._uGammaFactor&&r.uniform1f(this._uGammaFactor,s.gammaFactor),this._baseTextureUnit=e.textureUnit};var oo=I((function e(t){w(this,e),this.vertex=function(e){var t=e.scene,i=t._lightsState,s=function(e){var t=e._geometry._state.primitiveName;if((e._geometry._state.autoVertexNormals||e._geometry._state.normalsBuf)&&("triangles"===t||"triangle-strip"===t||"triangle-fan"===t))return!0;return!1}(e),r=t._sectionPlanesState.sectionPlanes.length>0,n=!!e._geometry._state.compressGeometry,o=e._state.billboard,a=e._state.stationary,u=[];u.push("#version 300 es"),u.push("// EmphasisFillShaderSource vertex shader"),u.push("in vec3 position;"),u.push("uniform mat4 modelMatrix;"),u.push("uniform mat4 viewMatrix;"),u.push("uniform mat4 projMatrix;"),u.push("uniform vec4 colorize;"),u.push("uniform vec3 offset;"),n&&u.push("uniform mat4 positionsDecodeMatrix;");t.logarithmicDepthBufferEnabled&&(u.push("uniform float logDepthBufFC;"),u.push("out float vFragDepth;"),u.push("bool isPerspectiveMatrix(mat4 m) {"),u.push("    return (m[2][3] == - 1.0);"),u.push("}"),u.push("out float isPerspective;"));r&&u.push("out vec4 vWorldPosition;");if(u.push("uniform vec4   lightAmbient;"),u.push("uniform vec4   fillColor;"),s){u.push("in vec3 normal;"),u.push("uniform mat4 modelNormalMatrix;"),u.push("uniform mat4 viewNormalMatrix;");for(var h=0,l=i.lights.length;h<l;h++){var c=i.lights[h];"ambient"!==c.type&&(u.push("uniform vec4 lightColor"+h+";"),"dir"===c.type&&u.push("uniform vec3 lightDir"+h+";"),"point"===c.type&&u.push("uniform vec3 lightPos"+h+";"),"spot"===c.type&&u.push("uniform vec3 lightPos"+h+";"))}n&&(u.push("vec3 octDecode(vec2 oct) {"),u.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),u.push("    if (v.z < 0.0) {"),u.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),u.push("    }"),u.push("    return normalize(v);"),u.push("}"))}u.push("out vec4 vColor;"),("spherical"===o||"cylindrical"===o)&&(u.push("void billboard(inout mat4 mat) {"),u.push("   mat[0][0] = 1.0;"),u.push("   mat[0][1] = 0.0;"),u.push("   mat[0][2] = 0.0;"),"spherical"===o&&(u.push("   mat[1][0] = 0.0;"),u.push("   mat[1][1] = 1.0;"),u.push("   mat[1][2] = 0.0;")),u.push("   mat[2][0] = 0.0;"),u.push("   mat[2][1] = 0.0;"),u.push("   mat[2][2] =1.0;"),u.push("}"));u.push("void main(void) {"),u.push("vec4 localPosition = vec4(position, 1.0); "),u.push("vec4 worldPosition;"),n&&u.push("localPosition = positionsDecodeMatrix * localPosition;");s&&(n?u.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):u.push("vec4 localNormal = vec4(normal, 0.0); "),u.push("mat4 modelNormalMatrix2 = modelNormalMatrix;"),u.push("mat4 viewNormalMatrix2 = viewNormalMatrix;"));u.push("mat4 viewMatrix2 = viewMatrix;"),u.push("mat4 modelMatrix2 = modelMatrix;"),a&&u.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===o||"cylindrical"===o?(u.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),u.push("billboard(modelMatrix2);"),u.push("billboard(viewMatrix2);"),u.push("billboard(modelViewMatrix);"),s&&(u.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),u.push("billboard(modelNormalMatrix2);"),u.push("billboard(viewNormalMatrix2);"),u.push("billboard(modelViewNormalMatrix);")),u.push("worldPosition = modelMatrix2 * localPosition;"),u.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(u.push("worldPosition = modelMatrix2 * localPosition;"),u.push("worldPosition.xyz = worldPosition.xyz + offset;"),u.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));s&&u.push("vec3 viewNormal = normalize((viewNormalMatrix2 * modelNormalMatrix2 * localNormal).xyz);");if(u.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),u.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),u.push("float lambertian = 1.0;"),s)for(var p=0,d=i.lights.length;p<d;p++){var f=i.lights[p];if("ambient"!==f.type){if("dir"===f.type)"view"===f.space?u.push("viewLightDir = normalize(lightDir"+p+");"):u.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+p+", 0.0)).xyz);");else{if("point"!==f.type)continue;"view"===f.space?u.push("viewLightDir = normalize(lightPos"+p+" - viewPosition.xyz);"):u.push("viewLightDir = normalize((viewMatrix2 * vec4(lightPos"+p+", 0.0)).xyz);")}u.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),u.push("reflectedColor += lambertian * (lightColor"+p+".rgb * lightColor"+p+".a);")}}u.push("vColor = vec4(reflectedColor * fillColor.rgb, fillColor.a);"),r&&u.push("vWorldPosition = worldPosition;");"points"===e._geometry._state.primitiveName&&u.push("gl_PointSize = pointSize;");u.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(u.push("vFragDepth = 1.0 + clipPos.w;"),u.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return u.push("gl_Position = clipPos;"),u.push("}"),u}(t),this.fragment=function(e){var t=e.scene,i=e.scene._sectionPlanesState,s=e.scene.gammaOutput,r=i.sectionPlanes.length>0,n=[];n.push("#version 300 es"),n.push("// Lambertian drawing fragment shader"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),t.logarithmicDepthBufferEnabled&&(n.push("in float isPerspective;"),n.push("uniform float logDepthBufFC;"),n.push("in float vFragDepth;"));s&&(n.push("uniform float gammaFactor;"),n.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),n.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),n.push("}"));if(r){n.push("in vec4 vWorldPosition;"),n.push("uniform bool clippable;");for(var o=0,a=i.sectionPlanes.length;o<a;o++)n.push("uniform bool sectionPlaneActive"+o+";"),n.push("uniform vec3 sectionPlanePos"+o+";"),n.push("uniform vec3 sectionPlaneDir"+o+";")}if(n.push("in vec4 vColor;"),n.push("out vec4 outColor;"),n.push("void main(void) {"),r){n.push("if (clippable) {"),n.push("  float dist = 0.0;");for(var u=0,h=i.sectionPlanes.length;u<h;u++)n.push("if (sectionPlaneActive"+u+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+u+".xyz, vWorldPosition.xyz - sectionPlanePos"+u+".xyz), 0.0, 1000.0);"),n.push("}");n.push("  if (dist > 0.0) { discard; }"),n.push("}")}"points"===e._geometry._state.primitiveName&&(n.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),n.push("float r = dot(cxy, cxy);"),n.push("if (r > 1.0) {"),n.push("   discard;"),n.push("}"));t.logarithmicDepthBufferEnabled&&n.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");s?n.push("outColor = linearToGamma(vColor, gammaFactor);"):n.push("outColor = vColor;");return n.push("}"),n}(t)}));var ao=new G({}),uo=q.vec3(),ho=function(e,t){this.id=ao.addItem({}),this._hash=e,this._scene=t.scene,this._useCount=0,this._shaderSource=new oo(t),this._allocate(t)},lo={};ho.get=function(e){var t=[e.scene.id,e.scene.gammaOutput?"go":"",e.scene._sectionPlanesState.getHash(),e._geometry._state.normalsBuf?"n":"",e._geometry._state.compressGeometry?"cp":"",e._state.hash].join(";"),i=lo[t];return i||(i=new ho(t,e),lo[t]=i,ee.memory.programs++),i._useCount++,i},ho.prototype.put=function(){0==--this._useCount&&(ao.removeItem(this.id),this._program&&this._program.destroy(),delete lo[this._hash],ee.memory.programs--)},ho.prototype.webglContextRestored=function(){this._program=null},ho.prototype.drawMesh=function(e,t,i){this._program||this._allocate(t);var s=this._scene,r=s.camera,n=s.canvas.gl,o=0===i?t._xrayMaterial._state:1===i?t._highlightMaterial._state:t._selectedMaterial._state,a=t._state,u=t._geometry._state,h=t.origin;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniformMatrix4fv(this._uViewMatrix,!1,h?e.getRTCViewMatrix(a.originHash,h):r.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.viewNormalMatrix),a.clippable){var l=s._sectionPlanesState.sectionPlanes.length;if(l>0)for(var c=s._sectionPlanesState.sectionPlanes,p=t.renderFlags,d=0;d<l;d++){var f=this._uSectionPlanes[d];if(f){var m=p.sectionPlanesActivePerLayer[d];if(n.uniform1i(f.active,m?1:0),m){var v=c[d];n.uniform3fv(f.pos,h?Ee(v.dist,v.dir,h,uo):v.pos),n.uniform3fv(f.dir,v.dir)}}}}if(o.id!==this._lastMaterialId){var g=o.fillColor,_=o.backfaces;e.backfaces!==_&&(_?n.disable(n.CULL_FACE):n.enable(n.CULL_FACE),e.backfaces=_),n.uniform4f(this._uFillColor,g[0],g[1],g[2],o.fillAlpha),this._lastMaterialId=o.id}n.uniformMatrix4fv(this._uModelMatrix,n.FALSE,t.worldMatrix),this._uModelNormalMatrix&&n.uniformMatrix4fv(this._uModelNormalMatrix,n.FALSE,t.worldNormalMatrix),this._uClippable&&n.uniform1i(this._uClippable,a.clippable),n.uniform3fv(this._uOffset,a.offset),u.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._uUVDecodeMatrix&&n.uniformMatrix3fv(this._uUVDecodeMatrix,!1,u.uvDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(u.positionsBuf),e.bindArray++),this._aNormal&&(this._aNormal.bindArrayBuffer(u.normalsBuf),e.bindArray++),u.indicesBuf?(u.indicesBuf.bind(),e.bindArray++):u.positionsBuf,this._lastGeometryId=u.id),u.indicesBuf?(n.drawElements(u.primitive,u.indicesBuf.numItems,u.indicesBuf.itemType,0),e.drawElements++):u.positionsBuf&&(n.drawArrays(n.TRIANGLES,0,u.positionsBuf.numItems),e.drawArrays++)},ho.prototype._allocate=function(e){var t=e.scene,i=t._lightsState,s=t._sectionPlanesState,r=t.canvas.gl;if(this._program=new ht(r,this._shaderSource),this._program.errors)this.errors=this._program.errors;else{var n=this._program;this._uPositionsDecodeMatrix=n.getLocation("positionsDecodeMatrix"),this._uModelMatrix=n.getLocation("modelMatrix"),this._uModelNormalMatrix=n.getLocation("modelNormalMatrix"),this._uViewMatrix=n.getLocation("viewMatrix"),this._uViewNormalMatrix=n.getLocation("viewNormalMatrix"),this._uProjMatrix=n.getLocation("projMatrix"),this._uLightAmbient=[],this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];for(var o=0,a=i.lights.length;o<a;o++){switch(i.lights[o].type){case"ambient":this._uLightAmbient[o]=n.getLocation("lightAmbient");break;case"dir":this._uLightColor[o]=n.getLocation("lightColor"+o),this._uLightPos[o]=null,this._uLightDir[o]=n.getLocation("lightDir"+o);break;case"point":this._uLightColor[o]=n.getLocation("lightColor"+o),this._uLightPos[o]=n.getLocation("lightPos"+o),this._uLightDir[o]=null,this._uLightAttenuation[o]=n.getLocation("lightAttenuation"+o)}}this._uSectionPlanes=[];for(var u=0,h=s.sectionPlanes.length;u<h;u++)this._uSectionPlanes.push({active:n.getLocation("sectionPlaneActive"+u),pos:n.getLocation("sectionPlanePos"+u),dir:n.getLocation("sectionPlaneDir"+u)});this._uFillColor=n.getLocation("fillColor"),this._aPosition=n.getAttribute("position"),this._aNormal=n.getAttribute("normal"),this._uClippable=n.getLocation("clippable"),this._uGammaFactor=n.getLocation("gammaFactor"),this._uOffset=n.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=n.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null}},ho.prototype._bindProgram=function(e){var t=this._scene,i=t.canvas.gl,s=t._lightsState,r=t.camera,n=r.project;if(this._program.bind(),e.useProgram++,e.textureUnit=0,this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,this._lastIndicesBufId=null,i.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.normalMatrix),i.uniformMatrix4fv(this._uProjMatrix,!1,n.matrix),t.logarithmicDepthBufferEnabled){var o=2/(Math.log(n.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,o)}for(var a=0,u=s.lights.length;a<u;a++){var h=s.lights[a];this._uLightAmbient[a]?i.uniform4f(this._uLightAmbient[a],h.color[0],h.color[1],h.color[2],h.intensity):(this._uLightColor[a]&&i.uniform4f(this._uLightColor[a],h.color[0],h.color[1],h.color[2],h.intensity),this._uLightPos[a]&&(i.uniform3fv(this._uLightPos[a],h.pos),this._uLightAttenuation[a]&&i.uniform1f(this._uLightAttenuation[a],h.attenuation)),this._uLightDir[a]&&i.uniform3fv(this._uLightDir[a],h.dir))}this._uGammaFactor&&i.uniform1f(this._uGammaFactor,t.gammaFactor)};var co=I((function e(t){w(this,e),this.vertex=function(e){var t=e.scene,i=t._sectionPlanesState.sectionPlanes.length>0,s=!!e._geometry._state.compressGeometry,r=e._state.billboard,n=e._state.stationary,o=[];o.push("#version 300 es"),o.push("// Edges drawing vertex shader"),o.push("in vec3 position;"),o.push("uniform mat4 modelMatrix;"),o.push("uniform mat4 viewMatrix;"),o.push("uniform mat4 projMatrix;"),o.push("uniform vec4 edgeColor;"),o.push("uniform vec3 offset;"),s&&o.push("uniform mat4 positionsDecodeMatrix;");t.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),o.push("out float vFragDepth;"),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("out float isPerspective;"));i&&o.push("out vec4 vWorldPosition;");o.push("out vec4 vColor;"),("spherical"===r||"cylindrical"===r)&&(o.push("void billboard(inout mat4 mat) {"),o.push("   mat[0][0] = 1.0;"),o.push("   mat[0][1] = 0.0;"),o.push("   mat[0][2] = 0.0;"),"spherical"===r&&(o.push("   mat[1][0] = 0.0;"),o.push("   mat[1][1] = 1.0;"),o.push("   mat[1][2] = 0.0;")),o.push("   mat[2][0] = 0.0;"),o.push("   mat[2][1] = 0.0;"),o.push("   mat[2][2] =1.0;"),o.push("}"));o.push("void main(void) {"),o.push("vec4 localPosition = vec4(position, 1.0); "),o.push("vec4 worldPosition;"),s&&o.push("localPosition = positionsDecodeMatrix * localPosition;");o.push("mat4 viewMatrix2 = viewMatrix;"),o.push("mat4 modelMatrix2 = modelMatrix;"),n&&o.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===r||"cylindrical"===r?(o.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),o.push("billboard(modelMatrix2);"),o.push("billboard(viewMatrix2);"),o.push("billboard(modelViewMatrix);"),o.push("worldPosition = modelMatrix2 * localPosition;"),o.push("worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(o.push("worldPosition = modelMatrix2 * localPosition;"),o.push("worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));o.push("vColor = edgeColor;"),i&&o.push("vWorldPosition = worldPosition;");o.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(o.push("vFragDepth = 1.0 + clipPos.w;"),o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return o.push("gl_Position = clipPos;"),o.push("}"),o}(t),this.fragment=function(e){var t=e.scene,i=e.scene._sectionPlanesState,s=e.scene.gammaOutput,r=i.sectionPlanes.length>0,n=[];n.push("#version 300 es"),n.push("// Edges drawing fragment shader"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),t.logarithmicDepthBufferEnabled&&(n.push("in float isPerspective;"),n.push("uniform float logDepthBufFC;"),n.push("in float vFragDepth;"));s&&(n.push("uniform float gammaFactor;"),n.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),n.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),n.push("}"));if(r){n.push("in vec4 vWorldPosition;"),n.push("uniform bool clippable;");for(var o=0,a=i.sectionPlanes.length;o<a;o++)n.push("uniform bool sectionPlaneActive"+o+";"),n.push("uniform vec3 sectionPlanePos"+o+";"),n.push("uniform vec3 sectionPlaneDir"+o+";")}if(n.push("in vec4 vColor;"),n.push("out vec4 outColor;"),n.push("void main(void) {"),r){n.push("if (clippable) {"),n.push("  float dist = 0.0;");for(var u=0,h=i.sectionPlanes.length;u<h;u++)n.push("if (sectionPlaneActive"+u+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+u+".xyz, vWorldPosition.xyz - sectionPlanePos"+u+".xyz), 0.0, 1000.0);"),n.push("}");n.push("  if (dist > 0.0) { discard; }"),n.push("}")}t.logarithmicDepthBufferEnabled&&n.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");s?n.push("outColor = linearToGamma(vColor, gammaFactor);"):n.push("outColor = vColor;");return n.push("}"),n}(t)}));var po=new G({}),fo=q.vec3(),mo=function(e,t){this.id=po.addItem({}),this._hash=e,this._scene=t.scene,this._useCount=0,this._shaderSource=new co(t),this._allocate(t)},vo={};mo.get=function(e){var t=[e.scene.id,e.scene.gammaOutput?"go":"",e.scene._sectionPlanesState.getHash(),e._geometry._state.compressGeometry?"cp":"",e._state.hash].join(";"),i=vo[t];return i||(i=new mo(t,e),vo[t]=i,ee.memory.programs++),i._useCount++,i},mo.prototype.put=function(){0==--this._useCount&&(po.removeItem(this.id),this._program&&this._program.destroy(),delete vo[this._hash],ee.memory.programs--)},mo.prototype.webglContextRestored=function(){this._program=null},mo.prototype.drawMesh=function(e,t,i){this._program||this._allocate(t);var s,r,n=this._scene,o=n.camera,a=n.canvas.gl,u=t._state,h=t._geometry,l=h._state,c=t.origin;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniformMatrix4fv(this._uViewMatrix,!1,c?e.getRTCViewMatrix(u.originHash,c):o.viewMatrix),u.clippable){var p=n._sectionPlanesState.sectionPlanes.length;if(p>0)for(var d=n._sectionPlanesState.sectionPlanes,f=t.renderFlags,m=0;m<p;m++){var v=this._uSectionPlanes[m];if(v){var g=f.sectionPlanesActivePerLayer[m];if(a.uniform1i(v.active,g?1:0),g){var _=d[m];a.uniform3fv(v.pos,c?Ee(_.dist,_.dir,c,fo):_.pos),a.uniform3fv(v.dir,_.dir)}}}}switch(i){case 0:s=t._xrayMaterial._state;break;case 1:s=t._highlightMaterial._state;break;case 2:s=t._selectedMaterial._state;break;default:s=t._edgeMaterial._state}if(s.id!==this._lastMaterialId){var y=s.backfaces;if(e.backfaces!==y&&(y?a.disable(a.CULL_FACE):a.enable(a.CULL_FACE),e.backfaces=y),e.lineWidth!==s.edgeWidth&&(a.lineWidth(s.edgeWidth),e.lineWidth=s.edgeWidth),this._uEdgeColor){var b=s.edgeColor,x=s.edgeAlpha;a.uniform4f(this._uEdgeColor,b[0],b[1],b[2],x)}this._lastMaterialId=s.id}a.uniformMatrix4fv(this._uModelMatrix,a.FALSE,t.worldMatrix),this._uClippable&&a.uniform1i(this._uClippable,u.clippable),a.uniform3fv(this._uOffset,u.offset),l.primitive===a.TRIANGLES?r=h._getEdgeIndices():l.primitive===a.LINES&&(r=l.indicesBuf),r&&(l.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(l.positionsBuf,l.compressGeometry?a.UNSIGNED_SHORT:a.FLOAT),e.bindArray++),r.bind(),e.bindArray++,this._lastGeometryId=l.id),a.drawElements(a.LINES,r.numItems,r.itemType,0),e.drawElements++)},mo.prototype._allocate=function(e){var t=e.scene,i=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new ht(i,this._shaderSource),this._program.errors)this.errors=this._program.errors;else{var r=this._program;this._uPositionsDecodeMatrix=r.getLocation("positionsDecodeMatrix"),this._uModelMatrix=r.getLocation("modelMatrix"),this._uViewMatrix=r.getLocation("viewMatrix"),this._uProjMatrix=r.getLocation("projMatrix"),this._uSectionPlanes=[];for(var n=0,o=s.sectionPlanes.length;n<o;n++)this._uSectionPlanes.push({active:r.getLocation("sectionPlaneActive"+n),pos:r.getLocation("sectionPlanePos"+n),dir:r.getLocation("sectionPlaneDir"+n)});this._uEdgeColor=r.getLocation("edgeColor"),this._aPosition=r.getAttribute("position"),this._uClippable=r.getLocation("clippable"),this._uGammaFactor=r.getLocation("gammaFactor"),this._uOffset=r.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=r.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null}},mo.prototype._bindProgram=function(e){var t=this._program,i=this._scene,s=i.canvas.gl,r=i.camera.project;if(t.bind(),e.useProgram++,this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,s.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),i.logarithmicDepthBufferEnabled){var n=2/(Math.log(r.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,n)}this._uGammaFactor&&s.uniform1f(this._uGammaFactor,i.gammaFactor)};var go=I((function e(t){w(this,e),this.vertex=function(e){var t=e.scene,i=t._sectionPlanesState.sectionPlanes.length>0,s=!!e._geometry._state.compressGeometry,r=e._state.billboard,n=e._state.stationary,o=[];o.push("#version 300 es"),o.push("// Mesh picking vertex shader"),o.push("in vec3 position;"),o.push("uniform mat4 modelMatrix;"),o.push("uniform mat4 viewMatrix;"),o.push("uniform mat4 projMatrix;"),o.push("out vec4 vViewPosition;"),o.push("uniform vec3 offset;"),s&&o.push("uniform mat4 positionsDecodeMatrix;");i&&o.push("out vec4 vWorldPosition;");t.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),o.push("out float vFragDepth;"),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("out float isPerspective;"));"spherical"!==r&&"cylindrical"!==r||(o.push("void billboard(inout mat4 mat) {"),o.push("   mat[0][0] = 1.0;"),o.push("   mat[0][1] = 0.0;"),o.push("   mat[0][2] = 0.0;"),"spherical"===r&&(o.push("   mat[1][0] = 0.0;"),o.push("   mat[1][1] = 1.0;"),o.push("   mat[1][2] = 0.0;")),o.push("   mat[2][0] = 0.0;"),o.push("   mat[2][1] = 0.0;"),o.push("   mat[2][2] =1.0;"),o.push("}"));o.push("void main(void) {"),o.push("vec4 localPosition = vec4(position, 1.0); "),s&&o.push("localPosition = positionsDecodeMatrix * localPosition;");o.push("mat4 viewMatrix2 = viewMatrix;"),o.push("mat4 modelMatrix2 = modelMatrix;"),n&&o.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"!==r&&"cylindrical"!==r||(o.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),o.push("billboard(modelMatrix2);"),o.push("billboard(viewMatrix2);"));o.push("   vec4 worldPosition = modelMatrix2 * localPosition;"),o.push("   worldPosition.xyz = worldPosition.xyz + offset;"),o.push("   vec4 viewPosition = viewMatrix2 * worldPosition;"),i&&o.push("   vWorldPosition = worldPosition;");o.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(o.push("vFragDepth = 1.0 + clipPos.w;"),o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return o.push("gl_Position = clipPos;"),o.push("}"),o}(t),this.fragment=function(e){var t=e.scene,i=t._sectionPlanesState,s=i.sectionPlanes.length>0,r=[];r.push("#version 300 es"),r.push("// Mesh picking fragment shader"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),t.logarithmicDepthBufferEnabled&&(r.push("in float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("in float vFragDepth;"));if(r.push("uniform vec4 pickColor;"),s){r.push("uniform bool clippable;"),r.push("in vec4 vWorldPosition;");for(var n=0;n<i.sectionPlanes.length;n++)r.push("uniform bool sectionPlaneActive"+n+";"),r.push("uniform vec3 sectionPlanePos"+n+";"),r.push("uniform vec3 sectionPlaneDir"+n+";")}if(r.push("out vec4 outColor;"),r.push("void main(void) {"),s){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(n=0;n<i.sectionPlanes.length;n++)r.push("if (sectionPlaneActive"+n+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}t.logarithmicDepthBufferEnabled&&r.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");return r.push("   outColor = pickColor; "),r.push("}"),r}(t)}));var _o=q.vec3(),yo=function(e,t){this._hash=e,this._shaderSource=new go(t),this._scene=t.scene,this._useCount=0,this._allocate(t)},bo={};yo.get=function(e){var t=[e.scene.canvas.canvas.id,e.scene._sectionPlanesState.getHash(),e._geometry._state.hash,e._state.hash].join(";"),i=bo[t];if(!i){if((i=new yo(t,e)).errors)return console.log(i.errors.join("\n")),null;bo[t]=i,ee.memory.programs++}return i._useCount++,i},yo.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete bo[this._hash],ee.memory.programs--)},yo.prototype.webglContextRestored=function(){this._program=null},yo.prototype.drawMesh=function(e,t){this._program||this._allocate(t);var i=this._scene,s=i.canvas.gl,r=t._state,n=t._material._state,o=t._geometry._state,a=t.origin;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),s.uniformMatrix4fv(this._uViewMatrix,!1,a?e.getRTCPickViewMatrix(r.originHash,a):e.pickViewMatrix),r.clippable){var u=i._sectionPlanesState.sectionPlanes.length;if(u>0)for(var h=i._sectionPlanesState.sectionPlanes,l=t.renderFlags,c=0;c<u;c++){var p=this._uSectionPlanes[c];if(p){var d=l.sectionPlanesActivePerLayer[c];if(s.uniform1i(p.active,d?1:0),d){var f=h[c];s.uniform3fv(p.pos,a?Ee(f.dist,f.dir,a,_o):f.pos),s.uniform3fv(p.dir,f.dir)}}}}if(n.id!==this._lastMaterialId){var m=n.backfaces;e.backfaces!==m&&(m?s.disable(s.CULL_FACE):s.enable(s.CULL_FACE),e.backfaces=m);var v=n.frontface;e.frontface!==v&&(v?s.frontFace(s.CCW):s.frontFace(s.CW),e.frontface=v),this._lastMaterialId=n.id}s.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),s.uniformMatrix4fv(this._uModelMatrix,!1,t.worldMatrix),this._uClippable&&s.uniform1i(this._uClippable,t._state.clippable),s.uniform3fv(this._uOffset,t._state.offset),o.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&s.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,o.positionsDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(o.positionsBuf,o.compressGeometry?s.UNSIGNED_SHORT:s.FLOAT),e.bindArray++),o.indicesBuf&&(o.indicesBuf.bind(),e.bindArray++),this._lastGeometryId=o.id);var g=t._state.pickID,_=g>>24&255,y=g>>16&255,b=g>>8&255,x=255&g;s.uniform4f(this._uPickColor,x/255,b/255,y/255,_/255),o.indicesBuf?(s.drawElements(o.primitive,o.indicesBuf.numItems,o.indicesBuf.itemType,0),e.drawElements++):o.positions&&s.drawArrays(s.TRIANGLES,0,o.positions.numItems)},yo.prototype._allocate=function(e){var t=e.scene,i=t.canvas.gl;if(this._program=new ht(i,this._shaderSource),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uModelMatrix=s.getLocation("modelMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=t._sectionPlanesState.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._uClippable=s.getLocation("clippable"),this._uPickColor=s.getLocation("pickColor"),this._uOffset=s.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastGeometryId=null}},yo.prototype._bindProgram=function(e){var t=this._scene,i=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.useProgram++,t.logarithmicDepthBufferEnabled){var r=2/(Math.log(s.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,r)}this._lastMaterialId=null,this._lastGeometryId=null};var xo=I((function e(t){w(this,e),this.vertex=function(e){var t=e.scene,i=t._sectionPlanesState.sectionPlanes.length>0,s=!!e._geometry._state.compressGeometry;e._state.billboard,e._state.stationary;var r=[];r.push("#version 300 es"),r.push("// Surface picking vertex shader"),r.push("in vec3 position;"),r.push("in vec4 color;"),r.push("uniform mat4 modelMatrix;"),r.push("uniform mat4 viewMatrix;"),r.push("uniform mat4 projMatrix;"),r.push("uniform vec3 offset;"),i&&(r.push("uniform bool clippable;"),r.push("out vec4 vWorldPosition;"));t.logarithmicDepthBufferEnabled&&(r.push("uniform float logDepthBufFC;"),r.push("out float vFragDepth;"),r.push("bool isPerspectiveMatrix(mat4 m) {"),r.push("    return (m[2][3] == - 1.0);"),r.push("}"),r.push("out float isPerspective;"));r.push("out vec4 vColor;"),s&&r.push("uniform mat4 positionsDecodeMatrix;");r.push("void main(void) {"),r.push("vec4 localPosition = vec4(position, 1.0); "),s&&r.push("localPosition = positionsDecodeMatrix * localPosition;");r.push("   vec4 worldPosition = modelMatrix * localPosition; "),r.push("   worldPosition.xyz = worldPosition.xyz + offset;"),r.push("   vec4 viewPosition = viewMatrix * worldPosition;"),i&&r.push("   vWorldPosition = worldPosition;");r.push("   vColor = color;"),r.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(r.push("vFragDepth = 1.0 + clipPos.w;"),r.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return r.push("gl_Position = clipPos;"),r.push("}"),r}(t),this.fragment=function(e){var t=e.scene,i=t._sectionPlanesState,s=i.sectionPlanes.length>0,r=[];r.push("#version 300 es"),r.push("// Surface picking fragment shader"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),r.push("in vec4 vColor;"),t.logarithmicDepthBufferEnabled&&(r.push("in float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("in float vFragDepth;"));if(s){r.push("uniform bool clippable;"),r.push("in vec4 vWorldPosition;");for(var n=0;n<i.sectionPlanes.length;n++)r.push("uniform bool sectionPlaneActive"+n+";"),r.push("uniform vec3 sectionPlanePos"+n+";"),r.push("uniform vec3 sectionPlaneDir"+n+";")}if(r.push("out vec4 outColor;"),r.push("void main(void) {"),s){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(var o=0;o<i.sectionPlanes.length;o++)r.push("if (sectionPlaneActive"+o+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}t.logarithmicDepthBufferEnabled&&r.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");return r.push("   outColor = vColor;"),r.push("}"),r}(t)}));var Po=q.vec3(),To=function(e,t){this._hash=e,this._scene=t.scene,this._useCount=0,this._shaderSource=new xo(t),this._allocate(t)},wo={};To.get=function(e){var t=[e.scene.canvas.canvas.id,e.scene._sectionPlanesState.getHash(),e._geometry._state.compressGeometry?"cp":"",e._state.hash].join(";"),i=wo[t];if(!i){if((i=new To(t,e)).errors)return console.log(i.errors.join("\n")),null;wo[t]=i,ee.memory.programs++}return i._useCount++,i},To.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete wo[this._hash],ee.memory.programs--)},To.prototype.webglContextRestored=function(){this._program=null},To.prototype.drawMesh=function(e,t){this._program||this._allocate(t);var i=this._scene,s=i.canvas.gl,r=t._state,n=t._material._state,o=t._geometry,a=t._geometry._state,u=t.origin,h=n.backfaces,l=n.frontface,c=i.camera.project,p=o._getPickTrianglePositions(),d=o._getPickTriangleColors();if(this._program.bind(),e.useProgram++,i.logarithmicDepthBufferEnabled){var f=2/(Math.log(c.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,f)}if(s.uniformMatrix4fv(this._uViewMatrix,!1,u?e.getRTCPickViewMatrix(r.originHash,u):e.pickViewMatrix),r.clippable){var m=i._sectionPlanesState.sectionPlanes.length;if(m>0)for(var v=i._sectionPlanesState.sectionPlanes,g=t.renderFlags,_=0;_<m;_++){var y=this._uSectionPlanes[_];if(y){var b=g.sectionPlanesActivePerLayer[_];if(s.uniform1i(y.active,b?1:0),b){var x=v[_];s.uniform3fv(y.pos,u?Ee(x.dist,x.dir,u,Po):x.pos),s.uniform3fv(y.dir,x.dir)}}}}s.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),i.logarithmicDepthBufferEnabled&&s.uniform1f(this._uZFar,i.camera.project.far),e.backfaces!==h&&(h?s.disable(s.CULL_FACE):s.enable(s.CULL_FACE),e.backfaces=h),e.frontface!==l&&(l?s.frontFace(s.CCW):s.frontFace(s.CW),e.frontface=l),s.uniformMatrix4fv(this._uModelMatrix,!1,t.worldMatrix),this._uClippable&&s.uniform1i(this._uClippable,t._state.clippable),s.uniform3fv(this._uOffset,t._state.offset),this._uPositionsDecodeMatrix?(s.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,a.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(p,a.compressGeometry?s.UNSIGNED_SHORT:s.FLOAT)):this._aPosition.bindArrayBuffer(p),d.bind(),s.enableVertexAttribArray(this._aColor.location),s.vertexAttribPointer(this._aColor.location,d.itemSize,d.itemType,!0,0,0),s.drawArrays(a.primitive,0,p.numItems/3)},To.prototype._allocate=function(e){var t=e.scene,i=t.canvas.gl;if(this._program=new ht(i,this._shaderSource),this._useCount=0,this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uModelMatrix=s.getLocation("modelMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=t._sectionPlanesState.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aColor=s.getAttribute("color"),this._uClippable=s.getLocation("clippable"),this._uOffset=s.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}};var Mo=I((function e(t){w(this,e),this.vertex=function(e){var t=e.scene,i=t._sectionPlanesState.sectionPlanes.length>0,s=!!e._geometry._state.compressGeometry,r=e._state.billboard,n=e._state.stationary,o=[];o.push("#version 300 es"),o.push("// Mesh occlusion vertex shader"),o.push("in vec3 position;"),o.push("uniform mat4 modelMatrix;"),o.push("uniform mat4 viewMatrix;"),o.push("uniform mat4 projMatrix;"),o.push("uniform vec3 offset;"),s&&o.push("uniform mat4 positionsDecodeMatrix;");i&&o.push("out vec4 vWorldPosition;");t.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),o.push("out float vFragDepth;"),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("out float isPerspective;"));"spherical"!==r&&"cylindrical"!==r||(o.push("void billboard(inout mat4 mat) {"),o.push("   mat[0][0] = 1.0;"),o.push("   mat[0][1] = 0.0;"),o.push("   mat[0][2] = 0.0;"),"spherical"===r&&(o.push("   mat[1][0] = 0.0;"),o.push("   mat[1][1] = 1.0;"),o.push("   mat[1][2] = 0.0;")),o.push("   mat[2][0] = 0.0;"),o.push("   mat[2][1] = 0.0;"),o.push("   mat[2][2] =1.0;"),o.push("}"));o.push("void main(void) {"),o.push("vec4 localPosition = vec4(position, 1.0); "),o.push("vec4 worldPosition;"),s&&o.push("localPosition = positionsDecodeMatrix * localPosition;");o.push("mat4 viewMatrix2 = viewMatrix;"),o.push("mat4 modelMatrix2 = modelMatrix;"),n&&o.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===r||"cylindrical"===r?(o.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),o.push("billboard(modelMatrix2);"),o.push("billboard(viewMatrix2);"),o.push("billboard(modelViewMatrix);"),o.push("worldPosition = modelMatrix2 * localPosition;"),o.push("worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(o.push("worldPosition = modelMatrix2 * localPosition;"),o.push("worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));i&&o.push("   vWorldPosition = worldPosition;");o.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(o.push("vFragDepth = 1.0 + clipPos.w;"),o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return o.push("gl_Position = clipPos;"),o.push("}"),o}(t),this.fragment=function(e){var t=e.scene,i=t._sectionPlanesState,s=i.sectionPlanes.length>0,r=[];r.push("#version 300 es"),r.push("// Mesh occlusion fragment shader"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),t.logarithmicDepthBufferEnabled&&(r.push("in float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("in float vFragDepth;"));if(s){r.push("uniform bool clippable;"),r.push("in vec4 vWorldPosition;");for(var n=0;n<i.sectionPlanes.length;n++)r.push("uniform bool sectionPlaneActive"+n+";"),r.push("uniform vec3 sectionPlanePos"+n+";"),r.push("uniform vec3 sectionPlaneDir"+n+";")}if(r.push("out vec4 outColor;"),r.push("void main(void) {"),s){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(n=0;n<i.sectionPlanes.length;n++)r.push("if (sectionPlaneActive"+n+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}r.push("   outColor = vec4(0.0, 0.0, 1.0, 1.0); "),t.logarithmicDepthBufferEnabled&&r.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");return r.push("}"),r}(t)}));var Io=q.vec3(),Co=function(e,t){this._hash=e,this._shaderSource=new Mo(t),this._scene=t.scene,this._useCount=0,this._allocate(t)},Do={};Co.get=function(e){var t=[e.scene.canvas.canvas.id,e.scene._sectionPlanesState.getHash(),e._geometry._state.hash,e._state.occlusionHash].join(";"),i=Do[t];if(!i){if((i=new Co(t,e)).errors)return console.log(i.errors.join("\n")),null;Do[t]=i,ee.memory.programs++}return i._useCount++,i},Co.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete Do[this._hash],ee.memory.programs--)},Co.prototype.webglContextRestored=function(){this._program=null},Co.prototype.drawMesh=function(e,t){this._program||this._allocate(t);var i=this._scene,s=i.canvas.gl,r=t._material._state,n=t._state,o=t._geometry._state,a=t.origin;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),r.id!==this._lastMaterialId){var u=r.backfaces;e.backfaces!==u&&(u?s.disable(s.CULL_FACE):s.enable(s.CULL_FACE),e.backfaces=u);var h=r.frontface;e.frontface!==h&&(h?s.frontFace(s.CCW):s.frontFace(s.CW),e.frontface=h),this._lastMaterialId=r.id}var l=i.camera;if(s.uniformMatrix4fv(this._uViewMatrix,!1,a?e.getRTCViewMatrix(n.originHash,a):l.viewMatrix),n.clippable){var c=i._sectionPlanesState.sectionPlanes.length;if(c>0)for(var p=i._sectionPlanesState.sectionPlanes,d=t.renderFlags,f=0;f<c;f++){var m=this._uSectionPlanes[f];if(m){var v=d.sectionPlanesActivePerLayer[f];if(s.uniform1i(m.active,v?1:0),v){var g=p[f];s.uniform3fv(m.pos,a?Ee(g.dist,g.dir,a,Io):g.pos),s.uniform3fv(m.dir,g.dir)}}}}s.uniformMatrix4fv(this._uProjMatrix,!1,l._project._state.matrix),s.uniformMatrix4fv(this._uModelMatrix,s.FALSE,t.worldMatrix),this._uClippable&&s.uniform1i(this._uClippable,t._state.clippable),s.uniform3fv(this._uOffset,t._state.offset),o.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&s.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,o.positionsDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(o.positionsBuf,o.compressGeometry?s.UNSIGNED_SHORT:s.FLOAT),e.bindArray++),o.indicesBuf&&(o.indicesBuf.bind(),e.bindArray++),this._lastGeometryId=o.id),o.indicesBuf?(s.drawElements(o.primitive,o.indicesBuf.numItems,o.indicesBuf.itemType,0),e.drawElements++):o.positions&&s.drawArrays(s.TRIANGLES,0,o.positions.numItems)},Co.prototype._allocate=function(e){var t=e.scene,i=t.canvas.gl;if(this._program=new ht(i,this._shaderSource),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uModelMatrix=s.getLocation("modelMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=t._sectionPlanesState.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._uClippable=s.getLocation("clippable"),this._uOffset=s.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null}},Co.prototype._bindProgram=function(e){var t=this._scene,i=t.camera.project,s=t.canvas.gl;if(this._program.bind(),e.useProgram++,s.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),t.logarithmicDepthBufferEnabled){var r=2/(Math.log(i.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,r)}this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null};var Ao=I((function e(t){w(this,e),this.vertex=function(e){var t=e.scene._sectionPlanesState.sectionPlanes.length>0,i=!!e._geometry._state.compressGeometry,s=[];s.push("// Mesh shadow vertex shader"),s.push("in vec3 position;"),s.push("uniform mat4 modelMatrix;"),s.push("uniform mat4 shadowViewMatrix;"),s.push("uniform mat4 shadowProjMatrix;"),s.push("uniform vec3 offset;"),i&&s.push("uniform mat4 positionsDecodeMatrix;");t&&s.push("out vec4 vWorldPosition;");s.push("void main(void) {"),s.push("vec4 localPosition = vec4(position, 1.0); "),s.push("vec4 worldPosition;"),i&&s.push("localPosition = positionsDecodeMatrix * localPosition;");s.push("worldPosition = modelMatrix * localPosition;"),s.push("worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = shadowViewMatrix * worldPosition; "),t&&s.push("vWorldPosition = worldPosition;");return s.push("   gl_Position = shadowProjMatrix * viewPosition;"),s.push("}"),s}(t),this.fragment=function(e){var t=e.scene;t.canvas.gl;var i=t._sectionPlanesState,s=i.sectionPlanes.length>0,r=[];if(r.push("// Mesh shadow fragment shader"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),s){r.push("uniform bool clippable;"),r.push("in vec4 vWorldPosition;");for(var n=0;n<i.sectionPlanes.length;n++)r.push("uniform bool sectionPlaneActive"+n+";"),r.push("uniform vec3 sectionPlanePos"+n+";"),r.push("uniform vec3 sectionPlaneDir"+n+";")}if(r.push("vec4 encodeFloat( const in float depth ) {"),r.push("  const vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);"),r.push("  const vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);"),r.push("  vec4 comp = fract(depth * bitShift);"),r.push("  comp -= comp.xxyz * bitMask;"),r.push("  return comp;"),r.push("}"),r.push("out vec4 outColor;"),r.push("void main(void) {"),s){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(n=0;n<i.sectionPlanes.length;n++)r.push("if (sectionPlaneActive"+n+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}return r.push("outColor = encodeFloat(gl_FragCoord.z);"),r.push("}"),r}(t)}));var ko=function(e,t){this._hash=e,this._shaderSource=new Ao(t),this._scene=t.scene,this._useCount=0,this._allocate(t)},Eo={};ko.get=function(e){var t=e.scene,i=[t.canvas.canvas.id,t._sectionPlanesState.getHash(),e._geometry._state.hash,e._state.hash].join(";"),s=Eo[i];if(!s){if((s=new ko(i,e)).errors)return console.log(s.errors.join("\n")),null;Eo[i]=s,ee.memory.programs++}return s._useCount++,s},ko.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete Eo[this._hash],ee.memory.programs--)},ko.prototype.webglContextRestored=function(){this._program=null},ko.prototype.drawMesh=function(e,t){this._program||this._allocate(t);var i=this._scene.canvas.gl,s=t._material._state,r=t._geometry._state;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),s.id!==this._lastMaterialId){var n=s.backfaces;e.backfaces!==n&&(n?i.disable(i.CULL_FACE):i.enable(i.CULL_FACE),e.backfaces=n);var o=s.frontface;e.frontface!==o&&(o?i.frontFace(i.CCW):i.frontFace(i.CW),e.frontface=o),e.lineWidth!==s.lineWidth&&(i.lineWidth(s.lineWidth),e.lineWidth=s.lineWidth),this._uPointSize&&i.uniform1i(this._uPointSize,s.pointSize),this._lastMaterialId=s.id}if(i.uniformMatrix4fv(this._uModelMatrix,i.FALSE,t.worldMatrix),r.combineGeometry){var a=t.vertexBufs;a.id!==this._lastVertexBufsId&&(a.positionsBuf&&this._aPosition&&(this._aPosition.bindArrayBuffer(a.positionsBuf,a.compressGeometry?i.UNSIGNED_SHORT:i.FLOAT),e.bindArray++),this._lastVertexBufsId=a.id)}this._uClippable&&i.uniform1i(this._uClippable,t._state.clippable),i.uniform3fv(this._uOffset,t._state.offset),r.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&i.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,r.positionsDecodeMatrix),r.combineGeometry?r.indicesBufCombined&&(r.indicesBufCombined.bind(),e.bindArray++):(this._aPosition&&(this._aPosition.bindArrayBuffer(r.positionsBuf,r.compressGeometry?i.UNSIGNED_SHORT:i.FLOAT),e.bindArray++),r.indicesBuf&&(r.indicesBuf.bind(),e.bindArray++)),this._lastGeometryId=r.id),r.combineGeometry?r.indicesBufCombined&&(i.drawElements(r.primitive,r.indicesBufCombined.numItems,r.indicesBufCombined.itemType,0),e.drawElements++):r.indicesBuf?(i.drawElements(r.primitive,r.indicesBuf.numItems,r.indicesBuf.itemType,0),e.drawElements++):r.positions&&(i.drawArrays(i.TRIANGLES,0,r.positions.numItems),e.drawArrays++)},ko.prototype._allocate=function(e){var t=e.scene,i=t.canvas.gl;if(this._program=new ht(i,this._shaderSource),this._scene=t,this._useCount=0,this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uModelMatrix=s.getLocation("modelMatrix"),this._uShadowViewMatrix=s.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=s.getLocation("shadowProjMatrix"),this._uSectionPlanes={};for(var r=0,n=t._sectionPlanesState.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._uClippable=s.getLocation("clippable"),this._uOffset=s.getLocation("offset"),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null}},ko.prototype._bindProgram=function(e){this._program||this._allocate(mesh);var t=this._scene,i=t.canvas.gl,s=t._sectionPlanesState;if(this._program.bind(),e.useProgram++,i.uniformMatrix4fv(this._uShadowViewMatrix,!1,e.shadowViewMatrix),i.uniformMatrix4fv(this._uShadowProjMatrix,!1,e.shadowProjMatrix),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,s.sectionPlanes.length>0)for(var r,n,o,a=0,u=this._uSectionPlanes.length;a<u;a++)n=(r=this._uSectionPlanes[a]).active,o=s.sectionPlanes[a],n&&i.uniform1i(n,o.active),r.pos&&i.uniform3fv(r.pos,o.pos),r.dir&&i.uniform3fv(r.dir,o.dir)};var Fo=q.OBB3(),Ro=q.vec4(),So=q.vec4(),Oo=q.vec4(),Bo=q.vec3([1,0,0]),Lo=q.vec3([0,1,0]),No=q.vec3([0,0,1]),jo=q.vec3(3),Go=q.vec3(3),Ho=q.identityMat4(),Uo=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,i),(s=t.call(this,e,r)).originalSystemId=r.originalSystemId||s.id,s.renderFlags=new Bs,s._state=new ti({visible:!0,culled:!1,pickable:null,clippable:null,collidable:null,occluder:!1!==r.occluder,castsShadow:null,receivesShadow:null,xrayed:!1,highlighted:!1,selected:!1,edges:!1,stationary:!!r.stationary,background:!!r.background,billboard:s._checkBillboard(r.billboard),layer:null,colorize:null,pickID:s.scene._renderer.getPickID(x(s)),drawHash:"",pickHash:"",offset:q.vec3(),origin:null,originHash:null}),s._drawRenderer=null,s._shadowRenderer=null,s._emphasisFillRenderer=null,s._emphasisEdgesRenderer=null,s._pickMeshRenderer=null,s._pickTriangleRenderer=null,s._occlusionRenderer=null,s._geometry=r.geometry?s._checkComponent2(["ReadableGeometry","VBOGeometry"],r.geometry):s.scene.geometry,s._material=r.material?s._checkComponent2(["PhongMaterial","MetallicMaterial","SpecularMaterial","LambertMaterial"],r.material):s.scene.material,s._xrayMaterial=r.xrayMaterial?s._checkComponent("EmphasisMaterial",r.xrayMaterial):s.scene.xrayMaterial,s._highlightMaterial=r.highlightMaterial?s._checkComponent("EmphasisMaterial",r.highlightMaterial):s.scene.highlightMaterial,s._selectedMaterial=r.selectedMaterial?s._checkComponent("EmphasisMaterial",r.selectedMaterial):s.scene.selectedMaterial,s._edgeMaterial=r.edgeMaterial?s._checkComponent("EdgeMaterial",r.edgeMaterial):s.scene.edgeMaterial,s._parentNode=null,s._aabb=null,s._aabbDirty=!0,s._numTriangles=s._geometry?s._geometry.numTriangles:0,s.scene._aabbDirty=!0,s._scale=q.vec3(),s._quaternion=q.identityQuaternion(),s._rotation=q.vec3(),s._position=q.vec3(),s._worldMatrix=q.identityMat4(),s._worldNormalMatrix=q.identityMat4(),s._localMatrixDirty=!0,s._worldMatrixDirty=!0,s._worldNormalMatrixDirty=!0;var n=r.origin||r.rtcCenter;if(n&&(s._state.origin=q.vec3(n),s._state.originHash=n.join()),r.matrix?s.matrix=r.matrix:(s.scale=r.scale,s.position=r.position,r.quaternion||(s.rotation=r.rotation)),s._isObject=r.isObject,s._isObject&&s.scene._registerObject(x(s)),s._isModel=r.isModel,s._isModel&&s.scene._registerModel(x(s)),s.visible=r.visible,s.culled=r.culled,s.pickable=r.pickable,s.clippable=r.clippable,s.collidable=r.collidable,s.castsShadow=r.castsShadow,s.receivesShadow=r.receivesShadow,s.xrayed=r.xrayed,s.highlighted=r.highlighted,s.selected=r.selected,s.edges=r.edges,s.layer=r.layer,s.colorize=r.colorize,s.opacity=r.opacity,s.offset=r.offset,r.parentId){var o=s.scene.components[r.parentId];o?o.isNode?o.addChild(x(s)):s.error("Parent is not a Node: '"+r.parentId+"'"):s.error("Parent not found: '"+r.parentId+"'"),s._parentNode=o}else r.parent&&(r.parent.isNode||s.error("Parent is not a Node"),r.parent.addChild(x(s)),s._parentNode=r.parent);return s.compile(),s}return I(i,[{key:"type",get:function(){return"Mesh"}},{key:"isMesh",get:function(){return!0}},{key:"parent",get:function(){return this._parentNode}},{key:"geometry",get:function(){return this._geometry}},{key:"material",get:function(){return this._material}},{key:"position",get:function(){return this._position},set:function(e){this._position.set(e||[0,0,0]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"rotation",get:function(){return this._rotation},set:function(e){this._rotation.set(e||[0,0,0]),q.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"quaternion",get:function(){return this._quaternion},set:function(e){this._quaternion.set(e||[0,0,0,1]),q.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale.set(e||[1,1,1]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"matrix",get:function(){return this._localMatrixDirty&&(this.__localMatrix||(this.__localMatrix=q.identityMat4()),q.composeMat4(this._position,this._quaternion,this._scale,this.__localMatrix),this._localMatrixDirty=!1),this.__localMatrix},set:function(e){this.__localMatrix||(this.__localMatrix=q.identityMat4()),this.__localMatrix.set(e||Ho),q.decomposeMat4(this.__localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._setWorldMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"worldMatrix",get:function(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}},{key:"worldNormalMatrix",get:function(){return this._worldNormalMatrixDirty&&this._buildWorldNormalMatrix(),this._worldNormalMatrix}},{key:"isEntity",get:function(){return!0}},{key:"isModel",get:function(){return this._isModel}},{key:"isObject",get:function(){return this._isObject}},{key:"aabb",get:function(){return this._aabbDirty&&this._updateAABB(),this._aabb}},{key:"origin",get:function(){return this._state.origin},set:function(e){e?(this._state.origin||(this._state.origin=q.vec3()),this._state.origin.set(e),this._state.originHash=e.join(),this._setAABBDirty(),this.scene._aabbDirty=!0):this._state.origin&&(this._state.origin=null,this._state.originHash=null,this._setAABBDirty(),this.scene._aabbDirty=!0)}},{key:"rtcCenter",get:function(){return this.origin},set:function(e){this.origin=e}},{key:"numTriangles",get:function(){return this._numTriangles}},{key:"visible",get:function(){return this._state.visible},set:function(e){e=!1!==e,this._state.visible=e,this._isObject&&this.scene._objectVisibilityUpdated(this),this.glRedraw()}},{key:"xrayed",get:function(){return this._state.xrayed},set:function(e){e=!!e,this._state.xrayed!==e&&(this._state.xrayed=e,this._isObject&&this.scene._objectXRayedUpdated(this),this.glRedraw())}},{key:"highlighted",get:function(){return this._state.highlighted},set:function(e){(e=!!e)!==this._state.highlighted&&(this._state.highlighted=e,this._isObject&&this.scene._objectHighlightedUpdated(this),this.glRedraw())}},{key:"selected",get:function(){return this._state.selected},set:function(e){(e=!!e)!==this._state.selected&&(this._state.selected=e,this._isObject&&this.scene._objectSelectedUpdated(this),this.glRedraw())}},{key:"edges",get:function(){return this._state.edges},set:function(e){(e=!!e)!==this._state.edges&&(this._state.edges=e,this.glRedraw())}},{key:"culled",get:function(){return this._state.culled},set:function(e){this._state.culled=!!e,this.glRedraw()}},{key:"clippable",get:function(){return this._state.clippable},set:function(e){e=!1!==e,this._state.clippable!==e&&(this._state.clippable=e,this.glRedraw())}},{key:"collidable",get:function(){return this._state.collidable},set:function(e){(e=!1!==e)!==this._state.collidable&&(this._state.collidable=e,this._setAABBDirty(),this.scene._aabbDirty=!0)}},{key:"pickable",get:function(){return this._state.pickable},set:function(e){e=!1!==e,this._state.pickable!==e&&(this._state.pickable=e)}},{key:"castsShadow",get:function(){return this._state.castsShadow},set:function(e){(e=!1!==e)!==this._state.castsShadow&&(this._state.castsShadow=e,this.glRedraw())}},{key:"receivesShadow",get:function(){return this._state.receivesShadow},set:function(e){(e=!1!==e)!==this._state.receivesShadow&&(this._state.receivesShadow=e,this._state.hash=e?"/mod/rs;":"/mod;",this.fire("dirty",this))}},{key:"saoEnabled",get:function(){return!1}},{key:"colorize",get:function(){return this._state.colorize},set:function(e){var t=this._state.colorize;t||((t=this._state.colorize=new Float32Array(4))[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1);var i=!!e;this.scene._objectColorizeUpdated(this,i),this.glRedraw()}},{key:"opacity",get:function(){return this._state.colorize[3]},set:function(e){var t=this._state.colorize;t||((t=this._state.colorize=new Float32Array(4))[0]=1,t[1]=1,t[2]=1);var i=null!=e;t[3]=i?e:1,this.scene._objectOpacityUpdated(this,i),this.glRedraw()}},{key:"transparent",get:function(){return 2===this._material.alphaMode||this._state.colorize[3]<1}},{key:"layer",get:function(){return this._state.layer},set:function(e){e=e||0,(e=Math.round(e))!==this._state.layer&&(this._state.layer=e,this._renderer.needStateSort())}},{key:"stationary",get:function(){return this._state.stationary}},{key:"billboard",get:function(){return this._state.billboard}},{key:"offset",get:function(){return this._state.offset},set:function(e){this._state.offset.set(e||[0,0,0]),this._setAABBDirty(),this.glRedraw()}},{key:"isDrawable",get:function(){return!0}},{key:"isStateSortable",get:function(){return!0}},{key:"xrayMaterial",get:function(){return this._xrayMaterial}},{key:"highlightMaterial",get:function(){return this._highlightMaterial}},{key:"selectedMaterial",get:function(){return this._selectedMaterial}},{key:"edgeMaterial",get:function(){return this._edgeMaterial}},{key:"_checkBillboard",value:function(e){return"spherical"!==(e=e||"none")&&"cylindrical"!==e&&"none"!==e&&(this.error("Unsupported value for 'billboard': "+e+" - accepted values are 'spherical', 'cylindrical' and 'none' - defaulting to 'none'."),e="none"),e}},{key:"compile",value:function(){var e=this._makeDrawHash();this._state.drawHash!==e&&(this._state.drawHash=e,this._putDrawRenderers(),this._drawRenderer=ro.get(this),this._emphasisFillRenderer=ho.get(this),this._emphasisEdgesRenderer=mo.get(this));var t=this._makePickHash();if(this._state.pickHash!==t&&(this._state.pickHash=t,this._putPickRenderers(),this._pickMeshRenderer=yo.get(this)),this._state.occluder){var i=this._makeOcclusionHash();this._state.occlusionHash!==i&&(this._state.occlusionHash=i,this._putOcclusionRenderer(),this._occlusionRenderer=Co.get(this))}}},{key:"_setLocalMatrixDirty",value:function(){this._localMatrixDirty=!0,this._setWorldMatrixDirty()}},{key:"_setWorldMatrixDirty",value:function(){this._worldMatrixDirty=!0,this._worldNormalMatrixDirty=!0}},{key:"_buildWorldMatrix",value:function(){var e=this.matrix;if(this._parentNode)q.mulMat4(this._parentNode.worldMatrix,e,this._worldMatrix);else for(var t=0,i=e.length;t<i;t++)this._worldMatrix[t]=e[t];this._worldMatrixDirty=!1}},{key:"_buildWorldNormalMatrix",value:function(){this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldNormalMatrix||(this._worldNormalMatrix=q.mat4()),q.transposeMat4(this._worldMatrix,this._worldNormalMatrix),q.inverseMat4(this._worldNormalMatrix),this._worldNormalMatrixDirty=!1}},{key:"_setAABBDirty",value:function(){if(this.collidable)for(var e=this;e;e=e._parentNode)e._aabbDirty=!0}},{key:"_updateAABB",value:function(){this.scene._aabbDirty=!0,this._aabb||(this._aabb=q.AABB3()),this._buildAABB(this.worldMatrix,this._aabb),this._aabbDirty=!1}},{key:"_webglContextRestored",value:function(){this._drawRenderer&&this._drawRenderer.webglContextRestored(),this._shadowRenderer&&this._shadowRenderer.webglContextRestored(),this._emphasisFillRenderer&&this._emphasisFillRenderer.webglContextRestored(),this._emphasisEdgesRenderer&&this._emphasisEdgesRenderer.webglContextRestored(),this._pickMeshRenderer&&this._pickMeshRenderer.webglContextRestored(),this._pickTriangleRenderer&&this._pickMeshRenderer.webglContextRestored(),this._occlusionRenderer&&this._occlusionRenderer.webglContextRestored()}},{key:"_makeDrawHash",value:function(){var e=this.scene,t=[e.canvas.canvas.id,(e.gammaInput?"gi;":";")+(e.gammaOutput?"go":""),e._lightsState.getHash(),e._sectionPlanesState.getHash()],i=this._state;return i.stationary&&t.push("/s"),"none"===i.billboard?t.push("/n"):"spherical"===i.billboard?t.push("/s"):"cylindrical"===i.billboard&&t.push("/c"),i.receivesShadow&&t.push("/rs"),t.push(";"),t.join("")}},{key:"_makePickHash",value:function(){var e=this.scene,t=[e.canvas.canvas.id,e._sectionPlanesState.getHash()],i=this._state;return i.stationary&&t.push("/s"),"none"===i.billboard?t.push("/n"):"spherical"===i.billboard?t.push("/s"):"cylindrical"===i.billboard&&t.push("/c"),t.push(";"),t.join("")}},{key:"_makeOcclusionHash",value:function(){var e=this.scene,t=[e.canvas.canvas.id,e._sectionPlanesState.getHash()],i=this._state;return i.stationary&&t.push("/s"),"none"===i.billboard?t.push("/n"):"spherical"===i.billboard?t.push("/s"):"cylindrical"===i.billboard&&t.push("/c"),t.push(";"),t.join("")}},{key:"_buildAABB",value:function(e,t){q.transformOBB3(e,this._geometry.obb,Fo),q.OBB3ToAABB3(Fo,t);var i=this._state.offset;if(t[0]+=i[0],t[1]+=i[1],t[2]+=i[2],t[3]+=i[0],t[4]+=i[1],t[5]+=i[2],this._state.origin){var s=this._state.origin;t[0]+=s[0],t[1]+=s[1],t[2]+=s[2],t[3]+=s[0],t[4]+=s[1],t[5]+=s[2]}}},{key:"rotate",value:function(e,t){return Ro[0]=e[0],Ro[1]=e[1],Ro[2]=e[2],Ro[3]=t*q.DEGTORAD,q.angleAxisToQuaternion(Ro,So),q.mulQuaternions(this.quaternion,So,Oo),this.quaternion=Oo,this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}},{key:"rotateOnWorldAxis",value:function(e,t){return Ro[0]=e[0],Ro[1]=e[1],Ro[2]=e[2],Ro[3]=t*q.DEGTORAD,q.angleAxisToQuaternion(Ro,So),q.mulQuaternions(So,this.quaternion,So),this}},{key:"rotateX",value:function(e){return this.rotate(Bo,e)}},{key:"rotateY",value:function(e){return this.rotate(Lo,e)}},{key:"rotateZ",value:function(e){return this.rotate(No,e)}},{key:"translate",value:function(e,t){return q.vec3ApplyQuaternion(this.quaternion,e,jo),q.mulVec3Scalar(jo,t,Go),q.addVec3(this.position,Go,this.position),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}},{key:"translateX",value:function(e){return this.translate(Bo,e)}},{key:"translateY",value:function(e){return this.translate(Lo,e)}},{key:"translateZ",value:function(e){return this.translate(No,e)}},{key:"_putDrawRenderers",value:function(){this._drawRenderer&&(this._drawRenderer.put(),this._drawRenderer=null),this._shadowRenderer&&(this._shadowRenderer.put(),this._shadowRenderer=null),this._emphasisFillRenderer&&(this._emphasisFillRenderer.put(),this._emphasisFillRenderer=null),this._emphasisEdgesRenderer&&(this._emphasisEdgesRenderer.put(),this._emphasisEdgesRenderer=null)}},{key:"_putPickRenderers",value:function(){this._pickMeshRenderer&&(this._pickMeshRenderer.put(),this._pickMeshRenderer=null),this._pickTriangleRenderer&&(this._pickTriangleRenderer.put(),this._pickTriangleRenderer=null)}},{key:"_putOcclusionRenderer",value:function(){this._occlusionRenderer&&(this._occlusionRenderer.put(),this._occlusionRenderer=null)}},{key:"stateSortCompare",value:function(e,t){return e._state.layer-t._state.layer||e._drawRenderer.id-t._drawRenderer.id||e._material._state.id-t._material._state.id||e._geometry._state.id-t._geometry._state.id}},{key:"rebuildRenderFlags",value:function(){this.renderFlags.reset(),this._getActiveSectionPlanes()?(this.renderFlags.numLayers=1,this.renderFlags.numVisibleLayers=1,this.renderFlags.visibleLayers[0]=0,this._updateRenderFlags()):this.renderFlags.culled=!0}},{key:"_updateRenderFlags",value:function(){var e=this.renderFlags,t=this._state;if(t.xrayed){var i=this._xrayMaterial._state;i.fill&&(i.fillAlpha<1?e.xrayedSilhouetteTransparent=!0:e.xrayedSilhouetteOpaque=!0),i.edges&&(i.edgeAlpha<1?e.xrayedEdgesTransparent=!0:e.xrayedEdgesOpaque=!0)}else{if(this._material._state.alpha<1||t.colorize[3]<1?e.colorTransparent=!0:e.colorOpaque=!0,t.edges)this._edgeMaterial._state.alpha<1?e.edgesTransparent=!0:e.edgesOpaque=!0;if(t.selected){var s=this._selectedMaterial._state;s.fill&&(s.fillAlpha<1?e.selectedSilhouetteTransparent=!0:e.selectedSilhouetteOpaque=!0),s.edges&&(s.edgeAlpha<1?e.selectedEdgesTransparent=!0:e.selectedEdgesOpaque=!0)}else if(t.highlighted){var r=this._highlightMaterial._state;r.fill&&(r.fillAlpha<1?e.highlightedSilhouetteTransparent=!0:e.highlightedSilhouetteOpaque=!0),r.edges&&(r.edgeAlpha<1?e.highlightedEdgesTransparent=!0:e.highlightedEdgesOpaque=!0)}}}},{key:"_getActiveSectionPlanes",value:function(){if(this._state.clippable){var e=this.scene._sectionPlanesState.sectionPlanes,t=e.length;if(t>0)for(var i=0;i<t;i++){var s=e[i],r=this.renderFlags;if(s.active)if(this._state.origin){var n=q.planeAABB3Intersect(s.dir,s.dist,this.aabb);if(-1===n)return!1;var o=0===n;r.sectionPlanesActivePerLayer[i]=o}else r.sectionPlanesActivePerLayer[i]=!0;else r.sectionPlanesActivePerLayer[i]=!1}}return!0}},{key:"drawColorOpaque",value:function(e){(this._drawRenderer||(this._drawRenderer=ro.get(this)))&&this._drawRenderer.drawMesh(e,this)}},{key:"drawColorTransparent",value:function(e){(this._drawRenderer||(this._drawRenderer=ro.get(this)))&&this._drawRenderer.drawMesh(e,this)}},{key:"drawSilhouetteXRayed",value:function(e){(this._emphasisFillRenderer||(this._emphasisFillRenderer=ho.get(this)))&&this._emphasisFillRenderer.drawMesh(e,this,0)}},{key:"drawSilhouetteHighlighted",value:function(e){(this._emphasisFillRenderer||(this._emphasisFillRenderer=ho.get(this)))&&this._emphasisFillRenderer.drawMesh(e,this,1)}},{key:"drawSilhouetteSelected",value:function(e){(this._emphasisFillRenderer||(this._emphasisFillRenderer=ho.get(this)))&&this._emphasisFillRenderer.drawMesh(e,this,2)}},{key:"drawEdgesColorOpaque",value:function(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=mo.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,3)}},{key:"drawEdgesColorTransparent",value:function(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=mo.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,3)}},{key:"drawEdgesXRayed",value:function(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=mo.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,0)}},{key:"drawEdgesHighlighted",value:function(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=mo.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,1)}},{key:"drawEdgesSelected",value:function(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=mo.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,2)}},{key:"drawOcclusion",value:function(e){(this._state.occluder&&this._occlusionRenderer||(this._occlusionRenderer=Co.get(this)))&&this._occlusionRenderer.drawMesh(e,this)}},{key:"drawShadow",value:function(e){(this._shadowRenderer||(this._shadowRenderer=ko.get(this)))&&this._shadowRenderer.drawMesh(e,this)}},{key:"drawPickMesh",value:function(e){(this._pickMeshRenderer||(this._pickMeshRenderer=yo.get(this)))&&this._pickMeshRenderer.drawMesh(e,this)}},{key:"canPickTriangle",value:function(){return this._geometry.isReadableGeometry}},{key:"drawPickTriangles",value:function(e){(this._pickTriangleRenderer||(this._pickTriangleRenderer=To.get(this)))&&this._pickTriangleRenderer.drawMesh(e,this)}},{key:"pickTriangleSurface",value:function(e,t,i){Vo(this,e,t,i)}},{key:"drawPickVertices",value:function(e){}},{key:"delegatePickedEntity",value:function(){return this}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._putDrawRenderers(),this._putPickRenderers(),this._putOcclusionRenderer(),this.scene._renderer.putPickID(this._state.pickID),this._isObject&&(this.scene._deregisterObject(this),this._visible&&this.scene._objectVisibilityUpdated(this,!1),this._xrayed&&this.scene._objectXRayedUpdated(this,!1),this._selected&&this.scene._objectSelectedUpdated(this,!1),this._highlighted&&this.scene._objectHighlightedUpdated(this,!1),this.scene._objectColorizeUpdated(this,!1),this.scene._objectOpacityUpdated(this,!1),this.scene._objectOffsetUpdated(this,!1)),this._isModel&&this.scene._deregisterModel(this),this.glRedraw()}}]),i}(),Vo=function(){var e=q.vec3(),t=q.vec3(),i=q.vec3(),s=q.vec3(),r=q.vec3(),n=q.vec3(),o=q.vec4(),a=q.vec3(),u=q.vec3(),h=q.vec3(),l=q.vec3(),c=q.vec3(),p=q.vec3(),d=q.vec3(),f=q.vec3(),m=q.vec3(),v=q.vec4(),g=q.vec4(),_=q.vec4(),y=q.vec3(),b=q.vec3(),x=q.vec3(),P=q.vec3(),T=q.vec3(),w=q.vec3(),M=q.vec3(),I=q.vec3(),C=q.vec3(),D=q.vec3(),A=q.vec3();return function(k,E,F,R){var S=R.primIndex;if(null!=S&&S>-1){var O=k.geometry._state,B=k.scene,L=B.camera,N=B.canvas;if("triangles"===O.primitiveName){R.primitive="triangle";var j,G,H,U,V=S,z=O.indices,W=O.positions;if(z){var X=z[V+0],Y=z[V+1],K=z[V+2];n[0]=X,n[1]=Y,n[2]=K,R.indices=n,j=3*X,G=3*Y,H=3*K}else H=(G=(j=3*V)+3)+3;if(i[0]=W[j+0],i[1]=W[j+1],i[2]=W[j+2],s[0]=W[G+0],s[1]=W[G+1],s[2]=W[G+2],r[0]=W[H+0],r[1]=W[H+1],r[2]=W[H+2],O.compressGeometry){var J=O.positionsDecodeMatrix;J&&(ui.decompressPosition(i,J,i),ui.decompressPosition(s,J,s),ui.decompressPosition(r,J,r))}R.canvasPos?(U=R.canvasPos,q.canvasPosToLocalRay(N.canvas,E,F,k.worldMatrix,U,e,t)):R.origin&&R.direction&&q.worldRayToLocalRay(k.worldMatrix,R.origin,R.direction,e,t),q.normalizeVec3(t),q.rayPlaneIntersect(e,t,i,s,r,o),R.localPos=o,R.position=o,v[0]=o[0],v[1]=o[1],v[2]=o[2],v[3]=1,q.transformVec4(k.worldMatrix,v,g),a[0]=g[0],a[1]=g[1],a[2]=g[2],R.worldPos=a,q.transformVec4(L.matrix,g,_),u[0]=_[0],u[1]=_[1],u[2]=_[2],R.viewPos=u,q.cartesianToBarycentric(o,i,s,r,h),R.bary=h;var Z=O.normals;if(Z){if(O.compressGeometry){var Q=3*X,$=3*Y,ee=3*K;ui.decompressNormal(Z.subarray(Q,Q+2),l),ui.decompressNormal(Z.subarray($,$+2),c),ui.decompressNormal(Z.subarray(ee,ee+2),p)}else l[0]=Z[j],l[1]=Z[j+1],l[2]=Z[j+2],c[0]=Z[G],c[1]=Z[G+1],c[2]=Z[G+2],p[0]=Z[H],p[1]=Z[H+1],p[2]=Z[H+2];var te=q.addVec3(q.addVec3(q.mulVec3Scalar(l,h[0],y),q.mulVec3Scalar(c,h[1],b),x),q.mulVec3Scalar(p,h[2],P),T);R.worldNormal=q.normalizeVec3(q.transformVec3(k.worldNormalMatrix,te,w))}var ie=O.uv;if(ie){if(d[0]=ie[2*X],d[1]=ie[2*X+1],f[0]=ie[2*Y],f[1]=ie[2*Y+1],m[0]=ie[2*K],m[1]=ie[2*K+1],O.compressGeometry){var se=O.uvDecodeMatrix;se&&(ui.decompressUV(d,se,d),ui.decompressUV(f,se,f),ui.decompressUV(m,se,m))}R.uv=q.addVec3(q.addVec3(q.mulVec2Scalar(d,h[0],M),q.mulVec2Scalar(f,h[1],I),C),q.mulVec2Scalar(m,h[2],D),A)}}}}}();function zo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.radiusTop||1;t<0&&(console.error("negative radiusTop not allowed - will invert"),t*=-1);var i=e.radiusBottom||1;i<0&&(console.error("negative radiusBottom not allowed - will invert"),i*=-1);var s=e.height||1;s<0&&(console.error("negative height not allowed - will invert"),s*=-1);var r=e.radialSegments||32;r<0&&(console.error("negative radialSegments not allowed - will invert"),r*=-1),r<3&&(r=3);var n=e.heightSegments||1;n<0&&(console.error("negative heightSegments not allowed - will invert"),n*=-1),n<1&&(n=1);var o,a,u,h,l,c,p,d,f,m,v,g=!!e.openEnded,_=e.center,y=_?_[0]:0,b=_?_[1]:0,x=_?_[2]:0,P=s/2,T=s/n,w=2*Math.PI/r,M=1/r,I=(t-i)/n,C=[],D=[],A=[],k=[],E=(90-180*Math.atan(s/(i-t))/Math.PI)/90;for(o=0;o<=n;o++)for(l=t-o*I,c=P-o*T,a=0;a<=r;a++)u=Math.sin(a*w),h=Math.cos(a*w),D.push(l*u),D.push(E),D.push(l*h),A.push(a*M),A.push(1*o/n),C.push(l*u+y),C.push(c+b),C.push(l*h+x);for(o=0;o<n;o++)for(a=0;a<=r;a++)d=(p=o*(r+1)+a)+r,k.push(p),k.push(d),k.push(d+1),k.push(p),k.push(d+1),k.push(p+1);if(!g&&t>0){for(f=C.length/3,D.push(0),D.push(1),D.push(0),A.push(.5),A.push(.5),C.push(0+y),C.push(P+b),C.push(0+x),a=0;a<=r;a++)u=Math.sin(a*w),h=Math.cos(a*w),m=.5*Math.sin(a*w)+.5,v=.5*Math.cos(a*w)+.5,D.push(t*u),D.push(1),D.push(t*h),A.push(m),A.push(v),C.push(t*u+y),C.push(P+b),C.push(t*h+x);for(a=0;a<r;a++)_=f,p=f+1+a,k.push(p),k.push(p+1),k.push(_)}if(!g&&i>0){for(f=C.length/3,D.push(0),D.push(-1),D.push(0),A.push(.5),A.push(.5),C.push(0+y),C.push(0-P+b),C.push(0+x),a=0;a<=r;a++)u=Math.sin(a*w),h=Math.cos(a*w),m=.5*Math.sin(a*w)+.5,v=.5*Math.cos(a*w)+.5,D.push(i*u),D.push(-1),D.push(i*h),A.push(m),A.push(v),C.push(i*u+y),C.push(0-P+b),C.push(i*h+x);for(a=0;a<r;a++)_=f,p=f+1+a,k.push(_),k.push(p+1),k.push(p)}return re.apply(e,{positions:C,normals:D,uv:A,indices:k})}function Wo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.lod||1,i=e.center?e.center[0]:0,s=e.center?e.center[1]:0,r=e.center?e.center[2]:0,n=e.radius||1;n<0&&(console.error("negative radius not allowed - will invert"),n*=-1);var o=e.heightSegments||18;o<0&&(console.error("negative heightSegments not allowed - will invert"),o*=-1),(o=Math.floor(t*o))<18&&(o=18);var a=e.widthSegments||18;a<0&&(console.error("negative widthSegments not allowed - will invert"),a*=-1),(a=Math.floor(t*a))<18&&(a=18);var u,h,l,c,p,d,f,m,v,g,_,y,b,x,P=[],T=[],w=[],M=[];for(u=0;u<=o;u++)for(l=u*Math.PI/o,c=Math.sin(l),p=Math.cos(l),h=0;h<=a;h++)d=2*h*Math.PI/a,f=Math.sin(d),m=Math.cos(d)*c,v=p,g=f*c,_=1-h/a,y=u/o,T.push(m),T.push(v),T.push(g),w.push(_),w.push(y),P.push(i+n*m),P.push(s+n*v),P.push(r+n*g);for(u=0;u<o;u++)for(h=0;h<a;h++)x=(b=u*(a+1)+h)+a+1,M.push(b+1),M.push(x+1),M.push(x),M.push(b+1),M.push(x),M.push(b);return re.apply(e,{positions:P,normals:T,uv:w,indices:M})}var Xo={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},";":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}};function Yo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.origin||[0,0,0],i=t[0],s=t[1],r=t[2],n=e.size||1,o=[],a=[],u=e.text;re.isNumeric(u)&&(u=""+u);for(var h,l,c,p,d,f,m,v,g,_=(u||"").split("\n"),y=0,b=0,x=.04,P=0;P<_.length;P++){h=0,c=(l=_[P]).length;for(var T=0;T<c;T++)if(p=Xo[l.charAt(T)]){d=1,f=-1,m=-1,v=p.points.length;for(var w=0;w<v;w++)-1!==(g=p.points[w])[0]||-1!==g[1]?(o.push(h+g[0]*n*x+i),o.push(b+g[1]*n*x+s),o.push(0+r),-1===f?f=y:(-1===m||(f=m),m=y),y++,d?d=!1:(a.push(f),a.push(m))):d=1;h+=p.width*x*n}b-=35*x*n}return re.apply(e,{primitive:"lines",positions:o,indices:a})}var Ko=function(e){g(i,X);var t=y(i);function i(e,s){var r;w(this,i),s=s||{},r=t.call(this,"AxisGizmo",e,s);var n=e.scene.camera;s.canvasId||s.canvasElement||r.error("Config expected: either 'canvasId' or 'canvasElement'");try{r._axisGizmoScene=new Br(e,{canvasId:s.canvasId,canvasElement:s.canvasElement,transparent:!0})}catch(e){return r.error(e),b(r)}var o=r._axisGizmoScene;o.clearLights(),new fr(o,{color:[.45,.45,.5],intensity:.9}),new dr(o,{dir:[-.5,.5,-.6],color:[.8,.8,.7],intensity:1,space:"view"}),new dr(o,{dir:[.5,-.5,-.6],color:[.8,.8,.8],intensity:1,space:"view"});var a=o.camera;n.on("matrix",(function(){var e=n.eye,t=n.look,i=n.up,s=q.mulVec3Scalar(q.normalizeVec3(q.subVec3(e,t,[])),22);a.look=[0,0,0],a.eye=s,a.up=i}));var u=new _r(o,zo({radiusTop:.01,radiusBottom:.6,height:1.7,radialSegments:20,heightSegments:1,openEnded:!1})),h=new _r(o,zo({radiusTop:.2,radiusBottom:.2,height:4.5,radialSegments:20,heightSegments:1,openEnded:!1})),l=new Tr(o,{diffuse:[1,.3,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),c=new Tr(o,{emissive:[1,.3,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),p=new Tr(o,{diffuse:[.3,1,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),d=new Tr(o,{emissive:[.3,1,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),f=new Tr(o,{diffuse:[.3,.3,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),m=new Tr(o,{emissive:[.3,.3,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),v=new Tr(o,{diffuse:[.5,.5,.5],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2});return r._meshes=[new Uo(o,{geometry:new _r(o,Wo({radius:9,heightSegments:60,widthSegments:60})),material:new Tr(o,{diffuse:[0,0,0],emissive:[.1,.1,.1],ambient:[.1,.1,.2],specular:[0,0,0],alpha:.4,alphaMode:"blend",frontface:"cw"}),pickable:!1,collidable:!1,visible:!1!==s.visible}),new Uo(o,{geometry:new _r(o,Wo({radius:1})),material:v,pickable:!1,collidable:!1,visible:!1!==s.visible}),new Uo(o,{geometry:u,material:l,pickable:!1,collidable:!1,visible:!1!==s.visible,position:[5,0,0],rotation:[0,0,-90]}),new Uo(o,{geometry:h,material:l,pickable:!1,collidable:!1,visible:!1!==s.visible,position:[2,0,0],rotation:[0,0,90]}),new Uo(o,{geometry:new _r(o,Yo({text:"X",size:1.5})),material:c,pickable:!1,collidable:!1,visible:!1!==s.visible,position:[7,0,0],billboard:"spherical"}),new Uo(o,{geometry:u,material:p,pickable:!1,collidable:!1,visible:!1!==s.visible,position:[0,5,0]}),new Uo(o,{geometry:h,material:p,pickable:!1,collidable:!1,visible:!1!==s.visible,position:[0,2,0]}),new Uo(o,{geometry:new _r(o,Yo({text:"Y",size:1.5})),material:d,pickable:!1,collidable:!1,visible:!1!==s.visible,position:[0,7,0],billboard:"spherical"}),new Uo(o,{geometry:u,material:f,pickable:!1,collidable:!1,visible:!1!==s.visible,position:[0,0,5],rotation:[90,0,0]}),new Uo(o,{geometry:h,material:f,pickable:!1,collidable:!1,visible:!1!==s.visible,position:[0,0,2],rotation:[90,0,0]}),new Uo(o,{geometry:new _r(o,Yo({text:"Z",size:1.5})),material:m,pickable:!1,collidable:!1,visible:!1!==s.visible,position:[0,0,7],billboard:"spherical"})],r}return I(i,[{key:"setVisible",value:function(e){for(var t=0;t<this._meshes.length;t++)this._meshes[t].visible=e}},{key:"destroy",value:function(){this._axisGizmoCanvas=null,this._axisGizmoScene.destroy(),this._axisGizmoScene=null,m(P(i.prototype),"destroy",this).call(this)}}]),i}(),Jo=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._state=new ti({active:!0,pos:q.vec3(),dir:q.vec3(),dist:0}),s.active=r.active,s.pos=r.pos,s.dir=r.dir,s.scene._sectionPlaneCreated(x(s)),s}return I(i,[{key:"type",get:function(){return"SectionPlane"}},{key:"active",get:function(){return this._state.active},set:function(e){this._state.active=!1!==e,this.glRedraw(),this.fire("active",this._state.active)}},{key:"pos",get:function(){return this._state.pos},set:function(e){this._state.pos.set(e||[0,0,0]),this._state.dist=-q.dotVec3(this._state.pos,this._state.dir),this.fire("pos",this._state.pos)}},{key:"dir",get:function(){return this._state.dir},set:function(e){this._state.dir.set(e||[0,0,-1]),this._state.dist=-q.dotVec3(this._state.pos,this._state.dir),this.glRedraw(),this.fire("dir",this._state.dir)}},{key:"dist",get:function(){return this._state.dist}},{key:"flipDir",value:function(){var e=this._state.dir;e[0]*=-1,e[1]*=-1,e[2]*=-1,this._state.dist=-q.dotVec3(this._state.pos,this._state.dir),this.fire("dir",this._state.dir),this.glRedraw()}},{key:"destroy",value:function(){this._state.destroy(),this.scene._sectionPlaneDestroyed(this),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),Zo=q.vec4(4),Qo=q.vec4(),qo=q.vec4(),$o=q.vec3([1,0,0]),ea=q.vec3([0,1,0]),ta=q.vec3([0,0,1]),ia=q.vec3(3),sa=q.vec3(3),ra=q.identityMat4(),na=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(w(this,i),(s=t.call(this,e,r))._parentNode=null,s._children=[],s._aabb=null,s._aabbDirty=!0,s.scene._aabbDirty=!0,s._numTriangles=0,s._scale=q.vec3(),s._quaternion=q.identityQuaternion(),s._rotation=q.vec3(),s._position=q.vec3(),s._offset=q.vec3(),s._localMatrix=q.identityMat4(),s._worldMatrix=q.identityMat4(),s._localMatrixDirty=!0,s._worldMatrixDirty=!0,r.matrix?s.matrix=r.matrix:(s.scale=r.scale,s.position=r.position,r.quaternion||(s.rotation=r.rotation)),s._isModel=r.isModel,s._isModel&&s.scene._registerModel(x(s)),s._isObject=r.isObject,s._isObject&&s.scene._registerObject(x(s)),s.origin=r.origin,s.visible=r.visible,s.culled=r.culled,s.pickable=r.pickable,s.clippable=r.clippable,s.collidable=r.collidable,s.castsShadow=r.castsShadow,s.receivesShadow=r.receivesShadow,s.xrayed=r.xrayed,s.highlighted=r.highlighted,s.selected=r.selected,s.edges=r.edges,s.colorize=r.colorize,s.opacity=r.opacity,s.offset=r.offset,r.children)for(var n=r.children,o=0,a=n.length;o<a;o++)s.addChild(n[o],r.inheritStates);if(r.parentId){var u=s.scene.components[r.parentId];u?u.isNode?u.addChild(x(s)):s.error("Parent is not a Node: '"+r.parentId+"'"):s.error("Parent not found: '"+r.parentId+"'")}else r.parent&&(r.parent.isNode||s.error("Parent is not a Node"),r.parent.addChild(x(s)));return s}return I(i,[{key:"isEntity",get:function(){return!0}},{key:"isModel",get:function(){return this._isModel}},{key:"isObject",get:function(){return this._isObject}},{key:"aabb",get:function(){return this._aabbDirty&&this._updateAABB(),this._aabb}},{key:"origin",get:function(){return this._origin},set:function(e){e?(this._origin||(this._origin=q.vec3()),this._origin.set(e)):this._origin&&(this._origin=null);for(var t=0,i=this._children.length;t<i;t++)this._children[t].origin=e;this.glRedraw()}},{key:"rtcCenter",get:function(){return this.origin},set:function(e){this.origin=e}},{key:"numTriangles",get:function(){return this._numTriangles}},{key:"visible",get:function(){return this._visible},set:function(e){e=!1!==e,this._visible=e;for(var t=0,i=this._children.length;t<i;t++)this._children[t].visible=e;this._isObject&&this.scene._objectVisibilityUpdated(this,e)}},{key:"xrayed",get:function(){return this._xrayed},set:function(e){e=!!e,this._xrayed=e;for(var t=0,i=this._children.length;t<i;t++)this._children[t].xrayed=e;this._isObject&&this.scene._objectXRayedUpdated(this,e)}},{key:"highlighted",get:function(){return this._highlighted},set:function(e){e=!!e,this._highlighted=e;for(var t=0,i=this._children.length;t<i;t++)this._children[t].highlighted=e;this._isObject&&this.scene._objectHighlightedUpdated(this,e)}},{key:"selected",get:function(){return this._selected},set:function(e){e=!!e,this._selected=e;for(var t=0,i=this._children.length;t<i;t++)this._children[t].selected=e;this._isObject&&this.scene._objectSelectedUpdated(this,e)}},{key:"edges",get:function(){return this._edges},set:function(e){e=!!e,this._edges=e;for(var t=0,i=this._children.length;t<i;t++)this._children[t].edges=e}},{key:"culled",get:function(){return this._culled},set:function(e){e=!!e,this._culled=e;for(var t=0,i=this._children.length;t<i;t++)this._children[t].culled=e}},{key:"clippable",get:function(){return this._clippable},set:function(e){e=!1!==e,this._clippable=e;for(var t=0,i=this._children.length;t<i;t++)this._children[t].clippable=e}},{key:"collidable",get:function(){return this._collidable},set:function(e){e=!1!==e,this._collidable=e;for(var t=0,i=this._children.length;t<i;t++)this._children[t].collidable=e}},{key:"pickable",get:function(){return this._pickable},set:function(e){e=!1!==e,this._pickable=e;for(var t=0,i=this._children.length;t<i;t++)this._children[t].pickable=e}},{key:"colorize",get:function(){return this._colorize.slice(0,3)},set:function(e){var t=this._colorize;t||((t=this._colorize=new Float32Array(4))[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1);for(var i=0,s=this._children.length;i<s;i++)this._children[i].colorize=t;if(this._isObject){var r=!!e;this.scene._objectColorizeUpdated(this,r)}}},{key:"opacity",get:function(){return this._colorize[3]},set:function(e){var t=this._colorize;t||((t=this._colorize=new Float32Array(4))[0]=1,t[1]=1,t[2]=1),t[3]=null!=e?e:1;for(var i=0,s=this._children.length;i<s;i++)this._children[i].opacity=e;if(this._isObject){var r=null!=e;this.scene._objectOpacityUpdated(this,r)}}},{key:"castsShadow",get:function(){return this._castsShadow},set:function(e){e=!!e,this._castsShadow=e;for(var t=0,i=this._children.length;t<i;t++)this._children[t].castsShadow=e}},{key:"receivesShadow",get:function(){return this._receivesShadow},set:function(e){e=!!e,this._receivesShadow=e;for(var t=0,i=this._children.length;t<i;t++)this._children[t].receivesShadow=e}},{key:"saoEnabled",get:function(){return!1}},{key:"offset",get:function(){return this._offset},set:function(e){e?(this._offset[0]=e[0],this._offset[1]=e[1],this._offset[2]=e[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(var t=0,i=this._children.length;t<i;t++)this._children[t].offset=this._offset;this._isObject&&this.scene._objectOffsetUpdated(this,e)}},{key:"isNode",get:function(){return!0}},{key:"_setLocalMatrixDirty",value:function(){this._localMatrixDirty=!0,this._setWorldMatrixDirty()}},{key:"_setWorldMatrixDirty",value:function(){this._worldMatrixDirty=!0;for(var e=0,t=this._children.length;e<t;e++)this._children[e]._setWorldMatrixDirty()}},{key:"_buildWorldMatrix",value:function(){var e=this.matrix;if(this._parentNode)q.mulMat4(this._parentNode.worldMatrix,e,this._worldMatrix);else for(var t=0,i=e.length;t<i;t++)this._worldMatrix[t]=e[t];this._worldMatrixDirty=!1}},{key:"_setSubtreeAABBsDirty",value:function(e){if(e._aabbDirty=!0,e._children)for(var t=0,i=e._children.length;t<i;t++)this._setSubtreeAABBsDirty(e._children[t])}},{key:"_setAABBDirty",value:function(){if(this._setSubtreeAABBsDirty(this),this.collidable)for(var e=this;e;e=e._parentNode)e._aabbDirty=!0}},{key:"_updateAABB",value:function(){if(this.scene._aabbDirty=!0,this._aabb||(this._aabb=q.AABB3()),this._buildAABB)this._buildAABB(this.worldMatrix,this._aabb);else{var e;q.collapseAABB3(this._aabb);for(var t=0,i=this._children.length;t<i;t++)(e=this._children[t]).collidable&&q.expandAABB3(this._aabb,e.aabb)}this._aabbDirty=!1}},{key:"addChild",value:function(e,t){if(re.isNumeric(e)||re.isString(e)){var i=e;if(!(e=this.scene.component[i]))return void this.warn("Component not found: "+re.inQuotes(i));if(!e.isNode&&!e.isMesh)return void this.error("Not a Node or Mesh: "+i)}else{if(!e.isNode&&!e.isMesh)return void this.error("Not a Node or Mesh: "+e.id);if(e._parentNode){if(e._parentNode.id===this.id)return void this.warn("Already a child: "+e.id);e._parentNode.removeChild(e)}}if(e.id,e.scene.id===this.scene.id)return this._children.push(e),e._parentNode=this,t&&(e.visible=this.visible,e.culled=this.culled,e.xrayed=this.xrayed,e.highlited=this.highlighted,e.selected=this.selected,e.edges=this.edges,e.clippable=this.clippable,e.pickable=this.pickable,e.collidable=this.collidable,e.castsShadow=this.castsShadow,e.receivesShadow=this.receivesShadow,e.colorize=this.colorize,e.opacity=this.opacity,e.offset=this.offset),e._setWorldMatrixDirty(),e._setAABBDirty(),this._numTriangles+=e.numTriangles,e;this.error("Child not in same Scene: "+e.id)}},{key:"removeChild",value:function(e){for(var t=0,i=this._children.length;t<i;t++)if(this._children[t].id===e.id)return e._parentNode=null,this._children=this._children.splice(t,1),e._setWorldMatrixDirty(),e._setAABBDirty(),this._setAABBDirty(),void(this._numTriangles-=e.numTriangles)}},{key:"removeChildren",value:function(){for(var e,t=0,i=this._children.length;t<i;t++)(e=this._children[t])._parentNode=null,e._setWorldMatrixDirty(),e._setAABBDirty(),this._numTriangles-=e.numTriangles;this._children=[],this._setAABBDirty()}},{key:"numChildren",get:function(){return this._children.length}},{key:"children",get:function(){return this._children}},{key:"parent",get:function(){return this._parentNode},set:function(e){if(re.isNumeric(e)||re.isString(e)){var t=e;if(!(e=this.scene.components[t]))return void this.warn("Node not found: "+re.inQuotes(t));if(!e.isNode)return void this.error("Not a Node: "+e.id)}e.scene.id===this.scene.id?this._parentNode&&this._parentNode.id===e.id?this.warn("Already a child of Node: "+e.id):e.addChild(this):this.error("Node not in same Scene: "+e.id)}},{key:"position",get:function(){return this._position},set:function(e){this._position.set(e||[0,0,0]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"rotation",get:function(){return this._rotation},set:function(e){this._rotation.set(e||[0,0,0]),q.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"quaternion",get:function(){return this._quaternion},set:function(e){this._quaternion.set(e||[0,0,0,1]),q.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale.set(e||[1,1,1]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"matrix",get:function(){return this._localMatrixDirty&&(this._localMatrix||(this._localMatrix=q.identityMat4()),q.composeMat4(this._position,this._quaternion,this._scale,this._localMatrix),this._localMatrixDirty=!1),this._localMatrix},set:function(e){this._localMatrix||(this._localMatrix=q.identityMat4()),this._localMatrix.set(e||ra),q.decomposeMat4(this._localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._setWorldMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"worldMatrix",get:function(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}},{key:"rotate",value:function(e,t){return Zo[0]=e[0],Zo[1]=e[1],Zo[2]=e[2],Zo[3]=t*q.DEGTORAD,q.angleAxisToQuaternion(Zo,Qo),q.mulQuaternions(this.quaternion,Qo,qo),this.quaternion=qo,this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}},{key:"rotateOnWorldAxis",value:function(e,t){return Zo[0]=e[0],Zo[1]=e[1],Zo[2]=e[2],Zo[3]=t*q.DEGTORAD,q.angleAxisToQuaternion(Zo,Qo),q.mulQuaternions(Qo,this.quaternion,Qo),this}},{key:"rotateX",value:function(e){return this.rotate($o,e)}},{key:"rotateY",value:function(e){return this.rotate(ea,e)}},{key:"rotateZ",value:function(e){return this.rotate(ta,e)}},{key:"translate",value:function(e,t){return q.vec3ApplyQuaternion(this.quaternion,e,ia),q.mulVec3Scalar(ia,t,sa),q.addVec3(this.position,sa,this.position),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}},{key:"translateX",value:function(e){return this.translate($o,e)}},{key:"translateY",value:function(e){return this.translate(ea,e)}},{key:"translateZ",value:function(e){return this.translate(ta,e)}},{key:"type",get:function(){return"Node"}},{key:"destroy",value:function(){if(m(P(i.prototype),"destroy",this).call(this),this._parentNode&&this._parentNode.removeChild(this),this._isObject&&(this.scene._deregisterObject(this),this._visible&&this.scene._objectVisibilityUpdated(this,!1),this._xrayed&&this.scene._objectXRayedUpdated(this,!1),this._selected&&this.scene._objectSelectedUpdated(this,!1),this._highlighted&&this.scene._objectHighlightedUpdated(this,!1),this.scene._objectColorizeUpdated(this,!1),this.scene._objectOpacityUpdated(this,!1),this.scene._objectOffsetUpdated(this,!1)),this._isModel&&this.scene._deregisterModel(this),this._children.length)for(var e=this._children.splice(),t=0,s=e.length;t<s;t++)e[t].destroy();this._children=[],this._setAABBDirty(),this.scene._aabbDirty=!0}}]),i}(),oa=function(e){g(i,br);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._state=new ti({type:"LambertMaterial",ambient:q.vec3([1,1,1]),color:q.vec3([1,1,1]),emissive:q.vec3([0,0,0]),alpha:null,alphaMode:0,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:"/lam;"}),s.ambient=r.ambient,s.color=r.color,s.emissive=r.emissive,s.alpha=r.alpha,s.lineWidth=r.lineWidth,s.pointSize=r.pointSize,s.backfaces=r.backfaces,s.frontface=r.frontface,s}return I(i,[{key:"type",get:function(){return"LambertMaterial"}},{key:"ambient",get:function(){return this._state.ambient},set:function(e){var t=this._state.ambient;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.ambient=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}},{key:"color",get:function(){return this._state.color},set:function(e){var t=this._state.color;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.color=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}},{key:"emissive",get:function(){return this._state.emissive},set:function(e){var t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}},{key:"alpha",get:function(){return this._state.alpha},set:function(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this._state.alphaMode=e<1?2:0,this.glRedraw())}},{key:"lineWidth",get:function(){return this._state.lineWidth},set:function(e){this._state.lineWidth=e||1,this.glRedraw()}},{key:"pointSize",get:function(){return this._state.pointSize},set:function(e){this._state.pointSize=e||1,this.glRedraw()}},{key:"backfaces",get:function(){return this._state.backfaces},set:function(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}},{key:"frontface",get:function(){return this._state.frontface?"ccw":"cw"},set:function(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}},{key:"_getState",value:function(){return this._state}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy()}}]),i}(),aa={opaque:0,mask:1,blend:2},ua=["opaque","mask","blend"],ha=function(e){g(i,br);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._state=new ti({type:"MetallicMaterial",baseColor:q.vec4([1,1,1]),emissive:q.vec4([0,0,0]),metallic:null,roughness:null,specularF0:null,alpha:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),s.baseColor=r.baseColor,s.metallic=r.metallic,s.roughness=r.roughness,s.specularF0=r.specularF0,s.emissive=r.emissive,s.alpha=r.alpha,r.baseColorMap&&(s._baseColorMap=s._checkComponent("Texture",r.baseColorMap)),r.metallicMap&&(s._metallicMap=s._checkComponent("Texture",r.metallicMap)),r.roughnessMap&&(s._roughnessMap=s._checkComponent("Texture",r.roughnessMap)),r.metallicRoughnessMap&&(s._metallicRoughnessMap=s._checkComponent("Texture",r.metallicRoughnessMap)),r.emissiveMap&&(s._emissiveMap=s._checkComponent("Texture",r.emissiveMap)),r.occlusionMap&&(s._occlusionMap=s._checkComponent("Texture",r.occlusionMap)),r.alphaMap&&(s._alphaMap=s._checkComponent("Texture",r.alphaMap)),r.normalMap&&(s._normalMap=s._checkComponent("Texture",r.normalMap)),s.alphaMode=r.alphaMode,s.alphaCutoff=r.alphaCutoff,s.backfaces=r.backfaces,s.frontface=r.frontface,s.lineWidth=r.lineWidth,s.pointSize=r.pointSize,s._makeHash(),s}return I(i,[{key:"type",get:function(){return"MetallicMaterial"}},{key:"_makeHash",value:function(){var e=this._state,t=["/met"];this._baseColorMap&&(t.push("/bm"),this._baseColorMap._state.hasMatrix&&t.push("/mat"),t.push("/"+this._baseColorMap._state.encoding)),this._metallicMap&&(t.push("/mm"),this._metallicMap._state.hasMatrix&&t.push("/mat")),this._roughnessMap&&(t.push("/rm"),this._roughnessMap._state.hasMatrix&&t.push("/mat")),this._metallicRoughnessMap&&(t.push("/mrm"),this._metallicRoughnessMap._state.hasMatrix&&t.push("/mat")),this._emissiveMap&&(t.push("/em"),this._emissiveMap._state.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap._state.hasMatrix&&t.push("/mat")),this._alphaMap&&(t.push("/am"),this._alphaMap._state.hasMatrix&&t.push("/mat")),this._normalMap&&(t.push("/nm"),this._normalMap._state.hasMatrix&&t.push("/mat")),t.push(";"),e.hash=t.join("")}},{key:"baseColor",get:function(){return this._state.baseColor},set:function(e){var t=this._state.baseColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.baseColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}},{key:"baseColorMap",get:function(){return this._baseColorMap}},{key:"metallic",get:function(){return this._state.metallic},set:function(e){e=null!=e?e:1,this._state.metallic!==e&&(this._state.metallic=e,this.glRedraw())}},{key:"metallicMap",get:function(){return this._attached.metallicMap}},{key:"roughness",get:function(){return this._state.roughness},set:function(e){e=null!=e?e:1,this._state.roughness!==e&&(this._state.roughness=e,this.glRedraw())}},{key:"roughnessMap",get:function(){return this._attached.roughnessMap}},{key:"metallicRoughnessMap",get:function(){return this._attached.metallicRoughnessMap}},{key:"specularF0",get:function(){return this._state.specularF0},set:function(e){e=null!=e?e:0,this._state.specularF0!==e&&(this._state.specularF0=e,this.glRedraw())}},{key:"emissive",get:function(){return this._state.emissive},set:function(e){var t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}},{key:"emissiveMap",get:function(){return this._attached.emissiveMap}},{key:"occlusionMap",get:function(){return this._attached.occlusionMap}},{key:"alpha",get:function(){return this._state.alpha},set:function(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}},{key:"alphaMap",get:function(){return this._attached.alphaMap}},{key:"normalMap",get:function(){return this._attached.normalMap}},{key:"alphaMode",get:function(){return ua[this._state.alphaMode]},set:function(e){var t=aa[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}},{key:"alphaCutoff",get:function(){return this._state.alphaCutoff},set:function(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}},{key:"backfaces",get:function(){return this._state.backfaces},set:function(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}},{key:"frontface",get:function(){return this._state.frontface?"ccw":"cw"},set:function(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}},{key:"lineWidth",get:function(){return this._state.lineWidth},set:function(e){this._state.lineWidth=e||1,this.glRedraw()}},{key:"pointSize",get:function(){return this._state.pointSize},set:function(e){this._state.pointSize=e||1,this.glRedraw()}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy()}}]),i}(),la={opaque:0,mask:1,blend:2},ca=["opaque","mask","blend"],pa=function(e){g(i,br);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._state=new ti({type:"SpecularMaterial",diffuse:q.vec3([1,1,1]),emissive:q.vec3([0,0,0]),specular:q.vec3([1,1,1]),glossiness:null,specularF0:null,alpha:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),s.diffuse=r.diffuse,s.specular=r.specular,s.glossiness=r.glossiness,s.specularF0=r.specularF0,s.emissive=r.emissive,s.alpha=r.alpha,r.diffuseMap&&(s._diffuseMap=s._checkComponent("Texture",r.diffuseMap)),r.emissiveMap&&(s._emissiveMap=s._checkComponent("Texture",r.emissiveMap)),r.specularMap&&(s._specularMap=s._checkComponent("Texture",r.specularMap)),r.glossinessMap&&(s._glossinessMap=s._checkComponent("Texture",r.glossinessMap)),r.specularGlossinessMap&&(s._specularGlossinessMap=s._checkComponent("Texture",r.specularGlossinessMap)),r.occlusionMap&&(s._occlusionMap=s._checkComponent("Texture",r.occlusionMap)),r.alphaMap&&(s._alphaMap=s._checkComponent("Texture",r.alphaMap)),r.normalMap&&(s._normalMap=s._checkComponent("Texture",r.normalMap)),s.alphaMode=r.alphaMode,s.alphaCutoff=r.alphaCutoff,s.backfaces=r.backfaces,s.frontface=r.frontface,s.lineWidth=r.lineWidth,s.pointSize=r.pointSize,s._makeHash(),s}return I(i,[{key:"type",get:function(){return"SpecularMaterial"}},{key:"_makeHash",value:function(){var e=this._state,t=["/spe"];this._diffuseMap&&(t.push("/dm"),this._diffuseMap.hasMatrix&&t.push("/mat"),t.push("/"+this._diffuseMap.encoding)),this._emissiveMap&&(t.push("/em"),this._emissiveMap.hasMatrix&&t.push("/mat")),this._glossinessMap&&(t.push("/gm"),this._glossinessMap.hasMatrix&&t.push("/mat")),this._specularMap&&(t.push("/sm"),this._specularMap.hasMatrix&&t.push("/mat")),this._specularGlossinessMap&&(t.push("/sgm"),this._specularGlossinessMap.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap.hasMatrix&&t.push("/mat")),this._normalMap&&(t.push("/nm"),this._normalMap.hasMatrix&&t.push("/mat")),this._alphaMap&&(t.push("/opm"),this._alphaMap.hasMatrix&&t.push("/mat")),t.push(";"),e.hash=t.join("")}},{key:"diffuse",get:function(){return this._state.diffuse},set:function(e){var t=this._state.diffuse;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.diffuse=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}},{key:"diffuseMap",get:function(){return this._diffuseMap}},{key:"specular",get:function(){return this._state.specular},set:function(e){var t=this._state.specular;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.specular=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}},{key:"specularMap",get:function(){return this._specularMap}},{key:"specularGlossinessMap",get:function(){return this._specularGlossinessMap}},{key:"glossiness",get:function(){return this._state.glossiness},set:function(e){e=null!=e?e:1,this._state.glossiness!==e&&(this._state.glossiness=e,this.glRedraw())}},{key:"glossinessMap",get:function(){return this._glossinessMap}},{key:"specularF0",get:function(){return this._state.specularF0},set:function(e){e=null!=e?e:0,this._state.specularF0!==e&&(this._state.specularF0=e,this.glRedraw())}},{key:"emissive",get:function(){return this._state.emissive},set:function(e){var t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}},{key:"emissiveMap",get:function(){return this._emissiveMap}},{key:"alpha",get:function(){return this._state.alpha},set:function(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}},{key:"alphaMap",get:function(){return this._alphaMap}},{key:"normalMap",get:function(){return this._normalMap}},{key:"occlusionMap",get:function(){return this._occlusionMap}},{key:"alphaMode",get:function(){return ca[this._state.alphaMode]},set:function(e){var t=la[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}},{key:"alphaCutoff",get:function(){return this._state.alphaCutoff},set:function(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}},{key:"backfaces",get:function(){return this._state.backfaces},set:function(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}},{key:"frontface",get:function(){return this._state.frontface?"ccw":"cw"},set:function(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}},{key:"lineWidth",get:function(){return this._state.lineWidth},set:function(e){this._state.lineWidth=e||1,this.glRedraw()}},{key:"pointSize",get:function(){return this._state.pointSize},set:function(e){this._state.pointSize=e||1,this.glRedraw()}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy()}}]),i}();function da(e,t){var i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=t;if(1009===r)return e.UNSIGNED_BYTE;if(1017===r)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===r)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===r)return e.BYTE;if(1011===r)return e.SHORT;if(1012===r)return e.UNSIGNED_SHORT;if(1013===r)return e.INT;if(1014===r)return e.UNSIGNED_INT;if(1015===r)return e.FLOAT;if(1016===r)return e.HALF_FLOAT;if(1021===r)return e.ALPHA;if(1023===r)return e.RGBA;if(1024===r)return e.LUMINANCE;if(1025===r)return e.LUMINANCE_ALPHA;if(1026===r)return e.DEPTH_COMPONENT;if(1027===r)return e.DEPTH_STENCIL;if(1028===r)return e.RED;if(1022===r)return e.RGBA;if(1029===r)return e.RED_INTEGER;if(1030===r)return e.RG;if(1031===r)return e.RG_INTEGER;if(1033===r)return e.RGBA_INTEGER;if(33776===r||33777===r||33778===r||33779===r)if(3001===s){var n=Ct(e,"WEBGL_compressed_texture_s3tc_srgb");if(null===n)return null;if(33776===r)return n.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===r)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===r)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===r)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(i=Ct(e,"WEBGL_compressed_texture_s3tc")))return null;if(33776===r)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===r)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===r)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===r)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===r||35841===r||35842===r||35843===r){var o=Ct(e,"WEBGL_compressed_texture_pvrtc");if(null===o)return null;if(35840===r)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===r)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===r)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===r)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===r){var a=Ct(e,"WEBGL_compressed_texture_etc1");return null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null}if(37492===r||37496===r){var u=Ct(e,"WEBGL_compressed_texture_etc");if(null===u)return null;if(37492===r)return 3001===s?u.COMPRESSED_SRGB8_ETC2:u.COMPRESSED_RGB8_ETC2;if(37496===r)return 3001===s?u.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:u.COMPRESSED_RGBA8_ETC2_EAC}if(37808===r||37809===r||37810===r||37811===r||37812===r||37813===r||37814===r||37815===r||37816===r||37817===r||37818===r||37819===r||37820===r||37821===r){var h=Ct(e,"WEBGL_compressed_texture_astc");if(null===h)return null;if(37808===r)return 3001===s?h.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:h.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===r)return 3001===s?h.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:h.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===r)return 3001===s?h.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:h.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===r)return 3001===s?h.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:h.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===r)return 3001===s?h.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:h.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===r)return 3001===s?h.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:h.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===r)return 3001===s?h.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:h.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===r)return 3001===s?h.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:h.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===r)return 3001===s?h.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:h.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===r)return 3001===s?h.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:h.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===r)return 3001===s?h.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:h.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===r)return 3001===s?h.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:h.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===r)return 3001===s?h.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:h.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===r)return 3001===s?h.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:h.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===r){var l=Ct(e,"EXT_texture_compression_bptc");if(null===l)return null;if(36492===r)return 3001===s?l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:l.COMPRESSED_RGBA_BPTC_UNORM_EXT}return 1020===r?e.UNSIGNED_INT_24_8:1e3===r?e.REPEAT:1001===r?e.CLAMP_TO_EDGE:1004===r||1005===r?e.NEAREST_MIPMAP_LINEAR:1007===r?e.LINEAR_MIPMAP_NEAREST:1008===r?e.LINEAR_MIPMAP_LINEAR:1003===r?e.NEAREST:1006===r?e.LINEAR:null}var fa=new Uint8Array([0,0,0,1]),ma=function(){function e(t){var i=t.gl,s=t.target,r=t.format,n=t.type,o=t.wrapS,a=t.wrapT,u=t.wrapR,h=t.encoding,l=t.preloadColor,c=t.premultiplyAlpha,p=t.flipY;w(this,e),this.gl=i,this.target=s||i.TEXTURE_2D,this.format=r||1023,this.type=n||1009,this.internalFormat=null,this.premultiplyAlpha=!!c,this.flipY=!!p,this.unpackAlignment=4,this.wrapS=o||1e3,this.wrapT=a||1e3,this.wrapR=u||1e3,this.encoding=h||3001,this.texture=i.createTexture(),l&&this.setPreloadColor(l),this.allocated=!0}return I(e,[{key:"setPreloadColor",value:function(e){e?(fa[0]=Math.floor(255*e[0]),fa[1]=Math.floor(255*e[1]),fa[2]=Math.floor(255*e[2]),fa[3]=Math.floor(255*(void 0!==e[3]?e[3]:1))):(fa[0]=0,fa[1]=0,fa[2]=0,fa[3]=255);var t=this.gl;if(t.bindTexture(this.target,this.texture),this.target===t.TEXTURE_CUBE_MAP)for(var i=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z],s=0,r=i.length;s<r;s++)t.texImage2D(i[s],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,fa);else t.texImage2D(this.target,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,fa);t.bindTexture(this.target,null)}},{key:"setTarget",value:function(e){this.target=e||this.gl.TEXTURE_2D}},{key:"setImage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.gl;void 0!==t.format&&(this.format=t.format),void 0!==t.internalFormat&&(this.internalFormat=t.internalFormat),void 0!==t.encoding&&(this.encoding=t.encoding),void 0!==t.type&&(this.type=t.type),void 0!==t.flipY&&(this.flipY=t.flipY),void 0!==t.premultiplyAlpha&&(this.premultiplyAlpha=t.premultiplyAlpha),void 0!==t.unpackAlignment&&(this.unpackAlignment=t.unpackAlignment),void 0!==t.minFilter&&(this.minFilter=t.minFilter),void 0!==t.magFilter&&(this.magFilter=t.magFilter),void 0!==t.wrapS&&(this.wrapS=t.wrapS),void 0!==t.wrapT&&(this.wrapT=t.wrapT),void 0!==t.wrapR&&(this.wrapR=t.wrapR);var s=!1;i.bindTexture(this.target,this.texture);var r=i.getParameter(i.UNPACK_FLIP_Y_WEBGL);i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.flipY);var n=i.getParameter(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL);i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);var o=i.getParameter(i.UNPACK_ALIGNMENT);i.pixelStorei(i.UNPACK_ALIGNMENT,this.unpackAlignment);var a=i.getParameter(i.UNPACK_COLORSPACE_CONVERSION_WEBGL);i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE);var u=da(i,this.minFilter);i.texParameteri(this.target,i.TEXTURE_MIN_FILTER,u),u!==i.NEAREST_MIPMAP_NEAREST&&u!==i.LINEAR_MIPMAP_NEAREST&&u!==i.NEAREST_MIPMAP_LINEAR&&u!==i.LINEAR_MIPMAP_LINEAR||(s=!0);var h=da(i,this.magFilter);h&&i.texParameteri(this.target,i.TEXTURE_MAG_FILTER,h);var l=da(i,this.wrapS);l&&i.texParameteri(this.target,i.TEXTURE_WRAP_S,l);var c=da(i,this.wrapT);c&&i.texParameteri(this.target,i.TEXTURE_WRAP_T,c);var p=da(i,this.format,this.encoding),d=da(i,this.type),f=va(i,this.internalFormat,p,d,this.encoding,!1);if(this.target===i.TEXTURE_CUBE_MAP){if(re.isArray(e))for(var m=e,v=[i.TEXTURE_CUBE_MAP_POSITIVE_X,i.TEXTURE_CUBE_MAP_NEGATIVE_X,i.TEXTURE_CUBE_MAP_POSITIVE_Y,i.TEXTURE_CUBE_MAP_NEGATIVE_Y,i.TEXTURE_CUBE_MAP_POSITIVE_Z,i.TEXTURE_CUBE_MAP_NEGATIVE_Z],g=0,_=v.length;g<_;g++)i.texImage2D(v[g],0,f,p,d,m[g])}else i.texImage2D(i.TEXTURE_2D,0,f,p,d,e);s&&i.generateMipmap(this.target),i.bindTexture(this.target,null),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,r),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),i.pixelStorei(i.UNPACK_ALIGNMENT,o),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,a)}},{key:"setCompressedData",value:function(e){var t=e.mipmaps,i=e.props,s=void 0===i?{}:i,r=this.gl,n=t.length;void 0!==s.format&&(this.format=s.format),void 0!==s.internalFormat&&(this.internalFormat=s.internalFormat),void 0!==s.encoding&&(this.encoding=s.encoding),void 0!==s.type&&(this.type=s.type),void 0!==s.flipY&&(this.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(this.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(this.unpackAlignment=s.unpackAlignment),void 0!==s.minFilter&&(this.minFilter=s.minFilter),void 0!==s.magFilter&&(this.magFilter=s.magFilter),void 0!==s.wrapS&&(this.wrapS=s.wrapS),void 0!==s.wrapT&&(this.wrapT=s.wrapT),void 0!==s.wrapR&&(this.wrapR=s.wrapR),r.activeTexture(r.TEXTURE0+0),r.bindTexture(this.target,this.texture);var o=t.length>1;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,this.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,this.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,r.NONE);var a=da(r,this.wrapS);a&&r.texParameteri(this.target,r.TEXTURE_WRAP_S,a);var u=da(r,this.wrapT);if(u&&r.texParameteri(this.target,r.TEXTURE_WRAP_T,u),this.type===r.TEXTURE_3D||this.type===r.TEXTURE_2D_ARRAY){var h=da(r,this.wrapR);h&&r.texParameteri(this.target,r.TEXTURE_WRAP_R,h),r.texParameteri(this.type,r.TEXTURE_WRAP_R,h)}o?(r.texParameteri(this.target,r.TEXTURE_MIN_FILTER,ga(r,this.minFilter)),r.texParameteri(this.target,r.TEXTURE_MAG_FILTER,ga(r,this.magFilter))):(r.texParameteri(this.target,r.TEXTURE_MIN_FILTER,da(r,this.minFilter)),r.texParameteri(this.target,r.TEXTURE_MAG_FILTER,da(r,this.magFilter)));var l=da(r,this.format,this.encoding),c=da(r,this.type),p=va(r,this.internalFormat,l,c,this.encoding,!1);r.texStorage2D(r.TEXTURE_2D,n,p,t[0].width,t[0].height);for(var d=0,f=t.length;d<f;d++){var m=t[d];1023!==this.format?null!==l?r.compressedTexSubImage2D(r.TEXTURE_2D,d,0,0,m.width,m.height,l,m.data):console.warn("Attempt to load unsupported compressed texture format in .setCompressedData()"):r.texSubImage2D(r.TEXTURE_2D,d,0,0,m.width,m.height,l,c,m.data)}r.bindTexture(this.target,null)}},{key:"setProps",value:function(e){var t=this.gl;t.bindTexture(this.target,this.texture),this._uploadProps(e),t.bindTexture(this.target,null)}},{key:"_uploadProps",value:function(e){var t=this.gl;if(void 0!==e.format&&(this.format=e.format),void 0!==e.internalFormat&&(this.internalFormat=e.internalFormat),void 0!==e.encoding&&(this.encoding=e.encoding),void 0!==e.type&&(this.type=e.type),void 0!==e.minFilter){var i=da(t,e.minFilter);i&&(this.minFilter=e.minFilter,t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,i),i!==t.NEAREST_MIPMAP_NEAREST&&i!==t.LINEAR_MIPMAP_NEAREST&&i!==t.NEAREST_MIPMAP_LINEAR&&i!==t.LINEAR_MIPMAP_LINEAR||t.generateMipmap(this.target))}if(void 0!==e.magFilter){var s=da(t,e.magFilter);s&&(this.magFilter=e.magFilter,t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,s))}if(void 0!==e.wrapS){var r=da(t,e.wrapS);r&&(this.wrapS=e.wrapS,t.texParameteri(this.target,t.TEXTURE_WRAP_S,r))}if(void 0!==e.wrapT){var n=da(t,e.wrapT);n&&(this.wrapT=e.wrapT,t.texParameteri(this.target,t.TEXTURE_WRAP_T,n))}}},{key:"bind",value:function(e){if(this.allocated){if(this.texture){var t=this.gl;return t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,this.texture),!0}return!1}}},{key:"unbind",value:function(e){if(this.allocated&&this.texture){var t=this.gl;t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,null)}}},{key:"destroy",value:function(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}}]),e}();function va(e,t,i,s,r){var n=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(null!==t){if(void 0!==e[t])return e[t];console.warn("Attempt to use non-existing WebGL internal format '"+t+"'")}var o=i;return i===e.RED&&(s===e.FLOAT&&(o=e.R32F),s===e.HALF_FLOAT&&(o=e.R16F),s===e.UNSIGNED_BYTE&&(o=e.R8)),i===e.RG&&(s===e.FLOAT&&(o=e.RG32F),s===e.HALF_FLOAT&&(o=e.RG16F),s===e.UNSIGNED_BYTE&&(o=e.RG8)),i===e.RGBA&&(s===e.FLOAT&&(o=e.RGBA32F),s===e.HALF_FLOAT&&(o=e.RGBA16F),s===e.UNSIGNED_BYTE&&(o=3001===r&&!1===n?e.SRGB8_ALPHA8:e.RGBA8),s===e.UNSIGNED_SHORT_4_4_4_4&&(o=e.RGBA4),s===e.UNSIGNED_SHORT_5_5_5_1&&(o=e.RGB5_A1)),o!==e.R16F&&o!==e.R32F&&o!==e.RG16F&&o!==e.RG32F&&o!==e.RGBA16F&&o!==e.RGBA32F||Ct(e,"EXT_color_buffer_float"),o}function ga(e,t){return 1003===t||1004===t||1005===t?e.NEAREST:e.LINEAR}function _a(e){if(!ya(e.width)||!ya(e.height)){var t=document.createElement("canvas");t.width=ba(e.width),t.height=ba(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}return e}function ya(e){return 0==(e&e-1)}function ba(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1}var xa=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._state=new ti({texture:new ma({gl:s.scene.canvas.gl}),matrix:q.identityMat4(),hasMatrix:r.translate&&(0!==r.translate[0]||0!==r.translate[1])||!!r.rotate||r.scale&&(0!==r.scale[0]||0!==r.scale[1]),minFilter:s._checkMinFilter(r.minFilter),magFilter:s._checkMagFilter(r.magFilter),wrapS:s._checkWrapS(r.wrapS),wrapT:s._checkWrapT(r.wrapT),flipY:s._checkFlipY(r.flipY),encoding:s._checkEncoding(r.encoding)}),s._src=null,s._image=null,s._translate=q.vec2([0,0]),s._scale=q.vec2([1,1]),s._rotate=q.vec2([0,0]),s._matrixDirty=!1,s.translate=r.translate,s.scale=r.scale,s.rotate=r.rotate,r.src?s.src=r.src:r.image&&(s.image=r.image),ee.memory.textures++,s}return I(i,[{key:"type",get:function(){return"Texture"}},{key:"_checkMinFilter",value:function(e){return 1006!==(e=e||1008)&&1007!==e&&1008!==e&&1005!==e&&1004!==e&&(this.error("Unsupported value for 'minFilter' - supported values are LinearFilter, LinearMipMapNearestFilter, NearestMipMapNearestFilter, NearestMipMapLinearFilter and LinearMipMapLinearFilter. Defaulting to LinearMipMapLinearFilter."),e=1008),e}},{key:"_checkMagFilter",value:function(e){return 1006!==(e=e||1006)&&1003!==e&&(this.error("Unsupported value for 'magFilter' - supported values are LinearFilter and NearestFilter. Defaulting to LinearFilter."),e=1006),e}},{key:"_checkWrapS",value:function(e){return 1001!==(e=e||1e3)&&1002!==e&&1e3!==e&&(this.error("Unsupported value for 'wrapS' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),e=1e3),e}},{key:"_checkWrapT",value:function(e){return 1001!==(e=e||1e3)&&1002!==e&&1e3!==e&&(this.error("Unsupported value for 'wrapT' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),e=1e3),e}},{key:"_checkFlipY",value:function(e){return!!e}},{key:"_checkEncoding",value:function(e){return 3e3!==(e=e||3e3)&&3001!==e&&(this.error("Unsupported value for 'encoding' - supported values are LinearEncoding and sRGBEncoding. Defaulting to LinearEncoding."),e=3e3),e}},{key:"_webglContextRestored",value:function(){this._state.texture=new ma({gl:this.scene.canvas.gl}),this._image?this.image=this._image:this._src&&(this.src=this._src)}},{key:"_update",value:function(){var e,t,i=this._state;this._matrixDirty&&(0===this._translate[0]&&0===this._translate[1]||(e=q.translationMat4v([this._translate[0],this._translate[1],0],this._state.matrix)),1===this._scale[0]&&1===this._scale[1]||(t=q.scalingMat4v([this._scale[0],this._scale[1],1]),e=e?q.mulMat4(e,t):t),0!==this._rotate&&(t=q.rotationMat4v(.0174532925*this._rotate,[0,0,1]),e=e?q.mulMat4(e,t):t),e&&(i.matrix=e),this._matrixDirty=!1);this.glRedraw()}},{key:"image",get:function(){return this._image},set:function(e){this._image=_a(e),this._image.crossOrigin="Anonymous",this._state.texture.setImage(this._image,this._state),this._src=null,this.glRedraw()}},{key:"src",get:function(){return this._src},set:function(e){this.scene.loading++,this.scene.canvas.spinner.processes++;var t=this,i=new Image;i.onload=function(){i=_a(i),t._state.texture.setImage(i,t._state),t.scene.loading--,t.glRedraw(),t.scene.canvas.spinner.processes--},i.src=e,this._src=e,this._image=null}},{key:"translate",get:function(){return this._translate},set:function(e){this._translate.set(e||[0,0]),this._matrixDirty=!0,this._needUpdate()}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale.set(e||[1,1]),this._matrixDirty=!0,this._needUpdate()}},{key:"rotate",get:function(){return this._rotate},set:function(e){e=e||0,this._rotate!==e&&(this._rotate=e,this._matrixDirty=!0,this._needUpdate())}},{key:"minFilter",get:function(){return this._state.minFilter}},{key:"magFilter",get:function(){return this._state.magFilter}},{key:"wrapS",get:function(){return this._state.wrapS}},{key:"wrapT",get:function(){return this._state.wrapT}},{key:"flipY",get:function(){return this._state.flipY}},{key:"encoding",get:function(){return this._state.encoding}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.texture&&this._state.texture.destroy(),this._state.destroy(),ee.memory.textures--}}]),i}(),Pa=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._state=new ti({edgeColor:q.vec3([0,0,0]),centerColor:q.vec3([1,1,1]),edgeBias:0,centerBias:1,power:1}),s.edgeColor=r.edgeColor,s.centerColor=r.centerColor,s.edgeBias=r.edgeBias,s.centerBias=r.centerBias,s.power=r.power,s}return I(i,[{key:"type",get:function(){return"Fresnel"}},{key:"edgeColor",get:function(){return this._state.edgeColor},set:function(e){this._state.edgeColor.set(e||[0,0,0]),this.glRedraw()}},{key:"centerColor",get:function(){return this._state.centerColor},set:function(e){this._state.centerColor.set(e||[1,1,1]),this.glRedraw()}},{key:"edgeBias",get:function(){return this._state.edgeBias},set:function(e){this._state.edgeBias=e||0,this.glRedraw()}},{key:"centerBias",get:function(){return this._state.centerBias},set:function(e){this._state.centerBias=null!=e?e:1,this.glRedraw()}},{key:"power",get:function(){return this._state.power},set:function(e){this._state.power=null!=e?e:1,this.glRedraw()}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.destroy()}}]),i}(),Ta=ee.memory,wa=q.AABB3(),Ma=function(e){g(i,mr);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,i),(s=t.call(this,e,r))._state=new ti({compressGeometry:!0,primitive:null,primitiveName:null,positionsDecodeMatrix:null,uvDecodeMatrix:null,positionsBuf:null,normalsBuf:null,colorsbuf:null,uvBuf:null,indicesBuf:null,hash:""}),s._numTriangles=0,s._edgeThreshold=r.edgeThreshold||10,s._aabb=null,s._obb=q.OBB3();var n,o=s._state,a=s.scene.canvas.gl;switch(r.primitive=r.primitive||"triangles",r.primitive){case"points":o.primitive=a.POINTS,o.primitiveName=r.primitive;break;case"lines":o.primitive=a.LINES,o.primitiveName=r.primitive;break;case"line-loop":o.primitive=a.LINE_LOOP,o.primitiveName=r.primitive;break;case"line-strip":o.primitive=a.LINE_STRIP,o.primitiveName=r.primitive;break;case"triangles":o.primitive=a.TRIANGLES,o.primitiveName=r.primitive;break;case"triangle-strip":o.primitive=a.TRIANGLE_STRIP,o.primitiveName=r.primitive;break;case"triangle-fan":o.primitive=a.TRIANGLE_FAN,o.primitiveName=r.primitive;break;default:s.error("Unsupported value for 'primitive': '"+r.primitive+"' - supported values are 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'. Defaulting to 'triangles'."),o.primitive=a.TRIANGLES,o.primitiveName=r.primitive}if(!r.positions)return s.error("Config expected: positions"),b(s);if(!r.indices)return s.error("Config expected: indices"),b(s);var u=r.positionsDecodeMatrix;if(u);else{var h=ui.getPositionsBounds(r.positions),l=ui.compressPositions(r.positions,h.min,h.max);n=l.quantized,o.positionsDecodeMatrix=l.decodeMatrix,o.positionsBuf=new lt(a,a.ARRAY_BUFFER,n,n.length,3,a.STATIC_DRAW),Ta.positions+=o.positionsBuf.numItems,q.positions3ToAABB3(r.positions,s._aabb),q.positions3ToAABB3(n,wa,o.positionsDecodeMatrix),q.AABB3ToOBB3(wa,s._obb)}if(r.colors){var c=r.colors.constructor===Float32Array?r.colors:new Float32Array(r.colors);o.colorsBuf=new lt(a,a.ARRAY_BUFFER,c,c.length,4,a.STATIC_DRAW),Ta.colors+=o.colorsBuf.numItems}if(r.uv){var p=ui.getUVBounds(r.uv),d=ui.compressUVs(r.uv,p.min,p.max),f=d.quantized;o.uvDecodeMatrix=d.decodeMatrix,o.uvBuf=new lt(a,a.ARRAY_BUFFER,f,f.length,2,a.STATIC_DRAW),Ta.uvs+=o.uvBuf.numItems}if(r.normals){var m=ui.compressNormals(r.normals),v=o.compressGeometry;o.normalsBuf=new lt(a,a.ARRAY_BUFFER,m,m.length,3,a.STATIC_DRAW,v),Ta.normals+=o.normalsBuf.numItems}var g=r.indices.constructor===Uint32Array||r.indices.constructor===Uint16Array?r.indices:new Uint32Array(r.indices);o.indicesBuf=new lt(a,a.ELEMENT_ARRAY_BUFFER,g,g.length,1,a.STATIC_DRAW),Ta.indices+=o.indicesBuf.numItems;var _=Dt(n,g,o.positionsDecodeMatrix,s._edgeThreshold);return s._edgeIndicesBuf=new lt(a,a.ELEMENT_ARRAY_BUFFER,_,_.length,1,a.STATIC_DRAW),"triangles"===s._state.primitiveName&&(s._numTriangles=r.indices.length/3),s._buildHash(),Ta.meshes++,s}return I(i,[{key:"type",get:function(){return"VBOGeometry"}},{key:"isVBOGeometry",get:function(){return!0}},{key:"_buildHash",value:function(){var e=this._state,t=["/g"];t.push("/"+e.primitive+";"),e.positionsBuf&&t.push("p"),e.colorsBuf&&t.push("c"),(e.normalsBuf||e.autoVertexNormals)&&t.push("n"),e.uvBuf&&t.push("u"),t.push("cp"),t.push(";"),e.hash=t.join("")}},{key:"_getEdgeIndices",value:function(){return this._edgeIndicesBuf}},{key:"primitive",get:function(){return this._state.primitiveName}},{key:"aabb",get:function(){return this._aabb}},{key:"obb",get:function(){return this._obb}},{key:"numTriangles",get:function(){return this._numTriangles}},{key:"_getState",value:function(){return this._state}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this);var e=this._state;e.indicesBuf&&e.indicesBuf.destroy(),e.positionsBuf&&e.positionsBuf.destroy(),e.normalsBuf&&e.normalsBuf.destroy(),e.uvBuf&&e.uvBuf.destroy(),e.colorsBuf&&e.colorsBuf.destroy(),this._edgeIndicesBuf&&this._edgeIndicesBuf.destroy(),e.destroy(),Ta.meshes--}}]),i}(),Ia={};function Ca(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(i,s){t.src||(console.error("load3DSGeometry: Parameter expected: src"),s());var r=e.canvas.spinner;r.processes++,re.loadArraybuffer(t.src,(function(e){e.byteLength||(console.error("load3DSGeometry: no data loaded"),r.processes--,s());var n=Ia.parse.from3DS(e).edit.objects[0].mesh,o=n.vertices,a=n.uvt,u=n.indices;r.processes--,i(re.apply(t,{primitive:"triangles",positions:o,normals:null,uv:a,indices:u}))}),(function(e){console.error("load3DSGeometry: "+e),r.processes--,s()}))}))}function Da(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(i,s){t.src||(console.error("loadOBJGeometry: Parameter expected: src"),s());var r=e.canvas.spinner;r.processes++,re.loadArraybuffer(t.src,(function(e){e.byteLength||(console.error("loadOBJGeometry: no data loaded"),r.processes--,s());for(var n=Ia.parse.fromOBJ(e),o=Ia.edit.unwrap(n.i_verts,n.c_verts,3),a=Ia.edit.unwrap(n.i_norms,n.c_norms,3),u=Ia.edit.unwrap(n.i_uvt,n.c_uvt,2),h=new Int32Array(n.i_verts.length),l=0;l<n.i_verts.length;l++)h[l]=l;r.processes--,i(re.apply(t,{primitive:"triangles",positions:o,normals:a.length>0?a:null,autoNormals:0===a.length,uv:u,indices:h}))}),(function(e){console.error("loadOBJGeometry: "+e),r.processes--,s()}))}))}function Aa(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var i=e.ySize||1;i<0&&(console.error("negative ySize not allowed - will invert"),i*=-1);var s=e.zSize||1;s<0&&(console.error("negative zSize not allowed - will invert"),s*=-1);var r=e.center,n=r?r[0]:0,o=r?r[1]:0,a=r?r[2]:0,u=-t+n,h=-i+o,l=-s+a,c=t+n,p=i+o,d=s+a;return re.apply(e,{primitive:"lines",positions:[u,h,l,u,h,d,u,p,l,u,p,d,c,h,l,c,h,d,c,p,l,c,p,d],indices:[0,1,1,3,3,2,2,0,4,5,5,7,7,6,6,4,0,4,1,5,2,6,3,7]})}function ka(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.size||1;t<0&&(console.error("negative size not allowed - will invert"),t*=-1);var i=e.divisions||1;i<0&&(console.error("negative divisions not allowed - will invert"),i*=-1),i<1&&(i=1);for(var s=(t=t||10)/(i=i||10),r=t/2,n=[],o=[],a=0,u=0,h=-r;u<=i;u++,h+=s)n.push(-r),n.push(0),n.push(h),n.push(r),n.push(0),n.push(h),n.push(h),n.push(0),n.push(-r),n.push(h),n.push(0),n.push(r),o.push(a++),o.push(a++),o.push(a++),o.push(a++);return re.apply(e,{primitive:"lines",positions:n,indices:o})}function Ea(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var i=e.zSize||1;i<0&&(console.error("negative zSize not allowed - will invert"),i*=-1);var s=e.xSegments||1;s<0&&(console.error("negative xSegments not allowed - will invert"),s*=-1),s<1&&(s=1);var r=e.xSegments||1;r<0&&(console.error("negative zSegments not allowed - will invert"),r*=-1),r<1&&(r=1);var n,o,a,u,h,l,c,p=e.center,d=p?p[0]:0,f=p?p[1]:0,m=p?p[2]:0,v=t/2,g=i/2,_=Math.floor(s)||1,y=Math.floor(r)||1,b=_+1,x=y+1,P=t/_,T=i/y,w=new Float32Array(b*x*3),M=new Float32Array(b*x*3),I=new Float32Array(b*x*2),C=0,D=0;for(n=0;n<x;n++){var A=n*T-g;for(o=0;o<b;o++)a=o*P-v,w[C]=a+d,w[C+1]=f,w[C+2]=-A+m,M[C+2]=-1,I[D]=o/_,I[D+1]=(y-n)/y,C+=3,D+=2}C=0;var k=new(w.length/3>65535?Uint32Array:Uint16Array)(_*y*6);for(n=0;n<y;n++)for(o=0;o<_;o++)u=o+b*n,h=o+b*(n+1),l=o+1+b*(n+1),c=o+1+b*n,k[C]=c,k[C+1]=h,k[C+2]=u,k[C+3]=c,k[C+4]=l,k[C+5]=h,C+=6;return re.apply(e,{positions:w,normals:M,uv:I,indices:k})}function Fa(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.radius||1;t<0&&(console.error("negative radius not allowed - will invert"),t*=-1),t*=.5;var i=e.tube||.3;i<0&&(console.error("negative tube not allowed - will invert"),i*=-1);var s=e.radialSegments||32;s<0&&(console.error("negative radialSegments not allowed - will invert"),s*=-1),s<4&&(s=4);var r=e.tubeSegments||24;r<0&&(console.error("negative tubeSegments not allowed - will invert"),r*=-1),r<4&&(r=4);var n=e.arc||2*Math.PI;n<0&&(console.warn("negative arc not allowed - will invert"),n*=-1),n>360&&(n=360);var o,a,u,h,l,c,p,d,f,m,v,g,_=e.center,y=_?_[0]:0,b=_?_[1]:0,x=_?_[2]:0,P=[],T=[],w=[],M=[];for(d=0;d<=r;d++)for(p=0;p<=s;p++)o=p/s*n,a=.785398+d/r*Math.PI*2,y=t*Math.cos(o),b=t*Math.sin(o),u=(t+i*Math.cos(a))*Math.cos(o),h=(t+i*Math.cos(a))*Math.sin(o),l=i*Math.sin(a),P.push(u+y),P.push(h+b),P.push(l+x),w.push(1-p/s),w.push(d/r),c=q.normalizeVec3(q.subVec3([u,h,l],[y,b,x],[]),[]),T.push(c[0]),T.push(c[1]),T.push(c[2]);for(d=1;d<=r;d++)for(p=1;p<=s;p++)f=(s+1)*d+p-1,m=(s+1)*(d-1)+p-1,v=(s+1)*(d-1)+p,g=(s+1)*d+p,M.push(f),M.push(m),M.push(v),M.push(v),M.push(g),M.push(f);return re.apply(e,{positions:P,normals:T,uv:w,indices:M})}Ia.load=function(e,t){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(e){t(e.target.response)},i.send()},Ia.save=function(e,t){var i="data:application/octet-stream;base64,"+btoa(Ia.parse._buffToStr(e));window.location.href=i},Ia.clone=function(e){return JSON.parse(JSON.stringify(e))},Ia.bin={},Ia.bin.f=new Float32Array(1),Ia.bin.fb=new Uint8Array(Ia.bin.f.buffer),Ia.bin.rf=function(e,t){for(var i=Ia.bin.f,s=Ia.bin.fb,r=0;r<4;r++)s[r]=e[t+r];return i[0]},Ia.bin.rsl=function(e,t){return e[t]|e[t+1]<<8},Ia.bin.ril=function(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24},Ia.bin.rASCII0=function(e,t){for(var i="";0!=e[t];)i+=String.fromCharCode(e[t++]);return i},Ia.bin.wf=function(e,t,i){new Float32Array(e.buffer,t,1)[0]=i},Ia.bin.wsl=function(e,t,i){e[t]=i,e[t+1]=i>>8},Ia.bin.wil=function(e,t,i){e[t]=i,e[t+1]=i>>8,e[t+2]=i>>16,e[t+3]},Ia.parse={},Ia.parse._buffToStr=function(e){for(var t=new Uint8Array(e),i="",s=0;s<t.length;s++)i=i.concat(String.fromCharCode(t[s]));return i},Ia.parse._strToBuff=function(e){for(var t=new ArrayBuffer(e.length),i=new Uint8Array(t),s=0;s<e.length;s++)i[s]=e.charCodeAt(s);return t},Ia.parse._readLine=function(e,t){for(var i="";10!=e[t];)i+=String.fromCharCode(e[t++]);return i},Ia.parse.fromJSON=function(e){return JSON.parse(Ia.parse._buffToStr(e))},Ia.parse.toJSON=function(e){var t=JSON.stringify(e);return Ia.parse._strToBuff(t)},Ia.parse.fromOBJ=function(e){for(var t={groups:{},c_verts:[],c_uvt:[],c_norms:[],i_verts:[],i_uvt:[],i_norms:[]},i={from:0,to:0},s=0,r=new Uint8Array(e);s<r.length;){var n=Ia.parse._readLine(r,s);s+=n.length+1;var o=(n=(n=n.replace(/ +(?= )/g,"")).replace(/(^\s+|\s+$)/g,"")).split(" ");if("g"==o[0]&&(i.to=t.i_verts.length,null==t.groups[o[1]]&&(t.groups[o[1]]={from:t.i_verts.length,to:0}),i=t.groups[o[1]]),"v"==o[0]){var a=parseFloat(o[1]),u=parseFloat(o[2]),h=parseFloat(o[3]);t.c_verts.push(a,u,h)}if("vt"==o[0]){a=parseFloat(o[1]),u=1-parseFloat(o[2]);t.c_uvt.push(a,u)}if("vn"==o[0]){a=parseFloat(o[1]),u=parseFloat(o[2]),h=parseFloat(o[3]);t.c_norms.push(a,u,h)}if("f"==o[0]){var l=o[1].split("/"),c=o[2].split("/"),p=o[3].split("/"),d=parseInt(l[0])-1,f=parseInt(c[0])-1,m=parseInt(p[0])-1,v=parseInt(l[1])-1,g=parseInt(c[1])-1,_=parseInt(p[1])-1,y=parseInt(l[2])-1,b=parseInt(c[2])-1,x=parseInt(p[2])-1,P=t.c_verts.length/3,T=t.c_uvt.length/2,w=t.c_norms.length/3;if(d<0&&(d=P+d+1),f<0&&(f=P+f+1),m<0&&(m=P+m+1),v<0&&(v=T+v+1),g<0&&(g=T+g+1),_<0&&(_=T+_+1),y<0&&(y=w+y+1),b<0&&(b=w+b+1),x<0&&(x=w+x+1),t.i_verts.push(d,f,m),t.i_uvt.push(v,g,_),t.i_norms.push(y,b,x),5==o.length){var M=o[4].split("/"),I=parseInt(M[0])-1,C=parseInt(M[1])-1,D=parseInt(M[2])-1;I<0&&(I=P+I+1),C<0&&(C=T+C+1),D<0&&(D=w+D+1),t.i_verts.push(d,m,I),t.i_uvt.push(v,_,C),t.i_norms.push(y,x,D)}}}return i.to=t.i_verts.length,t},Ia.parse.fromMD2=function(e){e=new Uint8Array(e);var t={},i={};i.ident=Ia.bin.ril(e,0),i.version=Ia.bin.ril(e,4),i.skinwidth=Ia.bin.ril(e,8),i.skinheight=Ia.bin.ril(e,12),i.framesize=Ia.bin.ril(e,16),i.num_skins=Ia.bin.ril(e,20),i.num_vertices=Ia.bin.ril(e,24),i.num_st=Ia.bin.ril(e,28),i.num_tris=Ia.bin.ril(e,32),i.num_glcmds=Ia.bin.ril(e,36),i.num_frames=Ia.bin.ril(e,40),i.offset_skins=Ia.bin.ril(e,44),i.offset_st=Ia.bin.ril(e,48),i.offset_tris=Ia.bin.ril(e,52),i.offset_frames=Ia.bin.ril(e,56),i.offset_glcmds=Ia.bin.ril(e,60),i.offset_end=Ia.bin.ril(e,64);var s=i.offset_st;t.c_uvt=[];for(var r=0;r<i.num_st;r++){var n=Ia.bin.rsl(e,s)/i.skinwidth,o=Ia.bin.rsl(e,s+2)/i.skinheight;t.c_uvt.push(n,o),s+=4}s=i.offset_tris;var a=[],u=[];t.i_verts=a,t.i_uvt=u;for(r=0;r<i.num_tris;r++)a.push(Ia.bin.rsl(e,s),Ia.bin.rsl(e,s+2),Ia.bin.rsl(e,s+4)),u.push(Ia.bin.rsl(e,s+6),Ia.bin.rsl(e,s+8),Ia.bin.rsl(e,s+10)),s+=12;s=i.offset_skins;t.skins=[];for(r=0;r<i.num_skins;r++)t.skins.push(Ia.bin.rASCII0(e,s)),s+=64;s=i.offset_frames;t.frames=[];var h=Ia.parse.fromMD2._normals;for(r=0;r<i.num_frames;r++){var l={},c=Ia.bin.rf(e,s),p=Ia.bin.rf(e,s+4),d=Ia.bin.rf(e,s+8);s+=12;var f=Ia.bin.rf(e,s),m=Ia.bin.rf(e,s+4),v=Ia.bin.rf(e,s+8);s+=12,l.name=Ia.bin.rASCII0(e,s),s+=16,l.verts=[],l.norms=[];for(var g=0;g<i.num_vertices;g++)l.verts.push(e[s]*c+f,e[s+1]*p+m,e[s+2]*d+v),l.norms.push(h[3*e[s+3]],h[3*e[s+3]+1],h[3*e[s+3]+2]),s+=4;t.frames.push(l)}return t},Ia.parse.fromMD2._normals=[-.525731,0,.850651,-.442863,.238856,.864188,-.295242,0,.955423,-.309017,.5,.809017,-.16246,.262866,.951056,0,0,1,0,.850651,.525731,-.147621,.716567,.681718,.147621,.716567,.681718,0,.525731,.850651,.309017,.5,.809017,.525731,0,.850651,.295242,0,.955423,.442863,.238856,.864188,.16246,.262866,.951056,-.681718,.147621,.716567,-.809017,.309017,.5,-.587785,.425325,.688191,-.850651,.525731,0,-.864188,.442863,.238856,-.716567,.681718,.147621,-.688191,.587785,.425325,-.5,.809017,.309017,-.238856,.864188,.442863,-.425325,.688191,.587785,-.716567,.681718,-.147621,-.5,.809017,-.309017,-.525731,.850651,0,0,.850651,-.525731,-.238856,.864188,-.442863,0,.955423,-.295242,-.262866,.951056,-.16246,0,1,0,0,.955423,.295242,-.262866,.951056,.16246,.238856,.864188,.442863,.262866,.951056,.16246,.5,.809017,.309017,.238856,.864188,-.442863,.262866,.951056,-.16246,.5,.809017,-.309017,.850651,.525731,0,.716567,.681718,.147621,.716567,.681718,-.147621,.525731,.850651,0,.425325,.688191,.587785,.864188,.442863,.238856,.688191,.587785,.425325,.809017,.309017,.5,.681718,.147621,.716567,.587785,.425325,.688191,.955423,.295242,0,1,0,0,.951056,.16246,.262866,.850651,-.525731,0,.955423,-.295242,0,.864188,-.442863,.238856,.951056,-.16246,.262866,.809017,-.309017,.5,.681718,-.147621,.716567,.850651,0,.525731,.864188,.442863,-.238856,.809017,.309017,-.5,.951056,.16246,-.262866,.525731,0,-.850651,.681718,.147621,-.716567,.681718,-.147621,-.716567,.850651,0,-.525731,.809017,-.309017,-.5,.864188,-.442863,-.238856,.951056,-.16246,-.262866,.147621,.716567,-.681718,.309017,.5,-.809017,.425325,.688191,-.587785,.442863,.238856,-.864188,.587785,.425325,-.688191,.688191,.587785,-.425325,-.147621,.716567,-.681718,-.309017,.5,-.809017,0,.525731,-.850651,-.525731,0,-.850651,-.442863,.238856,-.864188,-.295242,0,-.955423,-.16246,.262866,-.951056,0,0,-1,.295242,0,-.955423,.16246,.262866,-.951056,-.442863,-.238856,-.864188,-.309017,-.5,-.809017,-.16246,-.262866,-.951056,0,-.850651,-.525731,-.147621,-.716567,-.681718,.147621,-.716567,-.681718,0,-.525731,-.850651,.309017,-.5,-.809017,.442863,-.238856,-.864188,.16246,-.262866,-.951056,.238856,-.864188,-.442863,.5,-.809017,-.309017,.425325,-.688191,-.587785,.716567,-.681718,-.147621,.688191,-.587785,-.425325,.587785,-.425325,-.688191,0,-.955423,-.295242,0,-1,0,.262866,-.951056,-.16246,0,-.850651,.525731,0,-.955423,.295242,.238856,-.864188,.442863,.262866,-.951056,.16246,.5,-.809017,.309017,.716567,-.681718,.147621,.525731,-.850651,0,-.238856,-.864188,-.442863,-.5,-.809017,-.309017,-.262866,-.951056,-.16246,-.850651,-.525731,0,-.716567,-.681718,-.147621,-.716567,-.681718,.147621,-.525731,-.850651,0,-.5,-.809017,.309017,-.238856,-.864188,.442863,-.262866,-.951056,.16246,-.864188,-.442863,.238856,-.809017,-.309017,.5,-.688191,-.587785,.425325,-.681718,-.147621,.716567,-.442863,-.238856,.864188,-.587785,-.425325,.688191,-.309017,-.5,.809017,-.147621,-.716567,.681718,-.425325,-.688191,.587785,-.16246,-.262866,.951056,.442863,-.238856,.864188,.16246,-.262866,.951056,.309017,-.5,.809017,.147621,-.716567,.681718,0,-.525731,.850651,.425325,-.688191,.587785,.587785,-.425325,.688191,.688191,-.587785,.425325,-.955423,.295242,0,-.951056,.16246,.262866,-1,0,0,-.850651,0,.525731,-.955423,-.295242,0,-.951056,-.16246,.262866,-.864188,.442863,-.238856,-.951056,.16246,-.262866,-.809017,.309017,-.5,-.864188,-.442863,-.238856,-.951056,-.16246,-.262866,-.809017,-.309017,-.5,-.681718,.147621,-.716567,-.681718,-.147621,-.716567,-.850651,0,-.525731,-.688191,.587785,-.425325,-.587785,.425325,-.688191,-.425325,.688191,-.587785,-.425325,-.688191,-.587785,-.587785,-.425325,-.688191,-.688191,-.587785,-.425325],Ia.parse.fromCollada=function(e){var t=Ia.parse._buffToStr(e),i=(new DOMParser).parseFromString(t,"text/xml"),s={},r=(i=i.childNodes[0]).getElementsByTagName("asset")[0],n=i.getElementsByTagName("library_geometries")[0],o=i.getElementsByTagName("library_images")[0],a=i.getElementsByTagName("library_materials")[0],u=i.getElementsByTagName("library_effects")[0];return r&&(s.asset=Ia.parse.fromCollada._asset(r)),n&&(s.geometries=Ia.parse.fromCollada._libGeometries(n)),o&&(s.images=Ia.parse.fromCollada._libImages(o)),a&&(s.materials=Ia.parse.fromCollada._libMaterials(a)),u&&(s.effects=Ia.parse.fromCollada._libEffects(u)),s},Ia.parse.fromCollada._asset=function(e){return{created:e.getElementsByTagName("created")[0].textContent,modified:e.getElementsByTagName("modified")[0].textContent,up_axis:e.getElementsByTagName("up_axis")[0].textContent}},Ia.parse.fromCollada._libGeometries=function(e){e=e.getElementsByTagName("geometry");for(var t=[],i=0;i<e.length;i++){var s=e[i],r=Ia.parse.fromCollada._getMesh(s.getElementsByTagName("mesh")[0]);t.push(r)}return t},Ia.parse.fromCollada._getMesh=function(e){for(var t={},i=e.getElementsByTagName("source"),s=t.sources={},r=0;r<i.length;r++){for(var n=i[r].getElementsByTagName("float_array")[0].textContent.split(" "),o=n.length-(""==n[n.length-1]?1:0),a=new Array(o),u=0;u<o;u++)a[u]=parseFloat(n[u]);s[i[r].getAttribute("id")]=a}t.triangles=[];var h=e.getElementsByTagName("triangles");if(null==h)return t;for(r=0;r<h.length;r++){var l={},c=h[r];l.material=c.getAttribute("material");var p=c.getElementsByTagName("input"),d=[];for(u=0;u<p.length;u++){var f=p[u];a=[];d[parseInt(f.getAttribute("offset"))]=a;var m=f.getAttribute("semantic");l["s_"+m]="VERTEX"==m?e.getElementsByTagName("vertices")[0].getElementsByTagName("input")[0].getAttribute("source").substring(1):f.getAttribute("source").substring(1),l["i_"+m]=a,s[l["s_"+m]]}var v=c.getElementsByTagName("p")[0].textContent.split(" "),g=3*Math.floor(v.length/3);for(u=0;u<g;u++)d[u%p.length].push(parseInt(v[u]));t.triangles.push(l)}return t},Ia.parse.fromCollada._libImages=function(e){e=e.getElementsByTagName("image");for(var t={},i=0;i<e.length;i++)t[e[i].getAttribute("id")]=e[i].getElementsByTagName("init_from")[0].textContent;return t},Ia.parse.fromCollada._libMaterials=function(e){e=e.getElementsByTagName("material");for(var t={},i=0;i<e.length;i++)t[e[i].getAttribute("name")]=e[i].getElementsByTagName("instance_effect")[0].getAttribute("url").substring(1);return t},Ia.parse.fromCollada._libEffects=function(e){e=e.getElementsByTagName("effect");for(var t={},i=0;i<e.length;i++){for(var s={},r=e[i].getElementsByTagName("newparam"),n=0;n<r.length;n++){var o=r[n].getElementsByTagName("surface")[0];o&&(s.surface=o.getElementsByTagName("init_from")[0].textContent)}t[e[i].getAttribute("id")]=s}return t},Ia.parse.from3DS=function(e){e=new Uint8Array(e);var t={};if(19789!=Ia.bin.rsl(e,0))return null;for(var i=Ia.bin.ril(e,2),s=6;s<i;){var r=Ia.bin.rsl(e,s),n=Ia.bin.ril(e,s+2);15677==r&&(t.edit=Ia.parse.from3DS._edit3ds(e,s,n)),45056==r&&(t.keyf=Ia.parse.from3DS._keyf3ds(e,s,n)),s+=n}return t},Ia.parse.from3DS._edit3ds=function(e,t,i){for(var s={},r=t+6;r<t+i;){var n=Ia.bin.rsl(e,r),o=Ia.bin.ril(e,r+2);16384==n&&(null==s.objects&&(s.objects=[]),s.objects.push(Ia.parse.from3DS._edit_object(e,r,o))),r+=o}return s},Ia.parse.from3DS._keyf3ds=function(e,t,i){for(var s={},r=t+6;r<t+i;){var n=Ia.bin.rsl(e,r),o=Ia.bin.ril(e,r+2);45058==n&&(null==s.desc&&(s.desc=[]),s.desc.push(Ia.parse.from3DS._keyf_objdes(e,r,o))),r+=o}return s},Ia.parse.from3DS._keyf_objdes=function(e,t,i){for(var s={},r=t+6;r<t+i;){var n=Ia.bin.rsl(e,r),o=Ia.bin.ril(e,r+2);45072==n&&(s.hierarchy=Ia.parse.from3DS._keyf_objhierarch(e,r,o)),45073==n&&(s.dummy_name=Ia.bin.rASCII0(e,r+6)),r+=o}return s},Ia.parse.from3DS._keyf_objhierarch=function(e,t,i){var s={},r=t+6;return s.name=Ia.bin.rASCII0(e,r),r+=s.name.length+1,s.hierarchy=Ia.bin.rsl(e,r+4),s},Ia.parse.from3DS._edit_object=function(e,t,i){var s={},r=t+6;for(s.name=Ia.bin.rASCII0(e,r),r+=s.name.length+1;r<t+i;){var n=Ia.bin.rsl(e,r),o=Ia.bin.ril(e,r+2);16640==n&&(s.mesh=Ia.parse.from3DS._obj_trimesh(e,r,o)),r+=o}return s},Ia.parse.from3DS._obj_trimesh=function(e,t,i){for(var s={},r=t+6;r<t+i;){var n=Ia.bin.rsl(e,r),o=Ia.bin.ril(e,r+2);16656==n&&(s.vertices=Ia.parse.from3DS._tri_vertexl(e,r,o)),16672==n&&(s.indices=Ia.parse.from3DS._tri_facel1(e,r,o)),16704==n&&(s.uvt=Ia.parse.from3DS._tri_mappingcoors(e,r,o)),16736==n&&(s.local=Ia.parse.from3DS._tri_local(e,r,o)),r+=o}return s},Ia.parse.from3DS._tri_vertexl=function(e,t,i){var s=[],r=t+6,n=Ia.bin.rsl(e,r);r+=2;for(var o=0;o<n;o++)s.push(Ia.bin.rf(e,r)),s.push(Ia.bin.rf(e,r+4)),s.push(Ia.bin.rf(e,r+8)),r+=12;return s},Ia.parse.from3DS._tri_facel1=function(e,t,i){var s=[],r=t+6,n=Ia.bin.rsl(e,r);r+=2;for(var o=0;o<n;o++)s.push(Ia.bin.rsl(e,r)),s.push(Ia.bin.rsl(e,r+2)),s.push(Ia.bin.rsl(e,r+4)),r+=8;return s},Ia.parse.from3DS._tri_mappingcoors=function(e,t,i){var s=[],r=t+6,n=Ia.bin.rsl(e,r);r+=2;for(var o=0;o<n;o++)s.push(Ia.bin.rf(e,r)),s.push(1-Ia.bin.rf(e,r+4)),r+=8;return s},Ia.parse.from3DS._tri_local=function(e,t,i){var s={},r=t+6;return s.X=[Ia.bin.rf(e,r),Ia.bin.rf(e,r+4),Ia.bin.rf(e,r+8)],r+=12,s.Y=[Ia.bin.rf(e,r),Ia.bin.rf(e,r+4),Ia.bin.rf(e,r+8)],r+=12,s.Z=[Ia.bin.rf(e,r),Ia.bin.rf(e,r+4),Ia.bin.rf(e,r+8)],r+=12,s.C=[Ia.bin.rf(e,r),Ia.bin.rf(e,r+4),Ia.bin.rf(e,r+8)],r+=12,s},Ia.parse.fromBIV=function(e){e=new Uint8Array(e);var t={},i={};return i.id=Ia.bin.ril(e,0),i.verS=Ia.bin.ril(e,4),i.texS=Ia.bin.ril(e,8),i.indS=Ia.bin.ril(e,12),i.verO=Ia.bin.ril(e,16),i.verL=Ia.bin.ril(e,20),i.texO=Ia.bin.ril(e,24),i.texL=Ia.bin.ril(e,28),i.indO=Ia.bin.ril(e,32),i.indL=Ia.bin.ril(e,36),0!=i.verO&&(t.vertices=Ia.parse.fromBIV._readFloats(e,i.verO,i.verL)),0!=i.texO&&(t.uvt=Ia.parse.fromBIV._readFloats(e,i.texO,i.texL)),0!=i.indO&&(t.indices=Ia.parse.fromBIV._readInts(e,i.indO,i.indL,i.indS)),t},Ia.parse.toBIV=function(e){for(var t=0,i=0;i<e.indices.length;i++)t=Math.max(t,e.indices[i]);var s=32;t<=65535&&(s=16);var r=40;e.vertices&&(r+=4*e.vertices.length),e.uvt&&(r+=4*e.uvt.length),e.indices&&(r+=e.indices.length*s/8);var n=new Uint8Array(r);Ia.bin.wil(n,0,1769365870),Ia.bin.wil(n,4,32),Ia.bin.wil(n,8,32),Ia.bin.wil(n,12,s);var o=40;return e.vertices&&(Ia.bin.wil(n,16,o),Ia.bin.wil(n,20,4*e.vertices.length),Ia.parse.fromBIV._writeFloats(n,o,e.vertices),o+=4*e.vertices.length),e.uvt&&(Ia.bin.wil(n,24,o),Ia.bin.wil(n,28,4*e.uvt.length),Ia.parse.fromBIV._writeFloats(n,o,e.uvt),o+=4*e.uvt.length),e.indices&&(Ia.bin.wil(n,32,o),Ia.bin.wil(n,36,4*e.indices.length),Ia.parse.fromBIV._writeInts(n,o,e.indices,s)),n.buffer},Ia.parse.fromBIV._readFloats=function(e,t,i){for(var s=[],r=0;r<i/4;r++)s.push(Ia.bin.rf(e,t+4*r));return s},Ia.parse.fromBIV._writeFloats=function(e,t,i){for(var s=0;s<i.length;s++)Ia.bin.wf(e,t+4*s,i[s])},Ia.parse.fromBIV._readInts=function(e,t,i,s){for(var r=[],n=0;n<i/4;n++)16==s&&r.push(Ia.bin.rsl(e,t+2*n)),32==s&&r.push(Ia.bin.ril(e,t+4*n));return r},Ia.parse.fromBIV._writeInts=function(e,t,i,s){for(var r=0;r<i.length;r++)16==s&&Ia.bin.wsl(e,t+2*r,i[r]),32==s&&Ia.bin.wil(e,t+4*r,i[r])},Ia.gen={},Ia.gen.Plane=function(e,t,i,s){i||(i=1),s||(s=1);for(var r={verts:[],inds:[],uvt:[]},n=e+1,o=t+1,a=0;a<o;a++)for(var u=0;u<n;u++){var h=u*(2/e)-1,l=a*(2/t)-1;r.verts.push(h,l,0),r.uvt.push(i*u/e,s*a/t),a<t&&u<e&&r.inds.push(a*n+u,a*n+u+1,(a+1)*n+u,a*n+u+1,(a+1)*n+u,(a+1)*n+u+1)}return r},Ia.gen.Cube=function(){return{verts:[-1,1,-1,1,1,-1,-1,-1,-1,1,-1,-1,-1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1],inds:[0,1,2,1,2,3,4,5,6,5,6,7,8,9,10,9,10,11,12,13,14,13,14,15,16,17,18,17,18,19,20,21,22,21,22,23],uvt:[1/4,1/4,.5,1/4,1/4,.5,.5,.5,1,1/4,3/4,1/4,1,.5,3/4,.5,0,1/4,1/4,1/4,0,.5,1/4,.5,3/4,1/4,.5,1/4,3/4,.5,.5,.5,1/4,1/4,.5,1/4,1/4,0,.5,0,1/4,.5,.5,.5,1/4,3/4,.5,3/4]}},Ia.gen.Sphere=function(e,t){for(var i={verts:[],inds:[],uvt:[]},s=e+1,r=t+1,n=0;n<r;n++)for(var o=0;o<s;o++){var a=-Math.PI/2+n*Math.PI/t,u=2*o*Math.PI/e,h=Math.cos(a)*Math.cos(u),l=Math.sin(a),c=Math.cos(a)*Math.sin(u);i.verts.push(h,l,c),i.uvt.push(o/e,n/t),n<t&&o<e&&i.inds.push(s*n+o,s*n+o+1,s*(n+1)+o,s*n+o+1,s*(n+1)+o,s*(n+1)+o+1)}return i},Ia.mat={},Ia.mat.scale=function(e,t,i){return[e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1]},Ia.mat.translate=function(e,t,i){return[1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1]},Ia.mat.rotateDeg=function(e,t,i){var s=Math.PI/180;return Ia.mat.rotate(e*s,t*s,i*s)},Ia.mat.rotate=function(e,t,i){var s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r=e,n=t,o=i,a=Math.cos(r),u=Math.cos(n),h=Math.cos(o),l=Math.sin(r),c=Math.sin(n),p=Math.sin(o);return s[0]=u*h,s[1]=-u*p,s[2]=c,s[4]=a*p+l*c*h,s[5]=a*h-l*c*p,s[6]=-l*u,s[8]=l*p-a*c*h,s[9]=l*h+a*c*p,s[10]=a*u,s},Ia.edit={},Ia.edit.interpolate=function(e,t,i,s){for(var r=0;r<e.length;r++)i[r]=e[r]+s*(t[r]-e[r])},Ia.edit.transform=function(e,t){for(var i=0;i<e.length;i+=3){var s=e[i],r=e[i+1],n=e[i+2];e[i+0]=t[0]*s+t[4]*r+t[8]*n+t[12],e[i+1]=t[1]*s+t[5]*r+t[9]*n+t[13],e[i+2]=t[2]*s+t[6]*r+t[10]*n+t[14]}},Ia.edit.unwrap=function(e,t,i){for(var s=new Array(Math.floor(e.length/3)*i),r=0;r<e.length;r++)for(var n=0;n<i;n++)s[r*i+n]=t[e[r]*i+n];return s},Ia.edit.remap=function(e,t,i,s){for(var r=new Array(i.length),n=0;n<e.length;n++)for(var o=0;o<s;o++)r[t[n]*s+o]=i[e[n]*s+o];return r},Ia.utils={},Ia.utils.getAABB=function(e){var t,i,s,r,n,o;r=n=o=-(t=i=s=999999999);for(var a=0;a<e.length;a+=3){var u=e[a+0],h=e[a+1],l=e[a+2];u<t&&(t=u),u>r&&(r=u),h<i&&(i=h),h>n&&(n=h),l<s&&(s=l),h>o&&(o=l)}return{min:{x:t,y:i,z:s},max:{x:r,y:n,z:o}}};var Ra=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._type=r.type||(r.src?r.src.split(".").pop():null)||"jpg",s._pos=q.vec3(r.pos||[0,0,0]),s._up=q.vec3(r.up||[0,1,0]),s._normal=q.vec3(r.normal||[0,0,1]),s._height=r.height||1,s._origin=q.vec3(),s._rtcPos=q.vec3(),s._imageSize=q.vec2(),s._texture=new xa(x(s)),s._image=new Image,"jpg"!==s._type&&"png"!==s._type&&(s.error('Unsupported type - defaulting to "jpg"'),s._type="jpg"),s._node=new na(x(s),{matrix:q.inverseMat4(q.lookAtMat4v(s._pos,q.subVec3(s._pos,s._normal,q.mat4()),s._up,q.mat4())),children:[s._bitmapMesh=new Uo(x(s),{scale:[1,1,1],rotation:[-90,0,0],collidable:r.collidable,pickable:r.pickable,opacity:r.opacity,clippable:r.clippable,geometry:new _r(x(s),Ea({center:[0,0,0],xSize:1,zSize:1,xSegments:2,zSegments:2})),material:new Tr(x(s),{diffuse:[0,0,0],ambient:[0,0,0],specular:[0,0,0],diffuseMap:s._texture,emissiveMap:s._texture,backfaces:!0})})]}),r.image?s.image=r.image:r.src?s.src=r.src:r.imageData&&(s.imageData=r.imageData),s.scene._bitmapCreated(x(s)),s}return I(i,[{key:"visible",get:function(){return this._bitmapMesh.visible},set:function(e){this._bitmapMesh.visible=e}},{key:"image",get:function(){return this._image},set:function(e){this._image=e,this._image&&(this._texture.image=this._image,this._imageSize[0]=this._image.width,this._imageSize[1]=this._image.height,this._updateBitmapMeshScale())}},{key:"src",get:function(){return this._image.src},set:function(e){var t=this;if(e)switch(this._image.onload=function(){t._texture.image=t._image,t._imageSize[0]=t._image.width,t._imageSize[1]=t._image.height,t._updateBitmapMeshScale()},this._image.src=e,e.split(".").pop()){case"jpeg":case"jpg":this._type="jpg";break;case"png":this._type="png"}}},{key:"imageData",get:function(){var e=document.createElement("canvas"),t=e.getContext("2d");return e.width=this._image.width,e.height=this._image.height,t.drawImage(this._image,0,0),e.toDataURL("jpg"===this._type?"image/jpeg":"image/png")},set:function(e){var t=this;this._image.onload=function(){t._texture.image=image,t._imageSize[0]=image.width,t._imageSize[1]=image.height,t._updateBitmapMeshScale()},this._image.src=e}},{key:"type",get:function(){return this._type},set:function(e){"png"===(e=e||"jpg")&&"jpg"===e||(this.error("Unsupported value for `type` - supported types are `jpg` and `png` - defaulting to `jpg`"),e="jpg"),this._type=e}},{key:"pos",get:function(){return this._pos}},{key:"normal",get:function(){return this._normal}},{key:"up",get:function(){return this._up}},{key:"height",get:function(){return this._height},set:function(e){this._height=null==e?1:e,this._image&&this._updateBitmapMeshScale()}},{key:"collidable",get:function(){return this._bitmapMesh.collidable},set:function(e){this._bitmapMesh.collidable=!1!==e}},{key:"clippable",get:function(){return this._bitmapMesh.clippable},set:function(e){this._bitmapMesh.clippable=!1!==e}},{key:"pickable",get:function(){return this._bitmapMesh.pickable},set:function(e){this._bitmapMesh.pickable=!1!==e}},{key:"opacity",get:function(){return this._bitmapMesh.opacity},set:function(e){this._bitmapMesh.opacity=e}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this.scene._bitmapDestroyed(this)}},{key:"_updateBitmapMeshScale",value:function(){var e=this._imageSize[1]/this._imageSize[0];this._bitmapMesh.scale=[this._height*e,1,this._height]}}]),i}(),Sa=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(w(this,i),(s=t.call(this,e,r))._positions=r.positions||[],s._origin=q.vec3(r.origin||[0,0,0]),r.indices)s._indices=r.indices;else{s._indices=[];for(var n=0,o=s._positions.length/3-1;n<o;n+=2)s._indices.push(n),s._indices.push(n+1)}return s._mesh=new Uo(x(s),{visible:r.visible,clippable:r.clippable,collidable:r.collidable,geometry:new Ma(x(s),{primitive:"lines",positions:s._positions,indices:s._indices,origin:r.origin}),material:new Tr(x(s),{diffuse:r.color||[0,0,0],emissive:r.color||[0,0,0]})}),s.scene._lineSetCreated(x(s)),s}return I(i,[{key:"visible",get:function(){return this._mesh.visible},set:function(e){this._mesh.visible=e}},{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this.scene._lineSetDestroyed(this)}}]),i}(),Oa=q.vec3(),Ba=q.vec3(),La=q.vec3(),Na=q.vec3(),ja=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,"BCFViewpoints",e,r)).originatingSystem=r.originatingSystem||"xeokit.io",s.authoringTool=r.authoringTool||"xeokit.io",s}return I(i,[{key:"getViewpoint",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=this.viewer.scene,s=i.camera,r=i.realWorldOffset,n=!0===t.reverseClippingPlanes,o={},a=q.normalizeVec3(q.subVec3(s.look,s.eye,q.vec3())),u=s.eye,h=s.up;s.yUp&&(a=Ua(a),u=Ua(u),h=Ua(h));var l=Ga(q.addVec3(u,r));"ortho"===s.projection?o.orthogonal_camera={camera_view_point:l,camera_direction:Ga(a),camera_up_vector:Ga(h),view_to_world_scale:s.ortho.scale}:o.perspective_camera={camera_view_point:l,camera_direction:Ga(a),camera_up_vector:Ga(h),field_of_view:s.perspective.fov};var c=i.sectionPlanes;for(var d in c)if(c.hasOwnProperty(d)){var f=c[d];if(!f.active)continue;var m=f.pos,v=void 0;v=n?q.negateVec3(f.dir,q.vec3()):f.dir,s.yUp&&(m=Ua(m),v=Ua(v)),q.addVec3(m,r),m=Ga(m),v=Ga(v),o.clipping_planes||(o.clipping_planes=[]),o.clipping_planes.push({location:m,direction:v})}var g=i.lineSets;for(var _ in g)if(g.hasOwnProperty(_)){var y=g[_];o.lines||(o.lines=[]);for(var b=y.positions,x=y.indices,P=0,T=x.length/2;P<T;P++){var w=x[2*P],M=x[2*P+1];o.lines.push({start_point:{x:b[3*w+0],y:b[3*w+1],z:b[3*w+2]},end_point:{x:b[3*M+0],y:b[3*M+1],z:b[3*M+2]}})}}var I=i.bitmaps;for(var C in I)if(I.hasOwnProperty(C)){var D=I[C],A=D.pos,k=D.normal,E=D.up;s.yUp&&(A=Ua(A),k=Ua(k),E=Ua(E)),q.addVec3(A,r),o.bitmaps||(o.bitmaps=[]),o.bitmaps.push({bitmap_type:D.type,bitmap_data:D.imageData,location:Ga(A),normal:Ga(k),up:Ga(E),height:D.height})}o.components={visibility:{view_setup_hints:{spaces_visible:!!t.spacesVisible,space_boundaries_visible:!!t.spaceBoundariesVisible,openings_visible:!!t.openingsVisible}}};var F=new Set(i.opacityObjectIds),R=new Set(i.xrayedObjectIds),S=new Set(i.colorizedObjectIds),O=Object.values(i.objects).filter((function(e){return F.has(e.id)||S.has(e.id)||R.has(e.id)})).reduce((function(t,s){var r,n=za(s.colorize);s.xrayed?(r=0===i.xrayMaterial.fillAlpha&&0!==i.xrayMaterial.edgeAlpha?.1:i.xrayMaterial.fillAlpha,n=(r=Math.round(255*r).toString(16).padStart(2,"0"))+n):F.has(s.id)&&(n=(r=Math.round(255*s.opacity).toString(16).padStart(2,"0"))+n),t[n]||(t[n]=[]);var o=s.id,a=s.originalSystemId,u={ifc_guid:a,originating_system:e.originatingSystem};return a!==o&&(u.authoring_tool_id=o),t[n].push(u),t}),{}),B=Object.entries(O).map((function(e){var t=p(e,2);return{color:t[0],components:t[1]}}));o.components.coloring=B;var L=i.objectIds,N=i.visibleObjects,j=i.visibleObjectIds,G=L.filter((function(e){return!N[e]})),H=i.selectedObjectIds;return t.defaultInvisible||j.length<G.length?(o.components.visibility.exceptions=this._createBCFComponents(j),o.components.visibility.default_visibility=!1):(o.components.visibility.exceptions=this._createBCFComponents(G),o.components.visibility.default_visibility=!0),o.components.selection=this._createBCFComponents(H),!1!==t.snapshot&&(o.snapshot={snapshot_type:"png",snapshot_data:this.viewer.getSnapshot({format:"png"})}),o}},{key:"_createBCFComponents",value:function(e){for(var t=this.viewer.scene,i=[],s=0,r=e.length;s<r;s++){var n=e[s],o=t.objects[n];if(o){var a={ifc_guid:o.originalSystemId,originating_system:this.originatingSystem};o.originalSystemId!==n&&(a.authoring_tool_id=n),i.push(a)}}return i}},{key:"setViewpoint",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){var s=this.viewer,r=s.scene,n=r.camera,o=!1!==i.rayCast,a=!1!==i.immediate,u=!1!==i.reset,h=r.realWorldOffset,l=!0===i.reverseClippingPlanes;if(r.clearSectionPlanes(),e.clipping_planes&&e.clipping_planes.forEach((function(e){var t=Ha(e.location,Oa),i=Ha(e.direction,Oa);l&&q.negateVec3(i),q.subVec3(t,h),n.yUp&&(t=Va(t),i=Va(i)),new Jo(r,{pos:t,dir:i})})),r.clearLines(),e.lines){var c=[],p=[],d=0;e.lines.forEach((function(e){e.start_point&&e.end_point&&(c.push(e.start_point.x),c.push(e.start_point.y),c.push(e.start_point.z),c.push(e.end_point.x),c.push(e.end_point.y),c.push(e.end_point.z),p.push(d++),p.push(d++))})),new Sa(r,{positions:c,indices:p,clippable:!1,collidable:!0})}if(r.clearBitmaps(),e.bitmaps&&e.bitmaps.forEach((function(e){var t=e.bitmap_type||"jpg",i=e.bitmap_data,s=Ha(e.location,Ba),o=Ha(e.normal,La),a=Ha(e.up,Na),u=e.height||1;t&&i&&s&&o&&a&&(n.yUp&&(s=Va(s),o=Va(o),a=Va(a)),new Ra(r,{src:i,type:t,pos:s,normal:o,up:a,clippable:!1,collidable:!0,height:u}))})),u&&(r.setObjectsXRayed(r.xrayedObjectIds,!1),r.setObjectsHighlighted(r.highlightedObjectIds,!1),r.setObjectsSelected(r.selectedObjectIds,!1)),e.components){if(e.components.visibility){e.components.visibility.default_visibility?(r.setObjectsVisible(r.objectIds,!0),e.components.visibility.exceptions&&e.components.visibility.exceptions.forEach((function(e){return t._withBCFComponent(i,e,(function(e){return e.visible=!1}))}))):(r.setObjectsVisible(r.objectIds,!1),e.components.visibility.exceptions&&e.components.visibility.exceptions.forEach((function(e){return t._withBCFComponent(i,e,(function(e){return e.visible=!0}))})));var f=e.components.visibility.view_setup_hints;f&&(!1===f.spaces_visible&&r.setObjectsVisible(s.metaScene.getObjectIDsByType("IfcSpace"),!1),!1===f.openings_visible&&r.setObjectsVisible(s.metaScene.getObjectIDsByType("IfcOpening"),!1),f.space_boundaries_visible)}e.components.selection&&(r.setObjectsSelected(r.selectedObjectIds,!1),e.components.selection.forEach((function(e){return t._withBCFComponent(i,e,(function(e){return e.selected=!0}))}))),e.components.coloring&&e.components.coloring.forEach((function(e){var s=e.color,r=0,n=!1;8===s.length&&((r=parseInt(s.substring(0,2),16)/256)<=1&&r>=.95&&(r=1),s=s.substring(2),n=!0);var o=[parseInt(s.substring(0,2),16)/256,parseInt(s.substring(2,4),16)/256,parseInt(s.substring(4,6),16)/256];e.components.map((function(e){return t._withBCFComponent(i,e,(function(e){e.colorize=o,n&&(e.opacity=r)}))}))}))}if(e.perspective_camera||e.orthogonal_camera){var m,v,g,_;if(e.perspective_camera?(m=Ha(e.perspective_camera.camera_view_point,Oa),v=Ha(e.perspective_camera.camera_direction,Oa),g=Ha(e.perspective_camera.camera_up_vector,Oa),n.perspective.fov=e.perspective_camera.field_of_view,_="perspective"):(m=Ha(e.orthogonal_camera.camera_view_point,Oa),v=Ha(e.orthogonal_camera.camera_direction,Oa),g=Ha(e.orthogonal_camera.camera_up_vector,Oa),n.ortho.scale=e.orthogonal_camera.view_to_world_scale,_="ortho"),q.subVec3(m,h),n.yUp&&(m=Va(m),v=Va(v),g=Va(g)),o){var y=r.pick({pickSurface:!0,origin:m,direction:v});v=y?y.worldPos:q.addVec3(m,v,Oa)}else v=q.addVec3(m,v,Oa);a?(n.eye=m,n.look=v,n.up=g,n.projection=_):s.cameraFlight.flyTo({eye:m,look:v,up:g,duration:i.duration,projection:_})}}}},{key:"_withBCFComponent",value:function(e,t,i){var s=this.viewer,r=s.scene;if(t.authoring_tool_id&&t.originating_system===this.originatingSystem){var n=t.authoring_tool_id,o=r.objects[n];if(o)return void i(o);if(e.updateCompositeObjects)if(s.metaScene.metaObjects[n])return void r.withObjects(s.metaScene.getObjectIDsInSubtree(n),i)}if(t.ifc_guid){var a=t.ifc_guid,u=r.objects[a];if(u)return void i(u);if(e.updateCompositeObjects)if(s.metaScene.metaObjects[a])return void r.withObjects(s.metaScene.getObjectIDsInSubtree(a),i);Object.keys(r.models).forEach((function(t){var n=q.globalizeObjectId(t,a),o=r.objects[n];o?i(o):e.updateCompositeObjects&&s.metaScene.metaObjects[n]&&r.withObjects(s.metaScene.getObjectIDsInSubtree(n),i)}))}}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this)}}]),i}();function Ga(e){return{x:e[0],y:e[1],z:e[2]}}function Ha(e,t){return(t=new Float64Array(3))[0]=e.x,t[1]=e.y,t[2]=e.z,t}function Ua(e){return new Float64Array([e[0],-e[2],e[1]])}function Va(e){return new Float64Array([e[0],e[2],-e[1]])}function za(e){var t="";return t+=Math.round(255*e[0]).toString(16).padStart(2,"0"),t+=Math.round(255*e[1]).toString(16).padStart(2,"0"),t+=Math.round(255*e[2]).toString(16).padStart(2,"0")}var Wa=q.vec3(),Xa=function(e,t,i,s){var r=e-i,n=t-s;return Math.sqrt(r*r+n*n)},Ya=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(w(this,i),(s=t.call(this,e.viewer.scene,r)).plugin=e,s._container=r.container,!s._container)throw"config missing: container";s._eventSubs={};var n=s.plugin.viewer.scene;s._originMarker=new Se(n,r.origin),s._targetMarker=new Se(n,r.target),s._originWorld=q.vec3(),s._targetWorld=q.vec3(),s._wp=new Float64Array(24),s._vp=new Float64Array(24),s._pp=new Float64Array(24),s._cp=new Float64Array(8),s._xAxisLabelCulled=!1,s._yAxisLabelCulled=!1,s._zAxisLabelCulled=!1,s._color=r.color||s.plugin.defaultColor;var o=r.onMouseOver?function(e){r.onMouseOver(e,x(s))}:null,a=r.onMouseLeave?function(e){r.onMouseLeave(e,x(s))}:null,u=r.onContextMenu?function(e){r.onContextMenu(e,x(s))}:null,h=function(e){s.plugin.viewer.scene.canvas.canvas.dispatchEvent(new WheelEvent("wheel",e))};return s._originDot=new Be(s._container,{fillColor:s._color,zIndex:void 0!==e.zIndex?e.zIndex+2:void 0,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._targetDot=new Be(s._container,{fillColor:s._color,zIndex:void 0!==e.zIndex?e.zIndex+2:void 0,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._lengthWire=new Oe(s._container,{color:s._color,thickness:2,thicknessClickable:6,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._xAxisWire=new Oe(s._container,{color:"#FF0000",thickness:1,thicknessClickable:6,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._yAxisWire=new Oe(s._container,{color:"green",thickness:1,thicknessClickable:6,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._zAxisWire=new Oe(s._container,{color:"blue",thickness:1,thicknessClickable:6,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._lengthLabel=new Le(s._container,{fillColor:s._color,prefix:"",text:"",zIndex:void 0!==e.zIndex?e.zIndex+4:void 0,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._xAxisLabel=new Le(s._container,{fillColor:"red",prefix:"X",text:"",zIndex:void 0!==e.zIndex?e.zIndex+3:void 0,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._yAxisLabel=new Le(s._container,{fillColor:"green",prefix:"Y",text:"",zIndex:void 0!==e.zIndex?e.zIndex+3:void 0,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._zAxisLabel=new Le(s._container,{fillColor:"blue",prefix:"Z",text:"",zIndex:void 0!==e.zIndex?e.zIndex+3:void 0,onMouseOver:o,onMouseLeave:a,onMouseWheel:h,onContextMenu:u}),s._wpDirty=!1,s._vpDirty=!1,s._cpDirty=!1,s._visible=!1,s._originVisible=!1,s._targetVisible=!1,s._wireVisible=!1,s._axisVisible=!1,s._xAxisVisible=!1,s._yAxisVisible=!1,s._zAxisVisible=!1,s._axisEnabled=!0,s._labelsVisible=!1,s._clickable=!1,s._originMarker.on("worldPos",(function(e){s._originWorld.set(e||[0,0,0]),s._wpDirty=!0,s._needUpdate(0)})),s._targetMarker.on("worldPos",(function(e){s._targetWorld.set(e||[0,0,0]),s._wpDirty=!0,s._needUpdate(0)})),s._onViewMatrix=n.camera.on("viewMatrix",(function(){s._vpDirty=!0,s._needUpdate(0)})),s._onProjMatrix=n.camera.on("projMatrix",(function(){s._cpDirty=!0,s._needUpdate()})),s._onCanvasBoundary=n.canvas.on("boundary",(function(){s._cpDirty=!0,s._needUpdate(0)})),s._onMetricsUnits=n.metrics.on("units",(function(){s._cpDirty=!0,s._needUpdate()})),s._onMetricsScale=n.metrics.on("scale",(function(){s._cpDirty=!0,s._needUpdate()})),s._onMetricsOrigin=n.metrics.on("origin",(function(){s._cpDirty=!0,s._needUpdate()})),s.approximate=r.approximate,s.visible=r.visible,s.originVisible=r.originVisible,s.targetVisible=r.targetVisible,s.wireVisible=r.wireVisible,s.axisVisible=r.axisVisible,s.xAxisVisible=r.xAxisVisible,s.yAxisVisible=r.yAxisVisible,s.zAxisVisible=r.zAxisVisible,s.labelsVisible=r.labelsVisible,s}return I(i,[{key:"_update",value:function(){if(this._visible){var e=this.plugin.viewer.scene;this._wpDirty&&(this._wp[0]=this._originWorld[0],this._wp[1]=this._originWorld[1],this._wp[2]=this._originWorld[2],this._wp[3]=1,this._wp[4]=this._targetWorld[0],this._wp[5]=this._originWorld[1],this._wp[6]=this._originWorld[2],this._wp[7]=1,this._wp[8]=this._targetWorld[0],this._wp[9]=this._targetWorld[1],this._wp[10]=this._originWorld[2],this._wp[11]=1,this._wp[12]=this._targetWorld[0],this._wp[13]=this._targetWorld[1],this._wp[14]=this._targetWorld[2],this._wp[15]=1,this._wpDirty=!1,this._vpDirty=!0),this._vpDirty&&(q.transformPositions4(e.camera.viewMatrix,this._wp,this._vp),this._vp[3]=1,this._vp[7]=1,this._vp[11]=1,this._vp[15]=1,this._vpDirty=!1,this._cpDirty=!0);var t=this._originMarker.viewPos[2],i=this._targetMarker.viewPos[2];if(t>-.3||i>-.3)return this._xAxisLabel.setCulled(!0),this._yAxisLabel.setCulled(!0),this._zAxisLabel.setCulled(!0),this._lengthLabel.setCulled(!0),this._xAxisWire.setVisible(!1),this._yAxisWire.setVisible(!1),this._zAxisWire.setVisible(!1),this._lengthWire.setVisible(!1),this._originDot.setVisible(!1),void this._targetDot.setVisible(!1);if(this._cpDirty){q.transformPositions4(e.camera.project.matrix,this._vp,this._pp);for(var s=this._pp,r=this._cp,n=e.canvas.canvas.getBoundingClientRect(),o=this._container.getBoundingClientRect(),a=n.top-o.top,u=n.left-o.left,h=e.canvas.boundary,l=h[2],c=h[3],p=0,d=this.plugin.viewer.scene.metrics,f=d.scale,m=d.units,v=d.unitsInfo[m].abbrev,g=0,_=s.length;g<_;g+=4)r[p]=u+Math.floor((1+s[g+0]/s[g+3])*l/2),r[p+1]=a+Math.floor((1-s[g+1]/s[g+3])*c/2),p+=2;if(this._originDot.setPos(r[0],r[1]),this._targetDot.setPos(r[6],r[7]),this._lengthWire.setStartAndEnd(r[0],r[1],r[6],r[7]),this._xAxisWire.setStartAndEnd(r[0],r[1],r[2],r[3]),this._yAxisWire.setStartAndEnd(r[2],r[3],r[4],r[5]),this._zAxisWire.setStartAndEnd(r[4],r[5],r[6],r[7]),this.labelsVisible){this._lengthLabel.setPosOnWire(r[0],r[1],r[6],r[7]),this._xAxisLabel.setPosOnWire(r[0],r[1],r[2],r[3]),this._yAxisLabel.setPosOnWire(r[2],r[3],r[4],r[5]),this._zAxisLabel.setPosOnWire(r[4],r[5],r[6],r[7]);var y=this._approximate?" ~ ":" = ";this._length=Math.abs(q.lenVec3(q.subVec3(this._targetWorld,this._originWorld,Wa))),this._lengthLabel.setText(y+(this._length*f).toFixed(2)+v);var b=Math.abs(Xa(r[0],r[1],r[2],r[3])),x=Math.abs(Xa(r[2],r[3],r[4],r[5])),P=Math.abs(Xa(r[4],r[5],r[6],r[7])),T=this.plugin.labelMinAxisLength;this._xAxisLabelCulled=b<T,this._yAxisLabelCulled=x<T,this._zAxisLabelCulled=P<T,this._xAxisLabelCulled?this._xAxisLabel.setCulled(!0):(this._xAxisLabel.setText(y+Math.abs((this._targetWorld[0]-this._originWorld[0])*f).toFixed(2)+v),this._xAxisLabel.setCulled(!this.axisVisible)),this._yAxisLabelCulled?this._yAxisLabel.setCulled(!0):(this._yAxisLabel.setText(y+Math.abs((this._targetWorld[1]-this._originWorld[1])*f).toFixed(2)+v),this._yAxisLabel.setCulled(!this.axisVisible)),this._zAxisLabelCulled?this._zAxisLabel.setCulled(!0):(this._zAxisLabel.setText(y+Math.abs((this._targetWorld[2]-this._originWorld[2])*f).toFixed(2)+v),this._zAxisLabel.setCulled(!this.axisVisible))}else this._lengthLabel.setCulled(!0),this._xAxisLabel.setCulled(!0),this._yAxisLabel.setCulled(!0),this._zAxisLabel.setCulled(!0);this._originDot.setVisible(this._visible&&this._originVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._xAxisWire.setVisible(this.axisVisible&&this.xAxisVisible),this._yAxisWire.setVisible(this.axisVisible&&this.yAxisVisible),this._zAxisWire.setVisible(this.axisVisible&&this.zAxisVisible),this._lengthWire.setVisible(this.wireVisible),this._lengthLabel.setCulled(!this.wireVisible),this._cpDirty=!1}}}},{key:"approximate",get:function(){return this._approximate},set:function(e){e=!1!==e,this._approximate!==e&&(this._approximate=e,this._cpDirty=!0,this._needUpdate(0))}},{key:"origin",get:function(){return this._originMarker}},{key:"target",get:function(){return this._targetMarker}},{key:"length",get:function(){this._update();var e=this.plugin.viewer.scene.metrics.scale;return this._length*e}},{key:"color",get:function(){return this._color},set:function(e){this._color=e,this._originDot.setFillColor(e),this._targetDot.setFillColor(e),this._lengthWire.setColor(e),this._lengthLabel.setFillColor(e)}},{key:"visible",get:function(){return this._visible},set:function(e){e=void 0!==e?Boolean(e):this.plugin.defaultVisible,this._visible=e,this._originDot.setVisible(this._visible&&this._originVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._lengthWire.setVisible(this._visible&&this._wireVisible),this._lengthLabel.setVisible(this._visible&&this._wireVisible);var t=this._visible&&this._axisVisible&&this._xAxisVisible,i=this._visible&&this._axisVisible&&this._yAxisVisible,s=this._visible&&this._axisVisible&&this._zAxisVisible;this._xAxisWire.setVisible(t),this._yAxisWire.setVisible(i),this._zAxisWire.setVisible(s),this._xAxisLabel.setVisible(t&&!this._xAxisLabelCulled),this._yAxisLabel.setVisible(i&&!this._yAxisLabelCulled),this._zAxisLabel.setVisible(s&&!this._zAxisLabelCulled),this._cpDirty=!0,this._needUpdate()}},{key:"originVisible",get:function(){return this._originVisible},set:function(e){e=void 0!==e?Boolean(e):this.plugin.defaultOriginVisible,this._originVisible=e,this._originDot.setVisible(this._visible&&this._originVisible)}},{key:"targetVisible",get:function(){return this._targetVisible},set:function(e){e=void 0!==e?Boolean(e):this.plugin.defaultTargetVisible,this._targetVisible=e,this._targetDot.setVisible(this._visible&&this._targetVisible)}},{key:"axisEnabled",get:function(){return this._axisEnabled},set:function(e){e=void 0!==e?Boolean(e):this.plugin.defaultAxisVisible,this._axisEnabled=e;var t=this._visible&&this._axisVisible&&this._axisEnabled;this._xAxisWire.setVisible(t&&this._xAxisVisible),this._yAxisWire.setVisible(t&&this._yAxisVisible),this._zAxisWire.setVisible(t&&this._zAxisVisible),this._xAxisLabel.setVisible(t&&!this._xAxisLabelCulled&&this._xAxisVisible),this._yAxisLabel.setVisible(t&&!this._yAxisLabelCulled&&this._xAxisVisible),this._zAxisLabel.setVisible(t&&!this._zAxisLabelCulled&&this._xAxisVisible),this._cpDirty=!0,this._needUpdate()}},{key:"axisVisible",get:function(){return this._axisVisible},set:function(e){e=void 0!==e?Boolean(e):this.plugin.defaultAxisVisible,this._axisVisible=e;var t=this._visible&&this._axisVisible&&this._axisEnabled;this._xAxisWire.setVisible(t&&this._xAxisVisible),this._yAxisWire.setVisible(t&&this._yAxisVisible),this._zAxisWire.setVisible(t&&this._zAxisVisible),this._xAxisLabel.setVisible(t&&!this._xAxisLabelCulled&&this._xAxisVisible),this._yAxisLabel.setVisible(t&&!this._yAxisLabelCulled&&this._yAxisVisible),this._zAxisLabel.setVisible(t&&!this._zAxisLabelCulled&&this._zAxisVisible),this._cpDirty=!0,this._needUpdate()}},{key:"xAxisVisible",get:function(){return this._xAxisVisible},set:function(e){e=void 0!==e?Boolean(e):this.plugin.defaultAxisVisible,this._xAxisVisible=e;var t=this._visible&&this._axisVisible&&this._xAxisVisible&&this._axisEnabled;this._xAxisWire.setVisible(t),this._xAxisLabel.setVisible(t&&!this._xAxisLabelCulled),this._cpDirty=!0,this._needUpdate()}},{key:"yAxisVisible",get:function(){return this._yAxisVisible},set:function(e){e=void 0!==e?Boolean(e):this.plugin.defaultAxisVisible,this._yAxisVisible=e;var t=this._visible&&this._axisVisible&&this._yAxisVisible&&this._axisEnabled;this._yAxisWire.setVisible(t),this._yAxisLabel.setVisible(t&&!this._yAxisLabelCulled),this._cpDirty=!0,this._needUpdate()}},{key:"zAxisVisible",get:function(){return this._zAxisVisible},set:function(e){e=void 0!==e?Boolean(e):this.plugin.defaultAxisVisible,this._zAxisVisible=e;var t=this._visible&&this._axisVisible&&this._zAxisVisible&&this._axisEnabled;this._zAxisWire.setVisible(t),this._zAxisLabel.setVisible(t&&!this._zAxisLabelCulled),this._cpDirty=!0,this._needUpdate()}},{key:"wireVisible",get:function(){return this._wireVisible},set:function(e){e=void 0!==e?Boolean(e):this.plugin.defaultWireVisible,this._wireVisible=e;var t=this._visible&&this._wireVisible;this._lengthLabel.setVisible(t),this._lengthWire.setVisible(t)}},{key:"labelsVisible",get:function(){return this._labelsVisible},set:function(e){e=void 0!==e?Boolean(e):this.plugin.defaultLabelsVisible,this._labelsVisible=e;var t=this._visible&&this._labelsVisible;this._xAxisLabel.setVisible(t&&!this._xAxisLabelCulled&&this._clickable&&this._axisEnabled),this._yAxisLabel.setVisible(t&&!this._yAxisLabelCulled&&this._clickable&&this._axisEnabled),this._zAxisLabel.setVisible(t&&!this._zAxisLabelCulled&&this._clickable&&this._axisEnabled),this._lengthLabel.setVisible(t),this._cpDirty=!0,this._needUpdate()}},{key:"setHighlighted",value:function(e){this._originDot.setHighlighted(e),this._targetDot.setHighlighted(e),this._xAxisWire.setHighlighted(e),this._yAxisWire.setHighlighted(e),this._zAxisWire.setHighlighted(e),this._xAxisLabel.setHighlighted(e),this._yAxisLabel.setHighlighted(e),this._zAxisLabel.setHighlighted(e),this._lengthWire.setHighlighted(e),this._lengthLabel.setHighlighted(e)}},{key:"clickable",get:function(){return this._clickable},set:function(e){e=!!e,this._clickable=e,this._originDot.setClickable(this._clickable),this._targetDot.setClickable(this._clickable),this._xAxisWire.setClickable(this._clickable),this._yAxisWire.setClickable(this._clickable),this._zAxisWire.setClickable(this._clickable),this._lengthWire.setClickable(this._clickable),this._xAxisLabel.setClickable(this._clickable),this._yAxisLabel.setClickable(this._clickable),this._zAxisLabel.setClickable(this._clickable),this._lengthLabel.setClickable(this._clickable)}},{key:"destroy",value:function(){var e=this.plugin.viewer.scene,t=e.metrics;this._onViewMatrix&&e.camera.off(this._onViewMatrix),this._onProjMatrix&&e.camera.off(this._onProjMatrix),this._onCanvasBoundary&&e.canvas.off(this._onCanvasBoundary),this._onMetricsUnits&&t.off(this._onMetricsUnits),this._onMetricsScale&&t.off(this._onMetricsScale),this._onMetricsOrigin&&t.off(this._onMetricsOrigin),this._originDot.destroy(),this._targetDot.destroy(),this._xAxisWire.destroy(),this._yAxisWire.destroy(),this._zAxisWire.destroy(),this._lengthLabel.destroy(),this._xAxisLabel.destroy(),this._yAxisLabel.destroy(),this._zAxisLabel.destroy(),this._lengthWire.destroy(),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),Ka=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};w(this,e),this._eventSubIDMap=null,this._eventSubEvents=null,this._eventSubs=null,this._events=null,this._locale="en",this._messages={},this._locales=[],this._locale="en",this.messages=t.messages,this.locale=t.locale}return I(e,[{key:"messages",set:function(e){this._messages=e||{},this._locales=Object.keys(this._messages),this.fire("updated",this)}},{key:"loadMessages",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in e)this._messages[t]=e[t];this.messages=this._messages}},{key:"clearMessages",value:function(){this.messages={}}},{key:"locales",get:function(){return this._locales}},{key:"locale",get:function(){return this._locale},set:function(e){e=e||"de",this._locale!==e&&(this._locale=e,this.fire("updated",e))}},{key:"translate",value:function(e,t){var i=this._messages[this._locale];if(!i)return null;var s=Ja(e,i);return s?t?Za(s,t):s:null}},{key:"translatePlurals",value:function(e,t,i){var s=this._messages[this._locale];if(!s)return null;var r=Ja(e,s);return(r=0===(t=parseInt(""+t,10))?r.zero:t>1?r.other:r.one)?(r=Za(r,[t]),i&&(r=Za(r,i)),r):null}},{key:"fire",value:function(e,t,i){this._events||(this._events={}),this._eventSubs||(this._eventSubs={}),!0!==i&&(this._events[e]=t||!0);var s=this._eventSubs[e];if(s)for(var r in s){if(s.hasOwnProperty(r))s[r].callback(t)}}},{key:"on",value:function(e,t){this._events||(this._events={}),this._eventSubIDMap||(this._eventSubIDMap=new G),this._eventSubEvents||(this._eventSubEvents={}),this._eventSubs||(this._eventSubs={});var i=this._eventSubs[e];i||(i={},this._eventSubs[e]=i);var s=this._eventSubIDMap.addItem();i[s]={callback:t},this._eventSubEvents[s]=e;var r=this._events[e];return void 0!==r&&t(r),s}},{key:"off",value:function(e){if(null!=e&&this._eventSubEvents){var t=this._eventSubEvents[e];if(t){delete this._eventSubEvents[e];var i=this._eventSubs[t];i&&delete i[e],this._eventSubIDMap.removeItem(e)}}}}]),e}();function Ja(e,t){if(t[e])return t[e];for(var i=e.split("."),s=t,r=0,n=i.length;s&&r<n;r++){s=s[i[r]]}return s}function Za(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.replace(/\{\{|\}\}|\{(\d+)\}/g,(function(e,i){return"{{"===e?"{":"}}"===e?"}":t[i]}))}var Qa=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r)).t=r.t,s}return I(i,[{key:"t",get:function(){return this._t},set:function(e){e=e||0,this._t=e<0?0:e>1?1:e}},{key:"tangent",get:function(){return this.getTangent(this._t)}},{key:"length",get:function(){var e=this._getLengths();return e[e.length-1]}},{key:"getTangent",value:function(e){var t=1e-4;void 0===e&&(e=this._t);var i=e-t,s=e+t;i<0&&(i=0),s>1&&(s=1);var r=this.getPoint(i),n=this.getPoint(s),o=q.subVec3(n,r,[]);return q.normalizeVec3(o,[])}},{key:"getPointAt",value:function(e){var t=this.getUToTMapping(e);return this.getPoint(t)}},{key:"getPoints",value:function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPoint(t/e));return i}},{key:"_getLengths",value:function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,s=[],r=this.getPoint(0),n=0;for(s.push(0),i=1;i<=e;i++)t=this.getPoint(i/e),n+=q.lenVec3(q.subVec3(t,r,[])),s.push(n),r=t;return this.cacheArcLengths=s,s}},{key:"_updateArcLengths",value:function(){this.needsUpdate=!0,this._getLengths()}},{key:"getUToTMapping",value:function(e,t){var i,s=this._getLengths(),r=0,n=s.length;i=t||e*s[n-1];for(var o,a=0,u=n-1;a<=u;)if((o=s[r=Math.floor(a+(u-a)/2)]-i)<0)a=r+1;else{if(!(o>0)){u=r;break}u=r-1}if(s[r=u]===i)return r/(n-1);var h=s[r];return(r+(i-h)/(s[r+1]-h))/(n-1)}}]),i}(),qa=function(e){g(i,Qa);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r)).points=r.points,s.t=r.t,s}return I(i,[{key:"points",get:function(){return this._points},set:function(e){this._points=e||[]}},{key:"t",get:function(){return this._t},set:function(e){e=e||0,this._t=e<0?0:e>1?1:e}},{key:"point",get:function(){return this.getPoint(this._t)}},{key:"getPoint",value:function(e){var t=this.points;if(!(t.length<3)){var i=(t.length-1)*e,s=Math.floor(i),r=i-s,n=t[0===s?s:s-1],o=t[s],a=t[s>t.length-2?t.length-1:s+1],u=t[s>t.length-3?t.length-1:s+2],h=q.vec3();return h[0]=q.catmullRomInterpolate(n[0],o[0],a[0],u[0],r),h[1]=q.catmullRomInterpolate(n[1],o[1],a[1],u[1],r),h[2]=q.catmullRomInterpolate(n[2],o[2],a[2],u[2],r),h}this.error("Can't sample point from SplineCurve - not enough points on curve - returning [0,0,0].")}},{key:"getJSON",value:function(){return{points:points,t:this._t}}}]),i}(),$a=q.vec3(),eu=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._frames=[],s._eyeCurve=new qa(x(s)),s._lookCurve=new qa(x(s)),s._upCurve=new qa(x(s)),r.frames&&(s.addFrames(r.frames),s.smoothFrameTimes(1)),s}return I(i,[{key:"type",get:function(){return"CameraPath"}},{key:"frames",get:function(){return this._frames}},{key:"eyeCurve",get:function(){return this._eyeCurve}},{key:"lookCurve",get:function(){return this._lookCurve}},{key:"upCurve",get:function(){return this._upCurve}},{key:"saveFrame",value:function(e){var t=this.scene.camera;this.addFrame(e,t.eye,t.look,t.up)}},{key:"addFrame",value:function(e,t,i,s){var r={t:e,eye:t.slice(0),look:i.slice(0),up:s.slice(0)};this._frames.push(r),this._eyeCurve.points.push(r.eye),this._lookCurve.points.push(r.look),this._upCurve.points.push(r.up)}},{key:"addFrames",value:function(e){for(var t,i=0,s=e.length;i<s;i++)t=e[i],this.addFrame(t.t||0,t.eye,t.look,t.up)}},{key:"loadFrame",value:function(e){var t=this.scene.camera;e=(e/=this._frames[this._frames.length-1].t-this._frames[0].t)<0?0:e>1?1:e,t.eye=this._eyeCurve.getPoint(e,$a),t.look=this._lookCurve.getPoint(e,$a),t.up=this._upCurve.getPoint(e,$a)}},{key:"sampleFrame",value:function(e,t,i,s){e=e<0?0:e>1?1:e,this._eyeCurve.getPoint(e,t),this._lookCurve.getPoint(e,i),this._upCurve.getPoint(e,s)}},{key:"smoothFrameTimes",value:function(e){if(0!==this._frames.length){var t=q.vec3(),i=0;this._frames[0].t=0;for(var s=[],r=1,n=this._frames.length;r<n;r++){var o=q.lenVec3(q.subVec3(this._frames[r].eye,this._frames[r-1].eye,t));s[r]=o,i+=o}for(var a=1,u=this._frames.length;a<u;a++){var h=s[a]/i*e;this._frames[a].t=this._frames[a-1].t+h}}}},{key:"clearFrames",value:function(){this._frames=[],this._eyeCurve.points=[],this._lookCurve.points=[],this._upCurve.points=[]}}]),i}(),tu=q.vec3(),iu=q.vec3(),su=q.vec3(),ru=q.vec3(),nu=q.vec3(),ou=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._look1=q.vec3(),s._eye1=q.vec3(),s._up1=q.vec3(),s._look2=q.vec3(),s._eye2=q.vec3(),s._up2=q.vec3(),s._orthoScale1=1,s._orthoScale2=1,s._flying=!1,s._flyEyeLookUp=!1,s._flyingEye=!1,s._flyingLook=!1,s._callback=null,s._callbackScope=null,s._time1=null,s._time2=null,s.easing=!1!==r.easing,s.duration=r.duration,s.fit=r.fit,s.fitFOV=r.fitFOV,s.trail=r.trail,s}return I(i,[{key:"type",get:function(){return"CameraFlightAnimation"}},{key:"flyTo",value:function(e,t,i){e=e||this.scene,this._flying&&this.stop(),this._flying=!1,this._flyingEye=!1,this._flyingLook=!1,this._flyingEyeLookUp=!1,this._callback=t,this._callbackScope=i;var s,r,n,o,a,u=this.scene.camera,h=!!e.projection&&e.projection!==u.projection;if(this._eye1[0]=u.eye[0],this._eye1[1]=u.eye[1],this._eye1[2]=u.eye[2],this._look1[0]=u.look[0],this._look1[1]=u.look[1],this._look1[2]=u.look[2],this._up1[0]=u.up[0],this._up1[1]=u.up[1],this._up1[2]=u.up[2],this._orthoScale1=u.ortho.scale,this._orthoScale2=e.orthoScale||this._orthoScale1,e.aabb)s=e.aabb;else if(6===e.length)s=e;else if(e.eye&&e.look||e.up)r=e.eye,n=e.look,o=e.up;else if(e.eye)r=e.eye;else if(e.look)n=e.look;else{var l=e;if((re.isNumeric(l)||re.isString(l))&&(a=l,!(l=this.scene.components[a])))return this.error("Component not found: "+re.inQuotes(a)),void(t&&(i?t.call(i):t()));h||(s=l.aabb||this.scene.aabb)}var c=e.poi;if(s){if(s[3]<s[0]||s[4]<s[1]||s[5]<s[2])return;if(s[3]===s[0]&&s[4]===s[1]&&s[5]===s[2])return;s=s.slice();var p=q.getAABB3Center(s);this._look2=c||p;var d=q.subVec3(this._eye1,this._look1,tu),f=q.normalizeVec3(d),m=c?q.getAABB3DiagPoint(s,c):q.getAABB3Diag(s),v=e.fitFOV||this._fitFOV,g=Math.abs(m/Math.tan(v*q.DEGTORAD));this._orthoScale2=1.1*m,this._eye2[0]=this._look2[0]+f[0]*g,this._eye2[1]=this._look2[1]+f[1]*g,this._eye2[2]=this._look2[2]+f[2]*g,this._up2[0]=this._up1[0],this._up2[1]=this._up1[1],this._up2[2]=this._up1[2],this._flyingEyeLookUp=!0}else(r||n||o)&&(this._flyingEyeLookUp=!!r&&!!n&&!!o,this._flyingEye=!!r&&!n,this._flyingLook=!!n&&!r,r&&(this._eye2[0]=r[0],this._eye2[1]=r[1],this._eye2[2]=r[2]),n&&(this._look2[0]=n[0],this._look2[1]=n[1],this._look2[2]=n[2]),o&&(this._up2[0]=o[0],this._up2[1]=o[1],this._up2[2]=o[2]));h?("ortho"===e.projection&&"ortho"!==u.projection&&(this._projection2="ortho",this._projMatrix1=u.projMatrix.slice(),this._projMatrix2=u.ortho.matrix.slice(),u.projection="customProjection"),"perspective"===e.projection&&"perspective"!==u.projection&&(this._projection2="perspective",this._projMatrix1=u.projMatrix.slice(),this._projMatrix2=u.perspective.matrix.slice(),u.projection="customProjection")):this._projection2=null,this.fire("started",e,!0),this._time1=Date.now(),this._time2=this._time1+(e.duration?1e3*e.duration:this._duration),this._flying=!0,pe.scheduleTask(this._update,this)}},{key:"jumpTo",value:function(e){this._jumpTo(e)}},{key:"_jumpTo",value:function(e){this._flying&&this.stop();var t,i,s,r,n,o=this.scene.camera;if(e.aabb)t=e.aabb;else if(6===e.length)t=e;else if(e.eye||e.look||e.up)s=e.eye,r=e.look,n=e.up;else{var a=e;if((re.isNumeric(a)||re.isString(a))&&(i=a,!(a=this.scene.components[i])))return void this.error("Component not found: "+re.inQuotes(i));t=a.aabb||this.scene.aabb}var u=e.poi;if(t){if(t[3]<=t[0]||t[4]<=t[1]||t[5]<=t[2])return;var h,l=u?q.getAABB3DiagPoint(t,u):q.getAABB3Diag(t);r=u||q.getAABB3Center(t,r),this._trail?q.subVec3(o.look,r,nu):q.subVec3(o.eye,o.look,nu),q.normalizeVec3(nu),h=(void 0!==e.fit?e.fit:this._fit)?Math.abs(l/Math.tan((e.fitFOV||this._fitFOV)*q.DEGTORAD)):q.lenVec3(q.subVec3(o.eye,o.look,tu)),q.mulVec3Scalar(nu,h),o.eye=q.addVec3(r,nu,tu),o.look=r,this.scene.camera.ortho.scale=1.1*l}else(s||r||n)&&(s&&(o.eye=s),r&&(o.look=r),n&&(o.up=n));e.projection&&(o.projection=e.projection)}},{key:"_update",value:function(){if(this._flying){var e=(Date.now()-this._time1)/(this._time2-this._time1),t=e>=1;e>1&&(e=1);var s=this.easing?i._ease(e,0,1,1):e,r=this.scene.camera;if(this._flyingEye||this._flyingLook?this._flyingEye?(q.subVec3(r.eye,r.look,nu),r.eye=q.lerpVec3(s,0,1,this._eye1,this._eye2,su),r.look=q.subVec3(su,nu,iu)):this._flyingLook&&(r.look=q.lerpVec3(s,0,1,this._look1,this._look2,iu),r.up=q.lerpVec3(s,0,1,this._up1,this._up2,ru)):this._flyingEyeLookUp&&(r.eye=q.lerpVec3(s,0,1,this._eye1,this._eye2,su),r.look=q.lerpVec3(s,0,1,this._look1,this._look2,iu),r.up=q.lerpVec3(s,0,1,this._up1,this._up2,ru)),this._projection2){var n="ortho"===this._projection2?i._easeOutExpo(e,0,1,1):i._easeInCubic(e,0,1,1);r.customProjection.matrix=q.lerpMat4(n,0,1,this._projMatrix1,this._projMatrix2)}else r.ortho.scale=this._orthoScale1+e*(this._orthoScale2-this._orthoScale1);if(t)return r.ortho.scale=this._orthoScale2,void this.stop();pe.scheduleTask(this._update,this)}}},{key:"stop",value:function(){if(this._flying){this._flying=!1,this._time1=null,this._time2=null,this._projection2&&(this.scene.camera.projection=this._projection2);var e=this._callback;e&&(this._callback=null,this._callbackScope?e.call(this._callbackScope):e()),this.fire("stopped",!0,!0)}}},{key:"cancel",value:function(){this._flying&&(this._flying=!1,this._time1=null,this._time2=null,this._callback&&(this._callback=null),this.fire("canceled",!0,!0))}},{key:"duration",get:function(){return this._duration/1e3},set:function(e){this._duration=e?1e3*e:500,this.stop()}},{key:"fit",get:function(){return this._fit},set:function(e){this._fit=!1!==e}},{key:"fitFOV",get:function(){return this._fitFOV},set:function(e){this._fitFOV=e||45}},{key:"trail",get:function(){return this._trail},set:function(e){this._trail=!!e}},{key:"destroy",value:function(){this.stop(),m(P(i.prototype),"destroy",this).call(this)}}],[{key:"_ease",value:function(e,t,i,s){return-i*(e/=s)*(e-2)+t}},{key:"_easeInCubic",value:function(e,t,i,s){return i*(e/=s)*e*e+t}},{key:"_easeOutExpo",value:function(e,t,i,s){return i*(1-Math.pow(2,-10*e/s))+t}}]),i}(),au=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._cameraFlightAnimation=new ou(x(s)),s._t=0,s.state=i.SCRUBBING,s._playingFromT=0,s._playingToT=0,s._playingRate=r.playingRate||1,s._playingDir=1,s._lastTime=null,s.cameraPath=r.cameraPath,s._tick=s.scene.on("tick",s._updateT,x(s)),s}return I(i,[{key:"type",get:function(){return"CameraPathAnimation"}},{key:"_updateT",value:function(){var e=this._cameraPath;if(e){var t,s,r=performance.now(),n=this._lastTime?.001*(r-this._lastTime):0;if(this._lastTime=r,0!==n)switch(this.state){case i.SCRUBBING:return;case i.PLAYING:if(this._t+=this._playingRate*n,0===(t=this._cameraPath.frames.length)||this._playingDir<0&&this._t<=0||this._playingDir>0&&this._t>=this._cameraPath.frames[t-1].t)return this.state=i.SCRUBBING,this._t=this._cameraPath.frames[t-1].t,void this.fire("stopped");e.loadFrame(this._t);break;case i.PLAYING_TO:s=this._t+this._playingRate*n*this._playingDir,(this._playingDir<0&&s<=this._playingToT||this._playingDir>0&&s>=this._playingToT)&&(s=this._playingToT,this.state=i.SCRUBBING,this.fire("stopped")),this._t=s,e.loadFrame(this._t)}}}},{key:"_ease",value:function(e,t,i,s){return-i*(e/=s)*(e-2)+t}},{key:"cameraPath",get:function(){return this._cameraPath},set:function(e){this._cameraPath=e}},{key:"rate",get:function(){return this._playingRate},set:function(e){this._playingRate=e}},{key:"play",value:function(){this._cameraPath&&(this._lastTime=null,this.state=i.PLAYING)}},{key:"playToT",value:function(e){this._cameraPath&&(this._playingFromT=this._t,this._playingToT=e,this._playingDir=this._playingToT-this._playingFromT<0?-1:1,this._lastTime=null,this.state=i.PLAYING_TO)}},{key:"playToFrame",value:function(e){var t=this._cameraPath;if(t){var i=t.frames[e];i?this.playToT(i.t):this.error("playToFrame - frame index out of range: "+e)}}},{key:"flyToFrame",value:function(e,t){var s=this._cameraPath;if(s){var r=s.frames[e];r?(this.state=i.SCRUBBING,this._cameraFlightAnimation.flyTo(r,t)):this.error("flyToFrame - frame index out of range: "+e)}}},{key:"scrubToT",value:function(e){var t=this._cameraPath;t&&(this.scene.camera&&(this._t=e,t.loadFrame(this._t),this.state=i.SCRUBBING))}},{key:"scrubToFrame",value:function(e){var t=this._cameraPath;t&&(this.scene.camera&&(t.frames[e]?(t.loadFrame(this._t),this.state=i.SCRUBBING):this.error("playToFrame - frame index out of range: "+e)))}},{key:"stop",value:function(){this.state=i.SCRUBBING,this.fire("stopped")}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this.scene.off(this._tick)}}]),i}();au.STOPPED=0,au.SCRUBBING=1,au.PLAYING=2,au.PLAYING_TO=3;var uu=q.vec3(),hu=q.vec3();q.vec3();var lu=q.vec3([0,-1,0]),cu=q.vec4([0,0,0,1]),pu=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._src=null,s._image=null,s._pos=q.vec3(),s._origin=q.vec3(),s._rtcPos=q.vec3(),s._dir=q.vec3(),s._size=1,s._imageSize=q.vec2(),s._texture=new xa(x(s)),s._plane=new Uo(x(s),{geometry:new _r(x(s),Ea({center:[0,0,0],xSize:1,zSize:1,xSegments:10,zSegments:10})),material:new Tr(x(s),{diffuse:[0,0,0],ambient:[0,0,0],specular:[0,0,0],diffuseMap:s._texture,emissiveMap:s._texture,backfaces:!0}),clippable:r.clippable}),s._grid=new Uo(x(s),{geometry:new _r(x(s),ka({size:1,divisions:10})),material:new Tr(x(s),{diffuse:[0,0,0],ambient:[0,0,0],emissive:[.2,.8,.2]}),position:[0,.001,0],clippable:r.clippable}),s._node=new na(x(s),{rotation:[0,0,0],position:[0,0,0],scale:[1,1,1],clippable:!1,children:[s._plane,s._grid]}),s._gridVisible=!1,s.visible=!0,s.gridVisible=r.gridVisible,s.position=r.position,s.rotation=r.rotation,s.dir=r.dir,s.size=r.size,s.collidable=r.collidable,s.clippable=r.clippable,s.pickable=r.pickable,s.opacity=r.opacity,r.image?s.image=r.image:s.src=r.src,s}return I(i,[{key:"visible",get:function(){return this._plane.visible},set:function(e){this._plane.visible=e,this._grid.visible=this._gridVisible&&e}},{key:"gridVisible",get:function(){return this._gridVisible},set:function(e){e=!1!==e,this._gridVisible=e,this._grid.visible=this._gridVisible&&this.visible}},{key:"image",get:function(){return this._image},set:function(e){this._image=e,this._image&&(this._imageSize[0]=e.width,this._imageSize[1]=e.height,this._updatePlaneSizeFromImage(),this._src=null,this._texture.image=this._image)}},{key:"src",get:function(){return this._src},set:function(e){var t=this;if(this._src=e,this._src){this._image=null;var i=new Image;i.onload=function(){t._texture.image=i,t._imageSize[0]=i.width,t._imageSize[1]=i.height,t._updatePlaneSizeFromImage()},i.src=this._src}}},{key:"position",get:function(){return this._pos},set:function(e){this._pos.set(e||[0,0,0]),Ae(this._pos,this._origin,this._rtcPos),this._node.origin=this._origin,this._node.position=this._rtcPos}},{key:"rotation",get:function(){return this._node.rotation},set:function(e){this._node.rotation=e}},{key:"size",get:function(){return this._size},set:function(e){this._size=null==e?1:e,this._image&&this._updatePlaneSizeFromImage()}},{key:"dir",get:function(){return this._dir},set:function(e){if(this._dir.set(e||[0,0,-1]),e){var t=this.scene.center,i=[-this._dir[0],-this._dir[1],-this._dir[2]];q.subVec3(t,this.position,uu);var s=-q.dotVec3(i,uu);q.normalizeVec3(i),q.mulVec3Scalar(i,s,hu),q.vec3PairToQuaternion(lu,e,cu),this._node.quaternion=cu}}},{key:"collidable",get:function(){return this._node.collidable},set:function(e){this._node.collidable=!1!==e}},{key:"clippable",get:function(){return this._node.clippable},set:function(e){this._node.clippable=!1!==e}},{key:"pickable",get:function(){return this._node.pickable},set:function(e){this._node.pickable=!1!==e}},{key:"opacity",get:function(){return this._node.opacity},set:function(e){this._node.opacity=e}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this)}},{key:"_updatePlaneSizeFromImage",value:function(){var e=this._size,t=this._imageSize[0],i=this._imageSize[1];if(t>i){var s=i/t;this._node.scale=[e,1,e*s]}else{var r=t/i;this._node.scale=[e*r,1,e]}}}]),i}(),du=function(e){g(i,pr);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,i);var n=x(s=t.call(this,e,r));s._shadowRenderBuf=null,s._shadowViewMatrix=null,s._shadowProjMatrix=null,s._shadowViewMatrixDirty=!0,s._shadowProjMatrixDirty=!0;var o=s.scene.camera,a=s.scene.canvas;return s._onCameraViewMatrix=o.on("viewMatrix",(function(){s._shadowViewMatrixDirty=!0})),s._onCameraProjMatrix=o.on("projMatrix",(function(){s._shadowProjMatrixDirty=!0})),s._onCanvasBoundary=a.on("boundary",(function(){s._shadowProjMatrixDirty=!0})),s._state=new ti({type:"point",pos:q.vec3([1,1,1]),color:q.vec3([.7,.7,.8]),intensity:1,attenuation:[0,0,0],space:r.space||"view",castsShadow:!1,getShadowViewMatrix:function(){if(n._shadowViewMatrixDirty){n._shadowViewMatrix||(n._shadowViewMatrix=q.identityMat4());var e=n._state.pos,t=o.look,i=o.up;q.lookAtMat4v(e,t,i,n._shadowViewMatrix),n._shadowViewMatrixDirty=!1}return n._shadowViewMatrix},getShadowProjMatrix:function(){if(n._shadowProjMatrixDirty){n._shadowProjMatrix||(n._shadowProjMatrix=q.identityMat4());var e=n.scene.canvas.canvas;q.perspectiveMat4(Math.PI/180*70,e.clientWidth/e.clientHeight,.1,500,n._shadowProjMatrix),n._shadowProjMatrixDirty=!1}return n._shadowProjMatrix},getShadowRenderBuf:function(){return n._shadowRenderBuf||(n._shadowRenderBuf=new Mt(n.scene.canvas.canvas,n.scene.canvas.gl,{size:[1024,1024]})),n._shadowRenderBuf}}),s.pos=r.pos,s.color=r.color,s.intensity=r.intensity,s.constantAttenuation=r.constantAttenuation,s.linearAttenuation=r.linearAttenuation,s.quadraticAttenuation=r.quadraticAttenuation,s.castsShadow=r.castsShadow,s.scene._lightCreated(x(s)),s}return I(i,[{key:"type",get:function(){return"PointLight"}},{key:"pos",get:function(){return this._state.pos},set:function(e){this._state.pos.set(e||[1,1,1]),this._shadowViewMatrixDirty=!0,this.glRedraw()}},{key:"color",get:function(){return this._state.color},set:function(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}},{key:"intensity",get:function(){return this._state.intensity},set:function(e){e=void 0!==e?e:1,this._state.intensity=e,this.glRedraw()}},{key:"constantAttenuation",get:function(){return this._state.attenuation[0]},set:function(e){this._state.attenuation[0]=e||0,this.glRedraw()}},{key:"linearAttenuation",get:function(){return this._state.attenuation[1]},set:function(e){this._state.attenuation[1]=e||0,this.glRedraw()}},{key:"quadraticAttenuation",get:function(){return this._state.attenuation[2]},set:function(e){this._state.attenuation[2]=e||0,this.glRedraw()}},{key:"castsShadow",get:function(){return this._state.castsShadow},set:function(e){e=!!e,this._state.castsShadow!==e&&(this._state.castsShadow=e,this._shadowViewMatrixDirty=!0,this.glRedraw())}},{key:"destroy",value:function(){var e=this.scene.camera,t=this.scene.canvas;e.off(this._onCameraViewMatrix),e.off(this._onCameraProjMatrix),t.off(this._onCanvasBoundary),m(P(i.prototype),"destroy",this).call(this),this._state.destroy(),this._shadowRenderBuf&&this._shadowRenderBuf.destroy(),this.scene._lightDestroyed(this),this.glRedraw()}}]),i}();function fu(e){return 0==(e&e-1)}function mu(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1}var vu=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,i);var n=(s=t.call(this,e,r)).scene.canvas.gl;return s._state=new ti({texture:new ma({gl:n,target:n.TEXTURE_CUBE_MAP}),flipY:s._checkFlipY(r.minFilter),encoding:s._checkEncoding(r.encoding),minFilter:1008,magFilter:1006,wrapS:1001,wrapT:1001,mipmaps:!0}),s._src=r.src,s._images=[],s._loadSrc(r.src),ee.memory.textures++,s}return I(i,[{key:"type",get:function(){return"CubeTexture"}},{key:"_checkFlipY",value:function(e){return!!e}},{key:"_checkEncoding",value:function(e){return 3e3!==(e=e||3e3)&&3001!==e&&(this.error("Unsupported value for 'encoding' - supported values are LinearEncoding and sRGBEncoding. Defaulting to LinearEncoding."),e=3e3),e}},{key:"_webglContextRestored",value:function(){this.scene.canvas.gl,this._state.texture=null,this._src&&this._loadSrc(this._src)}},{key:"_loadSrc",value:function(e){var t=this,i=this.scene.canvas.gl;this._images=[];for(var s=!1,r=0,n=function(n){var o=new Image;o.onload=function(){var e=o,a=n;return function(){if(!s&&(e=function(e){if(!fu(e.width)||!fu(e.height)){var t=document.createElement("canvas");t.width=mu(e.width),t.height=mu(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}return e}(e),t._images[a]=e,6===++r)){var n=t._state.texture;n||(n=new ma({gl:i,target:i.TEXTURE_CUBE_MAP}),t._state.texture=n),n.setImage(t._images,t._state),t.fire("loaded",t._src,!1),t.glRedraw()}}}(),o.onerror=function(){s=!0},o.src=e[n]},o=0;o<e.length;o++)n(o)}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._state.texture&&this._state.texture.destroy(),ee.memory.textures--,this._state.destroy()}}]),i}(),gu=function(e){g(i,vu);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r)).scene._lightsState.addReflectionMap(s._state),s.scene._reflectionMapCreated(x(s)),s}return I(i,[{key:"type",get:function(){return"ReflectionMap"}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this.scene._reflectionMapDestroyed(this)}}]),i}(),_u=function(e){g(i,vu);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r)).scene._lightMapCreated(x(s)),s}return I(i,[{key:"type",get:function(){return"LightMap"}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this.scene._lightMapDestroyed(this)}}]),i}(),yu=function(e){g(i,Se);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,{entity:r.entity,occludable:r.occludable,worldPos:r.worldPos}))._occluded=!1,s._visible=!0,s._src=null,s._image=null,s._pos=q.vec3(),s._origin=q.vec3(),s._rtcPos=q.vec3(),s._dir=q.vec3(),s._size=1,s._imageSize=q.vec2(),s._texture=new xa(x(s),{src:r.src}),s._geometry=new _r(x(s),{primitive:"triangles",positions:[3,3,0,-3,3,0,-3,-3,0,3,-3,0],normals:[-1,0,0,-1,0,0,-1,0,0,-1,0,0],uv:[1,-1,0,-1,0,0,1,0],indices:[0,1,2,0,2,3]}),s._mesh=new Uo(x(s),{geometry:s._geometry,material:new Tr(x(s),{ambient:[.9,.3,.9],shininess:30,diffuseMap:s._texture,backfaces:!0}),scale:[1,1,1],position:r.worldPos,rotation:[90,0,0],billboard:"spherical",occluder:!1}),s.visible=!0,s.collidable=r.collidable,s.clippable=r.clippable,s.pickable=r.pickable,s.opacity=r.opacity,s.size=r.size,r.image?s.image=r.image:s.src=r.src,s}return I(i,[{key:"_setVisible",value:function(e){this._occluded=!e,this._mesh.visible=this._visible&&!this._occluded,m(P(i.prototype),"_setVisible",this).call(this,e)}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible=null==e||e,this._mesh.visible=this._visible&&!this._occluded}},{key:"image",get:function(){return this._image},set:function(e){this._image=e,this._image&&(this._imageSize[0]=this._image.width,this._imageSize[1]=this._image.height,this._updatePlaneSizeFromImage(),this._src=null,this._texture.image=this._image)}},{key:"src",get:function(){return this._src},set:function(e){var t=this;if(this._src=e,this._src){this._image=null;var i=new Image;i.onload=function(){t._texture.image=i,t._imageSize[0]=i.width,t._imageSize[1]=i.height,t._updatePlaneSizeFromImage()},i.src=this._src}}},{key:"size",get:function(){return this._size},set:function(e){this._size=null==e?1:e,this._image&&this._updatePlaneSizeFromImage()}},{key:"collidable",get:function(){return this._mesh.collidable},set:function(e){this._mesh.collidable=!1!==e}},{key:"clippable",get:function(){return this._mesh.clippable},set:function(e){this._mesh.clippable=!1!==e}},{key:"pickable",get:function(){return this._mesh.pickable},set:function(e){this._mesh.pickable=!1!==e}},{key:"opacity",get:function(){return this._mesh.opacity},set:function(e){this._mesh.opacity=e}},{key:"_updatePlaneSizeFromImage",value:function(){var e=.5*this._size,t=this._imageSize[0],i=this._imageSize[1],s=i/t;this._geometry.positions=t>i?[e,e*s,0,-e,e*s,0,-e,-e*s,0,e,-e*s,0]:[e/s,e,0,-e/s,e,0,-e/s,-e,0,e/s,-e,0]}}]),i}(),bu=q.vec3(),xu=q.vec3(),Pu=q.mat4(),Tu=function(){function e(){w(this,e),this.normal=q.vec3(),this.offset=0,this.testVertex=q.vec3()}return I(e,[{key:"set",value:function(e,t,i,s){var r=1/Math.sqrt(e*e+t*t+i*i);this.normal[0]=e*r,this.normal[1]=t*r,this.normal[2]=i*r,this.offset=s*r,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0}}]),e}(),wu=I((function e(){w(this,e),this.planes=[new Tu,new Tu,new Tu,new Tu,new Tu,new Tu]}));function Mu(e,t,i){var s=q.mulMat4(i,t,Pu),r=s[0],n=s[1],o=s[2],a=s[3],u=s[4],h=s[5],l=s[6],c=s[7],p=s[8],d=s[9],f=s[10],m=s[11],v=s[12],g=s[13],_=s[14],y=s[15];e.planes[0].set(a-r,c-u,m-p,y-v),e.planes[1].set(a+r,c+u,m+p,y+v),e.planes[2].set(a-n,c-h,m-d,y-g),e.planes[3].set(a+n,c+h,m+d,y+g),e.planes[4].set(a-o,c-l,m-f,y-_),e.planes[5].set(a+o,c+l,m+f,y+_)}function Iu(e,t){var i=wu.INSIDE,s=bu,r=xu;s[0]=t[0],s[1]=t[1],s[2]=t[2],r[0]=t[3],r[1]=t[4],r[2]=t[5];for(var n=[s,r],o=0;o<6;++o){var a=e.planes[o];if(a.normal[0]*n[a.testVertex[0]][0]+a.normal[1]*n[a.testVertex[1]][1]+a.normal[2]*n[a.testVertex[2]][2]+a.offset<0)return wu.OUTSIDE;a.normal[0]*n[1-a.testVertex[0]][0]+a.normal[1]*n[1-a.testVertex[1]][1]+a.normal[2]*n[1-a.testVertex[2]][2]+a.offset<0&&(i=wu.INTERSECT)}return i}wu.INSIDE=0,wu.INTERSECT=1,wu.OUTSIDE=2;var Cu=function(){function e(t){w(this,e),this._eye=q.vec3(),this._look=q.vec3(),this._up=q.vec3(),this._projection={},t&&this.saveCamera(t)}return I(e,[{key:"saveCamera",value:function(e){var t=e.camera,i=t.project;switch(this._eye.set(t.eye),this._look.set(t.look),this._up.set(t.up),t.projection){case"perspective":this._projection={projection:"perspective",fov:i.fov,fovAxis:i.fovAxis,near:i.near,far:i.far};break;case"ortho":this._projection={projection:"ortho",scale:i.scale,near:i.near,far:i.far};break;case"frustum":this._projection={projection:"frustum",left:i.left,right:i.right,top:i.top,bottom:i.bottom,near:i.near,far:i.far};break;case"custom":this._projection={projection:"custom",matrix:i.matrix.slice()}}}},{key:"restoreCamera",value:function(e,t){var i=e.camera,s=this._projection;function r(){switch(s.type){case"perspective":i.perspective.fov=s.fov,i.perspective.fovAxis=s.fovAxis,i.perspective.near=s.near,i.perspective.far=s.far;break;case"ortho":i.ortho.scale=s.scale,i.ortho.near=s.near,i.ortho.far=s.far;break;case"frustum":i.frustum.left=s.left,i.frustum.right=s.right,i.frustum.top=s.top,i.frustum.bottom=s.bottom,i.frustum.near=s.near,i.frustum.far=s.far;break;case"custom":i.customProjection.matrix=s.matrix}}t?e.viewer.cameraFlight.flyTo({eye:this._eye,look:this._look,up:this._up,orthoScale:s.scale,projection:s.projection},(function(){r(),t()})):(i.eye=this._eye,i.look=this._look,i.up=this._up,r(),i.projection=s.projection)}}]),e}(),Du=q.vec3(),Au=function(){function e(t){if(w(this,e),this.objectsVisible=[],this.objectsEdges=[],this.objectsXrayed=[],this.objectsHighlighted=[],this.objectsSelected=[],this.objectsClippable=[],this.objectsPickable=[],this.objectsColorize=[],this.objectsOpacity=[],this.numObjects=0,t){var i=t.metaScene.scene;this.saveObjects(i,t)}}return I(e,[{key:"saveObjects",value:function(e,t,i){var s=t.rootMetaObject;if(s){var r=s.getObjectIDsInSubtree();this.numObjects=0,this._mask=i?re.apply(i,{}):null;for(var n=e.objects,o=!i||i.visible,a=!i||i.edges,u=!i||i.xrayed,h=!i||i.highlighted,l=!i||i.selected,c=!i||i.clippable,p=!i||i.pickable,d=!i||i.colorize,f=!i||i.opacity,m=0,v=r.length;m<v;m++){var g=n[r[m]];if(g){if(o&&(this.objectsVisible[m]=g.visible),a&&(this.objectsEdges[m]=g.edges),u&&(this.objectsXrayed[m]=g.xrayed),h&&(this.objectsHighlighted[m]=g.highlighted),l&&(this.objectsSelected[m]=g.selected),c&&(this.objectsClippable[m]=g.clippable),p&&(this.objectsPickable[m]=g.pickable),d){var _=g.colorize;this.objectsColorize[3*m+0]=_[0],this.objectsColorize[3*m+1]=_[1],this.objectsColorize[3*m+2]=_[2]}f&&(this.objectsOpacity[m]=g.opacity),this.numObjects++}}}}},{key:"restoreObjects",value:function(e,t){var i=t.rootMetaObject;if(i)for(var s=i.getObjectIDsInSubtree(),r=this._mask,n=!r||r.visible,o=!r||r.edges,a=!r||r.xrayed,u=!r||r.highlighted,h=!r||r.selected,l=!r||r.clippable,c=!r||r.pickable,p=!r||r.colorize,d=!r||r.opacity,f=e.objects,m=0,v=s.length;m<v;m++){var g=f[s[m]];g&&(n&&(g.visible=this.objectsVisible[m]),o&&(g.edges=this.objectsEdges[m]),a&&(g.xrayed=this.objectsXrayed[m]),u&&(g.highlighted=this.objectsHighlighted[m]),h&&(g.selected=this.objectsSelected[m]),l&&(g.clippable=this.objectsClippable[m]),c&&(g.pickable=this.objectsPickable[m]),p&&(Du[0]=this.objectsColorize[3*m+0],Du[1]=this.objectsColorize[3*m+1],Du[2]=this.objectsColorize[3*m+2],g.colorize=Du),d&&(g.opacity=this.objectsOpacity[m]))}}}]),e}(),ku=q.vec3(),Eu=function(){function e(){w(this,e),this.objectsVisible=[],this.objectsEdges=[],this.objectsXrayed=[],this.objectsHighlighted=[],this.objectsSelected=[],this.objectsClippable=[],this.objectsPickable=[],this.objectsColorize=[],this.objectsHasColorize=[],this.objectsOpacity=[],this.numObjects=0}return I(e,[{key:"saveObjects",value:function(e,t){this.numObjects=0,this._mask=t?re.apply(t,{}):null;var i=e.objects,s=!t||t.visible,r=!t||t.edges,n=!t||t.xrayed,o=!t||t.highlighted,a=!t||t.selected,u=!t||t.clippable,h=!t||t.pickable,l=!t||t.colorize,c=!t||t.opacity;for(var p in i)if(i.hasOwnProperty(p)){var d=i[p],f=this.numObjects;if(s&&(this.objectsVisible[f]=d.visible),r&&(this.objectsEdges[f]=d.edges),n&&(this.objectsXrayed[f]=d.xrayed),o&&(this.objectsHighlighted[f]=d.highlighted),a&&(this.objectsSelected[f]=d.selected),u&&(this.objectsClippable[f]=d.clippable),h&&(this.objectsPickable[f]=d.pickable),l){var m=d.colorize;m?(this.objectsColorize[3*f+0]=m[0],this.objectsColorize[3*f+1]=m[1],this.objectsColorize[3*f+2]=m[2],this.objectsHasColorize[f]=!0):this.objectsHasColorize[f]=!1}c&&(this.objectsOpacity[f]=d.opacity),this.numObjects++}}},{key:"restoreObjects",value:function(e){var t=this._mask,i=!t||t.visible,s=!t||t.edges,r=!t||t.xrayed,n=!t||t.highlighted,o=!t||t.selected,a=!t||t.clippable,u=!t||t.pickable,h=!t||t.colorize,l=!t||t.opacity,c=0,p=e.objects;for(var d in p)if(p.hasOwnProperty(d)){var f=p[d];i&&(f.visible=this.objectsVisible[c]),s&&(f.edges=this.objectsEdges[c]),r&&(f.xrayed=this.objectsXrayed[c]),n&&(f.highlighted=this.objectsHighlighted[c]),o&&(f.selected=this.objectsSelected[c]),a&&(f.clippable=this.objectsClippable[c]),u&&(f.pickable=this.objectsPickable[c]),h&&(this.objectsHasColorize[c]?(ku[0]=this.objectsColorize[3*c+0],ku[1]=this.objectsColorize[3*c+1],ku[2]=this.objectsColorize[3*c+2],f.colorize=ku):f.colorize=null),l&&(f.opacity=this.objectsOpacity[c]),c++}}}]),e}(),Fu=function(e){g(i,Qa);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r)).v0=r.v0,s.v1=r.v1,s.v2=r.v2,s.v3=r.v3,s.t=r.t,s}return I(i,[{key:"v0",get:function(){return this._v0},set:function(e){this._v0=e||q.vec3([0,0,0])}},{key:"v1",get:function(){return this._v1},set:function(e){this._v1=e||q.vec3([0,0,0])}},{key:"v2",get:function(){return this._v2},set:function(e){this._v2=e||q.vec3([0,0,0])}},{key:"v3",get:function(){return this._v3},set:function(e){this.fire("v3",this._v3=e||q.vec3([0,0,0]))}},{key:"t",get:function(){return this._t},set:function(e){e=e||0,this._t=e<0?0:e>1?1:e}},{key:"point",get:function(){return this.getPoint(this._t)}},{key:"getPoint",value:function(e){var t=q.vec3();return t[0]=q.b3(e,this._v0[0],this._v1[0],this._v2[0],this._v3[0]),t[1]=q.b3(e,this._v0[1],this._v1[1],this._v2[1],this._v3[1]),t[2]=q.b3(e,this._v0[2],this._v1[2],this._v2[2],this._v3[2]),t}},{key:"getJSON",value:function(){return{v0:this._v0,v1:this._v1,v2:this._v2,v3:this._v3,t:this._t}}}]),i}(),Ru=function(e){g(i,Qa);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._cachedLengths=[],s._dirty=!0,s._curves=[],s._t=0,s._dirtySubs=[],s._destroyedSubs=[],s.curves=r.curves||[],s.t=r.t,s}return I(i,[{key:"addCurve",value:function(e){this._curves.push(e),this._dirty=!0}},{key:"curves",get:function(){return this._curves},set:function(e){var t,i,s;for(e=e||[],i=0,s=this._curves.length;i<s;i++)(t=this._curves[i]).off(this._dirtySubs[i]),t.off(this._destroyedSubs[i]);this._curves=[],this._dirtySubs=[],this._destroyedSubs=[];var r=this;function n(){r._dirty=!0}function o(){var e=this.id;for(i=0,s=r._curves.length;i<s;i++)if(r._curves[i].id===e)return r._curves=r._curves.slice(i,i+1),r._dirtySubs=r._dirtySubs.slice(i,i+1),r._destroyedSubs=r._destroyedSubs.slice(i,i+1),void(r._dirty=!0)}for(i=0,s=e.length;i<s;i++){if(t=e[i],re.isNumeric(t)||re.isString(t)){var a=t;if(!(t=this.scene.components[a])){this.error("Component not found: "+_inQuotes(a));continue}}var u=t.type;"xeokit.SplineCurve"===u||"xeokit.Path"===u||"xeokit.CubicBezierCurve"===u||"xeokit.QuadraticBezierCurve"===u?(this._curves.push(t),this._dirtySubs.push(t.on("dirty",n)),this._destroyedSubs.push(t.once("destroyed",o))):this.error("Component "+_inQuotes(t.id)+" is not a xeokit.SplineCurve, xeokit.Path or xeokit.QuadraticBezierCurve")}this._dirty=!0}},{key:"t",get:function(){return this._t},set:function(e){e=e||0,this._t=e<0?0:e>1?1:e}},{key:"point",get:function(){return this.getPoint(this._t)}},{key:"length",get:function(){var e=this._getCurveLengths();return e[e.length-1]}},{key:"getPoint",value:function(e){for(var t,i=e*this.length,s=this._getCurveLengths(),r=0;r<s.length;){if(s[r]>=i){var n=1-(s[r]-i)/(t=this._curves[r]).length;return t.getPointAt(n)}r++}return null}},{key:"_getCurveLengths",value:function(){if(!this._dirty)return this._cachedLengths;var e,t=[],i=0,s=this._curves.length;for(e=0;e<s;e++)i+=this._curves[e].length,t.push(i);return this._cachedLengths=t,this._dirty=!1,t}},{key:"_getJSON",value:function(){for(var e=[],t=0,i=this._curves.length;t<i;t++)e.push(this._curves[t].id);return{curves:e,t:this._t}}},{key:"destroy",value:function(){var e,t,s;for(m(P(i.prototype),"destroy",this).call(this),e=0,t=this._curves.length;e<t;e++)(s=this._curves[e]).off(this._dirtySubs[e]),s.off(this._destroyedSubs[e])}}]),i}(),Su=function(e){g(i,Qa);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r)).v0=r.v0,s.v1=r.v1,s.v2=r.v2,s.t=r.t,s}return I(i,[{key:"v0",get:function(){return this._v0},set:function(e){this._v0=e||q.vec3([0,0,0])}},{key:"v1",get:function(){return this._v1},set:function(e){this._v1=e||q.vec3([0,0,0])}},{key:"v2",get:function(){return this._v2},set:function(e){this._v2=e||q.vec3([0,0,0])}},{key:"t",get:function(){return this._t},set:function(e){e=e||0,this._t=e<0?0:e>1?1:e}},{key:"point",get:function(){return this.getPoint(this._t)}},{key:"getPoint",value:function(e){var t=q.vec3();return t[0]=q.b2(e,this._v0[0],this._v1[0],this._v2[0]),t[1]=q.b2(e,this._v0[1],this._v1[1],this._v2[1]),t[2]=q.b2(e,this._v0[2],this._v1[2],this._v2[2]),t}},{key:"getJSON",value:function(){return{v0:this._v0,v1:this._v1,v2:this._v2,t:this._t}}}]),i}(),Ou=function(){function e(){w(this,e)}return I(e,[{key:"objects",get:function(){}},{key:"origin",get:function(){}},{key:"position",get:function(){}},{key:"rotation",get:function(){}},{key:"quaternion",get:function(){}},{key:"scale",get:function(){}},{key:"matrix",get:function(){}},{key:"worldMatrix",get:function(){}},{key:"worldNormalMatrix",get:function(){}},{key:"viewMatrix",get:function(){}},{key:"viewNormalMatrix",get:function(){}},{key:"backfaces",get:function(){},set:function(e){}},{key:"entityList",get:function(){}},{key:"isEntity",get:function(){}},{key:"isModel",get:function(){}},{key:"isObject",get:function(){}},{key:"aabb",get:function(){}},{key:"numTriangles",get:function(){}},{key:"numLines",get:function(){}},{key:"numPoints",get:function(){}},{key:"visible",get:function(){},set:function(e){}},{key:"xrayed",get:function(){},set:function(e){}},{key:"highlighted",get:function(){},set:function(e){}},{key:"selected",get:function(){},set:function(e){}},{key:"edges",get:function(){},set:function(e){}},{key:"culled",get:function(){},set:function(e){}},{key:"clippable",get:function(){},set:function(e){}},{key:"collidable",get:function(){},set:function(e){}},{key:"pickable",get:function(){},set:function(e){}},{key:"colorize",get:function(){},set:function(e){}},{key:"opacity",get:function(){},set:function(e){}},{key:"castsShadow",get:function(){},set:function(e){}},{key:"receivesShadow",get:function(){},set:function(e){}},{key:"saoEnabled",get:function(){}},{key:"pbrEnabled",get:function(){}},{key:"colorTextureEnabled",get:function(){}},{key:"isDrawable",get:function(){}},{key:"isStateSortable",get:function(){}},{key:"xrayMaterial",get:function(){}},{key:"highlightMaterial",get:function(){}},{key:"selectedMaterial",get:function(){}},{key:"edgeMaterial",get:function(){}},{key:"getPickViewMatrix",value:function(e){}},{key:"createGeometry",value:function(e){}},{key:"createTexture",value:function(e){}},{key:"createTextureSet",value:function(e){}},{key:"createMesh",value:function(e){}},{key:"createEntity",value:function(e){}},{key:"finalize",value:function(){}},{key:"stateSortCompare",value:function(e,t){}},{key:"drawColorOpaque",value:function(e){}},{key:"drawColorTransparent",value:function(e){}},{key:"drawDepth",value:function(e){}},{key:"drawNormals",value:function(e){}},{key:"drawSilhouetteXRayed",value:function(e){}},{key:"drawSilhouetteHighlighted",value:function(e){}},{key:"drawSilhouetteSelected",value:function(e){}},{key:"drawEdgesColorOpaque",value:function(e){}},{key:"drawEdgesColorTransparent",value:function(e){}},{key:"drawEdgesXRayed",value:function(e){}},{key:"drawEdgesHighlighted",value:function(e){}},{key:"drawEdgesSelected",value:function(e){}},{key:"drawOcclusion",value:function(e){}},{key:"drawShadow",value:function(e){}},{key:"drawPickMesh",value:function(e){}},{key:"drawPickDepths",value:function(e){}},{key:"drawPickNormals",value:function(e){}},{key:"destroy",value:function(){}}]),e}(),Bu=function(){function e(t,i,s,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;w(this,e),this.model=t,this.object=null,this.parent=null,this.id=i,this.pickId=this.model.scene._renderer.getPickID(this),this.aabb=q.AABB3(),this._layer=n,this._portionId=o,this._color=[s[0],s[1],s[2],r],this._colorize=[s[0],s[1],s[2],r],this._colorizing=!1,this._transparent=r<255,this.numTriangles=0,this.origin=null}return I(e,[{key:"_finalize",value:function(e){this._layer.initFlags(this._portionId,e,this._transparent)}},{key:"_finalize2",value:function(){this._layer.flushInitFlags&&this._layer.flushInitFlags()}},{key:"_setVisible",value:function(e){this._layer.setVisible(this._portionId,e,this._transparent)}},{key:"_setColor",value:function(e){this._color[0]=e[0],this._color[1]=e[1],this._color[2]=e[2],this._colorizing||this._layer.setColor(this._portionId,this._color,!1)}},{key:"_setColorize",value:function(e){e?(this._colorize[0]=e[0],this._colorize[1]=e[1],this._colorize[2]=e[2],this._layer.setColor(this._portionId,this._colorize,false),this._colorizing=!0):(this._layer.setColor(this._portionId,this._color,false),this._colorizing=!1)}},{key:"_setOpacity",value:function(e,t){var i=e<255,s=this._transparent!==i;this._color[3]=e,this._colorize[3]=e,this._transparent=i,this._colorizing?this._layer.setColor(this._portionId,this._colorize):this._layer.setColor(this._portionId,this._color),s&&this._layer.setTransparent(this._portionId,t,i)}},{key:"_setOffset",value:function(e){this._layer.setOffset(this._portionId,e)}},{key:"_setHighlighted",value:function(e){this._layer.setHighlighted(this._portionId,e,this._transparent)}},{key:"_setXRayed",value:function(e){this._layer.setXRayed(this._portionId,e,this._transparent)}},{key:"_setSelected",value:function(e){this._layer.setSelected(this._portionId,e,this._transparent)}},{key:"_setEdges",value:function(e){this._layer.setEdges(this._portionId,e,this._transparent)}},{key:"_setClippable",value:function(e){this._layer.setClippable(this._portionId,e,this._transparent)}},{key:"_setCollidable",value:function(e){this._layer.setCollidable(this._portionId,e)}},{key:"_setPickable",value:function(e){this._layer.setPickable(this._portionId,e,this._transparent)}},{key:"_setCulled",value:function(e){this._layer.setCulled(this._portionId,e,this._transparent)}},{key:"canPickTriangle",value:function(){return!1}},{key:"drawPickTriangles",value:function(e,t){}},{key:"pickTriangleSurface",value:function(e){}},{key:"precisionRayPickSurface",value:function(e,t,i,s){return!!this._layer.precisionRayPickSurface&&this._layer.precisionRayPickSurface(this._portionId,e,t,i,s)}},{key:"canPickWorldPos",value:function(){return!0}},{key:"drawPickDepths",value:function(e){this.model.drawPickDepths(e)}},{key:"drawPickNormals",value:function(e){this.model.drawPickNormals(e)}},{key:"delegatePickedEntity",value:function(){return this.parent}},{key:"_destroy",value:function(){this.model.scene._renderer.putPickID(this.pickId)}}]),e}(),Lu=new(function(){function e(){w(this,e),this._uint8Arrays={},this._float32Arrays={}}return I(e,[{key:"_clear",value:function(){this._uint8Arrays={},this._float32Arrays={}}},{key:"getUInt8Array",value:function(e){var t=this._uint8Arrays[e];return t||(t=new Uint8Array(e),this._uint8Arrays[e]=t),t}},{key:"getFloat32Array",value:function(e){var t=this._float32Arrays[e];return t||(t=new Float32Array(e),this._float32Arrays[e]=t),t}}]),e}()),Nu=0;function ju(){return Nu++,Lu}var Gu=0,Hu=1,Uu=2,Vu=3,zu=4,Wu=5,Xu=6,Yu=7,Ku=8,Ju=9,Zu=10,Qu=11,qu=q.vec4(),$u=q.vec3(),eh=function(){function e(t,i){w(this,e),this._scene=t,this._withSAO=i,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){var e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}},{key:"drawLayer",value:function(e,t,i){var s=this._scene,r=s.camera,n=t.model,o=s.canvas.gl,a=t._state,u=t._state.origin;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(r.viewMatrix,u):r.viewMatrix),o.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.viewNormalMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,n.worldMatrix),o.uniformMatrix4fv(this._uWorldNormalMatrix,!1,n.worldNormalMatrix);var h=s._sectionPlanesState.sectionPlanes.length;if(h>0)for(var l=s._sectionPlanesState.sectionPlanes,c=t.layerIndex*h,p=n.renderFlags,d=0;d<h;d++){var f=this._uSectionPlanes[d];if(f){var m=p.sectionPlanesActivePerLayer[c+d];if(o.uniform1i(f.active,m?1:0),m){var v=l[d];if(u){var g=Ee(v.dist,v.dir,u,$u);o.uniform3fv(f.pos,g)}else o.uniform3fv(f.pos,v.pos);o.uniform3fv(f.dir,v.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(a.normalsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),a.indicesBuf.bind(),o.drawElements(o.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0),e.drawElements++}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];for(var r=i.lights,n=0,o=r.length;n<o;n++)switch(r[n].type){case"dir":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=null,this._uLightDir[n]=s.getLocation("lightDir"+n);break;case"point":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=null,this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n);break;case"spot":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=s.getLocation("lightDir"+n),this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n)}this._uSectionPlanes=[];for(var a=0,u=e._sectionPlanesState.sectionPlanes.length;a<u;a++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+a),pos:s.getLocation("sectionPlanePos"+a),dir:s.getLocation("sectionPlaneDir"+a)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(e){var t=this._scene,i=t.canvas.gl,s=this._program,r=t._lightsState.lights,n=t.camera.project;s.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,n.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(var o=0,a=r.length;o<a;o++){var u=r[o];this._uLightColor[o]&&i.uniform4f(this._uLightColor[o],u.color[0],u.color[1],u.color[2],u.intensity),this._uLightPos[o]&&(i.uniform3fv(this._uLightPos[o],u.pos),this._uLightAttenuation[o]&&i.uniform1f(this._uLightAttenuation[o],u.attenuation)),this._uLightDir[o]&&i.uniform3fv(this._uLightDir[o],u.dir)}if(this._withSAO){var h=t.sao;if(h.possible){var l=i.drawingBufferWidth,c=i.drawingBufferHeight;qu[0]=l,qu[1]=c,qu[2]=h.blendCutoff,qu[3]=h.blendFactor,i.uniform4fv(this._uSAOParams,qu),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}if(t.logarithmicDepthBufferEnabled){var p=2/(Math.log(n.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,p)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e,t=this._scene,i=t._sectionPlanesState,s=t._lightsState,r=i.sectionPlanes.length>0,n=[];n.push("#version 300 es"),n.push("// Triangles batching draw vertex shader"),n.push("uniform int renderPass;"),n.push("in vec3 position;"),n.push("in vec3 normal;"),n.push("in vec4 color;"),n.push("in vec4 flags;"),n.push("in vec4 flags2;"),t.entityOffsetsEnabled&&n.push("in vec3 offset;"),n.push("uniform mat4 worldMatrix;"),n.push("uniform mat4 worldNormalMatrix;"),n.push("uniform mat4 viewMatrix;"),n.push("uniform mat4 projMatrix;"),n.push("uniform mat4 viewNormalMatrix;"),n.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),n.push("out float vFragDepth;"),n.push("bool isPerspectiveMatrix(mat4 m) {"),n.push("    return (m[2][3] == - 1.0);"),n.push("}"),n.push("out float isPerspective;")),n.push("uniform vec4 lightAmbient;");for(var o=0,a=s.lights.length;o<a;o++)"ambient"!==(e=s.lights[o]).type&&(n.push("uniform vec4 lightColor"+o+";"),"dir"===e.type&&n.push("uniform vec3 lightDir"+o+";"),"point"===e.type&&n.push("uniform vec3 lightPos"+o+";"),"spot"===e.type&&(n.push("uniform vec3 lightPos"+o+";"),n.push("uniform vec3 lightDir"+o+";")));n.push("vec3 octDecode(vec2 oct) {"),n.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),n.push("    if (v.z < 0.0) {"),n.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),n.push("    }"),n.push("    return normalize(v);"),n.push("}"),r&&(n.push("out vec4 vWorldPosition;"),n.push("out vec4 vFlags2;")),n.push("out vec4 vColor;"),n.push("void main(void) {"),n.push("if (int(flags.x) != renderPass) {"),n.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),n.push("} else {"),n.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&n.push("worldPosition.xyz = worldPosition.xyz + offset;"),n.push("vec4 viewPosition  = viewMatrix * worldPosition; "),n.push("vec4 worldNormal =  worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),n.push("vec3 viewNormal = normalize((viewNormalMatrix * worldNormal).xyz);"),n.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),n.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),n.push("float lambertian = 1.0;");for(var u=0,h=s.lights.length;u<h;u++)if("ambient"!==(e=s.lights[u]).type){if("dir"===e.type)"view"===e.space?n.push("viewLightDir = normalize(lightDir"+u+");"):n.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+u+", 0.0)).xyz);");else if("point"===e.type)"view"===e.space?n.push("viewLightDir = -normalize(lightPos"+u+" - viewPosition.xyz);"):n.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+u+", 0.0)).xyz);");else{if("spot"!==e.type)continue;"view"===e.space?n.push("viewLightDir = normalize(lightDir"+u+");"):n.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+u+", 0.0)).xyz);")}n.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),n.push("reflectedColor += lambertian * (lightColor"+u+".rgb * lightColor"+u+".a);")}return n.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),n.push("vColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),n.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(n.push("vFragDepth = 1.0 + clipPos.w;"),n.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),r&&(n.push("vWorldPosition = worldPosition;"),n.push("vFlags2 = flags2;")),n.push("gl_Position = clipPos;"),n.push("}"),n.push("}"),n}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Triangles batching draw fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),this._withSAO&&(s.push("uniform sampler2D uOcclusionTexture;"),s.push("uniform vec4      uSAOParams;"),s.push("const float       packUpscale = 256. / 255.;"),s.push("const float       unpackDownScale = 255. / 256.;"),s.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),s.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),s.push("float unpackRGBToFloat( const in vec4 v ) {"),s.push("    return dot( v, unPackFactors );"),s.push("}")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { "),s.push("      discard;"),s.push("  }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),this._withSAO?(s.push("   float viewportWidth     = uSAOParams[0];"),s.push("   float viewportHeight    = uSAOParams[1];"),s.push("   float blendCutoff       = uSAOParams[2];"),s.push("   float blendFactor       = uSAOParams[3];"),s.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),s.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),s.push("   outColor            = vec4(vColor.rgb * ambient, 1.0);")):s.push("   outColor            = vColor;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),th=q.vec4(),ih=q.vec3(),sh=function(){function e(t,i){w(this,e),this._scene=t,this._withSAO=i,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){var e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}},{key:"drawLayer",value:function(e,t,i){var s=this._scene,r=s.camera,n=t.model,o=s.canvas.gl,a=t._state,u=t._state.origin;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(r.viewMatrix,u):r.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,n.worldMatrix);var h=s._sectionPlanesState.sectionPlanes.length;if(h>0)for(var l=s._sectionPlanesState.sectionPlanes,c=t.layerIndex*h,p=n.renderFlags,d=0;d<h;d++){var f=this._uSectionPlanes[d],m=p.sectionPlanesActivePerLayer[c+d];if(o.uniform1i(f.active,m?1:0),m){var v=l[d];if(u){var g=Ee(v.dist,v.dir,u,ih);o.uniform3fv(f.pos,g)}else o.uniform3fv(f.pos,v.pos);o.uniform3fv(f.dir,v.dir)}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),a.indicesBuf.bind(),o.drawElements(o.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];for(var r=i.lights,n=0,o=r.length;n<o;n++)switch(r[n].type){case"dir":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=null,this._uLightDir[n]=s.getLocation("lightDir"+n);break;case"point":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=null,this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n);break;case"spot":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=s.getLocation("lightDir"+n),this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n)}this._uSectionPlanes=[];for(var a=0,u=e._sectionPlanesState.sectionPlanes.length;a<u;a++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+a),pos:s.getLocation("sectionPlanePos"+a),dir:s.getLocation("sectionPlaneDir"+a)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(e){var t=this._scene,i=t.canvas.gl,s=this._program,r=t._lightsState.lights,n=t.camera.project;s.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,n.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(var o=0,a=r.length;o<a;o++){var u=r[o];this._uLightColor[o]&&i.uniform4f(this._uLightColor[o],u.color[0],u.color[1],u.color[2],u.intensity),this._uLightPos[o]&&(i.uniform3fv(this._uLightPos[o],u.pos),this._uLightAttenuation[o]&&i.uniform1f(this._uLightAttenuation[o],u.attenuation)),this._uLightDir[o]&&i.uniform3fv(this._uLightDir[o],u.dir)}if(this._withSAO){var h=t.sao;if(h.possible){var l=i.drawingBufferWidth,c=i.drawingBufferHeight;th[0]=l,th[1]=c,th[2]=h.blendCutoff,th[3]=h.blendFactor,i.uniform4fv(this._uSAOParams,th),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}if(t.logarithmicDepthBufferEnabled){var p=2/(Math.log(n.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,p)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles batching flat-shading draw vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),i.push("in vec4 color;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vViewPosition;"),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("vViewPosition = viewPosition;"),i.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._lightsState,i=e._sectionPlanesState,s=i.sectionPlanes.length>0,r=[];if(r.push("#version 300 es"),r.push("// Triangles batching flat-shading draw fragment shader"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),e.logarithmicDepthBufferEnabled&&(r.push("in float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("in float vFragDepth;")),this._withSAO&&(r.push("uniform sampler2D uOcclusionTexture;"),r.push("uniform vec4      uSAOParams;"),r.push("const float       packUpscale = 256. / 255.;"),r.push("const float       unpackDownScale = 255. / 256.;"),r.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),r.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),r.push("float unpackRGBToFloat( const in vec4 v ) {"),r.push("    return dot( v, unPackFactors );"),r.push("}")),s){r.push("in vec4 vWorldPosition;"),r.push("in vec4 vFlags2;");for(var n=0,o=i.sectionPlanes.length;n<o;n++)r.push("uniform bool sectionPlaneActive"+n+";"),r.push("uniform vec3 sectionPlanePos"+n+";"),r.push("uniform vec3 sectionPlaneDir"+n+";")}r.push("uniform mat4 viewMatrix;"),r.push("uniform vec4 lightAmbient;");for(var a=0,u=t.lights.length;a<u;a++){var h=t.lights[a];"ambient"!==h.type&&(r.push("uniform vec4 lightColor"+a+";"),"dir"===h.type&&r.push("uniform vec3 lightDir"+a+";"),"point"===h.type&&r.push("uniform vec3 lightPos"+a+";"),"spot"===h.type&&(r.push("uniform vec3 lightPos"+a+";"),r.push("uniform vec3 lightDir"+a+";")))}if(r.push("in vec4 vViewPosition;"),r.push("in vec4 vColor;"),r.push("out vec4 outColor;"),r.push("void main(void) {"),s){r.push("  bool clippable = (float(vFlags2.x) > 0.0);"),r.push("  if (clippable) {"),r.push("  float dist = 0.0;");for(var l=0,c=i.sectionPlanes.length;l<c;l++)r.push("if (sectionPlaneActive"+l+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+l+".xyz, vWorldPosition.xyz - sectionPlanePos"+l+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { "),r.push("      discard;"),r.push("  }"),r.push("}")}r.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),r.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),r.push("float lambertian = 1.0;"),r.push("vec3 xTangent = dFdx( vViewPosition.xyz );"),r.push("vec3 yTangent = dFdy( vViewPosition.xyz );"),r.push("vec3 viewNormal = normalize( cross( xTangent, yTangent ) );");for(var p=0,d=t.lights.length;p<d;p++){var f=t.lights[p];if("ambient"!==f.type){if("dir"===f.type)"view"===f.space?r.push("viewLightDir = normalize(lightDir"+p+");"):r.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+p+", 0.0)).xyz);");else if("point"===f.type)"view"===f.space?r.push("viewLightDir = -normalize(lightPos"+p+" - viewPosition.xyz);"):r.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+p+", 0.0)).xyz);");else{if("spot"!==f.type)continue;"view"===f.space?r.push("viewLightDir = normalize(lightDir"+p+");"):r.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+p+", 0.0)).xyz);")}r.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),r.push("reflectedColor += lambertian * (lightColor"+p+".rgb * lightColor"+p+".a);")}}return r.push("vec4 fragColor =  vec4((lightAmbient.rgb * lightAmbient.a * vColor.rgb) + (reflectedColor * vColor.rgb), vColor.a);"),this._withSAO?(r.push("   float viewportWidth     = uSAOParams[0];"),r.push("   float viewportHeight    = uSAOParams[1];"),r.push("   float blendCutoff       = uSAOParams[2];"),r.push("   float blendFactor       = uSAOParams[3];"),r.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),r.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),r.push("   outColor            = vec4(fragColor.rgb * ambient, 1.0);")):r.push("   outColor            = fragColor;"),e.logarithmicDepthBufferEnabled&&r.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),r.push("}"),r}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),rh=new Float32Array([1,1,1]),nh=q.vec3(),oh=function(){function e(t,i){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin;if(this._program||(this._allocate(),!this.errors)){if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),i===Wu){var h=r.xrayMaterial._state,l=h.fillColor,c=h.fillAlpha;o.uniform4f(this._uSilhouetteColor,l[0],l[1],l[2],c)}else if(i===Vu){var p=r.highlightMaterial._state,d=p.fillColor,f=p.fillAlpha;o.uniform4f(this._uSilhouetteColor,d[0],d[1],d[2],f)}else if(i===zu){var m=r.selectedMaterial._state,v=m.fillColor,g=m.fillAlpha;o.uniform4f(this._uSilhouetteColor,v[0],v[1],v[2],g)}else o.uniform4fv(this._uSilhouetteColor,rh);var _=u?De(n.viewMatrix,u):n.viewMatrix;o.uniformMatrix4fv(this._uViewMatrix,!1,_),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var y=r._sectionPlanesState.sectionPlanes.length;if(y>0)for(var b=r._sectionPlanesState.sectionPlanes,x=t.layerIndex*y,P=s.renderFlags,T=0;T<y;T++){var w=this._uSectionPlanes[T];if(w){var M=P.sectionPlanesActivePerLayer[x+T];if(o.uniform1i(w.active,M?1:0),M){var I=b[T];if(u){var C=Ee(I.dist,I.dir,u,nh);o.uniform3fv(w.pos,C)}else o.uniform3fv(w.pos,I.pos);o.uniform3fv(w.dir,I.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),a.indicesBuf.bind(),o.drawElements(o.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSilhouetteColor=i.getLocation("silhouetteColor"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aColor=i.getAttribute("color"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles batching silhouette vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 color;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform vec4 silhouetteColor;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.y) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vColor = vec4(silhouetteColor.r, silhouetteColor.g, silhouetteColor.b, min(silhouetteColor.a, float(color.a) / 255.0));"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e,t,i=this._scene,s=i._sectionPlanesState,r=s.sectionPlanes.length>0,n=[];if(n.push("#version 300 es"),n.push("// Triangles batching silhouette fragment shader"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),i.logarithmicDepthBufferEnabled&&(n.push("in float isPerspective;"),n.push("uniform float logDepthBufFC;"),n.push("in float vFragDepth;")),r)for(n.push("in vec4 vWorldPosition;"),n.push("in vec4 vFlags2;"),e=0,t=s.sectionPlanes.length;e<t;e++)n.push("uniform bool sectionPlaneActive"+e+";"),n.push("uniform vec3 sectionPlanePos"+e+";"),n.push("uniform vec3 sectionPlaneDir"+e+";");if(n.push("in vec4 vColor;"),n.push("out vec4 outColor;"),n.push("void main(void) {"),r){for(n.push("  bool clippable = (float(vFlags2.x) > 0.0);"),n.push("  if (clippable) {"),n.push("  float dist = 0.0;"),e=0,t=s.sectionPlanes.length;e<t;e++)n.push("if (sectionPlaneActive"+e+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),n.push("}");n.push("  if (dist > 0.0) { discard; }"),n.push("}")}return i.logarithmicDepthBufferEnabled&&n.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("outColor = vColor;"),n.push("}"),n}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),ah=q.vec3(),uh=new Float32Array([0,0,0,1]),hh=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin;if(this._program||(this._allocate(t),!this.errors)){if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),i===Zu){var h=r.xrayMaterial._state,l=h.edgeColor,c=h.edgeAlpha;o.uniform4f(this._uColor,l[0],l[1],l[2],c)}else if(i===Ku){var p=r.highlightMaterial._state,d=p.edgeColor,f=p.edgeAlpha;o.uniform4f(this._uColor,d[0],d[1],d[2],f)}else if(i===Ju){var m=r.selectedMaterial._state,v=m.edgeColor,g=m.edgeAlpha;o.uniform4f(this._uColor,v[0],v[1],v[2],g)}else o.uniform4fv(this._uColor,uh);o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(n.viewMatrix,u):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var _=r._sectionPlanesState.sectionPlanes.length;if(_>0)for(var y=r._sectionPlanesState.sectionPlanes,b=t.layerIndex*_,x=s.renderFlags,P=0;P<_;P++){var T=this._uSectionPlanes[P];if(T){var w=x.sectionPlanesActivePerLayer[b+P];if(o.uniform1i(T.active,w?1:0),w){var M=y[P];if(u){var I=Ee(M.dist,M.dir,u,ah);o.uniform3fv(T.pos,I)}else o.uniform3fv(T.pos,M.pos);o.uniform3fv(T.dir,M.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.edgeIndicesBuf.bind(),o.drawElements(o.LINES,a.edgeIndicesBuf.numItems,a.edgeIndicesBuf.itemType,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uColor=i.getLocation("color"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=this._program,s=e.camera.project;if(i.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){var r=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,r)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Batched geometry edges drawing vertex shader"),i.push("uniform int renderPass;"),i.push("uniform vec4 color;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.z) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("  vWorldPosition = worldPosition;"),i.push("  vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("vColor = vec4(color.r, color.g, color.b, color.a);"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Batched geometry edges drawing fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("outColor = vColor;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),lh=q.vec3(),ch=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin;if(this._program||(this._allocate(t),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(n.viewMatrix,u):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var h=r._sectionPlanesState.sectionPlanes.length;if(h>0)for(var l=r._sectionPlanesState.sectionPlanes,c=t.layerIndex*h,p=s.renderFlags,d=0;d<h;d++){var f=this._uSectionPlanes[d];if(f){var m=p.sectionPlanesActivePerLayer[c+d];if(o.uniform1i(f.active,m?1:0),m){var v=l[d];if(u){var g=Ee(v.dist,v.dir,u,lh);o.uniform3fv(f.pos,g)}else o.uniform3fv(f.pos,v.pos);o.uniform3fv(f.dir,v.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.edgeIndicesBuf.bind(),o.drawElements(o.LINES,a.edgeIndicesBuf.numItems,a.edgeIndicesBuf.itemType,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aColor=i.getAttribute("color"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=this._program,s=e.camera.project;if(i.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){var r=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,r)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Batched geometry edges drawing vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),i.push("in vec4 color;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.z) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("  vWorldPosition = worldPosition;"),i.push("  vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("vColor = vec4(float(color.r*0.5) / 255.0, float(color.g*0.5) / 255.0, float(color.b*0.5) / 255.0, float(color.a) / 255.0);"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Batched geometry edges drawing fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("outColor = vColor;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),ph=q.vec3(),dh=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var h=e.pickViewMatrix||n.viewMatrix,l=u?De(h,u):h;if(o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),o.uniformMatrix4fv(this._uViewMatrix,!1,l),r.logarithmicDepthBufferEnabled){var c=2/(Math.log(n.project.far+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,c)}var p=r._sectionPlanesState.sectionPlanes.length;if(p>0)for(var d=r._sectionPlanesState.sectionPlanes,f=t.layerIndex*p,m=s.renderFlags,v=0;v<p;v++){var g=this._uSectionPlanes[v];if(g){var _=m.sectionPlanesActivePerLayer[f+v];if(o.uniform1i(g.active,_?1:0),_){var y=d[v];if(u){var b=Ee(y.dist,y.dir,u,ph);o.uniform3fv(g.pos,b)}else o.uniform3fv(g.pos,y.pos);o.uniform3fv(g.dir,y.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aPickColor&&this._aPickColor.bindArrayBuffer(a.pickColorsBuf),a.indicesBuf.bind(),o.drawElements(o.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aPickColor=i.getAttribute("pickColor"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(e){var t=this._scene.canvas.gl;this._program.bind(),t.uniform1i(this._uPickInvisible,e.pickInvisible)}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Batched geometry picking vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 pickColor;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vPickColor;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("      vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Batched geometry picking fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vPickColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("   outColor = vPickColor; "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),fh=q.vec3(),mh=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin;this._program||this._allocate(),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniform1i(this._uPickInvisible,e.pickInvisible);var h=e.pickViewMatrix||n.viewMatrix,l=u?De(h,u):h;if(o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.uniformMatrix4fv(this._uViewMatrix,!1,l),o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),o.uniform1f(this._uPickZNear,e.pickZNear),o.uniform1f(this._uPickZFar,e.pickZFar),r.logarithmicDepthBufferEnabled){var c=2/(Math.log(e.pickZFar+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,c)}var p=r._sectionPlanesState.sectionPlanes.length;if(p>0)for(var d=r._sectionPlanesState.sectionPlanes,f=t.layerIndex*p,m=s.renderFlags,v=0;v<p;v++){var g=this._uSectionPlanes[v];if(g){var _=m.sectionPlanesActivePerLayer[f+v];if(o.uniform1i(g.active,_?1:0),_){var y=d[v];if(u){var b=Ee(y.dist,y.dir,u,fh);o.uniform3fv(g.pos,b)}else o.uniform3fv(g.pos,y.pos);o.uniform3fv(g.dir,y.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),o.drawElements(o.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._uPickZNear=i.getLocation("pickZNear"),this._uPickZFar=i.getLocation("pickZFar"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){this._program.bind()}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles batching pick depth vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vViewPosition;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vViewPosition = viewPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Triangles batching pick depth fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),s.push("uniform float pickZNear;"),s.push("uniform float pickZFar;"),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vViewPosition;"),s.push("vec4 packDepth(const in float depth) {"),s.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),s.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),s.push("  vec4 res = fract(depth * bitShift);"),s.push("  res -= res.xxyz * bitMask;"),s.push("  return res;"),s.push("}"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),s.push("    outColor = packDepth(zNormalizedDepth); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),vh=q.vec3(),gh=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniform1i(this._uPickInvisible,e.pickInvisible),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var h=e.pickViewMatrix||n.viewMatrix,l=u?De(h,u):h;if(o.uniformMatrix4fv(this._uViewMatrix,!1,l),o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),r.logarithmicDepthBufferEnabled){var c=2/(Math.log(n.project.far+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,c)}var p=r._sectionPlanesState.sectionPlanes.length;if(p>0)for(var d=r._sectionPlanesState.sectionPlanes,f=t.layerIndex*p,m=s.renderFlags,v=0;v<p;v++){var g=this._uSectionPlanes[v];if(g){var _=m.sectionPlanesActivePerLayer[f+v];if(o.uniform1i(g.active,_?1:0),_){var y=d[v];if(u){var b=Ee(y.dist,y.dir,u,vh);o.uniform3fv(g.pos,b)}else o.uniform3fv(g.pos,y.pos);o.uniform3fv(g.dir,y.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(a.normalsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),o.drawElements(o.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aNormal=i.getAttribute("normal"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){this._program.bind()}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles batching pick normals vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec3 normal;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),i.push("vec3 octDecode(vec2 oct) {"),i.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),i.push("    if (v.z < 0.0) {"),i.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),i.push("    }"),i.push("    return normalize(v);"),i.push("}"),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec3 vWorldNormal;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("      vec3 worldNormal =  octDecode(normal.xy); "),i.push("      vWorldNormal = worldNormal;"),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Triangles batching pick normals fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec3 vWorldNormal;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    outColor = vec4((vWorldNormal * 0.5) + 0.5, 1.0);"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),_h=q.vec3(),yh=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.canvas.gl,o=t._state,a=r.camera,u=t._state.origin;if(this._program||(this._allocate(t),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,i),n.uniformMatrix4fv(this._uViewMatrix,!1,u?De(a.viewMatrix,u):a.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var h=r._sectionPlanesState.sectionPlanes.length;if(h>0)for(var l=r._sectionPlanesState.sectionPlanes,c=t.layerIndex*h,p=s.renderFlags,d=0;d<h;d++){var f=this._uSectionPlanes[d];if(f){var m=p.sectionPlanesActivePerLayer[c+d];if(n.uniform1i(f.active,m?1:0),m){var v=l[d];if(u){var g=Ee(v.dist,v.dir,u,_h);n.uniform3fv(f.pos,g)}else n.uniform3fv(f.pos,v.pos);n.uniform3fv(f.dir,v.dir)}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(o.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(o.offsetsBuf),this._aColor&&this._aColor.bindArrayBuffer(o.colorsBuf),this._aFlags.bindArrayBuffer(o.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(o.flags2Buf),o.indicesBuf.bind(),n.drawElements(n.TRIANGLES,o.indicesBuf.numItems,o.indicesBuf.itemType,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles batching occlusion vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 color;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Triangles batching occlusion fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("      if (sectionPlaneActive"+n+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("   outColor = vec4(0.0, 0.0, 1.0, 1.0); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),bh=q.vec3(),xh=function(){function e(t){w(this,e),this._scene=t,this._allocate(),this._hash=this._getHash()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(n.viewMatrix,u):n.viewMatrix);var h=r._sectionPlanesState.sectionPlanes.length;if(h>0)for(var l=r._sectionPlanesState.sectionPlanes,c=t.layerIndex*h,p=s.renderFlags,d=0;d<h;d++){var f=this._uSectionPlanes[d];if(f){var m=p.sectionPlanesActivePerLayer[c+d];if(o.uniform1i(f.active,m?1:0),m){var v=l[d];if(u){var g=Ee(v.dist,v.dir,u,bh);o.uniform3fv(f.pos,g)}else o.uniform3fv(f.pos,v.pos);o.uniform3fv(f.dir,v.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),o.drawElements(o.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles batching depth vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec2 vHighPrecisionZW;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("vHighPrecisionZW = gl_Position.zw;"),i.push("  }"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Triangles batching depth fragment shader"),s.push("precision highp float;"),s.push("precision highp int;"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("const float   packUpScale = 256. / 255.;"),s.push("const float   unpackDownscale = 255. / 256.;"),s.push("const vec3    packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),s.push("const vec4    unpackFactors = unpackDownscale / vec4( packFactors, 1. );"),s.push("const float   shiftRight8 = 1.0 / 256.;"),s.push("vec4 packDepthToRGBA( const in float v ) {"),s.push("    vec4 r = vec4( fract( v * packFactors ), v );"),s.push("    r.yzw -= r.xyz * shiftRight8;"),s.push("    return r * packUpScale;"),s.push("}"),s.push("in vec2 vHighPrecisionZW;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("      if (sectionPlaneActive"+n+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;"),s.push("    outColor = vec4(vec3(1.0 - fragCoordZ), 1.0); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null,ee.memory.programs--}}]),e}(),Ph=q.vec3(),Th=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin;if(this._program||(this._allocate(t),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(t)),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(n.viewMatrix,u):n.viewMatrix),o.uniformMatrix4fv(this._uViewNormalMatrix,!1,n.viewNormalMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.uniformMatrix4fv(this._uWorldNormalMatrix,!1,s.worldNormalMatrix);var h=r._sectionPlanesState.sectionPlanes.length;if(h>0)for(var l=r._sectionPlanesState.sectionPlanes,c=t.layerIndex*h,p=s.renderFlags,d=0;d<h;d++){var f=this._uSectionPlanes[d];if(f){var m=p.sectionPlanesActivePerLayer[c+d];if(o.uniform1i(f.active,m?1:0),m){var v=l[d];if(u){var g=Ee(v.dist,v.dir,u,Ph);o.uniform3fv(f.pos,g)}else o.uniform3fv(f.pos,v.pos);o.uniform3fv(f.dir,v.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aNormal.bindArrayBuffer(a.normalsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),o.drawElements(o.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aNormal=i.getAttribute("normal"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2&&(this._aFlags2=i.getAttribute("flags2")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Batched geometry normals vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec3 normal;"),i.push("in vec4 color;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 worldNormalMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 viewNormalMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),i.push("vec3 octDecode(vec2 oct) {"),i.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),i.push("    if (v.z < 0.0) {"),i.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),i.push("    }"),i.push("    return normalize(v);"),i.push("}"),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec3 vViewNormal;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition   = viewMatrix * worldPosition; "),i.push("      vec4 worldNormal    = worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),i.push("      vec3 viewNormal     = normalize((viewNormalMatrix * worldNormal).xyz);"),t&&(i.push("      vWorldPosition  = worldPosition;"),i.push("      vFlags2         = flags2;")),i.push("      vViewNormal = viewNormal;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Batched geometry normals fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec3 vViewNormal;"),s.push("vec3 packNormalToRGB( const in vec3 normal ) {"),s.push("    return normalize( normal ) * 0.5 + 0.5;"),s.push("}"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("      if (sectionPlaneActive"+n+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    outColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),wh=q.vec3(),Mh=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t){var i=this._scene,s=i.canvas.gl,r=t._state;this._program||this._allocate(),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),s.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),i.logarithmicDepthBufferEnabled&&s.uniform1f(this._uZFar,i.camera.project.far),this._aPosition.bindArrayBuffer(r.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(r.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(r.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(r.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(r.offsetsBuf),r.indicesBuf.bind();var n=i._sectionPlanesState.sectionPlanes.length;if(n>0)for(var o=i._sectionPlanesState.sectionPlanes,a=t.layerIndex*n,u=model.renderFlags,h=t._state.origin,l=0;l<n;l++){var c=this._uSectionPlanes[l];if(c){var p=u.sectionPlanesActivePerLayer[a+l];if(s.uniform1i(c.active,p?1:0),p){var d=o[l];if(h){var f=Ee(d.dist,d.dir,h,wh);s.uniform3fv(c.pos,f)}else s.uniform3fv(c.pos,d.pos);s.uniform3fv(c.dir,d.dir)}}}s.drawElements(s.TRIANGLES,r.indicesBuf.numItems,r.indicesBuf.itemType,0)}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uShadowViewMatrix=s.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=s.getLocation("shadowProjMatrix"),e.logarithmicDepthBufferEnabled&&(this._uZFar=s.getLocation("zFar")),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2")}}},{key:"_bindProgram",value:function(e){var t=this._scene.canvas.gl;this._program.bind(),t.uniformMatrix4fv(this._uShadowViewMatrix,!1,e.shadowViewMatrix),t.uniformMatrix4fv(this._uShadowProjMatrix,!1,e.shadowProjMatrix),this._lastLightId=null}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Batched geometry shadow vertex shader"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 color;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("uniform mat4 shadowViewMatrix;"),i.push("uniform mat4 shadowProjMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vViewPosition;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),i.push("  bool visible        = (float(flags.x) > 0.0);"),i.push("  bool transparent    = ((float(color.a) / 255.0) < 1.0);"),i.push("  if (!visible || transparent) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = shadowViewMatrix * worldPosition; "),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("      vViewPosition = viewPosition;"),i.push("      gl_Position = shadowProjMatrix * viewPosition;"),i.push("  }"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene._sectionPlanesState,t=e.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Batched geometry shadow fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(var s=0;s<e.sectionPlanes.length;s++)i.push("uniform bool sectionPlaneActive"+s+";"),i.push("uniform vec3 sectionPlanePos"+s+";"),i.push("uniform vec3 sectionPlaneDir"+s+";")}if(i.push("in vec4 vViewPosition;"),i.push("vec4 encodeFloat( const in float v ) {"),i.push("  const vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);"),i.push("  const vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);"),i.push("  vec4 comp = fract(v * bitShift);"),i.push("  comp -= comp.xxyz * bitMask;"),i.push("  return comp;"),i.push("}"),i.push("out vec4 outColor;"),i.push("void main(void) {"),t){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(var r=0;r<e.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return i.push("    outColor = encodeFloat( gl_FragCoord.z); "),i.push("}"),i}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Ih=q.vec4(),Ch=q.vec3(),Dh=function(){function e(t,i){w(this,e),this._scene=t,this._withSAO=i,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){var e=this._scene;return[e.gammaOutput,e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}},{key:"drawLayer",value:function(e,t,i){var s=Ze.MAX_TEXTURE_IMAGE_UNITS,r=this._scene,n=r.camera,o=t.model,a=r.canvas.gl,u=t._state,h=t._state.origin,l=u.textureSet,c=r._lightsState;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,h?De(n.viewMatrix,h):n.viewMatrix),a.uniformMatrix4fv(this._uViewNormalMatrix,!1,n.viewNormalMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix),a.uniformMatrix4fv(this._uWorldNormalMatrix,!1,o.worldNormalMatrix);var p=r._sectionPlanesState.sectionPlanes.length;if(p>0)for(var d=r._sectionPlanesState.sectionPlanes,f=t.layerIndex*p,m=o.renderFlags,v=0;v<p;v++){var g=this._uSectionPlanes[v];if(g){var _=m.sectionPlanesActivePerLayer[f+v];if(a.uniform1i(g.active,_?1:0),_){var y=d[v];if(h){var b=Ee(y.dist,y.dir,h,Ch);a.uniform3fv(g.pos,b)}else a.uniform3fv(g.pos,y.pos);a.uniform3fv(g.dir,y.dir)}}}if(a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._uUVDecodeMatrix&&a.uniformMatrix3fv(this._uUVDecodeMatrix,!1,u.uvDecodeMatrix),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(u.normalsBuf),this._aUV&&this._aUV.bindArrayBuffer(u.uvBuf),this._aColor&&this._aColor.bindArrayBuffer(u.colorsBuf),this._aMetallicRoughness&&this._aMetallicRoughness.bindArrayBuffer(u.metallicRoughnessBuf),this._aFlags&&this._aFlags.bindArrayBuffer(u.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(u.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(u.offsetsBuf),c.reflectionMaps.length>0&&c.reflectionMaps[0].texture&&this._uReflectionMap&&(this._program.bindTexture(this._uReflectionMap,c.reflectionMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++),c.lightMaps.length>0&&c.lightMaps[0].texture&&this._uLightMap&&(this._program.bindTexture(this._uLightMap,c.lightMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++),this._withSAO){var x=r.sao;if(x.possible){var P=a.drawingBufferWidth,T=a.drawingBufferHeight;Ih[0]=P,Ih[1]=T,Ih[2]=x.blendCutoff,Ih[3]=x.blendFactor,a.uniform4fv(this._uSAOParams,Ih),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++}}this._program.bindTexture(this._uBaseColorMap,l.colorTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,this._program.bindTexture(this._uMetallicRoughMap,l.metallicRoughnessTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,this._program.bindTexture(this._uEmissiveMap,l.emissiveTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,this._program.bindTexture(this._uNormalMap,l.normalsTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,this._program.bindTexture(this._uAOMap,l.occlusionTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,u.indicesBuf.bind(),a.drawElements(a.TRIANGLES,u.indicesBuf.numItems,u.indicesBuf.itemType,0),e.drawElements++}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=s.getLocation("uvDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uGammaFactor=s.getLocation("gammaFactor"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];for(var r=i.lights,n=0,o=r.length;n<o;n++)switch(r[n].type){case"dir":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=null,this._uLightDir[n]=s.getLocation("lightDir"+n);break;case"point":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=null,this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n);break;case"spot":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=s.getLocation("lightDir"+n),this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n)}i.reflectionMaps.length>0&&(this._uReflectionMap="reflectionMap"),i.lightMaps.length>0&&(this._uLightMap="lightMap"),this._uSectionPlanes=[];for(var a=0,u=e._sectionPlanesState.sectionPlanes.length;a<u;a++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+a),pos:s.getLocation("sectionPlanePos"+a),dir:s.getLocation("sectionPlaneDir"+a)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aUV=s.getAttribute("uv"),this._aColor=s.getAttribute("color"),this._aMetallicRoughness=s.getAttribute("metallicRoughness"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uBaseColorMap="uBaseColorMap",this._uMetallicRoughMap="uMetallicRoughMap",this._uEmissiveMap="uEmissiveMap",this._uNormalMap="uNormalMap",this._uAOMap="uAOMap",this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(e){var t=this._scene,i=t.canvas.gl,s=this._program,r=t._lightsState.lights,n=t.camera.project;s.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,n.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(var o=0,a=r.length;o<a;o++){var u=r[o];this._uLightColor[o]&&i.uniform4f(this._uLightColor[o],u.color[0],u.color[1],u.color[2],u.intensity),this._uLightPos[o]&&(i.uniform3fv(this._uLightPos[o],u.pos),this._uLightAttenuation[o]&&i.uniform1f(this._uLightAttenuation[o],u.attenuation)),this._uLightDir[o]&&i.uniform3fv(this._uLightDir[o],u.dir)}if(t.logarithmicDepthBufferEnabled){var h=2/(Math.log(n.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,h)}this._uGammaFactor&&i.uniform1f(this._uGammaFactor,t.gammaFactor)}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=e._lightsState,s=t.sectionPlanes.length>0,r=t.clippingCaps,n=[];return n.push("#version 300 es"),n.push("// Triangles batching quality draw vertex shader"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("precision highp usampler2D;"),n.push("precision highp isampler2D;"),n.push("precision highp sampler2D;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("precision mediump usampler2D;"),n.push("precision mediump isampler2D;"),n.push("precision mediump sampler2D;"),n.push("#endif"),n.push("uniform int renderPass;"),n.push("in vec3 position;"),n.push("in vec3 normal;"),n.push("in vec4 color;"),n.push("in vec2 uv;"),n.push("in vec2 metallicRoughness;"),n.push("in vec4 flags;"),n.push("in vec4 flags2;"),e.entityOffsetsEnabled&&n.push("in vec3 offset;"),n.push("uniform mat4 worldMatrix;"),n.push("uniform mat4 worldNormalMatrix;"),n.push("uniform mat4 viewMatrix;"),n.push("uniform mat4 projMatrix;"),n.push("uniform mat4 viewNormalMatrix;"),n.push("uniform mat4 positionsDecodeMatrix;"),n.push("uniform mat3 uvDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),n.push("out float vFragDepth;"),n.push("bool isPerspectiveMatrix(mat4 m) {"),n.push("    return (m[2][3] == - 1.0);"),n.push("}"),n.push("out float isPerspective;")),n.push("vec3 octDecode(vec2 oct) {"),n.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),n.push("    if (v.z < 0.0) {"),n.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),n.push("    }"),n.push("    return normalize(v);"),n.push("}"),n.push("out vec4 vViewPosition;"),n.push("out vec3 vViewNormal;"),n.push("out vec4 vColor;"),n.push("out vec2 vUV;"),n.push("out vec2 vMetallicRoughness;"),i.lightMaps.length>0&&n.push("out vec3 vWorldNormal;"),s&&(n.push("out vec4 vWorldPosition;"),n.push("out vec4 vFlags2;"),r&&n.push("out vec4 vClipPosition;")),n.push("void main(void) {"),n.push("if (int(flags.x) != renderPass) {"),n.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),n.push("} else {"),n.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&n.push("worldPosition.xyz = worldPosition.xyz + offset;"),n.push("vec4 viewPosition  = viewMatrix * worldPosition; "),n.push("vec4 worldNormal =  worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),n.push("vec3 viewNormal = normalize((viewNormalMatrix * worldNormal).xyz);"),n.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(n.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"),n.push("vFragDepth = 1.0 + clipPos.w;")),s&&(n.push("vWorldPosition = worldPosition;"),n.push("vFlags2 = flags2;"),r&&n.push("vClipPosition = clipPos;")),n.push("vViewPosition = viewPosition;"),n.push("vViewNormal = viewNormal;"),n.push("vColor = color;"),n.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"),n.push("vMetallicRoughness = metallicRoughness;"),i.lightMaps.length>0&&n.push("vWorldNormal = worldNormal.xyz;"),n.push("gl_Position = clipPos;"),n.push("}"),n.push("}"),n}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e.gammaOutput,i=e._sectionPlanesState,s=e._lightsState,r=i.sectionPlanes.length>0,n=i.clippingCaps,o=[];o.push("#version 300 es"),o.push("// Triangles batching quality draw fragment shader"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),e.logarithmicDepthBufferEnabled&&(o.push("in float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("in float vFragDepth;")),o.push("uniform sampler2D uBaseColorMap;"),o.push("uniform sampler2D uMetallicRoughMap;"),o.push("uniform sampler2D uEmissiveMap;"),o.push("uniform sampler2D uNormalMap;"),o.push("uniform sampler2D uAOMap;"),o.push("in vec4 vViewPosition;"),o.push("in vec3 vViewNormal;"),o.push("in vec4 vColor;"),o.push("in vec2 vUV;"),o.push("in vec2 vMetallicRoughness;"),s.lightMaps.length>0&&o.push("in vec3 vWorldNormal;"),o.push("uniform mat4 viewMatrix;"),s.reflectionMaps.length>0&&o.push("uniform samplerCube reflectionMap;"),s.lightMaps.length>0&&o.push("uniform samplerCube lightMap;"),o.push("uniform vec4 lightAmbient;");for(var a=0,u=s.lights.length;a<u;a++){var h=s.lights[a];"ambient"!==h.type&&(o.push("uniform vec4 lightColor"+a+";"),"dir"===h.type&&o.push("uniform vec3 lightDir"+a+";"),"point"===h.type&&o.push("uniform vec3 lightPos"+a+";"),"spot"===h.type&&(o.push("uniform vec3 lightPos"+a+";"),o.push("uniform vec3 lightDir"+a+";")))}if(this._withSAO&&(o.push("uniform sampler2D uOcclusionTexture;"),o.push("uniform vec4      uSAOParams;"),o.push("const float       packUpscale = 256. / 255.;"),o.push("const float       unpackDownScale = 255. / 256.;"),o.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),o.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),o.push("float unpackRGBToFloat( const in vec4 v ) {"),o.push("    return dot( v, unPackFactors );"),o.push("}")),o.push("uniform float gammaFactor;"),o.push("vec4 linearToLinear( in vec4 value ) {"),o.push("  return value;"),o.push("}"),o.push("vec4 sRGBToLinear( in vec4 value ) {"),o.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),o.push("}"),o.push("vec4 gammaToLinear( in vec4 value) {"),o.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),o.push("}"),t&&(o.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),o.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),o.push("}")),r){o.push("in vec4 vWorldPosition;"),o.push("in vec4 vFlags2;"),n&&o.push("in vec4 vClipPosition;");for(var l=0,c=i.sectionPlanes.length;l<c;l++)o.push("uniform bool sectionPlaneActive"+l+";"),o.push("uniform vec3 sectionPlanePos"+l+";"),o.push("uniform vec3 sectionPlaneDir"+l+";")}if(o.push("#define PI 3.14159265359"),o.push("#define RECIPROCAL_PI 0.31830988618"),o.push("#define RECIPROCAL_PI2 0.15915494"),o.push("#define EPSILON 1e-6"),o.push("#define saturate(a) clamp( a, 0.0, 1.0 )"),o.push("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),o.push("       vec3 texel = texture( uNormalMap, uv ).xyz;"),o.push("       if (texel.x == 0.0 && texel.y == 0.0 && texel.z == 0.0) {"),o.push("              return surf_norm;"),o.push("       }"),o.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),o.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),o.push("      vec2 st0 = dFdx( uv.st );"),o.push("      vec2 st1 = dFdy( uv.st );"),o.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),o.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),o.push("      vec3 N = normalize( surf_norm );"),o.push("      vec3 mapN = texel.xyz * 2.0 - 1.0;"),o.push("      mat3 tsn = mat3( S, T, N );"),o.push("      return normalize( tsn * mapN );"),o.push("}"),o.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),o.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),o.push("}"),o.push("struct IncidentLight {"),o.push("   vec3 color;"),o.push("   vec3 direction;"),o.push("};"),o.push("struct ReflectedLight {"),o.push("   vec3 diffuse;"),o.push("   vec3 specular;"),o.push("};"),o.push("struct Geometry {"),o.push("   vec3 position;"),o.push("   vec3 viewNormal;"),o.push("   vec3 worldNormal;"),o.push("   vec3 viewEyeDir;"),o.push("};"),o.push("struct Material {"),o.push("   vec3  diffuseColor;"),o.push("   float specularRoughness;"),o.push("   vec3  specularColor;"),o.push("   float shine;"),o.push("};"),o.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),o.push("   float r = ggxRoughness + 0.0001;"),o.push("   return (2.0 / (r * r) - 2.0);"),o.push("}"),o.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {"),o.push("   float maxMIPLevelScalar = float( maxMIPLevel );"),o.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );"),o.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );"),o.push("}"),s.reflectionMaps.length>0&&(o.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),o.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),o.push("   vec3 envMapColor = sRGBToLinear(texture(reflectionMap, reflectVec, mipLevel)).rgb;"),o.push("  return envMapColor;"),o.push("}")),o.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),o.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),o.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),o.push("}"),o.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),o.push("   float a2 = ( alpha * alpha );"),o.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),o.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),o.push("   return 1.0 / ( gl * gv );"),o.push("}"),o.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),o.push("   float a2 = ( alpha * alpha );"),o.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),o.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),o.push("   return 0.5 / max( gv + gl, EPSILON );"),o.push("}"),o.push("float D_GGX(const in float alpha, const in float dotNH) {"),o.push("   float a2 = ( alpha * alpha );"),o.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),o.push("   return RECIPROCAL_PI * a2 / ( denom * denom);"),o.push("}"),o.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),o.push("   float alpha = ( roughness * roughness );"),o.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),o.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),o.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),o.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),o.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),o.push("   vec3  F = F_Schlick( specularColor, dotLH );"),o.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),o.push("   float D = D_GGX( alpha, dotNH );"),o.push("   return F * (G * D);"),o.push("}"),o.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),o.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),o.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),o.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),o.push("   vec4 r = roughness * c0 + c1;"),o.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),o.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),o.push("   return specularColor * AB.x + AB.y;"),o.push("}"),(s.lightMaps.length>0||s.reflectionMaps.length>0)&&(o.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),s.lightMaps.length>0&&(o.push("   vec3 irradiance = sRGBToLinear(texture(lightMap, geometry.worldNormal)).rgb;"),o.push("   irradiance *= PI;"),o.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),o.push("   reflectedLight.diffuse +=  irradiance * diffuseBRDFContrib;")),s.reflectionMaps.length>0&&(o.push("   vec3 reflectVec             = reflect(geometry.viewEyeDir, geometry.viewNormal);"),o.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),o.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),o.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),o.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),o.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),o.push("}")),o.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),o.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),o.push("   vec3 irradiance = dotNL * incidentLight.color * PI;"),o.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),o.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),o.push("}"),o.push("out vec4 outColor;"),o.push("void main(void) {"),r){o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;");for(var p=0,d=i.sectionPlanes.length;p<d;p++)o.push("if (sectionPlaneActive"+p+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+p+".xyz, vWorldPosition.xyz - sectionPlanePos"+p+".xyz), 0.0, 1000.0);"),o.push("}");n?(o.push("  if (dist > (0.002 * vClipPosition.w)) {"),o.push("      discard;"),o.push("  }"),o.push("  if (dist > 0.0) { "),o.push("      outColor=vec4(1.0, 0.0, 0.0, 1.0);"),e.logarithmicDepthBufferEnabled&&o.push("  gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("  return;"),o.push("}")):(o.push("  if (dist > 0.0) { "),o.push("      discard;"),o.push("  }")),o.push("}")}o.push("IncidentLight  light;"),o.push("Material       material;"),o.push("Geometry       geometry;"),o.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),o.push("vec3 rgb = (vec3(float(vColor.r) / 255.0, float(vColor.g) / 255.0, float(vColor.b) / 255.0));"),o.push("float opacity = float(vColor.a) / 255.0;"),o.push("vec3  baseColor = rgb;"),o.push("float specularF0 = 1.0;"),o.push("float metallic = float(vMetallicRoughness.r) / 255.0;"),o.push("float roughness = float(vMetallicRoughness.g) / 255.0;"),o.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),o.push("vec4 baseColorTexel = sRGBToLinear(texture(uBaseColorMap, vUV));"),o.push("baseColor *= baseColorTexel.rgb;"),o.push("vec3 metalRoughTexel = texture(uMetallicRoughMap, vUV).rgb;"),o.push("metallic *= metalRoughTexel.b;"),o.push("roughness *= metalRoughTexel.g;"),o.push("vec3 viewNormal = perturbNormal2Arb(vViewPosition.xyz, normalize(vViewNormal), vUV );"),o.push("material.diffuseColor      = baseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),o.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),o.push("material.specularColor     = mix(vec3(dielectricSpecular), baseColor, metallic);"),o.push("geometry.position      = vViewPosition.xyz;"),o.push("geometry.viewNormal    = -normalize(viewNormal);"),o.push("geometry.viewEyeDir    = normalize(vViewPosition.xyz);"),s.lightMaps.length>0&&o.push("geometry.worldNormal   = normalize(vWorldNormal);"),(s.lightMaps.length>0||s.reflectionMaps.length>0)&&o.push("computePBRLightMapping(geometry, material, reflectedLight);");for(var f=0,m=s.lights.length;f<m;f++){var v=s.lights[f];if("ambient"!==v.type){if("dir"===v.type)"view"===v.space?o.push("light.direction =  normalize(lightDir"+f+");"):o.push("light.direction =  normalize((viewMatrix * vec4(lightDir"+f+", 0.0)).xyz);");else if("point"===v.type)"view"===v.space?o.push("light.direction =  normalize(lightPos"+f+" - vViewPosition.xyz);"):o.push("light.direction =  normalize((viewMatrix * vec4(lightPos"+f+", 0.0)).xyz);");else{if("spot"!==v.type)continue;"view"===v.space?o.push("light.direction =  normalize(lightDir"+f+");"):o.push("light.direction =  normalize((viewMatrix * vec4(lightDir"+f+", 0.0)).xyz);")}o.push("light.color =  lightColor"+f+".rgb * lightColor"+f+".a;"),o.push("computePBRLighting(light, geometry, material, reflectedLight);")}}return o.push("vec3 emissiveColor = sRGBToLinear(texture(uEmissiveMap, vUV)).rgb;"),o.push("float aoFactor = texture(uAOMap, vUV).r;"),o.push("vec3 outgoingLight = (lightAmbient.rgb * lightAmbient.a * baseColor * opacity * rgb) + (reflectedLight.diffuse) + (reflectedLight.specular) + emissiveColor;"),o.push("vec4 fragColor;"),this._withSAO?(o.push("   float viewportWidth     = uSAOParams[0];"),o.push("   float viewportHeight    = uSAOParams[1];"),o.push("   float blendCutoff       = uSAOParams[2];"),o.push("   float blendFactor       = uSAOParams[3];"),o.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),o.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),o.push("   fragColor               = vec4(outgoingLight.rgb * ambient * aoFactor, opacity);")):o.push("   fragColor            = vec4(outgoingLight.rgb * aoFactor, opacity);"),t&&o.push("fragColor = linearToGamma(fragColor, gammaFactor);"),o.push("outColor = fragColor;"),e.logarithmicDepthBufferEnabled&&o.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("}"),o}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Ah=q.vec3(),kh=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniform1i(this._uPickInvisible,e.pickInvisible),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var h=e.pickViewMatrix||n.viewMatrix,l=u?De(h,u):h;if(o.uniformMatrix4fv(this._uViewMatrix,!1,l),o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),r.logarithmicDepthBufferEnabled){var c=2/(Math.log(n.project.far+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,c)}var p=r._sectionPlanesState.sectionPlanes.length;if(p>0)for(var d=r._sectionPlanesState.sectionPlanes,f=t.layerIndex*p,m=s.renderFlags,v=0;v<p;v++){var g=this._uSectionPlanes[v],_=m.sectionPlanesActivePerLayer[f+v];if(o.uniform1i(g.active,_?1:0),_){var y=d[v];if(u){var b=Ee(y.dist,y.dir,u,Ah);o.uniform3fv(g.pos,b)}else o.uniform3fv(g.pos,y.pos);o.uniform3fv(g.dir,y.dir)}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),o.drawElements(o.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){this._program.bind()}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles batching pick flat normals vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),i.push("out vec4 vWorldPosition;"),t&&i.push("out vec4 vFlags2;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("      vWorldPosition = worldPosition;"),t&&i.push("      vFlags2 = flags2;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("  }"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Triangles batching pick flat normals fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),s.push("in vec4 vWorldPosition;"),i){s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("  vec3 xTangent = dFdx( vWorldPosition.xyz );"),s.push("  vec3 yTangent = dFdy( vWorldPosition.xyz );"),s.push("  vec3 worldNormal = normalize( cross( xTangent, yTangent ) );"),s.push("  outColor = vec4((worldNormal * 0.5) + 0.5, 1.0);"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Eh=q.vec4(),Fh=q.vec3(),Rh=function(){function e(t,i){w(this,e),this._scene=t,this._withSAO=i,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){var e=this._scene;return[e.gammaOutput,e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}},{key:"drawLayer",value:function(e,t,i){var s=Ze.MAX_TEXTURE_IMAGE_UNITS,r=this._scene,n=r.camera,o=t.model,a=r.canvas.gl,u=t._state,h=t._state.origin,l=u.textureSet;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,h?De(n.viewMatrix,h):n.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix);var c=r._sectionPlanesState.sectionPlanes.length;if(c>0)for(var p=r._sectionPlanesState.sectionPlanes,d=t.layerIndex*c,f=o.renderFlags,m=0;m<c;m++){var v=this._uSectionPlanes[m];if(v){var g=f.sectionPlanesActivePerLayer[d+m];if(a.uniform1i(v.active,g?1:0),g){var _=p[m];if(h){var y=Ee(_.dist,_.dir,h,Fh);a.uniform3fv(v.pos,y)}else a.uniform3fv(v.pos,_.pos);a.uniform3fv(v.dir,_.dir)}}}if(a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._uUVDecodeMatrix&&a.uniformMatrix3fv(this._uUVDecodeMatrix,!1,u.uvDecodeMatrix),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aUV&&this._aUV.bindArrayBuffer(u.uvBuf),this._aColor&&this._aColor.bindArrayBuffer(u.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(u.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(u.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(u.offsetsBuf),l&&l.colorTexture&&(this._program.bindTexture(this._uColorMap,l.colorTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s),this._withSAO){var b=r.sao;if(b.possible){var x=a.drawingBufferWidth,P=a.drawingBufferHeight;Eh[0]=x,Eh[1]=P,Eh[2]=b.blendCutoff,Eh[3]=b.blendFactor,a.uniform4fv(this._uSAOParams,Eh),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++}}u.indicesBuf.bind(),a.drawElements(a.TRIANGLES,u.indicesBuf.numItems,u.indicesBuf.itemType,0),e.drawElements++}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=s.getLocation("uvDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uGammaFactor=s.getLocation("gammaFactor"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];for(var r=i.lights,n=0,o=r.length;n<o;n++)switch(r[n].type){case"dir":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=null,this._uLightDir[n]=s.getLocation("lightDir"+n);break;case"point":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=null,this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n);break;case"spot":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=s.getLocation("lightDir"+n),this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n)}this._uSectionPlanes=[];for(var a=0,u=e._sectionPlanesState.sectionPlanes.length;a<u;a++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+a),pos:s.getLocation("sectionPlanePos"+a),dir:s.getLocation("sectionPlaneDir"+a)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aUV=s.getAttribute("uv"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uColorMap="uColorMap",this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(e){var t=this._scene,i=t.canvas.gl,s=this._program,r=t._lightsState.lights,n=t.camera.project;s.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,n.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(var o=0,a=r.length;o<a;o++){var u=r[o];this._uLightColor[o]&&i.uniform4f(this._uLightColor[o],u.color[0],u.color[1],u.color[2],u.intensity),this._uLightPos[o]&&(i.uniform3fv(this._uLightPos[o],u.pos),this._uLightAttenuation[o]&&i.uniform1f(this._uLightAttenuation[o],u.attenuation)),this._uLightDir[o]&&i.uniform3fv(this._uLightDir[o],u.dir)}if(t.logarithmicDepthBufferEnabled){var h=2/(Math.log(n.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,h)}this._uGammaFactor&&i.uniform1f(this._uGammaFactor,t.gammaFactor)}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles batching color texture vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),i.push("in vec4 color;"),i.push("in vec2 uv;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform mat3 uvDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vViewPosition;"),i.push("out vec4 vColor;"),i.push("out vec2 vUV;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("vViewPosition = viewPosition;"),i.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),i.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e.gammaOutput,i=e._lightsState,s=e._sectionPlanesState,r=s.sectionPlanes.length>0,n=[];if(n.push("#version 300 es"),n.push("// Triangles batching color texture fragment shader"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),e.logarithmicDepthBufferEnabled&&(n.push("in float isPerspective;"),n.push("uniform float logDepthBufFC;"),n.push("in float vFragDepth;")),n.push("uniform sampler2D uColorMap;"),this._withSAO&&(n.push("uniform sampler2D uOcclusionTexture;"),n.push("uniform vec4      uSAOParams;"),n.push("const float       packUpscale = 256. / 255.;"),n.push("const float       unpackDownScale = 255. / 256.;"),n.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),n.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),n.push("float unpackRGBToFloat( const in vec4 v ) {"),n.push("    return dot( v, unPackFactors );"),n.push("}")),n.push("uniform float gammaFactor;"),n.push("vec4 linearToLinear( in vec4 value ) {"),n.push("  return value;"),n.push("}"),n.push("vec4 sRGBToLinear( in vec4 value ) {"),n.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),n.push("}"),n.push("vec4 gammaToLinear( in vec4 value) {"),n.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),n.push("}"),t&&(n.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),n.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),n.push("}")),r){n.push("in vec4 vWorldPosition;"),n.push("in vec4 vFlags2;");for(var o=0,a=s.sectionPlanes.length;o<a;o++)n.push("uniform bool sectionPlaneActive"+o+";"),n.push("uniform vec3 sectionPlanePos"+o+";"),n.push("uniform vec3 sectionPlaneDir"+o+";")}n.push("uniform mat4 viewMatrix;"),n.push("uniform vec4 lightAmbient;");for(var u=0,h=i.lights.length;u<h;u++){var l=i.lights[u];"ambient"!==l.type&&(n.push("uniform vec4 lightColor"+u+";"),"dir"===l.type&&n.push("uniform vec3 lightDir"+u+";"),"point"===l.type&&n.push("uniform vec3 lightPos"+u+";"),"spot"===l.type&&(n.push("uniform vec3 lightPos"+u+";"),n.push("uniform vec3 lightDir"+u+";")))}if(n.push("in vec4 vViewPosition;"),n.push("in vec4 vColor;"),n.push("in vec2 vUV;"),n.push("out vec4 outColor;"),n.push("void main(void) {"),r){n.push("  bool clippable = (float(vFlags2.x) > 0.0);"),n.push("  if (clippable) {"),n.push("  float dist = 0.0;");for(var c=0,p=s.sectionPlanes.length;c<p;c++)n.push("if (sectionPlaneActive"+c+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+c+".xyz, vWorldPosition.xyz - sectionPlanePos"+c+".xyz), 0.0, 1000.0);"),n.push("}");n.push("  if (dist > 0.0) { "),n.push("      discard;"),n.push("  }"),n.push("}")}n.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),n.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),n.push("float lambertian = 1.0;"),n.push("vec3 xTangent = dFdx( vViewPosition.xyz );"),n.push("vec3 yTangent = dFdy( vViewPosition.xyz );"),n.push("vec3 viewNormal = normalize( cross( xTangent, yTangent ) );");for(var d=0,f=i.lights.length;d<f;d++){var m=i.lights[d];if("ambient"!==m.type){if("dir"===m.type)"view"===m.space?n.push("viewLightDir = normalize(lightDir"+d+");"):n.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+d+", 0.0)).xyz);");else if("point"===m.type)"view"===m.space?n.push("viewLightDir = -normalize(lightPos"+d+" - viewPosition.xyz);"):n.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+d+", 0.0)).xyz);");else{if("spot"!==m.type)continue;"view"===m.space?n.push("viewLightDir = normalize(lightDir"+d+");"):n.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+d+", 0.0)).xyz);")}n.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),n.push("reflectedColor += lambertian * (lightColor"+d+".rgb * lightColor"+d+".a);")}}return n.push("vec4 color =  vec4((lightAmbient.rgb * lightAmbient.a * vColor.rgb) + (reflectedColor * vColor.rgb), vColor.a);"),t?n.push("vec4 colorTexel = color * sRGBToLinear(texture(uColorMap, vUV));"):n.push("vec4 colorTexel = color * texture(uColorMap, vUV);"),n.push("float opacity = color.a;"),this._withSAO?(n.push("   float viewportWidth     = uSAOParams[0];"),n.push("   float viewportHeight    = uSAOParams[1];"),n.push("   float blendCutoff       = uSAOParams[2];"),n.push("   float blendFactor       = uSAOParams[3];"),n.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),n.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),n.push("   outColor                = vec4(colorTexel.rgb * ambient, opacity);")):n.push("   outColor                = vec4(colorTexel.rgb, opacity);"),t&&n.push("outColor = linearToGamma(outColor, gammaFactor);"),e.logarithmicDepthBufferEnabled&&n.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("}"),n}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Sh=function(){function e(t){w(this,e),this._scene=t}return I(e,[{key:"_compile",value:function(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._colorRendererWithSAO&&!this._colorRendererWithSAO.getValid()&&(this._colorRendererWithSAO.destroy(),this._colorRendererWithSAO=null),this._flatColorRenderer&&!this._flatColorRenderer.getValid()&&(this._flatColorRenderer.destroy(),this._flatColorRenderer=null),this._flatColorRendererWithSAO&&!this._flatColorRendererWithSAO.getValid()&&(this._flatColorRendererWithSAO.destroy(),this._flatColorRendererWithSAO=null),this._colorTextureRenderer&&!this._colorTextureRenderer.getValid()&&(this._colorTextureRenderer.destroy(),this._colorTextureRenderer=null),this._colorTextureRendererWithSAO&&!this._colorTextureRendererWithSAO.getValid()&&(this._colorTextureRendererWithSAO.destroy(),this._colorTextureRendererWithSAO=null),this._pbrRenderer&&!this._pbrRenderer.getValid()&&(this._pbrRenderer.destroy(),this._pbrRenderer=null),this._pbrRendererWithSAO&&!this._pbrRendererWithSAO.getValid()&&(this._pbrRendererWithSAO.destroy(),this._pbrRendererWithSAO=null),this._depthRenderer&&!this._depthRenderer.getValid()&&(this._depthRenderer.destroy(),this._depthRenderer=null),this._normalsRenderer&&!this._normalsRenderer.getValid()&&(this._normalsRenderer.destroy(),this._normalsRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._edgesRenderer&&!this._edgesRenderer.getValid()&&(this._edgesRenderer.destroy(),this._edgesRenderer=null),this._edgesColorRenderer&&!this._edgesColorRenderer.getValid()&&(this._edgesColorRenderer.destroy(),this._edgesColorRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._pickNormalsRenderer&&!1===this._pickNormalsRenderer.getValid()&&(this._pickNormalsRenderer.destroy(),this._pickNormalsRenderer=null),this._pickNormalsFlatRenderer&&!1===this._pickNormalsFlatRenderer.getValid()&&(this._pickNormalsFlatRenderer.destroy(),this._pickNormalsFlatRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null),this._shadowRenderer&&!this._shadowRenderer.getValid()&&(this._shadowRenderer.destroy(),this._shadowRenderer=null)}},{key:"colorRenderer",get:function(){return this._colorRenderer||(this._colorRenderer=new eh(this._scene,!1)),this._colorRenderer}},{key:"colorRendererWithSAO",get:function(){return this._colorRendererWithSAO||(this._colorRendererWithSAO=new eh(this._scene,!0)),this._colorRendererWithSAO}},{key:"flatColorRenderer",get:function(){return this._flatColorRenderer||(this._flatColorRenderer=new sh(this._scene,!1)),this._flatColorRenderer}},{key:"flatColorRendererWithSAO",get:function(){return this._flatColorRendererWithSAO||(this._flatColorRendererWithSAO=new sh(this._scene,!0)),this._flatColorRendererWithSAO}},{key:"colorTextureRenderer",get:function(){return this._colorTextureRenderer||(this._colorTextureRenderer=new Rh(this._scene,!1)),this._colorTextureRenderer}},{key:"colorTextureRendererWithSAO",get:function(){return this._colorTextureRendererWithSAO||(this._colorTextureRendererWithSAO=new Rh(this._scene,!0)),this._colorTextureRendererWithSAO}},{key:"pbrRenderer",get:function(){return this._pbrRenderer||(this._pbrRenderer=new Dh(this._scene,!1)),this._pbrRenderer}},{key:"pbrRendererWithSAO",get:function(){return this._pbrRendererWithSAO||(this._pbrRendererWithSAO=new Dh(this._scene,!0)),this._pbrRendererWithSAO}},{key:"silhouetteRenderer",get:function(){return this._silhouetteRenderer||(this._silhouetteRenderer=new oh(this._scene)),this._silhouetteRenderer}},{key:"depthRenderer",get:function(){return this._depthRenderer||(this._depthRenderer=new xh(this._scene)),this._depthRenderer}},{key:"normalsRenderer",get:function(){return this._normalsRenderer||(this._normalsRenderer=new Th(this._scene)),this._normalsRenderer}},{key:"edgesRenderer",get:function(){return this._edgesRenderer||(this._edgesRenderer=new hh(this._scene)),this._edgesRenderer}},{key:"edgesColorRenderer",get:function(){return this._edgesColorRenderer||(this._edgesColorRenderer=new ch(this._scene)),this._edgesColorRenderer}},{key:"pickMeshRenderer",get:function(){return this._pickMeshRenderer||(this._pickMeshRenderer=new dh(this._scene)),this._pickMeshRenderer}},{key:"pickNormalsRenderer",get:function(){return this._pickNormalsRenderer||(this._pickNormalsRenderer=new gh(this._scene)),this._pickNormalsRenderer}},{key:"pickNormalsFlatRenderer",get:function(){return this._pickNormalsFlatRenderer||(this._pickNormalsFlatRenderer=new kh(this._scene)),this._pickNormalsFlatRenderer}},{key:"pickDepthRenderer",get:function(){return this._pickDepthRenderer||(this._pickDepthRenderer=new mh(this._scene)),this._pickDepthRenderer}},{key:"occlusionRenderer",get:function(){return this._occlusionRenderer||(this._occlusionRenderer=new yh(this._scene)),this._occlusionRenderer}},{key:"shadowRenderer",get:function(){return this._shadowRenderer||(this._shadowRenderer=new Mh(this._scene)),this._shadowRenderer}},{key:"_destroy",value:function(){this._colorRenderer&&this._colorRenderer.destroy(),this._colorRendererWithSAO&&this._colorRendererWithSAO.destroy(),this._flatColorRenderer&&this._flatColorRenderer.destroy(),this._flatColorRendererWithSAO&&this._flatColorRendererWithSAO.destroy(),this._colorTextureRenderer&&this._colorTextureRenderer.destroy(),this._colorTextureRendererWithSAO&&this._colorTextureRendererWithSAO.destroy(),this._pbrRenderer&&this._pbrRenderer.destroy(),this._pbrRendererWithSAO&&this._pbrRendererWithSAO.destroy(),this._depthRenderer&&this._depthRenderer.destroy(),this._normalsRenderer&&this._normalsRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._edgesRenderer&&this._edgesRenderer.destroy(),this._edgesColorRenderer&&this._edgesColorRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._pickNormalsRenderer&&this._pickNormalsRenderer.destroy(),this._pickNormalsFlatRenderer&&this._pickNormalsFlatRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy(),this._shadowRenderer&&this._shadowRenderer.destroy()}}]),e}(),Oh={};var Bh=I((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e6;w(this,e),t>5e6&&(t=5e6),this.maxVerts=t,this.maxIndices=3*t,this.positions=[],this.colors=[],this.uv=[],this.metallicRoughness=[],this.normals=[],this.pickColors=[],this.flags=[],this.flags2=[],this.offsets=[],this.indices=[],this.edgeIndices=[]})),Lh=q.mat4(),Nh=q.mat4();function jh(e,t,i){for(var s=e.length,r=new Uint16Array(s),n=t[0],o=t[1],a=t[2],u=t[3]-n,h=t[4]-o,l=t[5]-a,c=65525,p=c/u,d=c/h,f=c/l,m=function(e){return e>=0?e:0},v=0;v<s;v+=3)r[v+0]=Math.floor(m(e[v+0]-n)*p),r[v+1]=Math.floor(m(e[v+1]-o)*d),r[v+2]=Math.floor(m(e[v+2]-a)*f);return q.identityMat4(Lh),q.translationMat4v(t,Lh),q.identityMat4(Nh),q.scalingMat4v([u/c,h/c,l/c],Nh),q.mulMat4(Lh,Nh,i),r}function Gh(e,t,i){var s=e[0]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2])),r=e[1]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2]));if(e[2]<0){var n,o;n=(1-Math.abs(r))*(s>=0?1:-1),o=(1-Math.abs(s))*(r>=0?1:-1),s=n,r=o}return new Int8Array([Math[t](127.5*s+(s<0?-1:0)),Math[i](127.5*r+(r<0?-1:0))])}function Hh(e,t,i,s){var r=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),n=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){var o=(1-Math.abs(n))*(r>=0?1:-1),a=(1-Math.abs(r))*(n>=0?1:-1);r=o,n=a}return new Int8Array([Math[i](127.5*r+(r<0?-1:0)),Math[s](127.5*n+(n<0?-1:0))])}function Uh(e){var t=e[0],i=e[1];t/=t<0?127:128,i/=i<0?127:128;var s=1-Math.abs(t)-Math.abs(i);s<0&&(t=(1-Math.abs(i))*(t>=0?1:-1),i=(1-Math.abs(t))*(i>=0?1:-1));var r=Math.sqrt(t*t+i*i+s*s);return[t/r,i/r,s/r]}function Vh(e,t,i){return e[t]*i[0]+e[t+1]*i[1]+e[t+2]*i[2]}var zh=q.mat4(),Wh=q.mat4(),Xh=q.vec4([0,0,0,1]),Yh=q.vec4([0,0,0,1]),Kh=q.vec4([0,0,0,1]),Jh=q.OBB3(),Zh=q.vec3(),Qh=q.vec3(),qh=q.vec3(),$h=q.vec3(),el=q.vec3(),tl=q.vec3(),il=q.vec3(),sl=function(){function e(t){var i,s,r;w(this,e),this.model=t.model,this.sortId="TrianglesBatchingLayer"+(t.solid?"-solid":"-surface")+(t.autoNormals?"-autonormals":"-normals")+(t.textureSet&&t.textureSet.colorTexture?"-colorTexture":"")+(t.textureSet&&t.textureSet.metallicRoughnessTexture?"-metallicRoughnessTexture":""),this.layerIndex=t.layerIndex,this._batchingRenderers=(i=t.model.scene,s=i.id,(r=Oh[s])||(r=new Sh(i),Oh[s]=r,r._compile(),i.on("compile",(function(){r._compile()})),i.on("destroyed",(function(){delete Oh[s],r._destroy()}))),r),this._buffer=new Bh(t.maxGeometryBatchSize),this._scratchMemory=t.scratchMemory,this._state=new ti({origin:q.vec3(),positionsBuf:null,offsetsBuf:null,normalsBuf:null,colorsBuf:null,uvBuf:null,metallicRoughnessBuf:null,flagsBuf:null,flags2Buf:null,indicesBuf:null,edgeIndicesBuf:null,positionsDecodeMatrix:q.mat4(),uvDecodeMatrix:null,textureSet:t.textureSet,pbrSupported:!1}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numSelectedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._modelAABB=q.collapseAABB3(),this._portions=[],this._numVerts=0,this._finalized=!1,t.positionsDecodeMatrix?(this._state.positionsDecodeMatrix.set(t.positionsDecodeMatrix),this._preCompressedPositionsExpected=!0):this._preCompressedPositionsExpected=!1,t.uvDecodeMatrix?(this._state.uvDecodeMatrix=q.mat3(t.uvDecodeMatrix),this._preCompressedNormalsExpected=!0):this._preCompressedNormalsExpected=!1,t.origin&&this._state.origin.set(t.origin),this.aabb=q.collapseAABB3(),this.solid=!!t.solid}return I(e,[{key:"canCreatePortion",value:function(e,t){if(this._finalized)throw"Already finalized";return this._buffer.positions.length+e<3*this._buffer.maxVerts&&this._buffer.indices.length+t<this._buffer.maxIndices}},{key:"createPortion",value:function(e){if(this._finalized)throw"Already finalized";var t,i=e.positions,s=e.positionsCompressed,r=e.normals,n=e.normalsCompressed,o=e.uv,a=e.uvCompressed,u=e.colors,h=e.colorsCompressed,l=e.indices,c=e.edgeIndices,p=e.color,d=e.metallic,f=e.roughness,m=e.opacity,v=e.meshMatrix,g=e.worldMatrix,_=e.worldAABB,y=e.pickColor,b=this.model.scene,x=this._buffer,P=x.positions.length/3;if(this._preCompressedPositionsExpected){if(!s)throw"positionsCompressed expected";t=s.length/3;for(var T=0,w=s.length;T<w;T++)x.positions.push(s[T]);var M=ui.getPositionsBounds(s),I=ui.decompressPosition(M.min,this._state.positionsDecodeMatrix,[]),C=ui.decompressPosition(M.max,this._state.positionsDecodeMatrix,[]);_[0]=I[0],_[1]=I[1],_[2]=I[2],_[3]=C[0],_[4]=C[1],_[5]=C[2],g&&(q.AABB3ToOBB3(_,Jh),q.transformOBB3(g,Jh),q.OBB3ToAABB3(Jh,_))}else{if(!i)throw"positions expected";t=i.length/3;for(var D=i.length,A=x.positions.length,k=0,E=i.length;k<E;k++)x.positions.push(i[k]);if(v)for(var F=A,R=A+D;F<R;F+=3)Xh[0]=x.positions[F+0],Xh[1]=x.positions[F+1],Xh[2]=x.positions[F+2],q.transformPoint4(v,Xh,Yh),x.positions[F+0]=Yh[0],x.positions[F+1]=Yh[1],x.positions[F+2]=Yh[2],q.expandAABB3Point3(this._modelAABB,Yh),g?(q.transformPoint4(g,Yh,Kh),q.expandAABB3Point3(_,Kh)):q.expandAABB3Point3(_,Yh);else for(var S=A,O=A+D;S<O;S+=3)Xh[0]=x.positions[S+0],Xh[1]=x.positions[S+1],Xh[2]=x.positions[S+2],q.expandAABB3Point3(this._modelAABB,Xh),g?(q.transformPoint4(g,Xh,Yh),q.expandAABB3Point3(_,Yh)):q.expandAABB3Point3(_,Xh)}if(this._state.origin){var B=this._state.origin;_[0]+=B[0],_[1]+=B[1],_[2]+=B[2],_[3]+=B[0],_[4]+=B[1],_[5]+=B[2]}if(q.expandAABB3(this.aabb,_),n&&n.length>0)for(var L=0,N=n.length;L<N;L++)x.normals.push(n[L]);else if(r&&r.length>0){var j=zh;v?q.inverseMat4(q.transposeMat4(v,Wh),j):q.identityMat4(j,j),function(e,t,i,s,r){function n(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}var o,a,u,h,l,c=new Float32Array([0,0,0,0]),p=new Float32Array([0,0,0,0]);for(l=0;l<i;l+=3)c[0]=t[l],c[1]=t[l+1],c[2]=t[l+2],q.transformVec3(e,c,p),q.normalizeVec3(p,p),a=o=Gh(p,"floor","floor"),u=h=n(p,Uh(o)),(u=n(p,Uh(o=Gh(p,"ceil","floor"))))>h&&(a=o,h=u),(u=n(p,Uh(o=Gh(p,"floor","ceil"))))>h&&(a=o,h=u),(u=n(p,Uh(o=Gh(p,"ceil","ceil"))))>h&&(a=o,h=u),s[r+l+0]=a[0],s[r+l+1]=a[1],s[r+l+2]=0}(j,r,r.length,x.normals,x.normals.length)}if(u)for(var G=0,H=u.length;G<H;G+=3)x.colors.push(255*u[G]),x.colors.push(255*u[G+1]),x.colors.push(255*u[G+2]),x.colors.push(255);else if(h)for(var U=0,V=u.length;U<V;U+=3)x.colors.push(u[U]),x.colors.push(u[U+1]),x.colors.push(u[U+2]),x.colors.push(255);else if(p)for(var z=p[0],W=p[1],X=p[2],Y=m,K=0;K<t;K++)x.colors.push(z),x.colors.push(W),x.colors.push(X),x.colors.push(Y);for(var J=null!=d?d:0,Z=null!=f?f:255,Q=0;Q<t;Q++)x.metallicRoughness.push(J),x.metallicRoughness.push(Z);if(o&&o.length>0)for(var $=0,ee=o.length;$<ee;$++)x.uv.push(o[$]);else if(a&&a.length>0)for(var te=0,ie=a.length;te<ie;te++)x.uv.push(a[te]);if(l)for(var se=0,re=l.length;se<re;se++)x.indices.push(P+l[se]);if(c)for(var ne=0,oe=c.length;ne<oe;ne++)x.edgeIndices.push(P+c[ne]);for(var ae=x.pickColors.length,ue=ae,he=ae+4*t;ue<he;ue+=4)x.pickColors.push(y[0]),x.pickColors.push(y[1]),x.pickColors.push(y[2]),x.pickColors.push(y[3]);if(b.entityOffsetsEnabled)for(var le=0;le<t;le++)x.offsets.push(0),x.offsets.push(0),x.offsets.push(0);var ce=this._portions.length,pe={vertsBaseIndex:P,numVerts:t};return b.pickSurfacePrecisionEnabled&&(l&&(pe.indices=l),b.entityOffsetsEnabled&&(pe.offset=new Float32Array(3))),this._portions.push(pe),this._numPortions++,this.model.numPortions++,this._numVerts+=pe.numVerts,ce}},{key:"finalize",value:function(){if(this._finalized)this.model.error("Already finalized");else{var e=this._state,t=this.model.scene.canvas.gl,i=this._buffer;if(i.positions.length>0){var s=this._preCompressedPositionsExpected?new Uint16Array(i.positions):jh(i.positions,this._modelAABB,e.positionsDecodeMatrix);if(e.positionsBuf=new lt(t,t.ARRAY_BUFFER,s,s.length,3,t.STATIC_DRAW),this.model.scene.pickSurfacePrecisionEnabled)for(var r=0,n=this._portions.length;r<n;r++){var o=this._portions[r],a=3*o.vertsBaseIndex,u=a+3*o.numVerts;o.quantizedPositions=s.slice(a,u)}}if(i.normals.length>0){var h=new Int8Array(i.normals);e.normalsBuf=new lt(t,t.ARRAY_BUFFER,h,i.normals.length,3,t.STATIC_DRAW,!0)}if(i.colors.length>0){var l=new Uint8Array(i.colors);e.colorsBuf=new lt(t,t.ARRAY_BUFFER,l,i.colors.length,4,t.DYNAMIC_DRAW,!1)}if(i.uv.length>0)if(e.uvDecodeMatrix){e.uvBuf=new lt(t,t.ARRAY_BUFFER,i.uv,i.uv.length,2,t.STATIC_DRAW,!1)}else{var c=ui.getUVBounds(i.uv),p=ui.compressUVs(i.uv,c.min,c.max),d=p.quantized;e.uvDecodeMatrix=q.mat3(p.decodeMatrix),e.uvBuf=new lt(t,t.ARRAY_BUFFER,d,d.length,2,t.STATIC_DRAW,!1)}if(i.metallicRoughness.length>0){var f=new Uint8Array(i.metallicRoughness);e.metallicRoughnessBuf=new lt(t,t.ARRAY_BUFFER,f,i.metallicRoughness.length,2,t.STATIC_DRAW,!1)}if(i.positions.length>0){var m=i.positions.length/3*4,v=new Uint8Array(m),g=new Uint8Array(m);e.flagsBuf=new lt(t,t.ARRAY_BUFFER,v,v.length,4,t.DYNAMIC_DRAW,!1),e.flags2Buf=new lt(t,t.ARRAY_BUFFER,g,g.length,4,t.DYNAMIC_DRAW,!0)}if(i.pickColors.length>0){var _=new Uint8Array(i.pickColors);e.pickColorsBuf=new lt(t,t.ARRAY_BUFFER,_,i.pickColors.length,4,t.STATIC_DRAW,!1)}if(this.model.scene.entityOffsetsEnabled&&i.offsets.length>0){var y=new Float32Array(i.offsets);e.offsetsBuf=new lt(t,t.ARRAY_BUFFER,y,i.offsets.length,3,t.DYNAMIC_DRAW)}if(i.indices.length>0){var b=new Uint32Array(i.indices);e.indicesBuf=new lt(t,t.ELEMENT_ARRAY_BUFFER,b,i.indices.length,1,t.STATIC_DRAW)}if(i.edgeIndices.length>0){var x=new Uint32Array(i.edgeIndices);e.edgeIndicesBuf=new lt(t,t.ELEMENT_ARRAY_BUFFER,x,i.edgeIndices.length,1,t.STATIC_DRAW)}this._state.pbrSupported=!!(e.metallicRoughnessBuf&&e.uvBuf&&e.normalsBuf&&e.textureSet&&e.textureSet.colorTexture&&e.textureSet.metallicRoughnessTexture),this._state.colorTextureSupported=!!e.uvBuf&&!!e.textureSet&&!!e.textureSet.colorTexture,this._buffer=null,this._finalized=!0}}},{key:"isEmpty",value:function(){return!this._state.indicesBuf}},{key:"initFlags",value:function(e,t,i){t&me&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&xe&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&be&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&Pe&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&_e&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&Te&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&ge&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&ve&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),i&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++);this._setFlags(e,t,i,true),this._setFlags2(e,t,true)}},{key:"flushInitFlags",value:function(){this._setDeferredFlags(),this._setDeferredFlags2()}},{key:"setVisible",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&me?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,i)}},{key:"setHighlighted",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&xe?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,i)}},{key:"setXRayed",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&be?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,i)}},{key:"setSelected",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Pe?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,i)}},{key:"setEdges",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Te?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,i)}},{key:"setClippable",value:function(e,t){if(!this._finalized)throw"Not finalized";t&_e?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}},{key:"setCulled",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&ve?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,i)}},{key:"setCollidable",value:function(e,t){if(!this._finalized)throw"Not finalized"}},{key:"setPickable",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&ge?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(e,t,i)}},{key:"setColor",value:function(e,t){if(!this._finalized)throw"Not finalized";for(var i=e,s=this._portions[i],r=4*s.vertsBaseIndex,n=4*s.numVerts,o=this._scratchMemory.getUInt8Array(n),a=t[0],u=t[1],h=t[2],l=t[3],c=0;c<n;c+=4)o[c+0]=a,o[c+1]=u,o[c+2]=h,o[c+3]=l;this._state.colorsBuf&&this._state.colorsBuf.setData(o,r,n)}},{key:"setTransparent",value:function(e,t,i){i?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,i)}},{key:"_setFlags",value:function(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!this._finalized)throw"Not finalized";var r,n,o=e,a=this._portions[o],u=a.vertsBaseIndex,h=a.numVerts,l=4*u,c=4*h,p=!!(t&me),d=!!(t&be),f=!!(t&xe),m=!!(t&Pe),v=!!(t&Te),g=!!(t&ge),_=!!(t&ve);r=!p||_||d||f&&!this.model.scene.highlightMaterial.glowThrough||m&&!this.model.scene.selectedMaterial.glowThrough?Gu:i?Uu:Hu,n=!p||_?Gu:m?zu:f?Vu:d?Wu:Gu;var y=0;y=!p||_?Gu:m?Ju:f?Ku:d?Zu:v?i?Yu:Xu:Gu;var b=p&&!_&&g?Qu:Gu;if(s){this._deferredFlagValues||(this._deferredFlagValues=new Uint8Array(4*this._numVerts));for(var x=l,P=l+c;x<P;x+=4)this._deferredFlagValues[x+0]=r,this._deferredFlagValues[x+1]=n,this._deferredFlagValues[x+2]=y,this._deferredFlagValues[x+3]=b}else if(this._state.flagsBuf){for(var T=this._scratchMemory.getUInt8Array(c),w=0;w<c;w+=4)T[w+0]=r,T[w+1]=n,T[w+2]=y,T[w+3]=b;this._state.flagsBuf.setData(T,l,c)}}},{key:"_setDeferredFlags",value:function(){this._deferredFlagValues&&(this._state.flagsBuf.setData(this._deferredFlagValues),this._deferredFlagValues=null)}},{key:"_setFlags2",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._finalized)throw"Not finalized";var s=e,r=this._portions[s],n=r.vertsBaseIndex,o=r.numVerts,a=4*n,u=4*o,h=t&_e?255:0;if(i){this._setDeferredFlag2Values||(this._setDeferredFlag2Values=new Uint8Array(4*this._numVerts));for(var l=a,c=a+u;l<c;l+=4)this._setDeferredFlag2Values[l]=h}else if(this._state.flags2Buf){for(var p=this._scratchMemory.getUInt8Array(u),d=0;d<u;d+=4)p[d+0]=h;this._state.flags2Buf.setData(p,a,u)}}},{key:"_setDeferredFlags2",value:function(){this._setDeferredFlag2Values&&(this._state.flags2Buf.setData(this._setDeferredFlag2Values),this._setDeferredFlag2Values=null)}},{key:"setOffset",value:function(e,t){if(!this._finalized)throw"Not finalized";if(this.model.scene.entityOffsetsEnabled){for(var i=e,s=this._portions[i],r=3*s.vertsBaseIndex,n=3*s.numVerts,o=this._scratchMemory.getFloat32Array(n),a=t[0],u=t[1],h=t[2],l=0;l<n;l+=3)o[l+0]=a,o[l+1]=u,o[l+2]=h;this._state.offsetsBuf&&this._state.offsetsBuf.setData(o,r,n),this.model.scene.pickSurfacePrecisionEnabled&&(s.offset[0]=t[0],s.offset[1]=t[1],s.offset[2]=t[2])}else this.model.error("Entity#offset not enabled for this Viewer")}},{key:"drawColorOpaque",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),t.withSAO&&this.model.saoEnabled?t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._batchingRenderers.pbrRendererWithSAO&&this._batchingRenderers.pbrRendererWithSAO.drawLayer(t,this,Hu):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._batchingRenderers.colorTextureRendererWithSAO&&this._batchingRenderers.colorTextureRendererWithSAO.drawLayer(t,this,Hu):this._state.normalsBuf?this._batchingRenderers.colorRendererWithSAO&&this._batchingRenderers.colorRendererWithSAO.drawLayer(t,this,Hu):this._batchingRenderers.flatColorRendererWithSAO&&this._batchingRenderers.flatColorRendererWithSAO.drawLayer(t,this,Hu):t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._batchingRenderers.pbrRenderer&&this._batchingRenderers.pbrRenderer.drawLayer(t,this,Hu):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._batchingRenderers.colorTextureRenderer&&this._batchingRenderers.colorTextureRenderer.drawLayer(t,this,Hu):this._state.normalsBuf?this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(t,this,Hu):this._batchingRenderers.flatColorRenderer&&this._batchingRenderers.flatColorRenderer.drawLayer(t,this,Hu))}},{key:"_updateBackfaceCull",value:function(e,t){var i=this.model.backfaces||!this.solid||e.sectioned;if(t.backfaces!==i){var s=t.gl;i?s.disable(s.CULL_FACE):s.enable(s.CULL_FACE),t.backfaces=i}}},{key:"drawColorTransparent",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._batchingRenderers.pbrRenderer&&this._batchingRenderers.pbrRenderer.drawLayer(t,this,Uu):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._batchingRenderers.colorTextureRenderer&&this._batchingRenderers.colorTextureRenderer.drawLayer(t,this,Uu):this._state.normalsBuf?this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(t,this,Uu):this._batchingRenderers.flatColorRenderer&&this._batchingRenderers.flatColorRenderer.drawLayer(t,this,Uu))}},{key:"drawDepth",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.depthRenderer&&this._batchingRenderers.depthRenderer.drawLayer(t,this,Hu))}},{key:"drawNormals",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.normalsRenderer&&this._batchingRenderers.normalsRenderer.drawLayer(t,this,Hu))}},{key:"drawSilhouetteXRayed",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,Wu))}},{key:"drawSilhouetteHighlighted",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,Vu))}},{key:"drawSilhouetteSelected",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,zu))}},{key:"drawEdgesColorOpaque",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&this._batchingRenderers.edgesColorRenderer&&this._batchingRenderers.edgesColorRenderer.drawLayer(t,this,Xu)}},{key:"drawEdgesColorTransparent",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&0!==this._numTransparentLayerPortions&&this._batchingRenderers.edgesColorRenderer&&this._batchingRenderers.edgesColorRenderer.drawLayer(t,this,Yu)}},{key:"drawEdgesHighlighted",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._batchingRenderers.edgesRenderer&&this._batchingRenderers.edgesRenderer.drawLayer(t,this,Ku)}},{key:"drawEdgesSelected",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._batchingRenderers.edgesRenderer&&this._batchingRenderers.edgesRenderer.drawLayer(t,this,Ju)}},{key:"drawEdgesXRayed",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._batchingRenderers.edgesRenderer&&this._batchingRenderers.edgesRenderer.drawLayer(t,this,Zu)}},{key:"drawOcclusion",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.occlusionRenderer&&this._batchingRenderers.occlusionRenderer.drawLayer(t,this,Hu))}},{key:"drawShadow",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.shadowRenderer&&this._batchingRenderers.shadowRenderer.drawLayer(t,this,Hu))}},{key:"drawPickMesh",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.pickMeshRenderer&&this._batchingRenderers.pickMeshRenderer.drawLayer(t,this,Qu))}},{key:"drawPickDepths",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.pickDepthRenderer&&this._batchingRenderers.pickDepthRenderer.drawLayer(t,this,Qu))}},{key:"drawPickNormals",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.pickNormalsFlatRenderer&&this._batchingRenderers.pickNormalsFlatRenderer.drawLayer(t,this,Qu))}},{key:"precisionRayPickSurface",value:function(e,t,i,s,r){if(!this.model.scene.pickSurfacePrecisionEnabled)return!1;var n=this._state,o=this._portions[e];if(!o)return this.model.error("portion not found: "+e),!1;var a=o.quantizedPositions,u=o.indices,h=n.origin,l=o.offset,c=Zh,p=Qh;c.set(h?q.subVec3(t,h,qh):t),p.set(i),l&&q.subVec3(c,l),q.transformRay(this.model.worldNormalMatrix,c,p,c,p);for(var d=$h,f=el,m=tl,v=!1,g=0,_=il,y=0,b=u.length;y<b;y+=3){var x=3*u[y],P=3*u[y+1],T=3*u[y+2];if(d[0]=a[x],d[1]=a[x+1],d[2]=a[x+2],f[0]=a[P],f[1]=a[P+1],f[2]=a[P+2],m[0]=a[T],m[1]=a[T+1],m[2]=a[T+2],q.decompressPosition(d,n.positionsDecodeMatrix),q.decompressPosition(f,n.positionsDecodeMatrix),q.decompressPosition(m,n.positionsDecodeMatrix),q.rayTriangleIntersect(c,p,d,f,m,_)){q.transformPoint3(this.model.worldMatrix,_,_),l&&q.addVec3(_,l),h&&q.addVec3(_,h);var w=Math.abs(q.lenVec3(q.subVec3(_,t,[])));(!v||w>g)&&(g=w,s.set(_),r&&q.triangleNormal(d,f,m,r),v=!0)}}return v&&r&&(q.transformVec3(this.model.worldNormalMatrix,r,r),q.normalizeVec3(r)),v}},{key:"destroy",value:function(){var e=this._state;e.positionsBuf&&(e.positionsBuf.destroy(),e.positionsBuf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.normalsBuf&&(e.normalsBuf.destroy(),e.normalsBuf=null),e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.metallicRoughnessBuf&&(e.metallicRoughnessBuf.destroy(),e.metallicRoughnessBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.pickColorsBuf&&(e.pickColorsBuf.destroy(),e.pickColorsBuf=null),e.indicesBuf&&(e.indicesBuf.destroy(),e.indicessBuf=null),e.edgeIndicesBuf&&(e.edgeIndicesBuf.destroy(),e.edgeIndicessBuf=null),e.destroy()}}]),e}(),rl=q.vec4(),nl=q.vec3(),ol=function(){function e(t,i){w(this,e),this._scene=t,this._withSAO=i,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){var e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.geometry,h=t._state.origin;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,h?De(n.viewMatrix,h):n.viewMatrix),o.uniformMatrix4fv(this._uViewNormalMatrix,!1,n.viewNormalMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.uniformMatrix4fv(this._uWorldNormalMatrix,!1,s.worldNormalMatrix);var l=r._sectionPlanesState.sectionPlanes.length;if(l>0)for(var c=r._sectionPlanesState.sectionPlanes,p=t.layerIndex*l,d=s.renderFlags,f=0;f<l;f++){var m=this._uSectionPlanes[f];if(m){var v=d.sectionPlanesActivePerLayer[p+f];if(o.uniform1i(m.active,v?1:0),v){var g=c[f];if(h){var _=Ee(g.dist,g.dir,h,nl);o.uniform3fv(m.pos,_)}else o.uniform3fv(m.pos,g.pos);o.uniform3fv(m.dir,g.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aModelNormalMatrixCol0.bindArrayBuffer(a.modelNormalMatrixCol0Buf),this._aModelNormalMatrixCol1.bindArrayBuffer(a.modelNormalMatrixCol1Buf),this._aModelNormalMatrixCol2.bindArrayBuffer(a.modelNormalMatrixCol2Buf),o.vertexAttribDivisor(this._aModelNormalMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelNormalMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelNormalMatrixCol2.location,1),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aNormal.bindArrayBuffer(u.normalsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),o.vertexAttribDivisor(this._aColor.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),u.indicesBuf.bind(),o.drawElementsInstanced(o.TRIANGLES,u.indicesBuf.numItems,u.indicesBuf.itemType,0,a.numInstances),e.drawElements++,o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aModelNormalMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelNormalMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelNormalMatrixCol2.location,0),o.vertexAttribDivisor(this._aColor.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];for(var r=i.lights,n=0,o=r.length;n<o;n++)switch(r[n].type){case"dir":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=null,this._uLightDir[n]=s.getLocation("lightDir"+n);break;case"point":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=null,this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n);break;case"spot":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=s.getLocation("lightDir"+n),this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n)}this._uSectionPlanes=[];for(var a=0,u=e._sectionPlanesState.sectionPlanes.length;a<u;a++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+a),pos:s.getLocation("sectionPlanePos"+a),dir:s.getLocation("sectionPlaneDir"+a)});this._aPosition=s.getAttribute("position"),this._aNormal=s.getAttribute("normal"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aOffset=s.getAttribute("offset"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._aModelNormalMatrixCol0=s.getAttribute("modelNormalMatrixCol0"),this._aModelNormalMatrixCol1=s.getAttribute("modelNormalMatrixCol1"),this._aModelNormalMatrixCol2=s.getAttribute("modelNormalMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(e){var t=this._scene,i=t.canvas.gl,s=t._lightsState.lights,r=t.camera.project;this._program.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(var n=0,o=s.length;n<o;n++){var a=s[n];this._uLightColor[n]&&i.uniform4f(this._uLightColor[n],a.color[0],a.color[1],a.color[2],a.intensity),this._uLightPos[n]&&(i.uniform3fv(this._uLightPos[n],a.pos),this._uLightAttenuation[n]&&i.uniform1f(this._uLightAttenuation[n],a.attenuation)),this._uLightDir[n]&&i.uniform3fv(this._uLightDir[n],a.dir)}if(this._withSAO){var u=t.sao;if(u.possible){var h=i.drawingBufferWidth,l=i.drawingBufferHeight;rl[0]=h,rl[1]=l,rl[2]=u.blendCutoff,rl[3]=u.blendFactor,i.uniform4fv(this._uSAOParams,rl),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}if(t.logarithmicDepthBufferEnabled){var c=2/(Math.log(r.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,c)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e,t,i,s=this._scene,r=s._sectionPlanesState,n=s._lightsState,o=r.sectionPlanes.length>0,a=[];for(a.push("#version 300 es"),a.push("// Instancing geometry drawing vertex shader"),a.push("uniform int renderPass;"),a.push("in vec3 position;"),a.push("in vec2 normal;"),a.push("in vec4 color;"),a.push("in vec4 flags;"),a.push("in vec4 flags2;"),s.entityOffsetsEnabled&&a.push("in vec3 offset;"),a.push("in vec4 modelMatrixCol0;"),a.push("in vec4 modelMatrixCol1;"),a.push("in vec4 modelMatrixCol2;"),a.push("in vec4 modelNormalMatrixCol0;"),a.push("in vec4 modelNormalMatrixCol1;"),a.push("in vec4 modelNormalMatrixCol2;"),a.push("uniform mat4 worldMatrix;"),a.push("uniform mat4 worldNormalMatrix;"),a.push("uniform mat4 viewMatrix;"),a.push("uniform mat4 viewNormalMatrix;"),a.push("uniform mat4 projMatrix;"),a.push("uniform mat4 positionsDecodeMatrix;"),s.logarithmicDepthBufferEnabled&&(a.push("uniform float logDepthBufFC;"),a.push("out float vFragDepth;"),a.push("bool isPerspectiveMatrix(mat4 m) {"),a.push("    return (m[2][3] == - 1.0);"),a.push("}"),a.push("out float isPerspective;")),a.push("uniform vec4 lightAmbient;"),e=0,t=n.lights.length;e<t;e++)"ambient"!==(i=n.lights[e]).type&&(a.push("uniform vec4 lightColor"+e+";"),"dir"===i.type&&a.push("uniform vec3 lightDir"+e+";"),"point"===i.type&&a.push("uniform vec3 lightPos"+e+";"),"spot"===i.type&&(a.push("uniform vec3 lightPos"+e+";"),a.push("uniform vec3 lightDir"+e+";")));for(a.push("vec3 octDecode(vec2 oct) {"),a.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),a.push("    if (v.z < 0.0) {"),a.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),a.push("    }"),a.push("    return normalize(v);"),a.push("}"),o&&(a.push("out vec4 vWorldPosition;"),a.push("out vec4 vFlags2;")),a.push("out vec4 vColor;"),a.push("void main(void) {"),a.push("if (int(flags.x) != renderPass) {"),a.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),a.push("} else {"),a.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),a.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),s.entityOffsetsEnabled&&a.push("      worldPosition.xyz = worldPosition.xyz + offset;"),a.push("vec4 viewPosition  = viewMatrix * worldPosition; "),a.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),a.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),a.push("vec3 viewNormal = normalize(vec4(viewNormalMatrix * worldNormal).xyz);"),a.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),a.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),a.push("float lambertian = 1.0;"),e=0,t=n.lights.length;e<t;e++)if("ambient"!==(i=n.lights[e]).type){if("dir"===i.type)"view"===i.space?a.push("viewLightDir = normalize(lightDir"+e+");"):a.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===i.type)"view"===i.space?a.push("viewLightDir = -normalize(lightPos"+e+" - viewPosition.xyz);"):a.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==i.type)continue;"view"===i.space?a.push("viewLightDir = normalize(lightDir"+e+");"):a.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}a.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),a.push("reflectedColor += lambertian * (lightColor"+e+".rgb * lightColor"+e+".a);")}return a.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),a.push("vColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),a.push("vec4 clipPos = projMatrix * viewPosition;"),s.logarithmicDepthBufferEnabled&&(a.push("vFragDepth = 1.0 + clipPos.w;"),a.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),o&&(a.push("vWorldPosition = worldPosition;"),a.push("vFlags2 = flags2;")),a.push("gl_Position = clipPos;"),a.push("}"),a.push("}"),a}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Instancing geometry drawing fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),this._withSAO&&(s.push("uniform sampler2D uOcclusionTexture;"),s.push("uniform vec4      uSAOParams;"),s.push("const float       packUpscale = 256. / 255.;"),s.push("const float       unpackDownScale = 255. / 256.;"),s.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),s.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),s.push("float unpackRGBToFloat( const in vec4 v ) {"),s.push("    return dot( v, unPackFactors );"),s.push("}")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { "),s.push("      discard;"),s.push("  }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),this._withSAO?(s.push("   float viewportWidth     = uSAOParams[0];"),s.push("   float viewportHeight    = uSAOParams[1];"),s.push("   float blendCutoff       = uSAOParams[2];"),s.push("   float blendFactor       = uSAOParams[3];"),s.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),s.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),s.push("   outColor                = vec4(vColor.rgb * ambient, 1.0);")):s.push("    outColor           = vColor;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),al=q.vec4(),ul=q.vec3(),hl=function(){function e(t,i){w(this,e),this._scene=t,this._withSAO=i,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){var e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.geometry,h=t._state.origin;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,h?De(n.viewMatrix,h):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var l=r._sectionPlanesState.sectionPlanes.length;if(l>0)for(var c=r._sectionPlanesState.sectionPlanes,p=t.layerIndex*l,d=s.renderFlags,f=0;f<l;f++){var m=this._uSectionPlanes[f],v=d.sectionPlanesActivePerLayer[p+f];if(o.uniform1i(m.active,v?1:0),v){var g=c[f];if(h){var _=Ee(g.dist,g.dir,h,ul);o.uniform3fv(m.pos,_)}else o.uniform3fv(m.pos,g.pos);o.uniform3fv(m.dir,g.dir)}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),o.vertexAttribDivisor(this._aColor.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),u.indicesBuf.bind(),o.drawElementsInstanced(o.TRIANGLES,u.indicesBuf.numItems,u.indicesBuf.itemType,0,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aColor.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];for(var r=i.lights,n=0,o=r.length;n<o;n++)switch(r[n].type){case"dir":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=null,this._uLightDir[n]=s.getLocation("lightDir"+n);break;case"point":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=null,this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n);break;case"spot":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=s.getLocation("lightDir"+n),this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n)}this._uSectionPlanes=[];for(var a=0,u=e._sectionPlanesState.sectionPlanes.length;a<u;a++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+a),pos:s.getLocation("sectionPlanePos"+a),dir:s.getLocation("sectionPlaneDir"+a)});this._aPosition=s.getAttribute("position"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aOffset=s.getAttribute("offset"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(e){var t=this._scene,i=t.canvas.gl,s=t._lightsState.lights,r=t.camera.project;this._program.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(var n=0,o=s.length;n<o;n++){var a=s[n];this._uLightColor[n]&&i.uniform4f(this._uLightColor[n],a.color[0],a.color[1],a.color[2],a.intensity),this._uLightPos[n]&&(i.uniform3fv(this._uLightPos[n],a.pos),this._uLightAttenuation[n]&&i.uniform1f(this._uLightAttenuation[n],a.attenuation)),this._uLightDir[n]&&i.uniform3fv(this._uLightDir[n],a.dir)}if(this._withSAO){var u=t.sao;if(u.possible){var h=i.drawingBufferWidth,l=i.drawingBufferHeight;al[0]=h,al[1]=l,al[2]=u.blendCutoff,al[3]=u.blendFactor,i.uniform4fv(this._uSAOParams,al),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}if(t.logarithmicDepthBufferEnabled){var c=2/(Math.log(r.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,c)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Instancing geometry flat-shading drawing vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),i.push("in vec4 color;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vViewPosition;"),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("vViewPosition = viewPosition;"),i.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e,t,i=this._scene,s=i._sectionPlanesState,r=i._lightsState,n=s.sectionPlanes.length>0,o=[];if(o.push("#version 300 es"),o.push("// Instancing geometry flat-shading drawing fragment shader"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),i.logarithmicDepthBufferEnabled&&(o.push("in float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("in float vFragDepth;")),this._withSAO&&(o.push("uniform sampler2D uOcclusionTexture;"),o.push("uniform vec4      uSAOParams;"),o.push("const float       packUpscale = 256. / 255.;"),o.push("const float       unpackDownScale = 255. / 256.;"),o.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),o.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),o.push("float unpackRGBToFloat( const in vec4 v ) {"),o.push("    return dot( v, unPackFactors );"),o.push("}")),n){o.push("in vec4 vWorldPosition;"),o.push("in vec4 vFlags2;");for(var a=0,u=s.sectionPlanes.length;a<u;a++)o.push("uniform bool sectionPlaneActive"+a+";"),o.push("uniform vec3 sectionPlanePos"+a+";"),o.push("uniform vec3 sectionPlaneDir"+a+";")}for(o.push("uniform mat4 viewMatrix;"),o.push("uniform vec4 lightAmbient;"),e=0,t=r.lights.length;e<t;e++){var h=r.lights[e];"ambient"!==h.type&&(o.push("uniform vec4 lightColor"+e+";"),"dir"===h.type&&o.push("uniform vec3 lightDir"+e+";"),"point"===h.type&&o.push("uniform vec3 lightPos"+e+";"),"spot"===h.type&&(o.push("uniform vec3 lightPos"+e+";"),o.push("uniform vec3 lightDir"+e+";")))}if(o.push("in vec4 vViewPosition;"),o.push("in vec4 vColor;"),o.push("out vec4 outColor;"),o.push("void main(void) {"),n){o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;");for(var l=0,c=s.sectionPlanes.length;l<c;l++)o.push("if (sectionPlaneActive"+l+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+l+".xyz, vWorldPosition.xyz - sectionPlanePos"+l+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { "),o.push("      discard;"),o.push("  }"),o.push("}")}for(o.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),o.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),o.push("float lambertian = 1.0;"),o.push("vec3 xTangent = dFdx( vViewPosition.xyz );"),o.push("vec3 yTangent = dFdy( vViewPosition.xyz );"),o.push("vec3 viewNormal = normalize( cross( xTangent, yTangent ) );"),e=0,t=r.lights.length;e<t;e++){var p=r.lights[e];if("ambient"!==p.type){if("dir"===p.type)"view"===p.space?o.push("viewLightDir = normalize(lightDir"+e+");"):o.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===p.type)"view"===p.space?o.push("viewLightDir = -normalize(lightPos"+e+" - viewPosition.xyz);"):o.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==p.type)continue;"view"===p.space?o.push("viewLightDir = normalize(lightDir"+e+");"):o.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}o.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),o.push("reflectedColor += lambertian * (lightColor"+e+".rgb * lightColor"+e+".a);")}}return o.push("vec4 fragColor = vec4((lightAmbient.rgb * lightAmbient.a * vColor.rgb) + (reflectedColor * vColor.rgb), vColor.a);"),this._withSAO?(o.push("   float viewportWidth     = uSAOParams[0];"),o.push("   float viewportHeight    = uSAOParams[1];"),o.push("   float blendCutoff       = uSAOParams[2];"),o.push("   float blendFactor       = uSAOParams[3];"),o.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),o.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),o.push("   outColor            = vec4(fragColor.rgb * ambient, 1.0);")):o.push("    outColor           = fragColor;"),i.logarithmicDepthBufferEnabled&&o.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("}"),o}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),ll=q.vec3(),cl=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.geometry,h=t._state.origin;if(this._program||(this._allocate(t.model.scene),!this.errors)){if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),i===Wu){var l=r.xrayMaterial._state,c=l.fillColor,p=l.fillAlpha;o.uniform4f(this._uSilhouetteColor,c[0],c[1],c[2],p)}else if(i===Vu){var d=r.highlightMaterial._state,f=d.fillColor,m=d.fillAlpha;o.uniform4f(this._uSilhouetteColor,f[0],f[1],f[2],m)}else if(i===zu){var v=r.selectedMaterial._state,g=v.fillColor,_=v.fillAlpha;o.uniform4f(this._uSilhouetteColor,g[0],g[1],g[2],_)}else o.uniform4fv(this._uSilhouetteColor,q.vec3([1,1,1]));o.uniformMatrix4fv(this._uViewMatrix,!1,h?De(n.viewMatrix,h):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var y=r._sectionPlanesState.sectionPlanes.length;if(y>0)for(var b=r._sectionPlanesState.sectionPlanes,x=t.layerIndex*y,P=s.renderFlags,T=0;T<y;T++){var w=this._uSectionPlanes[T];if(w){var M=P.sectionPlanesActivePerLayer[x+T];if(o.uniform1i(w.active,M?1:0),M){var I=b[T];if(h){var C=Ee(I.dist,I.dir,h,ll);o.uniform3fv(w.pos,C)}else o.uniform3fv(w.pos,I.pos);o.uniform3fv(w.dir,I.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf,o.UNSIGNED_BYTE,!0),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,o.UNSIGNED_BYTE,!0),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),this._aColor&&(this._aColor.bindArrayBuffer(a.colorsBuf),o.vertexAttribDivisor(this._aColor.location,1)),u.indicesBuf.bind(),o.drawElementsInstanced(o.TRIANGLES,u.indicesBuf.numItems,u.indicesBuf.itemType,0,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0),this._aColor&&o.vertexAttribDivisor(this._aColor.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSilhouetteColor=s.getLocation("silhouetteColor"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aColor=s.getAttribute("color"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Instancing silhouette vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 color;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform vec4 silhouetteColor;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.y) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vColor = vec4(silhouetteColor.r, silhouetteColor.g, silhouetteColor.b, min(silhouetteColor.a, float(color.a) / 255.0));"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Instancing fill fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("outColor = vColor;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),pl=q.vec3(),dl=new Float32Array([0,0,0,1]),fl=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.geometry,h=t._state.origin;if(this._program||(this._allocate(t),!this.errors)){if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),i===Zu){var l=r.xrayMaterial._state,c=l.edgeColor,p=l.edgeAlpha;o.uniform4f(this._uColor,c[0],c[1],c[2],p)}else if(i===Ku){var d=r.highlightMaterial._state,f=d.edgeColor,m=d.edgeAlpha;o.uniform4f(this._uColor,f[0],f[1],f[2],m)}else if(i===Ju){var v=r.selectedMaterial._state,g=v.edgeColor,_=v.edgeAlpha;o.uniform4f(this._uColor,g[0],g[1],g[2],_)}else o.uniform4fv(this._uColor,dl);o.uniformMatrix4fv(this._uViewMatrix,!1,h?De(n.viewMatrix,h):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var y=r._sectionPlanesState.sectionPlanes.length;if(y>0)for(var b=r._sectionPlanesState.sectionPlanes,x=t.layerIndex*y,P=s.renderFlags,T=0;T<y;T++){var w=this._uSectionPlanes[T];if(w){var M=P.sectionPlanesActivePerLayer[x+T];if(o.uniform1i(w.active,M?1:0),M){var I=b[T];if(h){var C=Ee(I.dist,I.dir,h,pl);o.uniform3fv(w.pos,C)}else o.uniform3fv(w.pos,I.pos);o.uniform3fv(w.dir,I.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aFlags&&(this._aFlags.bindArrayBuffer(a.flagsBuf,o.UNSIGNED_BYTE,!0),o.vertexAttribDivisor(this._aFlags.location,1)),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,o.UNSIGNED_BYTE,!0),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),u.edgeIndicesBuf.bind(),o.drawElementsInstanced(o.LINES,u.edgeIndicesBuf.numItems,u.edgeIndicesBuf.itemType,0,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0),this._aFlags&&o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uColor=s.getLocation("color"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles instancing edges vertex shader"),i.push("uniform int renderPass;"),i.push("uniform vec4 color;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.z) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("vColor = vec4(color.r, color.g, color.b, color.a);"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Batched geometry edges drawing fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("outColor = vColor;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),ml=q.vec3(),vl=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.geometry,h=t._state.origin;if(this._program||(this._allocate(t),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,h?De(n.viewMatrix,h):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var l=r._sectionPlanesState.sectionPlanes.length;if(l>0)for(var c=r._sectionPlanesState.sectionPlanes,p=t.layerIndex*l,d=s.renderFlags,f=0;f<l;f++){var m=this._uSectionPlanes[f];if(m){var v=d.sectionPlanesActivePerLayer[p+f];if(o.uniform1i(m.active,v?1:0),v){var g=c[f];if(h){var _=Ee(g.dist,g.dir,h,ml);o.uniform3fv(m.pos,_)}else o.uniform3fv(m.pos,g.pos);o.uniform3fv(m.dir,g.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),o.vertexAttribDivisor(this._aColor.location,1),this._aFlags&&(this._aFlags.bindArrayBuffer(a.flagsBuf,o.UNSIGNED_BYTE,!0),o.vertexAttribDivisor(this._aFlags.location,1)),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,o.UNSIGNED_BYTE,!0),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),u.edgeIndicesBuf.bind(),o.drawElementsInstanced(o.LINES,u.edgeIndicesBuf.numItems,u.edgeIndicesBuf.itemType,0,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aColor.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0),this._aFlags&&o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aColor=s.getAttribute("color"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles instancing edges vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),i.push("in vec4 color;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.z) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("vColor = vec4(float(color.r*0.5) / 255.0, float(color.g*0.5) / 255.0, float(color.b*0.5) / 255.0, float(color.a) / 255.0);"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Batched geometry edges drawing fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("outColor = vColor;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),gl=q.vec3(),_l=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.geometry,h=t._state.origin;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniform1i(this._uRenderPass,i);var l=e.pickViewMatrix||n.viewMatrix,c=h?De(l,h):l;if(o.uniformMatrix4fv(this._uViewMatrix,!1,c),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),r.logarithmicDepthBufferEnabled){var p=2/(Math.log(n.project.far+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,p)}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPickColor.bindArrayBuffer(a.pickColorsBuf),o.vertexAttribDivisor(this._aPickColor.location,1),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),u.indicesBuf.bind();var d=r._sectionPlanesState.sectionPlanes.length;if(d>0)for(var f=r._sectionPlanesState.sectionPlanes,m=t.layerIndex*d,v=s.renderFlags,g=0;g<d;g++){var _=this._uSectionPlanes[g];if(_){var y=v.sectionPlanesActivePerLayer[m+g];if(o.uniform1i(_.active,y?1:0),y){var b=f[g];if(h){var x=Ee(b.dist,b.dir,h,gl);o.uniform3fv(_.pos,x)}else o.uniform3fv(_.pos,b.pos);o.uniform3fv(_.dir,b.dir)}}}o.drawElementsInstanced(o.TRIANGLES,u.indicesBuf.numItems,u.indicesBuf.itemType,0,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aPickColor.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._uRenderPass=s.getLocation("renderPass"),this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aPickColor=s.getAttribute("pickColor"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(e){var t=this._scene.canvas.gl;this._program.bind(),t.uniform1i(this._uPickInvisible,e.pickInvisible)}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Instancing geometry picking vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 pickColor;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vPickColor;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("  vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),t&&(i.push("  vWorldPosition = worldPosition;"),i.push("  vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Batched geometry picking fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vPickColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("if (sectionPlaneActive"+n+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("outColor = vPickColor; "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),yl=q.vec3(),bl=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.canvas.gl,o=t._state,a=o.geometry,u=t._state.origin;if(this._program||(this._allocate(t),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram());var h=r.camera;n.uniform1i(this._uRenderPass,i),n.uniform1i(this._uPickInvisible,e.pickInvisible);var l=e.pickViewMatrix||h.viewMatrix,c=u?De(l,u):l;if(n.uniformMatrix4fv(this._uViewMatrix,!1,c),n.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),n.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),n.uniform1f(this._uPickZNear,e.pickZNear),n.uniform1f(this._uPickZFar,e.pickZFar),r.logarithmicDepthBufferEnabled){var p=2/(Math.log(e.pickZFar+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,p)}var d=r._sectionPlanesState.sectionPlanes.length;if(d>0)for(var f=r._sectionPlanesState.sectionPlanes,m=t.layerIndex*d,v=s.renderFlags,g=0;g<d;g++){var _=this._uSectionPlanes[g];if(_){var y=v.sectionPlanesActivePerLayer[m+g];if(n.uniform1i(_.active,y?1:0),y){var b=f[g];if(u){var x=Ee(b.dist,b.dir,u,yl);n.uniform3fv(_.pos,x)}else n.uniform3fv(_.pos,b.pos);n.uniform3fv(_.dir,b.dir)}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,a.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(o.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(o.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(o.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aFlags.bindArrayBuffer(o.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(o.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(o.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),a.indicesBuf.bind(),n.drawElementsInstanced(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,o.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uPickZNear=i.getLocation("pickZNear"),this._uPickZFar=i.getLocation("pickZFar"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){this._program.bind()}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Instancing geometry depth vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vViewPosition;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("  vWorldPosition = worldPosition;"),i.push("  vFlags2 = flags2;")),i.push("  vViewPosition = viewPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Batched geometry depth fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),s.push("uniform float pickZNear;"),s.push("uniform float pickZFar;"),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vViewPosition;"),s.push("vec4 packDepth(const in float depth) {"),s.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),s.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),s.push("  vec4 res = fract(depth * bitShift);"),s.push("  res -= res.xxyz * bitMask;"),s.push("  return res;"),s.push("}"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("if (sectionPlaneActive"+n+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),s.push("    outColor = packDepth(zNormalizedDepth); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),xl=q.vec3(),Pl=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.geometry,h=t._state.origin;if(this._program||(this._allocate(t),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniform1i(this._uPickInvisible,e.pickInvisible);var l=e.pickViewMatrix||n.viewMatrix,c=h?De(l,h):l;if(o.uniformMatrix4fv(this._uViewMatrix,!1,c),o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.uniformMatrix4fv(this._uWorldNormalMatrix,!1,s.worldNormalMatrix),r.logarithmicDepthBufferEnabled){var p=2/(Math.log(n.project.far+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,p)}var d=r._sectionPlanesState.sectionPlanes.length;if(d>0)for(var f=r._sectionPlanesState.sectionPlanes,m=t.layerIndex*d,v=s.renderFlags,g=0;g<d;g++){var _=this._uSectionPlanes[g];if(_){var y=v.sectionPlanesActivePerLayer[m+g];if(o.uniform1i(_.active,y?1:0),y){var b=f[g];if(h){var x=Ee(b.dist,b.dir,h,xl);o.uniform3fv(_.pos,x)}else o.uniform3fv(_.pos,b.pos);o.uniform3fv(_.dir,b.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aModelNormalMatrixCol0.bindArrayBuffer(a.modelNormalMatrixCol0Buf),this._aModelNormalMatrixCol1.bindArrayBuffer(a.modelNormalMatrixCol1Buf),this._aModelNormalMatrixCol2.bindArrayBuffer(a.modelNormalMatrixCol2Buf),o.vertexAttribDivisor(this._aModelNormalMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelNormalMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelNormalMatrixCol2.location,1),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aNormal.bindArrayBuffer(u.normalsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),u.indicesBuf.bind(),o.drawElementsInstanced(o.TRIANGLES,u.indicesBuf.numItems,u.indicesBuf.itemType,0,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aModelNormalMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelNormalMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelNormalMatrixCol2.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._aModelNormalMatrixCol0=s.getAttribute("modelNormalMatrixCol0"),this._aModelNormalMatrixCol1=s.getAttribute("modelNormalMatrixCol1"),this._aModelNormalMatrixCol2=s.getAttribute("modelNormalMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){this._program.bind()}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Instancing geometry normals vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec2 normal;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("in vec4 modelNormalMatrixCol0;"),i.push("in vec4 modelNormalMatrixCol1;"),i.push("in vec4 modelNormalMatrixCol2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),i.push("vec3 octDecode(vec2 oct) {"),i.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),i.push("    if (v.z < 0.0) {"),i.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),i.push("    }"),i.push("    return normalize(v);"),i.push("}"),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec3 vWorldNormal;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("  vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),i.push("  vec3 worldNormal = vec3(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2));"),i.push("  vWorldNormal = worldNormal;"),t&&i.push("  vWorldPosition = worldPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Batched geometry normals fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec3 vWorldNormal;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("if (sectionPlaneActive"+n+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    outColor = vec4((vWorldNormal * 0.5) + 0.5, 1.0);"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Tl=q.vec3(),wl=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.geometry,h=t._state.origin;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,h?De(n.viewMatrix,h):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var l=r._sectionPlanesState.sectionPlanes.length;if(l>0)for(var c=r._sectionPlanesState.sectionPlanes,p=t.layerIndex*l,d=s.renderFlags,f=0;f<l;f++){var m=this._uSectionPlanes[f];if(m){var v=d.sectionPlanesActivePerLayer[p+f];if(o.uniform1i(m.active,v?1:0),v){var g=c[f];if(h){var _=Ee(g.dist,g.dir,h,Tl);o.uniform3fv(m.pos,_)}else o.uniform3fv(m.pos,g.pos);o.uniform3fv(m.dir,g.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aColor&&(this._aColor.bindArrayBuffer(a.colorsBuf),o.vertexAttribDivisor(this._aColor.location,1)),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(a.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),u.indicesBuf.bind(),o.drawElementsInstanced(o.TRIANGLES,u.indicesBuf.numItems,u.indicesBuf.itemType,0,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),this._aColor&&o.vertexAttribDivisor(this._aColor.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Instancing occlusion vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 color;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("in float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&i.push("  vWorldPosition = worldPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Instancing occlusion fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("if (sectionPlaneActive"+n+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return s.push("   outColor = vec4(0.0, 0.0, 1.0, 1.0); "),e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Ml=q.vec3(),Il=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.geometry,h=t._state.origin;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.uniformMatrix4fv(this._uViewMatrix,!1,h?De(n.viewMatrix,h):n.viewMatrix);var l=r._sectionPlanesState.sectionPlanes.length;if(l>0)for(var c=r._sectionPlanesState.sectionPlanes,p=t.layerIndex*l,d=s.renderFlags,f=0;f<l;f++){var m=this._uSectionPlanes[f];if(m){var v=d.sectionPlanesActivePerLayer[p+f];if(o.uniform1i(m.active,v?1:0),v){var g=c[f];if(h){var _=Ee(g.dist,g.dir,h,Ml);o.uniform3fv(m.pos,_)}else o.uniform3fv(m.pos,g.pos);o.uniform3fv(m.dir,g.dir)}}}this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(a.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),u.indicesBuf.bind(),o.drawElementsInstanced(o.TRIANGLES,u.indicesBuf.numItems,u.indicesBuf.itemType,0,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Instancing geometry depth drawing vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec2 vHighPrecisionZW;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("vHighPrecisionZW = gl_Position.zw;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e,t,i=this._scene,s=i._sectionPlanesState,r=s.sectionPlanes.length>0,n=[];if(n.push("#version 300 es"),n.push("// Instancing geometry depth drawing fragment shader"),n.push("precision highp float;"),n.push("precision highp int;"),i.logarithmicDepthBufferEnabled&&(n.push("in float isPerspective;"),n.push("uniform float logDepthBufFC;"),n.push("in float vFragDepth;")),r)for(n.push("in vec4 vWorldPosition;"),n.push("in vec4 vFlags2;"),e=0,t=s.sectionPlanes.length;e<t;e++)n.push("uniform bool sectionPlaneActive"+e+";"),n.push("uniform vec3 sectionPlanePos"+e+";"),n.push("uniform vec3 sectionPlaneDir"+e+";");if(n.push("in vec2 vHighPrecisionZW;"),n.push("out vec4 outColor;"),n.push("void main(void) {"),r){for(n.push("  bool clippable = (float(vFlags2.x) > 0.0);"),n.push("  if (clippable) {"),n.push("  float dist = 0.0;"),e=0,t=s.sectionPlanes.length;e<t;e++)n.push("if (sectionPlaneActive"+e+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),n.push("}");n.push("if (dist > 0.0) { discard; }"),n.push("}")}return i.logarithmicDepthBufferEnabled&&n.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;"),n.push("    outColor = vec4(vec3(1.0 - fragCoordZ), 1.0); "),n.push("}"),n}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Cl=q.vec3(),Dl=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.geometry,h=t._state.origin;if(this._program||(this._allocate(t),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,h?De(n.viewMatrix,h):n.viewMatrix),o.uniformMatrix4fv(this._uViewNormalMatrix,!1,n.viewNormalMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.uniformMatrix4fv(this._uWorldNormalMatrix,!1,s.worldNormalMatrix);var l=r._sectionPlanesState.sectionPlanes.length;if(l>0)for(var c=r._sectionPlanesState.sectionPlanes,p=t.layerIndex*l,d=s.renderFlags,f=0;f<l;f++){var m=this._uSectionPlanes[f];if(m){var v=d.sectionPlanesActivePerLayer[p+f];if(o.uniform1i(m.active,v?1:0),v){var g=c[f];if(h){var _=Ee(g.dist,g.dir,h,Cl);o.uniform3fv(m.pos,_)}else o.uniform3fv(m.pos,g.pos);o.uniform3fv(m.dir,g.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aNormal.bindArrayBuffer(u.normalsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),this._aColor.bindArrayBuffer(a.colorsBuf),o.vertexAttribDivisor(this._aColor.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),u.indicesBuf.bind(),o.drawElementsInstanced(o.TRIANGLES,u.indicesBuf.numItems,u.indicesBuf.itemType,0,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aColor.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2&&(this._aFlags2=s.getAttribute("flags2")),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Instancing geometry normals drawing vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec3 normal;"),i.push("in vec4 color;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 worldNormalMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 viewNormalMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),i.push("vec3 octDecode(vec2 oct) {"),i.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),i.push("    if (v.z < 0.0) {"),i.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),i.push("    }"),i.push("    return normalize(v);"),i.push("}"),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec3 vViewNormal;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("  vec4 worldNormal    = worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),i.push("  vec3 viewNormal     = normalize((viewNormalMatrix * worldNormal).xyz);"),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("  vViewNormal = viewNormal;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Instancing geometry depth drawing fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec3 vViewNormal;"),s.push("vec3 packNormalToRGB( const in vec3 normal ) {"),s.push("    return normalize( normal ) * 0.5 + 0.5;"),s.push("}"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    outColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Al=q.vec3(),kl=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._lastLightId=null,this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t){var i=t.model,s=i.scene,r=s.canvas.gl,n=t._state,o=n.geometry;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e,t)),r.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,o.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),r.vertexAttribDivisor(this._aModelMatrixCol0.location,1),r.vertexAttribDivisor(this._aModelMatrixCol1.location,1),r.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(o.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),r.vertexAttribDivisor(this._aOffset.location,1)),this._aColor.bindArrayBuffer(n.colorsBuf),r.vertexAttribDivisor(this._aColor.location,1),this._aFlags.bindArrayBuffer(n.flagsBuf),r.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),r.vertexAttribDivisor(this._aFlags2.location,1));var a=s._sectionPlanesState.sectionPlanes.length;if(a>0)for(var u=s._sectionPlanesState.sectionPlanes,h=t.layerIndex*a,l=i.renderFlags,c=t._state.origin,p=0;p<a;p++){var d=this._uSectionPlanes[p];if(d){var f=l.sectionPlanesActivePerLayer[h+p];if(r.uniform1i(d.active,f?1:0),f){var m=u[p];if(c){var v=Ee(m.dist,m.dir,c,Al);r.uniform3fv(d.pos,v)}else r.uniform3fv(d.pos,m.pos);r.uniform3fv(d.dir,m.dir)}}}o.indicesBuf.bind(),r.drawElementsInstanced(r.TRIANGLES,o.indicesBuf.numItems,o.indicesBuf.itemType,0,n.numInstances),r.vertexAttribDivisor(this._aModelMatrixCol0.location,0),r.vertexAttribDivisor(this._aModelMatrixCol1.location,0),r.vertexAttribDivisor(this._aModelMatrixCol2.location,0),r.vertexAttribDivisor(this._aColor.location,0),r.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&r.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&r.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uShadowViewMatrix=s.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=s.getLocation("shadowProjMatrix"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2")}}},{key:"_bindProgram",value:function(e,t){var i=this._scene.canvas.gl;this._program.bind(),i.uniformMatrix4fv(this._uShadowViewMatrix,!1,e.shadowViewMatrix),i.uniformMatrix4fv(this._uShadowProjMatrix,!1,e.shadowProjMatrix),this._lastLightId=null}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Instancing geometry shadow drawing vertex shader"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 color;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 shadowViewMatrix;"),i.push("uniform mat4 shadowProjMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("void main(void) {"),i.push("bool visible      = (float(flags.x) > 0.0);"),i.push("bool transparent  = ((float(color.a) / 255.0) < 1.0);"),i.push("if (!visible || transparent) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = shadowViewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("  gl_Position = shadowProjMatrix * viewPosition;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Instancing geometry depth drawing fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec3 vViewNormal;"),s.push("vec3 packNormalToRGB( const in vec3 normal ) {"),s.push("    return normalize( normal ) * 0.5 + 0.5;"),s.push("}"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    outColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),El=q.vec4(),Fl=q.vec3(),Rl={3e3:"linearToLinear",3001:"sRGBToLinear"},Sl=function(){function e(t,i){w(this,e),this._scene=t,this._withSAO=i,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){var e=this._scene;return[e.gammaOutput,e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}},{key:"drawLayer",value:function(e,t,i){var s=Ze.MAX_TEXTURE_IMAGE_UNITS,r=t.model,n=this._scene,o=n.camera,a=n.canvas.gl,u=t._state,h=u.origin,l=u.textureSet,c=u.geometry,p=n._lightsState;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,h?De(o.viewMatrix,h):o.viewMatrix),a.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,r.worldMatrix),a.uniformMatrix4fv(this._uWorldNormalMatrix,!1,r.worldNormalMatrix);var d=n._sectionPlanesState.sectionPlanes.length;if(d>0)for(var f=n._sectionPlanesState.sectionPlanes,m=t.layerIndex*d,v=r.renderFlags,g=0;g<d;g++){var _=this._uSectionPlanes[g];if(_){var y=v.sectionPlanesActivePerLayer[m+g];if(a.uniform1i(_.active,y?1:0),y){var b=f[g];if(h){var x=Ee(b.dist,b.dir,h,Fl);a.uniform3fv(_.pos,x)}else a.uniform3fv(_.pos,b.pos);a.uniform3fv(_.dir,b.dir)}}}if(a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,c.positionsDecodeMatrix),this._uUVDecodeMatrix&&a.uniformMatrix3fv(this._uUVDecodeMatrix,!1,c.uvDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(u.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(u.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(u.modelMatrixCol2Buf),a.vertexAttribDivisor(this._aModelMatrixCol0.location,1),a.vertexAttribDivisor(this._aModelMatrixCol1.location,1),a.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aModelNormalMatrixCol0.bindArrayBuffer(u.modelNormalMatrixCol0Buf),this._aModelNormalMatrixCol1.bindArrayBuffer(u.modelNormalMatrixCol1Buf),this._aModelNormalMatrixCol2.bindArrayBuffer(u.modelNormalMatrixCol2Buf),a.vertexAttribDivisor(this._aModelNormalMatrixCol0.location,1),a.vertexAttribDivisor(this._aModelNormalMatrixCol1.location,1),a.vertexAttribDivisor(this._aModelNormalMatrixCol2.location,1),this._aPosition.bindArrayBuffer(c.positionsBuf),this._aNormal.bindArrayBuffer(c.normalsBuf),this._aUV&&this._aUV.bindArrayBuffer(c.uvBuf),this._aColor.bindArrayBuffer(u.colorsBuf),a.vertexAttribDivisor(this._aColor.location,1),this._aMetallicRoughness.bindArrayBuffer(u.metallicRoughnessBuf),a.vertexAttribDivisor(this._aMetallicRoughness.location,1),this._aFlags.bindArrayBuffer(u.flagsBuf),a.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(u.flags2Buf),a.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(u.offsetsBuf),a.vertexAttribDivisor(this._aOffset.location,1)),p.reflectionMaps.length>0&&p.reflectionMaps[0].texture&&this._uReflectionMap&&(this._program.bindTexture(this._uReflectionMap,p.reflectionMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++),p.lightMaps.length>0&&p.lightMaps[0].texture&&this._uLightMap&&(this._program.bindTexture(this._uLightMap,p.lightMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++),this._withSAO){var P=n.sao;if(P.possible){var T=a.drawingBufferWidth,w=a.drawingBufferHeight;El[0]=T,El[1]=w,El[2]=P.blendCutoff,El[3]=P.blendFactor,a.uniform4fv(this._uSAOParams,El),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++}}l&&(this._program.bindTexture(this._uBaseColorMap,l.colorTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,this._program.bindTexture(this._uMetallicRoughMap,l.metallicRoughnessTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,this._program.bindTexture(this._uEmissiveMap,l.emissiveTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,this._program.bindTexture(this._uNormalMap,l.normalsTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s),c.indicesBuf.bind(),a.drawElementsInstanced(a.TRIANGLES,c.indicesBuf.numItems,c.indicesBuf.itemType,0,u.numInstances),e.drawElements++,a.vertexAttribDivisor(this._aModelMatrixCol0.location,0),a.vertexAttribDivisor(this._aModelMatrixCol1.location,0),a.vertexAttribDivisor(this._aModelMatrixCol2.location,0),a.vertexAttribDivisor(this._aModelNormalMatrixCol0.location,0),a.vertexAttribDivisor(this._aModelNormalMatrixCol1.location,0),a.vertexAttribDivisor(this._aModelNormalMatrixCol2.location,0),a.vertexAttribDivisor(this._aColor.location,0),a.vertexAttribDivisor(this._aMetallicRoughness.location,0),a.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&a.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&a.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=s.getLocation("uvDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uGammaFactor=s.getLocation("gammaFactor"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];for(var r=i.lights,n=0,o=r.length;n<o;n++)switch(r[n].type){case"dir":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=null,this._uLightDir[n]=s.getLocation("lightDir"+n);break;case"point":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=null,this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n);break;case"spot":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=s.getLocation("lightDir"+n),this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n)}i.reflectionMaps.length>0&&(this._uReflectionMap="reflectionMap"),i.lightMaps.length>0&&(this._uLightMap="lightMap"),this._uSectionPlanes=[];for(var a=0,u=e._sectionPlanesState.sectionPlanes.length;a<u;a++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+a),pos:s.getLocation("sectionPlanePos"+a),dir:s.getLocation("sectionPlaneDir"+a)});this._aPosition=s.getAttribute("position"),this._aNormal=s.getAttribute("normal"),this._aUV=s.getAttribute("uv"),this._aColor=s.getAttribute("color"),this._aMetallicRoughness=s.getAttribute("metallicRoughness"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aOffset=s.getAttribute("offset"),this._uBaseColorMap="uBaseColorMap",this._uMetallicRoughMap="uMetallicRoughMap",this._uEmissiveMap="uEmissiveMap",this._uNormalMap="uNormalMap",this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._aModelNormalMatrixCol0=s.getAttribute("modelNormalMatrixCol0"),this._aModelNormalMatrixCol1=s.getAttribute("modelNormalMatrixCol1"),this._aModelNormalMatrixCol2=s.getAttribute("modelNormalMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(e){var t=this._scene,i=t.canvas.gl,s=t._lightsState.lights,r=t.camera.project;this._program.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(var n=0,o=s.length;n<o;n++){var a=s[n];this._uLightColor[n]&&i.uniform4f(this._uLightColor[n],a.color[0],a.color[1],a.color[2],a.intensity),this._uLightPos[n]&&(i.uniform3fv(this._uLightPos[n],a.pos),this._uLightAttenuation[n]&&i.uniform1f(this._uLightAttenuation[n],a.attenuation)),this._uLightDir[n]&&i.uniform3fv(this._uLightDir[n],a.dir)}if(t.logarithmicDepthBufferEnabled){var u=2/(Math.log(r.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,u)}this._uGammaFactor&&i.uniform1f(this._uGammaFactor,t.gammaFactor)}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=e._lightsState,s=t.sectionPlanes.length>0,r=t.clippingCaps,n=[];return n.push("#version 300 es"),n.push("// Instancing geometry quality drawing vertex shader"),n.push("uniform int renderPass;"),n.push("in vec3 position;"),n.push("in vec3 normal;"),n.push("in vec4 color;"),n.push("in vec2 uv;"),n.push("in vec2 metallicRoughness;"),n.push("in vec4 flags;"),n.push("in vec4 flags2;"),e.entityOffsetsEnabled&&n.push("in vec3 offset;"),n.push("in vec4 modelMatrixCol0;"),n.push("in vec4 modelMatrixCol1;"),n.push("in vec4 modelMatrixCol2;"),n.push("in vec4 modelNormalMatrixCol0;"),n.push("in vec4 modelNormalMatrixCol1;"),n.push("in vec4 modelNormalMatrixCol2;"),n.push("uniform mat4 worldMatrix;"),n.push("uniform mat4 worldNormalMatrix;"),n.push("uniform mat4 viewMatrix;"),n.push("uniform mat4 viewNormalMatrix;"),n.push("uniform mat4 projMatrix;"),n.push("uniform mat4 positionsDecodeMatrix;"),n.push("uniform mat3 uvDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),n.push("out float vFragDepth;"),n.push("bool isPerspectiveMatrix(mat4 m) {"),n.push("    return (m[2][3] == - 1.0);"),n.push("}"),n.push("out float isPerspective;")),n.push("vec3 octDecode(vec2 oct) {"),n.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),n.push("    if (v.z < 0.0) {"),n.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),n.push("    }"),n.push("    return normalize(v);"),n.push("}"),n.push("out vec4 vViewPosition;"),n.push("out vec3 vViewNormal;"),n.push("out vec4 vColor;"),n.push("out vec2 vUV;"),n.push("out vec2 vMetallicRoughness;"),i.lightMaps.length>0&&n.push("out vec3 vWorldNormal;"),s&&(n.push("out vec4 vWorldPosition;"),n.push("out vec4 vFlags2;"),r&&n.push("out vec4 vClipPosition;")),n.push("void main(void) {"),n.push("if (int(flags.x) != renderPass) {"),n.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),n.push("} else {"),n.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),n.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&n.push("      worldPosition.xyz = worldPosition.xyz + offset;"),n.push("vec4 viewPosition  = viewMatrix * worldPosition; "),n.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),n.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 1.0);"),n.push("vec3 viewNormal = vec4(viewNormalMatrix * worldNormal).xyz;"),n.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(n.push("vFragDepth = 1.0 + clipPos.w;"),n.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s&&(n.push("vWorldPosition = worldPosition;"),n.push("vFlags2 = flags2;"),r&&n.push("vClipPosition = clipPos;")),n.push("vViewPosition = viewPosition;"),n.push("vViewNormal = viewNormal;"),n.push("vColor = color;"),n.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"),n.push("vMetallicRoughness = metallicRoughness;"),i.lightMaps.length>0&&n.push("vWorldNormal = worldNormal.xyz;"),n.push("gl_Position = clipPos;"),n.push("}"),n.push("}"),n}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e.gammaOutput,i=e._sectionPlanesState,s=e._lightsState,r=i.sectionPlanes.length>0,n=i.clippingCaps,o=[];o.push("#version 300 es"),o.push("// Instancing geometry quality drawing fragment shader"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),e.logarithmicDepthBufferEnabled&&(o.push("in float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("in float vFragDepth;")),o.push("uniform sampler2D uBaseColorMap;"),o.push("uniform sampler2D uMetallicRoughMap;"),o.push("uniform sampler2D uEmissiveMap;"),o.push("uniform sampler2D uNormalMap;"),this._withSAO&&(o.push("uniform sampler2D uOcclusionTexture;"),o.push("uniform vec4      uSAOParams;"),o.push("const float       packUpscale = 256. / 255.;"),o.push("const float       unpackDownScale = 255. / 256.;"),o.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),o.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),o.push("float unpackRGBToFloat( const in vec4 v ) {"),o.push("    return dot( v, unPackFactors );"),o.push("}")),s.reflectionMaps.length>0&&o.push("uniform samplerCube reflectionMap;"),s.lightMaps.length>0&&o.push("uniform samplerCube lightMap;"),o.push("uniform vec4 lightAmbient;");for(var a=0,u=s.lights.length;a<u;a++){var h=s.lights[a];"ambient"!==h.type&&(o.push("uniform vec4 lightColor"+a+";"),"dir"===h.type&&o.push("uniform vec3 lightDir"+a+";"),"point"===h.type&&o.push("uniform vec3 lightPos"+a+";"),"spot"===h.type&&(o.push("uniform vec3 lightPos"+a+";"),o.push("uniform vec3 lightDir"+a+";")))}if(o.push("uniform float gammaFactor;"),o.push("vec4 linearToLinear( in vec4 value ) {"),o.push("  return value;"),o.push("}"),o.push("vec4 sRGBToLinear( in vec4 value ) {"),o.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),o.push("}"),o.push("vec4 gammaToLinear( in vec4 value) {"),o.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),o.push("}"),t&&(o.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),o.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),o.push("}")),r){o.push("in vec4 vWorldPosition;"),o.push("in vec4 vFlags2;"),n&&o.push("in vec4 vClipPosition;");for(var l=0,c=i.sectionPlanes.length;l<c;l++)o.push("uniform bool sectionPlaneActive"+l+";"),o.push("uniform vec3 sectionPlanePos"+l+";"),o.push("uniform vec3 sectionPlaneDir"+l+";")}if(o.push("in vec4 vViewPosition;"),o.push("in vec3 vViewNormal;"),o.push("in vec4 vColor;"),o.push("in vec2 vUV;"),o.push("in vec2 vMetallicRoughness;"),s.lightMaps.length>0&&o.push("in vec3 vWorldNormal;"),o.push("uniform mat4 viewMatrix;"),o.push("#define PI 3.14159265359"),o.push("#define RECIPROCAL_PI 0.31830988618"),o.push("#define RECIPROCAL_PI2 0.15915494"),o.push("#define EPSILON 1e-6"),o.push("#define saturate(a) clamp( a, 0.0, 1.0 )"),o.push("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),o.push("       vec3 texel = texture( uNormalMap, uv ).xyz;"),o.push("       if (texel.r == 0.0 && texel.g == 0.0 && texel.b == 0.0) {"),o.push("              return normalize(surf_norm );"),o.push("       }"),o.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),o.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),o.push("      vec2 st0 = dFdx( uv.st );"),o.push("      vec2 st1 = dFdy( uv.st );"),o.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),o.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),o.push("      vec3 N = normalize( surf_norm );"),o.push("      vec3 mapN = texel.xyz * 2.0 - 1.0;"),o.push("      mat3 tsn = mat3( S, T, N );"),o.push("      return normalize( tsn * mapN );"),o.push("}"),o.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),o.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),o.push("}"),o.push("struct IncidentLight {"),o.push("   vec3 color;"),o.push("   vec3 direction;"),o.push("};"),o.push("struct ReflectedLight {"),o.push("   vec3 diffuse;"),o.push("   vec3 specular;"),o.push("};"),o.push("struct Geometry {"),o.push("   vec3 position;"),o.push("   vec3 viewNormal;"),o.push("   vec3 worldNormal;"),o.push("   vec3 viewEyeDir;"),o.push("};"),o.push("struct Material {"),o.push("   vec3    diffuseColor;"),o.push("   float   specularRoughness;"),o.push("   vec3    specularColor;"),o.push("   float   shine;"),o.push("};"),o.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),o.push("   float r = ggxRoughness + 0.0001;"),o.push("   return (2.0 / (r * r) - 2.0);"),o.push("}"),o.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {"),o.push("   float maxMIPLevelScalar = float( maxMIPLevel );"),o.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );"),o.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );"),o.push("}"),s.reflectionMaps.length>0&&(o.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),o.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),o.push("   vec3 envMapColor = "+Rl[s.reflectionMaps[0].encoding]+"(texture(reflectionMap, reflectVec, mipLevel)).rgb;"),o.push("  return envMapColor;"),o.push("}")),o.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),o.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),o.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),o.push("}"),o.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),o.push("   float a2 = ( alpha * alpha );"),o.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),o.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),o.push("   return 1.0 / ( gl * gv );"),o.push("}"),o.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),o.push("   float a2 = ( alpha * alpha );"),o.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),o.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),o.push("   return 0.5 / max( gv + gl, EPSILON );"),o.push("}"),o.push("float D_GGX(const in float alpha, const in float dotNH) {"),o.push("   float a2 = ( alpha * alpha );"),o.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),o.push("   return RECIPROCAL_PI * a2 / ( denom * denom);"),o.push("}"),o.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),o.push("   float alpha = ( roughness * roughness );"),o.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),o.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),o.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),o.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),o.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),o.push("   vec3  F = F_Schlick( specularColor, dotLH );"),o.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),o.push("   float D = D_GGX( alpha, dotNH );"),o.push("   return F * (G * D);"),o.push("}"),o.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),o.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),o.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),o.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),o.push("   vec4 r = roughness * c0 + c1;"),o.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),o.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),o.push("   return specularColor * AB.x + AB.y;"),o.push("}"),(s.lightMaps.length>0||s.reflectionMaps.length>0)&&(o.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),s.lightMaps.length>0&&(o.push("   vec3 irradiance = "+Rl[s.lightMaps[0].encoding]+"(texture(lightMap, geometry.worldNormal)).rgb;"),o.push("   irradiance *= PI;"),o.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),o.push("   reflectedLight.diffuse += irradiance * diffuseBRDFContrib;")),s.reflectionMaps.length>0&&(o.push("   vec3 reflectVec             = reflect(geometry.viewEyeDir, geometry.viewNormal);"),o.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),o.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),o.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),o.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),o.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),o.push("}")),o.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),o.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),o.push("   vec3 irradiance = dotNL * incidentLight.color * PI;"),o.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),o.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),o.push("}"),o.push("out vec4 outColor;"),o.push("void main(void) {"),r){o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;");for(var p=0,d=i.sectionPlanes.length;p<d;p++)o.push("if (sectionPlaneActive"+p+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+p+".xyz, vWorldPosition.xyz - sectionPlanePos"+p+".xyz), 0.0, 1000.0);"),o.push("}");n?(o.push("  if (dist > (0.002 * vClipPosition.w)) {"),o.push("      discard;"),o.push("  }"),o.push("  if (dist > 0.0) { "),o.push("      outColor=vec4(1.0, 0.0, 0.0, 1.0);"),e.logarithmicDepthBufferEnabled&&o.push("  gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("  return;"),o.push("}")):(o.push("  if (dist > 0.0) { "),o.push("      discard;"),o.push("  }")),o.push("}")}o.push("IncidentLight  light;"),o.push("Material       material;"),o.push("Geometry       geometry;"),o.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),o.push("vec3 rgb = (vec3(float(vColor.r) / 255.0, float(vColor.g) / 255.0, float(vColor.b) / 255.0));"),o.push("float opacity = float(vColor.a) / 255.0;"),o.push("vec3  baseColor = rgb;"),o.push("float specularF0 = 1.0;"),o.push("float metallic = float(vMetallicRoughness.r) / 255.0;"),o.push("float roughness = float(vMetallicRoughness.g) / 255.0;"),o.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),o.push("vec4 baseColorTexel = sRGBToLinear(texture(uBaseColorMap, vUV));"),o.push("baseColor *= baseColorTexel.rgb;"),o.push("vec3 metalRoughTexel = texture(uMetallicRoughMap, vUV).rgb;"),o.push("metallic *= metalRoughTexel.b;"),o.push("roughness *= metalRoughTexel.g;"),o.push("vec3 viewNormal = perturbNormal2Arb( vViewPosition.xyz, normalize(vViewNormal), vUV );"),o.push("material.diffuseColor      = baseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),o.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),o.push("material.specularColor     = mix(vec3(dielectricSpecular), baseColor, metallic);"),o.push("geometry.position      = vViewPosition.xyz;"),o.push("geometry.viewNormal    = -normalize(viewNormal);"),o.push("geometry.viewEyeDir    = normalize(vViewPosition.xyz);"),s.lightMaps.length>0&&o.push("geometry.worldNormal   = normalize(vWorldNormal);"),(s.lightMaps.length>0||s.reflectionMaps.length>0)&&o.push("computePBRLightMapping(geometry, material, reflectedLight);");for(var f=0,m=s.lights.length;f<m;f++){var v=s.lights[f];if("ambient"!==v.type){if("dir"===v.type)"view"===v.space?o.push("light.direction = normalize(lightDir"+f+");"):o.push("light.direction = normalize((viewMatrix * vec4(lightDir"+f+", 0.0)).xyz);");else if("point"===v.type)"view"===v.space?o.push("light.direction = normalize(lightPos"+f+" - vViewPosition.xyz);"):o.push("light.direction = normalize((viewMatrix * vec4(lightPos"+f+", 0.0)).xyz);");else{if("spot"!==v.type)continue;"view"===v.space?o.push("light.direction = normalize(lightDir"+f+");"):o.push("light.direction = normalize((viewMatrix * vec4(lightDir"+f+", 0.0)).xyz);")}o.push("light.color =  lightColor"+f+".rgb * lightColor"+f+".a;"),o.push("computePBRLighting(light, geometry, material, reflectedLight);")}}return o.push("vec3 emissiveColor = sRGBToLinear(texture(uEmissiveMap, vUV)).rgb;"),o.push("vec3 outgoingLight = (lightAmbient.rgb * lightAmbient.a * baseColor * opacity * rgb) + (reflectedLight.diffuse) + (reflectedLight.specular) + emissiveColor;"),o.push("vec4 fragColor;"),this._withSAO?(o.push("   float viewportWidth     = uSAOParams[0];"),o.push("   float viewportHeight    = uSAOParams[1];"),o.push("   float blendCutoff       = uSAOParams[2];"),o.push("   float blendFactor       = uSAOParams[3];"),o.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),o.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),o.push("   fragColor            = vec4(outgoingLight.rgb * ambient, opacity);")):o.push("   fragColor            = vec4(outgoingLight.rgb, opacity);"),t&&o.push("fragColor = linearToGamma(fragColor, gammaFactor);"),o.push("outColor = fragColor;"),e.logarithmicDepthBufferEnabled&&o.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("}"),o}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Ol=q.vec3(),Bl=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=a.geometry,h=t._state.origin;if(this._program||(this._allocate(t),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniform1i(this._uPickInvisible,e.pickInvisible);var l=e.pickViewMatrix||n.viewMatrix,c=h?De(l,h):l;if(o.uniformMatrix4fv(this._uViewMatrix,!1,c),o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),r.logarithmicDepthBufferEnabled){var p=2/(Math.log(n.project.far+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,p)}var d=r._sectionPlanesState.sectionPlanes.length;if(d>0)for(var f=r._sectionPlanesState.sectionPlanes,m=t.layerIndex*d,v=s.renderFlags,g=0;g<d;g++){var _=this._uSectionPlanes[g],y=v.sectionPlanesActivePerLayer[m+g];if(o.uniform1i(_.active,y?1:0),y){var b=f[g];if(h){var x=Ee(b.dist,b.dir,h,Ol);o.uniform3fv(_.pos,x)}else o.uniform3fv(_.pos,b.pos);o.uniform3fv(_.dir,b.dir)}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),u.indicesBuf.bind(),o.drawElementsInstanced(o.TRIANGLES,u.indicesBuf.numItems,u.indicesBuf.itemType,0,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){this._program.bind()}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Instancing geometry normals vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&i.push("out vec4 vFlags2;"),i.push("out vec4 vWorldPosition;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("  vWorldPosition = worldPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Batched geometry normals fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("in float isPerspective;"),s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),s.push("in vec4 vWorldPosition;"),i){s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec3 vWorldNormal;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("if (sectionPlaneActive"+n+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("  vec3 xTangent = dFdx( vWorldPosition.xyz );"),s.push("  vec3 yTangent = dFdy( vWorldPosition.xyz );"),s.push("  vec3 worldNormal = normalize( cross( xTangent, yTangent ) );"),s.push("  outColor = vec4((worldNormal * 0.5) + 0.5, 1.0);"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Ll=q.vec4(),Nl=q.vec3(),jl=function(){function e(t,i){w(this,e),this._scene=t,this._withSAO=i,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){var e=this._scene;return[e.gammaOutput,e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}},{key:"drawLayer",value:function(e,t,i){var s=Ze.MAX_TEXTURE_IMAGE_UNITS,r=t.model,n=r.scene,o=n.camera,a=n.canvas.gl,u=t._state,h=u.geometry,l=t._state.origin,c=u.textureSet;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,i),a.uniformMatrix4fv(this._uViewMatrix,!1,l?De(o.viewMatrix,l):o.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,r.worldMatrix);var p=n._sectionPlanesState.sectionPlanes.length;if(p>0)for(var d=n._sectionPlanesState.sectionPlanes,f=t.layerIndex*p,m=r.renderFlags,v=0;v<p;v++){var g=this._uSectionPlanes[v];if(g){var _=m.sectionPlanesActivePerLayer[f+v];if(a.uniform1i(g.active,_?1:0),_){var y=d[v];if(l){var b=Ee(y.dist,y.dir,l,Nl);a.uniform3fv(g.pos,b)}else a.uniform3fv(g.pos,y.pos);a.uniform3fv(g.dir,y.dir)}}}if(a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._uUVDecodeMatrix&&a.uniformMatrix3fv(this._uUVDecodeMatrix,!1,h.uvDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(u.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(u.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(u.modelMatrixCol2Buf),a.vertexAttribDivisor(this._aModelMatrixCol0.location,1),a.vertexAttribDivisor(this._aModelMatrixCol1.location,1),a.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aUV.bindArrayBuffer(h.uvBuf),this._aColor.bindArrayBuffer(u.colorsBuf),a.vertexAttribDivisor(this._aColor.location,1),this._aFlags.bindArrayBuffer(u.flagsBuf),a.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(u.flags2Buf),a.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(u.offsetsBuf),a.vertexAttribDivisor(this._aOffset.location,1)),h.indicesBuf.bind(),a.drawElementsInstanced(a.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,u.numInstances),e.drawElements++,a.vertexAttribDivisor(this._aModelMatrixCol0.location,0),a.vertexAttribDivisor(this._aModelMatrixCol1.location,0),a.vertexAttribDivisor(this._aModelMatrixCol2.location,0),a.vertexAttribDivisor(this._aColor.location,0),a.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&a.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&a.vertexAttribDivisor(this._aOffset.location,0),c&&c.colorTexture&&(this._program.bindTexture(this._uColorMap,c.colorTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s),this._withSAO){var x=n.sao;if(x.possible){var P=a.drawingBufferWidth,T=a.drawingBufferHeight;Ll[0]=P,Ll[1]=T,Ll[2]=x.blendCutoff,Ll[3]=x.blendFactor,a.uniform4fv(this._uSAOParams,Ll),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._lightsState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=s.getLocation("uvDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uGammaFactor=s.getLocation("gammaFactor"),this._uLightAmbient=s.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];for(var r=i.lights,n=0,o=r.length;n<o;n++)switch(r[n].type){case"dir":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=null,this._uLightDir[n]=s.getLocation("lightDir"+n);break;case"point":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=null,this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n);break;case"spot":this._uLightColor[n]=s.getLocation("lightColor"+n),this._uLightPos[n]=s.getLocation("lightPos"+n),this._uLightDir[n]=s.getLocation("lightDir"+n),this._uLightAttenuation[n]=s.getLocation("lightAttenuation"+n)}this._uSectionPlanes=[];for(var a=0,u=e._sectionPlanesState.sectionPlanes.length;a<u;a++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+a),pos:s.getLocation("sectionPlanePos"+a),dir:s.getLocation("sectionPlaneDir"+a)});this._aPosition=s.getAttribute("position"),this._aColor=s.getAttribute("color"),this._aUV=s.getAttribute("uv"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aOffset=s.getAttribute("offset"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uColorMap="uColorMap",this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(e){var t=this._scene,i=t.canvas.gl,s=t._lightsState.lights,r=t.camera.project;this._program.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(var n=0,o=s.length;n<o;n++){var a=s[n];this._uLightColor[n]&&i.uniform4f(this._uLightColor[n],a.color[0],a.color[1],a.color[2],a.intensity),this._uLightPos[n]&&(i.uniform3fv(this._uLightPos[n],a.pos),this._uLightAttenuation[n]&&i.uniform1f(this._uLightAttenuation[n],a.attenuation)),this._uLightDir[n]&&i.uniform3fv(this._uLightDir[n],a.dir)}if(t.logarithmicDepthBufferEnabled){var u=2/(Math.log(r.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,u)}this._uGammaFactor&&i.uniform1f(this._uGammaFactor,t.gammaFactor)}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Instancing geometry drawing vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),i.push("in vec4 color;"),i.push("in vec2 uv;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform mat3 uvDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out float isPerspective;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vViewPosition;"),i.push("out vec4 vColor;"),i.push("out vec2 vUV;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("vViewPosition = viewPosition;"),i.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),i.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e,t,i=this._scene,s=i.gammaOutput,r=i._sectionPlanesState,n=i._lightsState,o=r.sectionPlanes.length>0,a=[];if(a.push("#version 300 es"),a.push("// Instancing geometry drawing fragment shader"),a.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),a.push("precision highp float;"),a.push("precision highp int;"),a.push("#else"),a.push("precision mediump float;"),a.push("precision mediump int;"),a.push("#endif"),i.logarithmicDepthBufferEnabled&&(a.push("in float isPerspective;"),a.push("uniform float logDepthBufFC;"),a.push("in float vFragDepth;")),a.push("uniform sampler2D uColorMap;"),this._withSAO&&(a.push("uniform sampler2D uOcclusionTexture;"),a.push("uniform vec4      uSAOParams;"),a.push("const float       packUpscale = 256. / 255.;"),a.push("const float       unpackDownScale = 255. / 256.;"),a.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),a.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),a.push("float unpackRGBToFloat( const in vec4 v ) {"),a.push("    return dot( v, unPackFactors );"),a.push("}")),a.push("uniform float gammaFactor;"),a.push("vec4 linearToLinear( in vec4 value ) {"),a.push("  return value;"),a.push("}"),a.push("vec4 sRGBToLinear( in vec4 value ) {"),a.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),a.push("}"),a.push("vec4 gammaToLinear( in vec4 value) {"),a.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),a.push("}"),s&&(a.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),a.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),a.push("}")),o){a.push("in vec4 vWorldPosition;"),a.push("in vec4 vFlags2;");for(var u=0,h=r.sectionPlanes.length;u<h;u++)a.push("uniform bool sectionPlaneActive"+u+";"),a.push("uniform vec3 sectionPlanePos"+u+";"),a.push("uniform vec3 sectionPlaneDir"+u+";")}for(a.push("uniform mat4 viewMatrix;"),a.push("uniform vec4 lightAmbient;"),e=0,t=n.lights.length;e<t;e++){var l=n.lights[e];"ambient"!==l.type&&(a.push("uniform vec4 lightColor"+e+";"),"dir"===l.type&&a.push("uniform vec3 lightDir"+e+";"),"point"===l.type&&a.push("uniform vec3 lightPos"+e+";"),"spot"===l.type&&(a.push("uniform vec3 lightPos"+e+";"),a.push("uniform vec3 lightDir"+e+";")))}if(a.push("in vec4 vViewPosition;"),a.push("in vec4 vColor;"),a.push("in vec2 vUV;"),a.push("out vec4 outColor;"),a.push("void main(void) {"),o){a.push("  bool clippable = (float(vFlags2.x) > 0.0);"),a.push("  if (clippable) {"),a.push("  float dist = 0.0;");for(var c=0,p=r.sectionPlanes.length;c<p;c++)a.push("if (sectionPlaneActive"+c+") {"),a.push("   dist += clamp(dot(-sectionPlaneDir"+c+".xyz, vWorldPosition.xyz - sectionPlanePos"+c+".xyz), 0.0, 1000.0);"),a.push("}");a.push("  if (dist > 0.0) { "),a.push("      discard;"),a.push("  }"),a.push("}")}for(a.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),a.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),a.push("float lambertian = 1.0;"),a.push("vec3 xTangent = dFdx( vViewPosition.xyz );"),a.push("vec3 yTangent = dFdy( vViewPosition.xyz );"),a.push("vec3 viewNormal = normalize( cross( xTangent, yTangent ) );"),e=0,t=n.lights.length;e<t;e++){var d=n.lights[e];if("ambient"!==d.type){if("dir"===d.type)"view"===d.space?a.push("viewLightDir = normalize(lightDir"+e+");"):a.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===d.type)"view"===d.space?a.push("viewLightDir = -normalize(lightPos"+e+" - viewPosition.xyz);"):a.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==d.type)continue;"view"===d.space?a.push("viewLightDir = normalize(lightDir"+e+");"):a.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}a.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),a.push("reflectedColor += lambertian * (lightColor"+e+".rgb * lightColor"+e+".a);")}}return a.push("vec4 color =  vec4((lightAmbient.rgb * lightAmbient.a * vColor.rgb) + (reflectedColor * vColor.rgb), vColor.a);"),s?a.push("vec4 colorTexel = color * sRGBToLinear(texture(uColorMap, vUV));"):a.push("vec4 colorTexel = color * texture(uColorMap, vUV);"),a.push("float opacity = color.a;"),this._withSAO?(a.push("   float viewportWidth     = uSAOParams[0];"),a.push("   float viewportHeight    = uSAOParams[1];"),a.push("   float blendCutoff       = uSAOParams[2];"),a.push("   float blendFactor       = uSAOParams[3];"),a.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),a.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),a.push("   outColor                = vec4(vColor.rgb * colorTexel.rgb * ambient, opacity);")):a.push("   outColor                = vec4(vColor.rgb * colorTexel.rgb, opacity);"),s&&a.push("outColor = linearToGamma(outColor, gammaFactor);"),i.logarithmicDepthBufferEnabled&&a.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),a.push("}"),a}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Gl=function(){function e(t){w(this,e),this._scene=t}return I(e,[{key:"_compile",value:function(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._colorRendererWithSAO&&!this._colorRendererWithSAO.getValid()&&(this._colorRendererWithSAO.destroy(),this._colorRendererWithSAO=null),this._flatColorRenderer&&!this._flatColorRenderer.getValid()&&(this._flatColorRenderer.destroy(),this._flatColorRenderer=null),this._flatColorRendererWithSAO&&!this._flatColorRendererWithSAO.getValid()&&(this._flatColorRendererWithSAO.destroy(),this._flatColorRendererWithSAO=null),this._pbrRenderer&&!this._pbrRenderer.getValid()&&(this._pbrRenderer.destroy(),this._pbrRenderer=null),this._pbrRendererWithSAO&&!this._pbrRendererWithSAO.getValid()&&(this._pbrRendererWithSAO.destroy(),this._pbrRendererWithSAO=null),this._colorTextureRenderer&&!this._colorTextureRenderer.getValid()&&(this._colorTextureRenderer.destroy(),this._colorTextureRenderer=null),this._colorTextureRendererWithSAO&&!this._colorTextureRendererWithSAO.getValid()&&(this._colorTextureRendererWithSAO.destroy(),this._colorTextureRendererWithSAO=null),this._depthRenderer&&!this._depthRenderer.getValid()&&(this._depthRenderer.destroy(),this._depthRenderer=null),this._normalsRenderer&&!this._normalsRenderer.getValid()&&(this._normalsRenderer.destroy(),this._normalsRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._edgesRenderer&&!this._edgesRenderer.getValid()&&(this._edgesRenderer.destroy(),this._edgesRenderer=null),this._edgesColorRenderer&&!this._edgesColorRenderer.getValid()&&(this._edgesColorRenderer.destroy(),this._edgesColorRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._pickNormalsRenderer&&!1===this._pickNormalsRenderer.getValid()&&(this._pickNormalsRenderer.destroy(),this._pickNormalsRenderer=null),this._pickNormalsFlatRenderer&&!this._pickNormalsFlatRenderer.getValid()&&(this._pickNormalsFlatRenderer.destroy(),this._pickNormalsFlatRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null),this._shadowRenderer&&!this._shadowRenderer.getValid()&&(this._shadowRenderer.destroy(),this._shadowRenderer=null)}},{key:"colorRenderer",get:function(){return this._colorRenderer||(this._colorRenderer=new ol(this._scene,!1)),this._colorRenderer}},{key:"colorRendererWithSAO",get:function(){return this._colorRendererWithSAO||(this._colorRendererWithSAO=new ol(this._scene,!0)),this._colorRendererWithSAO}},{key:"flatColorRenderer",get:function(){return this._flatColorRenderer||(this._flatColorRenderer=new hl(this._scene,!1)),this._flatColorRenderer}},{key:"flatColorRendererWithSAO",get:function(){return this._flatColorRendererWithSAO||(this._flatColorRendererWithSAO=new hl(this._scene,!0)),this._flatColorRendererWithSAO}},{key:"pbrRenderer",get:function(){return this._pbrRenderer||(this._pbrRenderer=new Sl(this._scene,!1)),this._pbrRenderer}},{key:"pbrRendererWithSAO",get:function(){return this._pbrRendererWithSAO||(this._pbrRendererWithSAO=new Sl(this._scene,!0)),this._pbrRendererWithSAO}},{key:"colorTextureRenderer",get:function(){return this._colorTextureRenderer||(this._colorTextureRenderer=new jl(this._scene,!1)),this._colorTextureRenderer}},{key:"colorTextureRendererWithSAO",get:function(){return this._colorTextureRendererWithSAO||(this._colorTextureRendererWithSAO=new jl(this._scene,!0)),this._colorTextureRendererWithSAO}},{key:"silhouetteRenderer",get:function(){return this._silhouetteRenderer||(this._silhouetteRenderer=new cl(this._scene)),this._silhouetteRenderer}},{key:"depthRenderer",get:function(){return this._depthRenderer||(this._depthRenderer=new Il(this._scene)),this._depthRenderer}},{key:"normalsRenderer",get:function(){return this._normalsRenderer||(this._normalsRenderer=new Dl(this._scene)),this._normalsRenderer}},{key:"edgesRenderer",get:function(){return this._edgesRenderer||(this._edgesRenderer=new fl(this._scene)),this._edgesRenderer}},{key:"edgesColorRenderer",get:function(){return this._edgesColorRenderer||(this._edgesColorRenderer=new vl(this._scene)),this._edgesColorRenderer}},{key:"pickMeshRenderer",get:function(){return this._pickMeshRenderer||(this._pickMeshRenderer=new _l(this._scene)),this._pickMeshRenderer}},{key:"pickNormalsRenderer",get:function(){return this._pickNormalsRenderer||(this._pickNormalsRenderer=new Pl(this._scene)),this._pickNormalsRenderer}},{key:"pickNormalsFlatRenderer",get:function(){return this._pickNormalsFlatRenderer||(this._pickNormalsFlatRenderer=new Bl(this._scene)),this._pickNormalsFlatRenderer}},{key:"pickDepthRenderer",get:function(){return this._pickDepthRenderer||(this._pickDepthRenderer=new bl(this._scene)),this._pickDepthRenderer}},{key:"occlusionRenderer",get:function(){return this._occlusionRenderer||(this._occlusionRenderer=new wl(this._scene)),this._occlusionRenderer}},{key:"shadowRenderer",get:function(){return this._shadowRenderer||(this._shadowRenderer=new kl(this._scene)),this._shadowRenderer}},{key:"_destroy",value:function(){this._colorRenderer&&this._colorRenderer.destroy(),this._colorRendererWithSAO&&this._colorRendererWithSAO.destroy(),this._flatColorRenderer&&this._flatColorRenderer.destroy(),this._flatColorRendererWithSAO&&this._flatColorRendererWithSAO.destroy(),this._pbrRenderer&&this._pbrRenderer.destroy(),this._pbrRendererWithSAO&&this._pbrRendererWithSAO.destroy(),this._colorTextureRenderer&&this._colorTextureRenderer.destroy(),this._colorTextureRendererWithSAO&&this._colorTextureRendererWithSAO.destroy(),this._depthRenderer&&this._depthRenderer.destroy(),this._normalsRenderer&&this._normalsRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._edgesRenderer&&this._edgesRenderer.destroy(),this._edgesColorRenderer&&this._edgesColorRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._pickNormalsRenderer&&this._pickNormalsRenderer.destroy(),this._pickNormalsFlatRenderer&&this._pickNormalsFlatRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy(),this._shadowRenderer&&this._shadowRenderer.destroy()}}]),e}(),Hl={};var Ul=new Uint8Array(4),Vl=q.vec4([0,0,0,1]),zl=q.vec4([0,0,0,1]),Wl=q.vec4([0,0,0,1]),Xl=new Float32Array(3),Yl=q.vec3(),Kl=q.vec3(),Jl=q.vec3(),Zl=q.vec3(),Ql=q.vec3(),ql=q.vec3(),$l=q.vec3(),ec=function(){function e(t){var i,s,r;w(this,e),this.model=t.model,this.sortId="TrianglesInstancingLayer"+(t.solid?"-solid":"-surface")+(t.normals?"-normals":"-autoNormals"),this.layerIndex=t.layerIndex,this._instancingRenderers=(i=t.model.scene,s=i.id,(r=Hl[s])||(r=new Gl(i),Hl[s]=r,r._compile(),i.on("compile",(function(){r._compile()})),i.on("destroyed",(function(){delete Hl[s],r._destroy()}))),r),this._aabb=q.collapseAABB3();var n={numInstances:0,obb:q.OBB3(),origin:q.vec3(),geometry:t.geometry,textureSet:t.textureSet,pbrSupported:!1};this._state=new ti(n),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numSelectedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this.numIndices=t.geometry.numIndices,this._colors=[],this._metallicRoughness=[],this._pickColors=[],this._offsets=[],this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._modelNormalMatrixCol0=[],this._modelNormalMatrixCol1=[],this._modelNormalMatrixCol2=[],this._portions=[],t.origin&&this._state.origin.set(t.origin),this._finalized=!1,this.aabb=q.collapseAABB3(),this.solid=!!t.solid}return I(e,[{key:"createPortion",value:function(e){var t=e.color,i=e.metallic,s=e.roughness,r=e.opacity,n=e.meshMatrix,o=e.worldMatrix,a=e.aabb,u=e.pickColor;if(this._finalized)throw"Already finalized";var h=t[0],l=t[1],c=t[2];if(t[3],this._colors.push(h),this._colors.push(l),this._colors.push(c),this._colors.push(r),this._metallicRoughness.push(null!=i?i:0),this._metallicRoughness.push(null!=s?s:255),this.model.scene.entityOffsetsEnabled&&(this._offsets.push(0),this._offsets.push(0),this._offsets.push(0)),this._modelMatrixCol0.push(n[0]),this._modelMatrixCol0.push(n[4]),this._modelMatrixCol0.push(n[8]),this._modelMatrixCol0.push(n[12]),this._modelMatrixCol1.push(n[1]),this._modelMatrixCol1.push(n[5]),this._modelMatrixCol1.push(n[9]),this._modelMatrixCol1.push(n[13]),this._modelMatrixCol2.push(n[2]),this._modelMatrixCol2.push(n[6]),this._modelMatrixCol2.push(n[10]),this._modelMatrixCol2.push(n[14]),this._state.geometry.normalsBuf){var p=q.transposeMat4(n,q.mat4()),d=q.inverseMat4(p);this._modelNormalMatrixCol0.push(d[0]),this._modelNormalMatrixCol0.push(d[4]),this._modelNormalMatrixCol0.push(d[8]),this._modelNormalMatrixCol0.push(d[12]),this._modelNormalMatrixCol1.push(d[1]),this._modelNormalMatrixCol1.push(d[5]),this._modelNormalMatrixCol1.push(d[9]),this._modelNormalMatrixCol1.push(d[13]),this._modelNormalMatrixCol2.push(d[2]),this._modelNormalMatrixCol2.push(d[6]),this._modelNormalMatrixCol2.push(d[10]),this._modelNormalMatrixCol2.push(d[14])}this._pickColors.push(u[0]),this._pickColors.push(u[1]),this._pickColors.push(u[2]),this._pickColors.push(u[3]),q.collapseAABB3(a);for(var f=this._state.geometry.obb,m=f.length,v=0;v<m;v+=4)Vl[0]=f[v+0],Vl[1]=f[v+1],Vl[2]=f[v+2],q.transformPoint4(n,Vl,zl),o?(q.transformPoint4(o,zl,Wl),q.expandAABB3Point3(a,Wl)):q.expandAABB3Point3(a,zl);if(this._state.origin){var g=this._state.origin;a[0]+=g[0],a[1]+=g[1],a[2]+=g[2],a[3]+=g[0],a[4]+=g[1],a[5]+=g[2]}q.expandAABB3(this.aabb,a),this._state.numInstances++;var _=this._portions.length,y={};return this.model.scene.pickSurfacePrecisionEnabled&&(y.matrix=n.slice(),y.inverseMatrix=null,y.normalMatrix=null),this._portions.push(y),this._numPortions++,this.model.numPortions++,_}},{key:"finalize",value:function(){if(this._finalized)throw"Already finalized";var e=this._state,t=e.geometry,i=e.textureSet,s=this.model.scene.canvas.gl,r=this._colors.length,n=r;if(r>0){this._state.colorsBuf=new lt(s,s.ARRAY_BUFFER,new Uint8Array(this._colors),this._colors.length,4,s.DYNAMIC_DRAW,!1),this._colors=[]}if(this._metallicRoughness.length>0){var o=new Uint8Array(this._metallicRoughness);this._state.metallicRoughnessBuf=new lt(s,s.ARRAY_BUFFER,o,this._metallicRoughness.length,2,s.STATIC_DRAW,!1)}if(n>0){this._state.flagsBuf=new lt(s,s.ARRAY_BUFFER,new Uint8Array(n),n,4,s.DYNAMIC_DRAW,!1),this._state.flags2Buf=new lt(s,s.ARRAY_BUFFER,new Uint8Array(n),n,4,s.DYNAMIC_DRAW,!0)}if(this.model.scene.entityOffsetsEnabled&&this._offsets.length>0){this._state.offsetsBuf=new lt(s,s.ARRAY_BUFFER,new Float32Array(this._offsets),this._offsets.length,3,s.DYNAMIC_DRAW,!1),this._offsets=[]}if(this._modelMatrixCol0.length>0){var a=!1;this._state.modelMatrixCol0Buf=new lt(s,s.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol0),this._modelMatrixCol0.length,4,s.STATIC_DRAW,a),this._state.modelMatrixCol1Buf=new lt(s,s.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol1),this._modelMatrixCol1.length,4,s.STATIC_DRAW,a),this._state.modelMatrixCol2Buf=new lt(s,s.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol2),this._modelMatrixCol2.length,4,s.STATIC_DRAW,a),this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._state.geometry.normalsBuf&&(this._state.modelNormalMatrixCol0Buf=new lt(s,s.ARRAY_BUFFER,new Float32Array(this._modelNormalMatrixCol0),this._modelNormalMatrixCol0.length,4,s.STATIC_DRAW,a),this._state.modelNormalMatrixCol1Buf=new lt(s,s.ARRAY_BUFFER,new Float32Array(this._modelNormalMatrixCol1),this._modelNormalMatrixCol1.length,4,s.STATIC_DRAW,a),this._state.modelNormalMatrixCol2Buf=new lt(s,s.ARRAY_BUFFER,new Float32Array(this._modelNormalMatrixCol2),this._modelNormalMatrixCol2.length,4,s.STATIC_DRAW,a),this._modelNormalMatrixCol0=[],this._modelNormalMatrixCol1=[],this._modelNormalMatrixCol2=[])}if(this._pickColors.length>0){this._state.pickColorsBuf=new lt(s,s.ARRAY_BUFFER,new Uint8Array(this._pickColors),this._pickColors.length,4,s.STATIC_DRAW,!1),this._pickColors=[]}this._state.pbrSupported=!!(e.metallicRoughnessBuf&&t.uvBuf&&t.normalsBuf&&i&&i.colorTexture&&i.metallicRoughnessTexture),this._state.colorTextureSupported=!!t.uvBuf&&!!i&&!!i.colorTexture,this._finalized=!0}},{key:"initFlags",value:function(e,t,i){t&me&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&xe&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&be&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&Pe&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&_e&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&Te&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&ge&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&ve&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),i&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(e,t,i),this._setFlags2(e,t)}},{key:"setVisible",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&me?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,i)}},{key:"setHighlighted",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&xe?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,i)}},{key:"setXRayed",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&be?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,i)}},{key:"setSelected",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Pe?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,i)}},{key:"setEdges",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Te?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,i)}},{key:"setClippable",value:function(e,t){if(!this._finalized)throw"Not finalized";t&_e?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}},{key:"setCollidable",value:function(e,t){if(!this._finalized)throw"Not finalized"}},{key:"setPickable",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&ge?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(e,t,i)}},{key:"setCulled",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&ve?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,i)}},{key:"setColor",value:function(e,t){if(!this._finalized)throw"Not finalized";Ul[0]=t[0],Ul[1]=t[1],Ul[2]=t[2],Ul[3]=t[3],this._state.colorsBuf&&this._state.colorsBuf.setData(Ul,4*e,4)}},{key:"setTransparent",value:function(e,t,i){i?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,i)}},{key:"_setFlags",value:function(e,t,i){if(!this._finalized)throw"Not finalized";var s,r,n=!!(t&me),o=!!(t&be),a=!!(t&xe),u=!!(t&Pe),h=!!(t&Te),l=!!(t&ge),c=!!(t&ve);s=!n||c||o||a&&!this.model.scene.highlightMaterial.glowThrough||u&&!this.model.scene.selectedMaterial.glowThrough?Gu:i?Uu:Hu,r=!n||c?Gu:u?zu:a?Vu:o?Wu:Gu;var p=0;p=!n||c?Gu:u?Ju:a?Ku:o?Zu:h?i?Yu:Xu:Gu;var d=n&&!c&&l?Qu:Gu;Ul[0]=s,Ul[1]=r,Ul[2]=p,Ul[3]=d,this._state.flagsBuf&&this._state.flagsBuf.setData(Ul,4*e,4)}},{key:"_setFlags2",value:function(e,t){if(!this._finalized)throw"Not finalized";var i=t&_e?255:0;Ul[0]=i,this._state.flags2Buf&&this._state.flags2Buf.setData(Ul,4*e,4)}},{key:"setOffset",value:function(e,t){if(!this._finalized)throw"Not finalized";this.model.scene.entityOffsetsEnabled?(Xl[0]=t[0],Xl[1]=t[1],Xl[2]=t[2],this._state.offsetsBuf&&this._state.offsetsBuf.setData(Xl,3*e,3)):this.model.error("Entity#offset not enabled for this Viewer")}},{key:"drawColorOpaque",value:function(e,t){if(this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions){this._updateBackfaceCull(e,t);var i=this._state.geometry;t.withSAO&&this.model.saoEnabled?t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._instancingRenderers.pbrRendererWithSAO&&this._instancingRenderers.pbrRendererWithSAO.drawLayer(t,this,Hu):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._instancingRenderers.colorTextureRendererWithSAO&&this._instancingRenderers.colorTextureRendererWithSAO.drawLayer(t,this,Hu):i.normalsBuf?this._instancingRenderers.colorRendererWithSAO&&this._instancingRenderers.colorRendererWithSAO.drawLayer(t,this,Hu):this._instancingRenderers.flatColorRendererWithSAO&&this._instancingRenderers.flatColorRendererWithSAO.drawLayer(t,this,Hu):t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._instancingRenderers.pbrRenderer&&this._instancingRenderers.pbrRenderer.drawLayer(t,this,Hu):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._instancingRenderers.colorTextureRenderer&&this._instancingRenderers.colorTextureRenderer.drawLayer(t,this,Hu):i.normalsBuf?this._instancingRenderers.colorRenderer&&this._instancingRenderers.colorRenderer.drawLayer(t,this,Hu):this._instancingRenderers.flatColorRenderer&&this._instancingRenderers.flatColorRenderer.drawLayer(t,this,Hu)}}},{key:"_updateBackfaceCull",value:function(e,t){var i=this.model.backfaces||!this.solid||e.sectioned;if(t.backfaces!==i){var s=t.gl;i?s.disable(s.CULL_FACE):s.enable(s.CULL_FACE),t.backfaces=i}}},{key:"drawColorTransparent",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._instancingRenderers.pbrRenderer&&this._instancingRenderers.pbrRenderer.drawLayer(t,this,Uu):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._instancingRenderers.colorTextureRenderer&&this._instancingRenderers.colorTextureRenderer.drawLayer(t,this,Uu):this._state.normalsBuf?this._instancingRenderers.colorRenderer&&this._instancingRenderers.colorRenderer.drawLayer(t,this,Uu):this._instancingRenderers.flatColorRenderer&&this._instancingRenderers.flatColorRenderer.drawLayer(t,this,Uu))}},{key:"drawDepth",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.depthRenderer&&this._instancingRenderers.depthRenderer.drawLayer(t,this,Hu))}},{key:"drawNormals",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.normalsRenderer&&this._instancingRenderers.normalsRenderer.drawLayer(t,this,Hu))}},{key:"drawSilhouetteXRayed",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.silhouetteRenderer&&this._instancingRenderers.silhouetteRenderer.drawLayer(t,this,Wu))}},{key:"drawSilhouetteHighlighted",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.silhouetteRenderer&&this._instancingRenderers.silhouetteRenderer.drawLayer(t,this,Vu))}},{key:"drawSilhouetteSelected",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.silhouetteRenderer&&this._instancingRenderers.silhouetteRenderer.drawLayer(t,this,zu))}},{key:"drawEdgesColorOpaque",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&this._instancingRenderers.edgesColorRenderer&&this._instancingRenderers.edgesColorRenderer.drawLayer(t,this,Xu)}},{key:"drawEdgesColorTransparent",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&this._instancingRenderers.edgesColorRenderer&&this._instancingRenderers.edgesColorRenderer.drawLayer(t,this,Yu)}},{key:"drawEdgesXRayed",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._instancingRenderers.edgesRenderer&&this._instancingRenderers.edgesRenderer.drawLayer(t,this,Zu)}},{key:"drawEdgesHighlighted",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._instancingRenderers.edgesRenderer&&this._instancingRenderers.edgesRenderer.drawLayer(t,this,Ku)}},{key:"drawEdgesSelected",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._instancingRenderers.edgesRenderer&&this._instancingRenderers.edgesRenderer.drawLayer(t,this,Ju)}},{key:"drawOcclusion",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.occlusionRenderer&&this._instancingRenderers.occlusionRenderer.drawLayer(t,this,Hu))}},{key:"drawShadow",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.shadowRenderer&&this._instancingRenderers.shadowRenderer.drawLayer(t,this,Hu))}},{key:"drawPickMesh",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.pickMeshRenderer&&this._instancingRenderers.pickMeshRenderer.drawLayer(t,this,Qu))}},{key:"drawPickDepths",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.pickDepthRenderer&&this._instancingRenderers.pickDepthRenderer.drawLayer(t,this,Qu))}},{key:"drawPickNormals",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.pickNormalsRenderer&&this._instancingRenderers.pickNormalsRenderer.drawLayer(t,this,Qu))}},{key:"precisionRayPickSurface",value:function(e,t,i,s,r){if(!this.model.scene.pickSurfacePrecisionEnabled)return!1;var n=this._state.geometry,o=this._state,a=this._portions[e];if(!a)return this.model.error("portion not found: "+e),!1;a.inverseMatrix||(a.inverseMatrix=q.inverseMat4(a.matrix,q.mat4())),r&&!a.normalMatrix&&(a.normalMatrix=q.transposeMat4(a.inverseMatrix,q.mat4()));var u=n.quantizedPositions,h=n.indices,l=o.origin,c=a.offset,p=Yl,d=Kl;p.set(l?q.subVec3(t,l,Jl):t),d.set(i),c&&q.subVec3(p,c),q.transformRay(this.model.worldNormalMatrix,p,d,p,d),q.transformRay(a.inverseMatrix,p,d,p,d);for(var f=Zl,m=Ql,v=ql,g=!1,_=0,y=$l,b=0,x=h.length;b<x;b+=3){var P=3*h[b+0],T=3*h[b+1],w=3*h[b+2];if(f[0]=u[P],f[1]=u[P+1],f[2]=u[P+2],m[0]=u[T],m[1]=u[T+1],m[2]=u[T+2],v[0]=u[w],v[1]=u[w+1],v[2]=u[w+2],q.decompressPosition(f,o.positionsDecodeMatrix),q.decompressPosition(m,o.positionsDecodeMatrix),q.decompressPosition(v,o.positionsDecodeMatrix),q.rayTriangleIntersect(p,d,f,m,v,y)){q.transformPoint3(a.matrix,y,y),q.transformPoint3(this.model.worldMatrix,y,y),c&&q.addVec3(y,c),l&&q.addVec3(y,l);var M=Math.abs(q.lenVec3(q.subVec3(y,t,[])));(!g||M>_)&&(_=M,s.set(y),r&&q.triangleNormal(f,m,v,r),g=!0)}}return g&&r&&(q.transformVec3(a.normalMatrix,r,r),q.transformVec3(this.model.worldNormalMatrix,r,r),q.normalizeVec3(r)),g}},{key:"destroy",value:function(){var e=this._state;e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.metallicRoughnessBuf&&(e.metallicRoughnessBuf.destroy(),e.metallicRoughnessBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.modelMatrixCol0Buf&&(e.modelMatrixCol0Buf.destroy(),e.modelMatrixCol0Buf=null),e.modelMatrixCol1Buf&&(e.modelMatrixCol1Buf.destroy(),e.modelMatrixCol1Buf=null),e.modelMatrixCol2Buf&&(e.modelMatrixCol2Buf.destroy(),e.modelMatrixCol2Buf=null),e.modelNormalMatrixCol0Buf&&(e.modelNormalMatrixCol0Buf.destroy(),e.modelNormalMatrixCol0Buf=null),e.modelNormalMatrixCol1Buf&&(e.modelNormalMatrixCol1Buf.destroy(),e.modelNormalMatrixCol1Buf=null),e.modelNormalMatrixCol2Buf&&(e.modelNormalMatrixCol2Buf.destroy(),e.modelNormalMatrixCol2Buf=null),e.pickColorsBuf&&(e.pickColorsBuf.destroy(),e.pickColorsBuf=null),e.destroy()}}]),e}(),tc=q.vec3(),ic=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=this._scene,r=s.camera,n=t.model,o=s.canvas.gl,a=t._state,u=t._state.origin;if(t.geometry,this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(r.viewMatrix,u):r.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,n.worldMatrix),o.lineWidth(s.linesMaterial.lineWidth);var h=s._sectionPlanesState.sectionPlanes.length;if(h>0)for(var l=s._sectionPlanesState.sectionPlanes,c=t.layerIndex*h,p=n.renderFlags,d=0;d<h;d++){var f=this._uSectionPlanes[d];if(f){var m=p.sectionPlanesActivePerLayer[c+d];if(o.uniform1i(f.active,m?1:0),m){var v=l[d];if(u){var g=Ee(v.dist,v.dir,u,tc);o.uniform3fv(f.pos,g)}else o.uniform3fv(f.pos,v.pos);o.uniform3fv(f.dir,v.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),a.indicesBuf.bind(),o.drawElements(o.LINES,a.indicesBuf.numItems,a.indicesBuf.itemType,0),e.drawElements++}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(e){var t=this._scene,i=t.canvas.gl,s=this._program,r=t.camera.project;if(s.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),t.logarithmicDepthBufferEnabled){var n=2/(Math.log(r.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,n)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Lines batching color vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),i.push("in vec4 color;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Lines batching color fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return s.push("   outColor            = vColor;"),e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),sc=new Float32Array([1,1,1]),rc=q.vec3(),nc=function(){function e(t,i){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin;if(t.geometry,this._program||(this._allocate(),!this.errors)){if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),i===Wu){var h=r.xrayMaterial._state,l=h.fillColor,c=h.fillAlpha;o.uniform4f(this._uColor,l[0],l[1],l[2],c)}else if(i===Vu){var p=r.highlightMaterial._state,d=p.fillColor,f=p.fillAlpha;o.uniform4f(this._uColor,d[0],d[1],d[2],f)}else if(i===zu){var m=r.selectedMaterial._state,v=m.fillColor,g=m.fillAlpha;o.uniform4f(this._uColor,v[0],v[1],v[2],g)}else o.uniform4fv(this._uColor,sc);var _=u?De(n.viewMatrix,u):n.viewMatrix;o.uniformMatrix4fv(this._uViewMatrix,!1,_),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.lineWidth(r.linesMaterial.lineWidth);var y=r._sectionPlanesState.sectionPlanes.length;if(y>0)for(var b=r._sectionPlanesState.sectionPlanes,x=t.layerIndex*y,P=s.renderFlags,T=0;T<y;T++){var w=this._uSectionPlanes[T];if(w){var M=P.sectionPlanesActivePerLayer[x+T];if(o.uniform1i(w.active,M?1:0),M){var I=b[T];if(u){var C=Ee(I.dist,I.dir,u,rc);o.uniform3fv(w.pos,C)}else o.uniform3fv(w.pos,I.pos);o.uniform3fv(w.dir,I.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),o.drawElements(o.LINES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uColor=i.getLocation("color"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Lines batching silhouette vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform vec4 color;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.y) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Lines batching silhouette fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("uniform vec4 color;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("outColor = color;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),oc=function(){function e(t){w(this,e),this._scene=t}return I(e,[{key:"_compile",value:function(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null)}},{key:"colorRenderer",get:function(){return this._colorRenderer||(this._colorRenderer=new ic(this._scene,!1)),this._colorRenderer}},{key:"silhouetteRenderer",get:function(){return this._silhouetteRenderer||(this._silhouetteRenderer=new nc(this._scene)),this._silhouetteRenderer}},{key:"_destroy",value:function(){this._colorRenderer&&this._colorRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy()}}]),e}(),ac={};var uc=I((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e6;w(this,e),t>5e6&&(t=5e6),this.maxVerts=t,this.maxIndices=3*t,this.positions=[],this.colors=[],this.flags=[],this.flags2=[],this.offsets=[],this.indices=[]})),hc=q.vec4([0,0,0,1]),lc=q.vec4([0,0,0,1]),cc=q.vec4([0,0,0,1]),pc=q.OBB3(),dc=function(){function e(t){var i,s,r;w(this,e),this.layerIndex=t.layerIndex,this._batchingRenderers=(i=t.model.scene,s=i.id,(r=ac[s])||(r=new oc(i),ac[s]=r,r._compile(),i.on("compile",(function(){r._compile()})),i.on("destroyed",(function(){delete ac[s],r._destroy()}))),r),this.model=t.model,this._buffer=new uc(t.maxGeometryBatchSize),this._scratchMemory=t.scratchMemory,this._state=new ti({positionsBuf:null,offsetsBuf:null,colorsBuf:null,flagsBuf:null,flags2Buf:null,indicesBuf:null,positionsDecodeMatrix:q.mat4(),origin:null}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numSelectedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._modelAABB=q.collapseAABB3(),this._portions=[],this._numVerts=0,this._finalized=!1,t.positionsDecodeMatrix?(this._state.positionsDecodeMatrix.set(t.positionsDecodeMatrix),this._preCompressedPositionsExpected=!0):this._preCompressedPositionsExpected=!1,t.origin&&(this._state.origin=q.vec3(t.origin)),this.aabb=q.collapseAABB3()}return I(e,[{key:"canCreatePortion",value:function(e,t){if(this._finalized)throw"Already finalized";return this._buffer.positions.length+e<3*this._buffer.maxVerts&&this._buffer.indices.length+t<this._buffer.maxIndices}},{key:"createPortion",value:function(e){if(this._finalized)throw"Already finalized";var t=e.positions,i=e.positionsCompressed,s=e.indices,r=e.color,n=e.opacity,o=e.meshMatrix,a=e.worldMatrix,u=e.worldAABB;e.pickColor;var h,l=this._buffer,c=l.positions.length/3;if(this._preCompressedPositionsExpected){if(!i)throw"positionsCompressed expected";h=i.length/3;for(var p=0,d=i.length;p<d;p++)l.positions.push(i[p]);var f=ui.getPositionsBounds(i),m=ui.decompressPosition(f.min,this._state.positionsDecodeMatrix,[]),v=ui.decompressPosition(f.max,this._state.positionsDecodeMatrix,[]);u[0]=m[0],u[1]=m[1],u[2]=m[2],u[3]=v[0],u[4]=v[1],u[5]=v[2],a&&(q.AABB3ToOBB3(u,pc),q.transformOBB3(a,pc),q.OBB3ToAABB3(pc,u))}else{if(!t)throw"positions expected";h=t.length/3;for(var g=t.length,_=l.positions.length,y=0,b=t.length;y<b;y++)l.positions.push(t[y]);if(o)for(var x=_,P=_+g;x<P;x+=3)hc[0]=l.positions[x+0],hc[1]=l.positions[x+1],hc[2]=l.positions[x+2],q.transformPoint4(o,hc,lc),l.positions[x+0]=lc[0],l.positions[x+1]=lc[1],l.positions[x+2]=lc[2],q.expandAABB3Point3(this._modelAABB,lc),a?(q.transformPoint4(a,lc,cc),q.expandAABB3Point3(u,cc)):q.expandAABB3Point3(u,lc);else for(var T=_,w=_+g;T<w;T+=3)hc[0]=l.positions[T+0],hc[1]=l.positions[T+1],hc[2]=l.positions[T+2],q.expandAABB3Point3(this._modelAABB,hc),a?(q.transformPoint4(a,hc,lc),q.expandAABB3Point3(u,lc)):q.expandAABB3Point3(u,hc)}if(this._state.origin){var M=this._state.origin;u[0]+=M[0],u[1]+=M[1],u[2]+=M[2],u[3]+=M[0],u[4]+=M[1],u[5]+=M[2]}if(q.expandAABB3(this.aabb,u),r)for(var I=r[0],C=r[1],D=r[2],A=n,k=0;k<h;k++)l.colors.push(I),l.colors.push(C),l.colors.push(D),l.colors.push(A);if(s)for(var E=0,F=s.length;E<F;E++)l.indices.push(s[E]+c);if(this.model.scene.entityOffsetsEnabled)for(var R=0;R<h;R++)l.offsets.push(0),l.offsets.push(0),l.offsets.push(0);var S=this._portions.length/2;return this._portions.push(c),this._portions.push(h),this._numPortions++,this.model.numPortions++,this._numVerts+=h,S}},{key:"finalize",value:function(){if(this._finalized)this.model.error("Already finalized");else{var e=this._state,t=this.model.scene.canvas.gl,i=this._buffer;if(i.positions.length>0)if(this._preCompressedPositionsExpected){var s=new Uint16Array(i.positions);e.positionsBuf=new lt(t,t.ARRAY_BUFFER,s,i.positions.length,3,t.STATIC_DRAW)}else{var r=jh(new Float32Array(i.positions),this._modelAABB,e.positionsDecodeMatrix);e.positionsBuf=new lt(t,t.ARRAY_BUFFER,r,i.positions.length,3,t.STATIC_DRAW)}if(i.colors.length>0){var n=new Uint8Array(i.colors);e.colorsBuf=new lt(t,t.ARRAY_BUFFER,n,i.colors.length,4,t.DYNAMIC_DRAW,!1)}if(i.colors.length>0){var o=i.colors.length,a=new Uint8Array(o),u=new Uint8Array(o);e.flagsBuf=new lt(t,t.ARRAY_BUFFER,a,a.length,4,t.DYNAMIC_DRAW,!1),e.flags2Buf=new lt(t,t.ARRAY_BUFFER,u,u.length,4,t.DYNAMIC_DRAW,!0)}if(this.model.scene.entityOffsetsEnabled&&i.offsets.length>0){var h=new Float32Array(i.offsets);e.offsetsBuf=new lt(t,t.ARRAY_BUFFER,h,i.offsets.length,3,t.DYNAMIC_DRAW)}if(i.indices.length>0){var l=new Uint32Array(i.indices);e.indicesBuf=new lt(t,t.ELEMENT_ARRAY_BUFFER,l,i.indices.length,1,t.STATIC_DRAW)}this._buffer=null,this._finalized=!0}}},{key:"initFlags",value:function(e,t,i){t&me&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&xe&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&be&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&Pe&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&_e&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&Te&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&ge&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&ve&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),i&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++);this._setFlags(e,t,i,true),this._setFlags2(e,t,true)}},{key:"flushInitFlags",value:function(){this._setDeferredFlags(),this._setDeferredFlags2()}},{key:"setVisible",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&me?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,i)}},{key:"setHighlighted",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&xe?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,i)}},{key:"setXRayed",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&be?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,i)}},{key:"setSelected",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Pe?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,i)}},{key:"setEdges",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Te?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,i)}},{key:"setClippable",value:function(e,t){if(!this._finalized)throw"Not finalized";t&_e?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}},{key:"setCulled",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&ve?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,i)}},{key:"setCollidable",value:function(e,t){if(!this._finalized)throw"Not finalized"}},{key:"setPickable",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&ge?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(e,t,i)}},{key:"setColor",value:function(e,t){if(!this._finalized)throw"Not finalized";for(var i=2*e,s=4*this._portions[i],r=4*this._portions[i+1],n=this._scratchMemory.getUInt8Array(r),o=t[0],a=t[1],u=t[2],h=t[3],l=0;l<r;l+=4)n[l+0]=o,n[l+1]=a,n[l+2]=u,n[l+3]=h;this._state.colorsBuf.setData(n,s,r)}},{key:"setTransparent",value:function(e,t,i){i?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,i)}},{key:"_setFlags",value:function(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!this._finalized)throw"Not finalized";var r=2*e,n=this._portions[r],o=this._portions[r+1],a=4*n,u=4*o;this._scratchMemory.getUInt8Array(u);var h,l,c=!!(t&me),p=!!(t&be),d=!!(t&xe),f=!!(t&Pe),m=!!(t&ge),v=!!(t&ve);h=!c||v||p||d&&!this.model.scene.highlightMaterial.glowThrough||f&&!this.model.scene.selectedMaterial.glowThrough?Gu:i?Uu:Hu,l=!c||v?Gu:f?zu:d?Vu:p?Wu:Gu;var g=c&&!v&&m?Qu:Gu;if(s){this._deferredFlagValues||(this._deferredFlagValues=new Uint8Array(4*this._numVerts));for(var _=a,y=a+u;_<y;_+=4)this._deferredFlagValues[_+0]=h,this._deferredFlagValues[_+1]=l,this._deferredFlagValues[_+2]=0,this._deferredFlagValues[_+3]=g}else if(this._state.flagsBuf){for(var b=this._scratchMemory.getUInt8Array(u),x=0;x<u;x+=4)b[x+0]=h,b[x+1]=l,b[x+2]=0,b[x+3]=g;this._state.flagsBuf.setData(b,a,u)}}},{key:"_setDeferredFlags",value:function(){this._deferredFlagValues&&(this._state.flagsBuf.setData(this._deferredFlagValues),this._deferredFlagValues=null)}},{key:"_setFlags2",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._finalized)throw"Not finalized";var s=2*e,r=this._portions[s],n=this._portions[s+1],o=4*r,a=4*n,u=t&_e?255:0;if(i){this._setDeferredFlag2Values||(this._setDeferredFlag2Values=new Uint8Array(4*this._numVerts));for(var h=o,l=o+a;h<l;h+=4)this._setDeferredFlag2Values[h]=u}else{for(var c=this._scratchMemory.getUInt8Array(a),p=0;p<a;p+=4)c[p+0]=u;this._state.flags2Buf.setData(c,o,a)}}},{key:"_setDeferredFlags2",value:function(){this._setDeferredFlag2Values&&(this._state.flags2Buf.setData(this._setDeferredFlag2Values),this._setDeferredFlag2Values=null)}},{key:"setOffset",value:function(e,t){if(!this._finalized)throw"Not finalized";if(this.model.scene.entityOffsetsEnabled){for(var i=2*e,s=3*this._portions[i],r=3*this._portions[i+1],n=this._scratchMemory.getFloat32Array(r),o=t[0],a=t[1],u=t[2],h=0;h<r;h+=3)n[h+0]=o,n[h+1]=a,n[h+2]=u;this._state.offsetsBuf.setData(n,s,r)}else this.model.error("Entity#offset not enabled for this Viewer")}},{key:"drawColorOpaque",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(t,this,Hu)}},{key:"drawColorTransparent",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(t,this,Uu)}},{key:"drawDepth",value:function(e,t){}},{key:"drawNormals",value:function(e,t){}},{key:"drawSilhouetteXRayed",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,Wu)}},{key:"drawSilhouetteHighlighted",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,Vu)}},{key:"drawSilhouetteSelected",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,zu)}},{key:"drawEdgesColorOpaque",value:function(e,t){}},{key:"drawEdgesColorTransparent",value:function(e,t){}},{key:"drawEdgesHighlighted",value:function(e,t){}},{key:"drawEdgesSelected",value:function(e,t){}},{key:"drawEdgesXRayed",value:function(e,t){}},{key:"drawPickMesh",value:function(e){}},{key:"drawPickDepths",value:function(e){}},{key:"drawPickNormals",value:function(e){}},{key:"drawOcclusion",value:function(e){}},{key:"drawShadow",value:function(e){}},{key:"destroy",value:function(){var e=this._state;e.positionsBuf&&(e.positionsBuf.destroy(),e.positionsBuf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.indicesBuf&&(e.indicesBuf.destroy(),e.indicesBuf=null),e.destroy()}}]),e}(),fc=q.vec3(),mc=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin,h=t.geometry;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(n.viewMatrix,u):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.lineWidth(r.linesMaterial.lineWidth);var l=r._sectionPlanesState.sectionPlanes.length;if(l>0)for(var c=r._sectionPlanesState.sectionPlanes,p=t.layerIndex*l,d=s.renderFlags,f=0;f<l;f++){var m=this._uSectionPlanes[f];if(m){var v=d.sectionPlanesActivePerLayer[p+f];if(o.uniform1i(m.active,v?1:0),v){var g=c[f];if(u){var _=Ee(g.dist,g.dir,u,fc);o.uniform3fv(m.pos,_)}else o.uniform3fv(m.pos,g.pos);o.uniform3fv(m.dir,g.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),o.vertexAttribDivisor(this._aColor.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),h.indicesBuf.bind(),o.drawElementsInstanced(o.LINES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,a.numInstances),e.drawElements++,o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aColor.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aOffset=i.getAttribute("offset"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Lines instancing color vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),i.push("in vec4 color;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),i.push("uniform vec4 lightAmbient;"),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0,  float(color.a) / 255.0);"),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e,t,i=this._scene,s=i._sectionPlanesState,r=s.sectionPlanes.length>0,n=[];if(n.push("#version 300 es"),n.push("// Lines instancing color fragment shader"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),i.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),n.push("in float vFragDepth;")),r)for(n.push("in vec4 vWorldPosition;"),n.push("in vec4 vFlags2;"),e=0,t=s.sectionPlanes.length;e<t;e++)n.push("uniform bool sectionPlaneActive"+e+";"),n.push("uniform vec3 sectionPlanePos"+e+";"),n.push("uniform vec3 sectionPlaneDir"+e+";");if(n.push("in vec4 vColor;"),n.push("out vec4 outColor;"),n.push("void main(void) {"),r){for(n.push("  bool clippable = (float(vFlags2.x) > 0.0);"),n.push("  if (clippable) {"),n.push("  float dist = 0.0;"),e=0,t=s.sectionPlanes.length;e<t;e++)n.push("if (sectionPlaneActive"+e+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),n.push("}");n.push("if (dist > 0.0) { discard; }"),n.push("}")}return this._withSAO?(n.push("   float viewportWidth     = uSAOParams[0];"),n.push("   float viewportHeight    = uSAOParams[1];"),n.push("   float blendCutoff       = uSAOParams[2];"),n.push("   float blendFactor       = uSAOParams[3];"),n.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),n.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBAToDepth(texture(uOcclusionTexture, uv))) * blendFactor;"),n.push("   outColor            = vec4(vColor.rgb * ambient, vColor.a);")):n.push("    outColor           = vColor;"),i.logarithmicDepthBufferEnabled&&n.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("}"),n}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),vc=q.vec3(),gc=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin,h=t.geometry;if(this._program||(this._allocate(t.model.scene),!this.errors)){if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),i===Wu){var l=r.xrayMaterial._state,c=l.fillColor,p=l.fillAlpha;o.uniform4f(this._uColor,c[0],c[1],c[2],p)}else if(i===Vu){var d=r.highlightMaterial._state,f=d.fillColor,m=d.fillAlpha;o.uniform4f(this._uColor,f[0],f[1],f[2],m)}else if(i===zu){var v=r.selectedMaterial._state,g=v.fillColor,_=v.fillAlpha;o.uniform4f(this._uColor,g[0],g[1],g[2],_)}else o.uniform4fv(this._uColor,q.vec3([1,1,1]));o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(n.viewMatrix,u):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.lineWidth(r.linesMaterial.lineWidth);var y=r._sectionPlanesState.sectionPlanes.length;if(y>0)for(var b=r._sectionPlanesState.sectionPlanes,x=t.layerIndex*y,P=s.renderFlags,T=0;T<y;T++){var w=this._uSectionPlanes[T];if(w){var M=P.sectionPlanesActivePerLayer[x+T];if(o.uniform1i(w.active,M?1:0),M){var I=b[T];if(u){var C=Ee(I.dist,I.dir,u,vc);o.uniform3fv(w.pos,C)}else o.uniform3fv(w.pos,I.pos);o.uniform3fv(w.dir,I.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf,o.UNSIGNED_BYTE,!0),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,o.UNSIGNED_BYTE,!0),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),h.indicesBuf.bind(),o.drawElementsInstanced(o.LINES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uColor=s.getLocation("color"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Lines instancing silhouette vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),i.push("uniform vec4 color;"),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.y) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("gl_Position = clipPos;"),i.push("}"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Lines instancing silhouette fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("uniform vec4 color;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("outColor = color;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),_c=function(){function e(t){w(this,e),this._scene=t}return I(e,[{key:"_compile",value:function(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null)}},{key:"colorRenderer",get:function(){return this._colorRenderer||(this._colorRenderer=new mc(this._scene)),this._colorRenderer}},{key:"silhouetteRenderer",get:function(){return this._silhouetteRenderer||(this._silhouetteRenderer=new gc(this._scene)),this._silhouetteRenderer}},{key:"_destroy",value:function(){this._colorRenderer&&this._colorRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy()}}]),e}(),yc={};var bc=new Uint8Array(4),xc=q.vec4([0,0,0,1]),Pc=q.vec4([0,0,0,1]),Tc=q.vec4([0,0,0,1]),wc=new Float32Array(3),Mc=function(){function e(t){var i,s,r;w(this,e),this.model=t.model,this.geometry=t.geometry,this.material=t.material,this.sortId="LinesInstancingLayer",this.layerIndex=t.layerIndex,this._linesInstancingRenderers=(i=t.model.scene,s=i.id,(r=yc[s])||(r=new _c(i),yc[s]=r,r._compile(),i.on("compile",(function(){r._compile()})),i.on("destroyed",(function(){delete yc[s],r._destroy()}))),r),this._aabb=q.collapseAABB3(),this._state=new ti({obb:q.OBB3(),numInstances:0,origin:null}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numSelectedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this.numIndices=t.geometry.numIndices,this._colors=[],this._offsets=[],this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._portions=[],t.origin&&(this._state.origin=q.vec3(t.origin)),this._finalized=!1,this.aabb=q.collapseAABB3()}return I(e,[{key:"createPortion",value:function(e){var t=e.color,i=e.opacity,s=e.meshMatrix,r=e.worldMatrix,n=e.aabb;if(this._finalized)throw"Already finalized";var o=t[0],a=t[1],u=t[2];t[3],this._colors.push(o),this._colors.push(a),this._colors.push(u),this._colors.push(i),this.model.scene.entityOffsetsEnabled&&(this._offsets.push(0),this._offsets.push(0),this._offsets.push(0)),this._modelMatrixCol0.push(s[0]),this._modelMatrixCol0.push(s[4]),this._modelMatrixCol0.push(s[8]),this._modelMatrixCol0.push(s[12]),this._modelMatrixCol1.push(s[1]),this._modelMatrixCol1.push(s[5]),this._modelMatrixCol1.push(s[9]),this._modelMatrixCol1.push(s[13]),this._modelMatrixCol2.push(s[2]),this._modelMatrixCol2.push(s[6]),this._modelMatrixCol2.push(s[10]),this._modelMatrixCol2.push(s[14]),q.collapseAABB3(n);for(var h=this._state.obb,l=h.length,c=0;c<l;c+=4)xc[0]=h[c+0],xc[1]=h[c+1],xc[2]=h[c+2],q.transformPoint4(s,xc,Pc),r?(q.transformPoint4(r,Pc,Tc),q.expandAABB3Point3(n,Tc)):q.expandAABB3Point3(n,Pc);if(this._state.origin){var p=this._state.origin;n[0]+=p[0],n[1]+=p[1],n[2]+=p[2],n[3]+=p[0],n[4]+=p[1],n[5]+=p[2]}q.expandAABB3(this.aabb,n),this._state.numInstances++;var d=this._portions.length;return this._portions.push({}),this._numPortions++,this.model.numPortions++,d}},{key:"finalize",value:function(){if(this._finalized)throw"Already finalized";var e=this.model.scene.canvas.gl,t=this._colors.length,i=t;if(t>0){this._state.colorsBuf=new lt(e,e.ARRAY_BUFFER,new Uint8Array(this._colors),this._colors.length,4,e.DYNAMIC_DRAW,!1),this._colors=[]}if(i>0){this._state.flagsBuf=new lt(e,e.ARRAY_BUFFER,new Uint8Array(i),i,4,e.DYNAMIC_DRAW,!1),this._state.flags2Buf=new lt(e,e.ARRAY_BUFFER,new Uint8Array(i),i,4,e.DYNAMIC_DRAW,!0)}if(this.model.scene.entityOffsetsEnabled&&this._offsets.length>0){this._state.offsetsBuf=new lt(e,e.ARRAY_BUFFER,new Float32Array(this._offsets),this._offsets.length,3,e.DYNAMIC_DRAW,!1),this._offsets=[]}if(this._modelMatrixCol0.length>0){var s=!1;this._state.modelMatrixCol0Buf=new lt(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol0),this._modelMatrixCol0.length,4,e.STATIC_DRAW,s),this._state.modelMatrixCol1Buf=new lt(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol1),this._modelMatrixCol1.length,4,e.STATIC_DRAW,s),this._state.modelMatrixCol2Buf=new lt(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol2),this._modelMatrixCol2.length,4,e.STATIC_DRAW,s),this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[]}this._finalized=!0}},{key:"initFlags",value:function(e,t,i){t&me&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&xe&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&be&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&Pe&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&_e&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&Te&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&ge&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&ve&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),i&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(e,t,i),this._setFlags2(e,t)}},{key:"setVisible",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&me?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,i)}},{key:"setHighlighted",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&xe?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,i)}},{key:"setXRayed",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&be?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,i)}},{key:"setSelected",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Pe?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,i)}},{key:"setEdges",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Te?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,i)}},{key:"setClippable",value:function(e,t){if(!this._finalized)throw"Not finalized";t&_e?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}},{key:"setCollidable",value:function(e,t){if(!this._finalized)throw"Not finalized"}},{key:"setPickable",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&ge?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags2(e,t,i)}},{key:"setCulled",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&ve?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,i)}},{key:"setColor",value:function(e,t){if(!this._finalized)throw"Not finalized";bc[0]=t[0],bc[1]=t[1],bc[2]=t[2],bc[3]=t[3],this._state.colorsBuf.setData(bc,4*e,4)}},{key:"setTransparent",value:function(e,t,i){i?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,i)}},{key:"_setFlags",value:function(e,t,i){if(!this._finalized)throw"Not finalized";var s,r,n=!!(t&me),o=!!(t&be),a=!!(t&xe),u=!!(t&Pe),h=!!(t&Te),l=!!(t&ge),c=!!(t&ve);s=!n||c||o||a&&!this.model.scene.highlightMaterial.glowThrough||u&&!this.model.scene.selectedMaterial.glowThrough?Gu:i?Uu:Hu,r=!n||c?Gu:u?zu:a?Vu:o?Wu:Gu;var p=0;p=!n||c?Gu:u?Ju:a?Ku:o?Zu:h?i?Yu:Xu:Gu;var d=n&&!c&&l?Qu:Gu;bc[0]=s,bc[1]=r,bc[2]=p,bc[3]=d,this._state.flagsBuf.setData(bc,4*e,4)}},{key:"_setFlags2",value:function(e,t){if(!this._finalized)throw"Not finalized";var i=t&_e?255:0;bc[0]=i,this._state.flags2Buf.setData(bc,4*e,4)}},{key:"setOffset",value:function(e,t){if(!this._finalized)throw"Not finalized";this.model.scene.entityOffsetsEnabled?(wc[0]=t[0],wc[1]=t[1],wc[2]=t[2],this._state.offsetsBuf.setData(wc,3*e,3)):this.model.error("Entity#offset not enabled for this Viewer")}},{key:"drawColorOpaque",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._linesInstancingRenderers.colorRenderer&&this._linesInstancingRenderers.colorRenderer.drawLayer(t,this,Hu)}},{key:"drawColorTransparent",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._linesInstancingRenderers.colorRenderer&&this._linesInstancingRenderers.colorRenderer.drawLayer(t,this,Uu)}},{key:"drawDepth",value:function(e,t){}},{key:"drawNormals",value:function(e,t){}},{key:"drawSilhouetteXRayed",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._linesInstancingRenderers.silhouetteRenderer&&this._linesInstancingRenderers.silhouetteRenderer.drawLayer(t,this,Wu)}},{key:"drawSilhouetteHighlighted",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._linesInstancingRenderers.silhouetteRenderer&&this._linesInstancingRenderers.silhouetteRenderer.drawLayer(t,this,Vu)}},{key:"drawSilhouetteSelected",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._linesInstancingRenderers.silhouetteRenderer&&this._linesInstancingRenderers.silhouetteRenderer.drawLayer(t,this,zu)}},{key:"drawEdgesColorOpaque",value:function(e,t){}},{key:"drawEdgesColorTransparent",value:function(e,t){}},{key:"drawEdgesXRayed",value:function(e,t){}},{key:"drawEdgesHighlighted",value:function(e,t){}},{key:"drawEdgesSelected",value:function(e,t){}},{key:"drawOcclusion",value:function(e,t){}},{key:"drawShadow",value:function(e,t){}},{key:"drawPickMesh",value:function(e,t){}},{key:"drawPickDepths",value:function(e,t){}},{key:"drawPickNormals",value:function(e,t){}},{key:"destroy",value:function(){var e=this._state;e.positionsBuf&&(e.positionsBuf.destroy(),e.positionsBuf=null),e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.modelMatrixCol0Buf&&(e.modelMatrixCol0Buf.destroy(),e.modelMatrixCol0Buf=null),e.modelMatrixCol1Buf&&(e.modelMatrixCol1Buf.destroy(),e.modelMatrixCol1Buf=null),e.modelMatrixCol2Buf&&(e.modelMatrixCol2Buf.destroy(),e.modelMatrixCol2Buf=null),e.destroy()}}]),e}(),Ic=q.vec3(),Cc=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}},{key:"drawLayer",value:function(e,t,i){var s=this._scene,r=s.camera,n=t.model,o=s.canvas.gl,a=t._state,u=t._state.origin,h=s.pointsMaterial;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(r.viewMatrix,u):r.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,n.worldMatrix);var l=s._sectionPlanesState.sectionPlanes.length;if(l>0)for(var c=s._sectionPlanesState.sectionPlanes,p=t.layerIndex*l,d=n.renderFlags,f=0;f<l;f++){var m=this._uSectionPlanes[f];if(m){var v=d.sectionPlanesActivePerLayer[p+f];if(o.uniform1i(m.active,v?1:0),v){var g=c[f];if(u){var _=Ee(g.dist,g.dir,u,Ic);o.uniform3fv(m.pos,_)}else o.uniform3fv(m.pos,g.pos);o.uniform3fv(m.dir,g.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),h.filterIntensity&&o.uniform2f(this._uIntensityRange,h.minIntensity,h.maxIntensity),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),o.uniform1f(this._uPointSize,h.pointSize);var y="ortho"===s.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*s.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,y),o.drawArrays(o.POINTS,0,a.positionsBuf.numItems),e.drawArrays++}}},{key:"_allocate",value:function(){var e=this._scene,t=e.pointsMaterial._state,i=e.canvas.gl;if(this._program=new ht(i,this._buildShader(e)),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=e._sectionPlanesState.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),t.filterIntensity&&(this._uIntensityRange=s.getLocation("intensityRange")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=this._program,s=e.camera.project;if(i.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){var r=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,r)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial,s=[];return s.push("#version 300 es"),s.push("// Points batching color vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),s.push("in vec4 color;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),i.filterIntensity&&s.push("uniform vec2 intensityRange;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),i.filterIntensity&&(s.push("float intensity = float(color.a) / 255.0;"),s.push("if (intensity < intensityRange[0] || intensity > intensityRange[1]) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {")),s.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, 1.0);"),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),i.filterIntensity&&s.push("}"),s.push("}"),s}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Points batching color fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("  if (dist > 0.0) { discard; }"),s.push("}")}return s.push("   outColor = vColor;"),e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Dc=new Float32Array([1,1,1]),Ac=q.vec3(),kc=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin,h=r.pointsMaterial._state;if(this._program||(this._allocate(),!this.errors)){if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),i===Wu){var l=r.xrayMaterial._state,c=l.fillColor,p=l.fillAlpha;o.uniform4f(this._uColor,c[0],c[1],c[2],p)}else if(i===Vu){var d=r.highlightMaterial._state,f=d.fillColor,m=d.fillAlpha;o.uniform4f(this._uColor,f[0],f[1],f[2],m)}else if(i===zu){var v=r.selectedMaterial._state,g=v.fillColor,_=v.fillAlpha;o.uniform4f(this._uColor,g[0],g[1],g[2],_)}else o.uniform4fv(this._uColor,Dc);var y=u?De(n.viewMatrix,u):n.viewMatrix;o.uniformMatrix4fv(this._uViewMatrix,!1,y),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var b=r._sectionPlanesState.sectionPlanes.length;if(b>0)for(var x=r._sectionPlanesState.sectionPlanes,P=t.layerIndex*b,T=s.renderFlags,w=0;w<b;w++){var M=this._uSectionPlanes[w];if(M){var I=T.sectionPlanesActivePerLayer[P+w];if(o.uniform1i(M.active,I?1:0),I){var C=x[w];if(u){var D=Ee(C.dist,C.dir,u,Ac);o.uniform3fv(M.pos,D)}else o.uniform3fv(M.pos,C.pos);o.uniform3fv(M.dir,C.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),o.uniform1f(this._uPointSize,h.pointSize);var A="ortho"===r.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,A),o.drawArrays(o.POINTS,0,a.positionsBuf.numItems)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uColor=i.getLocation("color"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("#version 300 es"),s.push("// Points batching silhouette vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform vec4 color;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.y) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),s.push("}"),s}},{key:"_buildFragmentShader",value:function(){var e,t,i=this._scene,s=i._sectionPlanesState,r=s.sectionPlanes.length>0,n=[];if(n.push("#version 300 es"),n.push("// Points batching silhouette vertex shader"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),i.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),n.push("in float vFragDepth;")),r)for(n.push("in vec4 vWorldPosition;"),n.push("in vec4 vFlags2;"),e=0,t=s.sectionPlanes.length;e<t;e++)n.push("uniform bool sectionPlaneActive"+e+";"),n.push("uniform vec3 sectionPlanePos"+e+";"),n.push("uniform vec3 sectionPlaneDir"+e+";");if(n.push("uniform vec4 color;"),n.push("out vec4 outColor;"),n.push("void main(void) {"),i.pointsMaterial.roundPoints&&(n.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),n.push("  float r = dot(cxy, cxy);"),n.push("  if (r > 1.0) {"),n.push("       discard;"),n.push("  }")),r){for(n.push("  bool clippable = (float(vFlags2.x) > 0.0);"),n.push("  if (clippable) {"),n.push("  float dist = 0.0;"),e=0,t=s.sectionPlanes.length;e<t;e++)n.push("if (sectionPlaneActive"+e+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),n.push("}");n.push("  if (dist > 0.0) { discard; }"),n.push("}")}return i.logarithmicDepthBufferEnabled&&n.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("outColor = color;"),n.push("}"),n}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Ec=q.vec3(),Fc=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin,h=r.pointsMaterial._state;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var l=e.pickViewMatrix||n.viewMatrix,c=u?De(l,u):l;if(o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),o.uniformMatrix4fv(this._uViewMatrix,!1,c),r.logarithmicDepthBufferEnabled){var p=2/(Math.log(n.project.far+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,p)}var d=r._sectionPlanesState.sectionPlanes.length;if(d>0)for(var f=r._sectionPlanesState.sectionPlanes,m=t.layerIndex*d,v=s.renderFlags,g=0;g<d;g++){var _=this._uSectionPlanes[g];if(_){var y=v.sectionPlanesActivePerLayer[m+g];if(o.uniform1i(_.active,y?1:0),y){var b=f[g];if(u){var x=Ee(b.dist,b.dir,u,Ec);o.uniform3fv(_.pos,x)}else o.uniform3fv(_.pos,b.pos);o.uniform3fv(_.dir,b.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aPickColor&&this._aPickColor.bindArrayBuffer(a.pickColorsBuf),o.uniform1f(this._uPointSize,h.pointSize);var P="ortho"===r.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,P),o.drawArrays(o.POINTS,0,a.positionsBuf.numItems)}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aPickColor=i.getAttribute("pickColor"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(e){var t=this._scene.canvas.gl;this._program.bind(),t.uniform1i(this._uPickInvisible,e.pickInvisible)}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("#version 300 es"),s.push("// Points batching pick mesh vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 pickColor;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vPickColor;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("      vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("gl_PointSize += 10.0;"),s.push("  }"),s.push("}"),s}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Points batching pick mesh vertex shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vPickColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)s.push("      if (sectionPlaneActive"+r+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("   outColor = vPickColor; "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Rc=q.vec3(),Sc=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin,h=r.pointsMaterial._state;this._program||this._allocate(),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniform1i(this._uPickInvisible,e.pickInvisible);var l=e.pickViewMatrix||n.viewMatrix,c=u?De(l,u):l;if(o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.uniformMatrix4fv(this._uViewMatrix,!1,c),o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),o.uniform1f(this._uPickZNear,e.pickZNear),o.uniform1f(this._uPickZFar,e.pickZFar),r.logarithmicDepthBufferEnabled){var p=2/(Math.log(e.pickZFar+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,p)}var d=r._sectionPlanesState.sectionPlanes.length;if(d>0)for(var f=r._sectionPlanesState.sectionPlanes,m=t.layerIndex*d,v=s.renderFlags,g=0;g<d;g++){var _=this._uSectionPlanes[g];if(_){var y=v.sectionPlanesActivePerLayer[m+g];if(o.uniform1i(_.active,y?1:0),y){var b=f[g];if(u){var x=Ee(b.dist,b.dir,u,Rc);o.uniform3fv(_.pos,x)}else o.uniform3fv(_.pos,b.pos);o.uniform3fv(_.dir,b.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),o.uniform1f(this._uPointSize,h.pointSize);var P="ortho"===r.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,P),o.drawArrays(o.POINTS,0,a.positionsBuf.numItems)}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._uPickZNear=i.getLocation("pickZNear"),this._uPickZFar=i.getLocation("pickZFar"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){this._program.bind()}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("#version 300 es"),s.push("// Points batched pick depth vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vViewPosition;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vViewPosition = viewPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("gl_PointSize += 10.0;"),s.push("  }"),s.push("}"),s}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Points batched pick depth fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),s.push("uniform float pickZNear;"),s.push("uniform float pickZFar;"),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vViewPosition;"),s.push("vec4 packDepth(const in float depth) {"),s.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),s.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),s.push("  vec4 res = fract(depth * bitShift);"),s.push("  res -= res.xxyz * bitMask;"),s.push("  return res;"),s.push("}"),s.push("out vec4 outColor;"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("      if (sectionPlaneActive"+n+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),s.push("    outColor = packDepth(zNormalizedDepth); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Oc=q.vec3(),Bc=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.canvas.gl,o=t._state,a=r.camera,u=t._state.origin,h=r.pointsMaterial._state;if(this._program||(this._allocate(t),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,i),n.uniformMatrix4fv(this._uViewMatrix,!1,u?De(a.viewMatrix,u):a.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var l=r._sectionPlanesState.sectionPlanes.length;if(l>0)for(var c=r._sectionPlanesState.sectionPlanes,p=t.layerIndex*l,d=s.renderFlags,f=0;f<l;f++){var m=this._uSectionPlanes[f];if(m){var v=d.sectionPlanesActivePerLayer[p+f];if(n.uniform1i(m.active,v?1:0),v){var g=c[f];if(u){var _=Ee(g.dist,g.dir,u,Oc);n.uniform3fv(m.pos,_)}else n.uniform3fv(m.pos,g.pos);n.uniform3fv(m.dir,g.dir)}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(o.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(o.offsetsBuf),this._aFlags.bindArrayBuffer(o.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(o.flags2Buf),n.uniform1f(this._uPointSize,h.pointSize);var y="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,y),n.drawArrays(n.POINTS,0,o.positionsBuf.numItems)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("#version 300 es"),s.push("// Points batching occlusion vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("  gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("  }"),s.push("}"),s}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Points batching occlusion fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("out vec4 outColor;"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("      if (sectionPlaneActive"+n+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("   outColor = vec4(0.0, 0.0, 1.0, 1.0); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Lc=function(){function e(t){w(this,e),this._scene=t}return I(e,[{key:"_compile",value:function(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null)}},{key:"colorRenderer",get:function(){return this._colorRenderer||(this._colorRenderer=new Cc(this._scene)),this._colorRenderer}},{key:"silhouetteRenderer",get:function(){return this._silhouetteRenderer||(this._silhouetteRenderer=new kc(this._scene)),this._silhouetteRenderer}},{key:"pickMeshRenderer",get:function(){return this._pickMeshRenderer||(this._pickMeshRenderer=new Fc(this._scene)),this._pickMeshRenderer}},{key:"pickDepthRenderer",get:function(){return this._pickDepthRenderer||(this._pickDepthRenderer=new Sc(this._scene)),this._pickDepthRenderer}},{key:"occlusionRenderer",get:function(){return this._occlusionRenderer||(this._occlusionRenderer=new Bc(this._scene)),this._occlusionRenderer}},{key:"_destroy",value:function(){this._colorRenderer&&this._colorRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy()}}]),e}(),Nc={};var jc=I((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e6;w(this,e),t>5e6&&(t=5e6),this.maxVerts=t,this.maxIndices=3*t,this.positions=[],this.colors=[],this.intensities=[],this.pickColors=[],this.flags=[],this.flags2=[],this.offsets=[]})),Gc=q.vec4(),Hc=q.vec4(),Uc=q.vec4([0,0,0,1]),Vc=q.vec4([0,0,0,1]),zc=q.vec4([0,0,0,1]),Wc=q.OBB3(),Xc=function(){function e(t){w(this,e),this.model=t.model,this.sortId="PointsBatchingLayer",this.layerIndex=t.layerIndex,this._pointsBatchingRenderers=function(e){var t=e.id,i=Nc[t];return i||(i=new Lc(e),Nc[t]=i,i._compile(),e.on("compile",(function(){i._compile()})),e.on("destroyed",(function(){delete Nc[t],i._destroy()}))),i}(t.model.scene),this._buffer=new jc(t.maxGeometryBatchSize),this._scratchMemory=t.scratchMemory,this._state=new ti({positionsBuf:null,offsetsBuf:null,colorsBuf:null,flagsBuf:null,flags2Buf:null,positionsDecodeMatrix:q.mat4(),origin:null}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numSelectedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numClippableLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._modelAABB=q.collapseAABB3(),this._portions=[],this._finalized=!1,t.positionsDecodeMatrix?(this._state.positionsDecodeMatrix.set(t.positionsDecodeMatrix),this._preCompressedPositionsExpected=!0):this._preCompressedPositionsExpected=!1,t.origin&&(this._state.origin=q.vec3(t.origin)),this.aabb=q.collapseAABB3()}return I(e,[{key:"canCreatePortion",value:function(e){if(this._finalized)throw"Already finalized";return this._buffer.positions.length+e<3*this._buffer.maxVerts}},{key:"createPortion",value:function(e){if(this._finalized)throw"Already finalized";var t,i=e.positions,s=e.positionsCompressed,r=e.color,n=e.colorsCompressed,o=e.colors,a=e.meshMatrix,u=e.worldMatrix,h=e.worldAABB,l=e.pickColor,c=this._buffer,p=c.positions.length/3;if(this._preCompressedPositionsExpected){if(!s)throw"positionsCompressed expected";for(var d=0,f=s.length;d<f;d++)c.positions.push(s[d]);var m=ui.getPositionsBounds(s),v=ui.decompressPosition(m.min,this._state.positionsDecodeMatrix,Gc),g=ui.decompressPosition(m.max,this._state.positionsDecodeMatrix,Hc);h[0]=v[0],h[1]=v[1],h[2]=v[2],h[3]=g[0],h[4]=g[1],h[5]=g[2],u&&(q.AABB3ToOBB3(h,Wc),q.transformOBB3(u,Wc),q.OBB3ToAABB3(Wc,h)),t=s.length/3}else{if(!i)throw"positions expected";t=i.length/3;for(var _=i.length,y=c.positions.length,b=0,x=i.length;b<x;b++)c.positions.push(i[b]);if(a)for(var P=y,T=y+_;P<T;P+=3)Uc[0]=c.positions[P+0],Uc[1]=c.positions[P+1],Uc[2]=c.positions[P+2],q.transformPoint4(a,Uc,Vc),c.positions[P+0]=Vc[0],c.positions[P+1]=Vc[1],c.positions[P+2]=Vc[2],q.expandAABB3Point3(this._modelAABB,Vc),u?(q.transformPoint4(u,Vc,zc),q.expandAABB3Point3(h,zc)):q.expandAABB3Point3(h,Vc);else for(var w=y,M=y+_;w<M;w+=3)Uc[0]=c.positions[w+0],Uc[1]=c.positions[w+1],Uc[2]=c.positions[w+2],q.expandAABB3Point3(this._modelAABB,Uc),u?(q.transformPoint4(u,Uc,Vc),q.expandAABB3Point3(h,Vc)):q.expandAABB3Point3(h,Uc)}if(this._state.origin){var I=this._state.origin;h[0]+=I[0],h[1]+=I[1],h[2]+=I[2],h[3]+=I[0],h[4]+=I[1],h[5]+=I[2]}if(q.expandAABB3(this.aabb,h),n)for(var C=0,D=n.length;C<D;C++)c.colors.push(n[C]);else if(o)for(var A=0,k=o.length;A<k;A++)c.colors.push(255*o[A]);else if(r)for(var E=r[0],F=r[1],R=r[2],S=0;S<t;S++)c.colors.push(E),c.colors.push(F),c.colors.push(R),c.colors.push(1);for(var O=c.pickColors.length,B=O,L=O+4*t;B<L;B+=4)c.pickColors.push(l[0]),c.pickColors.push(l[1]),c.pickColors.push(l[2]),c.pickColors.push(l[3]);if(this.model.scene.entityOffsetsEnabled)for(var N=0;N<t;N++)c.offsets.push(0),c.offsets.push(0),c.offsets.push(0);var j=this._portions.length/2;return this._portions.push(p),this._portions.push(t),this._numPortions++,this.model.numPortions++,j}},{key:"finalize",value:function(){if(this._finalized)this.model.error("Already finalized");else{var e=this._state,t=this.model.scene.canvas.gl,i=this._buffer;if(i.positions.length>0)if(this._preCompressedPositionsExpected){var s=new Uint16Array(i.positions);e.positionsBuf=new lt(t,t.ARRAY_BUFFER,s,i.positions.length,3,t.STATIC_DRAW)}else{var r=jh(new Float32Array(i.positions),this._modelAABB,e.positionsDecodeMatrix);e.positionsBuf=new lt(t,t.ARRAY_BUFFER,r,i.positions.length,3,t.STATIC_DRAW)}if(i.colors.length>0){var n=new Uint8Array(i.colors);e.colorsBuf=new lt(t,t.ARRAY_BUFFER,n,i.colors.length,4,t.STATIC_DRAW,!1)}if(i.positions.length>0){var o=i.positions.length/3*4,a=new Uint8Array(o),u=new Uint8Array(o);e.flagsBuf=new lt(t,t.ARRAY_BUFFER,a,a.length,4,t.DYNAMIC_DRAW,!1),e.flags2Buf=new lt(t,t.ARRAY_BUFFER,u,u.length,4,t.DYNAMIC_DRAW,!0)}if(i.pickColors.length>0){var h=new Uint8Array(i.pickColors);e.pickColorsBuf=new lt(t,t.ARRAY_BUFFER,h,i.pickColors.length,4,t.STATIC_DRAW,!1)}if(this.model.scene.entityOffsetsEnabled&&i.offsets.length>0){var l=new Float32Array(i.offsets);e.offsetsBuf=new lt(t,t.ARRAY_BUFFER,l,i.offsets.length,3,t.DYNAMIC_DRAW)}this._buffer=null,this._finalized=!0}}},{key:"initFlags",value:function(e,t,i){t&me&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&xe&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&be&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&Pe&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&_e&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&ge&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&ve&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),i&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(e,t,i),this._setFlags2(e,t)}},{key:"setVisible",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&me?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,i)}},{key:"setHighlighted",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&xe?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,i)}},{key:"setXRayed",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&be?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,i)}},{key:"setSelected",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Pe?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,i)}},{key:"setEdges",value:function(e,t,i){if(!this._finalized)throw"Not finalized"}},{key:"setClippable",value:function(e,t){if(!this._finalized)throw"Not finalized";t&_e?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}},{key:"setCulled",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&ve?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,i)}},{key:"setCollidable",value:function(e,t){if(!this._finalized)throw"Not finalized"}},{key:"setPickable",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&ge?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(e,t,i)}},{key:"setColor",value:function(e,t){if(!this._finalized)throw"Not finalized";for(var i=2*e,s=4*this._portions[i],r=4*this._portions[i+1],n=this._scratchMemory.getUInt8Array(r),o=t[0],a=t[1],u=t[2],h=0;h<r;h+=4)n[h+0]=o,n[h+1]=a,n[h+2]=u;this._state.colorsBuf.setData(n,s,r)}},{key:"setTransparent",value:function(e,t,i){i?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,i)}},{key:"_setFlags",value:function(e,t,i){if(!this._finalized)throw"Not finalized";var s,r,n=2*e,o=4*this._portions[n],a=4*this._portions[n+1],u=this._scratchMemory.getUInt8Array(a),h=!!(t&me),l=!!(t&be),c=!!(t&xe),p=!!(t&Pe),d=!!(t&ge),f=!!(t&ve);s=!h||f||l||c&&!this.model.scene.highlightMaterial.glowThrough||p&&!this.model.scene.selectedMaterial.glowThrough?Gu:i?Uu:Hu,r=!h||f?Gu:p?zu:c?Vu:l?Wu:Gu;for(var m=h&&!f&&d?Qu:Gu,v=0;v<a;v+=4)u[v+0]=s,u[v+1]=r,u[v+2]=0,u[v+3]=m;this._state.flagsBuf.setData(u,o,a)}},{key:"_setFlags2",value:function(e,t){if(!this._finalized)throw"Not finalized";for(var i=2*e,s=4*this._portions[i],r=4*this._portions[i+1],n=this._scratchMemory.getUInt8Array(r),o=t&_e?255:0,a=0;a<r;a+=4)n[a+0]=o;this._state.flags2Buf.setData(n,s,r)}},{key:"setOffset",value:function(e,t){if(!this._finalized)throw"Not finalized";if(this.model.scene.entityOffsetsEnabled){for(var i=2*e,s=3*this._portions[i],r=3*this._portions[i+1],n=this._scratchMemory.getFloat32Array(r),o=t[0],a=t[1],u=t[2],h=0;h<r;h+=3)n[h+0]=o,n[h+1]=a,n[h+2]=u;this._state.offsetsBuf.setData(n,s,r)}else this.model.error("Entity#offset not enabled for this Viewer")}},{key:"drawColorOpaque",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsBatchingRenderers.colorRenderer&&this._pointsBatchingRenderers.colorRenderer.drawLayer(t,this,Hu)}},{key:"drawColorTransparent",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsBatchingRenderers.colorRenderer&&this._pointsBatchingRenderers.colorRenderer.drawLayer(t,this,Uu)}},{key:"drawDepth",value:function(e,t){}},{key:"drawNormals",value:function(e,t){}},{key:"drawSilhouetteXRayed",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._pointsBatchingRenderers.silhouetteRenderer&&this._pointsBatchingRenderers.silhouetteRenderer.drawLayer(t,this,Wu)}},{key:"drawSilhouetteHighlighted",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._pointsBatchingRenderers.silhouetteRenderer&&this._pointsBatchingRenderers.silhouetteRenderer.drawLayer(t,this,Vu)}},{key:"drawSilhouetteSelected",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._pointsBatchingRenderers.silhouetteRenderer&&this._pointsBatchingRenderers.silhouetteRenderer.drawLayer(t,this,zu)}},{key:"drawEdgesColorOpaque",value:function(e,t){}},{key:"drawEdgesColorTransparent",value:function(e,t){}},{key:"drawEdgesHighlighted",value:function(e,t){}},{key:"drawEdgesSelected",value:function(e,t){}},{key:"drawEdgesXRayed",value:function(e,t){}},{key:"drawPickMesh",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsBatchingRenderers.pickMeshRenderer&&this._pointsBatchingRenderers.pickMeshRenderer.drawLayer(t,this,Qu)}},{key:"drawPickDepths",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsBatchingRenderers.pickDepthRenderer&&this._pointsBatchingRenderers.pickDepthRenderer.drawLayer(t,this,Qu)}},{key:"drawPickNormals",value:function(e,t){}},{key:"drawOcclusion",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsBatchingRenderers.occlusionRenderer&&this._pointsBatchingRenderers.occlusionRenderer.drawLayer(t,this,Hu)}},{key:"drawShadow",value:function(e,t){}},{key:"destroy",value:function(){var e=this._state;e.positionsBuf&&(e.positionsBuf.destroy(),e.positionsBuf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.pickColorsBuf&&(e.pickColorsBuf.destroy(),e.pickColorsBuf=null),e.destroy()}}]),e}(),Yc=q.vec3(),Kc=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin,h=r.pointsMaterial._state,l=t.geometry;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(n.viewMatrix,u):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),this._aPosition.bindArrayBuffer(l.positionsBuf),this._aColor.bindArrayBuffer(l.colorsBuf),h.filterIntensity&&o.uniform2f(this._uIntensityRange,h.minIntensity,h.maxIntensity);var c=r._sectionPlanesState.sectionPlanes.length;if(c>0)for(var p=r._sectionPlanesState.sectionPlanes,d=t.layerIndex*c,f=s.renderFlags,m=0;m<c;m++){var v=this._uSectionPlanes[m];if(v){var g=f.sectionPlanesActivePerLayer[d+m];if(o.uniform1i(v.active,g?1:0),g){var _=p[m];if(u){var y=Ee(_.dist,_.dir,u,Yc);o.uniform3fv(v.pos,y)}else o.uniform3fv(v.pos,_.pos);o.uniform3fv(v.dir,_.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),o.uniform1f(this._uPointSize,h.pointSize);var b="ortho"===r.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,b),o.drawArraysInstanced(o.POINTS,0,l.positionsBuf.numItems,a.numInstances),e.drawArrays++,o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.pointsMaterial._state,i=e.canvas.gl;if(this._program=new ht(i,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=e._sectionPlanesState.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aOffset=s.getAttribute("offset"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),t.filterIntensity&&(this._uIntensityRange=s.getLocation("intensityRange")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("#version 300 es"),s.push("// Points instancing color vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),s.push("in vec4 color;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),i.filterIntensity&&s.push("uniform vec2 intensityRange;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),i.filterIntensity&&(s.push("float intensity = float(color.a) / 255.0;"),s.push("if (intensity < intensityRange[0] || intensity > intensityRange[1]) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {")),s.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, 1.0);"),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),i.filterIntensity&&s.push("}"),s.push("}"),s}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Points instancing color fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return s.push("   outColor = vColor;"),e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Jc=q.vec3(),Zc=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin,h=r.pointsMaterial._state,l=t.geometry;if(this._program||(this._allocate(t.model.scene),!this.errors)){if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),i===Wu){var c=r.xrayMaterial._state,p=c.fillColor,d=c.fillAlpha;o.uniform4f(this._uColor,p[0],p[1],p[2],d)}else if(i===Vu){var f=r.highlightMaterial._state,m=f.fillColor,v=f.fillAlpha;o.uniform4f(this._uColor,m[0],m[1],m[2],v)}else if(i===zu){var g=r.selectedMaterial._state,_=g.fillColor,y=g.fillAlpha;o.uniform4f(this._uColor,_[0],_[1],_[2],y)}else o.uniform4fv(this._uColor,q.vec3([1,1,1]));o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(n.viewMatrix,u):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var b=r._sectionPlanesState.sectionPlanes.length;if(b>0)for(var x=r._sectionPlanesState.sectionPlanes,P=t.layerIndex*b,T=s.renderFlags,w=0;w<b;w++){var M=this._uSectionPlanes[w];if(M){var I=T.sectionPlanesActivePerLayer[P+w];if(o.uniform1i(M.active,I?1:0),I){var C=x[w];if(u){var D=Ee(C.dist,C.dir,u,Jc);o.uniform3fv(M.pos,D)}else o.uniform3fv(M.pos,C.pos);o.uniform3fv(M.dir,C.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(l.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf,o.UNSIGNED_BYTE,!0),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,o.UNSIGNED_BYTE,!0),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),o.uniform1f(this._uPointSize,h.pointSize);var A="ortho"===r.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,A),o.drawArraysInstanced(o.POINTS,0,l.positionsBuf.numItems,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uColor=s.getLocation("silhouetteColor"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("#version 300 es"),s.push("// Points instancing silhouette vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 color;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),s.push("uniform vec4 silhouetteColor;"),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.y) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("vColor = vec4(float(silhouetteColor.r) / 255.0, float(silhouetteColor.g) / 255.0, float(silhouetteColor.b) / 255.0, float(color.a) / 255.0);"),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),s.push("}"),s}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Points instancing silhouette fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("outColor = vColor;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),Qc=q.vec3(),qc=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin,h=r.pointsMaterial._state,l=t.geometry;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniform1i(this._uRenderPass,i);var c=e.pickViewMatrix||n.viewMatrix,p=u?De(c,u):c;if(o.uniformMatrix4fv(this._uViewMatrix,!1,p),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),r.logarithmicDepthBufferEnabled){var d=2/(Math.log(n.project.far+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,d)}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPickColor.bindArrayBuffer(a.pickColorsBuf),o.vertexAttribDivisor(this._aPickColor.location,1),this._aPosition.bindArrayBuffer(l.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),o.uniform1f(this._uPointSize,h.pointSize);var f="ortho"===r.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,f);var m=r._sectionPlanesState.sectionPlanes.length;if(m>0)for(var v=r._sectionPlanesState.sectionPlanes,g=t.layerIndex*m,_=s.renderFlags,y=0;y<m;y++){var b=this._uSectionPlanes[y];if(b){var x=_.sectionPlanesActivePerLayer[g+y];if(o.uniform1i(b.active,x?1:0),x){var P=v[y];if(u){var T=Ee(P.dist,P.dir,u,Qc);o.uniform3fv(b.pos,T)}else o.uniform3fv(b.pos,P.pos);o.uniform3fv(b.dir,P.dir)}}}o.drawArraysInstanced(o.POINTS,0,l.positionsBuf.numItems,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aPickColor.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._uRenderPass=s.getLocation("renderPass"),this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aPickColor=s.getAttribute("pickColor"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(e){var t=this._scene.canvas.gl;this._program.bind(),t.uniform1i(this._uPickInvisible,e.pickInvisible)}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("#version 300 es"),s.push("// Points instancing pick mesh vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 pickColor;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vPickColor;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("  vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),t&&(s.push("  vWorldPosition = worldPosition;"),s.push("  vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),s.push("}"),s}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Points instancing pick mesh fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vPickColor;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("if (sectionPlaneActive"+n+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("outColor = vPickColor; "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),$c=q.vec3(),ep=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.canvas.gl,o=t._state,a=t._state.origin,u=r.pointsMaterial._state,h=t.geometry;if(this._program||(this._allocate(t),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram());var l=r.camera;n.uniform1i(this._uRenderPass,i),n.uniform1i(this._uPickInvisible,e.pickInvisible);var c=e.pickViewMatrix||l.viewMatrix,p=a?De(c,a):c;if(n.uniformMatrix4fv(this._uViewMatrix,!1,p),n.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),n.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),n.uniform1f(this._uPickZNear,e.pickZNear),n.uniform1f(this._uPickZFar,e.pickZFar),r.logarithmicDepthBufferEnabled){var d=2/(Math.log(e.pickZFar+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,d)}var f=r._sectionPlanesState.sectionPlanes.length;if(f>0)for(var m=r._sectionPlanesState.sectionPlanes,v=t.layerIndex*f,g=s.renderFlags,_=0;_<f;_++){var y=this._uSectionPlanes[_];if(y){var b=g.sectionPlanesActivePerLayer[v+_];if(n.uniform1i(y.active,b?1:0),b){var x=m[_];if(a){var P=Ee(x.dist,x.dir,a,$c);n.uniform3fv(y.pos,P)}else n.uniform3fv(y.pos,x.pos);n.uniform3fv(y.dir,x.dir)}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(o.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(o.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(o.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aFlags.bindArrayBuffer(o.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(o.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(o.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),n.uniform1f(this._uPointSize,u.pointSize);var T="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,T),n.drawArraysInstanced(n.POINTS,0,h.positionsBuf.numItems,o.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uPickZNear=i.getLocation("pickZNear"),this._uPickZFar=i.getLocation("pickZFar"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){this._program.bind()}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("#version 300 es"),s.push("// Points instancing pick depth vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vViewPosition;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("  vWorldPosition = worldPosition;"),s.push("  vFlags2 = flags2;")),s.push("  vViewPosition = viewPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),s.push("}"),s}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Points instancing pick depth fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),s.push("uniform float pickZNear;"),s.push("uniform float pickZFar;"),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec4 vViewPosition;"),s.push("vec4 packDepth(const in float depth) {"),s.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),s.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),s.push("  vec4 res = fract(depth * bitShift);"),s.push("  res -= res.xxyz * bitMask;"),s.push("  return res;"),s.push("}"),s.push("out vec4 outColor;"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("if (sectionPlaneActive"+n+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),s.push("    outColor = packDepth(zNormalizedDepth); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),tp=q.vec3(),ip=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin,h=r.pointsMaterial._state,l=t.geometry;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(n.viewMatrix,u):n.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix);var c=r._sectionPlanesState.sectionPlanes.length;if(c>0)for(var p=r._sectionPlanesState.sectionPlanes,d=t.layerIndex*c,f=s.renderFlags,m=0;m<c;m++){var v=this._uSectionPlanes[m];if(v){var g=f.sectionPlanesActivePerLayer[d+m];if(o.uniform1i(v.active,g?1:0),g){var _=p[m];if(u){var y=Ee(_.dist,_.dir,u,tp);o.uniform3fv(v.pos,y)}else o.uniform3fv(v.pos,_.pos);o.uniform3fv(v.dir,_.dir)}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aColor&&(this._aColor.bindArrayBuffer(l.colorsBuf),o.vertexAttribDivisor(this._aColor.location,1)),this._aPosition.bindArrayBuffer(l.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(a.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),o.uniform1f(this._uPointSize,h.pointSize);var b="ortho"===r.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,b),o.drawArraysInstanced(o.POINTS,0,l.positionsBuf.numItems,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),this._aColor&&o.vertexAttribDivisor(this._aColor.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("#version 300 es"),s.push("// Points instancing occlusion vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 color;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&s.push("  vWorldPosition = worldPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),s.push("}"),s}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Points instancing occlusion vertex shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("out vec4 outColor;"),s.push("void main(void) {"),e.pointsMaterial.roundPoints&&(s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }")),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var n=0;n<t.sectionPlanes.length;n++)s.push("if (sectionPlaneActive"+n+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+n+".xyz, vWorldPosition.xyz - sectionPlanePos"+n+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return s.push("   outColor = vec4(0.0, 0.0, 1.0, 1.0); "),e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),sp=q.vec3(),rp=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}},{key:"drawLayer",value:function(e,t,i){var s=t.model,r=s.scene,n=r.camera,o=r.canvas.gl,a=t._state,u=t._state.origin,h=r.pointsMaterial._state,l=t.geometry;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,i),o.uniformMatrix4fv(this._uWorldMatrix,!1,s.worldMatrix),o.uniformMatrix4fv(this._uViewMatrix,!1,u?De(n.viewMatrix,u):n.viewMatrix);var c=r._sectionPlanesState.sectionPlanes.length;if(c>0)for(var p=r._sectionPlanesState.sectionPlanes,d=t.layerIndex*c,f=s.renderFlags,m=0;m<c;m++){var v=this._uSectionPlanes[m];if(v){var g=f.sectionPlanesActivePerLayer[d+m];if(o.uniform1i(v.active,g?1:0),g){var _=p[m];if(u){var y=Ee(_.dist,_.dir,u,sp);o.uniform3fv(v.pos,y)}else o.uniform3fv(v.pos,_.pos);o.uniform3fv(v.dir,_.dir)}}}this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(l.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(a.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),o.uniform1f(this._uPointSize,h.pointSize);var b="ortho"===r.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,b),o.drawArraysInstanced(o.POINTS,0,l.positionsBuf.numItems,a.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(var s=0,r=e._sectionPlanesState.sectionPlanes.length;s<r;s++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+s),pos:i.getLocation("sectionPlanePos"+s),dir:i.getLocation("sectionPlaneDir"+s)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}}},{key:"_bindProgram",value:function(){var e=this._scene,t=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){var s=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,s)}}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=e.pointsMaterial._state,s=[];return s.push("#version 300 es"),s.push("// Points instancing depth vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),i.perspectivePoints&&s.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("gl_Position = clipPos;"),i.perspectivePoints?(s.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),s.push("gl_PointSize = max(gl_PointSize, "+Math.floor(i.minPerspectivePointSize)+".0);"),s.push("gl_PointSize = min(gl_PointSize, "+Math.floor(i.maxPerspectivePointSize)+".0);")):s.push("gl_PointSize = pointSize;"),s.push("}"),s.push("}"),s}},{key:"_buildFragmentShader",value:function(){var e,t,i=this._scene,s=i._sectionPlanesState,r=s.sectionPlanes.length>0,n=[];if(n.push("#version 300 es"),n.push("// Points instancing depth vertex shader"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),i.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),n.push("in float vFragDepth;")),r)for(n.push("in vec4 vWorldPosition;"),n.push("in vec4 vFlags2;"),e=0,t=s.sectionPlanes.length;e<t;e++)n.push("uniform bool sectionPlaneActive"+e+";"),n.push("uniform vec3 sectionPlanePos"+e+";"),n.push("uniform vec3 sectionPlaneDir"+e+";");if(n.push("const float   packUpScale = 256. / 255.;"),n.push("const float   unpackDownscale = 255. / 256.;"),n.push("const vec3    packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),n.push("const vec4    unpackFactors = unpackDownscale / vec4( packFactors, 1. );"),n.push("const float   shiftRight8 = 1.0 / 256.;"),n.push("vec4 packDepthToRGBA( const in float v ) {"),n.push("    vec4 r = vec4( fract( v * packFactors ), v );"),n.push("    r.yzw -= r.xyz * shiftRight8;"),n.push("    return r * packUpScale;"),n.push("}"),n.push("out vec4 outColor;"),n.push("void main(void) {"),i.pointsMaterial.roundPoints&&(n.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),n.push("  float r = dot(cxy, cxy);"),n.push("  if (r > 1.0) {"),n.push("       discard;"),n.push("  }")),r){for(n.push("  bool clippable = (float(vFlags2.x) > 0.0);"),n.push("  if (clippable) {"),n.push("  float dist = 0.0;"),e=0,t=s.sectionPlanes.length;e<t;e++)n.push("if (sectionPlaneActive"+e+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),n.push("}");n.push("if (dist > 0.0) { discard; }"),n.push("}")}return n.push("    outColor = packDepthToRGBA( gl_FragCoord.z); "),i.logarithmicDepthBufferEnabled&&n.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("}"),n}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),np=q.vec3(),op=function(){function e(t){w(this,e),this._scene=t,this._hash=this._getHash(),this._lastLightId=null,this._allocate()}return I(e,[{key:"getValid",value:function(){return this._hash===this._getHash()}},{key:"_getHash",value:function(){return this._scene._sectionPlanesState.getHash()}},{key:"drawLayer",value:function(e,t){var i=t.model,s=i.scene,r=s.canvas.gl,n=t._state;if(this._program||(this._allocate(),!this.errors)){e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e,t)),r.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,geometry.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),r.vertexAttribDivisor(this._aModelMatrixCol0.location,1),r.vertexAttribDivisor(this._aModelMatrixCol1.location,1),r.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),r.vertexAttribDivisor(this._aOffset.location,1)),this._aColor.bindArrayBuffer(n.colorsBuf),r.vertexAttribDivisor(this._aColor.location,1),this._aFlags.bindArrayBuffer(n.flagsBuf),r.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),r.vertexAttribDivisor(this._aFlags2.location,1));var o=s._sectionPlanesState.sectionPlanes.length;if(o>0)for(var a=s._sectionPlanesState.sectionPlanes,u=t.layerIndex*o,h=i.renderFlags,l=t._state.origin,c=0;c<o;c++){var p=this._uSectionPlanes[c];if(p){var d=h.sectionPlanesActivePerLayer[u+c];if(r.uniform1i(p.active,d?1:0),d){var f=a[c];if(l){var m=Ee(f.dist,f.dir,l,np);r.uniform3fv(p.pos,m)}else r.uniform3fv(p.pos,f.pos);r.uniform3fv(p.dir,f.dir)}}}r.uniform1f(this._uPointSize,10),r.drawArraysInstanced(r.POINTS,0,n.positionsBuf.numItems,n.numInstances),r.vertexAttribDivisor(this._aModelMatrixCol0.location,0),r.vertexAttribDivisor(this._aModelMatrixCol1.location,0),r.vertexAttribDivisor(this._aModelMatrixCol2.location,0),r.vertexAttribDivisor(this._aColor.location,0),r.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&r.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&r.vertexAttribDivisor(this._aOffset.location,0)}}},{key:"_allocate",value:function(){var e=this._scene,t=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new ht(t,this._buildShader()),this._program.errors)this.errors=this._program.errors;else{var s=this._program;this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uShadowViewMatrix=s.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=s.getLocation("shadowProjMatrix"),this._uSectionPlanes=[];for(var r=0,n=i.sectionPlanes.length;r<n;r++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+r),pos:s.getLocation("sectionPlanePos"+r),dir:s.getLocation("sectionPlaneDir"+r)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uPointSize=s.getLocation("pointSize")}}},{key:"_bindProgram",value:function(e,t){var i=this._scene.canvas.gl;this._program.bind(),i.uniformMatrix4fv(this._uShadowViewMatrix,!1,e.shadowViewMatrix),i.uniformMatrix4fv(this._uShadowProjMatrix,!1,e.shadowProjMatrix),this._lastLightId=null}},{key:"_buildShader",value:function(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}},{key:"_buildVertexShader",value:function(){var e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Instancing geometry shadow drawing vertex shader"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 color;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 shadowViewMatrix;"),i.push("uniform mat4 shadowProjMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("void main(void) {"),i.push("bool visible      = (float(flags.x) > 0.0);"),i.push("bool transparent  = ((float(color.a) / 255.0) < 1.0);"),i.push("if (!visible || transparent) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = shadowViewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("  gl_Position = shadowProjMatrix * viewPosition;"),i.push("}"),i.push("gl_PointSize = pointSize;"),i.push("}"),i}},{key:"_buildFragmentShader",value:function(){var e=this._scene,t=e._sectionPlanesState,i=t.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Instancing geometry depth drawing fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("in float vFragDepth;")),i){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(var r=0,n=t.sectionPlanes.length;r<n;r++)s.push("uniform bool sectionPlaneActive"+r+";"),s.push("uniform vec3 sectionPlanePos"+r+";"),s.push("uniform vec3 sectionPlaneDir"+r+";")}if(s.push("in vec3 vViewNormal;"),s.push("vec3 packNormalToRGB( const in vec3 normal ) {"),s.push("    return normalize( normal ) * 0.5 + 0.5;"),s.push("}"),s.push("out vec4 outColor;"),s.push("void main(void) {"),s.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),s.push("  float r = dot(cxy, cxy);"),s.push("  if (r > 1.0) {"),s.push("       discard;"),s.push("  }"),i){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("  float dist = 0.0;");for(var o=0,a=t.sectionPlanes.length;o<a;o++)s.push("if (sectionPlaneActive"+o+") {"),s.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),s.push("}");s.push("if (dist > 0.0) { discard; }"),s.push("}")}return e.logarithmicDepthBufferEnabled&&s.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),s.push("    outColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),s.push("}"),s}},{key:"webglContextRestored",value:function(){this._program=null}},{key:"destroy",value:function(){this._program&&this._program.destroy(),this._program=null}}]),e}(),ap=function(){function e(t){w(this,e),this._scene=t}return I(e,[{key:"_compile",value:function(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._depthRenderer&&!this._depthRenderer.getValid()&&(this._depthRenderer.destroy(),this._depthRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null),this._shadowRenderer&&!this._shadowRenderer.getValid()&&(this._shadowRenderer.destroy(),this._shadowRenderer=null)}},{key:"colorRenderer",get:function(){return this._colorRenderer||(this._colorRenderer=new Kc(this._scene,!1)),this._colorRenderer}},{key:"silhouetteRenderer",get:function(){return this._silhouetteRenderer||(this._silhouetteRenderer=new Zc(this._scene)),this._silhouetteRenderer}},{key:"depthRenderer",get:function(){return this._depthRenderer||(this._depthRenderer=new rp(this._scene)),this._depthRenderer}},{key:"pickMeshRenderer",get:function(){return this._pickMeshRenderer||(this._pickMeshRenderer=new qc(this._scene)),this._pickMeshRenderer}},{key:"pickDepthRenderer",get:function(){return this._pickDepthRenderer||(this._pickDepthRenderer=new ep(this._scene)),this._pickDepthRenderer}},{key:"occlusionRenderer",get:function(){return this._occlusionRenderer||(this._occlusionRenderer=new ip(this._scene)),this._occlusionRenderer}},{key:"shadowRenderer",get:function(){return this._shadowRenderer||(this._shadowRenderer=new op(this._scene)),this._shadowRenderer}},{key:"_destroy",value:function(){this._colorRenderer&&this._colorRenderer.destroy(),this._depthRenderer&&this._depthRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy(),this._shadowRenderer&&this._shadowRenderer.destroy()}}]),e}(),up={};var hp=new Uint8Array(4),lp=q.vec4([0,0,0,1]),cp=q.vec4([0,0,0,1]),pp=q.vec4([0,0,0,1]),dp=new Float32Array(3),fp=function(){function e(t){var i,s,r;w(this,e),this.model=t.model,this.geometry=t.geometry,this.material=t.material,this.sortId="PointsInstancingLayer",this.layerIndex=t.layerIndex,this._pointsInstancingRenderers=(i=t.model.scene,s=i.id,(r=up[s])||(r=new ap(i),up[s]=r,r._compile(),i.on("compile",(function(){r._compile()})),i.on("destroyed",(function(){delete up[s],r._destroy()}))),r),this._aabb=q.collapseAABB3(),this._state=new ti({obb:q.OBB3(),numInstances:0,origin:t.origin?q.vec3(t.origin):null}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numSelectedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this.numIndices=t.geometry.numIndices,this._pickColors=[],this._offsets=[],this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._portions=[],this._finalized=!1,this.aabb=q.collapseAABB3()}return I(e,[{key:"createPortion",value:function(e){var t=e.meshMatrix,i=e.worldMatrix,s=e.aabb,r=e.pickColor;if(this._finalized)throw"Already finalized";this.model.scene.entityOffsetsEnabled&&(this._offsets.push(0),this._offsets.push(0),this._offsets.push(0)),this._modelMatrixCol0.push(t[0]),this._modelMatrixCol0.push(t[4]),this._modelMatrixCol0.push(t[8]),this._modelMatrixCol0.push(t[12]),this._modelMatrixCol1.push(t[1]),this._modelMatrixCol1.push(t[5]),this._modelMatrixCol1.push(t[9]),this._modelMatrixCol1.push(t[13]),this._modelMatrixCol2.push(t[2]),this._modelMatrixCol2.push(t[6]),this._modelMatrixCol2.push(t[10]),this._modelMatrixCol2.push(t[14]),this._pickColors.push(r[0]),this._pickColors.push(r[1]),this._pickColors.push(r[2]),this._pickColors.push(r[3]),q.collapseAABB3(s);for(var n=this._state.obb,o=n.length,a=0;a<o;a+=4)lp[0]=n[a+0],lp[1]=n[a+1],lp[2]=n[a+2],q.transformPoint4(t,lp,cp),i?(q.transformPoint4(i,cp,pp),q.expandAABB3Point3(s,pp)):q.expandAABB3Point3(s,cp);if(this._state.origin){var u=this._state.origin;s[0]+=u[0],s[1]+=u[1],s[2]+=u[2],s[3]+=u[0],s[4]+=u[1],s[5]+=u[2]}q.expandAABB3(this.aabb,s),this._state.numInstances++;var h=this._portions.length;return this._portions.push({}),this._numPortions++,this.model.numPortions++,h}},{key:"finalize",value:function(){if(this._finalized)throw"Already finalized";var e=this.model.scene.canvas.gl,t=this._pickColors.length;if(t>0){this._state.flagsBuf=new lt(e,e.ARRAY_BUFFER,new Uint8Array(t),t,4,e.DYNAMIC_DRAW,!1),this._state.flags2Buf=new lt(e,e.ARRAY_BUFFER,new Uint8Array(t),t,4,e.DYNAMIC_DRAW,!0)}if(this.model.scene.entityOffsetsEnabled&&this._offsets.length>0){this._state.offsetsBuf=new lt(e,e.ARRAY_BUFFER,new Float32Array(this._offsets),this._offsets.length,3,e.DYNAMIC_DRAW,!1),this._offsets=[]}if(this._modelMatrixCol0.length>0){var i=!1;this._state.modelMatrixCol0Buf=new lt(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol0),this._modelMatrixCol0.length,4,e.STATIC_DRAW,i),this._state.modelMatrixCol1Buf=new lt(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol1),this._modelMatrixCol1.length,4,e.STATIC_DRAW,i),this._state.modelMatrixCol2Buf=new lt(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol2),this._modelMatrixCol2.length,4,e.STATIC_DRAW,i),this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[]}if(this._pickColors.length>0){this._state.pickColorsBuf=new lt(e,e.ARRAY_BUFFER,new Uint8Array(this._pickColors),this._pickColors.length,4,e.STATIC_DRAW,!1),this._pickColors=[]}this._finalized=!0}},{key:"initFlags",value:function(e,t,i){t&me&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&xe&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&be&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&Pe&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&_e&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&Te&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&ge&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&ve&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),i&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(e,t,i),this._setFlags2(e,t)}},{key:"setVisible",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&me?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,i)}},{key:"setHighlighted",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&xe?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,i)}},{key:"setXRayed",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&be?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,i)}},{key:"setSelected",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Pe?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,i)}},{key:"setEdges",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&Te?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,i)}},{key:"setClippable",value:function(e,t){if(!this._finalized)throw"Not finalized";t&_e?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}},{key:"setCollidable",value:function(e,t){if(!this._finalized)throw"Not finalized"}},{key:"setPickable",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&ge?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags2(e,t,i)}},{key:"setCulled",value:function(e,t,i){if(!this._finalized)throw"Not finalized";t&ve?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,i)}},{key:"setColor",value:function(e,t){if(!this._finalized)throw"Not finalized";hp[0]=t[0],hp[1]=t[1],hp[2]=t[2],this._state.colorsBuf.setData(hp,3*e,3)}},{key:"setTransparent",value:function(e,t,i){i?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,i)}},{key:"_setFlags",value:function(e,t,i){if(!this._finalized)throw"Not finalized";var s,r,n=!!(t&me),o=!!(t&be),a=!!(t&xe),u=!!(t&Pe),h=!!(t&Te),l=!!(t&ge),c=!!(t&ve);s=!n||c||o||a&&!this.model.scene.highlightMaterial.glowThrough||u&&!this.model.scene.selectedMaterial.glowThrough?Gu:i?Uu:Hu,r=!n||c?Gu:u?zu:a?Vu:o?Wu:Gu;var p=0;p=!n||c?Gu:u?Ju:a?Ku:o?Zu:h?i?Yu:Xu:Gu;var d=n&&!c&&l?Qu:Gu;hp[0]=s,hp[1]=r,hp[2]=p,hp[3]=d,this._state.flagsBuf.setData(hp,4*e,4)}},{key:"_setFlags2",value:function(e,t){if(!this._finalized)throw"Not finalized";var i=t&_e?255:0;hp[0]=i,this._state.flags2Buf.setData(hp,4*e,4)}},{key:"setOffset",value:function(e,t){if(!this._finalized)throw"Not finalized";this.model.scene.entityOffsetsEnabled?(dp[0]=t[0],dp[1]=t[1],dp[2]=t[2],this._state.offsetsBuf.setData(dp,3*e,3)):this.model.error("Entity#offset not enabled for this Viewer")}},{key:"drawColorOpaque",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsInstancingRenderers.colorRenderer&&this._pointsInstancingRenderers.colorRenderer.drawLayer(t,this,Hu)}},{key:"drawColorTransparent",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsInstancingRenderers.colorRenderer&&this._pointsInstancingRenderers.colorRenderer.drawLayer(t,this,Uu)}},{key:"drawDepth",value:function(e,t){}},{key:"drawNormals",value:function(e,t){}},{key:"drawSilhouetteXRayed",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._pointsInstancingRenderers.silhouetteRenderer&&this._pointsInstancingRenderers.silhouetteRenderer.drawLayer(t,this,Wu)}},{key:"drawSilhouetteHighlighted",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._pointsInstancingRenderers.silhouetteRenderer&&this._pointsInstancingRenderers.silhouetteRenderer.drawLayer(t,this,Vu)}},{key:"drawSilhouetteSelected",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._pointsInstancingRenderers.silhouetteRenderer&&this._pointsInstancingRenderers.silhouetteRenderer.drawLayer(t,this,zu)}},{key:"drawEdgesColorOpaque",value:function(e,t){}},{key:"drawEdgesColorTransparent",value:function(e,t){}},{key:"drawEdgesHighlighted",value:function(e,t){}},{key:"drawEdgesSelected",value:function(e,t){}},{key:"drawEdgesXRayed",value:function(e,t){}},{key:"drawOcclusion",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsInstancingRenderers.occlusionRenderer&&this._pointsInstancingRenderers.occlusionRenderer.drawLayer(t,this,Hu)}},{key:"drawShadow",value:function(e,t){}},{key:"drawPickMesh",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsInstancingRenderers.pickMeshRenderer&&this._pointsInstancingRenderers.pickMeshRenderer.drawLayer(t,this,Qu)}},{key:"drawPickDepths",value:function(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsInstancingRenderers.pickDepthRenderer&&this._pointsInstancingRenderers.pickDepthRenderer.drawLayer(t,this,Qu)}},{key:"drawPickNormals",value:function(e,t){}},{key:"destroy",value:function(){var e=this._state;e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.modelMatrixCol0Buf&&(e.modelMatrixCol0Buf.destroy(),e.modelMatrixCol0Buf=null),e.modelMatrixCol1Buf&&(e.modelMatrixCol1Buf.destroy(),e.modelMatrixCol1Buf=null),e.modelMatrixCol2Buf&&(e.modelMatrixCol2Buf.destroy(),e.modelMatrixCol2Buf=null),e.pickColorsBuf&&(e.pickColorsBuf.destroy(),e.pickColorsBuf=null),e.destroy()}}]),e}(),mp=function(){function e(t){w(this,e),this.id=t.id,this.colorTexture=t.colorTexture,this.metallicRoughnessTexture=t.metallicRoughnessTexture,this.normalsTexture=t.normalsTexture,this.emissiveTexture=t.emissiveTexture,this.occlusionTexture=t.occlusionTexture}return I(e,[{key:"destroy",value:function(){}}]),e}(),vp=function(){function e(t,i,s){w(this,e),this.id=s.id,this.model=s.model,this.primitive=s.primitive,this.positions=null,this.positionsCompressed=null,this.quantizedPositions=null,this.positionsDecodeMatrix=q.mat4(),this.normals=null,this.normalsCompressed=null,this.colors=null,this.colorsCompressed=null,this.uv=null,this.uvCompressed=null,this.uvDecodeMatrix=null,this.indices=null,this.numIndices=0,this.obb=q.OBB3(),this.positionsBuf=null,this.normalsBuf=null,this.edgeIndicesBuf=null,this.uvBuf=null,this.colorsBuf=null;var r=i.scene.pickSurfacePrecisionEnabled,n=i.scene.canvas.gl;if(s.positionsCompressed&&s.positionsCompressed.length>0){this.positionsBuf=new lt(n,n.ARRAY_BUFFER,s.positionsCompressed,s.positionsCompressed.length,3,n.STATIC_DRAW,!1),this.positionsDecodeMatrix.set(s.positionsDecodeMatrix);var o=q.collapseAABB3();q.expandAABB3Points3(o,s.positionsCompressed),ui.decompressAABB(o,this.positionsDecodeMatrix),q.AABB3ToOBB3(o,this.obb),r&&(this.quantizedPositions=s.positionsCompressed)}else if(s.positions&&s.positions.length>0){var a=s.positions.length,u=q.collapseAABB3();q.expandAABB3Points3(u,s.positions),q.AABB3ToOBB3(u,this.obb);var h=jh(s.positions,u,this.positionsDecodeMatrix);this.positionsBuf=new lt(n,n.ARRAY_BUFFER,h,a,3,n.STATIC_DRAW,!1),r&&(this.quantizedPositions=h)}if(s.normalsCompressed&&s.normalsCompressed.length>0){this.normalsBuf=new lt(n,n.ARRAY_BUFFER,s.normalsCompressed,s.normalsCompressed.length,3,n.STATIC_DRAW,!0)}else if(s.normals&&s.normals.length>0){var l=function(e){for(var t,i,s,r,n=e.length,o=new Int8Array(n),a=0;a<n;a+=3)i=t=Hh(e,a,"floor","floor"),s=r=Vh(e,a,Uh(t)),(s=Vh(e,a,Uh(t=Hh(e,a,"ceil","floor"))))>r&&(i=t,r=s),(s=Vh(e,a,Uh(t=Hh(e,a,"floor","ceil"))))>r&&(i=t,r=s),(s=Vh(e,a,Uh(t=Hh(e,a,"ceil","ceil"))))>r&&(i=t,r=s),o[a+0]=i[0],o[a+1]=i[1],o[a+2]=0;return o}(s.normals);this.normalsBuf=new lt(n,n.ARRAY_BUFFER,l,l.length,3,n.STATIC_DRAW,!0)}if(s.colorsCompressed&&s.colorsCompressed.length>0){var c=new Uint8Array(s.colorsCompressed);this.colorsBuf=new lt(n,n.ARRAY_BUFFER,c,c.length,4,n.STATIC_DRAW,!1)}else if(s.colors&&s.colors.length>0){for(var p=s.colors,d=new Uint8Array(p.length),f=0,m=p.length;f<m;f++)d[f]=255*p[f];this.colorsBuf=new lt(n,n.ARRAY_BUFFER,d,d.length,4,n.STATIC_DRAW,!1)}if(s.uvCompressed&&s.uvCompressed.length>0){var v=new Uint16Array(s.uvCompressed);this.uvDecodeMatrix=q.mat4(s.uvDecodeMatrix),this.uvBuf=new lt(n,n.ARRAY_BUFFER,s.uvCompressed,v.length,2,n.STATIC_DRAW,!1)}else if(s.uv&&s.uv.length>0){var g=ui.getUVBounds(s.uv),_=ui.compressUVs(s.uv,g.min,g.max),y=_.quantized;this.uvDecodeMatrix=_.decodeMatrix,this.uvBuf=new lt(n,n.ARRAY_BUFFER,y,y.length,2,n.STATIC_DRAW,!1)}if(s.indices&&s.indices.length>0&&(this.indicesBuf=new lt(n,n.ELEMENT_ARRAY_BUFFER,new Uint32Array(s.indices),s.indices.length,1,n.STATIC_DRAW),r&&(this.indices=s.indices),this.numIndices=s.indices.length),"triangles"===s.primitive||"solid"===s.primitive||"surface"===s.primitive){var b=s.edgeIndices;b||(b=Dt(s.positions,s.indices,null,s.edgeThreshold||10)),this.edgeIndicesBuf=new lt(n,n.ELEMENT_ARRAY_BUFFER,new Uint32Array(b),b.length,1,n.STATIC_DRAW)}}return I(e,[{key:"destroy",value:function(){}}]),e}(),gp=function(){function e(t){w(this,e),this.id=t.id,this.texture=t.texture}return I(e,[{key:"destroy",value:function(){this.texture&&(this.texture.destroy(),this.texture=null)}}]),e}(),_p={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},yp=function(){function e(t,i,s){w(this,e),this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=t,this.onProgress=i,this.onError=s}return I(e,[{key:"itemStart",value:function(e){this.itemsTotal++,!1===this.isLoading&&void 0!==this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0}},{key:"itemEnd",value:function(e){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())}},{key:"itemError",value:function(e){void 0!==this.onError&&this.onError(e)}},{key:"resolveURL",value:function(e){return this.urlModifier?this.urlModifier(e):e}},{key:"setURLModifier",value:function(e){return this.urlModifier=e,this}},{key:"addHandler",value:function(e,t){return this.handlers.push(e,t),this}},{key:"removeHandler",value:function(e){var t=this.handlers.indexOf(e);return-1!==t&&this.handlers.splice(t,2),this}},{key:"getHandler",value:function(e){for(var t=0,i=this.handlers.length;t<i;t+=2){var s=this.handlers[t],r=this.handlers[t+1];if(s.global&&(s.lastIndex=0),s.test(e))return r}return null}}]),e}(),bp=new yp,xp=function(){function e(t){w(this,e),this.manager=void 0!==t?t:bp,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return I(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var i=this;return new Promise((function(s,r){i.load(e,s,t,r)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}(),Pp={},Tp=function(e){g(i,xp);var t=y(i);function i(e){return w(this,i),t.call(this,e)}return I(i,[{key:"load",value:function(e,t,i,s){var r=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=_p.get(e);if(void 0!==n)return this.manager.itemStart(e),setTimeout((function(){t&&t(n),r.manager.itemEnd(e)}),0),n;if(void 0===Pp[e]){Pp[e]=[],Pp[e].push({onLoad:t,onProgress:i,onError:s});var o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,u=this.responseType;fetch(o).then((function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body.getReader)return t;var i=Pp[e],s=t.body.getReader(),r=t.headers.get("Content-Length"),n=r?parseInt(r):0,o=0!==n,a=0,u=new ReadableStream({start:function(e){!function t(){s.read().then((function(s){var r=s.done,u=s.value;if(r)e.close();else{a+=u.byteLength;for(var h=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:n}),l=0,c=i.length;l<c;l++){var p=i[l];p.onProgress&&p.onProgress(h)}e.enqueue(u),t()}}))}()}});return new Response(u)}throw Error('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText))})).then((function(e){switch(u){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((function(e){return(new DOMParser).parseFromString(e,a)}));case"json":return e.json();default:if(void 0===a)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(a),i=t&&t[1]?t[1].toLowerCase():void 0,s=new TextDecoder(i);return e.arrayBuffer().then((function(e){return s.decode(e)}))}})).then((function(t){_p.add(e,t);var i=Pp[e];delete Pp[e];for(var s=0,r=i.length;s<r;s++){var n=i[s];n.onLoad&&n.onLoad(t)}})).catch((function(t){var i=Pp[e];if(void 0===i)throw r.manager.itemError(e),t;delete Pp[e];for(var s=0,n=i.length;s<n;s++){var o=i[s];o.onError&&o.onError(t)}r.manager.itemError(e)})).finally((function(){r.manager.itemEnd(e)})),this.manager.itemStart(e)}else Pp[e].push({onLoad:t,onProgress:i,onError:s})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),i}(),wp=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;w(this,e),this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}return I(e,[{key:"_initWorker",value:function(e){if(!this.workers[e]){var t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}},{key:"_getIdleWorker",value:function(){for(var e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}},{key:"_onMessage",value:function(e,t){var i=this.workersResolve[e];if(i&&i(t),this.queue.length){var s=this.queue.shift(),r=s.resolve,n=s.msg,o=s.transfer;this.workersResolve[e]=r,this.workers[e].postMessage(n,o)}else this.workerStatus^=1<<e}},{key:"setWorkerCreator",value:function(e){this.workerCreator=e}},{key:"setWorkerLimit",value:function(e){this.pool=e}},{key:"postMessage",value:function(e,t){var i=this;return new Promise((function(s){var r=i._getIdleWorker();-1!==r?(i._initWorker(r),i.workerStatus|=1<<r,i.workersResolve[r]=s,i.workers[r].postMessage(e,t)):i.queue.push({resolve:s,msg:e,transfer:t})}))}},{key:"destroy",value:function(){this.workers.forEach((function(e){return e.terminate()})),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}]),e}(),Mp=0,Ip=function(){function e(t){var i=t.viewer,s=t.transcoderPath,r=t.workerLimit;w(this,e),this._transcoderPath=s||"https://cdn.jsdelivr.net/npm/@xeokit/xeokit-sdk/dist/basis/",this._transcoderBinary=null,this._transcoderPending=null,this._workerPool=new wp,this._workerSourceURL="",r&&this._workerPool.setWorkerLimit(r);var n=i.capabilities;this._workerConfig={astcSupported:n.astcSupported,etc1Supported:n.etc1Supported,etc2Supported:n.etc2Supported,dxtSupported:n.dxtSupported,bptcSupported:n.bptcSupported,pvrtcSupported:n.pvrtcSupported},this._supportedFileTypes=["xkt2"]}return I(e,[{key:"_init",value:function(){var t=this;if(!this._transcoderPending){var i=new Tp;i.setPath(this._transcoderPath),i.setWithCredentials(this.withCredentials);var s=i.loadAsync("basis_transcoder.js"),r=new Tp;r.setPath(this._transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);var n=r.loadAsync("basis_transcoder.wasm");this._transcoderPending=Promise.all([s,n]).then((function(i){var s=p(i,2),r=s[0],n=s[1],o=e.BasisWorker.toString(),a=["/* constants */","let _EngineFormat = "+JSON.stringify(e.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(e.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(e.BasisFormat),"/* basis_transcoder.js */",r,"/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join("\n");t._workerSourceURL=URL.createObjectURL(new Blob([a])),t._transcoderBinary=n,t._workerPool.setWorkerCreator((function(){var e=new Worker(t._workerSourceURL),i=t._transcoderBinary.slice(0);return e.postMessage({type:"init",config:t._workerConfig,transcoderBinary:i},[i]),e}))})),Mp>0&&console.warn("KTX2TextureTranscoder: Multiple active KTX2TextureTranscoder may cause performance issues. Use a single KTX2TextureTranscoder instance, or call .dispose() on old instances."),Mp++}return this._transcoderPending}},{key:"transcode",value:function(e,t){var i=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((function(r,n){var o=s;i._init().then((function(){return i._workerPool.postMessage({type:"transcode",buffers:e,taskConfig:o},e)})).then((function(e){var i=e.data,s=i.mipmaps,o=(i.width,i.height,i.format),a=i.type,u=i.error,h=i.dfdTransferFn,l=i.dfdFlags;if("error"===a)return n(u);t.setCompressedData({mipmaps:s,props:{format:o,minFilter:1===s.length?1006:1008,magFilter:1===s.length?1006:1008,encoding:2===h?3001:3e3,premultiplyAlpha:!!(1&l)}}),r()}))}))}},{key:"destroy",value:function(){URL.revokeObjectURL(this._workerSourceURL),this._workerPool.destroy(),Mp--}}]),e}();Ip.BasisFormat={ETC1S:0,UASTC_4x4:1},Ip.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Ip.EngineFormat={RGBAFormat:1023,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776},Ip.BasisWorker=function(){var e,t,i,s=_EngineFormat,r=_TranscoderFormat,n=_BasisFormat;self.addEventListener("message",(function(o){var l,c=o.data;switch(c.type){case"init":e=c.config,l=c.transcoderBinary,t=new Promise((function(e){i={wasmBinary:l,onRuntimeInitialized:e},BASIS(i)})).then((function(){i.initializeBasis(),void 0===i.KTX2File&&console.warn("KTX2TextureTranscoder: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((function(){try{for(var t=function(t){var o=new i.KTX2File(new Uint8Array(t));function l(){o.close(),o.delete()}if(!o.isValid())throw l(),new Error("KTX2TextureTranscoder: Invalid or unsupported .ktx2 file");var c=o.isUASTC()?n.UASTC_4x4:n.ETC1S,p=o.getWidth(),d=o.getHeight(),f=o.getLevels(),m=o.getHasAlpha(),v=o.getDFDTransferFunc(),g=o.getDFDFlags(),_=function(t,i,o,l){for(var c,p,d=t===n.ETC1S?a:u,f=0;f<d.length;f++){var m=d[f];if(e[m.if]&&(m.basisFormat.includes(t)&&!(l&&m.transcoderFormat.length<2)&&(!m.needsPowerOfTwo||h(i)&&h(o))))return{transcoderFormat:c=m.transcoderFormat[l?1:0],engineFormat:p=m.engineFormat[l?1:0]}}return console.warn("KTX2TextureTranscoder: No suitable compressed texture format found. Decoding to RGBA32."),c=r.RGBA32,p=s.RGBAFormat,{transcoderFormat:c,engineFormat:p}}(c,p,d,m),y=_.transcoderFormat,b=_.engineFormat;if(!p||!d||!f)throw l(),new Error("KTX2TextureTranscoder: Invalid texture");if(!o.startTranscoding())throw l(),new Error("KTX2TextureTranscoder: .startTranscoding failed");for(var x=[],P=0;P<f;P++){var T=o.getImageLevelInfo(P,0,0),w=T.origWidth,M=T.origHeight,I=new Uint8Array(o.getImageTranscodedSizeInBytes(P,0,0,y));if(!o.transcodeImage(I,P,0,0,y,0,-1,-1))throw l(),new Error("KTX2TextureTranscoder: .transcodeImage failed.");x.push({data:I,width:w,height:M})}return l(),{width:p,height:d,hasAlpha:m,mipmaps:x,format:b,dfdTransferFn:v,dfdFlags:g}}(c.buffers[0]),o=t.width,l=t.height,p=t.hasAlpha,d=t.mipmaps,f=t.format,m=t.dfdTransferFn,v=t.dfdFlags,g=[],_=0;_<d.length;++_)g.push(d[_].data.buffer);self.postMessage({type:"transcode",id:c.id,width:o,height:l,hasAlpha:p,mipmaps:d,format:f,dfdTransferFn:m,dfdFlags:v},g)}catch(e){console.error("[KTX2TextureTranscoder.BasisWorker]: ".concat(e)),self.postMessage({type:"error",id:c.id,error:e.message})}}))}}));var o=[{if:"astcSupported",basisFormat:[n.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[s.RGB_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=o.sort((function(e,t){return e.priorityETC1S-t.priorityETC1S})),u=o.sort((function(e,t){return e.priorityUASTC-t.priorityUASTC}));function h(e){return e<=2||0==(e&e-1)&&0!==e}};var Cp={};function Dp(e){var t=e.scene.id,i=Cp[t];return i||(i=new Ip({viewer:e}),Cp[t]=i,e.scene.on("destroyed",(function(){delete Cp[t],i.destroy()}))),i}var Ap=q.vec3(),kp=q.mat4(),Ep=q.vec3([1,1,1]),Fp=q.vec3([0,0,0]),Rp=q.vec3([0,0,0]),Sp=q.identityQuaternion(),Op=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._textureTranscoder=r.textureTranscoder||Dp(s.scene.viewer),s._maxGeometryBatchSize=r.maxGeometryBatchSize,s._aabb=q.collapseAABB3(),s._aabbDirty=!1,s._layerList=[],s._nodeList=[],s._lastOrigin=null,s._lastPositionsDecodeMatrix=null,s._lastNormals=null,s._instancingLayers={},s._currentBatchingLayers={},s._scratchMemory=ju(),s._geometries={},s._textures={},s._textureSets={},s._meshes={},s._nodes={},s.renderFlags=new Bs,s.numGeometries=0,s.numPortions=0,s.numVisibleLayerPortions=0,s.numTransparentLayerPortions=0,s.numXRayedLayerPortions=0,s.numHighlightedLayerPortions=0,s.numSelectedLayerPortions=0,s.numEdgesLayerPortions=0,s.numPickableLayerPortions=0,s.numClippableLayerPortions=0,s.numCulledLayerPortions=0,s.numEntities=0,s._numTriangles=0,s._numLines=0,s._numPoints=0,s._edgeThreshold=r.edgeThreshold||10,s._origin=q.vec3(r.origin||[0,0,0]),s._position=q.vec3(r.position||[0,0,0]),s._rotation=q.vec3(r.rotation||[0,0,0]),s._quaternion=q.vec4(r.quaternion||[0,0,0,1]),r.rotation&&q.eulerToQuaternion(s._rotation,"XYZ",s._quaternion),s._scale=q.vec3(r.scale||[1,1,1]),s._worldMatrix=q.mat4(),q.composeMat4(s._position,s._quaternion,s._scale,s._worldMatrix),s._worldNormalMatrix=q.mat4(),q.inverseMat4(s._worldMatrix,s._worldNormalMatrix),q.transposeMat4(s._worldNormalMatrix),(r.matrix||r.position||r.rotation||r.scale||r.quaternion)&&(s._viewMatrix=q.mat4(),s._viewNormalMatrix=q.mat4(),s._viewMatrixDirty=!0,s._worldMatrixNonIdentity=!0),s._opacity=1,s._colorize=[1,1,1],s._saoEnabled=!1!==r.saoEnabled,s._pbrEnabled=!1!==r.pbrEnabled,s._colorTextureEnabled=!1!==r.colorTextureEnabled,s._isModel=r.isModel,s._isModel&&s.scene._registerModel(x(s)),s._onCameraViewMatrix=s.scene.camera.on("matrix",(function(){s._viewMatrixDirty=!0})),s._createDefaultTextureSet(),s.visible=r.visible,s.culled=r.culled,s.pickable=r.pickable,s.clippable=r.clippable,s.collidable=r.collidable,s.castsShadow=r.castsShadow,s.receivesShadow=r.receivesShadow,s.xrayed=r.xrayed,s.highlighted=r.highlighted,s.selected=r.selected,s.edges=r.edges,s.colorize=r.colorize,s.opacity=r.opacity,s.backfaces=r.backfaces,s}return I(i,[{key:"_createDefaultTextureSet",value:function(){var e=new gp({id:"defaultColorTexture",texture:new ma({gl:this.scene.canvas.gl,preloadColor:[1,1,1,1]})}),t=new gp({id:"defaultMetalRoughTexture",texture:new ma({gl:this.scene.canvas.gl,preloadColor:[0,1,1,1]})}),i=new gp({id:"defaultNormalsTexture",texture:new ma({gl:this.scene.canvas.gl,preloadColor:[0,0,0,0]})}),s=new gp({id:"defaultEmissiveTexture",texture:new ma({gl:this.scene.canvas.gl,preloadColor:[0,0,0,1]})}),r=new gp({id:"defaultOcclusionTexture",texture:new ma({gl:this.scene.canvas.gl,preloadColor:[1,1,1,1]})});this._textures.defaultColorTexture=e,this._textures.defaultMetalRoughTexture=t,this._textures.defaultNormalsTexture=i,this._textures.defaultEmissiveTexture=s,this._textures.defaultOcclusionTexture=r,this._textureSets.defaultTextureSet=new mp({id:"defaultTextureSet",model:this,colorTexture:e,metallicRoughnessTexture:t,normalsTexture:i,emissiveTexture:s,occlusionTexture:r})}},{key:"isPerformanceModel",get:function(){return!0}},{key:"objects",get:function(){return this._nodes}},{key:"origin",get:function(){return this._origin}},{key:"position",get:function(){return this._position}},{key:"rotation",get:function(){return this._rotation}},{key:"quaternion",get:function(){return this._quaternion}},{key:"scale",get:function(){return this._scale}},{key:"matrix",get:function(){return this._worldMatrix}},{key:"worldMatrix",get:function(){return this._worldMatrix}},{key:"worldNormalMatrix",get:function(){return this._worldNormalMatrix}},{key:"viewMatrix",get:function(){return this._viewMatrix?(this._viewMatrixDirty&&(q.mulMat4(this.scene.camera.viewMatrix,this._worldMatrix,this._viewMatrix),q.inverseMat4(this._viewMatrix,this._viewNormalMatrix),q.transposeMat4(this._viewNormalMatrix),this._viewMatrixDirty=!1),this._viewMatrix):this.scene.camera.viewMatrix}},{key:"viewNormalMatrix",get:function(){return this._viewNormalMatrix?(this._viewMatrixDirty&&(q.mulMat4(this.scene.camera.viewMatrix,this._worldMatrix,this._viewMatrix),q.inverseMat4(this._viewMatrix,this._viewNormalMatrix),q.transposeMat4(this._viewNormalMatrix),this._viewMatrixDirty=!1),this._viewNormalMatrix):this.scene.camera.viewNormalMatrix}},{key:"backfaces",get:function(){return this._backfaces},set:function(e){e=!!e,this._backfaces=e,this.glRedraw()}},{key:"entityList",get:function(){return this._nodeList}},{key:"isEntity",get:function(){return!0}},{key:"isModel",get:function(){return this._isModel}},{key:"isObject",get:function(){return!1}},{key:"aabb",get:function(){return this._aabbDirty&&this._rebuildAABB(),this._aabb}},{key:"numTriangles",get:function(){return this._numTriangles}},{key:"numLines",get:function(){return this._numLines}},{key:"numPoints",get:function(){return this._numPoints}},{key:"visible",get:function(){return this.numVisibleLayerPortions>0},set:function(e){e=!1!==e,this._visible=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].visible=e;this.glRedraw()}},{key:"xrayed",get:function(){return this.numXRayedLayerPortions>0},set:function(e){e=!!e,this._xrayed=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].xrayed=e;this.glRedraw()}},{key:"highlighted",get:function(){return this.numHighlightedLayerPortions>0},set:function(e){e=!!e,this._highlighted=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].highlighted=e;this.glRedraw()}},{key:"selected",get:function(){return this.numSelectedLayerPortions>0},set:function(e){e=!!e,this._selected=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].selected=e;this.glRedraw()}},{key:"edges",get:function(){return this.numEdgesLayerPortions>0},set:function(e){e=!!e,this._edges=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].edges=e;this.glRedraw()}},{key:"culled",get:function(){return this._culled},set:function(e){e=!!e,this._culled=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].culled=e;this.glRedraw()}},{key:"clippable",get:function(){return this._clippable},set:function(e){e=!1!==e,this._clippable=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].clippable=e;this.glRedraw()}},{key:"collidable",get:function(){return this._collidable},set:function(e){e=!1!==e,this._collidable=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].collidable=e}},{key:"pickable",get:function(){return this.numPickableLayerPortions>0},set:function(e){e=!1!==e,this._pickable=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].pickable=e}},{key:"colorize",get:function(){return this._colorize},set:function(e){this._colorize=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].colorize=e}},{key:"opacity",get:function(){return this._opacity},set:function(e){this._opacity=e;for(var t=0,i=this._nodeList.length;t<i;t++)this._nodeList[t].opacity=e}},{key:"castsShadow",get:function(){return this._castsShadow},set:function(e){(e=!1!==e)!==this._castsShadow&&(this._castsShadow=e,this.glRedraw())}},{key:"receivesShadow",get:function(){return this._receivesShadow},set:function(e){(e=!1!==e)!==this._receivesShadow&&(this._receivesShadow=e,this.glRedraw())}},{key:"saoEnabled",get:function(){return this._saoEnabled}},{key:"pbrEnabled",get:function(){return this._pbrEnabled}},{key:"colorTextureEnabled",get:function(){return this._colorTextureEnabled}},{key:"isDrawable",get:function(){return!0}},{key:"isStateSortable",get:function(){return!1}},{key:"xrayMaterial",get:function(){return this.scene.xrayMaterial}},{key:"highlightMaterial",get:function(){return this.scene.highlightMaterial}},{key:"selectedMaterial",get:function(){return this.scene.selectedMaterial}},{key:"edgeMaterial",get:function(){return this.scene.edgeMaterial}},{key:"getPickViewMatrix",value:function(e){return this._viewMatrix?this._viewMatrix:e}},{key:"createGeometry",value:function(e){var t=e.id;if(null!=t)if(this._geometries[t])this.error("Geometry already created: "+t);else{var i=e.primitive;if(null!=i)if("points"===i||"lines"===i||"triangles"===i||"solid"===i||"surface"===i){if(!e.positions&&!e.positionsCompressed)return this.error("Param expected: `positions` or `positionsCompressed'"),null;if(e.positionsCompressed&&!e.positionsDecodeMatrix)return this.error("Param expected: `positionsDecodeMatrix` (required for `positionsCompressed')"),null;if(e.uvCompressed&&!e.uvDecodeMatrix)return this.error("Param expected: `uvDecodeMatrix` (required for `uvCompressed')"),null;if(!e.indices&&"points"!==i)return this.error("Param expected: indices (required for '".concat(i,"' primitive type)")),null;var s=new vp(t,this,e);this._geometries[t]=s,this._numTriangles+=e.indices?Math.round(e.indices.length/3):0,this.numGeometries++}else this.error("Unsupported value for 'primitive': '".concat(i,"' - supported values are 'points', 'lines', 'triangles', 'solid' and 'surface'. Defaulting to 'triangles'."));else this.error("Param expected: primitive")}else this.error("Config missing: id")}},{key:"createTexture",value:function(e){var t=this,i=e.id;if(null!=i)if(this._textures[i])this.error("Texture already created: "+i);else{if(!e.src&&!e.image&&!e.buffers)return this.error("Param expected: `src`, `image' or 'buffers'"),null;var s=e.minFilter||1008;1006!==s&&1007!==s&&1008!==s&&1005!==s&&1004!==s&&(this.error("[createTexture] Unsupported value for 'minFilter' - \n            supported values are LinearFilter, LinearMipMapNearestFilter, NearestMipMapNearestFilter, \n            NearestMipMapLinearFilter and LinearMipmapLinearFilter. Defaulting to LinearMipmapLinearFilter."),s=1008);var r=e.magFilter||1006;1006!==r&&1003!==r&&(this.error("[createTexture] Unsupported value for 'magFilter' - supported values are LinearFilter and NearestFilter. Defaulting to LinearFilter."),r=1006);var n=e.wrapS||1e3;1001!==n&&1002!==n&&1e3!==n&&(this.error("[createTexture] Unsupported value for 'wrapS' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),n=1e3);var o=e.wrapT||1e3;1001!==o&&1002!==o&&1e3!==o&&(this.error("[createTexture] Unsupported value for 'wrapT' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),o=1e3);var a=e.wrapR||1e3;1001!==a&&1002!==a&&1e3!==a&&(this.error("[createTexture] Unsupported value for 'wrapR' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),a=1e3);var u=e.encoding||3e3;3e3!==u&&3001!==u&&(this.error("[createTexture] Unsupported value for 'encoding' - supported values are LinearEncoding and sRGBEncoding. Defaulting to LinearEncoding."),u=3e3);var h=new ma({gl:this.scene.canvas.gl,minFilter:s,magFilter:r,wrapS:n,wrapT:o,wrapR:a,encoding:u});if(e.preloadColor&&h.setPreloadColor(e.preloadColor),e.image){var l=e.image;l.crossOrigin="Anonymous",h.setImage(l,{minFilter:s,magFilter:r,wrapS:n,wrapT:o,wrapR:a,flipY:e.flipY,encoding:u})}else if(e.src){var c=e.src.split(".").pop();switch(c){case"jpeg":case"jpg":case"png":case"gif":var p=new Image;p.onload=function(){h.setImage(p,{minFilter:s,magFilter:r,wrapS:n,wrapT:o,wrapR:a,flipY:e.flipY,encoding:u}),t.glRedraw()},p.src=e.src;break;default:this._textureTranscoder?re.loadArraybuffer(e.src,(function(e){e.byteLength?t._textureTranscoder.transcode([e],h).then((function(){t.glRedraw()})):t.error("Can't create texture from 'src': file data is zero length")}),(function(e){this.error("Can't create texture from 'src': ".concat(e))})):this.error("Can't create texture from 'src' - VBOSceneModel needs to be configured with a TextureTranscoder for this file type ('".concat(c,"')"))}}else e.buffers&&(this._textureTranscoder?this._textureTranscoder.transcode(e.buffers,h).then((function(){t.glRedraw()})):this.error("Can't create texture from 'buffers' - VBOSceneModel needs to be configured with a TextureTranscoder for this option"));this._textures[i]=new gp({id:i,texture:h})}else this.error("Config missing: id")}},{key:"createTextureSet",value:function(e){var t=e.id;if(null!=t)if(this._textureSets[t])this.error("Texture set already created: ".concat(t));else{var i,s,r,n,o;if(void 0!==e.colorTextureId&&null!==e.colorTextureId){if(!(i=this._textures[e.colorTextureId]))return void this.error("Texture not found: ".concat(e.colorTextureId," - ensure that you create it first with createTexture()"))}else i=this._textures.defaultColorTexture;if(void 0!==e.metallicRoughnessTextureId&&null!==e.metallicRoughnessTextureId){if(!(s=this._textures[e.metallicRoughnessTextureId]))return void this.error("Texture not found: ".concat(e.metallicRoughnessTextureId," - ensure that you create it first with createTexture()"))}else s=this._textures.defaultMetalRoughTexture;if(void 0!==e.normalsTextureId&&null!==e.normalsTextureId){if(!(r=this._textures[e.normalsTextureId]))return void this.error("Texture not found: ".concat(e.normalsTextureId," - ensure that you create it first with createTexture()"))}else r=this._textures.defaultNormalsTexture;if(void 0!==e.emissiveTextureId&&null!==e.emissiveTextureId){if(!(n=this._textures[e.emissiveTextureId]))return void this.error("Texture not found: ".concat(e.emissiveTextureId," - ensure that you create it first with createTexture()"))}else n=this._textures.defaultEmissiveTexture;if(void 0!==e.occlusionTextureId&&null!==e.occlusionTextureId){if(!(o=this._textures[e.occlusionTextureId]))return void this.error("Texture not found: ".concat(e.occlusionTextureId," - ensure that you create it first with createTexture()"))}else o=this._textures.defaultOcclusionTexture;var a=new mp({id:t,model:this,colorTexture:i,metallicRoughnessTexture:s,normalsTexture:r,emissiveTexture:n,occlusionTexture:o});this._textureSets[t]=a}else this.error("Config missing: id")}},{key:"createMesh",value:function(e){var t=e.id;if(null!=t)if(this._meshes[t])this.error("VBOSceneModel already has a mesh with this ID: ".concat(t));else{var i=e.geometryId,s=void 0!==e.geometryId;if(!s||this._geometries[e.geometryId]){var r=e.textureSetId||"defaultTextureSet";if(!r||this._textureSets[r]){var n,o,a=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):[255,255,255],u=void 0!==e.opacity&&null!==e.opacity?Math.floor(255*e.opacity):255,h=void 0!==e.metallic&&null!==e.metallic?Math.floor(255*e.metallic):0,l=void 0!==e.roughness&&null!==e.roughness?Math.floor(255*e.roughness):255,c=new Bu(this,t,a,u),p=c.pickId,d=new Uint8Array([255&p,p>>8&255,p>>16&255,p>>24&255]),f=q.collapseAABB3();if(s){var m,v=this._worldMatrixNonIdentity?this._worldMatrix:null;if(e.matrix)m=e.matrix;else{var g=e.scale||Ep,_=e.position||Fp,y=e.rotation||Rp;q.eulerToQuaternion(y,"XYZ",Sp),m=q.composeMat4(_,Sp,g,kp)}var b=e.origin||e.rtcCenter,x=b?q.addVec3(this._origin,b,Ap):this._origin,P=this._getInstancingLayer(x,r,i);o=P,n=P.createPortion({color:a,metallic:h,roughness:l,opacity:u,meshMatrix:m,worldMatrix:v,aabb:f,pickColor:d}),q.expandAABB3(this._aabb,f);var T=Math.round(P.numIndices/3);this._numTriangles+=T,c.numTriangles=T,c.origin=x}else{var w=e.primitive;if(null==w&&(w="triangles"),"points"!==w&&"lines"!==w&&"triangles"!==w&&"solid"!==w&&"surface"!==w)return void this.error("Unsupported value for 'primitive': '".concat(w,"'  ('geometryId' is absent) - supported values are 'points', 'lines', 'triangles', 'solid' and 'surface'."));if(!e.positions&&!e.positionsCompressed)return this.error("Param expected: 'positions' or 'positionsCompressed'  ('geometryId' is absent)"),null;if(e.positions&&e.positionsCompressed)return this.error("Only one param expected, not both: 'positions' or 'positionsCompressed' ('geometryId' is absent)"),null;if(e.positionsCompressed&&!e.positionsDecodeMatrix)return this.error("Param expected: 'positionsDecodeMatrix' (required for 'positionsCompressed'; 'geometryId' is absent)"),null;if(e.uvCompressed&&!e.uvDecodeMatrix)return this.error("Param expected: `uvDecodeMatrix` (required for `uvCompressed'; 'geometryId' is absent)"),null;if(!e.indices&&"points"!==w)return this.error("Param expected: indices (required for '".concat(w,"' primitive type)")),null;if(!e.indices&&"points"!==w)return this.error("Config expected: indices (no meshIds provided, so expecting geometry arrays instead)"),null;var M=e.indices,I=e.edgeIndices,C=e.origin||e.rtcCenter?q.addVec3(this._origin,e.origin||e.rtcCenter,Ap):this._origin,D=e.positions;if(D){var A=q.vec3(),k=[];ke(D,k,A)&&(D=k,C=q.addVec3(C,A,A))}var E=!1;if(this._lastOrigin?q.compareVec3(this._lastOrigin,C)||(E=!0,this._lastOrigin.set(C)):(E=!0,this._lastOrigin=q.vec3(C)),e.positionsDecodeMatrix&&(this._lastPositionsDecodeMatrix?q.compareMat4(this._lastPositionsDecodeMatrix,e.positionsDecodeMatrix)||(E=!0,this._lastPositionsDecodeMatrix.set(e.positionsDecodeMatrix)):(E=!0,this._lastPositionsDecodeMatrix=q.mat4(e.positionsDecodeMatrix))),e.uvDecodeMatrix&&(this._lastUVDecodeMatrix?q.compareMat4(this._lastUVDecodeMatrix,e.uvDecodeMatrix)||(E=!0,this._lastUVDecodeMatrix.set(e.uvDecodeMatrix)):(E=!0,this._lastUVDecodeMatrix=q.mat4(e.uvDecodeMatrix))),e.textureSetId&&this._lastTextureSetId!==e.textureSetId&&(E=!0,this._lastTextureSetId=e.textureSetId),E){for(var F in this._currentBatchingLayers)this._currentBatchingLayers.hasOwnProperty(F)&&this._currentBatchingLayers[F].finalize();this._currentBatchingLayers={}}var R=!!e.normals&&e.normals.length>0;if("triangles"===w||"solid"===w||"surface"===w){if(null!==this._lastNormals&&R!==this._lastNormals)for(var S in this._currentBatchingLayers)this._currentBatchingLayers[S]&&(this._currentBatchingLayers[S].finalize(),delete this._currentBatchingLayers[S]);this._lastNormals=R}var O,B=this._worldMatrixNonIdentity?this._worldMatrix:null;if(!e.positionsDecodeMatrix)if(e.matrix)O=e.matrix;else{var L=e.scale||Ep,N=e.position||Fp,j=e.rotation||Rp;q.eulerToQuaternion(j,"XYZ",Sp),O=q.composeMat4(N,Sp,L,kp)}var G=r?this._textureSets[r]:null,H="".concat(w,"-").concat(e.normals&&e.normals.length>0?1:0,"-").concat(e.normalsCompressed&&e.normalsCompressed.length>0?1:0,"-").concat(e.colors&&e.colors.length>0?1:0,"-").concat(e.colorsCompressed&&e.colorsCompressed.length>0?1:0,"-").concat(e.uv&&e.uv.length>0?1:0,"-").concat(e.uvCompressed&&e.uvCompressed.length>0?1:0);o=this._currentBatchingLayers[H];var U=(D||e.positionsCompressed).length;switch(w){case"triangles":case"solid":case"surface":o&&(o.canCreatePortion(U,M.length)||(o.finalize(),delete this._currentBatchingLayers[H],o=null)),o||(o=new sl({model:this,textureSet:G,layerIndex:0,scratchMemory:this._scratchMemory,positionsDecodeMatrix:e.positionsDecodeMatrix,uvDecodeMatrix:e.uvDecodeMatrix,origin:C,maxGeometryBatchSize:this._maxGeometryBatchSize,solid:"solid"===w,autoNormals:!R}),this._layerList.push(o),this._currentBatchingLayers[H]=o),I||(I=Dt(D||e.positionsCompressed,M,null,this._edgeThreshold)),n=o.createPortion({positions:D,positionsCompressed:e.positionsCompressed,normals:e.normals,normalsCompressed:e.normalsCompressed,colors:e.colors,colorsCompressed:e.colorsCompressed,uv:e.uv,uvCompressed:e.uvCompressed,indices:M,edgeIndices:I,color:a,opacity:u,metallic:h,roughness:l,meshMatrix:O,worldMatrix:B,worldAABB:f,pickColor:d});var V=Math.round(M.length/3);this._numTriangles+=V,c.numTriangles=V;break;case"lines":o&&(o.canCreatePortion(U,M.length)||(o.finalize(),delete this._currentBatchingLayers[H],o=null)),o||(o=new dc({model:this,layerIndex:0,scratchMemory:this._scratchMemory,positionsDecodeMatrix:e.positionsDecodeMatrix,origin:C,maxGeometryBatchSize:this._maxGeometryBatchSize}),this._layerList.push(o),this._currentBatchingLayers[H]=o),n=o.createPortion({positions:D,positionsCompressed:e.positionsCompressed,indices:M,colors:e.colors,colorsCompressed:e.colorsCompressed,color:a,opacity:u,meshMatrix:O,worldMatrix:B,worldAABB:f,pickColor:d}),this._numLines+=Math.round(M.length/2);break;case"points":o&&(o.canCreatePortion(U)||(o.finalize(),delete this._currentBatchingLayers[H],o=null)),o||(o=new Xc({model:this,layerIndex:0,scratchMemory:this._scratchMemory,positionsDecodeMatrix:e.positionsDecodeMatrix,origin:C,maxGeometryBatchSize:this._maxGeometryBatchSize}),this._layerList.push(o),this._currentBatchingLayers[H]=o),n=o.createPortion({positions:D,positionsCompressed:e.positionsCompressed,colors:e.colors,colorsCompressed:e.colorsCompressed,color:a,opacity:u,meshMatrix:O,worldMatrix:B,worldAABB:f,pickColor:d}),this._numPoints+=Math.round(U/3)}q.expandAABB3(this._aabb,f),this.numGeometries++,c.origin=C}c.parent=null,c._layer=o,c._portionId=n,c.aabb=f,this._meshes[t]=c}else this.error("Texture set not found: ".concat(r," - ensure that you create it first with createTextureSet()"))}else this.error("Geometry not found: ".concat(e.geometryId," - ensure that you create it first with createGeometry()"))}else this.error("Config missing: id")}},{key:"_getInstancingLayer",value:function(e,t,i){var s,r="".concat(e[0],".").concat(e[1],".").concat(e[2],".").concat(t,".").concat(i),n=this._instancingLayers[r];if(n)return n;if(void 0===t||(s=this._textureSets[t])){var o=this._geometries[i];if(this._geometries[i]){switch(o.primitive){case"triangles":case"surface":n=new ec({model:this,textureSet:s,geometry:o,origin:e,layerIndex:0,solid:!1});break;case"solid":n=new ec({model:this,textureSet:s,geometry:o,origin:e,layerIndex:0,solid:!0});break;case"lines":n=new Mc({model:this,textureSet:s,geometry:o,origin:e,layerIndex:0});break;case"points":n=new fp({model:this,textureSet:s,geometry:o,origin:e,layerIndex:0})}return this._instancingLayers[r]=n,this._layerList.push(n),n}this.error("Geometry not found: ".concat(i," - ensure that you create it first with createGeometry()"))}else this.error("TextureSet not found: ".concat(t," - ensure that you create it first with createTextureSet()"))}},{key:"createEntity",value:function(e){var t=e.id;void 0===t?t=q.createUUID():this.scene.components[t]&&(this.error("Scene already has a Component with this ID: "+t+" - will assign random ID"),t=q.createUUID());var i=e.meshIds;if(void 0!==i){for(var s=[],r=0,n=i.length;r<n;r++){var o=i[r],a=this._meshes[o];a?a.parent?this.error("Mesh with ID "+o+" already belongs to object with ID "+a.parent.id+" - ignoring this mesh"):s.push(a):this.error("Mesh with this ID not found: "+o+" - ignoring this mesh")}var u,h=0;if(this._visible&&!1!==e.visible&&(h|=me),this._pickable&&!1!==e.pickable&&(h|=ge),this._culled&&!1!==e.culled&&(h|=ve),this._clippable&&!1!==e.clippable&&(h|=_e),this._collidable&&!1!==e.collidable&&(h|=ye),this._edges&&!1!==e.edges&&(h|=Te),this._xrayed&&!1!==e.xrayed&&(h|=be),this._highlighted&&!1!==e.highlighted&&(h|=xe),this._selected&&!1!==e.selected&&(h|=Pe),1===s.length)u=s[0].aabb;else{u=q.collapseAABB3();for(var l=0,c=s.length;l<c;l++)q.expandAABB3(u,s[l].aabb)}var p=new Ie(this,e.isObject,t,s,h,u);return this._nodeList.push(p),this._nodes[t]=p,this.numEntities++,p}this.error("Config missing: meshIds")}},{key:"finalize",value:function(){if(!this.destroyed){for(var e in this._instancingLayers)this._instancingLayers.hasOwnProperty(e)&&this._instancingLayers[e].finalize();for(var t in this._currentBatchingLayers)this._currentBatchingLayers.hasOwnProperty(t)&&this._currentBatchingLayers[t].finalize();this._currentBatchingLayers={};for(var i=0,s=this._nodeList.length;i<s;i++){this._nodeList[i]._finalize()}for(var r=0,n=this._nodeList.length;r<n;r++){this._nodeList[r]._finalize2()}this._layerList.sort((function(e,t){return e.sortId<t.sortId?-1:e.sortId>t.sortId?1:0}));for(var o=0,a=this._layerList.length;o<a;o++){this._layerList[o].layerIndex=o}this.glRedraw(),this.scene._aabbDirty=!0}}},{key:"_rebuildAABB",value:function(){q.collapseAABB3(this._aabb);for(var e=0,t=this._nodeList.length;e<t;e++){var i=this._nodeList[e];q.expandAABB3(this._aabb,i.aabb)}this._aabbDirty=!1}},{key:"stateSortCompare",value:function(e,t){}},{key:"rebuildRenderFlags",value:function(){this.renderFlags.reset(),this._updateRenderFlagsVisibleLayers(),this.renderFlags.numLayers>0&&0===this.renderFlags.numVisibleLayers?this.renderFlags.culled=!0:this._updateRenderFlags()}},{key:"_updateRenderFlagsVisibleLayers",value:function(){var e=this.renderFlags;e.numLayers=this._layerList.length,e.numVisibleLayers=0;for(var t=0,i=this._layerList.length;t<i;t++){var s=this._layerList[t];this._getActiveSectionPlanesForLayer(s)&&(e.visibleLayers[e.numVisibleLayers++]=t)}}},{key:"_getActiveSectionPlanesForLayer",value:function(e){var t=this.renderFlags,i=this.scene._sectionPlanesState.sectionPlanes,s=i.length,r=e.layerIndex*s;if(s>0)for(var n=0;n<s;n++){i[n].active?(t.sectionPlanesActivePerLayer[r+n]=!0,t.sectioned=!0):t.sectionPlanesActivePerLayer[r+n]=!1}return!0}},{key:"_updateRenderFlags",value:function(){if(0!==this.numVisibleLayerPortions&&this.numCulledLayerPortions!==this.numPortions){var e=this.renderFlags;if(e.colorOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.colorTransparent=!0),this.numXRayedLayerPortions>0){var t=this.scene.xrayMaterial._state;t.fill&&(t.fillAlpha<1?e.xrayedSilhouetteTransparent=!0:e.xrayedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.xrayedEdgesTransparent=!0:e.xrayedEdgesOpaque=!0)}if(this.numEdgesLayerPortions>0)this.scene.edgeMaterial._state.edges&&(e.edgesOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.edgesTransparent=!0));if(this.numSelectedLayerPortions>0){var i=this.scene.selectedMaterial._state;i.fill&&(i.fillAlpha<1?e.selectedSilhouetteTransparent=!0:e.selectedSilhouetteOpaque=!0),i.edges&&(i.edgeAlpha<1?e.selectedEdgesTransparent=!0:e.selectedEdgesOpaque=!0)}if(this.numHighlightedLayerPortions>0){var s=this.scene.highlightMaterial._state;s.fill&&(s.fillAlpha<1?e.highlightedSilhouetteTransparent=!0:e.highlightedSilhouetteOpaque=!0),s.edges&&(s.edgeAlpha<1?e.highlightedEdgesTransparent=!0:e.highlightedEdgesOpaque=!0)}}}},{key:"drawColorOpaque",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawColorOpaque(t,e)}}},{key:"drawColorTransparent",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawColorTransparent(t,e)}}},{key:"drawDepth",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawDepth(t,e)}}},{key:"drawNormals",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawNormals(t,e)}}},{key:"drawSilhouetteXRayed",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawSilhouetteXRayed(t,e)}}},{key:"drawSilhouetteHighlighted",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawSilhouetteHighlighted(t,e)}}},{key:"drawSilhouetteSelected",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawSilhouetteSelected(t,e)}}},{key:"drawEdgesColorOpaque",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawEdgesColorOpaque(t,e)}}},{key:"drawEdgesColorTransparent",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawEdgesColorTransparent(t,e)}}},{key:"drawEdgesXRayed",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawEdgesXRayed(t,e)}}},{key:"drawEdgesHighlighted",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawEdgesHighlighted(t,e)}}},{key:"drawEdgesSelected",value:function(e){for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawEdgesSelected(t,e)}}},{key:"drawOcclusion",value:function(e){if(0!==this.numVisibleLayerPortions)for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawOcclusion(t,e)}}},{key:"drawShadow",value:function(e){if(0!==this.numVisibleLayerPortions)for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawShadow(t,e)}}},{key:"drawPickMesh",value:function(e){if(0!==this.numVisibleLayerPortions)for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawPickMesh(t,e)}}},{key:"drawPickDepths",value:function(e){if(0!==this.numVisibleLayerPortions)for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawPickDepths(t,e)}}},{key:"drawPickNormals",value:function(e){if(0!==this.numVisibleLayerPortions)for(var t=this.renderFlags,i=0,s=t.visibleLayers.length;i<s;i++){var r=t.visibleLayers[i];this._layerList[r].drawPickNormals(t,e)}}},{key:"destroy",value:function(){for(var e in this._currentBatchingLayers)this._currentBatchingLayers.hasOwnProperty(e)&&this._currentBatchingLayers[e].destroy();this._currentBatchingLayers={},this.scene.camera.off(this._onCameraViewMatrix);for(var t=0,s=this._layerList.length;t<s;t++)this._layerList[t].destroy();for(var r=0,n=this._nodeList.length;r<n;r++)this._nodeList[r]._destroy();Object.entries(this._geometries).forEach((function(e){var t=p(e,2);t[0];t[1].destroy()})),this._geometries={},this._textures={},this._textureSets={},this._meshes={},this._nodes={},this.scene._aabbDirty=!0,this._isModel&&this.scene._deregisterModel(this),0!==Nu&&0==--Nu&&Lu._clear(),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),Bp=function(e){g(i,Op);var t=y(i);function i(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),t.call(this,e,s)}return I(i)}(),Lp=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,e,r))._skyboxMesh=new Uo(x(s),{geometry:new _r(x(s),{primitive:"triangles",positions:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],uv:[.5,.6666,.25,.6666,.25,.3333,.5,.3333,.5,.6666,.5,.3333,.75,.3333,.75,.6666,.5,.6666,.5,1,.25,1,.25,.6666,.25,.6666,0,.6666,0,.3333,.25,.3333,.25,0,.5,0,.5,.3333,.25,.3333,.75,.3333,1,.3333,1,.6666,.75,.6666],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}),background:!0,scale:[2e3,2e3,2e3],rotation:[0,-90,0],material:new Tr(x(s),{ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],emissive:[1,1,1],emissiveMap:new xa(x(s),{src:r.src,flipY:!0,wrapS:"clampToEdge",wrapT:"clampToEdge",encoding:r.encoding||"sRGB"}),backfaces:!0}),visible:!1,pickable:!1,clippable:!1,collidable:!1}),s.size=r.size,s.active=r.active,s}return I(i,[{key:"size",get:function(){return this._size},set:function(e){this._size=e||1e3,this._skyboxMesh.scale=[this._size,this._size,this._size]}},{key:"active",get:function(){return this._skyboxMesh.visible},set:function(e){this._skyboxMesh.visible=e}}]),i}(),Np=function(){function e(){w(this,e)}return I(e,[{key:"transcode",value:function(e,t){}},{key:"destroy",value:function(){}}]),e}(),jp=q.vec4(),Gp=q.vec4(),Hp=q.vec3(),Up=q.vec3(),Vp=q.vec3(),zp=q.vec4(),Wp=q.vec4(),Xp=q.vec4(),Yp=function(){function e(t){w(this,e),this._scene=t}return I(e,[{key:"dollyToCanvasPos",value:function(e,t,i){var s=!1,r=this._scene.camera;if(e){var n=q.subVec3(e,r.eye,Hp);s=q.lenVec3(n)<i}if("perspective"===r.projection){r.ortho.scale=r.ortho.scale-i;var o=this._unproject(t,zp),a=q.subVec3(o,r.eye,Xp),u=q.mulVec3Scalar(q.normalizeVec3(a),-i,[]);if(r.eye=[r.eye[0]-u[0],r.eye[1]-u[1],r.eye[2]-u[2]],r.look=[r.look[0]-u[0],r.look[1]-u[1],r.look[2]-u[2]],e){var h=q.subVec3(e,r.eye,Hp),l=q.lenVec3(h),c=q.mulVec3Scalar(q.normalizeVec3(q.subVec3(r.look,r.eye,Up)),l);r.look=[r.eye[0]+c[0],r.eye[1]+c[1],r.eye[2]+c[2]]}}else if("ortho"===r.projection){var p=this._unproject(t,zp);r.ortho.scale=r.ortho.scale-i,r.ortho._update();var d=this._unproject(t,Wp),f=q.subVec3(d,p,Xp),m=q.mulVec3Scalar(q.normalizeVec3(q.subVec3(r.look,r.eye,Hp)),-i,Up),v=q.addVec3(f,m,Vp);r.eye=[r.eye[0]-v[0],r.eye[1]-v[1],r.eye[2]-v[2]],r.look=[r.look[0]-v[0],r.look[1]-v[1],r.look[2]-v[2]]}return s}},{key:"_unproject",value:function(e,t){var i=this._scene.camera,s=i.project.transposedMatrix,r=s.subarray(8,12),n=s.subarray(12),o=[0,0,-1,1],a=q.dotVec4(o,r)/q.dotVec4(o,n);return i.project.unproject(e,a,jp,Gp,t),t}},{key:"destroy",value:function(){}}]),e}(),Kp=q.vec3(),Jp=q.vec3(),Zp=q.vec3(),Qp=q.vec4(),qp=q.vec4(),$p=q.vec4(),ed=function(){function e(t,i){var s=this;w(this,e),this._scene=t,this._configs=i,this._pivotWorldPos=q.vec3(),this._cameraOffset=q.vec3(),this._azimuth=0,this._polar=0,this._radius=0,this._pivotPosSet=!1,this._pivoting=!1,this._shown=!1,this._pivotViewPos=q.vec4(),this._pivotProjPos=q.vec4(),this._pivotCanvasPos=q.vec2(),this._cameraDirty=!0,this._onViewMatrix=this._scene.camera.on("viewMatrix",(function(){s._cameraDirty=!0})),this._onProjMatrix=this._scene.camera.on("projMatrix",(function(){s._cameraDirty=!0})),this._onTick=this._scene.on("tick",(function(){s.updatePivotElement()}))}return I(e,[{key:"updatePivotElement",value:function(){var e=this._scene.camera,t=this._scene.canvas;if(this._pivoting&&this._cameraDirty){q.transformPoint3(e.viewMatrix,this.getPivotPos(),this._pivotViewPos),this._pivotViewPos[3]=1,q.transformPoint4(e.projMatrix,this._pivotViewPos,this._pivotProjPos);var i=t.boundary,s=i[2],r=i[3];this._pivotCanvasPos[0]=Math.floor((1+this._pivotProjPos[0]/this._pivotProjPos[3])*s/2),this._pivotCanvasPos[1]=Math.floor((1-this._pivotProjPos[1]/this._pivotProjPos[3])*r/2);var n=t._lastBoundingClientRect;if(!n||t._canvasSizeChanged){var o=t.canvas;n=t._lastBoundingClientRect=o.getBoundingClientRect()}this._pivotElement&&(this._pivotElement.style.left=Math.floor(n.left+this._pivotCanvasPos[0])-this._pivotElement.clientWidth/2+window.scrollX+"px",this._pivotElement.style.top=Math.floor(n.top+this._pivotCanvasPos[1])-this._pivotElement.clientHeight/2+window.scrollY+"px"),this._cameraDirty=!1}}},{key:"setPivotElement",value:function(e){this._pivotElement=e}},{key:"startPivot",value:function(){if(this._cameraLookingDownwards())return this._pivoting=!1,!1;var e=this._scene.camera,t=q.lookAtMat4v(e.eye,e.look,e.worldUp);q.transformPoint3(t,this.getPivotPos(),this._cameraOffset);var i=this.getPivotPos();this._cameraOffset[2]+=q.distVec3(e.eye,i),t=q.inverseMat4(t);var s=q.transformVec3(t,this._cameraOffset),r=q.vec3();if(q.subVec3(e.eye,i,r),q.addVec3(r,s),e.zUp){var n=r[1];r[1]=r[2],r[2]=n}this._radius=q.lenVec3(r),this._polar=Math.acos(r[1]/this._radius),this._azimuth=Math.atan2(r[0],r[2]),this._pivoting=!0}},{key:"_cameraLookingDownwards",value:function(){var e=this._scene.camera,t=q.normalizeVec3(q.subVec3(e.look,e.eye,Kp)),i=q.cross3Vec3(t,e.worldUp,Jp);return q.sqLenVec3(i)<=1e-4}},{key:"getPivoting",value:function(){return this._pivoting}},{key:"setPivotPos",value:function(e){this._pivotWorldPos.set(e),this._pivotPosSet=!0}},{key:"setCanvasPivotPos",value:function(e){var t=this._scene.camera,i=Math.abs(q.distVec3(this._scene.center,t.eye)),s=t.project.transposedMatrix,r=s.subarray(8,12),n=s.subarray(12),o=[0,0,-1,1],a=q.dotVec4(o,r)/q.dotVec4(o,n),u=Qp;t.project.unproject(e,a,qp,$p,u);var h=q.normalizeVec3(q.subVec3(u,t.eye,Kp)),l=q.addVec3(t.eye,q.mulVec3Scalar(h,i,Jp),Zp);this.setPivotPos(l)}},{key:"getPivotPos",value:function(){return this._pivotPosSet?this._pivotWorldPos:this._scene.camera.look}},{key:"continuePivot",value:function(e,t){if(this._pivoting&&(0!==e||0!==t)){var i=this._scene.camera,s=-e,r=-t;1===i.worldUp[2]&&(s=-s),this._azimuth+=.01*-s,this._polar+=.01*r,this._polar=q.clamp(this._polar,.001,Math.PI-.001);var n=[this._radius*Math.sin(this._polar)*Math.sin(this._azimuth),this._radius*Math.cos(this._polar),this._radius*Math.sin(this._polar)*Math.cos(this._azimuth)];if(1===i.worldUp[2]){var o=n[1];n[1]=n[2],n[2]=o}var a=q.lenVec3(q.subVec3(i.look,i.eye,q.vec3())),u=this.getPivotPos();q.addVec3(n,u);var h=q.lookAtMat4v(n,u,i.worldUp);h=q.inverseMat4(h);var l=q.transformVec3(h,this._cameraOffset);h[12]-=l[0],h[13]-=l[1],h[14]-=l[2];var c=[h[8],h[9],h[10]];i.eye=[h[12],h[13],h[14]],q.subVec3(i.eye,q.mulVec3Scalar(c,a),i.look),i.up=[h[4],h[5],h[6]],this.showPivot()}}},{key:"showPivot",value:function(){var e=this;this._shown||(null!==this._hideTimeout&&(window.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._pivotElement&&(this.updatePivotElement(),this._pivotElement.style.visibility="visible",this._shown=!0,this._hideTimeout=window.setTimeout((function(){e.hidePivot()}),1e3)))}},{key:"hidePivot",value:function(){this._shown&&(null!==this._hideTimeout&&(window.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._pivotElement&&(this._pivotElement.style.visibility="hidden"),this._shown=!1)}},{key:"endPivot",value:function(){this._pivoting=!1}},{key:"destroy",value:function(){this._scene.camera.off(this._onViewMatrix),this._scene.camera.off(this._onProjMatrix),this._scene.off(this._onTick)}}]),e}(),td=function(){function e(t,i){w(this,e),this._scene=t.scene,this._cameraControl=t,this._scene.canvas.canvas.oncontextmenu=function(e){e.preventDefault()},this._configs=i,this.schedulePickEntity=!1,this.schedulePickSurface=!1,this.pickCursorPos=q.vec2(),this.picked=!1,this.pickedSurface=!1,this.pickResult=null,this._lastPickedEntityId=null,this._needFireEvents=!1}return I(e,[{key:"update",value:function(){if(this._configs.pointerEnabled&&(this.schedulePickEntity||this.schedulePickSurface)){this.picked=!1,this.pickedSurface=!1,this._needFireEvents=!1;var e=this._cameraControl.hasSubs("hoverSurface");if(this.schedulePickSurface&&this.pickResult&&this.pickResult.worldPos){var t=this.pickResult.canvasPos;if(t[0]===this.pickCursorPos[0]&&t[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!0,this._needFireEvents=e,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}if(this.schedulePickEntity&&this.pickResult){var i=this.pickResult.canvasPos;if(i[0]===this.pickCursorPos[0]&&i[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!1,this._needFireEvents=!1,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}this.schedulePickSurface?(this.pickResult=this._scene.pick({pickSurface:!0,pickSurfaceNormal:!1,canvasPos:this.pickCursorPos}),this.pickResult&&(this.picked=!0,this.pickedSurface=!0,this._needFireEvents=!0)):(this.pickResult=this._scene.pick({canvasPos:this.pickCursorPos}),this.pickResult&&(this.picked=!0,this.pickedSurface=!1,this._needFireEvents=!0)),this.schedulePickEntity=!1,this.schedulePickSurface=!1}}},{key:"fireEvents",value:function(){if(this._needFireEvents){if(this.picked&&this.pickResult&&this.pickResult.entity){var e=this.pickResult.entity.id;this._lastPickedEntityId!==e&&(void 0!==this._lastPickedEntityId&&this._cameraControl.fire("hoverOut",{entity:this._scene.objects[this._lastPickedEntityId]},!0),this._cameraControl.fire("hoverEnter",this.pickResult,!0),this._lastPickedEntityId=e),this._cameraControl.fire("hover",this.pickResult,!0),this.pickResult.worldPos&&(this.pickedSurface=!0,this._cameraControl.fire("hoverSurface",this.pickResult,!0))}else void 0!==this._lastPickedEntityId&&(this._cameraControl.fire("hoverOut",{entity:this._scene.objects[this._lastPickedEntityId]},!0),this._lastPickedEntityId=void 0),this._cameraControl.fire("hoverOff",{canvasPos:this.pickCursorPos},!0);this.pickResult=null,this._needFireEvents=!1}}},{key:"destroy",value:function(){}}]),e}(),id=q.vec2(),sd=function(){function e(t,i,s,r,n){w(this,e),this._scene=t;var o,a,u,h=i.pickController,l=0,c=0,p=0,d=0,f=!1,m=q.vec3(),v=!0,g=this._scene.canvas.canvas,_=[];function y(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];g.style.cursor="move",b(),e&&x()}function b(){l=r.pointerCanvasPos[0],c=r.pointerCanvasPos[1],p=r.pointerCanvasPos[0],d=r.pointerCanvasPos[1]}function x(){h.pickCursorPos=r.pointerCanvasPos,h.schedulePickSurface=!0,h.update(),h.picked&&h.pickedSurface&&h.pickResult&&h.pickResult.worldPos?(f=!0,m.set(h.pickResult.worldPos)):f=!1}document.addEventListener("keydown",this._documentKeyDownHandler=function(e){if(s.active&&s.pointerEnabled&&t.input.keyboardEnabled){var i=e.keyCode;_[i]=!0}}),document.addEventListener("keyup",this._documentKeyUpHandler=function(e){if(s.active&&s.pointerEnabled&&t.input.keyboardEnabled){var i=e.keyCode;_[i]=!1}}),g.addEventListener("mousedown",this._mouseDownHandler=function(e){if(s.active&&s.pointerEnabled)switch(e.which){case 1:_[t.input.KEY_SHIFT]||s.planView?(o=!0,y()):(o=!0,y(!1));break;case 2:a=!0,y();break;case 3:u=!0,s.panRightClick&&y()}}),document.addEventListener("mousemove",this._documentMouseMoveHandler=function(){if(s.active&&s.pointerEnabled&&(o||a||u)){var e=t.canvas.boundary,i=e[2],h=e[3],p=r.pointerCanvasPos[0],d=r.pointerCanvasPos[1];if(_[t.input.KEY_SHIFT]||s.planView||!s.panRightClick&&a||s.panRightClick&&u){var v=p-l,g=d-c,y=t.camera;if("perspective"===y.projection){var b=Math.abs(f?q.lenVec3(q.subVec3(m,t.camera.eye,[])):t.camera.eyeLookDist)*Math.tan(y.perspective.fov/2*Math.PI/180);n.panDeltaX+=1.5*v*b/h,n.panDeltaY+=1.5*g*b/h}else n.panDeltaX+=.5*y.ortho.scale*(v/h),n.panDeltaY+=.5*y.ortho.scale*(g/h)}else!o||a||u||s.planView||(s.firstPerson?(n.rotateDeltaY-=(p-l)/i*s.dragRotationRate/2,n.rotateDeltaX+=(d-c)/h*(s.dragRotationRate/4)):(n.rotateDeltaY-=(p-l)/i*(1.5*s.dragRotationRate),n.rotateDeltaX+=(d-c)/h*(1.5*s.dragRotationRate)));l=p,c=d}}),g.addEventListener("mousemove",this._canvasMouseMoveHandler=function(e){s.active&&s.pointerEnabled&&r.mouseover&&(v=!0)}),document.addEventListener("mouseup",this._documentMouseUpHandler=function(e){if(s.active&&s.pointerEnabled)switch(e.which){case 1:case 2:case 3:o=!1,a=!1,u=!1}}),g.addEventListener("mouseup",this._mouseUpHandler=function(e){if(s.active&&s.pointerEnabled){if(3===e.which){!function(e,t){if(e){for(var i=e.target,s=0,r=0;i.offsetParent;)s+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-s,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y}(e,id);var t=id[0],r=id[1];Math.abs(t-p)<3&&Math.abs(r-d)<3&&i.cameraControl.fire("rightClick",{pagePos:[Math.round(e.pageX),Math.round(e.pageY)],canvasPos:id,event:e},!0)}g.style.removeProperty("cursor")}}),g.addEventListener("mouseenter",this._mouseEnterHandler=function(){s.active&&s.pointerEnabled});var P=1/60,T=null;g.addEventListener("wheel",this._mouseWheelHandler=function(e){if(s.active&&s.pointerEnabled){var t=performance.now()/1e3,i=null!==T?t-T:0;T=t,i>.05&&(i=.05),i<P&&(i=P);var o=Math.max(-1,Math.min(1,40*-e.deltaY));if(0!==o){var a=o/Math.abs(o);n.dollyDelta+=-a*i*s.mouseWheelDollyRate,v&&(r.followPointerDirty=!0,v=!1)}}},{passive:!0})}return I(e,[{key:"reset",value:function(){}},{key:"destroy",value:function(){var e=this._scene.canvas.canvas;document.removeEventListener("keydown",this._documentKeyDownHandler),document.removeEventListener("keyup",this._documentKeyUpHandler),e.removeEventListener("mousedown",this._mouseDownHandler),document.removeEventListener("mousemove",this._documentMouseMoveHandler),e.removeEventListener("mousemove",this._canvasMouseMoveHandler),document.removeEventListener("mouseup",this._documentMouseUpHandler),e.removeEventListener("mouseup",this._mouseUpHandler),e.removeEventListener("mouseenter",this._mouseEnterHandler),e.removeEventListener("wheel",this._mouseWheelHandler)}}]),e}(),rd=q.vec3(),nd=q.vec3(),od=q.vec3(),ad=q.vec3(),ud=q.vec3(),hd={eye:q.vec3(),look:q.vec3(),up:q.vec3()},ld=function(){function e(t,i,s,r){w(this,e),this._scene=t;var n=i.cameraControl,o=t.camera;this._onSceneKeyDown=t.input.on("keydown",(function(){if(s.active&&s.pointerEnabled&&t.input.keyboardEnabled&&r.mouseover){var e=n._isKeyDownForAction(n.AXIS_VIEW_RIGHT),a=n._isKeyDownForAction(n.AXIS_VIEW_BACK),u=n._isKeyDownForAction(n.AXIS_VIEW_LEFT),h=n._isKeyDownForAction(n.AXIS_VIEW_FRONT),l=n._isKeyDownForAction(n.AXIS_VIEW_TOP),c=n._isKeyDownForAction(n.AXIS_VIEW_BOTTOM);if(e||a||u||h||l||c){var p=t.aabb,d=q.getAABB3Diag(p);q.getAABB3Center(p,rd);var f=Math.abs(d/Math.tan(i.cameraFlight.fitFOV*q.DEGTORAD)),m=1.1*d;hd.orthoScale=m,e?(hd.eye.set(q.addVec3(rd,q.mulVec3Scalar(o.worldRight,f,nd),ud)),hd.look.set(rd),hd.up.set(o.worldUp)):a?(hd.eye.set(q.addVec3(rd,q.mulVec3Scalar(o.worldForward,f,nd),ud)),hd.look.set(rd),hd.up.set(o.worldUp)):u?(hd.eye.set(q.addVec3(rd,q.mulVec3Scalar(o.worldRight,-f,nd),ud)),hd.look.set(rd),hd.up.set(o.worldUp)):h?(hd.eye.set(q.addVec3(rd,q.mulVec3Scalar(o.worldForward,-f,nd),ud)),hd.look.set(rd),hd.up.set(o.worldUp)):l?(hd.eye.set(q.addVec3(rd,q.mulVec3Scalar(o.worldUp,f,nd),ud)),hd.look.set(rd),hd.up.set(q.normalizeVec3(q.mulVec3Scalar(o.worldForward,1,od),ad))):c&&(hd.eye.set(q.addVec3(rd,q.mulVec3Scalar(o.worldUp,-f,nd),ud)),hd.look.set(rd),hd.up.set(q.normalizeVec3(q.mulVec3Scalar(o.worldForward,-1,od)))),!s.firstPerson&&s.followPointer&&i.pivotController.setPivotPos(rd),i.cameraFlight.duration>0?i.cameraFlight.flyTo(hd,(function(){i.pivotController.getPivoting()&&s.followPointer&&i.pivotController.showPivot()})):(i.cameraFlight.jumpTo(hd),i.pivotController.getPivoting()&&s.followPointer&&i.pivotController.showPivot())}}}))}return I(e,[{key:"reset",value:function(){}},{key:"destroy",value:function(){this._scene.input.off(this._onSceneKeyDown)}}]),e}(),cd=function(){function e(t,i,s,r,n){var o=this;w(this,e),this._scene=t;var a=i.pickController,u=i.pivotController,h=i.cameraControl;this._clicks=0,this._timeout=null,this._lastPickedEntityId=null;var l=!1,c=!1,p=this._scene.canvas.canvas,d=function(e){var s;e&&e.worldPos&&(s=e.worldPos);var r=e&&e.entity?e.entity.aabb:t.aabb;if(s){var n=t.camera;q.subVec3(n.eye,n.look,[]),i.cameraFlight.flyTo({aabb:r})}else i.cameraFlight.flyTo({aabb:r})};p.addEventListener("mousemove",this._canvasMouseMoveHandler=function(e){if(s.active&&s.pointerEnabled&&!l&&!c){var i=h.hasSubs("hover"),n=h.hasSubs("hoverOut"),u=h.hasSubs("hoverOff"),p=h.hasSubs("hoverSurface");if(i||n||u||p)if(a.pickCursorPos=r.pointerCanvasPos,a.schedulePickEntity=!0,a.schedulePickSurface=p,a.update(),a.pickResult){var d=a.pickResult.entity.id;o._lastPickedEntityId!==d&&(void 0!==o._lastPickedEntityId&&h.fire("hoverOut",{entity:t.objects[o._lastPickedEntityId]},!0),h.fire("hoverEnter",a.pickResult,!0),o._lastPickedEntityId=d),h.fire("hover",a.pickResult,!0),a.pickResult.worldPos&&h.fire("hoverSurface",a.pickResult,!0)}else void 0!==o._lastPickedEntityId&&(h.fire("hoverOut",{entity:t.objects[o._lastPickedEntityId]},!0),o._lastPickedEntityId=void 0),h.fire("hoverOff",{canvasPos:a.pickCursorPos},!0)}}),p.addEventListener("mousedown",this._canvasMouseDownHandler=function(e){if(1===e.which&&(l=!0),3===e.which&&(c=!0),1===e.which&&s.active&&s.pointerEnabled&&(r.mouseDownClientX=e.clientX,r.mouseDownClientY=e.clientY,r.mouseDownCursorX=r.pointerCanvasPos[0],r.mouseDownCursorY=r.pointerCanvasPos[1],!s.firstPerson&&s.followPointer&&(a.pickCursorPos=r.pointerCanvasPos,a.schedulePickSurface=!0,a.update(),1===e.which))){var i=a.pickResult;i&&i.worldPos?(u.setPivotPos(i.worldPos),u.startPivot()):(s.smartPivot?u.setCanvasPivotPos(r.pointerCanvasPos):u.setPivotPos(t.camera.look),u.startPivot())}}),document.addEventListener("mouseup",this._documentMouseUpHandler=function(e){1===e.which&&(l=!1),3===e.which&&(c=!1)}),p.addEventListener("mouseup",this._canvasMouseUpHandler=function(e){if(s.active&&s.pointerEnabled&&(1===e.which&&(u.hidePivot(),!(Math.abs(e.clientX-r.mouseDownClientX)>3||Math.abs(e.clientY-r.mouseDownClientY)>3)))){var n=h.hasSubs("picked"),l=h.hasSubs("pickedNothing"),c=h.hasSubs("pickedSurface"),p=h.hasSubs("doublePicked"),f=h.hasSubs("doublePickedSurface"),m=h.hasSubs("doublePickedNothing");if(!(s.doublePickFlyTo||p||f||m))return(n||l||c)&&(a.pickCursorPos=r.pointerCanvasPos,a.schedulePickEntity=!0,a.schedulePickSurface=c,a.update(),a.pickResult?(h.fire("picked",a.pickResult,!0),a.pickedSurface&&h.fire("pickedSurface",a.pickResult,!0)):h.fire("pickedNothing",{canvasPos:r.pointerCanvasPos},!0)),void(o._clicks=0);if(o._clicks++,1===o._clicks){a.pickCursorPos=r.pointerCanvasPos,a.schedulePickEntity=s.doublePickFlyTo,a.schedulePickSurface=c,a.update();var v=a.pickResult,g=a.pickedSurface;o._timeout=setTimeout((function(){v?(h.fire("picked",v,!0),g&&(h.fire("pickedSurface",v,!0),!s.firstPerson&&s.followPointer&&(i.pivotController.setPivotPos(v.worldPos),i.pivotController.startPivot()&&i.pivotController.showPivot()))):h.fire("pickedNothing",{canvasPos:r.pointerCanvasPos},!0),o._clicks=0}),s.doubleClickTimeFrame)}else{if(null!==o._timeout&&(window.clearTimeout(o._timeout),o._timeout=null),a.pickCursorPos=r.pointerCanvasPos,a.schedulePickEntity=s.doublePickFlyTo||p||f,a.schedulePickSurface=a.schedulePickEntity&&f,a.update(),a.pickResult){if(h.fire("doublePicked",a.pickResult,!0),a.pickedSurface&&h.fire("doublePickedSurface",a.pickResult,!0),s.doublePickFlyTo&&(d(a.pickResult),!s.firstPerson&&s.followPointer)){var _=a.pickResult.entity.aabb,y=q.getAABB3Center(_);i.pivotController.setPivotPos(y),i.pivotController.startPivot()&&i.pivotController.showPivot()}}else if(h.fire("doublePickedNothing",{canvasPos:r.pointerCanvasPos},!0),s.doublePickFlyTo&&(d(),!s.firstPerson&&s.followPointer)){var b=t.aabb,x=q.getAABB3Center(b);i.pivotController.setPivotPos(x),i.pivotController.startPivot()&&i.pivotController.showPivot()}o._clicks=0}}},!1)}return I(e,[{key:"reset",value:function(){this._clicks=0,this._lastPickedEntityId=null,this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)}},{key:"destroy",value:function(){var e=this._scene.canvas.canvas;e.removeEventListener("mousemove",this._canvasMouseMoveHandler),e.removeEventListener("mousedown",this._canvasMouseDownHandler),document.removeEventListener("mouseup",this._documentMouseUpHandler),e.removeEventListener("mouseup",this._canvasMouseUpHandler),this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)}}]),e}(),pd=function(){function e(t,i,s,r,n){w(this,e),this._scene=t;var o=t.input,a=[],u=t.canvas.canvas,h=!0;this._onSceneMouseMove=o.on("mousemove",(function(){h=!0})),this._onSceneKeyDown=o.on("keydown",(function(e){s.active&&s.pointerEnabled&&t.input.keyboardEnabled&&r.mouseover&&(a[e]=!0,e===o.KEY_SHIFT&&(u.style.cursor="move"))})),this._onSceneKeyUp=o.on("keyup",(function(e){s.active&&s.pointerEnabled&&t.input.keyboardEnabled&&(a[e]=!1,e===o.KEY_SHIFT&&(u.style.cursor=null))})),this._onTick=t.on("tick",(function(e){if(s.active&&s.pointerEnabled&&t.input.keyboardEnabled&&r.mouseover){var u=i.cameraControl,l=e.deltaTime/1e3;if(!s.planView){var c=u._isKeyDownForAction(u.ROTATE_Y_POS,a),p=u._isKeyDownForAction(u.ROTATE_Y_NEG,a),d=u._isKeyDownForAction(u.ROTATE_X_POS,a),f=u._isKeyDownForAction(u.ROTATE_X_NEG,a),m=l*s.keyboardRotationRate;(c||p||d||f)&&(!s.firstPerson&&s.followPointer&&i.pivotController.startPivot(),c?n.rotateDeltaY+=m:p&&(n.rotateDeltaY-=m),d?n.rotateDeltaX+=m:f&&(n.rotateDeltaX-=m),!s.firstPerson&&s.followPointer&&i.pivotController.startPivot())}if(!a[o.KEY_CTRL]&&!a[o.KEY_ALT]){var v=u._isKeyDownForAction(u.DOLLY_BACKWARDS,a),g=u._isKeyDownForAction(u.DOLLY_FORWARDS,a);if(v||g){var _=l*s.keyboardDollyRate;!s.firstPerson&&s.followPointer&&i.pivotController.startPivot(),g?n.dollyDelta-=_:v&&(n.dollyDelta+=_),h&&(r.followPointerDirty=!0,h=!1)}}var y=u._isKeyDownForAction(u.PAN_FORWARDS,a),b=u._isKeyDownForAction(u.PAN_BACKWARDS,a),x=u._isKeyDownForAction(u.PAN_LEFT,a),P=u._isKeyDownForAction(u.PAN_RIGHT,a),T=u._isKeyDownForAction(u.PAN_UP,a),w=u._isKeyDownForAction(u.PAN_DOWN,a),M=(a[o.KEY_ALT]?.3:1)*l*s.keyboardPanRate;(y||b||x||P||T||w)&&(!s.firstPerson&&s.followPointer&&i.pivotController.startPivot(),w?n.panDeltaY+=M:T&&(n.panDeltaY+=-M),P?n.panDeltaX+=-M:x&&(n.panDeltaX+=M),b?n.panDeltaZ+=M:y&&(n.panDeltaZ+=-M))}}))}return I(e,[{key:"reset",value:function(){}},{key:"destroy",value:function(){this._scene.off(this._onTick),this._scene.input.off(this._onSceneMouseMove),this._scene.input.off(this._onSceneKeyDown),this._scene.input.off(this._onSceneKeyUp)}}]),e}(),dd=q.vec3(),fd=function(){function e(t,i,s,r,n){w(this,e),this._scene=t;var o=t.camera,a=i.pickController,u=i.pivotController,h=i.panController,l=1,c=1,p=null;this._onTick=t.on("tick",(function(){if(s.active&&s.pointerEnabled){var e="default";if(Math.abs(n.dollyDelta)<.001&&(n.dollyDelta=0),Math.abs(n.rotateDeltaX)<.001&&(n.rotateDeltaX=0),Math.abs(n.rotateDeltaY)<.001&&(n.rotateDeltaY=0),0===n.rotateDeltaX&&0===n.rotateDeltaY||(n.dollyDelta=0),s.followPointer&&--l<=0&&(l=1,0!==n.dollyDelta)){if(0===n.rotateDeltaY&&0===n.rotateDeltaX&&s.followPointer&&r.followPointerDirty&&(a.pickCursorPos=r.pointerCanvasPos,a.schedulePickSurface=!0,a.update(),a.pickResult&&a.pickResult.worldPos?p=a.pickResult.worldPos:(c=1,p=null),r.followPointerDirty=!1),p){var i=Math.abs(q.lenVec3(q.subVec3(p,t.camera.eye,dd)));c=i/s.dollyProximityThreshold}c<s.dollyMinSpeed&&(c=s.dollyMinSpeed)}var d=n.dollyDelta*c;if(0===n.rotateDeltaY&&0===n.rotateDeltaX||(!s.firstPerson&&s.followPointer&&u.getPivoting()?(u.continuePivot(n.rotateDeltaY,n.rotateDeltaX),u.showPivot()):(0!==n.rotateDeltaX&&(s.firstPerson?o.pitch(-n.rotateDeltaX):o.orbitPitch(n.rotateDeltaX)),0!==n.rotateDeltaY&&(s.firstPerson?o.yaw(n.rotateDeltaY):o.orbitYaw(n.rotateDeltaY))),n.rotateDeltaX*=s.rotationInertia,n.rotateDeltaY*=s.rotationInertia,e="grabbing"),Math.abs(n.panDeltaX)<.001&&(n.panDeltaX=0),Math.abs(n.panDeltaY)<.001&&(n.panDeltaY=0),Math.abs(n.panDeltaZ)<.001&&(n.panDeltaZ=0),0!==n.panDeltaX||0!==n.panDeltaY||0!==n.panDeltaZ){var f,m,v=q.vec3();if(v[0]=n.panDeltaX,v[1]=n.panDeltaY,v[2]=n.panDeltaZ,s.constrainVertical){o.xUp?(f=o.eye[0],m=o.look[0]):o.yUp?(f=o.eye[1],m=o.look[1]):o.zUp&&(f=o.eye[2],m=o.look[2]),o.pan(v);var g=o.eye,_=o.look;o.xUp?(g[0]=f,_[0]=m):o.yUp?(g[1]=f,_[1]=m):o.zUp&&(g[2]=f,_[2]=m),o.eye=g,o.look=_}else o.pan(v);e="grabbing"}if(n.panDeltaX*=s.panInertia,n.panDeltaY*=s.panInertia,n.panDeltaZ*=s.panInertia,0!==d){if(e=d<0?"zoom-in":"zoom-out",s.firstPerson){var y,b;if(s.constrainVertical&&(o.xUp?(y=o.eye[0],b=o.look[0]):o.yUp?(y=o.eye[1],b=o.look[1]):o.zUp&&(y=o.eye[2],b=o.look[2])),s.followPointer)h.dollyToCanvasPos(p,r.pointerCanvasPos,-d)&&(r.followPointerDirty=!0);else o.pan([0,0,d]),o.ortho.scale=o.ortho.scale-d;if(s.constrainVertical){var x=o.eye,P=o.look;o.xUp?(x[0]=y,P[0]=b):o.yUp?(x[1]=y,P[1]=b):o.zUp&&(x[2]=y,P[2]=b),o.eye=x,o.look=P}}else if(s.planView){if(s.followPointer)h.dollyToCanvasPos(p,r.pointerCanvasPos,-d)&&(r.followPointerDirty=!0);else o.ortho.scale=o.ortho.scale+d,o.zoom(d)}else{if(s.followPointer)h.dollyToCanvasPos(p,r.pointerCanvasPos,-d)&&(r.followPointerDirty=!0);else o.ortho.scale=o.ortho.scale+d,o.zoom(d)}n.dollyDelta*=s.dollyInertia}a.fireEvents(),document.body.style.cursor=e}}))}return I(e,[{key:"destroy",value:function(){this._scene.off(this._onTick)}}]),e}(),md=function(){function e(t,i,s,r,n){w(this,e),this._scene=t;var o=this._scene.canvas.canvas;o.addEventListener("mouseenter",this._mouseEnterHandler=function(){r.mouseover=!0}),o.addEventListener("mouseleave",this._mouseLeaveHandler=function(){r.mouseover=!1,o.style.cursor=null}),document.addEventListener("mousemove",this._mouseMoveHandler=function(e){vd(e,o,r.pointerCanvasPos)}),o.addEventListener("mousedown",this._mouseDownHandler=function(e){s.active&&s.pointerEnabled&&(vd(e,o,r.pointerCanvasPos),r.mouseover=!0)}),o.addEventListener("mouseup",this._mouseUpHandler=function(e){s.active&&s.pointerEnabled})}return I(e,[{key:"reset",value:function(){}},{key:"destroy",value:function(){var e=this._scene.canvas.canvas;document.removeEventListener("mousemove",this._mouseMoveHandler),e.removeEventListener("mouseenter",this._mouseEnterHandler),e.removeEventListener("mouseleave",this._mouseLeaveHandler),e.removeEventListener("mousedown",this._mouseDownHandler),e.removeEventListener("mouseup",this._mouseUpHandler)}}]),e}();function vd(e,t,i){if(e){var s=t.getBoundingClientRect(),r=s.x,n=s.y;i[0]=e.clientX-r,i[1]=e.clientY-n}else e=window.event,i[0]=e.x,i[1]=e.y;return i}var gd=function(e,t){if(e){for(var i=e.target,s=0,r=0;i.offsetParent;)s+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-s,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t},_d=function(){function e(t,i,s,r,n){w(this,e),this._scene=t;var o=i.pickController,a=i.pivotController,u=q.vec2(),h=q.vec2(),l=q.vec2(),c=q.vec2(),p=[],d=this._scene.canvas.canvas,f=0,m=!1;this._onTick=t.on("tick",(function(){m=!1})),d.addEventListener("touchstart",this._canvasTouchStartHandler=function(e){if(s.active&&s.pointerEnabled){e.preventDefault();var i=e.touches,n=e.changedTouches;for(r.touchStartTime=Date.now(),1===i.length&&1===n.length&&(gd(i[0],u),s.followPointer&&(o.pickCursorPos=u,o.schedulePickSurface=!0,o.update(),s.planView||(o.picked&&o.pickedSurface&&o.pickResult&&o.pickResult.worldPos?(a.setPivotPos(o.pickResult.worldPos),!s.firstPerson&&a.startPivot()&&a.showPivot()):(s.smartPivot?a.setCanvasPivotPos(r.pointerCanvasPos):a.setPivotPos(t.camera.look),!s.firstPerson&&a.startPivot()&&a.showPivot()))));p.length<i.length;)p.push(q.vec2());for(var h=0,l=i.length;h<l;++h)gd(i[h],p[h]);f=i.length}}),d.addEventListener("touchmove",this._canvasTouchMoveHandler=function(e){if(s.active&&s.pointerEnabled&&(e.stopPropagation(),e.preventDefault(),!m)){m=!0;var i=t.canvas.boundary,a=i[2],u=i[3],d=e.touches;if(e.touches.length===f){if(1===f){gd(d[0],h),q.subVec2(h,p[0],c);var v=c[0],g=c[1];if(null!==r.longTouchTimeout&&(Math.abs(v)>s.longTapRadius||Math.abs(g)>s.longTapRadius)&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null),s.planView){var _=t.camera;if("perspective"===_.projection){var y=Math.abs(t.camera.eyeLookDist)*Math.tan(_.perspective.fov/2*Math.PI/180);n.panDeltaX+=v*y/u*s.touchPanRate,n.panDeltaY+=g*y/u*s.touchPanRate}else n.panDeltaX+=.5*_.ortho.scale*(v/u)*s.touchPanRate,n.panDeltaY+=.5*_.ortho.scale*(g/u)*s.touchPanRate}else n.rotateDeltaY-=v/a*(1*s.dragRotationRate),n.rotateDeltaX+=g/u*(1.5*s.dragRotationRate)}else if(2===f){var b=d[0],x=d[1];gd(b,h),gd(x,l);var P=q.geometricMeanVec2(p[0],p[1]),T=q.geometricMeanVec2(h,l),w=q.vec2();q.subVec2(P,T,w);var M=w[0],I=w[1],C=t.camera,D=q.distVec2([b.pageX,b.pageY],[x.pageX,x.pageY]),A=(q.distVec2(p[0],p[1])-D)*s.touchDollyRate;if(n.dollyDelta=A,Math.abs(A)<1)if("perspective"===C.projection){var k=o.pickResult?o.pickResult.worldPos:t.center,E=Math.abs(q.lenVec3(q.subVec3(k,t.camera.eye,[])))*Math.tan(C.perspective.fov/2*Math.PI/180);n.panDeltaX-=M*E/u*s.touchPanRate,n.panDeltaY-=I*E/u*s.touchPanRate}else n.panDeltaX-=.5*C.ortho.scale*(M/u)*s.touchPanRate,n.panDeltaY-=.5*C.ortho.scale*(I/u)*s.touchPanRate;r.pointerCanvasPos=T}for(var F=0;F<f;++F)gd(d[F],p[F])}}})}return I(e,[{key:"reset",value:function(){}},{key:"destroy",value:function(){var e=this._scene.canvas.canvas;e.removeEventListener("touchstart",this._canvasTouchStartHandler),e.removeEventListener("touchmove",this._canvasTouchMoveHandler),this._scene.off(this._onTick)}}]),e}(),yd=function(e,t){if(e){for(var i=e.target,s=0,r=0;i.offsetParent;)s+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-s,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t},bd=function(){function e(t,i,s,r,n){w(this,e),this._scene=t;var o,a=i.pickController,u=i.cameraControl,h=[],l=new Float32Array(2),c=-1,p=-1,d=this._scene.canvas.canvas,f=function(e){var s;e&&e.worldPos&&(s=e.worldPos);var r=e?e.entity.aabb:t.aabb;if(s){var n=t.camera;q.subVec3(n.eye,n.look,[]),i.cameraFlight.flyTo({aabb:r})}else i.cameraFlight.flyTo({aabb:r})};d.addEventListener("touchstart",this._canvasTouchStartHandler=function(e){if(s.active&&s.pointerEnabled){null!==r.longTouchTimeout&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null);var t=e.touches,n=e.changedTouches;if(o=Date.now(),1===t.length&&1===n.length){c=o,yd(t[0],l);var a=l[0],u=l[1],p=t[0].pageX,d=t[0].pageY;r.longTouchTimeout=setTimeout((function(){i.cameraControl.fire("rightClick",{pagePos:[Math.round(p),Math.round(d)],canvasPos:[Math.round(a),Math.round(u)],event:e},!0),r.longTouchTimeout=null}),s.longTapTimeout)}else c=-1;for(;h.length<t.length;)h.push(new Float32Array(2));for(var f=0,m=t.length;f<m;++f)yd(t[f],h[f]);h.length=t.length}},{passive:!0}),d.addEventListener("touchend",this._canvasTouchEndHandler=function(e){if(s.active&&s.pointerEnabled){var t=Date.now(),i=e.touches,n=e.changedTouches,o=u.hasSubs("pickedSurface");null!==r.longTouchTimeout&&(clearTimeout(r.longTouchTimeout),r.longTouchTimeout=null),0===i.length&&1===n.length&&c>-1&&t-c<150&&(p>-1&&c-p<325?(yd(n[0],a.pickCursorPos),a.schedulePickEntity=!0,a.schedulePickSurface=o,a.update(),a.pickResult?(a.pickResult.touchInput=!0,u.fire("doublePicked",a.pickResult),a.pickedSurface&&u.fire("doublePickedSurface",a.pickResult),s.doublePickFlyTo&&f(a.pickResult)):(u.fire("doublePickedNothing"),s.doublePickFlyTo&&f()),p=-1):q.distVec2(h[0],l)<4&&(yd(n[0],a.pickCursorPos),a.schedulePickEntity=!0,a.schedulePickSurface=o,a.update(),a.pickResult?(a.pickResult.touchInput=!0,u.fire("picked",a.pickResult),a.pickedSurface&&u.fire("pickedSurface",a.pickResult)):u.fire("pickedNothing"),p=t),c=-1),h.length=i.length;for(var d=0,m=i.length;d<m;++d)h[d][0]=i[d].pageX,h[d][1]=i[d].pageY}},{passive:!0})}return I(e,[{key:"reset",value:function(){}},{key:"destroy",value:function(){var e=this._scene.canvas.canvas;e.removeEventListener("touchstart",this._canvasTouchStartHandler),e.removeEventListener("touchend",this._canvasTouchEndHandler)}}]),e}(),xd=function(e){g(i,fe);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,i),(s=t.call(this,e,r)).PAN_LEFT=0,s.PAN_RIGHT=1,s.PAN_UP=2,s.PAN_DOWN=3,s.PAN_FORWARDS=4,s.PAN_BACKWARDS=5,s.ROTATE_X_POS=6,s.ROTATE_X_NEG=7,s.ROTATE_Y_POS=8,s.ROTATE_Y_NEG=9,s.DOLLY_FORWARDS=10,s.DOLLY_BACKWARDS=11,s.AXIS_VIEW_RIGHT=12,s.AXIS_VIEW_BACK=13,s.AXIS_VIEW_LEFT=14,s.AXIS_VIEW_FRONT=15,s.AXIS_VIEW_TOP=16,s.AXIS_VIEW_BOTTOM=17,s._keyMap={},s.scene.canvas.canvas.oncontextmenu=function(e){e.preventDefault()},s._configs={longTapTimeout:600,longTapRadius:5,active:!0,keyboardLayout:"qwerty",navMode:"orbit",planView:!1,firstPerson:!1,followPointer:!0,doublePickFlyTo:!0,panRightClick:!0,showPivot:!1,pointerEnabled:!0,constrainVertical:!1,smartPivot:!1,doubleClickTimeFrame:250,dragRotationRate:360,keyboardRotationRate:90,rotationInertia:0,keyboardPanRate:1,touchPanRate:1,panInertia:.5,keyboardDollyRate:10,mouseWheelDollyRate:100,touchDollyRate:.2,dollyInertia:0,dollyProximityThreshold:30,dollyMinSpeed:.04},s._states={pointerCanvasPos:q.vec2(),mouseover:!1,followPointerDirty:!0,mouseDownClientX:0,mouseDownClientY:0,mouseDownCursorX:0,mouseDownCursorY:0,touchStartTime:null,activeTouches:[],tapStartPos:q.vec2(),tapStartTime:-1,lastTapTime:-1,longTouchTimeout:null},s._updates={rotateDeltaX:0,rotateDeltaY:0,panDeltaX:0,panDeltaY:0,panDeltaZ:0,dollyDelta:0};var n=s.scene;return s._controllers={cameraControl:x(s),pickController:new td(x(s),s._configs),pivotController:new ed(n,s._configs),panController:new Yp(n),cameraFlight:new ou(x(s),{duration:.5})},s._handlers=[new md(s.scene,s._controllers,s._configs,s._states,s._updates),new _d(s.scene,s._controllers,s._configs,s._states,s._updates),new sd(s.scene,s._controllers,s._configs,s._states,s._updates),new ld(s.scene,s._controllers,s._configs,s._states,s._updates),new cd(s.scene,s._controllers,s._configs,s._states,s._updates),new bd(s.scene,s._controllers,s._configs,s._states,s._updates),new pd(s.scene,s._controllers,s._configs,s._states,s._updates)],s._cameraUpdater=new fd(s.scene,s._controllers,s._configs,s._states,s._updates),s.navMode=r.navMode,r.planView&&(s.planView=r.planView),s.constrainVertical=r.constrainVertical,r.keyboardLayout?s.keyboardLayout=r.keyboardLayout:s.keyMap=r.keyMap,s.doublePickFlyTo=r.doublePickFlyTo,s.panRightClick=r.panRightClick,s.active=r.active,s.followPointer=r.followPointer,s.rotationInertia=r.rotationInertia,s.keyboardPanRate=r.keyboardPanRate,s.touchPanRate=r.touchPanRate,s.keyboardRotationRate=r.keyboardRotationRate,s.dragRotationRate=r.dragRotationRate,s.touchDollyRate=r.touchDollyRate,s.dollyInertia=r.dollyInertia,s.dollyProximityThreshold=r.dollyProximityThreshold,s.dollyMinSpeed=r.dollyMinSpeed,s.panInertia=r.panInertia,s.pointerEnabled=!0,s.keyboardDollyRate=r.keyboardDollyRate,s.mouseWheelDollyRate=r.mouseWheelDollyRate,s}return I(i,[{key:"keyMap",get:function(){return this._keyMap},set:function(e){if(e=e||"qwerty",re.isString(e)){var t=this.scene.input,i={};switch(e){default:this.error("Unsupported value for 'keyMap': "+e+" defaulting to 'qwerty'");case"qwerty":i[this.PAN_LEFT]=[t.KEY_A],i[this.PAN_RIGHT]=[t.KEY_D],i[this.PAN_UP]=[t.KEY_Z],i[this.PAN_DOWN]=[t.KEY_X],i[this.PAN_BACKWARDS]=[],i[this.PAN_FORWARDS]=[],i[this.DOLLY_FORWARDS]=[t.KEY_W,t.KEY_ADD],i[this.DOLLY_BACKWARDS]=[t.KEY_S,t.KEY_SUBTRACT],i[this.ROTATE_X_POS]=[t.KEY_DOWN_ARROW],i[this.ROTATE_X_NEG]=[t.KEY_UP_ARROW],i[this.ROTATE_Y_POS]=[t.KEY_Q,t.KEY_LEFT_ARROW],i[this.ROTATE_Y_NEG]=[t.KEY_E,t.KEY_RIGHT_ARROW],i[this.AXIS_VIEW_RIGHT]=[t.KEY_NUM_1],i[this.AXIS_VIEW_BACK]=[t.KEY_NUM_2],i[this.AXIS_VIEW_LEFT]=[t.KEY_NUM_3],i[this.AXIS_VIEW_FRONT]=[t.KEY_NUM_4],i[this.AXIS_VIEW_TOP]=[t.KEY_NUM_5],i[this.AXIS_VIEW_BOTTOM]=[t.KEY_NUM_6];break;case"azerty":i[this.PAN_LEFT]=[t.KEY_Q],i[this.PAN_RIGHT]=[t.KEY_D],i[this.PAN_UP]=[t.KEY_W],i[this.PAN_DOWN]=[t.KEY_X],i[this.PAN_BACKWARDS]=[],i[this.PAN_FORWARDS]=[],i[this.DOLLY_FORWARDS]=[t.KEY_Z,t.KEY_ADD],i[this.DOLLY_BACKWARDS]=[t.KEY_S,t.KEY_SUBTRACT],i[this.ROTATE_X_POS]=[t.KEY_DOWN_ARROW],i[this.ROTATE_X_NEG]=[t.KEY_UP_ARROW],i[this.ROTATE_Y_POS]=[t.KEY_A,t.KEY_LEFT_ARROW],i[this.ROTATE_Y_NEG]=[t.KEY_E,t.KEY_RIGHT_ARROW],i[this.AXIS_VIEW_RIGHT]=[t.KEY_NUM_1],i[this.AXIS_VIEW_BACK]=[t.KEY_NUM_2],i[this.AXIS_VIEW_LEFT]=[t.KEY_NUM_3],i[this.AXIS_VIEW_FRONT]=[t.KEY_NUM_4],i[this.AXIS_VIEW_TOP]=[t.KEY_NUM_5],i[this.AXIS_VIEW_BOTTOM]=[t.KEY_NUM_6]}this._keyMap=i}else{var s=e;this._keyMap=s}}},{key:"_isKeyDownForAction",value:function(e,t){var i=this._keyMap[e];if(!i)return!1;t||(t=this.scene.input.keyDown);for(var s=0,r=i.length;s<r;s++){if(t[i[s]])return!0}return!1}},{key:"pivotElement",set:function(e){this._controllers.pivotController.setPivotElement(e)}},{key:"active",get:function(){return this._configs.active},set:function(e){this._configs.active=!1!==e}},{key:"navMode",get:function(){return this._configs.navMode},set:function(e){"firstPerson"!==(e=e||"orbit")&&"orbit"!==e&&"planView"!==e&&(this.error("Unsupported value for navMode: "+e+" - supported values are 'orbit', 'firstPerson' and 'planView' - defaulting to 'orbit'"),e="orbit"),this._configs.firstPerson="firstPerson"===e,this._configs.planView="planView"===e,(this._configs.firstPerson||this._configs.planView)&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot()),this._configs.navMode=e}},{key:"pointerEnabled",get:function(){return this._configs.pointerEnabled},set:function(e){this._reset(),this._configs.pointerEnabled=!!e}},{key:"_reset",value:function(){for(var e=0,t=this._handlers.length;e<t;e++){var i=this._handlers[e];i.reset&&i.reset()}this._updates.panDeltaX=0,this._updates.panDeltaY=0,this._updates.rotateDeltaX=0,this._updates.rotateDeltaY=0,this._updates.dolyDelta=0}},{key:"followPointer",get:function(){return this._configs.followPointer},set:function(e){this._configs.followPointer=!1!==e}},{key:"pivotPos",get:function(){return this._controllers.pivotController.getPivotPos()},set:function(e){this._controllers.pivotController.setPivotPos(e)}},{key:"dollyToPointer",get:function(){return this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer},set:function(e){this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer=e}},{key:"panToPointer",get:function(){return this.warn("panToPointer property is deprecated - replaced with followPointer"),!1},set:function(e){this.warn("panToPointer property is deprecated - replaced with followPointer")}},{key:"planView",get:function(){return this.warn("planView property is deprecated - replaced with navMode"),this._configs.planView},set:function(e){this._configs.planView=!!e,this._configs.firstPerson=!1,this._configs.planView&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot()),this.warn("planView property is deprecated - replaced with navMode")}},{key:"firstPerson",get:function(){return this.warn("firstPerson property is deprecated - replaced with navMode"),this._configs.firstPerson},set:function(e){this.warn("firstPerson property is deprecated - replaced with navMode"),this._configs.firstPerson=!!e,this._configs.planView=!1,this._configs.firstPerson&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot())}},{key:"constrainVertical",get:function(){return this._configs.constrainVertical},set:function(e){this._configs.constrainVertical=!!e}},{key:"doublePickFlyTo",get:function(){return this._configs.doublePickFlyTo},set:function(e){this._configs.doublePickFlyTo=!1!==e}},{key:"panRightClick",get:function(){return this._configs.panRightClick},set:function(e){this._configs.panRightClick=!1!==e}},{key:"rotationInertia",get:function(){return this._configs.rotationInertia},set:function(e){this._configs.rotationInertia=null!=e?e:0}},{key:"keyboardPanRate",get:function(){return this._configs.keyboardPanRate},set:function(e){this._configs.keyboardPanRate=null!=e?e:5}},{key:"touchPanRate",get:function(){return this._configs.touchPanRate},set:function(e){this._configs.touchPanRate=null!=e?e:1}},{key:"keyboardRotationRate",get:function(){return this._configs.keyboardRotationRate},set:function(e){this._configs.keyboardRotationRate=null!=e?e:90}},{key:"dragRotationRate",get:function(){return this._configs.dragRotationRate},set:function(e){this._configs.dragRotationRate=null!=e?e:360}},{key:"keyboardDollyRate",get:function(){return this._configs.keyboardDollyRate},set:function(e){this._configs.keyboardDollyRate=null!=e?e:15}},{key:"touchDollyRate",get:function(){return this._configs.touchDollyRate},set:function(e){this._configs.touchDollyRate=null!=e?e:.2}},{key:"mouseWheelDollyRate",get:function(){return this._configs.mouseWheelDollyRate},set:function(e){this._configs.mouseWheelDollyRate=null!=e?e:100}},{key:"dollyInertia",get:function(){return this._configs.dollyInertia},set:function(e){this._configs.dollyInertia=null!=e?e:0}},{key:"dollyProximityThreshold",get:function(){return this._configs.dollyProximityThreshold},set:function(e){this._configs.dollyProximityThreshold=null!=e?e:35}},{key:"dollyMinSpeed",get:function(){return this._configs.dollyMinSpeed},set:function(e){this._configs.dollyMinSpeed=null!=e?e:.04}},{key:"panInertia",get:function(){return this._configs.panInertia},set:function(e){this._configs.panInertia=null!=e?e:.5}},{key:"keyboardLayout",get:function(){return this._configs.keyboardLayout},set:function(e){"qwerty"!==(e=e||"qwerty")&&"azerty"!==e&&(this.error("Unsupported value for keyboardLayout - defaulting to 'qwerty'"),e="qwerty"),this._configs.keyboardLayout=e,this.keyMap=this._configs.keyboardLayout}},{key:"smartPivot",get:function(){return this._configs.smartPivot},set:function(e){this._configs.smartPivot=!1!==e}},{key:"doubleClickTimeFrame",get:function(){return this._configs.doubleClickTimeFrame},set:function(e){this._configs.doubleClickTimeFrame=null!=e?e:250}},{key:"destroy",value:function(){this._destroyHandlers(),this._destroyControllers(),this._cameraUpdater.destroy(),m(P(i.prototype),"destroy",this).call(this)}},{key:"_destroyHandlers",value:function(){for(var e=0,t=this._handlers.length;e<t;e++){var i=this._handlers[e];i.destroy&&i.destroy()}}},{key:"_destroyControllers",value:function(){for(var e=0,t=this._controllers.length;e<t;e++){var i=this._controllers[e];i.destroy&&i.destroy()}}}]),i}(),Pd=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.id=i,this.projectId=s,this.revisionId=r,this.author=n,this.createdAt=o,this.creatingApplication=a,this.schema=u,this.metaScene=t,this.propertySets=h,this.rootMetaObject=null,this.rootMetaObjects=[]}return I(e,[{key:"getJSON",value:function(){var e=[];return function t(i){var s={id:i.id,extId:i.extId,type:i.type,name:i.name};i.parent&&(s.parent=i.parent.id),e.push(s);var r=i.children;if(r)for(var n=0,o=r.length;n<o;n++)t(r[n])}(this.rootMetaObject),{id:this.id,projectId:this.projectId,revisionId:this.revisionId,metaObjects:e}}}]),e}(),Td=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.metaModel=t,this.metaModels=[t],this.id=i,this.originalSystemId=s,this.name=r,this.type=n,this.propertySets=o,null!=a&&(this.parent=a),null!=u&&(this.children=u),null!=h&&(this.external=h)}return I(e,[{key:"getObjectIDsInSubtree",value:function(){var e=[];return function t(i){if(i){e.push(i.id);var s=i.children;if(s)for(var r=0,n=s.length;r<n;r++)t(s[r])}}(this),e}},{key:"withMetaObjectsInSubtree",value:function(e){!function t(i){if(i){e(i);var s=i.children;if(s)for(var r=0,n=s.length;r<n;r++)t(s[r])}}(this)}},{key:"getObjectIDsInSubtreeByType",value:function(e){for(var t={},i=0,s=e.length;i<s;i++)t[e[i]]=e[i];var r=[];return function e(i){if(i){t[i.type]&&r.push(i.id);var s=i.children;if(s)for(var n=0,o=s.length;n<o;n++)e(s[n])}}(this),r}},{key:"getJSON",value:function(){var e={id:this.id,type:this.type,name:this.name};return this.parent&&(e.parent=this.parent.id),e}}]),e}(),wd=I((function e(t,i,s,r,n){w(this,e),this.name=t,this.type=s,this.value=i,this.valueType=r,this.description=n})),Md=I((function e(t,i,s,r,n){if(w(this,e),this.id=t,this.originalSystemId=i,this.name=s,this.type=r,this.properties=[],n)for(var o=0,a=n.length;o<a;o++){var u=n[o];this.properties.push(new wd(u.name,u.value,u.type,u.valueType,u.description))}})),Id=function(){function e(t,i){w(this,e),this.viewer=t,this.scene=i,this.metaModels={},this.propertySets={},this.metaObjects={},this.metaObjectsByType={},this.rootMetaObjects={},this._typeCounts={},this._eventSubs={}}return I(e,[{key:"on",value:function(e,t){var i=this._eventSubs[e];i||(i=[],this._eventSubs[e]=i),i.push(t)}},{key:"fire",value:function(e,t){var i=this._eventSubs[e];if(i)for(var s=0,r=i.length;s<r;s++)i[s](t)}},{key:"off",value:function(e){}},{key:"createMetaModel",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=t.projectId||"none",r=t.revisionId||"none",n=t.propertySets||[],o=t.metaObjects||[],a=t.author,u=t.createdAt,h=t.creatingApplication,l=t.schema,c=new Pd(this,e,s,r,a,u,h,l,[],null);this.metaModels[e]=c;for(var p=0,d=n.length;p<d;p++){var f=n[p],m=f.id,v=new Md(m,f.originalSystemId,f.name,f.type,f.properties);c.propertySets[m]=v,this.propertySets[m]=v}for(var g=[],_=[],y=[],b=0,x=o.length;b<x;b++){var P=o[b];P.type,g.push(P)}for(var T=0,w=g.length;T<w;T++){var M=g[T],I=this.metaObjects[M.id];I?(I.metaModels.push(c),_.push(I)):y.push(M)}for(var C=0,D=y.length;C<D;C++){var A=y[C],k=A.type,E=i.globalizeObjectIds?q.globalizeObjectId(e,A.id):A.id,F=A.id,R=A.name,S=[];if(A.propertySetIds&&A.propertySetIds.length>0)for(var O=0,B=A.propertySetIds.length;O<B;O++){var L=A.propertySetIds[O],N=c.propertySets[L];N&&S.push(N)}var j=null,G=null,H=A.external,U=new Td(c,E,F,R,k,S,j,G,H);U._parentId=A.parent,this.metaObjects[E]=U,(this.metaObjectsByType[k]||(this.metaObjectsByType[k]={}))[E]=U,void 0===this._typeCounts[k]?this._typeCounts[k]=1:this._typeCounts[k]++,_.push(U),void 0===A.parent||A.parent}for(var V=0,z=_.length;V<z;V++){var W=_[V],X=i.globalizeObjectIds?q.globalizeObjectId(e,W.id):W.id;if(void 0!==W._parentId&&null!==W._parentId||W.parent){if(W._parentId){var Y=i.globalizeObjectIds?q.globalizeObjectId(e,W._parentId):W._parentId;W._parentId=null;var K=this.metaObjects[Y];K&&(W.parent=K,K.children=K.children||[],K.children.push(W))}}else c.rootMetaObject=W,c.rootMetaObjects[X]=W,this.rootMetaObjects[X]=W}return this.fire("metaModelCreated",e),c}},{key:"destroyMetaModel",value:function(e){var t=this.metaModels[e];t&&(this._removeMetaModel(t),this.fire("metaModelDestroyed",e))}},{key:"_removeMetaModel",value:function(e){var t=this,i=this.metaObjects,s=this.metaObjectsByType;for(var r in function e(r){delete i[r.id];var n=s[r.type];n&&n[r.id]&&(delete n[r.id],0==--t._typeCounts[r.type]&&(delete t._typeCounts[r.type],delete s[r.type]));var o=r.children;if(o)for(var a=0,u=o.length;a<u;a++){e(o[a])}}(e.rootMetaObject),e.propertySets)e.propertySets.hasOwnProperty(r)&&delete this.propertySets[r];delete this.metaModels[e.id]}},{key:"getObjectIDsByType",value:function(e){var t=this.metaObjectsByType[e];return t?Object.keys(t):[]}},{key:"getObjectIDsInSubtree",value:function(e,t,i){var s=[],r=this.metaObjects[e],n=t&&t.length>0?Cd(t):null,o=i&&i.length>0?Cd(i):null;return function e(t){if(t){var i=!0;(o&&o[t.type]||n&&!n[t.type])&&(i=!1),i&&s.push(t.id);var r=t.children;if(r)for(var a=0,u=r.length;a<u;a++)e(r[a])}}(r),s}},{key:"withMetaObjectsInSubtree",value:function(e,t){var i=this.metaObjects[e];i&&i.withMetaObjectsInSubtree(t)}}]),e}();function Cd(e){for(var t={},i=0,s=e.length;i<s;i++)t[e[i]]=!0;return t}var Dd=function(){function e(t){w(this,e),this.language="en",this.localeService=t.localeService||new Ka,this.scene=new Br(this,{canvasId:t.canvasId,canvasElement:t.canvasElement,keyboardEventsElement:t.keyboardEventsElement,contextAttr:{preserveDrawingBuffer:!1!==t.preserveDrawingBuffer,premultipliedAlpha:!!t.premultipliedAlpha,antialias:!1!==t.antialias},spinnerElementId:t.spinnerElementId,transparent:!1!==t.transparent,gammaInput:!0,gammaOutput:!1,backgroundColor:t.backgroundColor,backgroundColorFromAmbientLight:t.backgroundColorFromAmbientLight,ticksPerRender:1,ticksPerOcclusionTest:20,units:t.units,scale:t.scale,origin:t.origin,saoEnabled:t.saoEnabled,alphaDepthMask:!1!==t.alphaDepthMask,entityOffsetsEnabled:!!t.entityOffsetsEnabled,pickSurfacePrecisionEnabled:!!t.pickSurfacePrecisionEnabled,logarithmicDepthBufferEnabled:!!t.logarithmicDepthBufferEnabled,pbrEnabled:!!t.pbrEnabled,colorTextureEnabled:!1!==t.colorTextureEnabled}),this.metaScene=new Id(this,this.scene),this.id=t.id||this.scene.id,this.camera=this.scene.camera,this.cameraFlight=new ou(this.scene,{duration:.5}),this.cameraControl=new xd(this.scene,{doublePickFlyTo:!0}),this._plugins=[],this._eventSubs={}}return I(e,[{key:"capabilities",get:function(){return this.scene.capabilities}},{key:"on",value:function(e,t){var i=this._eventSubs[e];i||(i=[],this._eventSubs[e]=i),i.push(t)}},{key:"fire",value:function(e,t){var i=this._eventSubs[e];if(i)for(var s=0,r=i.length;s<r;s++)i[s](t)}},{key:"off",value:function(e){}},{key:"log",value:function(e){console.log("[xeokit viewer ".concat(this.id,"]: ").concat(e))}},{key:"error",value:function(e){console.error("[xeokit viewer ".concat(this.id,"]: ").concat(e))}},{key:"addPlugin",value:function(e){this._plugins.push(e)}},{key:"removePlugin",value:function(e){for(var t=0,i=this._plugins.length;t<i;t++){var s=this._plugins[t];if(s===e)return s.clear&&s.clear(),void this._plugins.splice(t,1)}}},{key:"sendToPlugins",value:function(e,t){for(var i=0,s=this._plugins.length;i<s;i++){var r=this._plugins[i];r.send&&r.send(e,t)}}},{key:"clear",value:function(){throw'Viewer#clear() no longer implemented - use \'#sendToPlugins("clear") instead'}},{key:"resetView",value:function(){throw"Viewer#resetView() no longer implemented - use CameraMemento & ObjectsMemento classes instead"}},{key:"beginSnapshot",value:function(){this._snapshotBegun||(this.scene._renderer.beginSnapshot(),this._snapshotBegun=!0)}},{key:"getSnapshot",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!this._snapshotBegun,i=void 0!==e.width&&void 0!==e.height,s=this.scene.canvas.canvas,r=s.clientWidth,n=s.clientHeight;s.style.width,s.style.height;var o=e.width?Math.floor(e.width):s.width,a=e.height?Math.floor(e.height):s.height;i&&(s.width=o,s.height=a),this._snapshotBegun||this.beginSnapshot(),e.includeGizmos||this.sendToPlugins("snapshotStarting"),this.scene._renderer.renderSnapshot();var u=this.scene._renderer.readSnapshot(e);return i&&(s.width=r,s.height=n,this.scene.glRedraw()),e.includeGizmos||this.sendToPlugins("snapshotFinished"),t&&this.endSnapshot(),u}},{key:"endSnapshot",value:function(){this._snapshotBegun&&(this.scene._renderer.endSnapshot(),this.scene._renderer.render({force:!0}),this._snapshotBegun=!1)}},{key:"destroy",value:function(){for(var e=this._plugins.slice(),t=0,i=e.length;t<i;t++){e[t].destroy()}this.scene.destroy()}}]),e}(),Ad=function(){function e(){w(this,e)}return I(e,[{key:"doublePrecisionEnabled",get:function(){return q.getDoublePrecisionEnabled()},set:function(e){q.setDoublePrecisionEnabled(e)}}]),e}(),kd=function(e){g(i,fe);var t=y(i);function i(e){var s;return w(this,i),(s=t.call(this,e.viewer.scene)).plugin=e,s._active=!1,s._currentDistanceMeasurementByMouse=null,s._currentDistanceMeasurementByMouseInittouchState={wireVisible:null,axisVisible:null,xAxisVisible:null,yaxisVisible:null,zAxisVisible:null,targetVisible:null},s._touchStartDot=new Be(e._container,{fillColor:e.defaultColor,zIndex:e.zIndex+1,visible:!1}),s._touchStartMarker=new Se(x(s),{id:"distanceMeasurementMarker"}),s._touchStartMarker.on("canvasPos",(function(e){s._touchStartDot.setPos(e[0],e[1])})),s._onMouseHoverSurface=null,s._onMouseHoverOff=null,s._onPickedNothing=null,s._onInputMouseDown=null,s._onInputMouseUp=null,s._onCanvasTouchStart=null,s._onCanvasTouchEnd=null,s}return I(i,[{key:"active",get:function(){return this._active}},{key:"activate",value:function(){var e=this;if(!this._active){var t,i,s=this.plugin,r=this.scene,n=s.viewer.cameraControl,o=r.canvas.canvas,a=r.input,u=this._touchStartDot,h=r.pickSurfacePrecisionEnabled,l=null,c=q.vec3(),p=q.vec2(),d=0,f=q.vec2(),m=q.vec2(),v=q.vec3();this._onMouseHoverSurface=n.on("hoverSurface",(function(t){l=t.entity,c.set(t.worldPos),p.set(t.canvasPos),o.style.cursor="pointer",e._currentDistanceMeasurementByMouse&&(e._currentDistanceMeasurementByMouse.wireVisible=e._currentDistanceMeasurementByMouseInittouchState.wireVisible,e._currentDistanceMeasurementByMouse.axisVisible=e._currentDistanceMeasurementByMouseInittouchState.axisVisible&&e.plugin.defaultAxisVisible,e._currentDistanceMeasurementByMouse.xAxisVisible=e._currentDistanceMeasurementByMouseInittouchState.xAxisVisible&&e.plugin.defaultXAxisVisible,e._currentDistanceMeasurementByMouse.yAxisVisible=e._currentDistanceMeasurementByMouseInittouchState.yAxisVisible&&e.plugin.defaultYAxisVisible,e._currentDistanceMeasurementByMouse.zAxisVisible=e._currentDistanceMeasurementByMouseInittouchState.zAxisVisible&&e.plugin.defaultZAxisVisible,e._currentDistanceMeasurementByMouse.targetVisible=e._currentDistanceMeasurementByMouseInittouchState.targetVisible,e._currentDistanceMeasurementByMouse.target.entity=l,e._currentDistanceMeasurementByMouse.target.worldPos=c)})),this._onInputMouseDown=a.on("mousedown",(function(e){t=e[0],i=e[1]})),this._onInputMouseUp=a.on("mouseup",(function(n){if(!(n[0]>t+5||n[0]<t-5||n[1]>i+5||n[1]<i-5))if(e._currentDistanceMeasurementByMouse)if(l){if(h){var o=r.pick({canvasPos:p,pickSurface:!0,pickSurfacePrecision:!0});o&&o.worldPos&&(e._currentDistanceMeasurementByMouse.target.worldPos=o.worldPos),e._currentDistanceMeasurementByMouse.approximate=!1}e._currentDistanceMeasurementByMouse.clickable=!0,e.fire("measurementEnd",e._currentDistanceMeasurementByMouse),e._currentDistanceMeasurementByMouse=null}else e._currentDistanceMeasurementByMouse.destroy(),e.fire("measurementCancel",e._currentDistanceMeasurementByMouse),e._currentDistanceMeasurementByMouse=null;else if(l){if(h){var a=r.pick({canvasPos:p,pickSurface:!0,pickSurfacePrecision:!0});a&&a.worldPos&&c.set(a.worldPos)}e._currentDistanceMeasurementByMouse=s.createMeasurement({id:q.createUUID(),origin:{entity:l,worldPos:c},target:{entity:l,worldPos:c},approximate:!0}),e._currentDistanceMeasurementByMouseInittouchState.axisVisible=e._currentDistanceMeasurementByMouse.axisVisible&&e.plugin.defaultAxisVisible,e._currentDistanceMeasurementByMouseInittouchState.xAxisVisible=e._currentDistanceMeasurementByMouse.xAxisVisible&&e.plugin.defaultXAxisVisible,e._currentDistanceMeasurementByMouseInittouchState.yAxisVisible=e._currentDistanceMeasurementByMouse.yAxisVisible&&e.plugin.defaultYAxisVisible,e._currentDistanceMeasurementByMouseInittouchState.zAxisVisible=e._currentDistanceMeasurementByMouse.zAxisVisible&&e.plugin.defaultZAxisVisible,e._currentDistanceMeasurementByMouseInittouchState.wireVisible=e._currentDistanceMeasurementByMouse.wireVisible,e._currentDistanceMeasurementByMouseInittouchState.targetVisible=e._currentDistanceMeasurementByMouse.targetVisible,e._currentDistanceMeasurementByMouse.clickable=!1,e.fire("measurementStart",e._currentDistanceMeasurementByMouse)}})),this._onMouseHoverOff=n.on("hoverOff",(function(t){l=null,e._currentDistanceMeasurementByMouse&&(e._currentDistanceMeasurementByMouse.wireVisible=!1,e._currentDistanceMeasurementByMouse.targetVisible=!1,e._currentDistanceMeasurementByMouse.axisVisible=!1),o.style.cursor="default"})),this._onPickedNothing=n.on("pickedNothing",(function(t){e._currentDistanceMeasurementByMouse&&(e.fire("measurementCancel",e._currentDistanceMeasurementByMouse),e._currentDistanceMeasurementByMouse.destroy(),e._currentDistanceMeasurementByMouse=null),u.setVisible(!1),d=0})),o.addEventListener("touchstart",this._onCanvasTouchStart=function(e){var t=e.touches,i=e.changedTouches;1===t.length&&1===i.length&&Ed(t[0],f)},{passive:!0}),o.addEventListener("touchend",this._onCanvasTouchEnd=function(t){var i=t.touches,n=t.changedTouches;if(0===i.length&&1===n.length){if(Ed(n[0],m),m[0]>f[0]+5||m[0]<f[0]-5||m[1]>f[1]+5||m[1]<f[1]-5)return;var o=r.pick({canvasPos:m,pickSurface:!0,pickSurfacePrecision:h});if(o&&o.worldPos)switch(d){case 0:u.setVisible(!0),e._touchStartMarker.worldPos=o.worldPos,v.set(o.worldPos),d=1;break;case 1:u.setVisible(!1),e._touchStartMarker.worldPos=o.worldPos;var a=s.createMeasurement({id:q.createUUID(),origin:{entity:l,worldPos:v},target:{entity:l,worldPos:o.worldPos},approximate:!h});a.clickable=!0,d=0,e.fire("measurementEnd",a)}else u.setVisible(!1),d=0}},{passive:!0}),this._active=!0}}},{key:"deactivate",value:function(){if(this._active){this._touchStartDot.setVisible(!1),this.reset();var e=this.plugin.viewer.scene.input;e.off(this._onInputMouseDown),e.off(this._onInputMouseUp);var t=this.plugin.viewer.cameraControl;t.off(this._onMouseHoverSurface),t.off(this._onMouseHoverOff),t.off(this._onPickedNothing);var i=this.plugin.viewer.scene.canvas.canvas;i.removeEventListener("touchstart",this._onCanvasTouchStart),i.removeEventListener("touchend",this._onCanvasTouchEnd),this._currentDistanceMeasurementByMouse&&(this.fire("measurementCancel",this._currentDistanceMeasurementByMouse),this._currentDistanceMeasurementByMouse.destroy(),this._currentDistanceMeasurementByMouse=null),this._active=!1}}},{key:"reset",value:function(){this._active&&this._currentDistanceMeasurementByMouse&&(this.fire("measurementCancel",this._currentDistanceMeasurementByMouse),this._currentDistanceMeasurementByMouse.destroy(),this._currentDistanceMeasurementByMouse=null)}},{key:"destroy",value:function(){this._touchStartDot.destroy(),this.deactivate(),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),Ed=function(e,t){if(e){for(var i=e.target,s=0,r=0;i.offsetParent;)s+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-s,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t},Fd=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,"DistanceMeasurements",e))._container=r.container||document.body,s._control=new kd(x(s)),s._measurements={},s.labelMinAxisLength=r.labelMinAxisLength,s.defaultVisible=!1!==r.defaultVisible,s.defaultOriginVisible=!1!==r.defaultOriginVisible,s.defaultTargetVisible=!1!==r.defaultTargetVisible,s.defaultWireVisible=!1!==r.defaultWireVisible,s.defaultLabelsVisible=!1!==r.defaultLabelsVisible,s.defaultAxisVisible=!1!==r.defaultAxisVisible,s.defaultXAxisVisible=!1!==r.defaultXAxisVisible,s.defaultYAxisVisible=!1!==r.defaultYAxisVisible,s.defaultZAxisVisible=!1!==r.defaultZAxisVisible,s.defaultColor=void 0!==r.defaultColor?r.defaultColor:"#00BBFF",s.zIndex=r.zIndex||1e4,s._onMouseOver=function(e,t){s.fire("mouseOver",{plugin:x(s),distanceMeasurement:t,measurement:t,event:e})},s._onMouseLeave=function(e,t){s.fire("mouseLeave",{plugin:x(s),distanceMeasurement:t,measurement:t,event:e})},s._onContextMenu=function(e,t){s.fire("contextMenu",{plugin:x(s),distanceMeasurement:t,measurement:t,event:e})},s}return I(i,[{key:"send",value:function(e,t){}},{key:"control",get:function(){return this._control}},{key:"measurements",get:function(){return this._measurements}},{key:"labelMinAxisLength",get:function(){return this._labelMinAxisLength},set:function(e){e<1&&(this.error("labelMinAxisLength must be >= 1; defaulting to 25"),e=25),this._labelMinAxisLength=e||25}},{key:"createMeasurement",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.viewer.scene.components[t.id]&&(this.error("Viewer scene component with this ID already exists: "+t.id),delete t.id);var i=t.origin,s=t.target,r=new Ya(this,{id:t.id,plugin:this,container:this._container,origin:{entity:i.entity,worldPos:i.worldPos},target:{entity:s.entity,worldPos:s.worldPos},visible:t.visible,wireVisible:t.wireVisible,axisVisible:!1!==t.axisVisible&&!1!==this.defaultAxisVisible,xAxisVisible:!1!==t.xAxisVisible&&!1!==this.defaultXAxisVisible,yAxisVisible:!1!==t.yAxisVisible&&!1!==this.defaultYAxisVisible,zAxisVisible:!1!==t.zAxisVisible&&!1!==this.defaultZAxisVisible,labelsVisible:!1!==t.labelsVisible&&!1!==this.defaultLabelsVisible,originVisible:t.originVisible,targetVisible:t.targetVisible,color:t.color,onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave,onContextMenu:this._onContextMenu});return this._measurements[r.id]=r,r.on("destroyed",(function(){delete e._measurements[r.id]})),this.fire("measurementCreated",r),r}},{key:"destroyMeasurement",value:function(e){var t=this._measurements[e];t?(t.destroy(),this.fire("measurementDestroyed",t)):this.log("DistanceMeasurement not found: "+e)}},{key:"setLabelsShown",value:function(e){for(var t=0,i=Object.entries(this.measurements);t<i.length;t++){var s=p(i[t],2);s[0];s[1].labelShown=e}}},{key:"clear",value:function(){for(var e=Object.keys(this._measurements),t=0,i=e.length;t<i;t++)this.destroyMeasurement(e[t])}},{key:"destroy",value:function(){this.clear(),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),Rd=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,i),(s=t.call(this,"FastNav",e))._hideColorTexture=!1!==r.hideColorTexture,s._hidePBR=!1!==r.hidePBR,s._hideSAO=!1!==r.hideSAO,s._hideEdges=!1!==r.hideEdges,s._hideTransparentObjects=!!r.hideTransparentObjects,s._scaleCanvasResolution=!!r.scaleCanvasResolution,s._scaleCanvasResolutionFactor=r.scaleCanvasResolutionFactor||.6,s._delayBeforeRestore=!1!==r.delayBeforeRestore,s._delayBeforeRestoreSeconds=r.delayBeforeRestoreSeconds||.5;var n=1e3*s._delayBeforeRestoreSeconds,o=!1,a=function(){n=1e3*s._delayBeforeRestoreSeconds,o||(e.scene._renderer.setColorTextureEnabled(!s._hideColorTexture),e.scene._renderer.setPBREnabled(!s._hidePBR),e.scene._renderer.setSAOEnabled(!s._hideSAO),e.scene._renderer.setTransparentEnabled(!s._hideTransparentObjects),e.scene._renderer.setEdgesEnabled(!s._hideEdges),s._scaleCanvasResolution?e.scene.canvas.resolutionScale=s._scaleCanvasResolutionFactor:e.scene.canvas.resolutionScale=1,o=!0)},u=function(){e.scene.canvas.resolutionScale=1,e.scene._renderer.setEdgesEnabled(!0),e.scene._renderer.setColorTextureEnabled(!0),e.scene._renderer.setPBREnabled(!0),e.scene._renderer.setSAOEnabled(!0),e.scene._renderer.setTransparentEnabled(!0),o=!1};s._onCanvasBoundary=e.scene.canvas.on("boundary",a),s._onCameraMatrix=e.scene.camera.on("matrix",a),s._onSceneTick=e.scene.on("tick",(function(e){o&&(n-=e.deltaTime,(!s._delayBeforeRestore||n<=0)&&u())}));var h=!1;return s._onSceneMouseDown=e.scene.input.on("mousedown",(function(){h=!0})),s._onSceneMouseUp=e.scene.input.on("mouseup",(function(){h=!1})),s._onSceneMouseMove=e.scene.input.on("mousemove",(function(){h&&a()})),s}return I(i,[{key:"hideColorTexture",get:function(){return this._hideColorTexture},set:function(e){this._hideColorTexture=e}},{key:"hidePBR",get:function(){return this._hidePBR},set:function(e){this._hidePBR=e}},{key:"hideSAO",get:function(){return this._hideSAO},set:function(e){this._hideSAO=e}},{key:"hideEdges",get:function(){return this._hideEdges},set:function(e){this._hideEdges=e}},{key:"hideTransparentObjects",get:function(){return this._hideTransparentObjects},set:function(e){this._hideTransparentObjects=!1!==e}},{key:"scaleCanvasResolution",get:function(){return this._scaleCanvasResolution},set:function(e){this._scaleCanvasResolution=e}},{key:"scaleCanvasResolutionFactor",get:function(){return this._scaleCanvasResolutionFactor},set:function(e){this._scaleCanvasResolutionFactor=e||.6}},{key:"delayBeforeRestore",get:function(){return this._delayBeforeRestore},set:function(e){this._delayBeforeRestore=e}},{key:"delayBeforeRestoreSeconds",get:function(){return this._delayBeforeRestoreSeconds},set:function(e){this._delayBeforeRestoreSeconds=null!=e?e:.5}},{key:"send",value:function(e,t){}},{key:"destroy",value:function(){this.viewer.scene.camera.off(this._onCameraMatrix),this.viewer.scene.canvas.off(this._onCanvasBoundary),this.viewer.scene.input.off(this._onSceneMouseDown),this.viewer.scene.input.off(this._onSceneMouseUp),this.viewer.scene.input.off(this._onSceneMouseMove),this.viewer.scene.off(this._onSceneTick),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),Sd=function(){function e(){w(this,e)}return I(e,[{key:"getMetaModel",value:function(e,t,i){re.loadJSON(e,(function(e){t(e)}),(function(e){i(e)}))}},{key:"getGLTF",value:function(e,t,i){re.loadArraybuffer(e,(function(e){t(e)}),(function(e){i(e)}))}},{key:"getGLB",value:function(e,t,i){re.loadArraybuffer(e,(function(e){t(e)}),(function(e){i(e)}))}},{key:"getArrayBuffer",value:function(e,t,i,s){!function(e,t,i,s){var r=function(){};i=i||r,s=s||r;var n=/^data:(.*?)(;base64)?,(.*)$/,o=t.match(n);if(o){var a=!!o[2],u=o[3];u=window.decodeURIComponent(u),a&&(u=window.atob(u));try{for(var h=new ArrayBuffer(u.length),l=new Uint8Array(h),c=0;c<u.length;c++)l[c]=u.charCodeAt(c);window.setTimeout((function(){i(h)}),0)}catch(e){window.setTimeout((function(){s(e)}),0)}}else{var p=function(e){var t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}(e),d=p+t,f=new XMLHttpRequest;f.open("GET",d,!0),f.responseType="arraybuffer",f.onreadystatechange=function(){4===f.readyState&&(200===f.status?i(f.response):s("loadArrayBuffer error : "+f.response))},f.send(null)}}(e,t,(function(e){i(e)}),(function(e){s(e)}))}}]),e}();function Od(e,t){if(!e)throw new Error(t||"loader assertion failed.")}var Bd=Boolean("object"!==("undefined"==typeof process?"undefined":T(process))||"[object process]"!==String(process)||process.browser),Ld="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Ld&&parseFloat(Ld[1]);function Nd(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}var jd={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},Gd=jd.global||jd.self||jd.window||{},Hd="object"!==("undefined"==typeof process?"undefined":T(process))||"[object process]"!==String(process)||process.browser,Ud="function"==typeof importScripts,Vd="undefined"!=typeof window&&void 0!==window.orientation,zd="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function Wd(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}zd&&parseFloat(zd[1]);var Xd=function(){function e(t,i){var s=this;w(this,e),Wd(this,"name",void 0),Wd(this,"workerThread",void 0),Wd(this,"isRunning",!0),Wd(this,"result",void 0),Wd(this,"_resolve",(function(){})),Wd(this,"_reject",(function(){})),this.name=t,this.workerThread=i,this.result=new Promise((function(e,t){s._resolve=e,s._reject=t}))}return I(e,[{key:"postMessage",value:function(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}},{key:"done",value:function(e){Nd(this.isRunning),this.isRunning=!1,this._resolve(e)}},{key:"error",value:function(e){Nd(this.isRunning),this.isRunning=!1,this._reject(e)}}]),e}(),Yd=I((function e(){w(this,e)})),Kd=new Map;function Jd(e){Nd(e.source&&!e.url||!e.source&&e.url);var t=Kd.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return Zd((t=e,"try {\n  importScripts('".concat(t,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")));var t}(e.url),Kd.set(e.url,t)),e.source&&(t=Zd(e.source),Kd.set(e.source,t))),Nd(t),t}function Zd(e){var t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Qd(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2?arguments[2]:void 0,s=i||new Set;if(e){if(qd(e))s.add(e);else if(qd(e.buffer))s.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"===T(e))for(var r in e)Qd(e[r],t,s)}else;return void 0===i?Array.from(s):[]}function qd(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}var $d=function(){},ef=function(){function e(t){w(this,e),Wd(this,"name",void 0),Wd(this,"source",void 0),Wd(this,"url",void 0),Wd(this,"terminated",!1),Wd(this,"worker",void 0),Wd(this,"onMessage",void 0),Wd(this,"onError",void 0),Wd(this,"_loadableURL","");var i=t.name,s=t.source,r=t.url;Nd(s||r),this.name=i,this.source=s,this.url=r,this.onMessage=$d,this.onError=function(e){return console.log(e)},this.worker=Hd?this._createBrowserWorker():this._createNodeWorker()}return I(e,[{key:"destroy",value:function(){this.onMessage=$d,this.onError=$d,this.worker.terminate(),this.terminated=!0}},{key:"isRunning",get:function(){return Boolean(this.onMessage)}},{key:"postMessage",value:function(e,t){t=t||Qd(e),this.worker.postMessage(e,t)}},{key:"_getErrorFromErrorEvent",value:function(e){var t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}},{key:"_createBrowserWorker",value:function(){var e=this;this._loadableURL=Jd({source:this.source,url:this.url});var t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=function(t){t.data?e.onMessage(t.data):e.onError(new Error("No data received"))},t.onerror=function(t){e.onError(e._getErrorFromErrorEvent(t)),e.terminated=!0},t.onmessageerror=function(e){return console.error(e)},t}},{key:"_createNodeWorker",value:function(){var e,t=this;if(this.url){var i=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Yd(i,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new Yd(this.source,{eval:!0})}return e.on("message",(function(e){t.onMessage(e)})),e.on("error",(function(e){t.onError(e)})),e.on("exit",(function(e){})),e}}],[{key:"isSupported",value:function(){return"undefined"!=typeof Worker&&Hd||void 0!==T(Yd)}}]),e}(),tf=function(){function e(t){w(this,e),Wd(this,"name","unnamed"),Wd(this,"source",void 0),Wd(this,"url",void 0),Wd(this,"maxConcurrency",1),Wd(this,"maxMobileConcurrency",1),Wd(this,"onDebug",(function(){})),Wd(this,"reuseWorkers",!0),Wd(this,"props",{}),Wd(this,"jobQueue",[]),Wd(this,"idleQueue",[]),Wd(this,"count",0),Wd(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}var t,i;return I(e,[{key:"destroy",value:function(){this.idleQueue.forEach((function(e){return e.destroy()})),this.isDestroyed=!0}},{key:"setProps",value:function(e){this.props=l(l({},this.props),e),void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}},{key:"startJob",value:(i=u(o().mark((function e(t){var i,s,r,n=this,a=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>1&&void 0!==a[1]?a[1]:function(e,t,i){return e.done(i)},s=a.length>2&&void 0!==a[2]?a[2]:function(e,t){return e.error(t)},r=new Promise((function(e){return n.jobQueue.push({name:t,onMessage:i,onError:s,onStart:e}),n})),this._startQueuedJob(),e.next=6,r;case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_startQueuedJob",value:(t=u(o().mark((function e(){var t,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.jobQueue.length){e.next=2;break}return e.abrupt("return");case 2:if(t=this._getAvailableWorker()){e.next=5;break}return e.abrupt("return");case 5:if(!(i=this.jobQueue.shift())){e.next=18;break}return this.onDebug({message:"Starting job",name:i.name,workerThread:t,backlog:this.jobQueue.length}),s=new Xd(i.name,t),t.onMessage=function(e){return i.onMessage(s,e.type,e.payload)},t.onError=function(e){return i.onError(s,e)},i.onStart(s),e.prev=12,e.next=15,s.result;case 15:return e.prev=15,this.returnWorkerToQueue(t),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[12,,15,18]])}))),function(){return t.apply(this,arguments)})},{key:"returnWorkerToQueue",value:function(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}},{key:"_getAvailableWorker",value:function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;var e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new ef({name:e,source:this.source,url:this.url})}return null}},{key:"_getMaxConcurrency",value:function(){return Vd?this.maxMobileConcurrency:this.maxConcurrency}}],[{key:"isSupported",value:function(){return ef.isSupported()}}]),e}(),sf={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:function(){}},rf=function(){function e(t){w(this,e),Wd(this,"props",void 0),Wd(this,"workerPools",new Map),this.props=l({},sf),this.setProps(t),this.workerPools=new Map}return I(e,[{key:"destroy",value:function(){var e,t=n(this.workerPools.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(e){t.e(e)}finally{t.f()}this.workerPools=new Map}},{key:"setProps",value:function(e){this.props=l(l({},this.props),e);var t,i=n(this.workerPools.values());try{for(i.s();!(t=i.n()).done;){t.value.setProps(this._getWorkerPoolProps())}}catch(e){i.e(e)}finally{i.f()}}},{key:"getWorkerPool",value:function(e){var t=e.name,i=e.source,s=e.url,r=this.workerPools.get(t);return r||((r=new tf({name:t,source:i,url:s})).setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}},{key:"_getWorkerPoolProps",value:function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}],[{key:"isSupported",value:function(){return ef.isSupported()}},{key:"getWorkerFarm",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e._workerFarm=e._workerFarm||new e({}),e._workerFarm.setProps(t),e._workerFarm}}]),e}();Wd(rf,"_workerFarm",void 0);function nf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t[e.id]||{},s="".concat(e.id,"-worker.js"),r=i.workerUrl;if(r||"compression"!==e.id||(r=t.workerUrl),"test"===t._workerType&&(r="modules/".concat(e.module,"/dist/").concat(s)),!r){var n=e.version;"latest"===n&&(n="latest");var o=n?"@".concat(n):"";r="https://unpkg.com/@loaders.gl/".concat(e.module).concat(o,"/dist/").concat(s)}return Nd(r),r}function of(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"3.2.6";Nd(e,"no worker provided");var i=e.version;return!(!t||!i)}var af=Object.freeze({__proto__:null,default:{}}),uf={};function hf(e){return lf.apply(this,arguments)}function lf(){return lf=u(o().mark((function e(t){var i,s,r=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.length>1&&void 0!==r[1]?r[1]:null,s=r.length>2&&void 0!==r[2]?r[2]:{},i&&(t=cf(t,i,s)),uf[t]=uf[t]||pf(t),e.next=6,uf[t];case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)}))),lf.apply(this,arguments)}function cf(e,t,i){if(e.startsWith("http"))return e;var s=i.modules||{};return s[e]?s[e]:Hd?i.CDN?(Nd(i.CDN.startsWith("http")),"".concat(i.CDN,"/").concat(t,"@").concat("3.2.6","/dist/libs/").concat(e)):Ud?"../src/libs/".concat(e):"modules/".concat(t,"/src/libs/").concat(e):"modules/".concat(t,"/dist/libs/").concat(e)}function pf(e){return df.apply(this,arguments)}function df(){return(df=u(o().mark((function e(t){var i,s,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.endsWith("wasm")){e.next=7;break}return e.next=3,fetch(t);case 3:return i=e.sent,e.next=6,i.arrayBuffer();case 6:return e.abrupt("return",e.sent);case 7:if(Hd){e.next=20;break}if(e.prev=8,e.t0=af&&void 0,!e.t0){e.next=14;break}return e.next=13,(void 0)(t);case 13:e.t0=e.sent;case 14:return e.abrupt("return",e.t0);case 17:return e.prev=17,e.t1=e.catch(8),e.abrupt("return",null);case 20:if(!Ud){e.next=22;break}return e.abrupt("return",importScripts(t));case 22:return e.next=24,fetch(t);case 24:return s=e.sent,e.next=27,s.text();case 27:return r=e.sent,e.abrupt("return",ff(r,t));case 29:case"end":return e.stop()}}),e,null,[[8,17]])})))).apply(this,arguments)}function ff(e,t){if(Hd){if(Ud)return eval.call(Gd,e),null;var i=document.createElement("script");i.id=t;try{i.appendChild(document.createTextNode(e))}catch(t){i.text=e}return document.body.appendChild(i),null}}function mf(e,t){return!!rf.isSupported()&&(!!(Hd||null!=t&&t._nodeWorkers)&&(e.worker&&(null==t?void 0:t.worker)))}function vf(e,t,i,s,r){return gf.apply(this,arguments)}function gf(){return gf=u(o().mark((function e(t,i,s,r,n){var a,u,h,l,c,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.id,u=nf(t,s),h=rf.getWorkerFarm(s),l=h.getWorkerPool({name:a,url:u}),s=JSON.parse(JSON.stringify(s)),r=JSON.parse(JSON.stringify(r||{})),e.next=8,l.startJob("process-on-worker",_f.bind(null,n));case 8:return(c=e.sent).postMessage("process",{input:i,options:s,context:r}),e.next=12,c.result;case 12:return p=e.sent,e.next=15,p.result;case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e)}))),gf.apply(this,arguments)}function _f(e,t,i,s){return yf.apply(this,arguments)}function yf(){return(yf=u(o().mark((function e(t,i,s,r){var n,a,u,h,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=s,e.next="done"===e.t0?3:"error"===e.t0?5:"process"===e.t0?7:20;break;case 3:return i.done(r),e.abrupt("break",21);case 5:return i.error(new Error(r.error)),e.abrupt("break",21);case 7:return n=r.id,a=r.input,u=r.options,e.prev=8,e.next=11,t(a,u);case 11:h=e.sent,i.postMessage("done",{id:n,result:h}),e.next=19;break;case 15:e.prev=15,e.t1=e.catch(8),l=e.t1 instanceof Error?e.t1.message:"unknown error",i.postMessage("error",{id:n,error:l});case 19:return e.abrupt("break",21);case 20:console.warn("parse-with-worker unknown message ".concat(s));case 21:case"end":return e.stop()}}),e,null,[[8,15]])})))).apply(this,arguments)}function bf(e,t,i){if(e.byteLength<=t+i)return"";for(var s=new DataView(e),r="",n=0;n<i;n++)r+=String.fromCharCode(s.getUint8(t+n));return r}function xf(e){try{return JSON.parse(e)}catch(t){throw new Error('Failed to parse JSON from data starting with "'.concat(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return bf(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return bf(e,0,t)}return""}(e),'"'))}}function Pf(e){return e&&"object"===T(e)&&e.isBuffer}function Tf(e){if(Pf(e))return Pf(t=e)?new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer:t;var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){var i=e;return(new TextEncoder).encode(i).buffer}if(e&&"object"===T(e)&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function wf(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var s,r=t.map((function(e){return e instanceof ArrayBuffer?new Uint8Array(e):e})),o=r.reduce((function(e,t){return e+t.byteLength}),0),a=new Uint8Array(o),u=0,h=n(r);try{for(h.s();!(s=h.n()).done;){var l=s.value;a.set(l,u),u+=l.byteLength}}catch(e){h.e(e)}finally{h.f()}return a.buffer}function Mf(e,t,i){var s=void 0!==i?new Uint8Array(e).subarray(t,t+i):new Uint8Array(e).subarray(t);return new Uint8Array(s).buffer}function If(e,t){return Od(e>=0),Od(t>0),e+(t-1)&~(t-1)}function Cf(e,t,i){var s;if(e instanceof ArrayBuffer)s=new Uint8Array(e);else{var r=e.byteOffset,n=e.byteLength;s=new Uint8Array(e.buffer||e.arrayBuffer,r,n)}return t.set(s,i),i+If(s.byteLength,4)}function Df(e){return Af.apply(this,arguments)}function Af(){return(Af=u(o().mark((function e(t){var i,s,r,n,a,u,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],s=!1,r=!1,e.prev=3,a=E(t);case 5:return e.next=7,a.next();case 7:if(!(s=!(u=e.sent).done)){e.next=13;break}h=u.value,i.push(h);case 10:s=!1,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),r=!0,n=e.t0;case 19:if(e.prev=19,e.prev=20,!s||null==a.return){e.next=24;break}return e.next=24,a.return();case 24:if(e.prev=24,!r){e.next=27;break}throw n;case 27:return e.finish(24);case 28:return e.finish(19);case 29:return e.abrupt("return",wf.apply(void 0,i));case 30:case"end":return e.stop()}}),e,null,[[3,15,19,29],[20,,24,28]])})))).apply(this,arguments)}var kf={};function Ef(e){for(var t in kf)if(e.startsWith(t)){var i=kf[t];e=e.replace(t,i)}return e.startsWith("http://")||e.startsWith("https://")||(e="".concat("").concat(e)),e}var Ff=function(e){return"function"==typeof e},Rf=function(e){return null!==e&&"object"===T(e)},Sf=function(e){return Rf(e)&&e.constructor==={}.constructor},Of=function(e){return e&&"function"==typeof e[Symbol.iterator]},Bf=function(e){return e&&"function"==typeof e[Symbol.asyncIterator]},Lf=function(e){return"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json},Nf=function(e){return"undefined"!=typeof Blob&&e instanceof Blob},jf=function(e){return function(e){return"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||Rf(e)&&Ff(e.tee)&&Ff(e.cancel)&&Ff(e.getReader)}(e)||function(e){return Rf(e)&&Ff(e.read)&&Ff(e.pipe)&&function(e){return"boolean"==typeof e}(e.readable)}(e)},Gf=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Hf=/^([-\w.]+\/[-\w.+]+)/;function Uf(e){var t=Hf.exec(e);return t?t[1]:e}function Vf(e){var t=Gf.exec(e);return t?t[1]:""}var zf=/\?.*/;function Wf(e){if(Lf(e)){var t=Yf(e.url||"");return{url:t,type:Uf(e.headers.get("content-type")||"")||Vf(t)}}return Nf(e)?{url:Yf(e.name||""),type:e.type||""}:"string"==typeof e?{url:Yf(e),type:Vf(e)}:{url:"",type:""}}function Xf(e){return Lf(e)?e.headers["content-length"]||-1:Nf(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}function Yf(e){return e.replace(zf,"")}function Kf(e){return Jf.apply(this,arguments)}function Jf(){return(Jf=u(o().mark((function e(t){var i,s,r,n,a,u,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Lf(t)){e.next=2;break}return e.abrupt("return",t);case 2:return i={},(s=Xf(t))>=0&&(i["content-length"]=String(s)),r=Wf(t),n=r.url,(a=r.type)&&(i["content-type"]=a),e.next=9,em(t);case 9:return(u=e.sent)&&(i["x-first-bytes"]=u),"string"==typeof t&&(t=(new TextEncoder).encode(t)),h=new Response(t,{headers:i}),Object.defineProperty(h,"url",{value:n}),e.abrupt("return",h);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zf(e){return Qf.apply(this,arguments)}function Qf(){return(Qf=u(o().mark((function e(t){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ok){e.next=5;break}return e.next=3,qf(t);case 3:throw i=e.sent,new Error(i);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qf(e){return $f.apply(this,arguments)}function $f(){return($f=u(o().mark((function e(t){var i,s,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): "),e.prev=1,s=t.headers.get("Content-Type"),r=t.statusText,!s.includes("application/json")){e.next=11;break}return e.t0=r,e.t1=" ",e.next=9,t.text();case 9:e.t2=e.sent,r=e.t0+=e.t1.concat.call(e.t1,e.t2);case 11:i=(i+=r).length>60?"".concat(i.slice(0,60),"..."):i,e.next=17;break;case 15:e.prev=15,e.t3=e.catch(1);case 17:return e.abrupt("return",i);case 18:case"end":return e.stop()}}),e,null,[[1,15]])})))).apply(this,arguments)}function em(e){return tm.apply(this,arguments)}function tm(){return(tm=u(o().mark((function e(t){var i,s,r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=5,"string"!=typeof t){e.next=3;break}return e.abrupt("return","data:,".concat(t.slice(0,i)));case 3:if(!(t instanceof Blob)){e.next=8;break}return s=t.slice(0,5),e.next=7,new Promise((function(e){var t=new FileReader;t.onload=function(t){var i;return e(null==t||null===(i=t.target)||void 0===i?void 0:i.result)},t.readAsDataURL(s)}));case 7:return e.abrupt("return",e.sent);case 8:if(!(t instanceof ArrayBuffer)){e.next=12;break}return r=t.slice(0,i),n=im(r),e.abrupt("return","data:base64,".concat(n));case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function im(e){for(var t="",i=new Uint8Array(e),s=0;s<i.byteLength;s++)t+=String.fromCharCode(i[s]);return btoa(t)}function sm(e,t){return rm.apply(this,arguments)}function rm(){return(rm=u(o().mark((function e(t,i){var s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}return t=Ef(t),s=i,null!=i&&i.fetch&&"function"!=typeof(null==i?void 0:i.fetch)&&(s=i.fetch),e.next=6,fetch(t,s);case 6:case 9:return e.abrupt("return",e.sent);case 7:return e.next=9,Kf(t);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var nm={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"===("undefined"==typeof process?"undefined":T(process))&&process},om=nm.window||nm.self||nm.global,am=nm.process||{},um="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source",hm=!("object"===("undefined"==typeof process?"undefined":T(process))&&"[object process]"===String(process)&&!process.browser)||function(e){if("undefined"!=typeof window&&"object"===T(window.process)&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"===T(process.versions)&&Boolean(process.versions.electron))return!0;var t="object"===("undefined"==typeof navigator?"undefined":T(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,i=e||t;return!!(i&&i.indexOf("Electron")>=0)}();function lm(e){try{var t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch(e){return null}}var cm=function(){function e(t,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";w(this,e),this.storage=lm(s),this.id=t,this.config={},Object.assign(this.config,i),this._loadConfiguration()}return I(e,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(e){return this.config={},this.updateConfiguration(e)}},{key:"updateConfiguration",value:function(e){if(Object.assign(this.config,e),this.storage){var t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}},{key:"_loadConfiguration",value:function(){var e={};if(this.storage){var t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}]),e}();function pm(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,r=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>s&&(i=Math.min(i,s/e.width));var n=e.width*i,o=e.height*i,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(n/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(n,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}var dm={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function fm(e){return"string"==typeof e?dm[e.toUpperCase()]||dm.WHITE:e}function mm(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],s=Object.getPrototypeOf(e),r=Object.getOwnPropertyNames(s),o=n(r);try{var a=function(){var s=t.value;"function"==typeof e[s]&&(i.find((function(e){return s===e}))||(e[s]=e[s].bind(e)))};for(o.s();!(t=o.n()).done;)a()}catch(e){o.e(e)}finally{o.f()}}function vm(e,t){if(!e)throw new Error(t||"Assertion failed")}function gm(){var e;if(hm&&om.performance)e=om.performance.now();else if(am.hrtime){var t=am.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}var _m={debug:hm&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},ym={enabled:!0,level:0};function bm(){}var xm={},Pm={once:!0};function Tm(e){for(var t in e)for(var i in e[t])return i||"untitled";return"empty"}var wm=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""},i=t.id;w(this,e),this.id=i,this.VERSION=um,this._startTs=gm(),this._deltaTs=gm(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new cm("__probe-".concat(this.id,"__"),ym),this.userData={},this.timeStamp("".concat(this.id," started")),mm(this),Object.seal(this)}return I(e,[{key:"level",get:function(){return this.getLevel()},set:function(e){this.setLevel(e)}},{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((gm()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((gm()-this._deltaTs).toPrecision(10))}},{key:"priority",get:function(){return this.level},set:function(e){this.level=e}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:e}),this}},{key:"setLevel",value:function(e){return this._storage.updateConfiguration({level:e}),this}},{key:"assert",value:function(e,t){vm(e,t)}},{key:"warn",value:function(e){return this._getLogFunction(0,e,_m.warn,arguments,Pm)}},{key:"error",value:function(e){return this._getLogFunction(0,e,_m.error,arguments)}},{key:"deprecated",value:function(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}},{key:"removed",value:function(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}},{key:"probe",value:function(e,t){return this._getLogFunction(e,t,_m.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(e,t){return this._getLogFunction(e,t,_m.debug,arguments)}},{key:"info",value:function(e,t){return this._getLogFunction(e,t,console.info,arguments)}},{key:"once",value:function(e,t){return this._getLogFunction(e,t,_m.debug||_m.info,arguments,Pm)}},{key:"table",value:function(e,t,i){return t?this._getLogFunction(e,t,console.table||bm,i&&[i],{tag:Tm(t)}):bm}},{key:"image",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){var t=e.logLevel,i=e.priority,s=e.image,n=e.message,o=void 0===n?"":n,a=e.scale,u=void 0===a?1:a;return this._shouldLog(t||i)?hm?function(e){var t=e.image,i=e.message,s=void 0===i?"":i,n=e.scale,o=void 0===n?1:n;if("string"==typeof t){var a=new Image;return a.onload=function(){var e,t=pm(a,s,o);(e=console).log.apply(e,r(t))},a.src=t,bm}var u=t.nodeName||"";if("img"===u.toLowerCase()){var h;return(h=console).log.apply(h,r(pm(t,s,o))),bm}if("canvas"===u.toLowerCase()){var l=new Image;return l.onload=function(){var e;return(e=console).log.apply(e,r(pm(l,s,o)))},l.src=t.toDataURL(),bm}return bm}({image:s,message:o,scale:u}):function(e){var t=e.image,i=(e.message,e.scale),s=void 0===i?1:i,r=null;try{r=module.require("asciify-image")}catch(e){}if(r)return function(){return r(t,{fit:"box",width:"".concat(Math.round(80*s),"%")}).then((function(e){return console.log(e)}))};return bm}({image:s,message:o,scale:u}):bm}))},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"get",value:function(e){return this._storage.config[e]}},{key:"set",value:function(e,t){this._storage.updateConfiguration(c({},e,t))}},{key:"time",value:function(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}},{key:"timeEnd",value:function(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(e,t){return this._getLogFunction(e,t,console.timeStamp||bm)}},{key:"group",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},s=i=Im({logLevel:e,message:t,opts:i}),r=s.collapsed;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}},{key:"groupCollapsed",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(e,t,Object.assign({},i,{collapsed:!0}))}},{key:"groupEnd",value:function(e){return this._getLogFunction(e,"",console.groupEnd||bm)}},{key:"withGroup",value:function(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(e){return this.isEnabled()&&this.getLevel()>=Mm(e)}},{key:"_getLogFunction",value:function(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],n=arguments.length>4?arguments[4]:void 0;if(this._shouldLog(e)){var o;n=Im({logLevel:e,message:t,args:s,opts:n}),vm(i=i||n.method),n.total=this.getTotal(),n.delta=this.getDelta(),this._deltaTs=gm();var a=n.tag||n.message;if(n.once){if(xm[a])return bm;xm[a]=gm()}return t=Cm(this.id,n.message,n),(o=i).bind.apply(o,[console,t].concat(r(n.args)))}return bm}}]),e}();function Mm(e){if(!e)return 0;var t;switch(T(e)){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return vm(Number.isFinite(t)&&t>=0),t}function Im(e){var t=e.logLevel,i=e.message;e.logLevel=Mm(t);for(var s=e.args?Array.from(e.args):[];s.length&&s.shift()!==i;);switch(e.args=s,T(t)){case"string":case"function":void 0!==i&&s.unshift(i),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());var r=T(e.message);return vm("string"===r||"object"===r),Object.assign(e,e.opts)}function Cm(e,t,i){if("string"==typeof t){var s=i.time?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,i=Math.max(t-e.length,0);return"".concat(" ".repeat(i)).concat(e)}((r=i.total)<10?"".concat(r.toFixed(2),"ms"):r<100?"".concat(r.toFixed(1),"ms"):r<1e3?"".concat(r.toFixed(0),"ms"):"".concat((r/1e3).toFixed(2),"s")):"";t=function(e,t,i){return hm||"string"!=typeof e||(t&&(t=fm(t),e="[".concat(t,"m").concat(e,"[39m")),i&&(t=fm(i),e="[".concat(i+10,"m").concat(e,"[49m"))),e}(t=i.time?"".concat(e,": ").concat(s,"  ").concat(t):"".concat(e,": ").concat(t),i.color,i.background)}var r;return t}wm.VERSION=um;var Dm=new wm({id:"loaders.gl"}),Am=function(){function e(){w(this,e)}return I(e,[{key:"log",value:function(){return function(){}}},{key:"info",value:function(){return function(){}}},{key:"warn",value:function(){return function(){}}},{key:"error",value:function(){return function(){}}}]),e}(),km={fetch:null,mimeType:void 0,nothrow:!1,log:new(function(){function e(){w(this,e),Wd(this,"console",void 0),this.console=console}return I(e,[{key:"log",value:function(){for(var e,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return(e=this.console.log).bind.apply(e,[this.console].concat(i))}},{key:"info",value:function(){for(var e,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return(e=this.console.info).bind.apply(e,[this.console].concat(i))}},{key:"warn",value:function(){for(var e,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return(e=this.console.warn).bind.apply(e,[this.console].concat(i))}},{key:"error",value:function(){for(var e,t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return(e=this.console.error).bind.apply(e,[this.console].concat(i))}}]),e}()),CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Bd,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Em={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Fm(){globalThis.loaders=globalThis.loaders||{};var e=globalThis.loaders;return e._state=e._state||{},e._state}var Rm=function(){var e=Fm();return e.globalOptions=e.globalOptions||l({},km),e.globalOptions};function Sm(e,t,i,s){return i=i||[],function(e,t){Bm(e,null,km,Em,t);var i,s=n(t);try{for(s.s();!(i=s.n()).done;){var r=i.value,o=e&&e[r.id]||{},a=r.options&&r.options[r.id]||{},u=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};Bm(o,r.id,a,u,t)}}catch(e){s.e(e)}finally{s.f()}}(e,i=Array.isArray(i)?i:[i]),function(e,t,i){var s=l({},e.options||{});(function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)})(s,i),null===s.log&&(s.log=new Am);return Nm(s,Rm()),Nm(s,t),s}(t,e,s)}function Om(e,t){var i=Rm(),s=e||i;return"function"==typeof s.fetch?s.fetch:Rf(s.fetch)?function(e){return sm(e,s)}:null!=t&&t.fetch?null==t?void 0:t.fetch:sm}function Bm(e,t,i,s,r){var n=t||"Top level",o=t?"".concat(t,"."):"";for(var a in e){var u=!t&&Rf(e[a]);if(!(a in i)&&!("baseUri"===a&&!t)&&!("workerUrl"===a&&t))if(a in s)Dm.warn("".concat(n," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(s[a],"'"))();else if(!u){var h=Lm(a,r);Dm.warn("".concat(n," loader option '").concat(o).concat(a,"' not recognized. ").concat(h))()}}}function Lm(e,t){var i,s=e.toLowerCase(),r="",o=n(t);try{for(o.s();!(i=o.n()).done;){var a=i.value;for(var u in a.options){if(e===u)return"Did you mean '".concat(a.id,".").concat(u,"'?");var h=u.toLowerCase();(s.startsWith(h)||h.startsWith(s))&&(r=r||"Did you mean '".concat(a.id,".").concat(u,"'?"))}}}catch(e){o.e(e)}finally{o.f()}return r}function Nm(e,t){for(var i in t)if(i in t){var s=t[i];Sf(s)&&Sf(e[i])?e[i]=l(l({},e[i]),t[i]):e[i]=t[i]}}function jm(e){var t;return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions))}function Gm(e){var t,i,s;return Od(e,"null loader"),Od(jm(e),"invalid loader"),Array.isArray(e)&&(s=e[1],e=l(l({},e=e[0]),{},{options:l(l({},e.options),s)})),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(i=e)&&void 0!==i&&i.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}function Hm(){return(e=Fm()).loaderRegistry=e.loaderRegistry||[],e.loaderRegistry;var e}function Um(){return!("object"===("undefined"==typeof process?"undefined":T(process))&&"[object process]"===String(process)&&!process.browser)||function(e){if("undefined"!=typeof window&&"object"===T(window.process)&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"===T(process.versions)&&Boolean(process.versions.electron))return!0;var t="object"===("undefined"==typeof navigator?"undefined":T(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,i=e||t;return!!(i&&i.indexOf("Electron")>=0)}()}var Vm={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"===("undefined"==typeof process?"undefined":T(process))&&process},zm=Vm.window||Vm.self||Vm.global,Wm=Vm.process||{},Xm="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";function Ym(e){try{var t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),t}catch(e){return null}}Um();var Km,Jm=function(){function e(t){w(this,e);var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";Wd(this,"storage",void 0),Wd(this,"id",void 0),Wd(this,"config",{}),this.storage=Ym(s),this.id=t,this.config={},Object.assign(this.config,i),this._loadConfiguration()}return I(e,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(e){return this.config={},this.updateConfiguration(e)}},{key:"updateConfiguration",value:function(e){if(Object.assign(this.config,e),this.storage){var t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}},{key:"_loadConfiguration",value:function(){var e={};if(this.storage){var t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}]),e}();function Zm(e,t,i){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,r=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>s&&(i=Math.min(i,s/e.width));var n=e.width*i,o=e.height*i,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(n/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(r,");"),"background-size:".concat(n,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}function Qm(e){return"string"==typeof e?Km[e.toUpperCase()]||Km.WHITE:e}function qm(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],s=Object.getPrototypeOf(e),r=Object.getOwnPropertyNames(s),o=n(r);try{var a=function(){var s=t.value;"function"==typeof e[s]&&(i.find((function(e){return s===e}))||(e[s]=e[s].bind(e)))};for(o.s();!(t=o.n()).done;)a()}catch(e){o.e(e)}finally{o.f()}}function $m(e,t){if(!e)throw new Error(t||"Assertion failed")}function ev(){var e,t,i;if(Um&&"performance"in zm)e=null==zm||null===(t=zm.performance)||void 0===t||null===(i=t.now)||void 0===i?void 0:i.call(t);else if("hrtime"in Wm){var s,r=null==Wm||null===(s=Wm.hrtime)||void 0===s?void 0:s.call(Wm);e=1e3*r[0]+r[1]/1e6}else e=Date.now();return e}!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(Km||(Km={}));var tv={debug:Um&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},iv={enabled:!0,level:0};function sv(){}var rv={},nv={once:!0},ov=function(){function e(){w(this,e);var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""},i=t.id;Wd(this,"id",void 0),Wd(this,"VERSION",Xm),Wd(this,"_startTs",ev()),Wd(this,"_deltaTs",ev()),Wd(this,"_storage",void 0),Wd(this,"userData",{}),Wd(this,"LOG_THROTTLE_TIMEOUT",0),this.id=i,this._storage=new Jm("__probe-".concat(this.id,"__"),iv),this.userData={},this.timeStamp("".concat(this.id," started")),qm(this),Object.seal(this)}return I(e,[{key:"level",get:function(){return this.getLevel()},set:function(e){this.setLevel(e)}},{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((ev()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((ev()-this._deltaTs).toPrecision(10))}},{key:"priority",get:function(){return this.level},set:function(e){this.level=e}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:e}),this}},{key:"setLevel",value:function(e){return this._storage.updateConfiguration({level:e}),this}},{key:"get",value:function(e){return this._storage.config[e]}},{key:"set",value:function(e,t){this._storage.updateConfiguration(c({},e,t))}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"assert",value:function(e,t){$m(e,t)}},{key:"warn",value:function(e){return this._getLogFunction(0,e,tv.warn,arguments,nv)}},{key:"error",value:function(e){return this._getLogFunction(0,e,tv.error,arguments)}},{key:"deprecated",value:function(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}},{key:"removed",value:function(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}},{key:"probe",value:function(e,t){return this._getLogFunction(e,t,tv.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(e,t){return this._getLogFunction(e,t,tv.debug,arguments)}},{key:"info",value:function(e,t){return this._getLogFunction(e,t,console.info,arguments)}},{key:"once",value:function(e,t){for(var i=arguments.length,s=new Array(i>2?i-2:0),r=2;r<i;r++)s[r-2]=arguments[r];return this._getLogFunction(e,t,tv.debug||tv.info,arguments,nv)}},{key:"table",value:function(e,t,i){return t?this._getLogFunction(e,t,console.table||sv,i&&[i],{tag:hv(t)}):sv}},{key:"image",value:function(e){var t=e.logLevel,i=e.priority,s=e.image,n=e.message,o=void 0===n?"":n,a=e.scale,u=void 0===a?1:a;return this._shouldLog(t||i)?Um?function(e){var t=e.image,i=e.message,s=void 0===i?"":i,n=e.scale,o=void 0===n?1:n;if("string"==typeof t){var a=new Image;return a.onload=function(){var e,t=Zm(a,s,o);(e=console).log.apply(e,r(t))},a.src=t,sv}var u=t.nodeName||"";if("img"===u.toLowerCase()){var h;return(h=console).log.apply(h,r(Zm(t,s,o))),sv}if("canvas"===u.toLowerCase()){var l=new Image;return l.onload=function(){var e;return(e=console).log.apply(e,r(Zm(l,s,o)))},l.src=t.toDataURL(),sv}return sv}({image:s,message:o,scale:u}):function(e){var t=e.image,i=(e.message,e.scale),s=void 0===i?1:i,r=null;try{r=module.require("asciify-image")}catch(e){}if(r)return function(){return r(t,{fit:"box",width:"".concat(Math.round(80*s),"%")}).then((function(e){return console.log(e)}))};return sv}({image:s,message:o,scale:u}):sv}},{key:"time",value:function(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}},{key:"timeEnd",value:function(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(e,t){return this._getLogFunction(e,t,console.timeStamp||sv)}},{key:"group",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},s=uv({logLevel:e,message:t,opts:i}),r=i.collapsed;return s.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}},{key:"groupCollapsed",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(e,t,Object.assign({},i,{collapsed:!0}))}},{key:"groupEnd",value:function(e){return this._getLogFunction(e,"",console.groupEnd||sv)}},{key:"withGroup",value:function(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(e){return this.isEnabled()&&this.getLevel()>=av(e)}},{key:"_getLogFunction",value:function(e,t,i,s,n){if(this._shouldLog(e)){var o;n=uv({logLevel:e,message:t,args:s,opts:n}),$m(i=i||n.method),n.total=this.getTotal(),n.delta=this.getDelta(),this._deltaTs=ev();var a=n.tag||n.message;if(n.once){if(rv[a])return sv;rv[a]=ev()}return t=function(e,t,i){if("string"==typeof t){var s=i.time?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,i=Math.max(t-e.length,0);return"".concat(" ".repeat(i)).concat(e)}((r=i.total)<10?"".concat(r.toFixed(2),"ms"):r<100?"".concat(r.toFixed(1),"ms"):r<1e3?"".concat(r.toFixed(0),"ms"):"".concat((r/1e3).toFixed(2),"s")):"";t=function(e,t,i){return Um||"string"!=typeof e||(t&&(t=Qm(t),e="[".concat(t,"m").concat(e,"[39m")),i&&(t=Qm(i),e="[".concat(i+10,"m").concat(e,"[49m"))),e}(t=i.time?"".concat(e,": ").concat(s,"  ").concat(t):"".concat(e,": ").concat(t),i.color,i.background)}var r;return t}(this.id,n.message,n),(o=i).bind.apply(o,[console,t].concat(r(n.args)))}return sv}}]),e}();function av(e){if(!e)return 0;var t;switch(T(e)){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return $m(Number.isFinite(t)&&t>=0),t}function uv(e){var t=e.logLevel,i=e.message;e.logLevel=av(t);for(var s=e.args?Array.from(e.args):[];s.length&&s.shift()!==i;);switch(T(t)){case"string":case"function":void 0!==i&&s.unshift(i),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());var r=T(e.message);return $m("string"===r||"object"===r),Object.assign(e,{args:s},e.opts)}function hv(e){for(var t in e)for(var i in e[t])return i||"untitled";return"empty"}Wd(ov,"VERSION",Xm);var lv=new ov({id:"loaders.gl"}),cv=/\.([^.]+)$/;function pv(e){return dv.apply(this,arguments)}function dv(){return dv=u(o().mark((function e(t){var i,s,r,n,a=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=a.length>1&&void 0!==a[1]?a[1]:[],s=a.length>2?a[2]:void 0,r=a.length>3?a[3]:void 0,vv(t)){e.next=5;break}return e.abrupt("return",null);case 5:if(!(n=fv(t,i,l(l({},s),{},{nothrow:!0}),r))){e.next=8;break}return e.abrupt("return",n);case 8:if(!Nf(t)){e.next=13;break}return e.next=11,t.slice(0,10).arrayBuffer();case 11:t=e.sent,n=fv(t,i,s,r);case 13:if(n||null!=s&&s.nothrow){e.next=15;break}throw new Error(gv(t));case 15:return e.abrupt("return",n);case 16:case"end":return e.stop()}}),e)}))),dv.apply(this,arguments)}function fv(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;if(!vv(e))return null;if(t&&!Array.isArray(t))return Gm(t);var n,o=[];(t&&(o=o.concat(t)),null!=i&&i.ignoreRegisteredLoaders)||(n=o).push.apply(n,r(Hm()));_v(o);var a=mv(e,o,i,s);if(!(a||null!=i&&i.nothrow))throw new Error(gv(e));return a}function mv(e,t,i,s){var r,o=Wf(e),a=o.url,u=o.type,h=a||(null==s?void 0:s.url),l=null,c="";(null!=i&&i.mimeType&&(l=yv(t,null==i?void 0:i.mimeType),c="match forced by supplied MIME type ".concat(null==i?void 0:i.mimeType)),l=l||function(e,t){var i=t&&cv.exec(t),s=i&&i[1];return s?function(e,t){t=t.toLowerCase();var i,s=n(e);try{for(s.s();!(i=s.n()).done;){var r,o=i.value,a=n(o.extensions);try{for(a.s();!(r=a.n()).done;){if(r.value.toLowerCase()===t)return o}}catch(e){a.e(e)}finally{a.f()}}}catch(e){s.e(e)}finally{s.f()}return null}(e,s):null}(t,h),c=c||(l?"matched url ".concat(h):""),l=l||yv(t,u),c=c||(l?"matched MIME type ".concat(u):""),l=l||function(e,t){if(!t)return null;var i,s=n(e);try{for(s.s();!(i=s.n()).done;){var r=i.value;if("string"==typeof t){if(bv(t,r))return r}else if(ArrayBuffer.isView(t)){if(xv(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer){if(xv(t,0,r))return r}}}catch(e){s.e(e)}finally{s.f()}return null}(t,e),c=c||(l?"matched initial data ".concat(Pv(e)):""),l=l||yv(t,null==i?void 0:i.fallbackMimeType),c=c||(l?"matched fallback MIME type ".concat(u):""))&&lv.log(1,"selectLoader selected ".concat(null===(r=l)||void 0===r?void 0:r.name,": ").concat(c,"."));return l}function vv(e){return!(e instanceof Response&&204===e.status)}function gv(e){var t=Wf(e),i=t.url,s=t.type,r="No valid loader found (";r+=i?"".concat(function(e){var t=e&&e.lastIndexOf("/");return t>=0?e.substr(t+1):""}(i),", "):"no url provided, ",r+="MIME type: ".concat(s?'"'.concat(s,'"'):"not provided",", ");var n=e?Pv(e):"";return r+=n?' first bytes: "'.concat(n,'"'):"first bytes: not available",r+=")"}function _v(e){var t,i=n(e);try{for(i.s();!(t=i.n()).done;){Gm(t.value)}}catch(e){i.e(e)}finally{i.f()}}function yv(e,t){var i,s=n(e);try{for(s.s();!(i=s.n()).done;){var r=i.value;if(r.mimeTypes&&r.mimeTypes.includes(t))return r;if(t==="application/x.".concat(r.id))return r}}catch(e){s.e(e)}finally{s.f()}return null}function bv(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some((function(t){return e.startsWith(t)}))}function xv(e,t,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some((function(s){return function(e,t,i,s){if(s instanceof ArrayBuffer)return function(e,t,i){if(i=i||e.byteLength,e.byteLength<i||t.byteLength<i)return!1;for(var s=new Uint8Array(e),r=new Uint8Array(t),n=0;n<s.length;++n)if(s[n]!==r[n])return!1;return!0}(s,e,s.byteLength);switch(T(s)){case"function":return s(e,i);case"string":return s===Tv(e,t,s.length);default:return!1}}(e,t,i,s)}))}function Pv(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return Tv(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){var i=0;return Tv(e,i,t)}return""}function Tv(e,t,i){if(e.byteLength<t+i)return"";for(var s=new DataView(e),r="",n=0;n<i;n++)r+=String.fromCharCode(s.getUint8(t+n));return r}function wv(e,i){var s,r,n,a,u;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s=(null==i?void 0:i.chunkSize)||262144,r=0,n=new TextEncoder;case 3:if(!(r<e.length)){t.next=11;break}return a=Math.min(e.length-r,s),u=e.slice(r,r+a),r+=a,t.next=9,n.encode(u);case 9:t.next=3;break;case 11:case"end":return t.stop()}}),t)}function Mv(e){var t,s,r,n,a,u,h,l=arguments;return o().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:t=l.length>1&&void 0!==l[1]?l[1]:{},s=t.chunkSize,r=void 0===s?262144:s,n=0;case 3:if(!(n<e.byteLength)){i.next=14;break}return a=Math.min(e.byteLength-n,r),u=new ArrayBuffer(a),h=new Uint8Array(e,n,a),new Uint8Array(u).set(h),n+=a,i.next=12,u;case 12:i.next=3;break;case 14:case"end":return i.stop()}}),i)}function Iv(){return(Iv=D(o().mark((function e(t,i){var s,r,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=(null==i?void 0:i.chunkSize)||1048576,r=0;case 2:if(!(r<t.size)){e.next=12;break}return n=r+s,e.next=6,C(t.slice(r,n).arrayBuffer());case 6:return a=e.sent,r=n,e.next=10,a;case 10:e.next=2;break;case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Cv(e,t){return Bd?function(e,t){return Dv.apply(this,arguments)}(e,t):function(e,t){return Av.apply(this,arguments)}(e)}function Dv(){return(Dv=D(o().mark((function e(t,i){var s,r,n,a,u,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=t.getReader(),e.prev=1;case 2:return n=r||s.read(),null!=i&&i._streamReadAhead&&(r=s.read()),e.next=7,C(n);case 7:if(a=e.sent,u=a.done,h=a.value,!u){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,Tf(h);case 14:e.next=2;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(1),s.releaseLock();case 21:case"end":return e.stop()}}),e,null,[[1,18]])})))).apply(this,arguments)}function Av(){return(Av=D(o().mark((function e(t,i){var s,r,n,a,u,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=!1,r=!1,e.prev=2,a=E(t);case 4:return e.next=6,C(a.next());case 6:if(!(s=!(u=e.sent).done)){e.next=13;break}return h=u.value,e.next=10,Tf(h);case 10:s=!1,e.next=4;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),r=!0,n=e.t0;case 19:if(e.prev=19,e.prev=20,!s||null==a.return){e.next=24;break}return e.next=24,C(a.return());case 24:if(e.prev=24,!r){e.next=27;break}throw n;case 27:return e.finish(24);case 28:return e.finish(19);case 29:case"end":return e.stop()}}),e,null,[[2,15,19,29],[20,,24,28]])})))).apply(this,arguments)}function kv(e,t){if("string"==typeof e)return wv(e,t);if(e instanceof ArrayBuffer)return Mv(e,t);if(Nf(e))return function(e,t){return Iv.apply(this,arguments)}(e,t);if(jf(e))return Cv(e,t);if(Lf(e))return Cv(e.body,t);throw new Error("makeIterator")}var Ev="Cannot convert supplied data type";function Fv(e,t,i){if(t.text&&"string"==typeof e)return e;var s;if((s=e)&&"object"===T(s)&&s.isBuffer&&(e=e.buffer),e instanceof ArrayBuffer){var r=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);var n=e.buffer,o=e.byteLength||e.length;return 0===e.byteOffset&&o===n.byteLength||(n=n.slice(e.byteOffset,e.byteOffset+o)),n}throw new Error(Ev)}function Rv(e,t,i){return Sv.apply(this,arguments)}function Sv(){return(Sv=u(o().mark((function e(t,i,s){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t instanceof ArrayBuffer||ArrayBuffer.isView(t),"string"!=typeof t&&!r){e.next=3;break}return e.abrupt("return",Fv(t,i));case 3:if(!Nf(t)){e.next=7;break}return e.next=6,Kf(t);case 6:t=e.sent;case 7:if(!Lf(t)){e.next=21;break}return n=t,e.next=11,Zf(n);case 11:if(!i.binary){e.next=17;break}return e.next=14,n.arrayBuffer();case 14:e.t0=e.sent,e.next=20;break;case 17:return e.next=19,n.text();case 19:e.t0=e.sent;case 20:return e.abrupt("return",e.t0);case 21:if(jf(t)&&(t=kv(t,s)),!Of(t)&&!Bf(t)){e.next=24;break}return e.abrupt("return",Df(t));case 24:throw new Error(Ev);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ov(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(i)return i;var s=l({fetch:Om(t,e)},e);return Array.isArray(s.loaders)||(s.loaders=null),s}function Bv(e,t){if(!t&&e&&!Array.isArray(e))return e;var i;if(e&&(i=Array.isArray(e)?e:[e]),t&&t.loaders){var s=Array.isArray(t.loaders)?t.loaders:[t.loaders];i=i?[].concat(r(i),r(s)):s}return i&&i.length?i:null}function Lv(e,t,i,s){return Nv.apply(this,arguments)}function Nv(){return(Nv=u(o().mark((function e(t,i,s,r){var n,a,u,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Nd(!r||"object"===T(r)),!i||Array.isArray(i)||jm(i)||(r=void 0,s=i,i=void 0),e.next=4,t;case 4:return t=e.sent,s=s||{},n=Wf(t),a=n.url,u=Bv(i,r),e.next=11,pv(t,u,s);case 11:if(h=e.sent){e.next=14;break}return e.abrupt("return",null);case 14:return s=Sm(s,h,u,a),r=Ov({url:a,parse:Lv,loaders:u},s,r),e.next=18,jv(h,t,s,r);case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jv(e,t,i,s){return Gv.apply(this,arguments)}function Gv(){return(Gv=u(o().mark((function e(t,i,s,r){var n,a,u,h,l,c,p,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return of(t),Lf(i)&&(a=(n=i).ok,u=n.redirected,h=n.status,l=n.statusText,c=n.type,p=n.url,d=Object.fromEntries(n.headers.entries()),r.response={headers:d,ok:a,redirected:u,status:h,statusText:l,type:c,url:p}),e.next=4,Rv(i,t,s);case 4:if(i=e.sent,!t.parseTextSync||"string"!=typeof i){e.next=8;break}return s.dataType="text",e.abrupt("return",t.parseTextSync(i,s,r,t));case 8:if(!mf(t,s)){e.next=12;break}return e.next=11,vf(t,i,s,r,Lv);case 11:case 15:case 19:return e.abrupt("return",e.sent);case 12:if(!t.parseText||"string"!=typeof i){e.next=16;break}return e.next=15,t.parseText(i,s,r,t);case 16:if(!t.parse){e.next=20;break}return e.next=19,t.parse(i,s,r,t);case 20:throw Nd(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"));case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Hv,Uv,Vv="https://unpkg.com/@loaders.gl/textures@".concat("3.2.6","/dist/libs/basis_encoder.wasm"),zv="https://unpkg.com/@loaders.gl/textures@".concat("3.2.6","/dist/libs/basis_encoder.js");function Wv(e){return Xv.apply(this,arguments)}function Xv(){return(Xv=u(o().mark((function e(t){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=t.modules||{}).basis){e.next=3;break}return e.abrupt("return",i.basis);case 3:return Hv=Hv||Yv(t),e.next=6,Hv;case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yv(e){return Kv.apply(this,arguments)}function Kv(){return(Kv=u(o().mark((function e(t){var i,s,r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=null,s=null,e.t0=Promise,e.next=5,hf("basis_transcoder.js","textures",t);case 5:return e.t1=e.sent,e.next=8,hf("basis_transcoder.wasm","textures",t);case 8:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=12,e.t0.all.call(e.t0,e.t3);case 12:return r=e.sent,n=p(r,2),i=n[0],s=n[1],i=i||globalThis.BASIS,e.next=19,Jv(i,s);case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jv(e,t){var i={};return t&&(i.wasmBinary=t),new Promise((function(t){e(i).then((function(e){var i=e.BasisFile;(0,e.initializeBasis)(),t({BasisFile:i})}))}))}function Zv(e){return Qv.apply(this,arguments)}function Qv(){return(Qv=u(o().mark((function e(t){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=t.modules||{}).basisEncoder){e.next=3;break}return e.abrupt("return",i.basisEncoder);case 3:return Uv=Uv||qv(t),e.next=6,Uv;case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qv(e){return $v.apply(this,arguments)}function $v(){return($v=u(o().mark((function e(t){var i,s,r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=null,s=null,e.t0=Promise,e.next=5,hf(zv,"textures",t);case 5:return e.t1=e.sent,e.next=8,hf(Vv,"textures",t);case 8:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=12,e.t0.all.call(e.t0,e.t3);case 12:return r=e.sent,n=p(r,2),i=n[0],s=n[1],i=i||globalThis.BASIS,e.next=19,eg(i,s);case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function eg(e,t){var i={};return t&&(i.wasmBinary=t),new Promise((function(t){e(i).then((function(e){var i=e.BasisFile,s=e.KTX2File,r=e.initializeBasis,n=e.BasisEncoder;r(),t({BasisFile:i,KTX2File:s,BasisEncoder:n})}))}))}var tg,ig,sg,rg,ng,og,ag,ug,hg,lg=33776,cg=33779,pg=35840,dg=35842,fg=36196,mg=37808,vg=["","WEBKIT_","MOZ_"],gg={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"},_g=null;function yg(e){if(!_g){e=e||function(){try{return document.createElement("canvas").getContext("webgl")}catch(e){return null}}()||void 0,_g=new Set;var t,i=n(vg);try{for(i.s();!(t=i.n()).done;){var s=t.value;for(var r in gg)if(e&&e.getExtension("".concat(s).concat(r))){var o=gg[r];_g.add(o)}}}catch(e){i.e(e)}finally{i.f()}}return _g}(hg=tg||(tg={}))[hg.NONE=0]="NONE",hg[hg.BASISLZ=1]="BASISLZ",hg[hg.ZSTD=2]="ZSTD",hg[hg.ZLIB=3]="ZLIB",function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(ig||(ig={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(sg||(sg={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(rg||(rg={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(ng||(ng={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(og||(og={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(ag||(ag={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(ug||(ug={}));var bg=[171,75,84,88,32,50,48,187,13,10,26,10];function xg(e){var t=new Uint8Array(e);return!(t.byteLength<bg.length||t[0]!==bg[0]||t[1]!==bg[1]||t[2]!==bg[2]||t[3]!==bg[3]||t[4]!==bg[4]||t[5]!==bg[5]||t[6]!==bg[6]||t[7]!==bg[7]||t[8]!==bg[8]||t[9]!==bg[9]||t[10]!==bg[10]||t[11]!==bg[11])}var Pg={etc1:{basisFormat:0,compressed:!0,format:fg},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:lg},bc3:{basisFormat:3,compressed:!0,format:cg},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:pg},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:dg},"astc-4x4":{basisFormat:10,compressed:!0,format:mg},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function Tg(){return(Tg=u(o().mark((function e(t,i){var s,r,n,a,u,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("auto"!==i.basis.containerFormat){e.next=11;break}if(!xg(t)){e.next=6;break}return e.next=4,Zv(i);case 4:return s=e.sent,e.abrupt("return",Ig(s.KTX2File,t,i));case 6:return e.next=8,Wv(i);case 8:return r=e.sent,n=r.BasisFile,e.abrupt("return",wg(n,t,i));case 11:e.t0=i.basis.module,e.next="encoder"===e.t0?14:(e.t0,22);break;case 14:return e.next=16,Zv(i);case 16:a=e.sent,e.t1=i.basis.containerFormat,e.next="ktx2"===e.t1?20:(e.t1,21);break;case 20:return e.abrupt("return",Ig(a.KTX2File,t,i));case 21:return e.abrupt("return",wg(a.BasisFile,t,i));case 22:return e.next=24,Wv(i);case 24:return u=e.sent,h=u.BasisFile,e.abrupt("return",wg(h,t,i));case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wg(e,t,i){var s=new e(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("Failed to start basis transcoding");for(var r=s.getNumImages(),n=[],o=0;o<r;o++){for(var a=s.getNumLevels(o),u=[],h=0;h<a;h++)u.push(Mg(s,o,h,i));n.push(u)}return n}finally{s.close(),s.delete()}}function Mg(e,t,i,s){var r=e.getImageWidth(t,i),n=e.getImageHeight(t,i),o=e.getHasAlpha(),a=Dg(s,o),u=a.compressed,h=a.format,l=a.basisFormat,c=e.getImageTranscodedSizeInBytes(t,i,l),p=new Uint8Array(c);if(!e.transcodeImage(p,t,i,l,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:n,data:p,compressed:u,format:h,hasAlpha:o}}function Ig(e,t,i){var s=new e(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("failed to start KTX2 transcoding");for(var r=s.getLevels(),n=[],o=0;o<r;o++){n.push(Cg(s,o,i));break}return[n]}finally{s.close(),s.delete()}}function Cg(e,t,i){var s=e.getImageLevelInfo(t,0,0),r=s.alphaFlag,n=s.height,o=s.width,a=Dg(i,r),u=a.compressed,h=a.format,l=a.basisFormat,c=e.getImageTranscodedSizeInBytes(t,0,0,l),p=new Uint8Array(c);if(!e.transcodeImage(p,t,0,0,l,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:n,data:p,compressed:u,hasAlpha:r,format:h}}function Dg(e,t){var i=e&&e.basis&&e.basis.format;return"auto"===i&&(i=Ag()),"object"===T(i)&&(i=t?i.alpha:i.noAlpha),i=i.toLowerCase(),Pg[i]}function Ag(){var e=yg();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}var kg=l(l({},{name:"Basis",id:"basis",module:"textures",version:"3.2.6",worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}}),{},{parse:function(e,t){return Tg.apply(this,arguments)}}),Eg=globalThis._parseImageNode,Fg="undefined"!=typeof Image,Rg="undefined"!=typeof ImageBitmap,Sg=Boolean(Eg),Og=!!Bd||Sg;function Bg(e){var t=function(e){if("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return"imagebitmap";if("undefined"!=typeof Image&&e instanceof Image)return"image";if(e&&"object"===T(e)&&e.data&&e.width&&e.height)return"data";return null}(e);if(!t)throw new Error("Not an image");return t}function Lg(e){switch(Bg(e)){case"data":return e;case"image":case"imagebitmap":var t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("getImageData");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}var Ng=/^data:image\/svg\+xml/,jg=/\.svg((\?|#).*)?$/;function Gg(e){return e&&(Ng.test(e)||jg.test(e))}function Hg(e,t){if(Gg(t)){var i=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(i=unescape(encodeURIComponent(i)))}catch(e){throw new Error(e.message)}return"data:image/svg+xml;base64,".concat(btoa(i))}return Ug(e,t)}function Ug(e,t){if(Gg(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}function Vg(e,t,i){return zg.apply(this,arguments)}function zg(){return(zg=u(o().mark((function e(t,i,s){var r,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Hg(t,s),n=self.URL||self.webkitURL,a="string"!=typeof r&&n.createObjectURL(r),e.prev=3,e.next=6,Wg(a||r,i);case 6:return e.abrupt("return",e.sent);case 7:return e.prev=7,a&&n.revokeObjectURL(a),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[3,,7,10]])})))).apply(this,arguments)}function Wg(e,t){return Xg.apply(this,arguments)}function Xg(){return Xg=u(o().mark((function e(t,i){var s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((s=new Image).src=t,!(i.image&&i.image.decode&&s.decode)){e.next=6;break}return e.next=5,s.decode();case 5:return e.abrupt("return",s);case 6:return e.next=8,new Promise((function(e,i){try{s.onload=function(){return e(s)},s.onerror=function(e){return i(new Error("Could not load image ".concat(t,": ").concat(e)))}}catch(e){i(e)}}));case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)}))),Xg.apply(this,arguments)}var Yg={},Kg=!0;function Jg(e,t,i){return Zg.apply(this,arguments)}function Zg(){return(Zg=u(o().mark((function e(t,i,s){var r,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Gg(s)){e.next=7;break}return e.next=3,Vg(t,i,s);case 3:n=e.sent,r=n,e.next=8;break;case 7:r=Ug(t,s);case 8:return a=i&&i.imagebitmap,e.next=11,Qg(r,a);case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qg(e){return qg.apply(this,arguments)}function qg(){return qg=u(o().mark((function e(t){var i,s=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!$g(i=s.length>1&&void 0!==s[1]?s[1]:null)&&Kg||(i=null),!i){e.next=13;break}return e.prev=3,e.next=6,createImageBitmap(t,i);case 6:return e.abrupt("return",e.sent);case 9:e.prev=9,e.t0=e.catch(3),console.warn(e.t0),Kg=!1;case 13:return e.next=15,createImageBitmap(t);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,null,[[3,9]])}))),qg.apply(this,arguments)}function $g(e){for(var t in e||Yg)return!1;return!0}function e_(e){var t=t_(e);return function(e){var t=t_(e);if(!(t.byteLength>=24&&2303741511===t.getUint32(0,false)))return null;return{mimeType:"image/png",width:t.getUint32(16,false),height:t.getUint32(20,false)}}(t)||function(e){var t=t_(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,false)&&255===t.getUint8(2)))return null;var i=function(){for(var e=new Set([65499,65476,65484,65501,65534]),t=65504;t<65520;++t)e.add(t);var i=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:i}}(),s=i.tableMarkers,r=i.sofMarkers,n=2;for(;n+9<t.byteLength;){var o=t.getUint16(n,false);if(r.has(o))return{mimeType:"image/jpeg",height:t.getUint16(n+5,false),width:t.getUint16(n+7,false)};if(!s.has(o))return null;n+=2,n+=t.getUint16(n,false)}return null}(t)||function(e){var t=t_(e);if(!(t.byteLength>=10&&1195984440===t.getUint32(0,false)))return null;return{mimeType:"image/gif",width:t.getUint16(6,true),height:t.getUint16(8,true)}}(t)||function(e){var t=t_(e);if(!(t.byteLength>=14&&16973===t.getUint16(0,false)&&t.getUint32(2,true)===t.byteLength))return null;return{mimeType:"image/bmp",width:t.getUint32(18,true),height:t.getUint32(22,true)}}(t)}function t_(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}function i_(e,t){return s_.apply(this,arguments)}function s_(){return s_=u(o().mark((function e(t,i){var s,r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=e_(t)||{},r=s.mimeType,Od(n=globalThis._parseImageNode),e.next=5,n(t,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)}))),s_.apply(this,arguments)}function r_(){return(r_=u(o().mark((function e(t,i,s){var r,n,a,u,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(i=i||{}).image||{},n=r.type||"auto",a=(s||{}).url,u=n_(n),e.t0=u,e.next="imagebitmap"===e.t0?8:"image"===e.t0?12:"data"===e.t0?16:20;break;case 8:return e.next=10,Jg(t,i,a);case 10:return h=e.sent,e.abrupt("break",21);case 12:return e.next=14,Vg(t,i,a);case 14:return h=e.sent,e.abrupt("break",21);case 16:return e.next=18,i_(t);case 18:return h=e.sent,e.abrupt("break",21);case 20:Od(!1);case 21:return"data"===n&&(h=Lg(h)),e.abrupt("return",h);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function n_(e){switch(e){case"auto":case"data":return function(){if(Rg)return"imagebitmap";if(Fg)return"image";if(Og)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return Rg||Fg||Og;case"imagebitmap":return Rg;case"image":return Fg;case"data":return Og;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}(e),e}}var o_={id:"image",module:"images",name:"Images",version:"3.2.6",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:function(e,t,i){return r_.apply(this,arguments)},tests:[function(e){return Boolean(e_(new DataView(e)))}],options:{image:{type:"auto",decode:!0}}},a_=["image/png","image/jpeg","image/gif"],u_={};function h_(e){return void 0===u_[e]&&(u_[e]=function(e){switch(e){case"image/webp":return function(){if(!Bd)return!1;try{return 0===document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")}catch(e){return!1}}();case"image/svg":return Bd;default:if(!Bd){var t=globalThis._parseImageNode;return Boolean(t)&&a_.includes(e)}return!0}}(e)),u_[e]}function l_(e,t){if(!e)throw new Error(t||"assert failed: gltf")}function c_(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;var i=t.baseUri||t.uri;if(!i)throw new Error("'baseUri' must be provided to resolve relative url ".concat(e));return i.substr(0,i.lastIndexOf("/")+1)+e}function p_(e,t,i){var s=e.bufferViews[i];l_(s);var r=t[s.buffer];l_(r);var n=(s.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,s.byteLength)}var d_=["SCALAR","VEC2","VEC3","VEC4"],f_=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],m_=new Map(f_),v_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},g_={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},__={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function y_(e){return d_[e-1]||d_[0]}function b_(e){var t=m_.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function x_(e,t){var i=__[e.componentType],s=v_[e.type],r=g_[e.componentType],n=e.count*s,o=e.count*s*r;return l_(o>=0&&o<=t.byteLength),{ArrayType:i,length:n,byteLength:o}}var P_,T_={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]},w_=function(){function e(t){w(this,e),Wd(this,"gltf",void 0),Wd(this,"sourceBuffers",void 0),Wd(this,"byteLength",void 0),this.gltf=t||{json:l({},T_),buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}return I(e,[{key:"json",get:function(){return this.gltf.json}},{key:"getApplicationData",value:function(e){return this.json[e]}},{key:"getExtraData",value:function(e){return(this.json.extras||{})[e]}},{key:"getExtension",value:function(e){var t=this.getUsedExtensions().find((function(t){return t===e})),i=this.json.extensions||{};return t?i[e]||!0:null}},{key:"getRequiredExtension",value:function(e){var t=this.getRequiredExtensions().find((function(t){return t===e}));return t?this.getExtension(e):null}},{key:"getRequiredExtensions",value:function(){return this.json.extensionsRequired||[]}},{key:"getUsedExtensions",value:function(){return this.json.extensionsUsed||[]}},{key:"getObjectExtension",value:function(e,t){return(e.extensions||{})[t]}},{key:"getScene",value:function(e){return this.getObject("scenes",e)}},{key:"getNode",value:function(e){return this.getObject("nodes",e)}},{key:"getSkin",value:function(e){return this.getObject("skins",e)}},{key:"getMesh",value:function(e){return this.getObject("meshes",e)}},{key:"getMaterial",value:function(e){return this.getObject("materials",e)}},{key:"getAccessor",value:function(e){return this.getObject("accessors",e)}},{key:"getTexture",value:function(e){return this.getObject("textures",e)}},{key:"getSampler",value:function(e){return this.getObject("samplers",e)}},{key:"getImage",value:function(e){return this.getObject("images",e)}},{key:"getBufferView",value:function(e){return this.getObject("bufferViews",e)}},{key:"getBuffer",value:function(e){return this.getObject("buffers",e)}},{key:"getObject",value:function(e,t){if("object"===T(t))return t;var i=this.json[e]&&this.json[e][t];if(!i)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return i}},{key:"getTypedArrayForBufferView",value:function(e){var t=(e=this.getBufferView(e)).buffer,i=this.gltf.buffers[t];l_(i);var s=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,s,e.byteLength)}},{key:"getTypedArrayForAccessor",value:function(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,s=x_(e,t),r=s.ArrayType,n=s.length;return new r(i,t.byteOffset+e.byteOffset,n)}},{key:"getTypedArrayForImageData",value:function(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),i=this.getBuffer(t.buffer).data,s=t.byteOffset||0;return new Uint8Array(i,s,t.byteLength)}},{key:"addApplicationData",value:function(e,t){return this.json[e]=t,this}},{key:"addExtraData",value:function(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}},{key:"addObjectExtension",value:function(e,t,i){return e.extensions=e.extensions||{},e.extensions[t]=i,this.registerUsedExtension(t),this}},{key:"setObjectExtension",value:function(e,t,i){(e.extensions||{})[t]=i}},{key:"removeObjectExtension",value:function(e,t){var i=e.extensions||{},s=i[t];return delete i[t],s}},{key:"addExtension",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l_(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}},{key:"addRequiredExtension",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l_(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}},{key:"registerUsedExtension",value:function(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((function(t){return t===e}))||this.json.extensionsUsed.push(e)}},{key:"registerRequiredExtension",value:function(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((function(t){return t===e}))||this.json.extensionsRequired.push(e)}},{key:"removeExtension",value:function(e){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e]}},{key:"setDefaultScene",value:function(e){this.json.scene=e}},{key:"addScene",value:function(e){var t=e.nodeIndices;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}},{key:"addNode",value:function(e){var t=e.meshIndex,i=e.matrix;this.json.nodes=this.json.nodes||[];var s={mesh:t};return i&&(s.matrix=i),this.json.nodes.push(s),this.json.nodes.length-1}},{key:"addMesh",value:function(e){var t=e.attributes,i=e.indices,s=e.material,r=e.mode,n=void 0===r?4:r,o={primitives:[{attributes:this._addAttributes(t),mode:n}]};if(i){var a=this._addIndices(i);o.primitives[0].indices=a}return Number.isFinite(s)&&(o.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}},{key:"addPointCloud",value:function(e){var t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}},{key:"addImage",value:function(e,t){var i=e_(e),s=t||(null==i?void 0:i.mimeType),r={bufferView:this.addBufferView(e),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}},{key:"addBufferView",value:function(e){var t=e.byteLength;l_(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);var i={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=If(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}},{key:"addAccessor",value:function(e,t){var i={bufferView:e,type:y_(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}},{key:"addBinaryBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{size:3},i=this.addBufferView(e),s={min:t.min,max:t.max};s.min&&s.max||(s=this._getAccessorMinMax(e,t.size));var r={size:t.size,componentType:b_(e),count:Math.round(e.length/t.size),min:s.min,max:s.max};return this.addAccessor(i,Object.assign(r,t))}},{key:"addTexture",value:function(e){var t={source:e.imageIndex};return this.json.textures=this.json.textures||[],this.json.textures.push(t),this.json.textures.length-1}},{key:"addMaterial",value:function(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}},{key:"createBinaryChunk",value:function(){var e,t;this.gltf.buffers=[];var i,s=this.byteLength,r=new ArrayBuffer(s),o=new Uint8Array(r),a=0,u=n(this.sourceBuffers||[]);try{for(u.s();!(i=u.n()).done;){a=Cf(i.value,o,a)}}catch(e){u.e(e)}finally{u.f()}null!==(e=this.json)&&void 0!==e&&null!==(t=e.buffers)&&void 0!==t&&t[0]?this.json.buffers[0].byteLength=s:this.json.buffers=[{byteLength:s}],this.gltf.binary=r,this.sourceBuffers=[r]}},{key:"_removeStringFromArray",value:function(e,t){for(var i=!0;i;){var s=e.indexOf(t);s>-1?e.splice(s,1):i=!1}}},{key:"_addAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};for(var i in e){var s=e[i],r=this._getGltfAttributeName(i),n=this.addBinaryBuffer(s.value,s);t[r]=n}return t}},{key:"_addIndices",value:function(e){return this.addBinaryBuffer(e,{size:1})}},{key:"_getGltfAttributeName",value:function(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}},{key:"_getAccessorMinMax",value:function(e,t){var i={min:null,max:null};if(e.length<t)return i;i.min=[],i.max=[];var s,r=n(e.subarray(0,t));try{for(r.s();!(s=r.n()).done;){var o=s.value;i.min.push(o),i.max.push(o)}}catch(e){r.e(e)}finally{r.f()}for(var a=t;a<e.length;a+=t)for(var u=0;u<t;u++)i.min[0+u]=Math.min(i.min[0+u],e[a+u]),i.max[0+u]=Math.max(i.max[0+u],e[a+u]);return i}}]),e}(),M_="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",I_="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",C_=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),D_=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),A_={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},k_={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};function E_(e,t,i,s,r){return F_.apply(this,arguments)}function F_(){return F_=u(o().mark((function e(t,i,s,r,n){var a,u,h=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=h.length>5&&void 0!==h[5]?h[5]:"NONE",e.next=3,R_();case 3:N_(u=e.sent,u.exports[k_[n]],t,i,s,r,u.exports[A_[a||"NONE"]]);case 5:case"end":return e.stop()}}),e)}))),F_.apply(this,arguments)}function R_(){return S_.apply(this,arguments)}function S_(){return(S_=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P_||(P_=O_()),e.abrupt("return",P_);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O_(){return B_.apply(this,arguments)}function B_(){return(B_=u(o().mark((function e(){var t,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=M_,WebAssembly.validate(C_)&&(t=I_,console.log("Warning: meshopt_decoder is using experimental SIMD support")),e.next=4,WebAssembly.instantiate(L_(t),{});case 4:return i=e.sent,e.next=7,i.instance.exports.__wasm_call_ctors();case 7:return e.abrupt("return",i.instance);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L_(e){for(var t=new Uint8Array(e.length),i=0;i<e.length;++i){var s=e.charCodeAt(i);t[i]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}for(var r=0,n=0;n<e.length;++n)t[r++]=t[n]<60?D_[t[n]]:64*(t[n]-60)+t[++n];return t.buffer.slice(0,r)}function N_(e,t,i,s,r,n,o){var a=e.exports.sbrk,u=s+3&-4,h=a(u*r),l=a(n.length),c=new Uint8Array(e.exports.memory.buffer);c.set(n,l);var p=t(h,s,r,l,n.length);if(0===p&&o&&o(h,u,r),i.set(c.subarray(h,h+s*r)),a(h-a(0)),0!==p)throw new Error("Malformed buffer data: ".concat(p))}function j_(){return(j_=u(o().mark((function e(t,i){var s,r,a,u,h,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new w_(t),null!=i&&null!==(s=i.gltf)&&void 0!==s&&s.decompressMeshes){e.next=3;break}return e.abrupt("return");case 3:a=[],u=n(t.json.bufferViews||[]);try{for(u.s();!(h=u.n()).done;)l=h.value,a.push(G_(r,l))}catch(e){u.e(e)}finally{u.f()}return e.next=8,Promise.all(a);case 8:r.removeExtension("EXT_meshopt_compression");case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G_(e,t){return H_.apply(this,arguments)}function H_(){return(H_=u(o().mark((function e(t,i){var s,r,n,a,u,h,l,c,p,d,f,m,v,g;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(s=t.getObjectExtension(i,"EXT_meshopt_compression"))){e.next=9;break}return r=s.byteOffset,n=void 0===r?0:r,a=s.byteLength,u=void 0===a?0:a,h=s.byteStride,l=s.count,c=s.mode,p=s.filter,d=void 0===p?"NONE":p,f=s.buffer,m=t.gltf.buffers[f],v=new Uint8Array(m.arrayBuffer,m.byteOffset+n,u),g=new Uint8Array(t.gltf.buffers[i.buffer].arrayBuffer,i.byteOffset,i.byteLength),e.next=8,E_(g,l,h,v,c,d);case 8:return e.abrupt("return",g);case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U_=Object.freeze({__proto__:null,name:"EXT_meshopt_compression",decode:function(e,t){return j_.apply(this,arguments)}});var V_=Object.freeze({__proto__:null,name:"EXT_texture_webp",preprocess:function(e,t){var i=new w_(e);if(h_("image/webp")){var s,r=n(i.json.textures||[]);try{for(r.s();!(s=r.n()).done;){var o=s.value,a=i.getObjectExtension(o,"EXT_texture_webp");a&&(o.source=a.source),i.removeObjectExtension(o,"EXT_texture_webp")}}catch(e){r.e(e)}finally{r.f()}i.removeExtension("EXT_texture_webp")}else if(i.getRequiredExtensions().includes("EXT_texture_webp"))throw new Error("gltf: Required extension ".concat("EXT_texture_webp"," not supported by browser"))}});var z_=Object.freeze({__proto__:null,name:"KHR_texture_basisu",preprocess:function(e,t){var i,s=new w_(e),r=n(s.json.textures||[]);try{for(r.s();!(i=r.n()).done;){var o=i.value,a=s.getObjectExtension(o,"KHR_texture_basisu");a&&(o.source=a.source),s.removeObjectExtension(o,"KHR_texture_basisu")}}catch(e){r.e(e)}finally{r.f()}s.removeExtension("KHR_texture_basisu")}}),W_={name:"Draco",id:"draco",module:"draco",shapes:["mesh"],version:"3.2.6",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"===("undefined"==typeof WebAssembly?"undefined":T(WebAssembly))?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function X_(e){for(var t=1/0,i=1/0,s=1/0,r=-1/0,n=-1/0,o=-1/0,a=e.POSITION?e.POSITION.value:[],u=a&&a.length,h=0;h<u;h+=3){var l=a[h],c=a[h+1],p=a[h+2];t=l<t?l:t,i=c<i?c:i,s=p<s?p:s,r=l>r?l:r,n=c>n?c:n,o=p>o?p:o}return[[t,i,s],[r,n,o]]}var Y_=function(){function e(t,i){w(this,e),Wd(this,"fields",void 0),Wd(this,"metadata",void 0),function(e,t){if(!e)throw new Error(t||"loader assertion failed.")}(Array.isArray(t)),function(e){var t,i={},s=n(e);try{for(s.s();!(t=s.n()).done;){var r=t.value;i[r.name]&&console.warn("Schema: duplicated field name",r.name,r),i[r.name]=!0}}catch(e){s.e(e)}finally{s.f()}}(t),this.fields=t,this.metadata=i||new Map}return I(e,[{key:"compareTo",value:function(e){if(this.metadata!==e.metadata)return!1;if(this.fields.length!==e.fields.length)return!1;for(var t=0;t<this.fields.length;++t)if(!this.fields[t].compareTo(e.fields[t]))return!1;return!0}},{key:"select",value:function(){for(var t=Object.create(null),i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];for(var n=0,o=s;n<o.length;n++){var a=o[n];t[a]=!0}var u=this.fields.filter((function(e){return t[e.name]}));return new e(u,this.metadata)}},{key:"selectAt",value:function(){for(var t=this,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];var n=s.map((function(e){return t.fields[e]})).filter(Boolean);return new e(n,this.metadata)}},{key:"assign",value:function(t){var i,s=this.metadata;if(t instanceof e){var r=t;i=r.fields,s=K_(K_(new Map,this.metadata),r.metadata)}else i=t;var o,a=Object.create(null),u=n(this.fields);try{for(u.s();!(o=u.n()).done;){var h=o.value;a[h.name]=h}}catch(e){u.e(e)}finally{u.f()}var l,c=n(i);try{for(c.s();!(l=c.n()).done;){var p=l.value;a[p.name]=p}}catch(e){c.e(e)}finally{c.f()}return new e(Object.values(a),s)}}]),e}();function K_(e,t){return new Map([].concat(r(e||new Map),r(t||new Map)))}var J_,Z_=function(){function e(t,i){var s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map;w(this,e),Wd(this,"name",void 0),Wd(this,"type",void 0),Wd(this,"nullable",void 0),Wd(this,"metadata",void 0),this.name=t,this.type=i,this.nullable=s,this.metadata=r}return I(e,[{key:"typeId",get:function(){return this.type&&this.type.typeId}},{key:"clone",value:function(){return new e(this.name,this.type,this.nullable,this.metadata)}},{key:"compareTo",value:function(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}},{key:"toString",value:function(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}]),e}();!function(e){e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.Float=3]="Float",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct=13]="Struct",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Dictionary=-1]="Dictionary",e[e.Int8=-2]="Int8",e[e.Int16=-3]="Int16",e[e.Int32=-4]="Int32",e[e.Int64=-5]="Int64",e[e.Uint8=-6]="Uint8",e[e.Uint16=-7]="Uint16",e[e.Uint32=-8]="Uint32",e[e.Uint64=-9]="Uint64",e[e.Float16=-10]="Float16",e[e.Float32=-11]="Float32",e[e.Float64=-12]="Float64",e[e.DateDay=-13]="DateDay",e[e.DateMillisecond=-14]="DateMillisecond",e[e.TimestampSecond=-15]="TimestampSecond",e[e.TimestampMillisecond=-16]="TimestampMillisecond",e[e.TimestampMicrosecond=-17]="TimestampMicrosecond",e[e.TimestampNanosecond=-18]="TimestampNanosecond",e[e.TimeSecond=-19]="TimeSecond",e[e.TimeMillisecond=-20]="TimeMillisecond",e[e.TimeMicrosecond=-21]="TimeMicrosecond",e[e.TimeNanosecond=-22]="TimeNanosecond",e[e.DenseUnion=-23]="DenseUnion",e[e.SparseUnion=-24]="SparseUnion",e[e.IntervalDayTime=-25]="IntervalDayTime",e[e.IntervalYearMonth=-26]="IntervalYearMonth"}(J_||(J_={}));var Q_=function(){function e(){w(this,e)}return I(e,[{key:"typeId",get:function(){return J_.NONE}},{key:"compareTo",value:function(e){return this===e}}],[{key:"isNull",value:function(e){return e&&e.typeId===J_.Null}},{key:"isInt",value:function(e){return e&&e.typeId===J_.Int}},{key:"isFloat",value:function(e){return e&&e.typeId===J_.Float}},{key:"isBinary",value:function(e){return e&&e.typeId===J_.Binary}},{key:"isUtf8",value:function(e){return e&&e.typeId===J_.Utf8}},{key:"isBool",value:function(e){return e&&e.typeId===J_.Bool}},{key:"isDecimal",value:function(e){return e&&e.typeId===J_.Decimal}},{key:"isDate",value:function(e){return e&&e.typeId===J_.Date}},{key:"isTime",value:function(e){return e&&e.typeId===J_.Time}},{key:"isTimestamp",value:function(e){return e&&e.typeId===J_.Timestamp}},{key:"isInterval",value:function(e){return e&&e.typeId===J_.Interval}},{key:"isList",value:function(e){return e&&e.typeId===J_.List}},{key:"isStruct",value:function(e){return e&&e.typeId===J_.Struct}},{key:"isUnion",value:function(e){return e&&e.typeId===J_.Union}},{key:"isFixedSizeBinary",value:function(e){return e&&e.typeId===J_.FixedSizeBinary}},{key:"isFixedSizeList",value:function(e){return e&&e.typeId===J_.FixedSizeList}},{key:"isMap",value:function(e){return e&&e.typeId===J_.Map}},{key:"isDictionary",value:function(e){return e&&e.typeId===J_.Dictionary}}]),e}(),q_=function(e,t){g(s,Q_);var i=y(s);function s(e,t){var r;return w(this,s),Wd(x(r=i.call(this)),"isSigned",void 0),Wd(x(r),"bitWidth",void 0),r.isSigned=e,r.bitWidth=t,r}return I(s,[{key:"typeId",get:function(){return J_.Int}},{key:t,get:function(){return"Int"}},{key:"toString",value:function(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}]),s}(0,Symbol.toStringTag),$_=function(e){g(i,q_);var t=y(i);function i(){return w(this,i),t.call(this,!0,8)}return I(i)}(),ey=function(e){g(i,q_);var t=y(i);function i(){return w(this,i),t.call(this,!0,16)}return I(i)}(),ty=function(e){g(i,q_);var t=y(i);function i(){return w(this,i),t.call(this,!0,32)}return I(i)}(),iy=function(e){g(i,q_);var t=y(i);function i(){return w(this,i),t.call(this,!1,8)}return I(i)}(),sy=function(e){g(i,q_);var t=y(i);function i(){return w(this,i),t.call(this,!1,16)}return I(i)}(),ry=function(e){g(i,q_);var t=y(i);function i(){return w(this,i),t.call(this,!1,32)}return I(i)}(),ny=32,oy=64,ay=function(e,t){g(s,Q_);var i=y(s);function s(e){var t;return w(this,s),Wd(x(t=i.call(this)),"precision",void 0),t.precision=e,t}return I(s,[{key:"typeId",get:function(){return J_.Float}},{key:t,get:function(){return"Float"}},{key:"toString",value:function(){return"Float".concat(this.precision)}}]),s}(0,Symbol.toStringTag),uy=function(e){g(i,ay);var t=y(i);function i(){return w(this,i),t.call(this,ny)}return I(i)}(),hy=function(e){g(i,ay);var t=y(i);function i(){return w(this,i),t.call(this,oy)}return I(i)}(),ly=function(e,t){g(s,Q_);var i=y(s);function s(e,t){var r;return w(this,s),Wd(x(r=i.call(this)),"listSize",void 0),Wd(x(r),"children",void 0),r.listSize=e,r.children=[t],r}return I(s,[{key:"typeId",get:function(){return J_.FixedSizeList}},{key:"valueType",get:function(){return this.children[0].type}},{key:"valueField",get:function(){return this.children[0]}},{key:t,get:function(){return"FixedSizeList"}},{key:"toString",value:function(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}]),s}(0,Symbol.toStringTag);function cy(e,t,i){var s=function(e){switch(e.constructor){case Int8Array:return new $_;case Uint8Array:return new iy;case Int16Array:return new ey;case Uint16Array:return new sy;case Int32Array:return new ty;case Uint32Array:return new ry;case Float32Array:return new uy;case Float64Array:return new hy;default:throw new Error("array type not supported")}}(t.value),r=i||function(e){var t=new Map;"byteOffset"in e&&t.set("byteOffset",e.byteOffset.toString(10));"byteStride"in e&&t.set("byteStride",e.byteStride.toString(10));"normalized"in e&&t.set("normalized",e.normalized.toString());return t}(t);return new Z_(e,new ly(t.size,new Z_("value",s)),!1,r)}function py(e,t,i){var s=fy(t.metadata),r=[],n=function(e){var t={};for(var i in e){var s=e[i];t[s.name||"undefined"]=s}return t}(t.attributes);for(var o in e){var a=dy(o,e[o],n[o]);r.push(a)}if(i){var u=dy("indices",i);r.push(u)}return new Y_(r,s)}function dy(e,t,i){return cy(e,t,i?fy(i.metadata):void 0)}function fy(e){var t=new Map;for(var i in e)t.set("".concat(i,".string"),JSON.stringify(e[i]));return t}var my={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},vy={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},gy=function(){function e(t){w(this,e),Wd(this,"draco",void 0),Wd(this,"decoder",void 0),Wd(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}return I(e,[{key:"destroy",value:function(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}},{key:"parseSync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);var s=this.decoder.GetEncodedGeometryType(i),r=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{var n;switch(s){case this.draco.TRIANGULAR_MESH:n=this.decoder.DecodeBufferToMesh(i,r);break;case this.draco.POINT_CLOUD:n=this.decoder.DecodeBufferToPointCloud(i,r);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!n.ok()||!r.ptr){var o="DRACO decompression failed: ".concat(n.error_msg());throw new Error(o)}var a=this._getDracoLoaderData(r,s,t),u=this._getMeshData(r,a,t),h=X_(u.attributes),c=py(u.attributes,a,u.indices),p=l(l({loader:"draco",loaderData:a,header:{vertexCount:r.num_points(),boundingBox:h}},u),{},{schema:c});return p}finally{this.draco.destroy(i),r&&this.draco.destroy(r)}}},{key:"_getDracoLoaderData",value:function(e,t,i){var s=this._getTopLevelMetadata(e),r=this._getDracoAttributes(e,i);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:s,attributes:r}}},{key:"_getDracoAttributes",value:function(e,t){for(var i={},s=0;s<e.num_attributes();s++){var r=this.decoder.GetAttribute(e,s),n=this._getAttributeMetadata(e,s);i[r.unique_id()]={unique_id:r.unique_id(),attribute_type:r.attribute_type(),data_type:r.data_type(),num_components:r.num_components(),byte_offset:r.byte_offset(),byte_stride:r.byte_stride(),normalized:r.normalized(),attribute_index:s,metadata:n};var o=this._getQuantizationTransform(r,t);o&&(i[r.unique_id()].quantization_transform=o);var a=this._getOctahedronTransform(r,t);a&&(i[r.unique_id()].octahedron_transform=a)}return i}},{key:"_getMeshData",value:function(e,t,i){var s=this._getMeshAttributes(t,e,i);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");return e instanceof this.draco.Mesh?"triangle-strip"===i.topology?{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(e),size:1}}:{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(e),size:1}}:{topology:"point-list",mode:0,attributes:s}}},{key:"_getMeshAttributes",value:function(e,t,i){for(var s={},r=0,n=Object.values(e.attributes);r<n.length;r++){var o=n[r],a=this._deduceAttributeName(o,i);o.name=a;var u=this._getAttributeValues(t,o),h=u.value,l=u.size;s[a]={value:h,size:l,byteOffset:o.byte_offset,byteStride:o.byte_stride,normalized:o.normalized}}return s}},{key:"_getTriangleListIndices",value:function(e){var t=3*e.num_faces(),i=4*t,s=this.draco._malloc(i);try{return this.decoder.GetTrianglesUInt32Array(e,i,s),new Uint32Array(this.draco.HEAPF32.buffer,s,t).slice()}finally{this.draco._free(s)}}},{key:"_getTriangleStripIndices",value:function(e){var t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),function(e){for(var t=e.size(),i=new Int32Array(t),s=0;s<t;s++)i[s]=e.GetValue(s);return i}(t)}finally{this.draco.destroy(t)}}},{key:"_getAttributeValues",value:function(e,t){var i,s=vy[t.data_type],r=t.num_components,n=e.num_points()*r,o=n*s.BYTES_PER_ELEMENT,a=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}(this.draco,s),u=this.draco._malloc(o);try{var h=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,h,a,o,u),i=new s(this.draco.HEAPF32.buffer,u,n).slice()}finally{this.draco._free(u)}return{value:i,size:r}}},{key:"_deduceAttributeName",value:function(e,t){for(var i=e.unique_id,s=0,r=Object.entries(t.extraAttributes||{});s<r.length;s++){var n=p(r[s],2),o=n[0];if(n[1]===i)return o}var a=e.attribute_type;for(var u in my){if(this.draco[u]===a)return my[u]}var h=t.attributeNameEntry||"name";return e.metadata[h]?e.metadata[h].string:"CUSTOM_ATTRIBUTE_".concat(i)}},{key:"_getTopLevelMetadata",value:function(e){var t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}},{key:"_getAttributeMetadata",value:function(e,t){var i=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(i)}},{key:"_getDracoMetadata",value:function(e){if(!e||!e.ptr)return{};for(var t={},i=this.metadataQuerier.NumEntries(e),s=0;s<i;s++){var r=this.metadataQuerier.GetEntryName(e,s);t[r]=this._getDracoMetadataField(e,r)}return t}},{key:"_getDracoMetadataField",value:function(e,t){var i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,i);var s=function(e){for(var t=e.size(),i=new Int32Array(t),s=0;s<t;s++)i[s]=e.GetValue(s);return i}(i);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:s}}finally{this.draco.destroy(i)}}},{key:"_disableAttributeTransforms",value:function(e){var t,i=e.quantizedAttributes,s=void 0===i?[]:i,o=e.octahedronAttributes,a=void 0===o?[]:o,u=n([].concat(r(s),r(a)));try{for(u.s();!(t=u.n()).done;){var h=t.value;this.decoder.SkipAttributeTransform(this.draco[h])}}catch(e){u.e(e)}finally{u.f()}}},{key:"_getQuantizationTransform",value:function(e,t){var i=this,s=t.quantizedAttributes,r=void 0===s?[]:s,n=e.attribute_type();if(r.map((function(e){return i.decoder[e]})).includes(n)){var o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map((function(e){return o.min_value(e)}))}}finally{this.draco.destroy(o)}}return null}},{key:"_getOctahedronTransform",value:function(e,t){var i=this,s=t.octahedronAttributes,r=void 0===s?[]:s,n=e.attribute_type();if(r.map((function(e){return i.decoder[e]})).includes(n)){var o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}]),e}();var _y,yy="https://www.gstatic.com/draco/versioned/decoders/".concat("1.4.1","/draco_decoder.js"),by="https://www.gstatic.com/draco/versioned/decoders/".concat("1.4.1","/draco_wasm_wrapper.js"),xy="https://www.gstatic.com/draco/versioned/decoders/".concat("1.4.1","/draco_decoder.wasm");function Py(e){return Ty.apply(this,arguments)}function Ty(){return(Ty=u(o().mark((function e(t){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.modules||{},_y=i.draco3d?_y||i.draco3d.createDecoderModule({}).then((function(e){return{draco:e}})):_y||wy(t),e.next=4,_y;case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wy(e){return My.apply(this,arguments)}function My(){return(My=u(o().mark((function e(t){var i,s,r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.draco&&t.draco.decoderType,e.next="js"===e.t0?3:(e.t0,7);break;case 3:return e.next=5,hf(yy,"draco",t);case 5:return i=e.sent,e.abrupt("break",21);case 7:return e.t1=Promise,e.next=10,hf(by,"draco",t);case 10:return e.t2=e.sent,e.next=13,hf(xy,"draco",t);case 13:return e.t3=e.sent,e.t4=[e.t2,e.t3],e.next=17,e.t1.all.call(e.t1,e.t4);case 17:r=e.sent,n=p(r,2),i=n[0],s=n[1];case 21:return i=i||globalThis.DracoDecoderModule,e.next=24,Iy(i,s);case 24:return e.abrupt("return",e.sent);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Iy(e,t){var i={};return t&&(i.wasmBinary=t),new Promise((function(t){e(l(l({},i),{},{onModuleLoaded:function(e){return t({draco:e})}}))}))}var Cy=l(l({},W_),{},{parse:function(e,t){return Dy.apply(this,arguments)}});function Dy(){return(Dy=u(o().mark((function e(t,i){var s,r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Py(i);case 2:return s=e.sent,r=s.draco,n=new gy(r),e.prev=5,e.abrupt("return",n.parseSync(t,null==i?void 0:i.draco));case 7:return e.prev=7,n.destroy(),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[5,,7,10]])})))).apply(this,arguments)}function Ay(e){var t={};for(var i in e){var s=e[i];if("indices"!==i){var r=ky(s);t[i]=r}}return t}function ky(e){var t=function(e){var t=e,i=1,s=0;e&&e.value&&(t=e.value,i=e.size||1);t&&(ArrayBuffer.isView(t)||(t=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return null;if(Array.isArray(e))return new t(e);if(i&&!(e instanceof t))return new t(e);return e}(t,Float32Array)),s=t.length/i);return{buffer:t,size:i,count:s}}(e),i=t.buffer,s=t.size;return{value:i,size:s,byteOffset:0,count:t.count,type:y_(s),componentType:b_(i)}}function Ey(){return(Ey=u(o().mark((function e(t,i,s){var r,a,u,h,l,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=i&&null!==(r=i.gltf)&&void 0!==r&&r.decompressMeshes){e.next=2;break}return e.abrupt("return");case 2:a=new w_(t),u=[],h=n(By(a));try{for(h.s();!(l=h.n()).done;)c=l.value,a.getObjectExtension(c,"KHR_draco_mesh_compression")&&u.push(Fy(a,c,i,s))}catch(e){h.e(e)}finally{h.f()}return e.next=8,Promise.all(u);case 8:a.removeExtension("KHR_draco_mesh_compression");case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fy(e,t,i,s){return Ry.apply(this,arguments)}function Ry(){return Ry=u(o().mark((function e(t,i,s,r){var n,a,u,h,c,d,f,m,v,g,_,y,b,x;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getObjectExtension(i,"KHR_draco_mesh_compression")){e.next=3;break}return e.abrupt("return");case 3:return a=t.getTypedArrayForBufferView(n.bufferView),u=Mf(a.buffer,a.byteOffset),h=r.parse,delete(c=l({},s))["3d-tiles"],e.next=10,h(u,Cy,c,r);case 10:for(d=e.sent,f=Ay(d.attributes),m=0,v=Object.entries(f);m<v.length;m++)g=p(v[m],2),_=g[0],y=g[1],_ in i.attributes&&(b=i.attributes[_],null!=(x=t.getAccessor(b))&&x.min&&null!=x&&x.max&&(y.min=x.min,y.max=x.max));i.attributes=f,d.indices&&(i.indices=ky(d.indices)),Oy(i);case 16:case"end":return e.stop()}}),e)}))),Ry.apply(this,arguments)}function Sy(e,t){var i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,r=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;if(!r.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");var o=r.DracoWriter.encodeSync({attributes:e}),a=null==n||null===(i=n.parseSync)||void 0===i?void 0:i.call(n,{attributes:e}),u=r._addFauxAttributes(a.attributes),h=r.addBufferView(o),l={primitives:[{attributes:u,mode:s,extensions:c({},"KHR_draco_mesh_compression",{bufferView:h,attributes:u})}]};return l}function Oy(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function By(e){var t,i,r,a,u,h;return o().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:t=n(e.json.meshes||[]),s.prev=1,t.s();case 3:if((i=t.n()).done){s.next=24;break}r=i.value,a=n(r.primitives),s.prev=6,a.s();case 8:if((u=a.n()).done){s.next=14;break}return h=u.value,s.next=12,h;case 12:s.next=8;break;case 14:s.next=19;break;case 16:s.prev=16,s.t0=s.catch(6),a.e(s.t0);case 19:return s.prev=19,a.f(),s.finish(19);case 22:s.next=3;break;case 24:s.next=29;break;case 26:s.prev=26,s.t1=s.catch(1),t.e(s.t1);case 29:return s.prev=29,t.f(),s.finish(29);case 32:case"end":return s.stop()}}),s,null,[[1,26,29,32],[6,16,19,22]])}function Ly(){return(Ly=u(o().mark((function e(t){var i,s,r,a,u,h,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=new w_(t),s=i.json,(r=i.getExtension("KHR_lights_punctual"))&&(i.json.lights=r.lights,i.removeExtension("KHR_lights_punctual")),a=n(s.nodes||[]);try{for(a.s();!(u=a.n()).done;)h=u.value,(l=i.getObjectExtension(h,"KHR_lights_punctual"))&&(h.light=l.light),i.removeObjectExtension(h,"KHR_lights_punctual")}catch(e){a.e(e)}finally{a.f()}case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ny(){return(Ny=u(o().mark((function e(t){var i,s,r,a,u,h,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=new w_(t),(s=i.json).lights&&(l_(!(r=i.addExtension("KHR_lights_punctual")).lights),r.lights=s.lights,delete s.lights),i.json.lights){a=n(i.json.lights);try{for(a.s();!(u=a.n()).done;)h=u.value,l=h.node,i.addObjectExtension(l,"KHR_lights_punctual",h)}catch(e){a.e(e)}finally{a.f()}delete i.json.lights}case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jy(){return(jy=u(o().mark((function e(t){var i,s,r,a,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=new w_(t),s=i.json,i.removeExtension("KHR_materials_unlit"),r=n(s.materials||[]);try{for(r.s();!(a=r.n()).done;)u=a.value,u.extensions&&u.extensions.KHR_materials_unlit&&(u.unlit=!0),i.removeObjectExtension(u,"KHR_materials_unlit")}catch(e){r.e(e)}finally{r.f()}case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gy(){return(Gy=u(o().mark((function e(t){var i,s,r,a,u,h,l,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=new w_(t),s=i.json,r=i.getExtension("KHR_techniques_webgl")){a=Uy(r,i),u=n(s.materials||[]);try{for(u.s();!(h=u.n()).done;)l=h.value,(c=i.getObjectExtension(l,"KHR_techniques_webgl"))&&(l.technique=Object.assign({},c,a[c.technique]),l.technique.values=Vy(l.technique,i)),i.removeObjectExtension(l,"KHR_techniques_webgl")}catch(e){u.e(e)}finally{u.f()}i.removeExtension("KHR_techniques_webgl")}case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Hy(){return(Hy=u(o().mark((function e(t,i){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Uy(e,t){var i=e.programs,s=void 0===i?[]:i,r=e.shaders,n=void 0===r?[]:r,o=e.techniques,a=void 0===o?[]:o,u=new TextDecoder;return n.forEach((function(e){if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=u.decode(t.getTypedArrayForBufferView(e.bufferView))})),s.forEach((function(e){e.fragmentShader=n[e.fragmentShader],e.vertexShader=n[e.vertexShader]})),a.forEach((function(e){e.program=s[e.program]})),a}function Vy(e,t){var i=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((function(t){e.uniforms[t].value&&!(t in i)&&(i[t]=e.uniforms[t].value)})),Object.keys(i).forEach((function(e){"object"===T(i[e])&&void 0!==i[e].index&&(i[e].texture=t.getTexture(i[e].index))})),i}var zy=[U_,V_,z_,Object.freeze({__proto__:null,name:"KHR_draco_mesh_compression",preprocess:function(e,t,i){var s,r=new w_(e),o=n(By(r));try{for(o.s();!(s=o.n()).done;){var a=s.value;r.getObjectExtension(a,"KHR_draco_mesh_compression")}}catch(e){o.e(e)}finally{o.f()}},decode:function(e,t,i){return Ey.apply(this,arguments)},encode:function(e){var t,i=new w_(e),s=n(i.json.meshes||[]);try{for(s.s();!(t=s.n()).done;){var r=t.value;Sy(r),i.addRequiredExtension("KHR_draco_mesh_compression")}}catch(e){s.e(e)}finally{s.f()}}}),Object.freeze({__proto__:null,name:"KHR_lights_punctual",decode:function(e){return Ly.apply(this,arguments)},encode:function(e){return Ny.apply(this,arguments)}}),Object.freeze({__proto__:null,name:"KHR_materials_unlit",decode:function(e){return jy.apply(this,arguments)},encode:function(e){var t=new w_(e),i=t.json;if(t.materials){var s,r=n(i.materials||[]);try{for(r.s();!(s=r.n()).done;){var o=s.value;o.unlit&&(delete o.unlit,t.addObjectExtension(o,"KHR_materials_unlit",{}),t.addExtension("KHR_materials_unlit"))}}catch(e){r.e(e)}finally{r.f()}}}}),Object.freeze({__proto__:null,name:"KHR_techniques_webgl",decode:function(e){return Gy.apply(this,arguments)},encode:function(e,t){return Hy.apply(this,arguments)}})];function Wy(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0,r=zy.filter((function(e){return Ky(e.name,i)})),o=n(r);try{for(o.s();!(t=o.n()).done;){var a,u=t.value;null===(a=u.preprocess)||void 0===a||a.call(u,e,i,s)}}catch(e){o.e(e)}finally{o.f()}}function Xy(e){return Yy.apply(this,arguments)}function Yy(){return Yy=u(o().mark((function e(t){var i,s,r,a,u,h,l,c=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=c.length>1&&void 0!==c[1]?c[1]:{},s=c.length>2?c[2]:void 0,r=zy.filter((function(e){return Ky(e.name,i)})),a=n(r),e.prev=4,a.s();case 6:if((u=a.n()).done){e.next=12;break}return h=u.value,e.next=10,null===(l=h.decode)||void 0===l?void 0:l.call(h,t,i,s);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),a.e(e.t0);case 17:return e.prev=17,a.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,14,17,20]])}))),Yy.apply(this,arguments)}function Ky(e,t){var i,s=(null==t||null===(i=t.gltf)||void 0===i?void 0:i.excludeExtensions)||{};return!(e in s&&!s[e])}var Jy={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Zy={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"},Qy=function(){function e(){w(this,e),Wd(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),Wd(this,"json",void 0)}return I(e,[{key:"normalize",value:function(e,t){this.json=e.json;var i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn("glTF: Unknown version ".concat(i.asset.version))}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),function(e){var t,i=new w_(e),s=i.json,r=n(s.images||[]);try{for(r.s();!(t=r.n()).done;){var o=t.value,a=i.getObjectExtension(o,"KHR_binary_glTF");a&&Object.assign(o,a),i.removeObjectExtension(o,"KHR_binary_glTF")}}catch(e){r.e(e)}finally{r.f()}s.buffers&&s.buffers[0]&&delete s.buffers[0].uri,i.removeExtension("KHR_binary_glTF")}(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}},{key:"_addAsset",value:function(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}},{key:"_convertTopLevelObjectsToArrays",value:function(e){for(var t in Jy)this._convertTopLevelObjectToArray(e,t)}},{key:"_convertTopLevelObjectToArray",value:function(e,t){var i=e[t];if(i&&!Array.isArray(i))for(var s in e[t]=[],i){var r=i[s];r.id=r.id||s;var n=e[t].length;e[t].push(r),this.idToIndexMap[t][s]=n}}},{key:"_convertObjectIdsToArrayIndices",value:function(e){for(var t in Jy)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));var i,s=n(e.textures);try{for(s.s();!(i=s.n()).done;){var r=i.value;this._convertTextureIds(r)}}catch(e){s.e(e)}finally{s.f()}var o,a=n(e.meshes);try{for(a.s();!(o=a.n()).done;){var u=o.value;this._convertMeshIds(u)}}catch(e){a.e(e)}finally{a.f()}var h,l=n(e.nodes);try{for(l.s();!(h=l.n()).done;){var c=h.value;this._convertNodeIds(c)}}catch(e){l.e(e)}finally{l.f()}var p,d=n(e.scenes);try{for(d.s();!(p=d.n()).done;){var f=p.value;this._convertSceneIds(f)}}catch(e){d.e(e)}finally{d.f()}}},{key:"_convertTextureIds",value:function(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}},{key:"_convertMeshIds",value:function(e){var t,i=n(e.primitives);try{for(i.s();!(t=i.n()).done;){var s=t.value,r=s.attributes,o=s.indices,a=s.material;for(var u in r)r[u]=this._convertIdToIndex(r[u],"accessor");o&&(s.indices=this._convertIdToIndex(o,"accessor")),a&&(s.material=this._convertIdToIndex(a,"material"))}}catch(e){i.e(e)}finally{i.f()}}},{key:"_convertNodeIds",value:function(e){var t=this;e.children&&(e.children=e.children.map((function(e){return t._convertIdToIndex(e,"node")}))),e.meshes&&(e.meshes=e.meshes.map((function(e){return t._convertIdToIndex(e,"mesh")})))}},{key:"_convertSceneIds",value:function(e){var t=this;e.nodes&&(e.nodes=e.nodes.map((function(e){return t._convertIdToIndex(e,"node")})))}},{key:"_convertIdsToIndices",value:function(e,t){e[t]||(console.warn("gltf v1: json doesn't contain attribute ".concat(t)),e[t]=[]);var i,s=n(e[t]);try{for(s.s();!(i=s.n()).done;){var r=i.value;for(var o in r){var a=r[o],u=this._convertIdToIndex(a,o);r[o]=u}}}catch(e){s.e(e)}finally{s.f()}}},{key:"_convertIdToIndex",value:function(e,t){var i=Zy[t];if(i in this.idToIndexMap){var s=this.idToIndexMap[i][e];if(!Number.isFinite(s))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return s}return e}},{key:"_updateObjects",value:function(e){var t,i=n(this.json.buffers);try{for(i.s();!(t=i.n()).done;){delete t.value.type}}catch(e){i.e(e)}finally{i.f()}}},{key:"_updateMaterial",value:function(e){var t,i=n(e.materials);try{var s=function(){var i=t.value;i.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};var s=(null===(r=i.values)||void 0===r?void 0:r.tex)||(null===(o=i.values)||void 0===o?void 0:o.texture2d_0),n=e.textures.findIndex((function(e){return e.id===s}));-1!==n&&(i.pbrMetallicRoughness.baseColorTexture={index:n})};for(i.s();!(t=i.n()).done;){var r,o;s()}}catch(e){i.e(e)}finally{i.f()}}}]),e}();function qy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new Qy).normalize(e,t)}var $y={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},eb={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},tb=10240,ib=10241,sb=10242,rb=10243,nb=10497,ob=9986,ab={magFilter:tb,minFilter:ib,wrapS:sb,wrapT:rb},ub=(c(e={},tb,9729),c(e,ib,ob),c(e,sb,nb),c(e,rb,nb),e);var hb=function(){function e(){w(this,e),Wd(this,"baseUri",""),Wd(this,"json",{}),Wd(this,"buffers",[]),Wd(this,"images",[])}return I(e,[{key:"postProcess",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.json,s=e.buffers,r=void 0===s?[]:s,n=e.images,o=void 0===n?[]:n,a=e.baseUri,u=void 0===a?"":a;return l_(i),this.baseUri=u,this.json=i,this.buffers=r,this.images=o,this._resolveTree(this.json,t),this.json}},{key:"_resolveTree",value:function(e){var t=this;e.bufferViews&&(e.bufferViews=e.bufferViews.map((function(e,i){return t._resolveBufferView(e,i)}))),e.images&&(e.images=e.images.map((function(e,i){return t._resolveImage(e,i)}))),e.samplers&&(e.samplers=e.samplers.map((function(e,i){return t._resolveSampler(e,i)}))),e.textures&&(e.textures=e.textures.map((function(e,i){return t._resolveTexture(e,i)}))),e.accessors&&(e.accessors=e.accessors.map((function(e,i){return t._resolveAccessor(e,i)}))),e.materials&&(e.materials=e.materials.map((function(e,i){return t._resolveMaterial(e,i)}))),e.meshes&&(e.meshes=e.meshes.map((function(e,i){return t._resolveMesh(e,i)}))),e.nodes&&(e.nodes=e.nodes.map((function(e,i){return t._resolveNode(e,i)}))),e.skins&&(e.skins=e.skins.map((function(e,i){return t._resolveSkin(e,i)}))),e.scenes&&(e.scenes=e.scenes.map((function(e,i){return t._resolveScene(e,i)}))),void 0!==e.scene&&(e.scene=e.scenes[this.json.scene])}},{key:"getScene",value:function(e){return this._get("scenes",e)}},{key:"getNode",value:function(e){return this._get("nodes",e)}},{key:"getSkin",value:function(e){return this._get("skins",e)}},{key:"getMesh",value:function(e){return this._get("meshes",e)}},{key:"getMaterial",value:function(e){return this._get("materials",e)}},{key:"getAccessor",value:function(e){return this._get("accessors",e)}},{key:"getCamera",value:function(e){return null}},{key:"getTexture",value:function(e){return this._get("textures",e)}},{key:"getSampler",value:function(e){return this._get("samplers",e)}},{key:"getImage",value:function(e){return this._get("images",e)}},{key:"getBufferView",value:function(e){return this._get("bufferViews",e)}},{key:"getBuffer",value:function(e){return this._get("buffers",e)}},{key:"_get",value:function(e,t){if("object"===T(t))return t;var i=this.json[e]&&this.json[e][t];return i||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),i}},{key:"_resolveScene",value:function(e,t){var i=this;return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map((function(e){return i.getNode(e)})),e}},{key:"_resolveNode",value:function(e,t){var i=this;return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map((function(e){return i.getNode(e)}))),void 0!==e.mesh?e.mesh=this.getMesh(e.mesh):void 0!==e.meshes&&e.meshes.length&&(e.mesh=e.meshes.reduce((function(e,t){var s=i.getMesh(t);return e.id=s.id,e.primitives=e.primitives.concat(s.primitives),e}),{primitives:[]})),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e}},{key:"_resolveSkin",value:function(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}},{key:"_resolveMesh",value:function(e,t){var i=this;return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map((function(e){var t=(e=l({},e)).attributes;for(var s in e.attributes={},t)e.attributes[s]=i.getAccessor(t[s]);return void 0!==e.indices&&(e.indices=i.getAccessor(e.indices)),void 0!==e.material&&(e.material=i.getMaterial(e.material)),e}))),e}},{key:"_resolveMaterial",value:function(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture=l({},e.normalTexture),e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture=l({},e.occlustionTexture),e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture=l({},e.emmisiveTexture),e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness=l({},e.pbrMetallicRoughness);var i=e.pbrMetallicRoughness;i.baseColorTexture&&(i.baseColorTexture=l({},i.baseColorTexture),i.baseColorTexture.texture=this.getTexture(i.baseColorTexture.index)),i.metallicRoughnessTexture&&(i.metallicRoughnessTexture=l({},i.metallicRoughnessTexture),i.metallicRoughnessTexture.texture=this.getTexture(i.metallicRoughnessTexture.index))}return e}},{key:"_resolveAccessor",value:function(e,t){var i,s;if(e.id=e.id||"accessor-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=(i=e.componentType,eb[i]),e.components=(s=e.type,$y[s]),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){var r=e.bufferView.buffer,n=x_(e,e.bufferView),o=n.ArrayType,a=n.byteLength,u=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+r.byteOffset,h=r.arrayBuffer.slice(u,u+a);e.bufferView.byteStride&&(h=this._getValueFromInterleavedBuffer(r,u,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new o(h)}return e}},{key:"_getValueFromInterleavedBuffer",value:function(e,t,i,s,r){for(var n=new Uint8Array(r*s),o=0;o<r;o++){var a=t+o*i;n.set(new Uint8Array(e.arrayBuffer.slice(a,a+s)),o*s)}return n.buffer}},{key:"_resolveTexture",value:function(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):ub,e.source=this.getImage(e.source),e}},{key:"_resolveSampler",value:function(e,t){for(var i in e.id=e.id||"sampler-".concat(t),e.parameters={},e){var s=this._enumSamplerParameter(i);void 0!==s&&(e.parameters[s]=e[i])}return e}},{key:"_enumSamplerParameter",value:function(e){return ab[e]}},{key:"_resolveImage",value:function(e,t){e.id=e.id||"image-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));var i=this.images[t];return i&&(e.image=i),e}},{key:"_resolveBufferView",value:function(e,t){var i=e.buffer,s=l(l({id:"bufferView-".concat(t)},e),{},{buffer:this.buffers[i]}),r=this.buffers[i].arrayBuffer,n=this.buffers[i].byteOffset||0;return"byteOffset"in e&&(n+=e.byteOffset),s.data=new Uint8Array(r,n,e.byteLength),s}},{key:"_resolveCamera",value:function(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}]),e}();function lb(e,t){return(new hb).postProcess(e,t)}var cb=!0;function pb(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}function db(e,t,i){Od(e.header.byteLength>20);var s=t.getUint32(i+0,cb),r=t.getUint32(i+4,cb);return i+=8,Od(0===r),mb(e,t,i,s),i+=s,i+=vb(e,t,i,e.header.byteLength)}function fb(e,t,i,s){return Od(e.header.byteLength>20),function(e,t,i,s){for(;i+8<=e.header.byteLength;){var r=t.getUint32(i+0,cb),n=t.getUint32(i+4,cb);switch(i+=8,n){case 1313821514:mb(e,t,i,r);break;case 5130562:vb(e,t,i,r);break;case 0:s.strict||mb(e,t,i,r);break;case 1:s.strict||vb(e,t,i,r)}i+=If(r,4)}}(e,t,i,s),i+e.header.byteLength}function mb(e,t,i,s){var r=new Uint8Array(t.buffer,i,s),n=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(n),If(s,4)}function vb(e,t,i,s){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:i,byteLength:s,arrayBuffer:t.buffer}),If(s,4)}function gb(e,t){return _b.apply(this,arguments)}function _b(){return _b=u(o().mark((function e(t,i){var s,r,n,a,u,h,l,c,p,d,f=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=f.length>2&&void 0!==f[2]?f[2]:0,r=f.length>3?f[3]:void 0,n=f.length>4?f[4]:void 0,yb(t,i,s,r),qy(t,{normalize:null==r||null===(a=r.gltf)||void 0===a?void 0:a.normalize}),Wy(t,r,n),c=[],null==r||null===(u=r.gltf)||void 0===u||!u.loadBuffers||!t.json.buffers){e.next=10;break}return e.next=10,bb(t,r,n);case 10:return null!=r&&null!==(h=r.gltf)&&void 0!==h&&h.loadImages&&(p=Pb(t,r,n),c.push(p)),d=Xy(t,r,n),c.push(d),e.next=15,Promise.all(c);case 15:return e.abrupt("return",null!=r&&null!==(l=r.gltf)&&void 0!==l&&l.postProcess?lb(t,r):t);case 16:case"end":return e.stop()}}),e)}))),_b.apply(this,arguments)}function yb(e,t,i,s){(s.uri&&(e.baseUri=s.uri),t instanceof ArrayBuffer&&!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=new DataView(e),r=i.magic,n=void 0===r?1735152710:r,o=s.getUint32(t,!1);return o===n||1735152710===o}(t,i,s))&&(t=(new TextDecoder).decode(t));if("string"==typeof t)e.json=xf(t);else if(t instanceof ArrayBuffer){var r={};i=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=new DataView(t),r=pb(s,i+0),n=s.getUint32(i+4,cb),o=s.getUint32(i+8,cb);switch(Object.assign(e,{header:{byteOffset:i,byteLength:o,hasBinChunk:!1},type:r,version:n,json:{},binChunks:[]}),i+=12,e.version){case 1:return db(e,s,i);case 2:return fb(e,s,i,{});default:throw new Error("Invalid GLB version ".concat(e.version,". Only supports v1 and v2."))}}(r,t,i,s.glb),l_("glTF"===r.type,"Invalid GLB magic string ".concat(r.type)),e._glb=r,e.json=r.json}else l_(!1,"GLTF: must be ArrayBuffer or string");var n=e.json.buffers||[];if(e.buffers=new Array(n.length).fill(null),e._glb&&e._glb.header.hasBinChunk){var o=e._glb.binChunks;e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}var a=e.json.images||[];e.images=new Array(a.length).fill({})}function bb(e,t,i){return xb.apply(this,arguments)}function xb(){return(xb=u(o().mark((function e(t,i,s){var r,n,a,u,h,l,c,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.json.buffers||[],n=0;case 2:if(!(n<r.length)){e.next=22;break}if(!(a=r[n]).uri){e.next=18;break}return l_(s.fetch),l=c_(a.uri,i),e.next=10,null==s||null===(u=s.fetch)||void 0===u?void 0:u.call(s,l);case 10:return c=e.sent,e.next=13,null==c||null===(h=c.arrayBuffer)||void 0===h?void 0:h.call(c);case 13:p=e.sent,t.buffers[n]={arrayBuffer:p,byteOffset:0,byteLength:p.byteLength},delete a.uri,e.next=19;break;case 18:null===t.buffers[n]&&(t.buffers[n]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength});case 19:++n,e.next=2;break;case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pb(e,t,i){return Tb.apply(this,arguments)}function Tb(){return(Tb=u(o().mark((function e(t,i,s){var r,a,u,h,l,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=wb(t),a=t.json.images||[],u=[],h=n(r);try{for(h.s();!(l=h.n()).done;)c=l.value,u.push(Mb(t,a[c],c,i,s))}catch(e){h.e(e)}finally{h.f()}return e.next=7,Promise.all(u);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wb(e){var t,i=new Set,s=n(e.json.textures||[]);try{for(s.s();!(t=s.n()).done;){var r=t.value;void 0!==r.source&&i.add(r.source)}}catch(e){s.e(e)}finally{s.f()}return Array.from(i).sort()}function Mb(e,t,i,s,r){return Ib.apply(this,arguments)}function Ib(){return Ib=u(o().mark((function e(t,i,s,r,n){var a,u,h,l,c,p,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.fetch,u=n.parse,!i.uri){e.next=9;break}return l=c_(i.uri,r),e.next=5,a(l);case 5:return c=e.sent,e.next=8,c.arrayBuffer();case 8:h=e.sent;case 9:return Number.isFinite(i.bufferView)&&(p=p_(t.json,t.buffers,i.bufferView),h=Mf(p.buffer,p.byteOffset,p.byteLength)),l_(h,"glTF image has no data"),e.next=13,u(h,[o_,kg],{mimeType:i.mimeType,basis:r.basis||{format:Ag()}},n);case 13:(d=e.sent)&&d[0]&&(d={compressed:!0,mipmaps:!1,width:d[0].width,height:d[0].height,data:d[0]}),t.images=t.images||[],t.images[s]=d;case 17:case"end":return e.stop()}}),e)}))),Ib.apply(this,arguments)}var Cb={name:"glTF",id:"gltf",module:"gltf",version:"3.2.6",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:function(e){return Db.apply(this,arguments)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};function Db(){return Db=u(o().mark((function e(t){var i,s,r,n,a,u=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=u.length>1&&void 0!==u[1]?u[1]:{},s=u.length>2?u[2]:void 0,(i=l(l({},Cb.options),i)).gltf=l(l({},Cb.options.gltf),i.gltf),r=i.byteOffset,n=void 0===r?0:r,a={},e.next=8,gb(a,t,n,i,s);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)}))),Db.apply(this,arguments)}var Ab=function(){function e(t){w(this,e)}return I(e,[{key:"load",value:function(e,t,i,s,r,n,o){!function(e,t,i,s,r,n,o){var a=e.viewer.scene.canvas.spinner;a.processes++,"glb"===t.split(".").pop()?e.dataSource.getGLB(t,(function(o){s.basePath=Eb(t),Fb(e,t,o,i,s,r,n),a.processes--}),(function(e){a.processes--,o(e)})):e.dataSource.getGLTF(t,(function(o){s.basePath=Eb(t),Fb(e,t,o,i,s,r,n),a.processes--}),(function(e){a.processes--,o(e)}))}(e,t,i,s=s||{},r,(function(){pe.scheduleTask((function(){r.scene.fire("modelLoaded",r.id),r.fire("loaded",!0,!1)})),n&&n()}),(function(t){e.error(t),o&&o(t),r.fire("error",t)}))}},{key:"parse",value:function(e,t,i,s,r,n,o){Fb(e,"",t,i,s=s||{},r,(function(){r.scene.fire("modelLoaded",r.id),r.fire("loaded",!0,!1),n&&n()}))}}]),e}();function kb(e){for(var t={},i={},s=e.metaObjects||[],r={},n=0,o=s.length;n<o;n++){var a=s[n];r[a.id]=a}for(var u=0,h=s.length;u<h;u++){var l=s[u];if(void 0!==l.parent&&null!==l.parent){var c=r[l.parent];if(l.type===c.type){for(var p=c;p.parent&&r[p.parent].type===p.type;)p=r[p.parent];(t[p.id]||(t[p.id]={numChildren:0,countChildren:0})).numChildren++,i[l.id]=p}}}return{metaObjectsMap:r,eachRootStats:t,eachChildRoot:i}}function Eb(e){var t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}function Fb(e,t,i,s,r,n,o){var a=e.viewer.scene.canvas.spinner;a.processes++,Lv(i,Cb,{baseUri:r.basePath}).then((function(i){var u={src:t,metaModelCorrections:s?kb(s):null,loadBuffer:r.loadBuffer,basePath:r.basePath,handlenode:r.handlenode,gltfData:i,scene:n.scene,plugin:e,sceneModel:n,numObjects:0,nodes:[],nextId:0,log:function(t){e.log(t)}};!function(e){var t=e.gltfData.textures;if(t)for(var i=0,s=t.length;i<s;i++)Rb(e,t[i])}(u),function(e){var t=e.gltfData.materials;if(t)for(var i=0,s=t.length;i<s;i++){var r=t[i];r._textureSetId=Sb(e,r),r._attributes=Ob(e,r)}}(u),function(e){var t=e.gltfData,i=t.scene||t.scenes[0];if(!i)return void jb(e,"glTF has no default scene");!function(e,t){var i=t.nodes;if(!i)return;for(var s=0,r=i.length;s<r;s++){Bb(e,i[s])}for(var n=0,o=i.length;n<o;n++){Nb(e,i[n],0,null)}}(e,i)}(u),n.finalize(),a.processes--,o()}))}function Rb(e,t){if(t.source&&t.source.image){var i="texture-".concat(e.nextId++),s=1005;switch(t.sampler.minFilter){case 9728:s=1003;break;case 9729:s=1006;break;case 9984:s=1004;break;case 9985:s=1007;break;case 9986:s=1005;break;case 9987:s=1008}var r=1006;switch(t.sampler.magFilter){case 9728:r=1003;break;case 9729:r=1006}var n=1e3;switch(t.sampler.wrapS){case 33071:n=1001;break;case 33648:n=1002;break;case 10497:n=1e3}var o=1e3;switch(t.sampler.wrapT){case 33071:o=1001;break;case 33648:o=1002;break;case 10497:o=1e3}var a=1e3;switch(t.sampler.wrapR){case 33071:a=1001;break;case 33648:a=1002;break;case 10497:a=1e3}e.sceneModel.createTexture({id:i,image:t.source.image,flipY:!!t.flipY,minFilter:s,magFilter:r,wrapS:n,wrapT:o,wrapR:a,encoding:3001}),t._textureId=i}}function Sb(e,t){var i={};t.normalTexture&&(i.normalTextureId=t.normalTexture.texture._textureId),t.occlusionTexture&&(i.occlusionTextureId=t.occlusionTexture.texture._textureId),t.emissiveTexture&&(i.emissiveTextureId=t.emissiveTexture.texture._textureId);var s=t.pbrMetallicRoughness;if(t.pbrMetallicRoughness){var r=t.pbrMetallicRoughness,n=r.baseColorTexture||r.colorTexture;n&&(n.texture?i.colorTextureId=n.texture._textureId:i.colorTextureId=e.gltfData.textures[n.index]._textureId),s.metallicRoughnessTexture&&(i.metallicRoughnessTextureId=s.metallicRoughnessTexture.texture._textureId)}var o=t.extensions;if(o){var a=o.KHR_materials_pbrSpecularGlossiness;if(a){a.specularTexture;var u=a.specularColorTexture;null!=u&&(i.colorTextureId=e.gltfData.textures[u.index]._textureId)}}return void 0!==i.normalTextureId||void 0!==i.occlusionTextureId||void 0!==i.emissiveTextureId||void 0!==i.colorTextureId||void 0!==i.metallicRoughnessTextureId?(i.id="textureSet-".concat(e.nextId++,";"),e.sceneModel.createTextureSet(i),i.id):null}function Ob(e,t){var i=t.extensions,s={color:new Float32Array([1,1,1,1]),opacity:1,metallic:0,roughness:1};if(i){var r=i.KHR_materials_pbrSpecularGlossiness;if(r){var n=r.diffuseFactor;null!=n&&s.color.set(n)}var o=i.KHR_materials_common;if(o){var a=o.technique,u=o.values||{},h="BLINN"===a,l="PHONG"===a,c="LAMBERT"===a,p=u.diffuse;p&&(h||l||c)&&(re.isString(p)||s.color.set(p));var d=u.transparency;null!=d&&(s.opacity=d);var f=u.transparent;null!=f&&(s.opacity=f)}}var m=t.pbrMetallicRoughness;if(m){var v=m.baseColorFactor;v&&(s.color[0]=v[0],s.color[1]=v[1],s.color[2]=v[2],s.opacity=v[3]);var g=m.metallicFactor;null!=g&&(s.metallic=g);var _=m.roughnessFactor;null!=_&&(s.roughness=_)}return s}function Bb(e,t){var i=t.mesh;if(i&&(i.instances=i.instances?i.instances+1:1),t.children)for(var s=t.children,r=0,n=s.length;r<n;r++){var o=s[r];o?Bb(e,o):jb(e,"Node not found: "+r)}}var Lb=[];function Nb(e,t,i,s){var r;e.gltfData,t.matrix&&(r=t.matrix,s=s?q.mulMat4(s,r,q.mat4()):r),t.translation&&(r=q.translationMat4v(t.translation),s=s?q.mulMat4(s,r,q.mat4()):r),t.rotation&&(r=q.quaternionToMat4(t.rotation),s=s?q.mulMat4(s,r,q.mat4()):r),t.scale&&(r=q.scalingMat4v(t.scale),s=s?q.mulMat4(s,r,q.mat4()):r);var n=e.sceneModel;if(t.mesh){var o=t.mesh;if(e.handlenode){var a={};if(!e.handlenode(e.sceneModel.id,t,a))return}var u=s?s.slice():q.identityMat4(),h=o.primitives.length;if(h>0)for(var l=0;l<h;l++){var c=o.primitives[l];if(!(c.mode<4)){var p={id:n.id+"."+e.numObjects++};switch(c.mode){case 0:p.primitive="points";break;case 1:case 2:case 3:p.primitive="lines";break;default:p.primitive="triangles"}var d=c.attributes.POSITION;if(d){p.localPositions=d.value,p.positions=new Float64Array(p.localPositions.length),c.attributes.NORMAL&&(p.normals=c.attributes.NORMAL.value),c.attributes.TEXCOORD_0&&(p.uv=c.attributes.TEXCOORD_0.value),c.indices&&(p.indices=c.indices.value),q.transformPositions3(u,p.localPositions,p.positions);var f=q.vec3();ke(p.positions,p.positions,f)&&(p.origin=f);var m=c.material;m?(p.textureSetId=m._textureSetId,p.color=m._attributes.color,p.opacity=m._attributes.opacity,p.metallic=m._attributes.metallic,p.roughness=m._attributes.roughness):(p.color=new Float32Array([1,1,1]),p.opacity=1),n.createMesh(p),Lb.push(p.id)}}}}if(t.children)for(var v=t.children,g=0,_=v.length;g<_;g++){Nb(e,v[g],i+1,s)}var y=t.name;if((null!=y||0===i)&&Lb.length>0){null==y&&e.log("Warning: 'name' properties not found on glTF scene nodes - will randomly-generate object IDs in XKT");var b=y;if(e.metaModelCorrections){var x=e.metaModelCorrections.eachChildRoot[b];if(x){var P=e.metaModelCorrections.eachRootStats[x.id];P.countChildren++,P.countChildren>=P.numChildren&&(n.createEntity({id:x.id,meshIds:Lb}),Lb.length=0)}else{e.metaModelCorrections.metaObjectsMap[b]&&(n.createEntity({id:b,meshIds:Lb}),Lb.length=0)}}else n.createEntity({id:b,meshIds:Lb}),Lb.length=0}}function jb(e,t){e.plugin.error(t)}var Gb={IfcOpeningElement:{pickable:!1,visible:!1},IfcSpace:{colorize:[.137255,.403922,.870588],pickable:!1,visible:!1,opacity:.4},IfcWindow:{colorize:[.137255,.403922,.870588],opacity:.3},IfcPlate:{colorize:[.8470588235,.427450980392,0,.5],opacity:.3},DEFAULT:{}},Hb=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,"GLTFLoader",e,r))._sceneModelLoader=new Ab(x(s),r),s.dataSource=r.dataSource,s.objectDefaults=r.objectDefaults,s}return I(i,[{key:"dataSource",get:function(){return this._dataSource},set:function(e){this._dataSource=e||new Sd}},{key:"objectDefaults",get:function(){return this._objectDefaults},set:function(e){this._objectDefaults=e||Gb}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id);var i=new Op(this.viewer.scene,re.apply(t,{isModel:!0})),s=i.id;if(!t.src&&!t.gltf)return this.error("load() param expected: src or gltf"),i;if(t.metaModelSrc||t.metaModelJSON){var r=t.objectDefaults||this._objectDefaults||Gb,n=function(n){var o;if(e.viewer.metaScene.createMetaModel(s,n,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes}),e.viewer.scene.canvas.spinner.processes--,t.includeTypes){o={};for(var a=0,u=t.includeTypes.length;a<u;a++)o[t.includeTypes[a]]=!0}if(t.excludeTypes){o||(o={});for(var h=0,l=t.excludeTypes.length;h<l;h++)o[t.excludeTypes[h]]=!0}t.readableGeometry=!1,t.handleGLTFNode=function(t,i,s){var n=i.name;if(!n)return!0;var o=n,a=e.viewer.metaScene.metaObjects[o],u=(a?a.type:"DEFAULT")||"DEFAULT";s.createEntity={id:o,isObject:!0};var h=r[u];return h&&(!1===h.visible&&(s.createEntity.visible=!1),h.colorize&&(s.createEntity.colorize=h.colorize),!1===h.pickable&&(s.createEntity.pickable=!1),void 0!==h.opacity&&null!==h.opacity&&(s.createEntity.opacity=h.opacity)),!0},t.src?e._sceneModelLoader.load(e,t.src,n,t,i):e._sceneModelLoader.parse(e,t.gltf,n,t,i)};if(t.metaModelSrc){var o=t.metaModelSrc;this.viewer.scene.canvas.spinner.processes++,this._dataSource.getMetaModel(o,(function(t){e.viewer.scene.canvas.spinner.processes--,n(t)}),(function(t){e.error("load(): Failed to load model metadata for model '".concat(s," from  '").concat(o,"' - ").concat(t)),e.viewer.scene.canvas.spinner.processes--}))}else t.metaModelJSON&&n(t.metaModelJSON)}else t.handleGLTFNode=function(e,t,i){var s=t.name;if(!s)return!0;var r=s;return i.createEntity={id:r,isObject:!0},!0},t.src?this._sceneModelLoader.load(this,t.src,null,t,i):this._sceneModelLoader.parse(this,t.gltf,null,t,i);return i.once("destroyed",(function(){e.viewer.metaScene.destroyMetaModel(s)})),i}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this)}}]),i}();function Ub(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i="lightgrey",s=t.hoverColor||"rgba(0,0,0,0.4)",r=500,n=r+r/3,o=n/24,a=[{boundary:[6,6,6,6],color:t.frontColor||t.color||"#55FF55"},{boundary:[18,6,6,6],color:t.backColor||t.color||"#55FF55"},{boundary:[12,6,6,6],color:t.leftColor||t.color||"#FF5555"},{boundary:[0,6,6,6],color:t.rightColor||t.color||"#FF5555"},{boundary:[6,0,6,6],color:t.topColor||t.color||"#7777FF"},{boundary:[6,12,6,6],color:t.bottomColor||t.color||"#7777FF"}],u=[{label:"NavCube.front",boundaries:[[7,7,4,4]],dir:[0,1,0],up:[0,0,1]},{label:"NavCube.back",boundaries:[[19,7,4,4]],dir:[0,-1,0],up:[0,0,1]},{label:"NavCube.right",boundaries:[[13,7,4,4]],dir:[-1,0,0],up:[0,0,1]},{label:"NavCube.left",boundaries:[[1,7,4,4]],dir:[1,0,0],up:[0,0,1]},{label:"NavCube.top",boundaries:[[7,1,4,4]],dir:[0,0,-1],up:[0,1,0]},{label:"NavCube.bottom",boundaries:[[7,13,4,4]],dir:[0,0,1],up:[0,-1,0]},{boundaries:[[7,5,4,2]],dir:[0,1,-1],up:[0,1,1]},{boundaries:[[1,6,4,1],[6,1,1,4]],dir:[1,0,-1],up:[1,0,1]},{boundaries:[[7,0,4,1],[19,6,4,1]],dir:[0,-1,-1],up:[0,-1,1]},{boundaries:[[13,6,4,1],[11,1,1,4]],dir:[-1,0,-1],up:[-1,0,1]},{boundaries:[[7,11,4,2]],dir:[0,1,1],up:[0,-1,1]},{boundaries:[[1,11,4,1],[6,13,1,4]],dir:[1,0,1],up:[-1,0,1]},{boundaries:[[7,17,4,1],[19,11,4,1]],dir:[0,-1,1],up:[0,1,1]},{boundaries:[[13,11,4,1],[11,13,1,4]],dir:[-1,0,1],up:[1,0,1]},{boundaries:[[5,7,2,4]],dir:[1,1,0],up:[0,0,1]},{boundaries:[[11,7,2,4]],dir:[-1,1,0],up:[0,0,1]},{boundaries:[[17,7,2,4]],dir:[-1,-1,0],up:[0,0,1]},{boundaries:[[0,7,1,4],[23,7,1,4]],dir:[1,-1,0],up:[0,0,1]},{boundaries:[[5,11,2,2]],dir:[1,1,1],up:[-1,-1,1]},{boundaries:[[23,11,1,1],[6,17,1,1],[0,11,1,1]],dir:[1,-1,1],up:[-1,1,1]},{boundaries:[[5,5,2,2]],dir:[1,1,-1],up:[1,1,1]},{boundaries:[[11,17,1,1],[17,11,2,1]],dir:[-1,-1,1],up:[1,1,1]},{boundaries:[[17,6,2,1],[11,0,1,1]],dir:[-1,-1,-1],up:[-1,-1,1]},{boundaries:[[11,11,2,2]],dir:[-1,1,1],up:[1,-1,1]},{boundaries:[[0,6,1,1],[6,0,1,1],[23,6,1,1]],dir:[1,-1,-1],up:[1,-1,1]},{boundaries:[[11,5,2,2]],dir:[-1,1,-1],up:[-1,1,1]}];t.frontColor||t.color,t.backColor||t.color,t.leftColor||t.color,t.rightColor||t.color,t.topColor||t.color,t.bottomColor||t.color;for(var h=[{yUp:"",label:"NavCube.front",boundaries:[[7,7,4,4]],dir:[0,0,-1],up:[0,1,0]},{label:"NavCube.back",boundaries:[[19,7,4,4]],dir:[0,0,1],up:[0,1,0]},{label:"NavCube.right",boundaries:[[13,7,4,4]],dir:[-1,0,0],up:[0,1,0]},{label:"NavCube.left",boundaries:[[1,7,4,4]],dir:[1,0,0],up:[0,1,0]},{label:"NavCube.top",boundaries:[[7,1,4,4]],dir:[0,-1,0],up:[0,0,-1]},{label:"NavCube.bottom",boundaries:[[7,13,4,4]],dir:[0,1,0],up:[0,0,1]},{boundaries:[[7,5,4,2]],dir:[0,-.7071,-.7071],up:[0,.7071,-.7071]},{boundaries:[[1,6,4,1],[6,1,1,4]],dir:[1,-1,0],up:[1,1,0]},{boundaries:[[7,0,4,1],[19,6,4,1]],dir:[0,-.7071,.7071],up:[0,.7071,.7071]},{boundaries:[[13,6,4,1],[11,1,1,4]],dir:[-1,-1,0],up:[-1,1,0]},{boundaries:[[7,11,4,2]],dir:[0,1,-1],up:[0,1,1]},{boundaries:[[1,11,4,1],[6,13,1,4]],dir:[1,1,0],up:[-1,1,0]},{boundaries:[[7,17,4,1],[19,11,4,1]],dir:[0,1,1],up:[0,1,-1]},{boundaries:[[13,11,4,1],[11,13,1,4]],dir:[-1,1,0],up:[1,1,0]},{boundaries:[[5,7,2,4]],dir:[1,0,-1],up:[0,1,0]},{boundaries:[[11,7,2,4]],dir:[-1,0,-1],up:[0,1,0]},{boundaries:[[17,7,2,4]],dir:[-1,0,1],up:[0,1,0]},{boundaries:[[0,7,1,4],[23,7,1,4]],dir:[1,0,1],up:[0,1,0]},{boundaries:[[5,11,2,2]],dir:[.5,.7071,-.5],up:[-.5,.7071,.5]},{boundaries:[[23,11,1,1],[6,17,1,1],[0,11,1,1]],dir:[.5,.7071,.5],up:[-.5,.7071,-.5]},{boundaries:[[5,5,2,2]],dir:[.5,-.7071,-.5],up:[.5,.7071,-.5]},{boundaries:[[11,17,1,1],[17,11,2,1]],dir:[-.5,.7071,.5],up:[.5,.7071,-.5]},{boundaries:[[17,6,2,1],[11,0,1,1]],dir:[-.5,-.7071,.5],up:[-.5,.7071,.5]},{boundaries:[[11,11,2,2]],dir:[-.5,.7071,-.5],up:[.5,.7071,.5]},{boundaries:[[0,6,1,1],[6,0,1,1],[23,6,1,1]],dir:[.5,-.7071,.5],up:[.5,.7071,.5]},{boundaries:[[11,5,2,2]],dir:[-.5,-.7071,-.5],up:[-.5,.7071,-.5]}],l=0,c=u.length;l<c;l++)q.normalizeVec3(u[l].dir,u[l].dir),q.normalizeVec3(u[l].up,u[l].up);for(var p=0,d=h.length;p<d;p++)q.normalizeVec3(h[p].dir,h[p].dir),q.normalizeVec3(h[p].up,h[p].up);var f=h;this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=n,this._textureCanvas.height=r,this._textureCanvas.style.width=n+"px",this._textureCanvas.style.height=r+"px",this._textureCanvas.style.padding="0",this._textureCanvas.style.margin="0",this._textureCanvas.style.top="0",this._textureCanvas.style.background=i,this._textureCanvas.style.position="absolute",this._textureCanvas.style.opacity="1.0",this._textureCanvas.style.visibility="hidden",this._textureCanvas.style["z-index"]=2e6;var m=document.getElementsByTagName("body")[0];m.appendChild(this._textureCanvas);var v=this._textureCanvas.getContext("2d"),g=!1;function _(){for(var t=0,r=a.length;t<r;t++){var n=a[t],u=n.boundary,h=Math.round(u[0]*o),l=Math.round(u[1]*o),c=Math.round(u[2]*o),p=Math.round(u[3]*o);v.fillStyle=n.color,v.fillRect(h,l,c,p)}for(var d=0,m=f.length;d<m;d++){for(var g=void 0,_=void 0,y=void 0,b=void 0,x=f[d],T=x.boundaries,w=0,M=T.length;w<M;w++){var I=T[w];g=Math.round(I[0]*o),_=Math.round(I[1]*o),y=Math.round(I[2]*o),b=Math.round(I[3]*o),x.highlighted&&(v.fillStyle=x.highlighted?s:x.color||i,v.fillRect(g,_,y,b))}if(x.label){v.fillStyle="black",v.font="60px sans-serif",v.textAlign="center";var C=g+.5*y,D=_+.7*b;v.fillText(P(x.label),C,D,80)}}e.scene.glRedraw()}var y,b,x,P=(y={"NavCube.front":"NavCube.front","NavCube.back":"NavCube.back","NavCube.right":"NavCube.right","NavCube.left":"NavCube.left","NavCube.top":"NavCube.top","NavCube.bottom":"NavCube.bottom"},b={"NavCube.front":"NavCube.front","NavCube.back":"NavCube.back","NavCube.right":"NavCube.right","NavCube.left":"NavCube.left","NavCube.top":"NavCube.top","NavCube.bottom":"NavCube.bottom"},x={"NavCube.front":"FRONT","NavCube.back":"BACK","NavCube.right":"RIGHT","NavCube.left":"LEFT","NavCube.top":"TOP","NavCube.bottom":"BOTTOM"},function(t){var i=g?b:y,s=i?i[t]:null;return s?e.localeService.translate(s)||x[s]||s:t});this.setZUp=function(){g=!0,f=u,this.clear()},this.setYUp=function(){g=!1,f=h,this.clear()},this.clear=function(){v.fillStyle=i,v.fillRect(0,0,n,r);for(var e=0,t=f.length;e<t;e++){f[e].highlighted=!1}_()},this.getArea=function(e){for(var t=e[0]*n,i=r-e[1]*r,s=0,a=f.length;s<a;s++)for(var u=f[s].boundaries,h=0,l=u.length;h<l;h++){var c=u[h];if(t>=c[0]*o&&t<=(c[0]+c[2])*o&&i>=c[1]*o&&i<=(c[1]+c[3])*o)return s}return-1},this.setAreaHighlighted=function(e,t){var i=f[e];if(!i)throw"Area not found: "+e;i.highlighted=!!t,_()},this.getAreaDir=function(e){var t=f[e];if(!t)throw"Unknown area: "+e;return t.dir},this.getAreaUp=function(e){var t=f[e];if(!t)throw"Unknown area: "+e;return t.up},this.getImage=function(){return this._textureCanvas},this.destroy=function(){this._textureCanvas&&(this._textureCanvas.parentNode.removeChild(this._textureCanvas),this._textureCanvas=null)}}var Vb=q.vec3(),zb=q.vec3();q.mat4();var Wb=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,i),s=t.call(this,"NavCube",e,r),e.navCube=x(s);var n=!0;try{s._navCubeScene=new Br(e,{canvasId:r.canvasId,canvasElement:r.canvasElement,transparent:!0}),s._navCubeCanvas=s._navCubeScene.canvas.canvas,s._navCubeScene.input.keyboardEnabled=!1}catch(e){return s.error(e),b(s)}var o=s._navCubeScene;o.clearLights(),new dr(o,{dir:[.4,-.4,.8],color:[.8,1,1],intensity:1,space:"view"}),new dr(o,{dir:[-.8,-.3,-.4],color:[.8,.8,.8],intensity:1,space:"view"}),new dr(o,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"}),s._navCubeCamera=o.camera,s._navCubeCamera.ortho.scale=7,s._navCubeCamera.ortho.near=.1,s._navCubeCamera.ortho.far=2e3,o.edgeMaterial.edgeColor=[.2,.2,.2],o.edgeMaterial.edgeAlpha=.6,s._zUp=Boolean(e.camera.zUp);var a=x(s);s.setIsProjectNorth(r.isProjectNorth),s.setProjectNorthOffsetAngle(r.projectNorthOffsetAngle);var u,h=(u=q.mat4(),function(e,t,i){return q.identityMat4(u),q.rotationMat4v(e*a._projectNorthOffsetAngle*q.DEGTORAD,[0,1,0],u),q.transformVec3(u,t,i)});s._synchCamera=function(){var t=q.rotationMat4c(-90*q.DEGTORAD,1,0,0),i=q.vec3(),s=q.vec3(),r=q.vec3();return function(){var n=e.camera.eye,o=e.camera.look,u=e.camera.up;i=q.mulVec3Scalar(q.normalizeVec3(q.subVec3(n,o,i)),5),a._isProjectNorth&&a._projectNorthOffsetAngle&&(i=h(-1,i,Vb),u=h(-1,u,zb)),a._zUp?(q.transformVec3(t,i,s),q.transformVec3(t,u,r),a._navCubeCamera.look=[0,0,0],a._navCubeCamera.eye=q.transformVec3(t,i,s),a._navCubeCamera.up=q.transformPoint3(t,u,r)):(a._navCubeCamera.look=[0,0,0],a._navCubeCamera.eye=i,a._navCubeCamera.up=u)}}(),s._cubeTextureCanvas=new Ub(e,r),s._cubeSampler=new xa(o,{image:s._cubeTextureCanvas.getImage(),flipY:!0,wrapS:1001,wrapT:1001}),s._cubeMesh=new Uo(o,{geometry:new _r(o,{primitive:"triangles",normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],positions:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],uv:[.5,.6666,.25,.6666,.25,.3333,.5,.3333,.5,.6666,.5,.3333,.75,.3333,.75,.6666,.5,.6666,.5,1,.25,1,.25,.6666,.25,.6666,0,.6666,0,.3333,.25,.3333,.25,0,.5,0,.5,.3333,.25,.3333,.75,.3333,1,.3333,1,.6666,.75,.6666],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}),material:new Tr(o,{diffuse:[.4,.4,.4],specular:[.4,.4,.4],emissive:[.6,.6,.6],diffuseMap:s._cubeSampler,emissiveMap:s._cubeSampler}),visible:!!n,edges:!0}),s._shadow=!1===r.shadowVisible?null:new Uo(o,{geometry:new _r(o,zo({center:[0,0,0],radiusTop:.001,radiusBottom:1.4,height:.01,radialSegments:20,heightSegments:1,openEnded:!0})),material:new Tr(o,{diffuse:[0,0,0],specular:[0,0,0],emissive:[0,0,0],alpha:.5}),position:[0,-1.5,0],visible:!!n,pickable:!1,backfaces:!1}),s._onCameraMatrix=e.camera.on("matrix",s._synchCamera),s._onCameraWorldAxis=e.camera.on("worldAxis",(function(){e.camera.zUp?(s._zUp=!0,s._cubeTextureCanvas.setZUp(),s._repaint(),s._synchCamera()):e.camera.yUp&&(s._zUp=!1,s._cubeTextureCanvas.setYUp(),s._repaint(),s._synchCamera())})),s._onCameraFOV=e.camera.perspective.on("fov",(function(e){s._synchProjection&&(s._navCubeCamera.perspective.fov=e)})),s._onCameraProjection=e.camera.on("projection",(function(e){s._synchProjection&&(s._navCubeCamera.projection="ortho"===e||"perspective"===e?e:"perspective")}));var l=-1;function c(t,i){var s=(t-d)*-y,r=(i-f)*-y;e.camera.orbitYaw(s),e.camera.orbitPitch(-r),d=t,f=i}function p(e){var t=[0,0];if(e){for(var i=e.target,s=0,r=0;i.offsetParent;)s+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;t[0]=e.pageX-s,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t}var d,f,m=null,v=null,g=!1,_=!1,y=.5;a._navCubeCanvas.addEventListener("mouseenter",a._onMouseEnter=function(e){_=!0}),a._navCubeCanvas.addEventListener("mouseleave",a._onMouseLeave=function(e){_=!1}),a._navCubeCanvas.addEventListener("mousedown",a._onMouseDown=function(e){if(1===e.which){m=e.x,v=e.y,d=e.clientX,f=e.clientY;var t=p(e),i=o.pick({canvasPos:t});g=!!i}}),document.addEventListener("mouseup",a._onMouseUp=function(e){if(1===e.which&&(g=!1,null!==m)){var t=p(e),i=o.pick({canvasPos:t,pickSurface:!0});if(i&&i.uv){var s=a._cubeTextureCanvas.getArea(i.uv);if(s>=0&&(document.body.style.cursor="pointer",l>=0&&(a._cubeTextureCanvas.setAreaHighlighted(l,!1),a._repaint(),l=-1),s>=0)){if(a._cubeTextureCanvas.setAreaHighlighted(s,!0),l=s,a._repaint(),e.x<m-3||e.x>m+3||e.y<v-3||e.y>v+3)return;var r=a._cubeTextureCanvas.getAreaDir(s);if(r){var n=a._cubeTextureCanvas.getAreaUp(s);a._isProjectNorth&&a._projectNorthOffsetAngle&&(r=h(1,r,Vb),n=h(1,n,zb)),P(r,n,(function(){l>=0&&(a._cubeTextureCanvas.setAreaHighlighted(l,!1),a._repaint(),l=-1),document.body.style.cursor="pointer",l>=0&&(a._cubeTextureCanvas.setAreaHighlighted(l,!1),a._repaint(),l=-1),s>=0&&(a._cubeTextureCanvas.setAreaHighlighted(s,!1),l=-1,a._repaint())}))}}}}}),document.addEventListener("mousemove",a._onMouseMove=function(e){if(l>=0&&(a._cubeTextureCanvas.setAreaHighlighted(l,!1),a._repaint(),l=-1),1!==e.buttons||g){if(g){var t=e.clientX,i=e.clientY;return document.body.style.cursor="move",void c(t,i)}if(_){var s=p(e),r=o.pick({canvasPos:s,pickSurface:!0});if(r){if(r.uv){document.body.style.cursor="pointer";var n=a._cubeTextureCanvas.getArea(r.uv);if(n===l)return;l>=0&&a._cubeTextureCanvas.setAreaHighlighted(l,!1),n>=0&&(a._cubeTextureCanvas.setAreaHighlighted(n,!0),a._repaint(),l=n)}}else document.body.style.cursor="default",l>=0&&(a._cubeTextureCanvas.setAreaHighlighted(l,!1),a._repaint(),l=-1)}}});var P=function(){var t=q.vec3();return function(i,s,r){var n=a._fitVisible?e.scene.getAABB(e.scene.visibleObjectIds):e.scene.aabb,o=q.getAABB3Diag(n);q.getAABB3Center(n,t);var u=Math.abs(o/Math.tan(a._cameraFitFOV*q.DEGTORAD));e.cameraControl.pivotPos=t,a._cameraFly?e.cameraFlight.flyTo({look:t,eye:[t[0]-u*i[0],t[1]-u*i[1],t[2]-u*i[2]],up:s||[0,1,0],orthoScale:1.1*o,fitFOV:a._cameraFitFOV,duration:a._cameraFlyDuration},r):e.cameraFlight.jumpTo({look:t,eye:[t[0]-u*i[0],t[1]-u*i[1],t[2]-u*i[2]],up:s||[0,1,0],orthoScale:1.1*o,fitFOV:a._cameraFitFOV},r)}}();return s._onUpdated=e.localeService.on("updated",(function(){s._cubeTextureCanvas.clear(),s._repaint()})),s.setVisible(r.visible),s.setCameraFitFOV(r.cameraFitFOV),s.setCameraFly(r.cameraFly),s.setCameraFlyDuration(r.cameraFlyDuration),s.setFitVisible(r.fitVisible),s.setSynchProjection(r.synchProjection),s}return I(i,[{key:"send",value:function(e,t){if("language"===e)this._cubeTextureCanvas.clear(),this._repaint()}},{key:"_repaint",value:function(){var e=this._cubeTextureCanvas.getImage();this._cubeMesh.material.diffuseMap.image=e,this._cubeMesh.material.emissiveMap.image=e}},{key:"setVisible",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._navCubeCanvas&&(this._cubeMesh.visible=e,this._shadow&&(this._shadow.visible=e),this._navCubeCanvas.style.visibility=e?"visible":"hidden")}},{key:"getVisible",value:function(){return!!this._navCubeCanvas&&this._cubeMesh.visible}},{key:"setFitVisible",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._fitVisible=e}},{key:"getFitVisible",value:function(){return this._fitVisible}},{key:"setCameraFly",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._cameraFly=e}},{key:"getCameraFly",value:function(){return this._cameraFly}},{key:"setCameraFitFOV",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:45;this._cameraFitFOV=e}},{key:"getCameraFitFOV",value:function(){return this._cameraFitFOV}},{key:"setCameraFlyDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;this._cameraFlyDuration=e}},{key:"getCameraFlyDuration",value:function(){return this._cameraFlyDuration}},{key:"setSynchProjection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._synchProjection=e}},{key:"getSynchProjection",value:function(){return this._synchProjection}},{key:"setIsProjectNorth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._isProjectNorth=e}},{key:"getIsProjectNorth",value:function(){return this._isProjectNorth}},{key:"setProjectNorthOffsetAngle",value:function(e){this._projectNorthOffsetAngle=e}},{key:"getProjectNorthOffsetAngle",value:function(){return this._projectNorthOffsetAngle}},{key:"destroy",value:function(){this._navCubeCanvas&&(this.viewer.localeService.off(this._onUpdated),this.viewer.camera.off(this._onCameraMatrix),this.viewer.camera.off(this._onCameraWorldAxis),this.viewer.camera.perspective.off(this._onCameraFOV),this.viewer.camera.off(this._onCameraProjection),this._navCubeCanvas.removeEventListener("mouseenter",this._onMouseEnter),this._navCubeCanvas.removeEventListener("mouseleave",this._onMouseLeave),this._navCubeCanvas.removeEventListener("mousedown",this._onMouseDown),document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this._navCubeCanvas=null,this._cubeTextureCanvas.destroy(),this._cubeTextureCanvas=null,this._onMouseEnter=null,this._onMouseLeave=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null),this._navCubeScene.destroy(),this._navCubeScene=null,this._cubeMesh=null,this._shadow=null,m(P(i.prototype),"destroy",this).call(this)}}]),i}(),Xb=q.vec3(),Yb=function(){function e(){w(this,e)}return I(e,[{key:"load",value:function(e,t){var i=e.scene.canvas.spinner;i.processes++,Kb(e,t,(function(t){Zb(e,t,(function(){$b(e,t),i.processes--,pe.scheduleTask((function(){e.fire("loaded",!0,!1)}))}))}))}},{key:"parse",value:function(e,t,i,s){if(t){var r=Jb(e,t,null);i&&qb(e,i,s),$b(e,r),e.src=null,e.fire("loaded",!0,!1)}else this.warn("load() param expected: objText")}}]),e}(),Kb=function(e,t,i){ex(t,(function(s){var r=Jb(e,s,t);i(r)}),(function(t){e.error(t)}))},Jb=function(){var e={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /};return function(s,r,n){var o={src:n=n||"",basePath:t(n),objects:[],object:{},positions:[],normals:[],uv:[],materialLibraries:{}};i(o,"",!1),-1!==r.indexOf("\r\n")&&(r=r.replace("\r\n","\n"));for(var a=r.split("\n"),u="",h="",l="",d=[],f="function"==typeof"".trimLeft,m=0,v=a.length;m<v;m++)if(u=a[m],0!==(u=f?u.trimLeft():u.trim()).length&&"#"!==(h=u.charAt(0)))if("v"===h)if(" "===(l=u.charAt(1))&&null!==(d=e.vertex_pattern.exec(u)))o.positions.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));else if("n"===l&&null!==(d=e.normal_pattern.exec(u)))o.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));else{if("t"!==l||null===(d=e.uv_pattern.exec(u)))return void s.error("Unexpected vertex/normal/uv line: '"+u+"'");o.uv.push(parseFloat(d[1]),parseFloat(d[2]))}else if("f"===h)if(null!==(d=e.face_vertex_uv_normal.exec(u)))c(o,d[1],d[4],d[7],d[10],d[2],d[5],d[8],d[11],d[3],d[6],d[9],d[12]);else if(null!==(d=e.face_vertex_uv.exec(u)))c(o,d[1],d[3],d[5],d[7],d[2],d[4],d[6],d[8]);else if(null!==(d=e.face_vertex_normal.exec(u)))c(o,d[1],d[3],d[5],d[7],void 0,void 0,void 0,void 0,d[2],d[4],d[6],d[8]);else{if(null===(d=e.face_vertex.exec(u)))return void s.error("Unexpected face line: '"+u+"'");c(o,d[1],d[2],d[3],d[4])}else if("l"===h){var g=u.substring(1).trim().split(" "),_=[],y=[];if(-1===u.indexOf("/"))_=g;else for(var b=0,x=g.length;b<x;b++){var P=g[b].split("/");""!==P[0]&&_.push(P[0]),""!==P[1]&&y.push(P[1])}p(o,_,y)}else if(null!==(d=e.object_pattern.exec(u))){i(o,T=d[0].substr(1).trim(),!0)}else if(e.material_use_pattern.test(u)){var T=u.substring(7).trim();o.object.material.id=T}else if(e.material_library_pattern.test(u))o.materialLibraries[u.substring(7).trim()]=!0;else{if(null===(d=e.smoothing_pattern.exec(u))){if("\0"===u)continue;return void s.error("Unexpected line: '"+u+"'")}var w=d[1].trim().toLowerCase();o.object.material.smooth="1"===w||"on"===w}return o};function t(e){var t=e.lastIndexOf("/");return-1===t?e:e.substring(0,t+1)}function i(e,t,i){if(e.object&&!1===e.object.fromDeclaration)return e.object.id=t,void(e.object.fromDeclaration=!1!==i);e.object={id:t||"",geometry:{positions:[],normals:[],uv:[]},material:{id:"",smooth:!0},fromDeclaration:!1!==i},e.objects.push(e.object)}function s(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)}function r(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)}function n(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)}function o(e,t,i,s){var r=e.positions,n=e.object.geometry.positions;n.push(r[t+0]),n.push(r[t+1]),n.push(r[t+2]),n.push(r[i+0]),n.push(r[i+1]),n.push(r[i+2]),n.push(r[s+0]),n.push(r[s+1]),n.push(r[s+2])}function a(e,t){var i=e.positions,s=e.object.geometry.positions;s.push(i[t+0]),s.push(i[t+1]),s.push(i[t+2])}function u(e,t,i,s){var r=e.normals,n=e.object.geometry.normals;n.push(r[t+0]),n.push(r[t+1]),n.push(r[t+2]),n.push(r[i+0]),n.push(r[i+1]),n.push(r[i+2]),n.push(r[s+0]),n.push(r[s+1]),n.push(r[s+2])}function h(e,t,i,s){var r=e.uv,n=e.object.geometry.uv;n.push(r[t+0]),n.push(r[t+1]),n.push(r[i+0]),n.push(r[i+1]),n.push(r[s+0]),n.push(r[s+1])}function l(e,t){var i=e.uv,s=e.object.geometry.uv;s.push(i[t+0]),s.push(i[t+1])}function c(e,t,i,a,l,c,p,d,f,m,v,g,_){var y,b=e.positions.length,x=s(t,b),P=s(i,b),T=s(a,b);if(void 0===l?o(e,x,P,T):(o(e,x,P,y=s(l,b)),o(e,P,T,y)),void 0!==c){var w=e.uv.length;x=n(c,w),P=n(p,w),T=n(d,w),void 0===l?h(e,x,P,T):(h(e,x,P,y=n(f,w)),h(e,P,T,y))}if(void 0!==m){var M=e.normals.length;x=r(m,M),P=m===v?x:r(v,M),T=m===g?x:r(g,M),void 0===l?u(e,x,P,T):(u(e,x,P,y=r(_,M)),u(e,P,T,y))}}function p(e,t,i){e.object.geometry.type="Line";for(var r=e.positions.length,o=e.uv.length,u=0,h=t.length;u<h;u++)a(e,s(t[u],r));for(var c=0,p=i.length;c<p;c++)l(e,n(i[c],o))}}();function Zb(e,t,i){for(var s=t.basePath,r=Object.keys(t.materialLibraries),n=r.length,o=0,a=n;o<a;o++)Qb(e,s,s+r[o],(function(){0==--n&&i()}))}var Qb=function(e,t,i,s){ex(i,(function(i){qb(e,i,t),s()}),(function(t){e.error(t),s()}))},qb=function(){var e=/\s+/;return function(e,r,n){var o,a,u,h,l,c=r.split("\n"),p={id:"Default"},d=!1;n=n||"";for(var f=0;f<c.length;f++)if(0!==(o=c[f].trim()).length&&"#"!==o.charAt(0))switch(u=(u=(a=o.indexOf(" "))>=0?o.substring(0,a):o).toLowerCase(),h=(h=a>=0?o.substring(a+1):"").trim(),u.toLowerCase()){case"newmtl":i(e,p),p={id:h},d=!0;break;case"ka":p.ambient=s(h);break;case"kd":p.diffuse=s(h);break;case"ks":p.specular=s(h);break;case"map_kd":p.diffuseMap||(p.diffuseMap=t(e,n,h,"sRGB"));break;case"map_ks":p.specularMap||(p.specularMap=t(e,n,h,"linear"));break;case"map_bump":case"bump":p.normalMap||(p.normalMap=t(e,n,h));break;case"ns":p.shininess=parseFloat(h);break;case"d":(l=parseFloat(h))<1&&(p.alpha=l,p.alphaMode="blend");break;case"tr":(l=parseFloat(h))>0&&(p.alpha=1-l,p.alphaMode="blend")}d&&i(e,p)};function t(e,t,i,s){var r={},n=i.split(/\s+/),o=n.indexOf("-bm");return o>=0&&n.splice(o,2),(o=n.indexOf("-s"))>=0&&(r.scale=[parseFloat(n[o+1]),parseFloat(n[o+2])],n.splice(o,4)),(o=n.indexOf("-o"))>=0&&(r.translate=[parseFloat(n[o+1]),parseFloat(n[o+2])],n.splice(o,4)),r.src=t+n.join(" ").trim(),r.flipY=!0,r.encoding=s||"linear",new xa(e,r).id}function i(e,t){new Tr(e,t)}function s(t){var i=t.split(e,3);return[parseFloat(i[0]),parseFloat(i[1]),parseFloat(i[2])]}}();function $b(e,t){for(var i=0,s=t.objects.length;i<s;i++){var r=t.objects[i],n=r.geometry;if(n.type,0!==n.positions.length){var o={primitive:"triangles",compressGeometry:!1};o.positions=n.positions,n.normals.length>0&&(o.normals=n.normals),n.uv.length>0&&(o.uv=n.uv);for(var a=new Array(o.positions.length/3),u=0;u<a.length;u++)a[u]=u;o.indices=a;var h=Xb;ke(n.positions,n.positions,h);var l,c=new _r(e,o),p=r.material.id;p&&""!==p?(l=e.scene.components[p])||e.error("Material not found: "+p):l=new Tr(e,{diffuse:[.6,.6,.6],backfaces:!0});var d=new Uo(e,{id:e.id+"#"+r.id,origin:0!==h[0]||0!==h[1]||0!==h[2]?h:null,isObject:!0,geometry:c,material:l,pickable:!0});e.addChild(d)}}}function ex(e,t,i){var s=new XMLHttpRequest;s.open("GET",e,!0),s.addEventListener("load",(function(e){var s=e.target.response;200===this.status?t&&t(s):0===this.status?(console.warn("loadFile: HTTP Status 0 received."),t&&t(s)):i&&i(e)}),!1),s.addEventListener("error",(function(e){i&&i(e)}),!1),s.send(null)}var tx=function(e){g(i,X);var t=y(i);function i(e,s){var r;return w(this,i),(r=t.call(this,"OBJLoader",e,s))._sceneGraphLoader=new Yb,r}return I(i,[{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id);var i=new na(this.viewer.scene,re.apply(t,{isModel:!0})),s=i.id,r=t.src;if(!r)return this.error("load() param expected: src"),i;if(t.metaModelSrc){var n=t.metaModelSrc;re.loadJSON(n,(function(n){e.viewer.metaScene.createMetaModel(s,n),e._sceneGraphLoader.load(i,r,t)}),(function(t){e.error("load(): Failed to load model modelMetadata for model '".concat(s," from  '").concat(n,"' - ").concat(t))}))}else this._sceneGraphLoader.load(i,r,t);return i.once("destroyed",(function(){e.viewer.metaScene.destroyMetaModel(s)})),i}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this)}}]),i}(),ix=new Float64Array([0,0,1]),sx=new Float64Array(4),rx=function(){function e(t){w(this,e),this.id=null,this._viewer=t.viewer,this._visible=!1,this._pos=q.vec3(),this._origin=q.vec3(),this._rtcPos=q.vec3(),this._baseDir=q.vec3(),this._rootNode=null,this._displayMeshes=null,this._affordanceMeshes=null,this._ignoreNextSectionPlaneDirUpdate=!1,this._createNodes(),this._bindEvents()}return I(e,[{key:"_setSectionPlane",value:function(e){var t=this;this._sectionPlane&&(this._sectionPlane.off(this._onSectionPlanePos),this._sectionPlane.off(this._onSectionPlaneDir),this._onSectionPlanePos=null,this._onSectionPlaneDir=null,this._sectionPlane=null),e&&(this.id=e.id,this._setPos(e.pos),this._setDir(e.dir),this._sectionPlane=e,this._onSectionPlanePos=e.on("pos",(function(){t._setPos(t._sectionPlane.pos)})),this._onSectionPlaneDir=e.on("dir",(function(){t._ignoreNextSectionPlaneDirUpdate?t._ignoreNextSectionPlaneDirUpdate=!1:t._setDir(t._sectionPlane.dir)})))}},{key:"sectionPlane",get:function(){return this._sectionPlane}},{key:"_setPos",value:function(e){this._pos.set(e),Ae(this._pos,this._origin,this._rtcPos),this._rootNode.origin=this._origin,this._rootNode.position=this._rtcPos}},{key:"_setDir",value:function(e){this._baseDir.set(e),this._rootNode.quaternion=q.vec3PairToQuaternion(ix,e,sx)}},{key:"_setSectionPlaneDir",value:function(e){this._sectionPlane&&(this._ignoreNextSectionPlaneDirUpdate=!0,this._sectionPlane.dir=e)}},{key:"setVisible",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._visible!==e){var t;for(t in this._visible=e,this._displayMeshes)this._displayMeshes.hasOwnProperty(t)&&(this._displayMeshes[t].visible=e);if(!e)for(t in this._affordanceMeshes)this._affordanceMeshes.hasOwnProperty(t)&&(this._affordanceMeshes[t].visible=e)}}},{key:"getVisible",value:function(){return this._visible}},{key:"setCulled",value:function(e){var t;for(t in this._displayMeshes)this._displayMeshes.hasOwnProperty(t)&&(this._displayMeshes[t].culled=e);if(!e)for(t in this._affordanceMeshes)this._affordanceMeshes.hasOwnProperty(t)&&(this._affordanceMeshes[t].culled=e)}},{key:"_createNodes",value:function(){var e=!1,t=this._viewer.scene,i=.01;this._rootNode=new na(t,{position:[0,0,0],scale:[5,5,5]});var s,r,n=this._rootNode,o={arrowHead:new _r(n,zo({radiusTop:.001,radiusBottom:.07,radialSegments:32,heightSegments:1,height:.2,openEnded:!1})),arrowHeadBig:new _r(n,zo({radiusTop:.001,radiusBottom:.09,radialSegments:32,heightSegments:1,height:.25,openEnded:!1})),arrowHeadHandle:new _r(n,zo({radiusTop:.09,radiusBottom:.09,radialSegments:8,heightSegments:1,height:.37,openEnded:!1})),curve:new _r(n,Fa({radius:.8,tube:i,radialSegments:64,tubeSegments:14,arc:2*Math.PI/4})),curveHandle:new _r(n,Fa({radius:.8,tube:.06,radialSegments:64,tubeSegments:14,arc:2*Math.PI/4})),hoop:new _r(n,Fa({radius:.8,tube:i,radialSegments:64,tubeSegments:8,arc:2*Math.PI})),axis:new _r(n,zo({radiusTop:i,radiusBottom:i,radialSegments:20,heightSegments:1,height:1,openEnded:!1})),axisHandle:new _r(n,zo({radiusTop:.08,radiusBottom:.08,radialSegments:20,heightSegments:1,height:1,openEnded:!1}))},a={pickable:new Tr(n,{diffuse:[1,1,0],alpha:0,alphaMode:"blend"}),red:new Tr(n,{diffuse:[1,0,0],emissive:[1,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),highlightRed:new Mr(n,{edges:!1,fill:!0,fillColor:[1,0,0],fillAlpha:.6}),green:new Tr(n,{diffuse:[0,1,0],emissive:[0,1,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),highlightGreen:new Mr(n,{edges:!1,fill:!0,fillColor:[0,1,0],fillAlpha:.6}),blue:new Tr(n,{diffuse:[0,0,1],emissive:[0,0,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),highlightBlue:new Mr(n,{edges:!1,fill:!0,fillColor:[0,0,1],fillAlpha:.2}),center:new Tr(n,{diffuse:[0,0,0],emissive:[0,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80}),highlightBall:new Mr(n,{edges:!1,fill:!0,fillColor:[.5,.5,.5],fillAlpha:.5,vertices:!1}),highlightPlane:new Mr(n,{edges:!0,edgeWidth:3,fill:!1,fillColor:[.5,.5,.5],fillAlpha:.5,vertices:!1})};this._displayMeshes={plane:n.addChild(new Uo(n,{geometry:new _r(n,{primitive:"triangles",positions:[.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,.5,.5,-0,.5,-.5,-0,-.5,-.5,-0,-.5,.5,-0],indices:[0,1,2,2,3,0]}),material:new Tr(n,{emissive:[0,0,0],diffuse:[0,0,0],backfaces:!0}),opacity:.6,ghosted:!0,ghostMaterial:new Mr(n,{edges:!1,filled:!0,fillColor:[1,1,0],edgeColor:[0,0,0],fillAlpha:.1,backfaces:!0}),pickable:!1,collidable:!0,clippable:!1,visible:!1,scale:[2.4,2.4,1]}),e),planeFrame:n.addChild(new Uo(n,{geometry:new _r(n,Fa({center:[0,0,0],radius:1.7,tube:.02,radialSegments:4,tubeSegments:4,arc:2*Math.PI})),material:new Tr(n,{emissive:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],shininess:0}),highlightMaterial:new Mr(n,{edges:!1,edgeColor:[0,0,0],filled:!0,fillColor:[.8,.8,.8],fillAlpha:1}),pickable:!1,collidable:!1,clippable:!1,visible:!1,scale:[1,1,.1],rotation:[0,0,45]}),e),xCurve:n.addChild(new Uo(n,{geometry:o.curve,material:a.red,matrix:(s=q.rotationMat4v(90*q.DEGTORAD,[0,1,0],q.identityMat4()),r=q.rotationMat4v(270*q.DEGTORAD,[1,0,0],q.identityMat4()),q.mulMat4(r,s,q.identityMat4())),pickable:!1,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),xCurveHandle:n.addChild(new Uo(n,{geometry:o.curveHandle,material:a.pickable,matrix:function(){var e=q.rotationMat4v(90*q.DEGTORAD,[0,1,0],q.identityMat4()),t=q.rotationMat4v(270*q.DEGTORAD,[1,0,0],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),xCurveArrow1:n.addChild(new Uo(n,{geometry:o.arrowHead,material:a.red,matrix:function(){var e=q.translateMat4c(0,-.07,-.8,q.identityMat4()),t=q.scaleMat4v([.6,.6,.6],q.identityMat4()),i=q.rotationMat4v(0*q.DEGTORAD,[0,0,1],q.identityMat4());return q.mulMat4(q.mulMat4(e,t,q.identityMat4()),i,q.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),xCurveArrow2:n.addChild(new Uo(n,{geometry:o.arrowHead,material:a.red,matrix:function(){var e=q.translateMat4c(0,-.8,-.07,q.identityMat4()),t=q.scaleMat4v([.6,.6,.6],q.identityMat4()),i=q.rotationMat4v(90*q.DEGTORAD,[1,0,0],q.identityMat4());return q.mulMat4(q.mulMat4(e,t,q.identityMat4()),i,q.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),yCurve:n.addChild(new Uo(n,{geometry:o.curve,material:a.green,rotation:[-90,0,0],pickable:!1,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),yCurveHandle:n.addChild(new Uo(n,{geometry:o.curveHandle,material:a.pickable,rotation:[-90,0,0],pickable:!0,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),yCurveArrow1:n.addChild(new Uo(n,{geometry:o.arrowHead,material:a.green,matrix:function(){var e=q.translateMat4c(.07,0,-.8,q.identityMat4()),t=q.scaleMat4v([.6,.6,.6],q.identityMat4()),i=q.rotationMat4v(90*q.DEGTORAD,[0,0,1],q.identityMat4());return q.mulMat4(q.mulMat4(e,t,q.identityMat4()),i,q.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),yCurveArrow2:n.addChild(new Uo(n,{geometry:o.arrowHead,material:a.green,matrix:function(){var e=q.translateMat4c(.8,0,-.07,q.identityMat4()),t=q.scaleMat4v([.6,.6,.6],q.identityMat4()),i=q.rotationMat4v(90*q.DEGTORAD,[1,0,0],q.identityMat4());return q.mulMat4(q.mulMat4(e,t,q.identityMat4()),i,q.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zCurve:n.addChild(new Uo(n,{geometry:o.curve,material:a.blue,matrix:q.rotationMat4v(180*q.DEGTORAD,[1,0,0],q.identityMat4()),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zCurveHandle:n.addChild(new Uo(n,{geometry:o.curveHandle,material:a.pickable,matrix:q.rotationMat4v(180*q.DEGTORAD,[1,0,0],q.identityMat4()),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zCurveCurveArrow1:n.addChild(new Uo(n,{geometry:o.arrowHead,material:a.blue,matrix:function(){var e=q.translateMat4c(.8,-.07,0,q.identityMat4()),t=q.scaleMat4v([.6,.6,.6],q.identityMat4());return q.mulMat4(e,t,q.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zCurveArrow2:n.addChild(new Uo(n,{geometry:o.arrowHead,material:a.blue,matrix:function(){var e=q.translateMat4c(.05,-.8,0,q.identityMat4()),t=q.scaleMat4v([.6,.6,.6],q.identityMat4()),i=q.rotationMat4v(90*q.DEGTORAD,[0,0,1],q.identityMat4());return q.mulMat4(q.mulMat4(e,t,q.identityMat4()),i,q.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),center:n.addChild(new Uo(n,{geometry:new _r(n,Wo({radius:.05})),material:a.center,pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),xAxisArrow:n.addChild(new Uo(n,{geometry:o.arrowHead,material:a.red,matrix:function(){var e=q.translateMat4c(0,1.1,0,q.identityMat4()),t=q.rotationMat4v(-90*q.DEGTORAD,[0,0,1],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),xAxisArrowHandle:n.addChild(new Uo(n,{geometry:o.arrowHeadHandle,material:a.pickable,matrix:function(){var e=q.translateMat4c(0,1.1,0,q.identityMat4()),t=q.rotationMat4v(-90*q.DEGTORAD,[0,0,1],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),xAxis:n.addChild(new Uo(n,{geometry:o.axis,material:a.red,matrix:function(){var e=q.translateMat4c(0,.5,0,q.identityMat4()),t=q.rotationMat4v(-90*q.DEGTORAD,[0,0,1],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),xAxisHandle:n.addChild(new Uo(n,{geometry:o.axisHandle,material:a.pickable,matrix:function(){var e=q.translateMat4c(0,.5,0,q.identityMat4()),t=q.rotationMat4v(-90*q.DEGTORAD,[0,0,1],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),yAxisArrow:n.addChild(new Uo(n,{geometry:o.arrowHead,material:a.green,matrix:function(){var e=q.translateMat4c(0,1.1,0,q.identityMat4()),t=q.rotationMat4v(180*q.DEGTORAD,[1,0,0],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),yAxisArrowHandle:n.addChild(new Uo(n,{geometry:o.arrowHeadHandle,material:a.pickable,matrix:function(){var e=q.translateMat4c(0,1.1,0,q.identityMat4()),t=q.rotationMat4v(180*q.DEGTORAD,[1,0,0],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1,opacity:.2}),e),yShaft:n.addChild(new Uo(n,{geometry:o.axis,material:a.green,position:[0,-.5,0],pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),yShaftHandle:n.addChild(new Uo(n,{geometry:o.axisHandle,material:a.pickable,position:[0,-.5,0],pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zAxisArrow:n.addChild(new Uo(n,{geometry:o.arrowHead,material:a.blue,matrix:function(){var e=q.translateMat4c(0,1.1,0,q.identityMat4()),t=q.rotationMat4v(-90*q.DEGTORAD,[.8,0,0],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zAxisArrowHandle:n.addChild(new Uo(n,{geometry:o.arrowHeadHandle,material:a.pickable,matrix:function(){var e=q.translateMat4c(0,1.1,0,q.identityMat4()),t=q.rotationMat4v(-90*q.DEGTORAD,[.8,0,0],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zShaft:n.addChild(new Uo(n,{geometry:o.axis,material:a.blue,matrix:function(){var e=q.translateMat4c(0,.5,0,q.identityMat4()),t=q.rotationMat4v(-90*q.DEGTORAD,[1,0,0],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),clippable:!1,pickable:!1,collidable:!0,visible:!1}),e),zAxisHandle:n.addChild(new Uo(n,{geometry:o.axisHandle,material:a.pickable,matrix:function(){var e=q.translateMat4c(0,.5,0,q.identityMat4()),t=q.rotationMat4v(-90*q.DEGTORAD,[1,0,0],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),clippable:!1,pickable:!0,collidable:!0,visible:!1}),e)},this._affordanceMeshes={planeFrame:n.addChild(new Uo(n,{geometry:new _r(n,Fa({center:[0,0,0],radius:2,tube:i,radialSegments:4,tubeSegments:4,arc:2*Math.PI})),material:new Tr(n,{ambient:[1,1,1],diffuse:[0,0,0],emissive:[1,1,0]}),highlighted:!0,highlightMaterial:new Mr(n,{edges:!1,filled:!0,fillColor:[1,1,0],fillAlpha:1}),pickable:!1,collidable:!1,clippable:!1,visible:!1,scale:[1,1,1],rotation:[0,0,45]}),e),xHoop:n.addChild(new Uo(n,{geometry:o.hoop,material:a.red,highlighted:!0,highlightMaterial:a.highlightRed,matrix:function(){var e=q.rotationMat4v(90*q.DEGTORAD,[0,1,0],q.identityMat4()),t=q.rotationMat4v(270*q.DEGTORAD,[1,0,0],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),yHoop:n.addChild(new Uo(n,{geometry:o.hoop,material:a.green,highlighted:!0,highlightMaterial:a.highlightGreen,rotation:[-90,0,0],pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zHoop:n.addChild(new Uo(n,{geometry:o.hoop,material:a.blue,highlighted:!0,highlightMaterial:a.highlightBlue,matrix:q.rotationMat4v(180*q.DEGTORAD,[1,0,0],q.identityMat4()),pickable:!1,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),xAxisArrow:n.addChild(new Uo(n,{geometry:o.arrowHeadBig,material:a.red,matrix:function(){var e=q.translateMat4c(0,1.1,0,q.identityMat4()),t=q.rotationMat4v(-90*q.DEGTORAD,[0,0,1],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),yAxisArrow:n.addChild(new Uo(n,{geometry:o.arrowHeadBig,material:a.green,matrix:function(){var e=q.translateMat4c(0,1.1,0,q.identityMat4()),t=q.rotationMat4v(180*q.DEGTORAD,[1,0,0],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zAxisArrow:n.addChild(new Uo(n,{geometry:o.arrowHeadBig,material:a.blue,matrix:function(){var e=q.translateMat4c(0,1.1,0,q.identityMat4()),t=q.rotationMat4v(-90*q.DEGTORAD,[.8,0,0],q.identityMat4());return q.mulMat4(t,e,q.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e)}}},{key:"_bindEvents",value:function(){var e=this,t=this,i=!1,s=-1,r=0,n=1,o=2,a=3,u=4,h=5,l=this._rootNode,c=null,p=null,d=q.vec2(),f=q.vec3([1,0,0]),m=q.vec3([0,1,0]),v=q.vec3([0,0,1]),g=this._viewer.scene.canvas.canvas,_=this._viewer.camera,y=this._viewer.scene,b=q.vec3([0,0,0]),x=-1;this._onCameraViewMatrix=y.camera.on("viewMatrix",(function(){})),this._onCameraProjMatrix=y.camera.on("projMatrix",(function(){})),this._onSceneTick=y.on("tick",(function(){var t=Math.abs(q.lenVec3(q.subVec3(y.camera.eye,e._pos,b)));if(t!==x&&"perspective"===_.projection){var i=.07*(Math.tan(_.perspective.fov*q.DEGTORAD)*t);l.scale=[i,i,i],x=t}if("ortho"===_.projection){var s=_.ortho.scale/10;l.scale=[s,s,s],x=t}}));var P,T,w,M,I,C,D,A=function(){var e=new Float64Array(2);return function(t){if(t){for(var i=t.target,s=0,r=0;i.offsetParent;)s+=i.offsetLeft,r+=i.offsetTop,i=i.offsetParent;e[0]=t.pageX-s,e[1]=t.pageY-r}else t=window.event,e[0]=t.x,e[1]=t.y;return e}}(),k=function(){var e=q.mat4();return function(i,s){return q.quaternionToMat4(t._rootNode.quaternion,e),q.transformVec3(e,i,s),q.normalizeVec3(s),s}}(),E=(P=q.vec3(),function(e){var t=Math.abs(e[0]);return t>Math.abs(e[1])&&t>Math.abs(e[2])?q.cross3Vec3(e,[0,1,0],P):q.cross3Vec3(e,[1,0,0],P),q.cross3Vec3(P,e,P),q.normalizeVec3(P),P}),F=(T=q.vec3(),w=q.vec3(),M=q.vec4(),function(e,i,s){k(e,M);var r=E(M,i,s);S(i,r,T),S(s,r,w),q.subVec3(w,T);var n=q.dotVec3(w,M);t._pos[0]+=M[0]*n,t._pos[1]+=M[1]*n,t._pos[2]+=M[2]*n,t._rootNode.position=t._pos,t._sectionPlane&&(t._sectionPlane.pos=t._pos)}),R=function(){var e=q.vec4(),i=q.vec4(),s=q.vec4(),r=q.vec4();return function(n,o,a){if(k(n,r),!(S(o,r,e)&&S(a,r,i))){var u=E(r,o,a);S(o,u,e,1),S(a,u,i,1);var h=q.dotVec3(e,r);e[0]-=h*r[0],e[1]-=h*r[1],e[2]-=h*r[2],h=q.dotVec3(i,r),i[0]-=h*r[0],i[1]-=h*r[1],i[2]-=h*r[2]}q.normalizeVec3(e),q.normalizeVec3(i),h=q.dotVec3(e,i),h=q.clamp(h,-1,1);var l=Math.acos(h)*q.RADTODEG;q.cross3Vec3(e,i,s),q.dotVec3(s,r)<0&&(l=-l),t._rootNode.rotate(n,l),O()}}(),S=(I=q.vec4([0,0,0,1]),C=q.mat4(),function(e,i,s,r){r=r||0,I[0]=e[0]/g.width*2-1,I[1]=-(e[1]/g.height*2-1),I[2]=0,I[3]=1,q.mulMat4(_.projMatrix,_.viewMatrix,C),q.inverseMat4(C),q.transformVec4(C,I,I),q.mulVec4Scalar(I,1/I[3]);var n=_.eye;q.subVec4(I,n,I);var o=t._sectionPlane.pos,a=-q.dotVec3(o,i)-r,u=q.dotVec3(i,I);if(Math.abs(u)>.005){var h=-(q.dotVec3(i,n)+a)/u;return q.mulVec3Scalar(I,h,s),q.addVec3(s,n),q.subVec3(s,o,s),!0}return!1}),O=function(){var e=q.vec3(),i=q.mat4();return function(){t.sectionPlane&&(q.quaternionToMat4(l.quaternion,i),q.transformVec3(i,[0,0,1],e),t._setSectionPlaneDir(e))}}(),B=!1;this._onCameraControlHover=this._viewer.cameraControl.on("hoverEnter",(function(t){if(e._visible&&!B){var l;switch(i=!1,D&&(D.visible=!1),t.entity.id){case e._displayMeshes.xAxisArrowHandle.id:case e._displayMeshes.xAxisHandle.id:l=e._affordanceMeshes.xAxisArrow,c=r;break;case e._displayMeshes.yAxisArrowHandle.id:case e._displayMeshes.yShaftHandle.id:l=e._affordanceMeshes.yAxisArrow,c=n;break;case e._displayMeshes.zAxisArrowHandle.id:case e._displayMeshes.zAxisHandle.id:l=e._affordanceMeshes.zAxisArrow,c=o;break;case e._displayMeshes.xCurveHandle.id:l=e._affordanceMeshes.xHoop,c=a;break;case e._displayMeshes.yCurveHandle.id:l=e._affordanceMeshes.yHoop,c=u;break;case e._displayMeshes.zCurveHandle.id:l=e._affordanceMeshes.zHoop,c=h;break;default:return void(c=s)}l&&(l.visible=!0),D=l,i=!0}})),this._onCameraControlHoverLeave=this._viewer.cameraControl.on("hoverOut",(function(t){e._visible&&(D&&(D.visible=!1),D=null,c=s)})),g.addEventListener("mousedown",this._canvasMouseDownListener=function(t){if(t.preventDefault(),e._visible&&i&&(e._viewer.cameraControl.pointerEnabled=!1,1===t.which)){B=!0;var s=A(t);p=c,d[0]=s[0],d[1]=s[1]}}),g.addEventListener("mousemove",this._canvasMouseMoveListener=function(t){if(e._visible&&B){var i=A(t),s=i[0],l=i[1];switch(p){case r:F(f,d,i);break;case n:F(m,d,i);break;case o:F(v,d,i);break;case a:R(f,d,i);break;case u:R(m,d,i);break;case h:R(v,d,i)}d[0]=s,d[1]=l}}),g.addEventListener("mouseup",this._canvasMouseUpListener=function(t){e._visible&&(e._viewer.cameraControl.pointerEnabled=!0,B&&(t.which,B=!1,i=!1))}),g.addEventListener("wheel",this._canvasWheelListener=function(t){if(e._visible)Math.max(-1,Math.min(1,40*-t.deltaY))})}},{key:"_destroy",value:function(){this._unbindEvents(),this._destroyNodes()}},{key:"_unbindEvents",value:function(){var e=this._viewer,t=e.scene,i=t.canvas.canvas,s=e.camera,r=e.cameraControl;t.off(this._onSceneTick),i.removeEventListener("mousedown",this._canvasMouseDownListener),i.removeEventListener("mousemove",this._canvasMouseMoveListener),i.removeEventListener("mouseup",this._canvasMouseUpListener),i.removeEventListener("wheel",this._canvasWheelListener),s.off(this._onCameraViewMatrix),s.off(this._onCameraProjMatrix),r.off(this._onCameraControlHover),r.off(this._onCameraControlHoverLeave)}},{key:"_destroyNodes",value:function(){this._setSectionPlane(null),this._rootNode.destroy(),this._displayMeshes={},this._affordanceMeshes={}}}]),e}(),nx=function(){function e(t,i,s){var r=this;w(this,e),this.id=s.id,this._sectionPlane=s,this._mesh=new Uo(i,{id:s.id,geometry:new _r(i,yr({xSize:.5,ySize:.5,zSize:.001})),material:new Tr(i,{emissive:[1,1,1],diffuse:[0,0,0],backfaces:!1}),edgeMaterial:new Cr(i,{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),highlightMaterial:new Mr(i,{fill:!0,fillColor:[.5,1,.5],fillAlpha:.7,edges:!0,edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),selectedMaterial:new Mr(i,{fill:!0,fillColor:[0,0,1],fillAlpha:.7,edges:!0,edgeColor:[1,0,0],edgeAlpha:1,edgeWidth:1}),highlighted:!0,scale:[3,3,3],position:[0,0,0],rotation:[0,0,0],opacity:.3,edges:!0});var n=q.vec3([0,0,0]),o=q.vec3(),a=q.vec3([0,0,1]),u=q.vec4(4),h=q.vec3(),l=function(){var e=r._sectionPlane.scene.center,t=[-r._sectionPlane.dir[0],-r._sectionPlane.dir[1],-r._sectionPlane.dir[2]];q.subVec3(e,r._sectionPlane.pos,n);var i=-q.dotVec3(t,n);q.normalizeVec3(t),q.mulVec3Scalar(t,i,o);var s=q.vec3PairToQuaternion(a,r._sectionPlane.dir,u);h[0]=.1*o[0],h[1]=.1*o[1],h[2]=.1*o[2],r._mesh.quaternion=s,r._mesh.position=h};this._onSectionPlanePos=this._sectionPlane.on("pos",l),this._onSectionPlaneDir=this._sectionPlane.on("dir",l),this._highlighted=!1,this._selected=!1}return I(e,[{key:"setHighlighted",value:function(e){this._highlighted=!!e,this._mesh.highlighted=this._highlighted,this._mesh.highlightMaterial.fillColor=e?[0,.7,0]:[0,0,0]}},{key:"getHighlighted",value:function(){return this._highlighted}},{key:"setSelected",value:function(e){this._selected=!!e,this._mesh.edgeMaterial.edgeWidth=e?3:1,this._mesh.highlightMaterial.edgeWidth=e?3:1}},{key:"getSelected",value:function(){return this._selected}},{key:"destroy",value:function(){this._sectionPlane.off(this._onSectionPlanePos),this._sectionPlane.off(this._onSectionPlaneDir),this._mesh.destroy()}}]),e}(),ox=function(){function e(t,i){var s=this;if(w(this,e),!(i.onHoverEnterPlane&&i.onHoverLeavePlane&&i.onClickedNothing&&i.onClickedPlane))throw"Missing config(s): onHoverEnterPlane, onHoverLeavePlane, onClickedNothing || onClickedPlane";this.plugin=t,this._viewer=t.viewer,this._onHoverEnterPlane=i.onHoverEnterPlane,this._onHoverLeavePlane=i.onHoverLeavePlane,this._onClickedNothing=i.onClickedNothing,this._onClickedPlane=i.onClickedPlane,this._visible=!0,this._planes={},this._canvas=i.overviewCanvas,this._scene=new Br(this._viewer,{canvasId:this._canvas.id,transparent:!0}),this._scene.clearLights(),new dr(this._scene,{dir:[.4,-.4,.8],color:[.8,1,1],intensity:1,space:"view"}),new dr(this._scene,{dir:[-.8,-.3,-.4],color:[.8,.8,.8],intensity:1,space:"view"}),new dr(this._scene,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"}),this._scene.camera,this._scene.camera.perspective.fov=70,this._zUp=!1;var r=this._scene.camera,n=q.rotationMat4c(-90*q.DEGTORAD,1,0,0),o=q.vec3(),a=q.vec3(),u=q.vec3();this._synchCamera=function(){var e=s._viewer.camera.eye,t=s._viewer.camera.look,i=s._viewer.camera.up;q.mulVec3Scalar(q.normalizeVec3(q.subVec3(e,t,o)),7),s._zUp?(q.transformVec3(n,o,a),q.transformVec3(n,i,u),r.look=[0,0,0],r.eye=q.transformVec3(n,o,a),r.up=q.transformPoint3(n,i,u)):(r.look=[0,0,0],r.eye=o,r.up=i)},this._onViewerCameraMatrix=this._viewer.camera.on("matrix",this._synchCamera),this._onViewerCameraWorldAxis=this._viewer.camera.on("worldAxis",this._synchCamera),this._onViewerCameraFOV=this._viewer.camera.perspective.on("fov",(function(e){s._scene.camera.perspective.fov=e}));var h=null;this._onInputMouseMove=this._scene.input.on("mousemove",(function(e){var t=s._scene.pick({canvasPos:e});if(t){if(!h||t.entity.id!==h.id){if(h)s._planes[h.id]&&s._onHoverLeavePlane(h.id);h=t.entity,s._planes[h.id]&&s._onHoverEnterPlane(h.id)}}else h&&(s._onHoverLeavePlane(h.id),h=null)})),this._scene.canvas.canvas.addEventListener("mouseup",this._onCanvasMouseUp=function(){h?s._planes[h.id]&&s._onClickedPlane(h.id):s._onClickedNothing()}),this._scene.canvas.canvas.addEventListener("mouseout",this._onCanvasMouseOut=function(){h&&(s._onHoverLeavePlane(h.id),h=null)}),this.setVisible(i.overviewVisible)}return I(e,[{key:"addSectionPlane",value:function(e){this._planes[e.id]=new nx(this,this._scene,e)}},{key:"setPlaneHighlighted",value:function(e,t){var i=this._planes[e];i&&i.setHighlighted(t)}},{key:"setPlaneSelected",value:function(e,t){var i=this._planes[e];i&&i.setSelected(t)}},{key:"removeSectionPlane",value:function(e){var t=this._planes[e.id];t&&(t.destroy(),delete this._planes[e.id])}},{key:"setVisible",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._visible=e,this._canvas.style.visibility=e?"visible":"hidden"}},{key:"getVisible",value:function(){return this._visible}},{key:"destroy",value:function(){this._viewer.camera.off(this._onViewerCameraMatrix),this._viewer.camera.off(this._onViewerCameraWorldAxis),this._viewer.camera.perspective.off(this._onViewerCameraFOV),this._scene.input.off(this._onInputMouseMove),this._scene.canvas.canvas.removeEventListener("mouseup",this._onCanvasMouseUp),this._scene.canvas.canvas.removeEventListener("mouseout",this._onCanvasMouseOut),this._scene.destroy()}}]),e}(),ax=q.AABB3(),ux=q.vec3(),hx=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(w(this,i),(s=t.call(this,"SectionPlanes",e))._freeControls=[],s._sectionPlanes=e.scene.sectionPlanes,s._controls={},s._shownControlId=null,null!==r.overviewCanvasId&&void 0!==r.overviewCanvasId){var n=document.getElementById(r.overviewCanvasId);n?s._overview=new ox(x(s),{overviewCanvas:n,visible:r.overviewVisible,onHoverEnterPlane:function(e){s._overview.setPlaneHighlighted(e,!0)},onHoverLeavePlane:function(e){s._overview.setPlaneHighlighted(e,!1)},onClickedPlane:function(e){if(s.getShownControl()!==e){s.showControl(e);var t=s.sectionPlanes[e].pos;ax.set(s.viewer.scene.aabb),q.getAABB3Center(ax,ux),ax[0]+=t[0]-ux[0],ax[1]+=t[1]-ux[1],ax[2]+=t[2]-ux[2],ax[3]+=t[0]-ux[0],ax[4]+=t[1]-ux[1],ax[5]+=t[2]-ux[2],s.viewer.cameraFlight.flyTo({aabb:ax,fitFOV:65})}else s.hideControl()},onClickedNothing:function(){s.hideControl()}}):s.warn("Can't find overview canvas: '"+r.overviewCanvasId+"' - will create plugin without overview")}return s._onSceneSectionPlaneCreated=e.scene.on("sectionPlaneCreated",(function(e){s._sectionPlaneCreated(e)})),s}return I(i,[{key:"setOverviewVisible",value:function(e){this._overview&&this._overview.setVisible(e)}},{key:"getOverviewVisible",value:function(){if(this._overview)return this._overview.getVisible()}},{key:"sectionPlanes",get:function(){return this._sectionPlanes}},{key:"createSectionPlane",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0!==e.id&&null!==e.id&&this.viewer.scene.components[e.id]&&(this.error("Viewer component with this ID already exists: "+e.id),delete e.id);var t=new Jo(this.viewer.scene,{id:e.id,pos:e.pos,dir:e.dir,active:!0});return t}},{key:"_sectionPlaneCreated",value:function(e){var t=this,i=this._freeControls.length>0?this._freeControls.pop():new rx(this);i._setSectionPlane(e),i.setVisible(!1),this._controls[e.id]=i,this._overview&&this._overview.addSectionPlane(e),e.once("destroyed",(function(){t._sectionPlaneDestroyed(e)}))}},{key:"flipSectionPlanes",value:function(){var e=this.viewer.scene.sectionPlanes;for(var t in e){e[t].flipDir()}}},{key:"showControl",value:function(e){var t=this._controls[e];t?(this.hideControl(),t.setVisible(!0),this._overview&&this._overview.setPlaneSelected(e,!0),this._shownControlId=e):this.error("Control not found: "+e)}},{key:"getShownControl",value:function(){return this._shownControlId}},{key:"hideControl",value:function(){for(var e in this._controls)this._controls.hasOwnProperty(e)&&(this._controls[e].setVisible(!1),this._overview&&this._overview.setPlaneSelected(e,!1));this._shownControlId=null}},{key:"destroySectionPlane",value:function(e){var t=this.viewer.scene.sectionPlanes[e];t?(this._sectionPlaneDestroyed(t),t.destroy(),e===this._shownControlId&&(this._shownControlId=null)):this.error("SectionPlane not found: "+e)}},{key:"_sectionPlaneDestroyed",value:function(e){this._overview&&this._overview.removeSectionPlane(e);var t=this._controls[e.id];t&&(t.setVisible(!1),t._setSectionPlane(null),delete this._controls[e.id],this._freeControls.push(t))}},{key:"clear",value:function(){for(var e=Object.keys(this._sectionPlanes),t=0,i=e.length;t<i;t++)this.destroySectionPlane(e[t])}},{key:"send",value:function(e,t){switch(e){case"snapshotStarting":for(var i in this._controls)this._controls.hasOwnProperty(i)&&this._controls[i].setCulled(!0);break;case"snapshotFinished":for(var s in this._controls)this._controls.hasOwnProperty(s)&&this._controls[s].setCulled(!1);break;case"clearSectionPlanes":this.clear()}}},{key:"destroy",value:function(){this.clear(),this._overview&&this._overview.destroy(),this._destroyFreeControls(),m(P(i.prototype),"destroy",this).call(this)}},{key:"_destroyFreeControls",value:function(){for(var e=this._freeControls.pop();e;)e._destroy(),e=this._freeControls.pop();this.viewer.scene.off(this._onSceneSectionPlaneCreated)}}]),i}(),lx=function(e){g(i,X);var t=y(i);function i(e){var s;return w(this,i),(s=t.call(this,"skyboxes",e)).skyboxes={},s}return I(i,[{key:"send",value:function(e,t){if("clear"===e)this.clear()}},{key:"createSkybox",value:function(e,t){if(this.viewer.scene.components[e])return this.error("Component with this ID already exists: "+e),this;var i=new Lp(this.viewer.scene,{id:e,pos:t.pos,dir:t.dir,active:!0});return this.skyboxes[e]=i,i}},{key:"destroySkybox",value:function(e){var t=this.skyboxes[e];t?t.destroy():this.error("Skybox not found: "+e)}},{key:"clear",value:function(){for(var e=Object.keys(this.viewer.scene.skyboxes),t=0,i=e.length;t<i;t++)this.destroySkybox(e[t])}},{key:"destroy",value:function(){this.clear(),m(P(i.prototype),"clear",this).call(this)}}]),i}(),cx=function(){function e(){w(this,e)}return I(e,[{key:"getSTL",value:function(e,t,i){var s=new XMLHttpRequest;s.overrideMimeType("application/json"),s.open("GET",e,!0),s.responseType="arraybuffer",s.onreadystatechange=function(){4===s.readyState&&(200===s.status?t(s.response):i(s.statusText))},s.send(null)}}]),e}(),px=q.vec3(),dx=function(){function e(){w(this,e)}return I(e,[{key:"load",value:function(e,t,i,s,r,n){s=s||{};var o=e.viewer.scene.canvas.spinner;o.processes++,e.dataSource.getSTL(i,(function(i){!function(e,t,i,s){try{var r=yx(i);fx(r)?mx(e,r,t,s):vx(e,_x(i),t,s)}catch(e){t.fire("error",e)}}(e,t,i,s);try{var a=yx(i);fx(a)?mx(e,a,t,s):vx(e,_x(i),t,s),o.processes--,pe.scheduleTask((function(){t.fire("loaded",!0,!1)})),r&&r()}catch(i){o.processes--,e.error(i),n&&n(i),t.fire("error",i)}}),(function(i){o.processes--,e.error(i),n&&n(i),t.fire("error",i)}))}},{key:"parse",value:function(e,t,i,s){var r=e.viewer.scene.canvas.spinner;r.processes++;try{var n=yx(i);fx(n)?mx(e,n,t,s):vx(e,_x(i),t,s),r.processes--,pe.scheduleTask((function(){t.fire("loaded",!0,!1)}))}catch(e){r.processes--,t.fire("error",e)}}}]),e}();function fx(e){var t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;for(var i=[115,111,108,105,100],s=0;s<5;s++)if(i[s]!==t.getUint8(s,!1))return!0;return!1}function mx(e,t,i,s){for(var r,n,o,a,u,h,l,c=new DataView(t),p=c.getUint32(80,!0),d=!1,f=null,m=null,v=null,g=!1,_=0;_<70;_++)1129270351===c.getUint32(_,!1)&&82===c.getUint8(_+4)&&61===c.getUint8(_+5)&&(d=!0,a=[],u=c.getUint8(_+6)/255,h=c.getUint8(_+7)/255,l=c.getUint8(_+8)/255,c.getUint8(_+9));for(var y=new ha(i,{roughness:.5}),b=[],x=[],P=s.splitMeshes,T=0;T<p;T++){var w=84+50*T,M=c.getFloat32(w,!0),I=c.getFloat32(w+4,!0),C=c.getFloat32(w+8,!0);if(d){var D=c.getUint16(w+48,!0);0==(32768&D)?(r=(31&D)/31,n=(D>>5&31)/31,o=(D>>10&31)/31):(r=u,n=h,o=l),(P&&r!==f||n!==m||o!==v)&&(null!==f&&(g=!0),f=r,m=n,v=o)}for(var A=1;A<=3;A++){var k=w+12*A;b.push(c.getFloat32(k,!0)),b.push(c.getFloat32(k+4,!0)),b.push(c.getFloat32(k+8,!0)),x.push(M,I,C),d&&a.push(r,n,o,1)}P&&g&&(gx(i,b,x,a,y,s),b=[],x=[],a=a?[]:null,g=!1)}b.length>0&&gx(i,b,x,a,y,s)}function vx(e,t,i,s){for(var r,n,o,a,u,h,l,c=/facet([\s\S]*?)endfacet/g,p=0,d=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,f=new RegExp("vertex"+d+d+d,"g"),m=new RegExp("normal"+d+d+d,"g"),v=[],g=[];null!==(a=c.exec(t));){for(u=0,h=0,l=a[0];null!==(a=m.exec(l));)r=parseFloat(a[1]),n=parseFloat(a[2]),o=parseFloat(a[3]),h++;for(;null!==(a=f.exec(l));)v.push(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3])),g.push(r,n,o),u++;1!==h&&e.error("Error in normal of face "+p),3!==u&&e.error("Error in positions of face "+p),p++}gx(i,v,g,null,new ha(i,{roughness:.5}),s)}function gx(e,t,i,s,r,n){for(var o=new Int32Array(t.length/3),a=0,u=o.length;a<u;a++)o[a]=a;i=i&&i.length>0?i:null,s=s&&s.length>0?s:null,n.smoothNormals&&q.faceToVertexNormals(t,i,n);var h=px;ke(t,t,h);var l=new _r(e,{primitive:"triangles",positions:t,normals:i,colors:s,indices:o}),c=new Uo(e,{origin:0!==h[0]||0!==h[1]||0!==h[2]?h:null,geometry:l,material:r,edges:n.edges});e.addChild(c)}function _x(e){return"string"!=typeof e?function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",i=0,s=e.length;i<s;i++)t+=String.fromCharCode(e[i]);return decodeURIComponent(escape(t))}(new Uint8Array(e)):e}function yx(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=255&e.charCodeAt(i);return t.buffer||t}return e}var bx=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,"STLLoader",e,r))._sceneGraphLoader=new dx,s.dataSource=r.dataSource,s}return I(i,[{key:"dataSource",get:function(){return this._dataSource},set:function(e){this._dataSource=e||new cx}},{key:"load",value:function(e){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);var t=new na(this.viewer.scene,re.apply(e,{isModel:!0})),i=e.src,s=e.stl;return i||s?(i?this._sceneGraphLoader.load(this,t,i,e):this._sceneGraphLoader.parse(this,t,s,e),t):(this.error("load() param expected: either 'src' or 'stl'"),t)}}]),i}(),xx=I((function e(t,i,s,r,n){w(this,e),this.plugin=t,this.storeyId=r,this.modelId=s,this.aabb=i.slice(),this.numObjects=n})),Px={IfcSlab:{visible:!0,edges:!1,colorize:[1,1,1,1]},IfcWall:{visible:!0,edges:!1,colorize:[.1,.1,.1,1]},IfcWallStandardCase:{visible:!0,edges:!1,colorize:[.1,.1,.1,1]},IfcDoor:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcWindow:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcColumn:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcCurtainWall:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcStair:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcStairFlight:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcRamp:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcFurniture:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcFooting:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcFloor:{visible:!0,edges:!1,colorize:[1,1,1,1]},DEFAULT:{visible:!1}},Tx=I((function e(t,i,s,r,n,o){w(this,e),this.storeyId=t,this.imageData=i,this.format=s,this.width=r,this.height=n})),wx=q.vec3(),Mx=q.mat4(),Ix="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==",Cx=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,"StoreyViews",e))._objectsMemento=new Eu,s._cameraMemento=new Cu,s.storeys={},s.modelStoreys={},s.objectStates=r.objectStates,s._onModelLoaded=s.viewer.scene.on("modelLoaded",(function(e){s._registerModelStoreys(e),s.fire("storeys",s.storeys)})),s}return I(i,[{key:"_registerModelStoreys",value:function(e){var t=this,i=this.viewer,s=i.scene,r=i.metaScene,n=r.metaModels[e],o=s.models[e];if(n&&n.rootMetaObject)for(var a=n.rootMetaObject.getObjectIDsInSubtreeByType(["IfcBuildingStorey"]),u=0,h=a.length;u<h;u++){var l=a[u],c=r.metaObjects[l].getObjectIDsInSubtree(),p=s.getAABB(c),d=Math.random()>.5?c.length:0,f=new xx(this,p,e,l,d);f._onModelDestroyed=o.once("destroyed",(function(){t._deregisterModelStoreys(e),t.fire("storeys",t.storeys)})),this.storeys[l]=f,this.modelStoreys[e]||(this.modelStoreys[e]={}),this.modelStoreys[e][l]=f}}},{key:"_deregisterModelStoreys",value:function(e){var t=this.modelStoreys[e];if(t){var i=this.viewer.scene;for(var s in t)if(t.hasOwnProperty(s)){var r=t[s],n=i.models[r.modelId];n&&n.off(r._onModelDestroyed),delete this.storeys[s]}delete this.modelStoreys[e]}}},{key:"objectStates",get:function(){return this._objectStates},set:function(e){this._objectStates=e||Px}},{key:"gotoStoreyCamera",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.storeys[e];if(!i)return this.error("IfcBuildingStorey not found with this ID: "+e),void(t.done&&t.done());var s=this.viewer,r=s.scene,n=r.camera,o=i.aabb;if(o[3]<o[0]||o[4]<o[1]||o[5]<o[2])t.done&&t.done();else if(o[3]!==o[0]||o[4]!==o[1]||o[5]!==o[2]){var a=q.getAABB3Center(o),u=q.getAABB3Diag(o),h=45,l=Math.abs(u/Math.tan(h*q.DEGTORAD)),c=1.3*u,p=wx;p[0]=a[0]+n.worldUp[0]*l,p[1]=a[1]+n.worldUp[1]*l,p[2]=a[2]+n.worldUp[2]*l;var d=n.worldForward;t.done?s.cameraFlight.flyTo(re.apply(t,{eye:p,look:a,up:d,orthoScale:c}),(function(){t.done()})):(s.cameraFlight.jumpTo(re.apply(t,{eye:p,look:a,up:d,orthoScale:c})),s.camera.ortho.scale=c)}else t.done&&t.done()}},{key:"showStoreyObjects",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.storeys[e];if(s){var r=this.viewer,n=r.scene,o=r.metaScene,a=o.metaObjects[e];a&&(i.hideOthers&&n.setObjectsVisible(r.scene.visibleObjectIds,!1),this.withStoreyObjects(e,(function(e,s){if(e)if(i.useObjectStates){var r=t._objectStates[s.type]||t._objectStates.DEFAULT;r&&(e.visible=r.visible,e.edges=r.edges,r.colorize&&(e.colorize=r.colorize),null!==r.opacity&&void 0!==r.opacity&&(e.opacity=r.opacity))}else e.visible=!0})))}else this.error("IfcBuildingStorey not found with this ID: "+e)}},{key:"withStoreyObjects",value:function(e,t){var i=this.viewer,s=i.scene,r=i.metaScene,n=r.metaObjects[e];if(n)for(var o=n.getObjectIDsInSubtree(),a=0,u=o.length;a<u;a++){var h=o[a],l=r.metaObjects[h],c=s.objects[h];c&&t(c,l)}}},{key:"createStoreyMap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.storeys[e];if(!i)return this.error("IfcBuildingStorey not found with this ID: "+e),Ix;var s,r,n=this.viewer,o=n.scene,a=t.format||"png",u=i.aabb,h=(u[5]-u[2])/(u[3]-u[0]),l=t.padding||0;t.width&&t.height?(s=t.width,r=t.height):t.height?s=(r=t.height)/h:r=t.width?(s=t.width)*h:(s=300)*h,this._objectsMemento.saveObjects(o),this._cameraMemento.saveCamera(o),n.beginSnapshot(),this.showStoreyObjects(e,re.apply(t,{useObjectStates:!0,hideOthers:!0})),this._arrangeStoreyMapCamera(i);var c=n.getSnapshot({width:s,height:r,format:a});return this._objectsMemento.restoreObjects(o),this._cameraMemento.restoreCamera(o),n.endSnapshot(),new Tx(e,c,a,s,r,l)}},{key:"_arrangeStoreyMapCamera",value:function(e){var t=this.viewer,i=t.scene.camera,s=e.aabb,r=q.getAABB3Center(s),n=wx;n[0]=r[0]+.5*i.worldUp[0],n[1]=r[1]+.5*i.worldUp[1],n[2]=r[2]+.5*i.worldUp[2];var o=i.worldForward;t.cameraFlight.jumpTo({eye:n,look:r,up:o});var a=(s[3]-s[0])/2,u=(s[4]-s[1])/2,h=(s[5]-s[2])/2,l=-a,c=+a,p=-u,d=+u,f=-h,m=+h;t.camera.customProjection.matrix=q.orthoMat4c(l,c,f,m,p,d,Mx),t.camera.projection="customProjection"}},{key:"pickStoreyMap",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=e.storeyId,r=this.storeys[s];if(!r)return this.error("IfcBuildingStorey not found with this ID: "+s),null;var n=1-t[0]/e.width,o=1-t[1]/e.height,a=r.aabb,u=a[0],h=a[1],l=a[2],c=a[3],p=a[4],d=a[5],f=c-u,m=p-h,v=d-l,g=q.vec3([u+f*n,h+.5*m,l+v*o]),_=q.vec3([0,-1,0]),y=q.addVec3(g,_,wx),b=this.viewer.camera.worldForward,x=q.lookAtMat4v(g,y,b,Mx),P=this.viewer.scene.pick({pickSurface:i.pickSurface,pickInvisible:!0,matrix:x});if(P){var T=this.viewer.metaScene.metaObjects[P.entity.id],w=this.objectStates[T.type];if(!w||!w.visible)return null}return P}},{key:"getStoreyContainingWorldPos",value:function(e){for(var t in this.storeys){var i=this.storeys[t];if(q.point3AABB3Intersect(i.aabb,e))return t}return null}},{key:"worldPosToStoreyMap",value:function(e,t,i){var s=e.storeyId,r=this.storeys[s];if(!r)return this.error("IfcBuildingStorey not found with this ID: "+s),!1;var n=r.aabb,o=n[0],a=n[1],u=n[2],h=n[3]-o,l=n[4]-a,c=n[5]-u,p=this.viewer.camera.worldUp,d=p[0]>p[1]&&p[0]>p[2],f=!d&&p[1]>p[0]&&p[1]>p[2];!d&&!f&&p[2]>p[0]&&(p[2],p[1]);var m=e.width/h,v=f?e.height/c:e.height/l;return i[0]=Math.floor(e.width-(t[0]-o)*m),i[1]=Math.floor(e.height-(t[2]-u)*v),i[0]>=0&&i[0]<e.width&&i[1]>=0&&i[1]<=e.height}},{key:"worldDirToStoreyMap",value:function(e,t,i){var s=this.viewer.camera,r=s.eye,n=s.look,o=q.subVec3(n,r,wx),a=s.worldUp,u=a[0]>a[1]&&a[0]>a[2],h=!u&&a[1]>a[0]&&a[1]>a[2];!u&&!h&&a[2]>a[0]&&(a[2],a[1]),u?(i[0]=o[1],i[1]=o[2]):h?(i[0]=o[0],i[1]=o[2]):(i[0]=o[0],i[1]=o[1]),q.normalizeVec2(i)}},{key:"destroy",value:function(){this.viewer.scene.off(this._onModelLoaded),m(P(i.prototype),"destroy",this).call(this)}}]),i}(),Dx=[],Ax=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(w(this,i),(s=t.call(this,"TreeViewPlugin",e)).errors=[],s.valid=!0,!r.containerElement)return s.error("Config expected: containerElement"),b(s);for(var n=0;;n++)if(!Dx[n]){Dx[n]=x(s),s._index=n,s._id="tree-".concat(n);break}if(s._containerElement=r.containerElement,s._metaModels={},s._autoAddModels=!1!==r.autoAddModels,s._autoExpandDepth=r.autoExpandDepth||0,s._sortNodes=!1!==r.sortNodes,s._pruneEmptyNodes=!1!==r.pruneEmptyNodes,s._viewer=e,s._rootElement=null,s._muteSceneEvents=!1,s._muteTreeEvents=!1,s._rootNodes=[],s._objectNodes={},s._nodeNodes={},s._rootName=r.rootName,s._sortNodes=r.sortNodes,s._pruneEmptyNodes=r.pruneEmptyNodes,s._showListItemElementId=null,s._containerElement.oncontextmenu=function(e){e.preventDefault()},s._onObjectVisibility=s._viewer.scene.on("objectVisibility",(function(e){if(!s._muteSceneEvents){var t=e.id,i=s._objectNodes[t];if(i){var r=e.visible;if(r!==i.checked){s._muteTreeEvents=!0,i.checked=r,r?i.numVisibleEntities++:i.numVisibleEntities--;var n=document.getElementById("checkbox-".concat(i.nodeId));n&&(n.checked=r);for(var o=i.parent;o;){o.checked=r,r?o.numVisibleEntities++:o.numVisibleEntities--;var a=document.getElementById("checkbox-".concat(o.nodeId));if(a){var u=o.numVisibleEntities>0;u!==a.checked&&(a.checked=u)}o=o.parent}s._muteTreeEvents=!1}}}})),s._onObjectXrayed=s._viewer.scene.on("objectXRayed",(function(e){if(!s._muteSceneEvents){var t=e.id,i=s._objectNodes[t];if(i){s._muteTreeEvents=!0;var r=e.xrayed;if(r!==i.xrayed){i.xrayed=r;var n=i.nodeId,o=document.getElementById(n);null!==o&&(r?o.classList.add("xrayed-node"):o.classList.remove("xrayed-node")),s._muteTreeEvents=!1}}}})),s._switchExpandHandler=function(e){e.preventDefault(),e.stopPropagation();var t=e.target;s._expandSwitchElement(t)},s._switchCollapseHandler=function(e){e.preventDefault(),e.stopPropagation();var t=e.target;s._collapseSwitchElement(t)},s._checkboxChangeHandler=function(e){if(!s._muteTreeEvents){s._muteSceneEvents=!0;var t=e.target,i=t.checked,r=t.id.replace("checkbox-",""),n=s._nodeNodes[r],o=s._viewer.scene.objects,a=0;s._withNodeTree(n,(function(e){var t=e.objectId,s="checkbox-".concat(e.nodeId),r=o[t],n=0===e.children.length;e.numVisibleEntities=i?e.numEntities:0,n&&i!==e.checked&&a++,e.checked=i;var u=document.getElementById(s);u&&(u.checked=i),r&&(r.visible=i)}));for(var u=n.parent;u;){u.checked=i;var h=document.getElementById("checkbox-".concat(u.nodeId));i?u.numVisibleEntities+=a:u.numVisibleEntities-=a;var l=u.numVisibleEntities>0;l!==h.checked&&(h.checked=l),u=u.parent}s._muteSceneEvents=!1}},s._hierarchy=r.hierarchy||"containment",s._autoExpandDepth=r.autoExpandDepth||0,s._autoAddModels){for(var o=Object.keys(s.viewer.metaScene.metaModels),a=0,u=o.length;a<u;a++){var h=o[a];s.addModel(h)}s.viewer.scene.on("modelLoaded",(function(e){s.viewer.metaScene.metaModels[e]&&s.addModel(e)}))}return s.hierarchy=r.hierarchy,s}return I(i,[{key:"hierarchy",get:function(){return this._hierarchy},set:function(e){"containment"!==(e=e||"containment")&&"storeys"!==e&&"types"!==e&&(this.error("Unsupported value for `hierarchy' - defaulting to 'containment'"),e="containment"),this._hierarchy!==e&&(this._hierarchy=e,this._createNodes())}},{key:"addModel",value:function(e){var t=this;if(this._containerElement){var i=this.viewer.scene.models[e];if(!i)throw"Model not found: "+e;var s=this.viewer.metaScene.metaModels[e];s?this._metaModels[e]?this.warn("Model already added: "+e):(this._metaModels[e]=s,i.on("destroyed",(function(){t.removeModel(i.id)})),this._createNodes()):this.error("MetaModel not found: "+e)}}},{key:"removeModel",value:function(e){this._containerElement&&(this._metaModels[e]&&(delete this._metaModels[e],this._createNodes()))}},{key:"showNode",value:function(e){this._showListItemElementId&&this.unShowNode();var t=this._objectNodes[e];if(t){var i=t.nodeId,s="switch-"+i,r=document.getElementById(s);if(r)return this._expandSwitchElement(r),void r.scrollIntoView();var n=[];n.unshift(t);for(var o=t.parent;o;)n.unshift(o),o=o.parent;for(var a=0,u=n.length;a<u;a++){var h="switch-"+n[a].nodeId,l=document.getElementById(h);l&&this._expandSwitchElement(l)}var c=i,p=document.getElementById(c);p.scrollIntoView({block:"center"}),p.classList.add("highlighted-node"),this._showListItemElementId=c}}},{key:"unShowNode",value:function(){if(this._showListItemElementId){var e=document.getElementById(this._showListItemElementId);e?(e.classList.remove("highlighted-node"),this._showListItemElementId=null):this._showListItemElementId=null}}},{key:"expandToDepth",value:function(e){var t=this;this.collapse();for(var i=function i(s,r){if(r!==e){var n="switch-"+s.nodeId,o=document.getElementById(n);if(o){t._expandSwitchElement(o);for(var a=s.children,u=0,h=a.length;u<h;u++){i(a[u],r+1)}}}},s=0,r=this._rootNodes.length;s<r;s++){i(this._rootNodes[s],0)}}},{key:"collapse",value:function(){for(var e=0,t=this._rootNodes.length;e<t;e++){var i=this._rootNodes[e].objectId;this._collapseNode(i)}}},{key:"withNodeTree",value:function(e,t){t(e);var i=e.children;if(i)for(var s=0,r=i.length;s<r;s++)this.withNodeTree(i[s],t)}},{key:"destroy",value:function(){this._containerElement&&(this._metaModels={},this._rootElement&&!this._destroyed&&(this._rootElement.parentNode.removeChild(this._rootElement),this._viewer.scene.off(this._onObjectVisibility),this._destroyed=!0),delete Dx[this._index],m(P(i.prototype),"destroy",this).call(this))}},{key:"_createNodes",value:function(){this._rootElement&&(this._rootElement.parentNode.removeChild(this._rootElement),this._rootElement=null),this._rootNodes=[],this._objectNodes={},this._nodeNodes={},this._validate(),this.valid||"storeys"!==this._hierarchy?this._createEnabledNodes():this._createDisabledNodes()}},{key:"_validate",value:function(){if(this.errors=[],"storeys"===this._hierarchy)this.valid=this._validateMetaModelForStoreysHierarchy();else this.valid=this._rootNodes.length>0;return this.valid}},{key:"_validateMetaModelForStoreysHierarchy",value:function(){return!0}},{key:"_createEnabledNodes",value:function(){switch(this._pruneEmptyNodes&&this._findEmptyNodes(),this._hierarchy){case"storeys":this._createStoreysNodes(),0===this._rootNodes.length&&this.error("Failed to build storeys hierarchy");break;case"types":this._createTypesNodes();break;default:this._createContainmentNodes()}this._sortNodes&&this._doSortNodes(),this._synchNodesToEntities(),this._createTrees(),this.expandToDepth(this._autoExpandDepth)}},{key:"_createDisabledNodes",value:function(){var e=document.createElement("ul");this._rootElement=e,this._containerElement.appendChild(e);var t=this._viewer.metaScene.rootMetaObjects;for(var i in t){var s=t[i],r=s.type,n=s.name,o=n&&""!==n&&"Undefined"!==n&&"Default"!==n?n:r,a=document.createElement("li");e.appendChild(a);var u=document.createElement("a");u.href="#",u.textContent="!",u.classList.add("warn"),u.classList.add("warning"),a.appendChild(u);var h=document.createElement("span");h.textContent=o,a.appendChild(h)}}},{key:"_findEmptyNodes",value:function(){var e=this._viewer.metaScene.rootMetaObjects;for(var t in e)this._findEmptyNodes2(e[t])}},{key:"_findEmptyNodes2",value:function(e){var t=this.viewer,i=t.scene,s=e.children,r=e.id,n=i.objects[r];if(e._countEntities=0,n&&e._countEntities++,s)for(var o=0,a=s.length;o<a;o++){var u=s[o];u._countEntities=this._findEmptyNodes2(u),e._countEntities+=u._countEntities}return e._countEntities}},{key:"_createStoreysNodes",value:function(){var e=this._viewer.metaScene.rootMetaObjects;for(var t in e)this._createStoreysNodes2(e[t],null,null,null)}},{key:"_createStoreysNodes2",value:function(e,t,i,s){if(!this._pruneEmptyNodes||0!==e._countEntities){var r=e.type,n=e.name,o=e.children,a=e.id;if("IfcBuilding"===r)t={nodeId:"".concat(this._id,"-").concat(a),objectId:a,title:this._rootName||(n&&""!==n&&"Undefined"!==n&&"Default"!==n?n:r),type:r,parent:null,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},this._rootNodes.push(t),this._objectNodes[t.objectId]=t,this._nodeNodes[t.nodeId]=t;else if("IfcBuildingStorey"===r){if(!t)return void this.error("Failed to build storeys hierarchy for model '"+this.metaModel.id+"' - model does not have an IfcBuilding object, or is not an IFC model");i={nodeId:"".concat(this._id,"-").concat(a),objectId:a,title:n&&""!==n&&"Undefined"!==n&&"Default"!==n?n:r,type:r,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},t.children.push(i),this._objectNodes[i.objectId]=i,this._nodeNodes[i.nodeId]=i,s={}}else{if(i)if(this._viewer.scene.objects[a]){var u=(s=s||{})[r];u||(u={nodeId:"".concat(this._id,"-").concat(i.objectId,"-").concat(r),objectId:"".concat(i.objectId,"-").concat(r),title:r,type:r,parent:i,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},i.children.push(u),this._objectNodes[u.objectId]=u,this._nodeNodes[u.nodeId]=u,s[r]=u);var h={nodeId:"".concat(this._id,"-").concat(a),objectId:a,title:n&&""!==n&&"Undefined"!==n&&"Default"!==n?n:r,type:r,parent:u,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]};u.children.push(h),this._objectNodes[h.objectId]=h,this._nodeNodes[h.nodeId]=h}}if(o)for(var l=0,c=o.length;l<c;l++){var p=o[l];this._createStoreysNodes2(p,t,i,s)}}}},{key:"_createTypesNodes",value:function(){var e=this._viewer.metaScene.rootMetaObjects;for(var t in e)this._createTypesNodes2(e[t],null,null)}},{key:"_createTypesNodes2",value:function(e,t,i){if(!this._pruneEmptyNodes||0!==e._countEntities){var s=e.type,r=e.name,n=e.children,o=e.id;if(e.parent){if(t)if(this._viewer.scene.objects[o]){var a=i[s];a||(a={nodeId:"".concat(this._id,"-").concat(t.objectId,"-").concat(s),objectId:"".concat(t.objectId,"-").concat(s),title:s,type:s,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},t.children.push(a),this._objectNodes[a.objectId]=a,this._nodeNodes[a.nodeId]=a,i[s]=a);var u={nodeId:"".concat(this._id,"-").concat(o),objectId:o,title:r&&""!==r&&"Default"!==r?r:s,type:s,parent:a,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]};a.children.push(u),this._objectNodes[u.objectId]=u,this._nodeNodes[u.nodeId]=u}}else t={nodeId:"".concat(this._id,"-").concat(o),objectId:o,title:this._rootName||(r&&""!==r&&"Undefined"!==r&&"Default"!==r?r:s),type:s,parent:null,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},this._rootNodes.push(t),this._objectNodes[t.objectId]=t,this._nodeNodes[t.nodeId]=t,i={};if(n)for(var h=0,l=n.length;h<l;h++){var c=n[h];this._createTypesNodes2(c,t,i)}}}},{key:"_createContainmentNodes",value:function(){var e=this._viewer.metaScene.rootMetaObjects;for(var t in e)this._createContainmentNodes2(e[t],null)}},{key:"_createContainmentNodes2",value:function(e,t){if(!this._pruneEmptyNodes||0!==e._countEntities){var i=e.type,s=e.name||i,r=e.children,n=e.id,o={nodeId:"".concat(this._id,"-").concat(n),objectId:n,title:t?s&&""!==s&&"Undefined"!==s&&"Default"!==s?s:i:this._rootName||s,type:i,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]};if(t?t.children.push(o):this._rootNodes.push(o),this._objectNodes[o.objectId]=o,this._nodeNodes[o.nodeId]=o,r)for(var a=0,u=r.length;a<u;a++){var h=r[a];this._createContainmentNodes2(h,o)}}}},{key:"_doSortNodes",value:function(){for(var e=0,t=this._rootNodes.length;e<t;e++){var i=this._rootNodes[e];this._sortChildren(i)}}},{key:"_sortChildren",value:function(e){var t=e.children;if(t&&0!==t.length){"storeys"===this._hierarchy&&"IfcBuilding"===e.type?t.sort(this._getSpatialSortFunc()):t.sort(this._alphaSortFunc);for(var i=0,s=t.length;i<s;i++){var r=t[i];this._sortChildren(r)}}}},{key:"_getSpatialSortFunc",value:function(){var e=this.viewer,t=e.scene,i=t.camera,s=e.metaScene;return this._spatialSortFunc||(this._spatialSortFunc=function(e,r){e.aabb&&r.aabb||(e.aabb||(e.aabb=t.getAABB(s.getObjectIDsInSubtree(e.objectId))),r.aabb||(r.aabb=t.getAABB(s.getObjectIDsInSubtree(r.objectId))));var n=0;return n=i.xUp?0:i.yUp?1:2,e.aabb[n]>r.aabb[n]?-1:e.aabb[n]<r.aabb[n]?1:0})}},{key:"_alphaSortFunc",value:function(e,t){var i=e.title.toUpperCase(),s=t.title.toUpperCase();return i<s?-1:i>s?1:0}},{key:"_synchNodesToEntities",value:function(){for(var e=Object.keys(this.viewer.metaScene.metaObjects),t=this._viewer.metaScene.metaObjects,i=this._viewer.scene.objects,s=0,r=e.length;s<r;s++){var n=e[s];if(t[n]){var o=this._objectNodes[n];if(o){var a=i[n];if(a){var u=a.visible;o.numEntities=1,o.xrayed=a.xrayed,u?(o.numVisibleEntities=1,o.checked=!0):(o.numVisibleEntities=0,o.checked=!1);for(var h=o.parent;h;)h.numEntities++,u&&(h.numVisibleEntities++,h.checked=!0),h=h.parent}}}}}},{key:"_withNodeTree",value:function(e,t){t(e);var i=e.children;if(i)for(var s=0,r=i.length;s<r;s++)this._withNodeTree(i[s],t)}},{key:"_createTrees",value:function(){var e=this;if(0!==this._rootNodes.length){var t=this._rootNodes.map((function(t){return e._createNodeElement(t)})),i=document.createElement("ul");t.forEach((function(e){i.appendChild(e)})),this._containerElement.appendChild(i),this._rootElement=i}}},{key:"_createNodeElement",value:function(e){var t=this,i=document.createElement("li"),s=e.nodeId;if(e.xrayed&&i.classList.add("xrayed-node"),i.id=s,e.children.length>0){var r="switch-"+s,n=document.createElement("a");n.href="#",n.id=r,n.textContent="+",n.classList.add("plus"),n.addEventListener("click",this._switchExpandHandler),i.appendChild(n)}var o=document.createElement("input");o.id="checkbox-".concat(s),o.type="checkbox",o.checked=e.checked,o.style["pointer-events"]="all",o.addEventListener("change",this._checkboxChangeHandler),i.appendChild(o);var a=document.createElement("span");return a.textContent=e.title,i.appendChild(a),a.oncontextmenu=function(i){t.fire("contextmenu",{event:i,viewer:t._viewer,treeViewPlugin:t,treeViewNode:e}),i.preventDefault()},a.onclick=function(i){t.fire("nodeTitleClicked",{event:i,viewer:t._viewer,treeViewPlugin:t,treeViewNode:e}),i.preventDefault()},i}},{key:"_expandSwitchElement",value:function(e){var t=this,i=e.parentElement;if(!i.getElementsByTagName("li")[0]){var s=i.id,r=this._nodeNodes[s].children.map((function(e){return t._createNodeElement(e)})),n=document.createElement("ul");r.forEach((function(e){n.appendChild(e)})),i.appendChild(n),e.classList.remove("plus"),e.classList.add("minus"),e.textContent="-",e.removeEventListener("click",this._switchExpandHandler),e.addEventListener("click",this._switchCollapseHandler)}}},{key:"_collapseNode",value:function(e){var t="switch-"+e,i=document.getElementById(t);this._collapseSwitchElement(i)}},{key:"_collapseSwitchElement",value:function(e){if(e){var t=e.parentElement;if(t){var i=t.querySelector("ul");i&&(t.removeChild(i),e.classList.remove("minus"),e.classList.add("plus"),e.textContent="+",e.removeEventListener("click",this._switchCollapseHandler),e.addEventListener("click",this._switchExpandHandler))}}}}]),i}(),kx=function(){function e(t){var i=this;w(this,e),this._scene=t,this._objects=[],this._objectsViewCulled=[],this._objectsDetailCulled=[],this._objectsChanged=[],this._objectsChangedList=[],this._modelInfos={},this._numObjects=0,this._lenObjectsChangedList=0,this._dirty=!0,this._onModelLoaded=t.on("modelLoaded",(function(e){var s=t.models[e];s&&i._addModel(s)})),this._onTick=t.on("tick",(function(){i._dirty&&i._build(),i._applyChanges()}))}return I(e,[{key:"_addModel",value:function(e){var t=this,i={model:e,onDestroyed:e.on("destroyed",(function(){t._removeModel(e)}))};this._modelInfos[e.id]=i,this._dirty=!0}},{key:"_removeModel",value:function(e){var t=this._modelInfos[e.id];t&&(t.model.off(t.onDestroyed),delete this._modelInfos[e.id],this._dirty=!0)}},{key:"_build",value:function(){if(this._dirty){this._applyChanges();for(var e=this._scene.objects,t=0;t<this._numObjects;t++)this._objects[t]=null;for(var i in this._numObjects=0,e){var s=e[i];this._objects[this._numObjects++]=s}this._lenObjectsChangedList=0,this._dirty=!1}}},{key:"_applyChanges",value:function(){if(this._lenObjectsChangedList>0){for(var e=0;e<this._lenObjectsChangedList;e++){var t=this._objectsChangedList[e],i=this._objects[t],s=this._objectsViewCulled[t],r=this._objectsDetailCulled[t],n=s||r;i.culled=n,this._objectsChanged[t]=!1}this._lenObjectsChangedList=0}}},{key:"objects",get:function(){return this._dirty&&this._build(),this._objects}},{key:"numObjects",get:function(){return this._dirty&&this._build(),this._numObjects}},{key:"setObjectViewCulled",value:function(e,t){this._dirty&&this._build(),this._objectsViewCulled[e]!==t&&(this._objectsViewCulled[e]=t,this._objectsChanged[e]||(this._objectsChanged[e]=!0,this._objectsChangedList[this._lenObjectsChangedList++]=e))}},{key:"setObjectDetailCulled",value:function(e,t){this._dirty&&this._build(),this._objectsDetailCulled[e]!==t&&(this._objectsDetailCulled[e]=t,this._objectsChanged[e]||(this._objectsChanged[e]=!0,this._objectsChangedList[this._lenObjectsChangedList++]=e))}},{key:"_destroy",value:function(){this._clear(),this._scene.off(this._onModelLoaded),this._scene.off(this._onTick)}},{key:"_clear",value:function(){for(var e in this._modelInfos){var t=this._modelInfos[e];t.model.off(t.onDestroyed)}this._modelInfos={},this._dirty=!0}}]),e}(),Ex={};function Fx(e){var t=e.id,i=Ex[t];return i||(i=new kx(e),Ex[t]=i,e.on("destroyed",(function(){delete Ex[t],i._destroy()}))),i}var Rx=new Float32Array(3),Sx=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,"ViewCull",e))._objectCullStates=Fx(e.scene),s._maxTreeDepth=r.maxTreeDepth||8,s._modelInfos={},s._frustum=new wu,s._kdRoot=null,s._frustumDirty=!1,s._kdTreeDirty=!1,s._onViewMatrix=e.scene.camera.on("viewMatrix",(function(){s._frustumDirty=!0})),s._onProjMatrix=e.scene.camera.on("projMatMatrix",(function(){s._frustumDirty=!0})),s._onModelLoaded=e.scene.on("modelLoaded",(function(e){var t=s.viewer.scene.models[e];t&&s._addModel(t)})),s._onSceneTick=e.scene.on("tick",(function(){s._doCull()})),s}return I(i,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"_addModel",value:function(e){var t=this,i={model:e,onDestroyed:e.on("destroyed",(function(){t._removeModel(e)}))};this._modelInfos[e.id]=i,this._kdTreeDirty=!0}},{key:"_removeModel",value:function(e){var t=this._modelInfos[e.id];t&&(t.model.off(t.onDestroyed),delete this._modelInfos[e.id],this._kdTreeDirty=!0)}},{key:"_doCull",value:function(){var e=this._frustumDirty||this._kdTreeDirty;if(this._frustumDirty&&this._buildFrustum(),this._kdTreeDirty&&this._buildKDTree(),e){var t=this._kdRoot;t&&this._visitKDNode(t)}}},{key:"_buildFrustum",value:function(){var e=this.viewer.scene.camera;Mu(this._frustum,e.viewMatrix,e.projMatrix),this._frustumDirty=!1}},{key:"_buildKDTree",value:function(){var e=this.viewer.scene;this._kdRoot,this._kdRoot={aabb:e.getAABB(),intersection:wu.INTERSECT};for(var t=0,i=this._objectCullStates.numObjects;t<i;t++){var s=this._objectCullStates.objects[t];this._insertEntityIntoKDTree(this._kdRoot,s,t,1)}this._kdTreeDirty=!1}},{key:"_insertEntityIntoKDTree",value:function(e,t,i,s){var r=t.aabb;if(s>=this._maxTreeDepth)return e.objects=e.objects||[],e.objects.push(i),void q.expandAABB3(e.aabb,r);if(e.left&&q.containsAABB3(e.left.aabb,r))this._insertEntityIntoKDTree(e.left,t,i,s+1);else if(e.right&&q.containsAABB3(e.right.aabb,r))this._insertEntityIntoKDTree(e.right,t,i,s+1);else{var n=e.aabb;Rx[0]=n[3]-n[0],Rx[1]=n[4]-n[1],Rx[2]=n[5]-n[2];var o=0;if(Rx[1]>Rx[o]&&(o=1),Rx[2]>Rx[o]&&(o=2),!e.left){var a=n.slice();if(a[o+3]=(n[o]+n[o+3])/2,e.left={aabb:a,intersection:wu.INTERSECT},q.containsAABB3(a,r))return void this._insertEntityIntoKDTree(e.left,t,i,s+1)}if(!e.right){var u=n.slice();if(u[o]=(n[o]+n[o+3])/2,e.right={aabb:u,intersection:wu.INTERSECT},q.containsAABB3(u,r))return void this._insertEntityIntoKDTree(e.right,t,i,s+1)}e.objects=e.objects||[],e.objects.push(i),q.expandAABB3(e.aabb,r)}}},{key:"_visitKDNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wu.INTERSECT;if(t===wu.INTERSECT||e.intersects!==t){t===wu.INTERSECT&&(t=Iu(this._frustum,e.aabb),e.intersects=t);var i=t===wu.OUTSIDE,s=e.objects;if(s&&s.length>0)for(var r=0,n=s.length;r<n;r++){var o=s[r];this._objectCullStates.setObjectViewCulled(o,i)}e.left&&this._visitKDNode(e.left,t),e.right&&this._visitKDNode(e.right,t)}}},{key:"send",value:function(e,t){}},{key:"destroy",value:function(){m(P(i.prototype),"destroy",this).call(this),this._clear();var e=this.viewer.scene,t=e.camera;e.off(this._onModelLoaded),e.off(this._onSceneTick),t.off(this._onViewMatrix),t.off(this._onProjMatrix)}},{key:"_clear",value:function(){for(var e in this._modelInfos){var t=this._modelInfos[e];t.model.off(t.onDestroyed)}this._modelInfos={},this._kdRoot=null,this._kdTreeDirty=!0}}]),i}(),Ox=function(){function e(){w(this,e)}return I(e,[{key:"getMetaModel",value:function(e,t,i){re.loadJSON(e,(function(e){t(e)}),(function(e){i(e)}))}},{key:"getXKT",value:function(e,t,i){var s=function(){};t=t||s,i=i||s;var r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){var n=!!r[2],o=r[3];o=window.decodeURIComponent(o),n&&(o=window.atob(o));try{for(var a=new ArrayBuffer(o.length),u=new Uint8Array(a),h=0;h<o.length;h++)u[h]=o.charCodeAt(h);t(a)}catch(e){i(e)}}else{var l=new XMLHttpRequest;l.open("GET",e,!0),l.responseType="arraybuffer",l.onreadystatechange=function(){4===l.readyState&&(200===l.status?t(l.response):i("getXKT error : "+l.response))},l.send(null)}}}]),e}();/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */!function(e,t){"object"===("undefined"==typeof exports?"undefined":T(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).pako={})}(void 0,(function(e){function t(e){for(var t=e.length;--t>=0;)e[t]=0}var i=256,s=286,r=30,n=15,o=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),u=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),h=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=new Array(576);t(l);var c=new Array(60);t(c);var p=new Array(512);t(p);var d=new Array(256);t(d);var f=new Array(29);t(f);var m,v,g,_=new Array(r);function y(e,t,i,s,r){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=s,this.max_length=r,this.has_stree=e&&e.length}function b(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(_);var x=function(e){return e<256?p[e]:p[256+(e>>>7)]},P=function(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},w=function(e,t,i){e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,P(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},M=function(e,t,i){w(e,i[2*t],i[2*t+1])},I=function(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1},C=function(e,t,i){var s,r,o=new Array(16),a=0;for(s=1;s<=n;s++)o[s]=a=a+i[s-1]<<1;for(r=0;r<=t;r++){var u=e[2*r+1];0!==u&&(e[2*r]=I(o[u]++,u))}},D=function(e){var t;for(t=0;t<s;t++)e.dyn_ltree[2*t]=0;for(t=0;t<r;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},A=function(e){e.bi_valid>8?P(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},k=function(e,t,i,s){var r=2*t,n=2*i;return e[r]<e[n]||e[r]===e[n]&&s[t]<=s[i]},E=function(e,t,i){for(var s=e.heap[i],r=i<<1;r<=e.heap_len&&(r<e.heap_len&&k(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!k(t,s,e.heap[r],e.depth));)e.heap[i]=e.heap[r],i=r,r<<=1;e.heap[i]=s},F=function(e,t,s){var r,n,u,h,l=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],n=e.pending_buf[e.l_buf+l],l++,0===r?M(e,n,t):(u=d[n],M(e,u+i+1,t),0!==(h=o[u])&&(n-=f[u],w(e,n,h)),r--,u=x(r),M(e,u,s),0!==(h=a[u])&&(r-=_[u],w(e,r,h)))}while(l<e.last_lit);M(e,256,t)},R=function(e,t){var i,s,r,o=t.dyn_tree,a=t.stat_desc.static_tree,u=t.stat_desc.has_stree,h=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=573,i=0;i<h;i++)0!==o[2*i]?(e.heap[++e.heap_len]=l=i,e.depth[i]=0):o[2*i+1]=0;for(;e.heap_len<2;)o[2*(r=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[r]=0,e.opt_len--,u&&(e.static_len-=a[2*r+1]);for(t.max_code=l,i=e.heap_len>>1;i>=1;i--)E(e,o,i);r=h;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],E(e,o,1),s=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=s,o[2*r]=o[2*i]+o[2*s],e.depth[r]=(e.depth[i]>=e.depth[s]?e.depth[i]:e.depth[s])+1,o[2*i+1]=o[2*s+1]=r,e.heap[1]=r++,E(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,s,r,o,a,u,h=t.dyn_tree,l=t.max_code,c=t.stat_desc.static_tree,p=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,m=t.stat_desc.max_length,v=0;for(o=0;o<=n;o++)e.bl_count[o]=0;for(h[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<573;i++)(o=h[2*h[2*(s=e.heap[i])+1]+1]+1)>m&&(o=m,v++),h[2*s+1]=o,s>l||(e.bl_count[o]++,a=0,s>=f&&(a=d[s-f]),u=h[2*s],e.opt_len+=u*(o+a),p&&(e.static_len+=u*(c[2*s+1]+a)));if(0!==v){do{for(o=m-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[m]--,v-=2}while(v>0);for(o=m;0!==o;o--)for(s=e.bl_count[o];0!==s;)(r=e.heap[--i])>l||(h[2*r+1]!==o&&(e.opt_len+=(o-h[2*r+1])*h[2*r],h[2*r+1]=o),s--)}}(e,t),C(o,l,e.bl_count)},S=function(e,t,i){var s,r,n=-1,o=t[1],a=0,u=7,h=4;for(0===o&&(u=138,h=3),t[2*(i+1)+1]=65535,s=0;s<=i;s++)r=o,o=t[2*(s+1)+1],++a<u&&r===o||(a<h?e.bl_tree[2*r]+=a:0!==r?(r!==n&&e.bl_tree[2*r]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,n=r,0===o?(u=138,h=3):r===o?(u=6,h=3):(u=7,h=4))},O=function(e,t,i){var s,r,n=-1,o=t[1],a=0,u=7,h=4;for(0===o&&(u=138,h=3),s=0;s<=i;s++)if(r=o,o=t[2*(s+1)+1],!(++a<u&&r===o)){if(a<h)do{M(e,r,e.bl_tree)}while(0!=--a);else 0!==r?(r!==n&&(M(e,r,e.bl_tree),a--),M(e,16,e.bl_tree),w(e,a-3,2)):a<=10?(M(e,17,e.bl_tree),w(e,a-3,3)):(M(e,18,e.bl_tree),w(e,a-11,7));a=0,n=r,0===o?(u=138,h=3):r===o?(u=6,h=3):(u=7,h=4)}},B=!1,L=function(e,t,i,s){w(e,0+(s?1:0),3),function(e,t,i,s){A(e),s&&(P(e,i),P(e,~i)),e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i}(e,t,i,!0)},N=function(e){B||(!function(){var e,t,i,h,b,x=new Array(16);for(i=0,h=0;h<28;h++)for(f[h]=i,e=0;e<1<<o[h];e++)d[i++]=h;for(d[i-1]=h,b=0,h=0;h<16;h++)for(_[h]=b,e=0;e<1<<a[h];e++)p[b++]=h;for(b>>=7;h<r;h++)for(_[h]=b<<7,e=0;e<1<<a[h]-7;e++)p[256+b++]=h;for(t=0;t<=n;t++)x[t]=0;for(e=0;e<=143;)l[2*e+1]=8,e++,x[8]++;for(;e<=255;)l[2*e+1]=9,e++,x[9]++;for(;e<=279;)l[2*e+1]=7,e++,x[7]++;for(;e<=287;)l[2*e+1]=8,e++,x[8]++;for(C(l,287,x),e=0;e<r;e++)c[2*e+1]=5,c[2*e]=I(e,5);m=new y(l,o,257,s,n),v=new y(c,a,0,r,n),g=new y(new Array(0),u,0,19,7)}(),B=!0),e.l_desc=new b(e.dyn_ltree,m),e.d_desc=new b(e.dyn_dtree,v),e.bl_desc=new b(e.bl_tree,g),e.bi_buf=0,e.bi_valid=0,D(e)},j=function(e,t,s,r){var n,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,s=4093624447;for(t=0;t<=31;t++,s>>>=1)if(1&s&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<i;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),R(e,e.l_desc),R(e,e.d_desc),a=function(e){var t;for(S(e,e.dyn_ltree,e.l_desc.max_code),S(e,e.dyn_dtree,e.d_desc.max_code),R(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*h[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),n=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=n&&(n=o)):n=o=s+5,s+4<=n&&-1!==t?L(e,t,s,r):4===e.strategy||o===n?(w(e,2+(r?1:0),3),F(e,l,c)):(w(e,4+(r?1:0),3),function(e,t,i,s){var r;for(w(e,t-257,5),w(e,i-1,5),w(e,s-4,4),r=0;r<s;r++)w(e,e.bl_tree[2*h[r]+1],3);O(e,e.dyn_ltree,t-1),O(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),F(e,e.dyn_ltree,e.dyn_dtree)),D(e),r&&A(e)},G=function(e,t,s){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&s,e.last_lit++,0===t?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(d[s]+i+1)]++,e.dyn_dtree[2*x(t)]++),e.last_lit===e.lit_bufsize-1},H=function(e){w(e,2,3),M(e,256,l),function(e){16===e.bi_valid?(P(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)},U={_tr_init:N,_tr_stored_block:L,_tr_flush_block:j,_tr_tally:G,_tr_align:H},V=function(e,t,i,s){for(var r=65535&e|0,n=e>>>16&65535|0,o=0;0!==i;){i-=o=i>2e3?2e3:i;do{n=n+(r=r+t[s++]|0)|0}while(--o);r%=65521,n%=65521}return r|n<<16|0},z=new Uint32Array(function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}()),W=function(e,t,i,s){var r=z,n=s+i;e^=-1;for(var o=s;o<n;o++)e=e>>>8^r[255&(e^t[o])];return-1^e},X={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Y={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},K=U._tr_init,J=U._tr_stored_block,Z=U._tr_flush_block,Q=U._tr_tally,q=U._tr_align,$=Y.Z_NO_FLUSH,ee=Y.Z_PARTIAL_FLUSH,te=Y.Z_FULL_FLUSH,ie=Y.Z_FINISH,se=Y.Z_BLOCK,re=Y.Z_OK,ne=Y.Z_STREAM_END,oe=Y.Z_STREAM_ERROR,ae=Y.Z_DATA_ERROR,ue=Y.Z_BUF_ERROR,he=Y.Z_DEFAULT_COMPRESSION,le=Y.Z_FILTERED,ce=Y.Z_HUFFMAN_ONLY,pe=Y.Z_RLE,de=Y.Z_FIXED,fe=Y.Z_DEFAULT_STRATEGY,me=Y.Z_UNKNOWN,ve=Y.Z_DEFLATED,ge=258,_e=262,ye=103,be=113,xe=666,Pe=function(e,t){return e.msg=X[t],t},Te=function(e){return(e<<1)-(e>4?9:0)},we=function(e){for(var t=e.length;--t>=0;)e[t]=0},Me=function(e,t,i){return(t<<e.hash_shift^i)&e.hash_mask},Ie=function(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))},Ce=function(e,t){Z(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ie(e.strm)},De=function(e,t){e.pending_buf[e.pending++]=t},Ae=function(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},ke=function(e,t){var i,s,r=e.max_chain_length,n=e.strstart,o=e.prev_length,a=e.nice_match,u=e.strstart>e.w_size-_e?e.strstart-(e.w_size-_e):0,h=e.window,l=e.w_mask,c=e.prev,p=e.strstart+ge,d=h[n+o-1],f=h[n+o];e.prev_length>=e.good_match&&(r>>=2),a>e.lookahead&&(a=e.lookahead);do{if(h[(i=t)+o]===f&&h[i+o-1]===d&&h[i]===h[n]&&h[++i]===h[n+1]){n+=2,i++;do{}while(h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&n<p);if(s=ge-(p-n),n=p-ge,s>o){if(e.match_start=t,o=s,s>=a)break;d=h[n+o-1],f=h[n+o]}}}while((t=c[t&l])>u&&0!=--r);return o<=e.lookahead?o:e.lookahead},Ee=function(e){var t,i,s,r,n,o,a,u,h,l,c=e.w_size;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=c+(c-_e)){e.window.set(e.window.subarray(c,c+c),0),e.match_start-=c,e.strstart-=c,e.block_start-=c,t=i=e.hash_size;do{s=e.head[--t],e.head[t]=s>=c?s-c:0}while(--i);t=i=c;do{s=e.prev[--t],e.prev[t]=s>=c?s-c:0}while(--i);r+=c}if(0===e.strm.avail_in)break;if(o=e.strm,a=e.window,u=e.strstart+e.lookahead,h=r,l=void 0,(l=o.avail_in)>h&&(l=h),i=0===l?0:(o.avail_in-=l,a.set(o.input.subarray(o.next_in,o.next_in+l),u),1===o.state.wrap?o.adler=V(o.adler,a,l,u):2===o.state.wrap&&(o.adler=W(o.adler,a,l,u)),o.next_in+=l,o.total_in+=l,l),e.lookahead+=i,e.lookahead+e.insert>=3)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=Me(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=Me(e,e.ins_h,e.window[n+3-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<_e&&0!==e.strm.avail_in)},Fe=function(e,t){for(var i,s;;){if(e.lookahead<_e){if(Ee(e),e.lookahead<_e&&t===$)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=Me(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-_e&&(e.match_length=ke(e,i)),e.match_length>=3)if(s=Q(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Me(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Me(e,e.ins_h,e.window[e.strstart+1]);else s=Q(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(Ce(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===ie?(Ce(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ce(e,!1),0===e.strm.avail_out)?1:2},Re=function(e,t){for(var i,s,r;;){if(e.lookahead<_e){if(Ee(e),e.lookahead<_e&&t===$)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=Me(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-_e&&(e.match_length=ke(e,i),e.match_length<=5&&(e.strategy===le||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,s=Q(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=Me(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(Ce(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((s=Q(e,0,e.window[e.strstart-1]))&&Ce(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=Q(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===ie?(Ce(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ce(e,!1),0===e.strm.avail_out)?1:2};function Se(e,t,i,s,r){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=s,this.func=r}var Oe=[new Se(0,0,0,0,(function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Ee(e),0===e.lookahead&&t===$)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var s=e.block_start+i;if((0===e.strstart||e.strstart>=s)&&(e.lookahead=e.strstart-s,e.strstart=s,Ce(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-_e&&(Ce(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===ie?(Ce(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(Ce(e,!1),e.strm.avail_out),1)})),new Se(4,4,8,4,Fe),new Se(4,5,16,8,Fe),new Se(4,6,32,32,Fe),new Se(4,4,16,16,Re),new Se(8,16,32,32,Re),new Se(8,16,128,128,Re),new Se(8,32,128,256,Re),new Se(32,128,258,1024,Re),new Se(32,258,258,4096,Re)];function Be(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ve,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),we(this.dyn_ltree),we(this.dyn_dtree),we(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),we(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),we(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var Le=function(e){if(!e||!e.state)return Pe(e,oe);e.total_in=e.total_out=0,e.data_type=me;var t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:be,e.adler=2===t.wrap?0:1,t.last_flush=$,K(t),re},Ne=function(e){var t=Le(e);return t===re&&function(e){e.window_size=2*e.w_size,we(e.head),e.max_lazy_match=Oe[e.level].max_lazy,e.good_match=Oe[e.level].good_length,e.nice_match=Oe[e.level].nice_length,e.max_chain_length=Oe[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0}(e.state),t},je=function(e,t,i,s,r,n){if(!e)return oe;var o=1;if(t===he&&(t=6),s<0?(o=0,s=-s):s>15&&(o=2,s-=16),r<1||r>9||i!==ve||s<8||s>15||t<0||t>9||n<0||n>de)return Pe(e,oe);8===s&&(s=9);var a=new Be;return e.state=a,a.strm=e,a.wrap=o,a.gzhead=null,a.w_bits=s,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=n,a.method=i,Ne(e)},Ge=function(e,t){var i,s;if(!e||!e.state||t>se||t<0)return e?Pe(e,oe):oe;var r=e.state;if(!e.output||!e.input&&0!==e.avail_in||r.status===xe&&t!==ie)return Pe(e,0===e.avail_out?ue:oe);r.strm=e;var n=r.last_flush;if(r.last_flush=t,42===r.status)if(2===r.wrap)e.adler=0,De(r,31),De(r,139),De(r,8),r.gzhead?(De(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),De(r,255&r.gzhead.time),De(r,r.gzhead.time>>8&255),De(r,r.gzhead.time>>16&255),De(r,r.gzhead.time>>24&255),De(r,9===r.level?2:r.strategy>=ce||r.level<2?4:0),De(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(De(r,255&r.gzhead.extra.length),De(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=W(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(De(r,0),De(r,0),De(r,0),De(r,0),De(r,0),De(r,9===r.level?2:r.strategy>=ce||r.level<2?4:0),De(r,3),r.status=be);else{var o=ve+(r.w_bits-8<<4)<<8;o|=(r.strategy>=ce||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(o|=32),o+=31-o%31,r.status=be,Ae(r,o),0!==r.strstart&&(Ae(r,e.adler>>>16),Ae(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(i=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>i&&(e.adler=W(e.adler,r.pending_buf,r.pending-i,i)),Ie(e),i=r.pending,r.pending!==r.pending_buf_size));)De(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>i&&(e.adler=W(e.adler,r.pending_buf,r.pending-i,i)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(e.adler=W(e.adler,r.pending_buf,r.pending-i,i)),Ie(e),i=r.pending,r.pending===r.pending_buf_size)){s=1;break}s=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,De(r,s)}while(0!==s);r.gzhead.hcrc&&r.pending>i&&(e.adler=W(e.adler,r.pending_buf,r.pending-i,i)),0===s&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(e.adler=W(e.adler,r.pending_buf,r.pending-i,i)),Ie(e),i=r.pending,r.pending===r.pending_buf_size)){s=1;break}s=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,De(r,s)}while(0!==s);r.gzhead.hcrc&&r.pending>i&&(e.adler=W(e.adler,r.pending_buf,r.pending-i,i)),0===s&&(r.status=ye)}else r.status=ye;if(r.status===ye&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Ie(e),r.pending+2<=r.pending_buf_size&&(De(r,255&e.adler),De(r,e.adler>>8&255),e.adler=0,r.status=be)):r.status=be),0!==r.pending){if(Ie(e),0===e.avail_out)return r.last_flush=-1,re}else if(0===e.avail_in&&Te(t)<=Te(n)&&t!==ie)return Pe(e,ue);if(r.status===xe&&0!==e.avail_in)return Pe(e,ue);if(0!==e.avail_in||0!==r.lookahead||t!==$&&r.status!==xe){var a=r.strategy===ce?function(e,t){for(var i;;){if(0===e.lookahead&&(Ee(e),0===e.lookahead)){if(t===$)return 1;break}if(e.match_length=0,i=Q(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(Ce(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===ie?(Ce(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ce(e,!1),0===e.strm.avail_out)?1:2}(r,t):r.strategy===pe?function(e,t){for(var i,s,r,n,o=e.window;;){if(e.lookahead<=ge){if(Ee(e),e.lookahead<=ge&&t===$)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=o[r=e.strstart-1])===o[++r]&&s===o[++r]&&s===o[++r]){n=e.strstart+ge;do{}while(s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&r<n);e.match_length=ge-(n-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=Q(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=Q(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(Ce(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===ie?(Ce(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ce(e,!1),0===e.strm.avail_out)?1:2}(r,t):Oe[r.level].func(r,t);if(3!==a&&4!==a||(r.status=xe),1===a||3===a)return 0===e.avail_out&&(r.last_flush=-1),re;if(2===a&&(t===ee?q(r):t!==se&&(J(r,0,0,!1),t===te&&(we(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Ie(e),0===e.avail_out))return r.last_flush=-1,re}return t!==ie?re:r.wrap<=0?ne:(2===r.wrap?(De(r,255&e.adler),De(r,e.adler>>8&255),De(r,e.adler>>16&255),De(r,e.adler>>24&255),De(r,255&e.total_in),De(r,e.total_in>>8&255),De(r,e.total_in>>16&255),De(r,e.total_in>>24&255)):(Ae(r,e.adler>>>16),Ae(r,65535&e.adler)),Ie(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?re:ne)},He=function(e,t){var i=t.length;if(!e||!e.state)return oe;var s=e.state,r=s.wrap;if(2===r||1===r&&42!==s.status||s.lookahead)return oe;if(1===r&&(e.adler=V(e.adler,t,i,0)),s.wrap=0,i>=s.w_size){0===r&&(we(s.head),s.strstart=0,s.block_start=0,s.insert=0);var n=new Uint8Array(s.w_size);n.set(t.subarray(i-s.w_size,i),0),t=n,i=s.w_size}var o=e.avail_in,a=e.next_in,u=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,Ee(s);s.lookahead>=3;){var h=s.strstart,l=s.lookahead-2;do{s.ins_h=Me(s,s.ins_h,s.window[h+3-1]),s.prev[h&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=h,h++}while(--l);s.strstart=h,s.lookahead=2,Ee(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=a,e.input=u,e.avail_in=o,s.wrap=r,re},Ue={deflateInit:function(e,t){return je(e,t,ve,15,8,fe)},deflateInit2:je,deflateReset:Ne,deflateResetKeep:Le,deflateSetHeader:function(e,t){return e&&e.state?2!==e.state.wrap?oe:(e.state.gzhead=t,re):oe},deflate:Ge,deflateEnd:function(e){if(!e||!e.state)return oe;var t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&t!==ye&&t!==be&&t!==xe?Pe(e,oe):(e.state=null,t===be?Pe(e,ae):re)},deflateSetDictionary:He,deflateInfo:"pako deflate (from Nodeca project)"},Ve=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},ze=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!==T(i))throw new TypeError(i+"must be non-object");for(var s in i)Ve(i,s)&&(e[s]=i[s])}}return e},We=function(e){for(var t=0,i=0,s=e.length;i<s;i++)t+=e[i].length;for(var r=new Uint8Array(t),n=0,o=0,a=e.length;n<a;n++){var u=e[n];r.set(u,o),o+=u.length}return r},Xe=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Xe=!1}for(var Ye=new Uint8Array(256),Ke=0;Ke<256;Ke++)Ye[Ke]=Ke>=252?6:Ke>=248?5:Ke>=240?4:Ke>=224?3:Ke>=192?2:1;Ye[254]=Ye[254]=1;var Je=function(e){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t,i,s,r,n,o=e.length,a=0;for(r=0;r<o;r++)55296==(64512&(i=e.charCodeAt(r)))&&r+1<o&&56320==(64512&(s=e.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(s-56320),r++),a+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(a),n=0,r=0;n<a;r++)55296==(64512&(i=e.charCodeAt(r)))&&r+1<o&&56320==(64512&(s=e.charCodeAt(r+1)))&&(i=65536+(i-55296<<10)+(s-56320),r++),i<128?t[n++]=i:i<2048?(t[n++]=192|i>>>6,t[n++]=128|63&i):i<65536?(t[n++]=224|i>>>12,t[n++]=128|i>>>6&63,t[n++]=128|63&i):(t[n++]=240|i>>>18,t[n++]=128|i>>>12&63,t[n++]=128|i>>>6&63,t[n++]=128|63&i);return t},Ze=function(e,t){var i,s,r=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var n=new Array(2*r);for(s=0,i=0;i<r;){var o=e[i++];if(o<128)n[s++]=o;else{var a=Ye[o];if(a>4)n[s++]=65533,i+=a-1;else{for(o&=2===a?31:3===a?15:7;a>1&&i<r;)o=o<<6|63&e[i++],a--;a>1?n[s++]=65533:o<65536?n[s++]=o:(o-=65536,n[s++]=55296|o>>10&1023,n[s++]=56320|1023&o)}}}return function(e,t){if(t<65534&&e.subarray&&Xe)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var i="",s=0;s<t;s++)i+=String.fromCharCode(e[s]);return i}(n,s)},Qe=function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+Ye[e[i]]>t?i:t};var qe=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},$e=Object.prototype.toString,et=Y.Z_NO_FLUSH,tt=Y.Z_SYNC_FLUSH,it=Y.Z_FULL_FLUSH,st=Y.Z_FINISH,rt=Y.Z_OK,nt=Y.Z_STREAM_END,ot=Y.Z_DEFAULT_COMPRESSION,at=Y.Z_DEFAULT_STRATEGY,ut=Y.Z_DEFLATED;function ht(e){this.options=ze({level:ot,method:ut,chunkSize:16384,windowBits:15,memLevel:8,strategy:at},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qe,this.strm.avail_out=0;var i=Ue.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==rt)throw new Error(X[i]);if(t.header&&Ue.deflateSetHeader(this.strm,t.header),t.dictionary){var s;if(s="string"==typeof t.dictionary?Je(t.dictionary):"[object ArrayBuffer]"===$e.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(i=Ue.deflateSetDictionary(this.strm,s))!==rt)throw new Error(X[i]);this._dict_set=!0}}function lt(e,t){var i=new ht(t);if(i.push(e,!0),i.err)throw i.msg||X[i.err];return i.result}ht.prototype.push=function(e,t){var i,s,r=this.strm,n=this.options.chunkSize;if(this.ended)return!1;for(s=t===~~t?t:!0===t?st:et,"string"==typeof e?r.input=Je(e):"[object ArrayBuffer]"===$e.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(s===tt||s===it)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if((i=Ue.deflate(r,s))===nt)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=Ue.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===rt;if(0!==r.avail_out){if(s>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},ht.prototype.onData=function(e){this.chunks.push(e)},ht.prototype.onEnd=function(e){e===rt&&(this.result=We(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ct={Deflate:ht,deflate:lt,deflateRaw:function(e,t){return(t=t||{}).raw=!0,lt(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,lt(e,t)},constants:Y},pt=function(e,t){var i,s,r,n,o,a,u,h,l,c,p,d,f,m,v,g,_,y,b,x,P,T,w,M,I=e.state;i=e.next_in,w=e.input,s=i+(e.avail_in-5),r=e.next_out,M=e.output,n=r-(t-e.avail_out),o=r+(e.avail_out-257),a=I.dmax,u=I.wsize,h=I.whave,l=I.wnext,c=I.window,p=I.hold,d=I.bits,f=I.lencode,m=I.distcode,v=(1<<I.lenbits)-1,g=(1<<I.distbits)-1;e:do{d<15&&(p+=w[i++]<<d,d+=8,p+=w[i++]<<d,d+=8),_=f[p&v];t:for(;;){if(p>>>=y=_>>>24,d-=y,0===(y=_>>>16&255))M[r++]=65535&_;else{if(!(16&y)){if(0==(64&y)){_=f[(65535&_)+(p&(1<<y)-1)];continue t}if(32&y){I.mode=12;break e}e.msg="invalid literal/length code",I.mode=30;break e}b=65535&_,(y&=15)&&(d<y&&(p+=w[i++]<<d,d+=8),b+=p&(1<<y)-1,p>>>=y,d-=y),d<15&&(p+=w[i++]<<d,d+=8,p+=w[i++]<<d,d+=8),_=m[p&g];i:for(;;){if(p>>>=y=_>>>24,d-=y,!(16&(y=_>>>16&255))){if(0==(64&y)){_=m[(65535&_)+(p&(1<<y)-1)];continue i}e.msg="invalid distance code",I.mode=30;break e}if(x=65535&_,d<(y&=15)&&(p+=w[i++]<<d,(d+=8)<y&&(p+=w[i++]<<d,d+=8)),(x+=p&(1<<y)-1)>a){e.msg="invalid distance too far back",I.mode=30;break e}if(p>>>=y,d-=y,x>(y=r-n)){if((y=x-y)>h&&I.sane){e.msg="invalid distance too far back",I.mode=30;break e}if(P=0,T=c,0===l){if(P+=u-y,y<b){b-=y;do{M[r++]=c[P++]}while(--y);P=r-x,T=M}}else if(l<y){if(P+=u+l-y,(y-=l)<b){b-=y;do{M[r++]=c[P++]}while(--y);if(P=0,l<b){b-=y=l;do{M[r++]=c[P++]}while(--y);P=r-x,T=M}}}else if(P+=l-y,y<b){b-=y;do{M[r++]=c[P++]}while(--y);P=r-x,T=M}for(;b>2;)M[r++]=T[P++],M[r++]=T[P++],M[r++]=T[P++],b-=3;b&&(M[r++]=T[P++],b>1&&(M[r++]=T[P++]))}else{P=r-x;do{M[r++]=M[P++],M[r++]=M[P++],M[r++]=M[P++],b-=3}while(b>2);b&&(M[r++]=M[P++],b>1&&(M[r++]=M[P++]))}break}}break}}while(i<s&&r<o);i-=b=d>>3,p&=(1<<(d-=b<<3))-1,e.next_in=i,e.next_out=r,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=r<o?o-r+257:257-(r-o),I.hold=p,I.bits=d},dt=15,ft=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),mt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),vt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),gt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),_t=function(e,t,i,s,r,n,o,a){var u,h,l,c,p,d,f,m,v,g=a.bits,_=0,y=0,b=0,x=0,P=0,T=0,w=0,M=0,I=0,C=0,D=null,A=0,k=new Uint16Array(16),E=new Uint16Array(16),F=null,R=0;for(_=0;_<=dt;_++)k[_]=0;for(y=0;y<s;y++)k[t[i+y]]++;for(P=g,x=dt;x>=1&&0===k[x];x--);if(P>x&&(P=x),0===x)return r[n++]=20971520,r[n++]=20971520,a.bits=1,0;for(b=1;b<x&&0===k[b];b++);for(P<b&&(P=b),M=1,_=1;_<=dt;_++)if(M<<=1,(M-=k[_])<0)return-1;if(M>0&&(0===e||1!==x))return-1;for(E[1]=0,_=1;_<dt;_++)E[_+1]=E[_]+k[_];for(y=0;y<s;y++)0!==t[i+y]&&(o[E[t[i+y]]++]=y);if(0===e?(D=F=o,d=19):1===e?(D=ft,A-=257,F=mt,R-=257,d=256):(D=vt,F=gt,d=-1),C=0,y=0,_=b,p=n,T=P,w=0,l=-1,c=(I=1<<P)-1,1===e&&I>852||2===e&&I>592)return 1;for(;;){f=_-w,o[y]<d?(m=0,v=o[y]):o[y]>d?(m=F[R+o[y]],v=D[A+o[y]]):(m=96,v=0),u=1<<_-w,b=h=1<<T;do{r[p+(C>>w)+(h-=u)]=f<<24|m<<16|v|0}while(0!==h);for(u=1<<_-1;C&u;)u>>=1;if(0!==u?(C&=u-1,C+=u):C=0,y++,0==--k[_]){if(_===x)break;_=t[i+o[y]]}if(_>P&&(C&c)!==l){for(0===w&&(w=P),p+=b,M=1<<(T=_-w);T+w<x&&!((M-=k[T+w])<=0);)T++,M<<=1;if(I+=1<<T,1===e&&I>852||2===e&&I>592)return 1;r[l=C&c]=P<<24|T<<16|p-n|0}}return 0!==C&&(r[p+C]=_-w<<24|64<<16|0),a.bits=P,0},yt=Y.Z_FINISH,bt=Y.Z_BLOCK,xt=Y.Z_TREES,Pt=Y.Z_OK,Tt=Y.Z_STREAM_END,wt=Y.Z_NEED_DICT,Mt=Y.Z_STREAM_ERROR,It=Y.Z_DATA_ERROR,Ct=Y.Z_MEM_ERROR,Dt=Y.Z_BUF_ERROR,At=Y.Z_DEFLATED,kt=12,Et=30,Ft=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)};function Rt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var St,Ot,Bt=function(e){if(!e||!e.state)return Mt;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Pt},Lt=function(e){if(!e||!e.state)return Mt;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Bt(e)},Nt=function(e,t){var i;if(!e||!e.state)return Mt;var s=e.state;return t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Mt:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=i,s.wbits=t,Lt(e))},jt=function(e,t){if(!e)return Mt;var i=new Rt;e.state=i,i.window=null;var s=Nt(e,t);return s!==Pt&&(e.state=null),s},Gt=!0,Ht=function(e){if(Gt){St=new Int32Array(512),Ot=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(_t(1,e.lens,0,288,St,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;_t(2,e.lens,0,32,Ot,0,e.work,{bits:5}),Gt=!1}e.lencode=St,e.lenbits=9,e.distcode=Ot,e.distbits=5},Ut=function(e,t,i,s){var r,n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),s>=n.wsize?(n.window.set(t.subarray(i-n.wsize,i),0),n.wnext=0,n.whave=n.wsize):((r=n.wsize-n.wnext)>s&&(r=s),n.window.set(t.subarray(i-s,i-s+r),n.wnext),(s-=r)?(n.window.set(t.subarray(i-s,i),0),n.wnext=s,n.whave=n.wsize):(n.wnext+=r,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=r))),0},Vt=function(e,t){var i,s,r,n,o,a,u,h,l,c,p,d,f,m,v,g,_,y,b,x,P,T,w,M,I=0,C=new Uint8Array(4),D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Mt;(i=e.state).mode===kt&&(i.mode=13),o=e.next_out,r=e.output,u=e.avail_out,n=e.next_in,s=e.input,a=e.avail_in,h=i.hold,l=i.bits,c=a,p=u,T=Pt;e:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;l<16;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}if(2&i.wrap&&35615===h){i.check=0,C[0]=255&h,C[1]=h>>>8&255,i.check=W(i.check,C,2,0),h=0,l=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",i.mode=Et;break}if((15&h)!==At){e.msg="unknown compression method",i.mode=Et;break}if(l-=4,P=8+(15&(h>>>=4)),0===i.wbits)i.wbits=P;else if(P>i.wbits){e.msg="invalid window size",i.mode=Et;break}i.dmax=1<<i.wbits,e.adler=i.check=1,i.mode=512&h?10:kt,h=0,l=0;break;case 2:for(;l<16;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}if(i.flags=h,(255&i.flags)!==At){e.msg="unknown compression method",i.mode=Et;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=Et;break}i.head&&(i.head.text=h>>8&1),512&i.flags&&(C[0]=255&h,C[1]=h>>>8&255,i.check=W(i.check,C,2,0)),h=0,l=0,i.mode=3;case 3:for(;l<32;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}i.head&&(i.head.time=h),512&i.flags&&(C[0]=255&h,C[1]=h>>>8&255,C[2]=h>>>16&255,C[3]=h>>>24&255,i.check=W(i.check,C,4,0)),h=0,l=0,i.mode=4;case 4:for(;l<16;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}i.head&&(i.head.xflags=255&h,i.head.os=h>>8),512&i.flags&&(C[0]=255&h,C[1]=h>>>8&255,i.check=W(i.check,C,2,0)),h=0,l=0,i.mode=5;case 5:if(1024&i.flags){for(;l<16;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}i.length=h,i.head&&(i.head.extra_len=h),512&i.flags&&(C[0]=255&h,C[1]=h>>>8&255,i.check=W(i.check,C,2,0)),h=0,l=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((d=i.length)>a&&(d=a),d&&(i.head&&(P=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(s.subarray(n,n+d),P)),512&i.flags&&(i.check=W(i.check,s,d,n)),a-=d,n+=d,i.length-=d),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===a)break e;d=0;do{P=s[n+d++],i.head&&P&&i.length<65536&&(i.head.name+=String.fromCharCode(P))}while(P&&d<a);if(512&i.flags&&(i.check=W(i.check,s,d,n)),a-=d,n+=d,P)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===a)break e;d=0;do{P=s[n+d++],i.head&&P&&i.length<65536&&(i.head.comment+=String.fromCharCode(P))}while(P&&d<a);if(512&i.flags&&(i.check=W(i.check,s,d,n)),a-=d,n+=d,P)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;l<16;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}if(h!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Et;break}h=0,l=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=kt;break;case 10:for(;l<32;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}e.adler=i.check=Ft(h),h=0,l=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=o,e.avail_out=u,e.next_in=n,e.avail_in=a,i.hold=h,i.bits=l,wt;e.adler=i.check=1,i.mode=kt;case kt:if(t===bt||t===xt)break e;case 13:if(i.last){h>>>=7&l,l-=7&l,i.mode=27;break}for(;l<3;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}switch(i.last=1&h,l-=1,3&(h>>>=1)){case 0:i.mode=14;break;case 1:if(Ht(i),i.mode=20,t===xt){h>>>=2,l-=2;break e}break;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=Et}h>>>=2,l-=2;break;case 14:for(h>>>=7&l,l-=7&l;l<32;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Et;break}if(i.length=65535&h,h=0,l=0,i.mode=15,t===xt)break e;case 15:i.mode=16;case 16:if(d=i.length){if(d>a&&(d=a),d>u&&(d=u),0===d)break e;r.set(s.subarray(n,n+d),o),a-=d,n+=d,u-=d,o+=d,i.length-=d;break}i.mode=kt;break;case 17:for(;l<14;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}if(i.nlen=257+(31&h),h>>>=5,l-=5,i.ndist=1+(31&h),h>>>=5,l-=5,i.ncode=4+(15&h),h>>>=4,l-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Et;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;l<3;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}i.lens[D[i.have++]]=7&h,h>>>=3,l-=3}for(;i.have<19;)i.lens[D[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,w={bits:i.lenbits},T=_t(0,i.lens,0,19,i.lencode,0,i.work,w),i.lenbits=w.bits,T){e.msg="invalid code lengths set",i.mode=Et;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;g=(I=i.lencode[h&(1<<i.lenbits)-1])>>>16&255,_=65535&I,!((v=I>>>24)<=l);){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}if(_<16)h>>>=v,l-=v,i.lens[i.have++]=_;else{if(16===_){for(M=v+2;l<M;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}if(h>>>=v,l-=v,0===i.have){e.msg="invalid bit length repeat",i.mode=Et;break}P=i.lens[i.have-1],d=3+(3&h),h>>>=2,l-=2}else if(17===_){for(M=v+3;l<M;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}l-=v,P=0,d=3+(7&(h>>>=v)),h>>>=3,l-=3}else{for(M=v+7;l<M;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}l-=v,P=0,d=11+(127&(h>>>=v)),h>>>=7,l-=7}if(i.have+d>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Et;break}for(;d--;)i.lens[i.have++]=P}}if(i.mode===Et)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=Et;break}if(i.lenbits=9,w={bits:i.lenbits},T=_t(1,i.lens,0,i.nlen,i.lencode,0,i.work,w),i.lenbits=w.bits,T){e.msg="invalid literal/lengths set",i.mode=Et;break}if(i.distbits=6,i.distcode=i.distdyn,w={bits:i.distbits},T=_t(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,w),i.distbits=w.bits,T){e.msg="invalid distances set",i.mode=Et;break}if(i.mode=20,t===xt)break e;case 20:i.mode=21;case 21:if(a>=6&&u>=258){e.next_out=o,e.avail_out=u,e.next_in=n,e.avail_in=a,i.hold=h,i.bits=l,pt(e,p),o=e.next_out,r=e.output,u=e.avail_out,n=e.next_in,s=e.input,a=e.avail_in,h=i.hold,l=i.bits,i.mode===kt&&(i.back=-1);break}for(i.back=0;g=(I=i.lencode[h&(1<<i.lenbits)-1])>>>16&255,_=65535&I,!((v=I>>>24)<=l);){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}if(g&&0==(240&g)){for(y=v,b=g,x=_;g=(I=i.lencode[x+((h&(1<<y+b)-1)>>y)])>>>16&255,_=65535&I,!(y+(v=I>>>24)<=l);){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}h>>>=y,l-=y,i.back+=y}if(h>>>=v,l-=v,i.back+=v,i.length=_,0===g){i.mode=26;break}if(32&g){i.back=-1,i.mode=kt;break}if(64&g){e.msg="invalid literal/length code",i.mode=Et;break}i.extra=15&g,i.mode=22;case 22:if(i.extra){for(M=i.extra;l<M;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}i.length+=h&(1<<i.extra)-1,h>>>=i.extra,l-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;g=(I=i.distcode[h&(1<<i.distbits)-1])>>>16&255,_=65535&I,!((v=I>>>24)<=l);){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}if(0==(240&g)){for(y=v,b=g,x=_;g=(I=i.distcode[x+((h&(1<<y+b)-1)>>y)])>>>16&255,_=65535&I,!(y+(v=I>>>24)<=l);){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}h>>>=y,l-=y,i.back+=y}if(h>>>=v,l-=v,i.back+=v,64&g){e.msg="invalid distance code",i.mode=Et;break}i.offset=_,i.extra=15&g,i.mode=24;case 24:if(i.extra){for(M=i.extra;l<M;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}i.offset+=h&(1<<i.extra)-1,h>>>=i.extra,l-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Et;break}i.mode=25;case 25:if(0===u)break e;if(d=p-u,i.offset>d){if((d=i.offset-d)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Et;break}d>i.wnext?(d-=i.wnext,f=i.wsize-d):f=i.wnext-d,d>i.length&&(d=i.length),m=i.window}else m=r,f=o-i.offset,d=i.length;d>u&&(d=u),u-=d,i.length-=d;do{r[o++]=m[f++]}while(--d);0===i.length&&(i.mode=21);break;case 26:if(0===u)break e;r[o++]=i.length,u--,i.mode=21;break;case 27:if(i.wrap){for(;l<32;){if(0===a)break e;a--,h|=s[n++]<<l,l+=8}if(p-=u,e.total_out+=p,i.total+=p,p&&(e.adler=i.check=i.flags?W(i.check,r,p,o-p):V(i.check,r,p,o-p)),p=u,(i.flags?h:Ft(h))!==i.check){e.msg="incorrect data check",i.mode=Et;break}h=0,l=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;l<32;){if(0===a)break e;a--,h+=s[n++]<<l,l+=8}if(h!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Et;break}h=0,l=0}i.mode=29;case 29:T=Tt;break e;case Et:T=It;break e;case 31:return Ct;default:return Mt}return e.next_out=o,e.avail_out=u,e.next_in=n,e.avail_in=a,i.hold=h,i.bits=l,(i.wsize||p!==e.avail_out&&i.mode<Et&&(i.mode<27||t!==yt))&&Ut(e,e.output,e.next_out,p-e.avail_out),c-=e.avail_in,p-=e.avail_out,e.total_in+=c,e.total_out+=p,i.total+=p,i.wrap&&p&&(e.adler=i.check=i.flags?W(i.check,r,p,e.next_out-p):V(i.check,r,p,e.next_out-p)),e.data_type=i.bits+(i.last?64:0)+(i.mode===kt?128:0)+(20===i.mode||15===i.mode?256:0),(0===c&&0===p||t===yt)&&T===Pt&&(T=Dt),T},zt={inflateReset:Lt,inflateReset2:Nt,inflateResetKeep:Bt,inflateInit:function(e){return jt(e,15)},inflateInit2:jt,inflate:Vt,inflateEnd:function(e){if(!e||!e.state)return Mt;var t=e.state;return t.window&&(t.window=null),e.state=null,Pt},inflateGetHeader:function(e,t){if(!e||!e.state)return Mt;var i=e.state;return 0==(2&i.wrap)?Mt:(i.head=t,t.done=!1,Pt)},inflateSetDictionary:function(e,t){var i,s=t.length;return e&&e.state?0!==(i=e.state).wrap&&11!==i.mode?Mt:11===i.mode&&V(1,t,s,0)!==i.check?It:Ut(e,t,s,s)?(i.mode=31,Ct):(i.havedict=1,Pt):Mt},inflateInfo:"pako inflate (from Nodeca project)"};var Wt=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Xt=Object.prototype.toString,Yt=Y.Z_NO_FLUSH,Kt=Y.Z_FINISH,Jt=Y.Z_OK,Zt=Y.Z_STREAM_END,Qt=Y.Z_NEED_DICT,qt=Y.Z_STREAM_ERROR,$t=Y.Z_DATA_ERROR,ei=Y.Z_MEM_ERROR;function ti(e){this.options=ze({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qe,this.strm.avail_out=0;var i=zt.inflateInit2(this.strm,t.windowBits);if(i!==Jt)throw new Error(X[i]);if(this.header=new Wt,zt.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Je(t.dictionary):"[object ArrayBuffer]"===Xt.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=zt.inflateSetDictionary(this.strm,t.dictionary))!==Jt))throw new Error(X[i])}function ii(e,t){var i=new ti(t);if(i.push(e),i.err)throw i.msg||X[i.err];return i.result}ti.prototype.push=function(e,t){var i,s,r,n=this.strm,o=this.options.chunkSize,a=this.options.dictionary;if(this.ended)return!1;for(s=t===~~t?t:!0===t?Kt:Yt,"[object ArrayBuffer]"===Xt.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(o),n.next_out=0,n.avail_out=o),(i=zt.inflate(n,s))===Qt&&a&&((i=zt.inflateSetDictionary(n,a))===Jt?i=zt.inflate(n,s):i===$t&&(i=Qt));n.avail_in>0&&i===Zt&&n.state.wrap>0&&0!==e[n.next_in];)zt.inflateReset(n),i=zt.inflate(n,s);switch(i){case qt:case $t:case Qt:case ei:return this.onEnd(i),this.ended=!0,!1}if(r=n.avail_out,n.next_out&&(0===n.avail_out||i===Zt))if("string"===this.options.to){var u=Qe(n.output,n.next_out),h=n.next_out-u,l=Ze(n.output,u);n.next_out=h,n.avail_out=o-h,h&&n.output.set(n.output.subarray(u,u+h),0),this.onData(l)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(i!==Jt||0!==r){if(i===Zt)return i=zt.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},ti.prototype.onData=function(e){this.chunks.push(e)},ti.prototype.onEnd=function(e){e===Jt&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=We(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var si={Inflate:ti,inflate:ii,inflateRaw:function(e,t){return(t=t||{}).raw=!0,ii(e,t)},ungzip:ii,constants:Y},ri=ct.Deflate,ni=ct.deflate,oi=ct.deflateRaw,ai=ct.gzip,ui=si.Inflate,hi=si.inflate,li=si.inflateRaw,ci=si.ungzip,pi=Y,di={Deflate:ri,deflate:ni,deflateRaw:oi,gzip:ai,Inflate:ui,inflate:hi,inflateRaw:li,ungzip:ci,constants:pi};e.Deflate=ri,e.Inflate=ui,e.constants=pi,e.default=di,e.deflate=ni,e.deflateRaw=oi,e.gzip=ai,e.inflate=hi,e.inflateRaw=li,e.ungzip=ci,Object.defineProperty(e,"__esModule",{value:!0})}));var Bx=Object.freeze({__proto__:null}),Lx=window.pako||Bx;Lx.inflate||(Lx=Lx.default);var Nx,jx=(Nx=new Float32Array(3),function(e){return Nx[0]=e[0]/255,Nx[1]=e[1]/255,Nx[2]=e[2]/255,Nx});var Gx={version:1,parse:function(e,t,i,s){var r=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],positionsDecodeMatrix:e[11]}}(i),n=function(e){return{positions:new Uint16Array(Lx.inflate(e.positions).buffer),normals:new Int8Array(Lx.inflate(e.normals).buffer),indices:new Uint32Array(Lx.inflate(e.indices).buffer),edgeIndices:new Uint32Array(Lx.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(Lx.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(Lx.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(Lx.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(Lx.inflate(e.meshColors).buffer),entityIDs:Lx.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(Lx.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(Lx.inflate(e.entityIsObjects).buffer),positionsDecodeMatrix:new Float32Array(Lx.inflate(e.positionsDecodeMatrix).buffer)}}(r);!function(e,t,i,s){s.positionsCompression="precompressed",s.normalsCompression="precompressed";for(var r=i.positions,n=i.normals,o=i.indices,a=i.edgeIndices,u=i.meshPositions,h=i.meshIndices,l=i.meshEdgesIndices,c=i.meshColors,p=JSON.parse(i.entityIDs),d=i.entityMeshes,f=i.entityIsObjects,m=u.length,v=d.length,g=0;g<v;g++){var _=p[g],y=t.globalizeObjectIds?q.globalizeObjectId(s.id,_):_,b=e.metaScene.metaObjects[y],x={},P={};if(b){if(t.excludeTypesMap&&b.type&&t.excludeTypesMap[b.type])continue;if(t.includeTypesMap&&b.type&&!t.includeTypesMap[b.type])continue;var T=t.objectDefaults?t.objectDefaults[b.type]||t.objectDefaults.DEFAULT:null;T&&(!1===T.visible&&(x.visible=!1),!1===T.pickable&&(x.pickable=!1),T.colorize&&(P.color=T.colorize),void 0!==T.opacity&&null!==T.opacity&&(P.opacity=T.opacity))}else if(t.excludeUnclassifiedObjects)continue;for(var w=g===v-1,M=[],I=d[g],C=w?d.length:d[g+1];I<C;I++){var D=I===m-1,A=y+".mesh."+I,k=jx(c.subarray(4*I,4*I+3)),E=c[4*I+3]/255;s.createMesh(re.apply(P,{id:A,primitive:"triangles",positionsCompressed:r.subarray(u[I],D?r.length:u[I+1]),normalsCompressed:n.subarray(u[I],D?r.length:u[I+1]),indices:o.subarray(h[I],D?o.length:h[I+1]),edgeIndices:a.subarray(l[I],D?a.length:l[I+1]),positionsDecodeMatrix:i.positionsDecodeMatrix,color:k,opacity:E})),M.push(A)}s.createEntity(re.apply(x,{id:y,isObject:1===f[g],meshIds:M}))}}(e,t,n,s)}},Hx=window.pako||Bx;Hx.inflate||(Hx=Hx.default);var Ux=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();var Vx={version:2,parse:function(e,t,i,s){var r=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],positionsDecodeMatrix:e[11],entityMeshIds:e[12],entityMatrices:e[13],entityUsesInstancing:e[14]}}(i),n=function(e){return{positions:new Uint16Array(Hx.inflate(e.positions).buffer),normals:new Int8Array(Hx.inflate(e.normals).buffer),indices:new Uint32Array(Hx.inflate(e.indices).buffer),edgeIndices:new Uint32Array(Hx.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(Hx.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(Hx.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(Hx.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(Hx.inflate(e.meshColors).buffer),entityIDs:Hx.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(Hx.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(Hx.inflate(e.entityIsObjects).buffer),positionsDecodeMatrix:new Float32Array(Hx.inflate(e.positionsDecodeMatrix).buffer),entityMeshIds:new Uint32Array(Hx.inflate(e.entityMeshIds).buffer),entityMatrices:new Float32Array(Hx.inflate(e.entityMatrices).buffer),entityUsesInstancing:new Uint8Array(Hx.inflate(e.entityUsesInstancing).buffer)}}(r);!function(e,t,i,s){s.positionsCompression="precompressed",s.normalsCompression="precompressed";for(var r=i.positions,n=i.normals,o=i.indices,a=i.edgeIndices,u=i.meshPositions,h=i.meshIndices,l=i.meshEdgesIndices,c=i.meshColors,p=JSON.parse(i.entityIDs),d=i.entityMeshes,f=i.entityIsObjects,m=i.entityMeshIds,v=i.entityMatrices,g=i.entityUsesInstancing,_=u.length,y=d.length,b={},x=0;x<y;x++){var P=p[x],T=t.globalizeObjectIds?q.globalizeObjectId(s.id,P):P,w=e.metaScene.metaObjects[T],M={},I={},C=v.subarray(16*x,16*x+16);if(w){if(t.excludeTypesMap&&w.type&&t.excludeTypesMap[w.type])continue;if(t.includeTypesMap&&w.type&&!t.includeTypesMap[w.type])continue;var D=t.objectDefaults?t.objectDefaults[w.type]||t.objectDefaults.DEFAULT:null;D&&(!1===D.visible&&(M.visible=!1),!1===D.pickable&&(M.pickable=!1),D.colorize&&(I.color=D.colorize),void 0!==D.opacity&&null!==D.opacity&&(I.opacity=D.opacity))}else if(t.excludeUnclassifiedObjects)continue;for(var A=x===y-1,k=[],E=d[x],F=A?m.length:d[x+1];E<F;E++){var R=m[E],S=R===_-1,O=T+".mesh."+R,B=Ux(c.subarray(4*R,4*R+3)),L=c[4*R+3]/255,N=r.subarray(u[R],S?r.length:u[R+1]),j=n.subarray(u[R],S?r.length:u[R+1]),G=o.subarray(h[R],S?o.length:h[R+1]),H=a.subarray(l[R],S?a.length:l[R+1]);if(1===g[x]){var U="geometry."+R;U in b||(s.createGeometry({id:U,positionsCompressed:N,normalsCompressed:j,indices:G,edgeIndices:H,primitive:"triangles",positionsDecodeMatrix:i.positionsDecodeMatrix}),b[U]=!0),s.createMesh(re.apply(I,{id:O,color:B,opacity:L,matrix:C,geometryId:U})),k.push(O)}else s.createMesh(re.apply(I,{id:O,primitive:"triangles",positionsCompressed:N,normalsCompressed:j,indices:G,edgeIndices:H,positionsDecodeMatrix:i.positionsDecodeMatrix,color:B,opacity:L})),k.push(O)}k.length&&s.createEntity(re.apply(M,{id:T,isObject:1===f[x],meshIds:k}))}}(e,t,n,s)}},zx=window.pako||Bx;zx.inflate||(zx=zx.default);var Wx=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();var Xx={version:3,parse:function(e,t,i,s){var r=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],instancedPositionsDecodeMatrix:e[11],batchedPositionsDecodeMatrix:e[12],entityMeshIds:e[13],entityMatrices:e[14],entityUsesInstancing:e[15]}}(i),n=function(e){return{positions:new Uint16Array(zx.inflate(e.positions).buffer),normals:new Int8Array(zx.inflate(e.normals).buffer),indices:new Uint32Array(zx.inflate(e.indices).buffer),edgeIndices:new Uint32Array(zx.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(zx.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(zx.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(zx.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(zx.inflate(e.meshColors).buffer),entityIDs:zx.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(zx.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(zx.inflate(e.entityIsObjects).buffer),instancedPositionsDecodeMatrix:new Float32Array(zx.inflate(e.instancedPositionsDecodeMatrix).buffer),batchedPositionsDecodeMatrix:new Float32Array(zx.inflate(e.batchedPositionsDecodeMatrix).buffer),entityMeshIds:new Uint32Array(zx.inflate(e.entityMeshIds).buffer),entityMatrices:new Float32Array(zx.inflate(e.entityMatrices).buffer),entityUsesInstancing:new Uint8Array(zx.inflate(e.entityUsesInstancing).buffer)}}(r);!function(e,t,i,s){s.positionsCompression="precompressed",s.normalsCompression="precompressed";for(var r=i.positions,n=i.normals,o=i.indices,a=i.edgeIndices,u=i.meshPositions,h=i.meshIndices,l=i.meshEdgesIndices,c=i.meshColors,p=JSON.parse(i.entityIDs),d=i.entityMeshes,f=i.entityIsObjects,m=i.entityMeshIds,v=i.entityMatrices,g=i.entityUsesInstancing,_=u.length,y=d.length,b={},x=0;x<y;x++){var P=p[x],T=t.globalizeObjectIds?q.globalizeObjectId(s.id,P):P,w=e.metaScene.metaObjects[T],M={},I={},C=v.subarray(16*x,16*x+16);if(w){if(t.excludeTypesMap&&w.type&&t.excludeTypesMap[w.type])continue;if(t.includeTypesMap&&w.type&&!t.includeTypesMap[w.type])continue;var D=t.objectDefaults?t.objectDefaults[w.type]||t.objectDefaults.DEFAULT:null;D&&(!1===D.visible&&(M.visible=!1),!1===D.pickable&&(M.pickable=!1),D.colorize&&(I.color=D.colorize),void 0!==D.opacity&&null!==D.opacity&&(I.opacity=D.opacity))}else if(t.excludeUnclassifiedObjects)continue;for(var A=x===y-1,k=[],E=d[x],F=A?m.length:d[x+1];E<F;E++){var R=m[E],S=R===_-1,O=T+".mesh."+R,B=Wx(c.subarray(4*R,4*R+3)),L=c[4*R+3]/255,N=r.subarray(u[R],S?r.length:u[R+1]),j=n.subarray(u[R],S?r.length:u[R+1]),G=o.subarray(h[R],S?o.length:h[R+1]),H=a.subarray(l[R],S?a.length:l[R+1]);if(1===g[x]){var U="geometry."+R;U in b||(s.createGeometry({id:U,positionsCompressed:N,normalsCompressed:j,indices:G,edgeIndices:H,primitive:"triangles",positionsDecodeMatrix:i.instancedPositionsDecodeMatrix}),b[U]=!0),s.createMesh(re.apply(I,{id:O,color:B,opacity:L,matrix:C,geometryId:U})),k.push(O)}else s.createMesh(re.apply(I,{id:O,primitive:"triangles",positionsCompressed:N,normalsCompressed:j,indices:G,edgeIndices:H,positionsDecodeMatrix:i.batchedPositionsDecodeMatrix,color:B,opacity:L})),k.push(O)}k.length&&s.createEntity(re.apply(M,{id:T,isObject:1===f[x],meshIds:k}))}}(e,t,n,s)}},Yx=window.pako||Bx;Yx.inflate||(Yx=Yx.default);var Kx=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();var Jx={version:4,parse:function(e,t,i,s){var r=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],decodeMatrices:e[4],matrices:e[5],eachPrimitivePositionsAndNormalsPortion:e[6],eachPrimitiveIndicesPortion:e[7],eachPrimitiveEdgeIndicesPortion:e[8],eachPrimitiveDecodeMatricesPortion:e[9],eachPrimitiveColor:e[10],primitiveInstances:e[11],eachEntityId:e[12],eachEntityPrimitiveInstancesPortion:e[13],eachEntityMatricesPortion:e[14],eachEntityMatrix:e[15]}}(i),n=function(e){return{positions:new Uint16Array(Yx.inflate(e.positions).buffer),normals:new Int8Array(Yx.inflate(e.normals).buffer),indices:new Uint32Array(Yx.inflate(e.indices).buffer),edgeIndices:new Uint32Array(Yx.inflate(e.edgeIndices).buffer),decodeMatrices:new Float32Array(Yx.inflate(e.decodeMatrices).buffer),matrices:new Float32Array(Yx.inflate(e.matrices).buffer),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(Yx.inflate(e.eachPrimitivePositionsAndNormalsPortion).buffer),eachPrimitiveIndicesPortion:new Uint32Array(Yx.inflate(e.eachPrimitiveIndicesPortion).buffer),eachPrimitiveEdgeIndicesPortion:new Uint32Array(Yx.inflate(e.eachPrimitiveEdgeIndicesPortion).buffer),eachPrimitiveDecodeMatricesPortion:new Uint32Array(Yx.inflate(e.eachPrimitiveDecodeMatricesPortion).buffer),eachPrimitiveColor:new Uint8Array(Yx.inflate(e.eachPrimitiveColor).buffer),primitiveInstances:new Uint32Array(Yx.inflate(e.primitiveInstances).buffer),eachEntityId:Yx.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(Yx.inflate(e.eachEntityPrimitiveInstancesPortion).buffer),eachEntityMatricesPortion:new Uint32Array(Yx.inflate(e.eachEntityMatricesPortion).buffer)}}(r);!function(e,t,i,s){s.positionsCompression="precompressed",s.normalsCompression="precompressed";for(var r=i.positions,n=i.normals,o=i.indices,a=i.edgeIndices,u=i.decodeMatrices,h=i.matrices,l=i.eachPrimitivePositionsAndNormalsPortion,c=i.eachPrimitiveIndicesPortion,p=i.eachPrimitiveEdgeIndicesPortion,d=i.eachPrimitiveDecodeMatricesPortion,f=i.eachPrimitiveColor,m=i.primitiveInstances,v=JSON.parse(i.eachEntityId),g=i.eachEntityPrimitiveInstancesPortion,_=i.eachEntityMatricesPortion,y=l.length,b=m.length,x=new Uint8Array(y),P=new Uint32Array(y),T=v.length,w=0;w<y;w++)P[w]=w;P.sort((function(e,t){return d[e]<d[t]?-1:d[e]>d[t]?1:0}));for(var M=0;M<b;M++)x[m[M]]++;for(var I={},C=0;C<T;C++)for(var D=T-1,A=C===D,k=g[C],E=A?g[D]:g[C+1],F=k;F<E;F++){var R=m[F];x[R]>1||(I[R]=C)}for(var S=0;S<y;S++){var O=P[S],B=O===y-1,L=x[O]>1,N=Kx(f.subarray(4*O,4*O+3)),j=f[4*O+3]/255,G=r.subarray(l[O],B?r.length:l[O+1]),H=n.subarray(l[O],B?n.length:l[O+1]),U=o.subarray(c[O],B?o.length:c[O+1]),V=a.subarray(p[O],B?a.length:p[O+1]),z=u.subarray(d[O],d[O]+16);if(L){var W="geometry"+O;s.createGeometry({id:W,primitive:"triangles",positionsCompressed:G,normalsCompressed:H,indices:U,edgeIndices:V,positionsDecodeMatrix:z})}else{var X=O;v[I[O]],s.createMesh(re.apply({},{id:X,primitive:"triangles",positionsCompressed:G,normalsCompressed:H,indices:U,edgeIndices:V,positionsDecodeMatrix:z,color:N,opacity:j}))}}for(var Y=0,K=0;K<T;K++){for(var J=T-1,Z=K===J,Q=v[K],q=g[K],$=Z?g[J]:g[K+1],ee=[],te=q;te<$;te++){var ie=m[te];if(x[ie]>1){var se="instance."+Y++,ne="geometry"+ie,oe=16*_[K],ae=h.subarray(oe,oe+16);s.createMesh(re.apply({},{id:se,geometryId:ne,matrix:ae})),ee.push(se)}else ee.push(ie)}ee.length>0&&s.createEntity(re.apply({},{id:Q,isObject:!0,meshIds:ee}))}}(0,0,n,s)}},Zx=window.pako||Bx;Zx.inflate||(Zx=Zx.default);var Qx=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();var qx={version:5,parse:function(e,t,i,s){var r=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],matrices:e[4],eachPrimitivePositionsAndNormalsPortion:e[5],eachPrimitiveIndicesPortion:e[6],eachPrimitiveEdgeIndicesPortion:e[7],eachPrimitiveColor:e[8],primitiveInstances:e[9],eachEntityId:e[10],eachEntityPrimitiveInstancesPortion:e[11],eachEntityMatricesPortion:e[12]}}(i),n=function(e){return{positions:new Float32Array(Zx.inflate(e.positions).buffer),normals:new Int8Array(Zx.inflate(e.normals).buffer),indices:new Uint32Array(Zx.inflate(e.indices).buffer),edgeIndices:new Uint32Array(Zx.inflate(e.edgeIndices).buffer),matrices:new Float32Array(Zx.inflate(e.matrices).buffer),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(Zx.inflate(e.eachPrimitivePositionsAndNormalsPortion).buffer),eachPrimitiveIndicesPortion:new Uint32Array(Zx.inflate(e.eachPrimitiveIndicesPortion).buffer),eachPrimitiveEdgeIndicesPortion:new Uint32Array(Zx.inflate(e.eachPrimitiveEdgeIndicesPortion).buffer),eachPrimitiveColor:new Uint8Array(Zx.inflate(e.eachPrimitiveColor).buffer),primitiveInstances:new Uint32Array(Zx.inflate(e.primitiveInstances).buffer),eachEntityId:Zx.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(Zx.inflate(e.eachEntityPrimitiveInstancesPortion).buffer),eachEntityMatricesPortion:new Uint32Array(Zx.inflate(e.eachEntityMatricesPortion).buffer)}}(r);!function(e,t,i,s){s.positionsCompression="disabled",s.normalsCompression="precompressed";for(var r=i.positions,n=i.normals,o=i.indices,a=i.edgeIndices,u=i.matrices,h=i.eachPrimitivePositionsAndNormalsPortion,l=i.eachPrimitiveIndicesPortion,c=i.eachPrimitiveEdgeIndicesPortion,p=i.eachPrimitiveColor,d=i.primitiveInstances,f=JSON.parse(i.eachEntityId),m=i.eachEntityPrimitiveInstancesPortion,v=i.eachEntityMatricesPortion,g=h.length,_=d.length,y=new Uint8Array(g),b=f.length,x=0;x<_;x++)y[d[x]]++;for(var P={},T=0;T<b;T++)for(var w=b-1,M=T===w,I=m[T],C=M?m[w]:m[T+1],D=I;D<C;D++){var A=d[D];y[A]>1||(P[A]=T)}for(var k=0;k<g;k++){var E=k===g-1,F=y[k]>1,R=Qx(p.subarray(4*k,4*k+3)),S=p[4*k+3]/255,O=r.subarray(h[k],E?r.length:h[k+1]),B=n.subarray(h[k],E?n.length:h[k+1]),L=o.subarray(l[k],E?o.length:l[k+1]),N=a.subarray(c[k],E?a.length:c[k+1]);if(F){var j="geometry"+k;s.createGeometry({id:j,primitive:"triangles",positionsCompressed:O,normalsCompressed:B,indices:L,edgeIndices:N})}else{var G=k;f[P[k]],s.createMesh(re.apply({},{id:G,primitive:"triangles",positionsCompressed:O,normalsCompressed:B,indices:L,edgeIndices:N,color:R,opacity:S}))}}for(var H=0,U=0;U<b;U++){for(var V=b-1,z=U===V,W=f[U],X=m[U],Y=z?m[V]:m[U+1],K=[],J=X;J<Y;J++){var Z=d[J];if(y[Z]>1){var Q="instance."+H++,q="geometry"+Z,$=16*v[U],ee=u.subarray($,$+16);s.createMesh(re.apply({},{id:Q,geometryId:q,matrix:ee})),K.push(Q)}else K.push(Z)}K.length>0&&s.createEntity(re.apply({},{id:W,isObject:!0,meshIds:K}))}}(0,0,n,s)}},$x=window.pako||Bx;$x.inflate||($x=$x.default);var eP,tP=(eP=new Float32Array(3),function(e){return eP[0]=e[0]/255,eP[1]=e[1]/255,eP[2]=e[2]/255,eP});var iP={version:6,parse:function(e,t,i,s){var r=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],matrices:e[4],reusedPrimitivesDecodeMatrix:e[5],eachPrimitivePositionsAndNormalsPortion:e[6],eachPrimitiveIndicesPortion:e[7],eachPrimitiveEdgeIndicesPortion:e[8],eachPrimitiveColorAndOpacity:e[9],primitiveInstances:e[10],eachEntityId:e[11],eachEntityPrimitiveInstancesPortion:e[12],eachEntityMatricesPortion:e[13],eachTileAABB:e[14],eachTileEntitiesPortion:e[15]}}(i),n=function(e){function t(e,t){return 0===e.length?[]:$x.inflate(e,t).buffer}return{positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedPrimitivesDecodeMatrix:new Float32Array(t(e.reusedPrimitivesDecodeMatrix)),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(t(e.eachPrimitivePositionsAndNormalsPortion)),eachPrimitiveIndicesPortion:new Uint32Array(t(e.eachPrimitiveIndicesPortion)),eachPrimitiveEdgeIndicesPortion:new Uint32Array(t(e.eachPrimitiveEdgeIndicesPortion)),eachPrimitiveColorAndOpacity:new Uint8Array(t(e.eachPrimitiveColorAndOpacity)),primitiveInstances:new Uint32Array(t(e.primitiveInstances)),eachEntityId:$x.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(t(e.eachEntityPrimitiveInstancesPortion)),eachEntityMatricesPortion:new Uint32Array(t(e.eachEntityMatricesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(r);!function(e,t,i,s){for(var r=i.positions,n=i.normals,o=i.indices,a=i.edgeIndices,u=i.matrices,h=i.reusedPrimitivesDecodeMatrix,l=i.eachPrimitivePositionsAndNormalsPortion,c=i.eachPrimitiveIndicesPortion,p=i.eachPrimitiveEdgeIndicesPortion,d=i.eachPrimitiveColorAndOpacity,f=i.primitiveInstances,m=JSON.parse(i.eachEntityId),v=i.eachEntityPrimitiveInstancesPortion,g=i.eachEntityMatricesPortion,_=i.eachTileAABB,y=i.eachTileEntitiesPortion,b=l.length,x=f.length,P=m.length,T=y.length,w=0,M=new Uint32Array(b),I=0;I<x;I++){var C=f[I];void 0!==M[C]?M[C]++:M[C]=1}for(var D=q.vec3(),A=q.AABB3(),k=0;k<T;k++){var E=k===T-1,F=y[k],R=E?P:y[k+1],S=6*k,O=_.subarray(S,S+6);q.getAABB3Center(O,D),A[0]=O[0]-D[0],A[1]=O[1]-D[1],A[2]=O[2]-D[2],A[3]=O[3]-D[0],A[4]=O[4]-D[1],A[5]=O[5]-D[2];for(var B=ui.createPositionsDecodeMatrix(A),L={},N=F;N<R;N++){var j=m[N],G=t.globalizeObjectIds?q.globalizeObjectId(s.id,j):j,H=g[N],U=u.slice(H,H+16),V=N===P-1,z=v[N],W=V?f.length:v[N+1],X=[],Y=e.metaScene.metaObjects[G],K={},J={};if(Y){if(t.excludeTypesMap&&Y.type&&t.excludeTypesMap[Y.type])continue;if(t.includeTypesMap&&Y.type&&!t.includeTypesMap[Y.type])continue;var Z=t.objectDefaults?t.objectDefaults[Y.type]||t.objectDefaults.DEFAULT:null;Z&&(!1===Z.visible&&(K.visible=!1),!1===Z.pickable&&(K.pickable=!1),Z.colorize&&(J.color=Z.colorize),void 0!==Z.opacity&&null!==Z.opacity&&(J.opacity=Z.opacity))}else if(t.excludeUnclassifiedObjects)continue;for(var Q=z;Q<W;Q++){var $=f[Q],ee=M[$]>1,te=$===b-1,ie=r.subarray(l[$],te?r.length:l[$+1]),se=n.subarray(l[$],te?n.length:l[$+1]),ne=o.subarray(c[$],te?o.length:c[$+1]),oe=a.subarray(p[$],te?a.length:p[$+1]),ae=tP(d.subarray(4*$,4*$+3)),ue=d[4*$+3]/255,he=w++;if(ee){var le="geometry."+k+"."+$;L[le]||(s.createGeometry({id:le,primitive:"triangles",positionsCompressed:ie,normalsCompressed:se,indices:ne,edgeIndices:oe,positionsDecodeMatrix:h}),L[le]=!0),s.createMesh(re.apply(J,{id:he,geometryId:le,origin:D,matrix:U,color:ae,opacity:ue})),X.push(he)}else s.createMesh(re.apply(J,{id:he,origin:D,primitive:"triangles",positionsCompressed:ie,normalsCompressed:se,indices:ne,edgeIndices:oe,positionsDecodeMatrix:B,color:ae,opacity:ue})),X.push(he)}X.length>0&&s.createEntity(re.apply(K,{id:G,isObject:!0,meshIds:X}))}}}(e,t,n,s)}},sP=window.pako||Bx;sP.inflate||(sP=sP.default);var rP=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function nP(e){for(var t=[],i=0,s=e.length;i<s;i+=3)t.push(e[i]),t.push(e[i+1]),t.push(e[i+2]),t.push(1);return t}var oP={version:7,parse:function(e,t,i,s){var r=function(e){return{positions:e[0],normals:e[1],colors:e[2],indices:e[3],edgeIndices:e[4],matrices:e[5],reusedGeometriesDecodeMatrix:e[6],eachGeometryPrimitiveType:e[7],eachGeometryPositionsPortion:e[8],eachGeometryNormalsPortion:e[9],eachGeometryColorsPortion:e[10],eachGeometryIndicesPortion:e[11],eachGeometryEdgeIndicesPortion:e[12],eachMeshGeometriesPortion:e[13],eachMeshMatricesPortion:e[14],eachMeshMaterial:e[15],eachEntityId:e[16],eachEntityMeshesPortion:e[17],eachTileAABB:e[18],eachTileEntitiesPortion:e[19]}}(i),n=function(e){function t(e,t){return 0===e.length?[]:sP.inflate(e,t).buffer}return{positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityId:sP.inflate(e.eachEntityId,{to:"string"}),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(r);!function(e,t,i,s){for(var r=i.positions,n=i.normals,o=i.colors,a=i.indices,u=i.edgeIndices,h=i.matrices,l=i.reusedGeometriesDecodeMatrix,c=i.eachGeometryPrimitiveType,p=i.eachGeometryPositionsPortion,d=i.eachGeometryNormalsPortion,f=i.eachGeometryColorsPortion,m=i.eachGeometryIndicesPortion,v=i.eachGeometryEdgeIndicesPortion,g=i.eachMeshGeometriesPortion,_=i.eachMeshMatricesPortion,y=i.eachMeshMaterial,b=JSON.parse(i.eachEntityId),x=i.eachEntityMeshesPortion,P=i.eachTileAABB,T=i.eachTileEntitiesPortion,w=p.length,M=g.length,I=b.length,C=T.length,D=0,A=new Uint32Array(w),k=0;k<M;k++){var E=g[k];void 0!==A[E]?A[E]++:A[E]=1}for(var F=q.vec3(),R=q.AABB3(),S=0;S<C;S++){var O=S===C-1,B=T[S],L=O?I:T[S+1],N=6*S,j=P.subarray(N,N+6);q.getAABB3Center(j,F),R[0]=j[0]-F[0],R[1]=j[1]-F[1],R[2]=j[2]-F[2],R[3]=j[3]-F[0],R[4]=j[4]-F[1],R[5]=j[5]-F[2];for(var G=ui.createPositionsDecodeMatrix(R),H={},U=B;U<L;U++){var V=b[U],z=t.globalizeObjectIds?q.globalizeObjectId(s.id,V):V,W=U===I-1,X=x[U],Y=W?g.length:x[U+1],K=[],J=e.metaScene.metaObjects[z],Z={},Q={};if(J){if(t.excludeTypesMap&&J.type&&t.excludeTypesMap[J.type])continue;if(t.includeTypesMap&&J.type&&!t.includeTypesMap[J.type])continue;var $=t.objectDefaults?t.objectDefaults[J.type]||t.objectDefaults.DEFAULT:null;$&&(!1===$.visible&&(Z.visible=!1),!1===$.pickable&&(Z.pickable=!1),$.colorize&&(Q.color=$.colorize),void 0!==$.opacity&&null!==$.opacity&&(Q.opacity=$.opacity),void 0!==$.metallic&&null!==$.metallic&&(Q.metallic=$.metallic),void 0!==$.roughness&&null!==$.roughness&&(Q.roughness=$.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(var ee=X;ee<Y;ee++){var te=g[ee],ie=A[te]>1,se=te===w-1,ne=rP(y.subarray(6*ee,6*ee+3)),oe=y[6*ee+3]/255,ae=y[6*ee+4]/255,ue=y[6*ee+5]/255,he=D++;if(ie){var le=_[ee],ce=h.slice(le,le+16),pe="geometry."+S+"."+te;if(!H[pe]){var de=void 0,fe=void 0,me=void 0,ve=void 0,ge=void 0,_e=void 0;switch(c[te]){case 0:de="solid",fe=r.subarray(p[te],se?r.length:p[te+1]),me=n.subarray(d[te],se?n.length:d[te+1]),ge=a.subarray(m[te],se?a.length:m[te+1]),_e=u.subarray(v[te],se?u.length:v[te+1]);break;case 1:de="surface",fe=r.subarray(p[te],se?r.length:p[te+1]),me=n.subarray(d[te],se?n.length:d[te+1]),ge=a.subarray(m[te],se?a.length:m[te+1]),_e=u.subarray(v[te],se?u.length:v[te+1]);break;case 2:de="points",fe=r.subarray(p[te],se?r.length:p[te+1]),ve=nP(o.subarray(f[te],se?o.length:f[te+1]));break;case 3:de="lines",fe=r.subarray(p[te],se?r.length:p[te+1]),ge=a.subarray(m[te],se?a.length:m[te+1]);break;default:continue}s.createGeometry({id:pe,primitive:de,positionsCompressed:fe,normalsCompressed:me,colors:ve,indices:ge,edgeIndices:_e,positionsDecodeMatrix:l}),H[pe]=!0}s.createMesh(re.apply(Q,{id:he,geometryId:pe,origin:F,matrix:ce,color:ne,metallic:ae,roughness:ue,opacity:oe})),K.push(he)}else{var ye=void 0,be=void 0,xe=void 0,Pe=void 0,Te=void 0,we=void 0;switch(c[te]){case 0:ye="solid",be=r.subarray(p[te],se?r.length:p[te+1]),xe=n.subarray(d[te],se?n.length:d[te+1]),Te=a.subarray(m[te],se?a.length:m[te+1]),we=u.subarray(v[te],se?u.length:v[te+1]);break;case 1:ye="surface",be=r.subarray(p[te],se?r.length:p[te+1]),xe=n.subarray(d[te],se?n.length:d[te+1]),Te=a.subarray(m[te],se?a.length:m[te+1]),we=u.subarray(v[te],se?u.length:v[te+1]);break;case 2:ye="points",be=r.subarray(p[te],se?r.length:p[te+1]),Pe=nP(o.subarray(f[te],se?o.length:f[te+1]));break;case 3:ye="lines",be=r.subarray(p[te],se?r.length:p[te+1]),Te=a.subarray(m[te],se?a.length:m[te+1]);break;default:continue}s.createMesh(re.apply(Q,{id:he,origin:F,primitive:ye,positionsCompressed:be,normalsCompressed:xe,colors:Pe,indices:Te,edgeIndices:we,positionsDecodeMatrix:G,color:ne,metallic:ae,roughness:ue,opacity:oe})),K.push(he)}}K.length>0&&s.createEntity(re.apply(Z,{id:z,isObject:!0,meshIds:K}))}}}(e,t,n,s)}},aP=window.pako||Bx;aP.inflate||(aP=aP.default);var uP=q.vec4(),hP=q.vec4();var lP=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function cP(e){for(var t=[],i=0,s=e.length;i<s;i+=3)t.push(e[i]),t.push(e[i+1]),t.push(e[i+2]),t.push(1);return t}var pP={version:8,parse:function(e,t,i,s){var r=function(e){return{types:e[0],eachMetaObjectId:e[1],eachMetaObjectType:e[2],eachMetaObjectName:e[3],eachMetaObjectParent:e[4],positions:e[5],normals:e[6],colors:e[7],indices:e[8],edgeIndices:e[9],matrices:e[10],reusedGeometriesDecodeMatrix:e[11],eachGeometryPrimitiveType:e[12],eachGeometryPositionsPortion:e[13],eachGeometryNormalsPortion:e[14],eachGeometryColorsPortion:e[15],eachGeometryIndicesPortion:e[16],eachGeometryEdgeIndicesPortion:e[17],eachMeshGeometriesPortion:e[18],eachMeshMatricesPortion:e[19],eachMeshMaterial:e[20],eachEntityMetaObject:e[21],eachEntityMeshesPortion:e[22],eachTileAABB:e[23],eachTileEntitiesPortion:e[24]}}(i),n=function(e){function t(e,t){return 0===e.length?[]:aP.inflate(e,t).buffer}return{types:aP.inflate(e.types,{to:"string"}),eachMetaObjectId:aP.inflate(e.eachMetaObjectId,{to:"string"}),eachMetaObjectType:new Uint32Array(t(e.eachMetaObjectType)),eachMetaObjectName:aP.inflate(e.eachMetaObjectName,{to:"string"}),eachMetaObjectParent:new Uint32Array(t(e.eachMetaObjectParent)),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityMetaObject:new Uint32Array(t(e.eachEntityMetaObject)),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(r);!function(e,t,i,s){var r=JSON.parse(i.types),n=JSON.parse(i.eachMetaObjectId),o=i.eachMetaObjectType,a=JSON.parse(i.eachMetaObjectName),u=i.eachMetaObjectParent,h=i.positions,l=i.normals,c=i.colors,p=i.indices,d=i.edgeIndices,f=i.matrices,m=i.reusedGeometriesDecodeMatrix,v=i.eachGeometryPrimitiveType,g=i.eachGeometryPositionsPortion,_=i.eachGeometryNormalsPortion,y=i.eachGeometryColorsPortion,b=i.eachGeometryIndicesPortion,x=i.eachGeometryEdgeIndicesPortion,P=i.eachMeshGeometriesPortion,T=i.eachMeshMatricesPortion,w=i.eachMeshMaterial,M=i.eachEntityMetaObject,I=i.eachEntityMeshesPortion,C=i.eachTileAABB,D=i.eachTileEntitiesPortion,A=n.length,k=g.length,E=P.length,F=M.length,R=D.length,S=0,O=s.id;if(!e.metaScene.metaModels[O]){for(var B={metaObjects:[]},L=0;L<A;L++){var N=n[L],j=r[o[L]]||"default",G=a[L],H=u[L],U=H!==L?n[H]:null;B.metaObjects.push({id:N,type:j,name:G,parent:U})}e.metaScene.createMetaModel(O,B,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds}),s.once("destroyed",(function(){e.metaScene.destroyMetaModel(O)}))}for(var V=new Uint32Array(k),z=0;z<E;z++){var W=P[z];void 0!==V[W]?V[W]++:V[W]=1}for(var X=q.vec3(),Y=q.AABB3(),K={},J=0;J<R;J++){var Z=J===R-1,Q=D[J],$=Z?F:D[J+1],ee=6*J,te=C.subarray(ee,ee+6);q.getAABB3Center(te,X),Y[0]=te[0]-X[0],Y[1]=te[1]-X[1],Y[2]=te[2]-X[2],Y[3]=te[3]-X[0],Y[4]=te[4]-X[1],Y[5]=te[5]-X[2];for(var ie=ui.createPositionsDecodeMatrix(Y),se={},ne=Q;ne<$;ne++){var oe=n[M[ne]],ae=t.globalizeObjectIds?q.globalizeObjectId(s.id,oe):oe,ue=ne===F-1,he=I[ne],le=ue?P.length:I[ne+1],ce=[],pe=e.metaScene.metaObjects[ae],de={},fe={};if(pe){if(t.excludeTypesMap&&pe.type&&t.excludeTypesMap[pe.type])continue;if(t.includeTypesMap&&pe.type&&!t.includeTypesMap[pe.type])continue;var me=t.objectDefaults?t.objectDefaults[pe.type]||t.objectDefaults.DEFAULT:null;me&&(!1===me.visible&&(de.visible=!1),!1===me.pickable&&(de.pickable=!1),me.colorize&&(fe.color=me.colorize),void 0!==me.opacity&&null!==me.opacity&&(fe.opacity=me.opacity),void 0!==me.metallic&&null!==me.metallic&&(fe.metallic=me.metallic),void 0!==me.roughness&&null!==me.roughness&&(fe.roughness=me.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(var ve=he;ve<le;ve++){var ge=P[ve],_e=V[ge]>1,ye=ge===k-1,be=lP(w.subarray(6*ve,6*ve+3)),xe=w[6*ve+3]/255,Pe=w[6*ve+4]/255,Te=w[6*ve+5]/255,we=S++;if(_e){var Me=T[ve],Ie=f.slice(Me,Me+16),Ce="geometry."+J+"."+ge,De=K[Ce];if(!De){De={batchThisMesh:!t.reuseGeometries};var Ae=!1;switch(v[ge]){case 0:De.primitiveName="solid",De.geometryPositions=h.subarray(g[ge],ye?h.length:g[ge+1]),De.geometryNormals=l.subarray(_[ge],ye?l.length:_[ge+1]),De.geometryIndices=p.subarray(b[ge],ye?p.length:b[ge+1]),De.geometryEdgeIndices=d.subarray(x[ge],ye?d.length:x[ge+1]),Ae=De.geometryPositions.length>0&&De.geometryIndices.length>0;break;case 1:De.primitiveName="surface",De.geometryPositions=h.subarray(g[ge],ye?h.length:g[ge+1]),De.geometryNormals=l.subarray(_[ge],ye?l.length:_[ge+1]),De.geometryIndices=p.subarray(b[ge],ye?p.length:b[ge+1]),De.geometryEdgeIndices=d.subarray(x[ge],ye?d.length:x[ge+1]),Ae=De.geometryPositions.length>0&&De.geometryIndices.length>0;break;case 2:De.primitiveName="points",De.geometryPositions=h.subarray(g[ge],ye?h.length:g[ge+1]),De.geometryColors=cP(c.subarray(y[ge],ye?c.length:y[ge+1])),Ae=De.geometryPositions.length>0;break;case 3:De.primitiveName="lines",De.geometryPositions=h.subarray(g[ge],ye?h.length:g[ge+1]),De.geometryIndices=p.subarray(b[ge],ye?p.length:b[ge+1]),Ae=De.geometryPositions.length>0&&De.geometryIndices.length>0;break;default:continue}if(Ae||(De=null),De&&(De.geometryPositions.length,De.batchThisMesh)){De.decompressedPositions=new Float32Array(De.geometryPositions.length);for(var ke=De.geometryPositions,Ee=De.decompressedPositions,Fe=0,Re=ke.length;Fe<Re;Fe+=3)Ee[Fe+0]=ke[Fe+0]*m[0]+m[12],Ee[Fe+1]=ke[Fe+1]*m[5]+m[13],Ee[Fe+2]=ke[Fe+2]*m[10]+m[14];De.geometryPositions=null,K[Ce]=De}}if(De)if(De.batchThisMesh){for(var Se=De.decompressedPositions,Oe=new Uint16Array(Se.length),Be=0,Le=Se.length;Be<Le;Be+=3)uP[0]=Se[Be+0],uP[1]=Se[Be+1],uP[2]=Se[Be+2],uP[3]=1,q.transformVec4(Ie,uP,hP),ui.compressPosition(hP,Y,uP),Oe[Be+0]=uP[0],Oe[Be+1]=uP[1],Oe[Be+2]=uP[2];s.createMesh(re.apply(fe,{id:we,origin:X,primitive:De.primitiveName,positionsCompressed:Oe,normalsCompressed:De.geometryNormals,colorsCompressed:De.geometryColors,indices:De.geometryIndices,edgeIndices:De.geometryEdgeIndices,positionsDecodeMatrix:ie,color:be,metallic:Pe,roughness:Te,opacity:xe})),ce.push(we)}else se[Ce]||(s.createGeometry({id:Ce,primitive:De.primitiveName,positionsCompressed:De.geometryPositions,normalsCompressed:De.geometryNormals,colorsCompressed:De.geometryColors,indices:De.geometryIndices,edgeIndices:De.geometryEdgeIndices,positionsDecodeMatrix:m}),se[Ce]=!0),s.createMesh(re.apply(fe,{id:we,geometryId:Ce,origin:X,matrix:Ie,color:be,metallic:Pe,roughness:Te,opacity:xe})),ce.push(we)}else{var Ne=void 0,je=void 0,Ge=void 0,He=void 0,Ue=void 0,Ve=void 0,ze=!1;switch(v[ge]){case 0:Ne="solid",je=h.subarray(g[ge],ye?h.length:g[ge+1]),Ge=l.subarray(_[ge],ye?l.length:_[ge+1]),Ue=p.subarray(b[ge],ye?p.length:b[ge+1]),Ve=d.subarray(x[ge],ye?d.length:x[ge+1]),ze=je.length>0&&Ue.length>0;break;case 1:Ne="surface",je=h.subarray(g[ge],ye?h.length:g[ge+1]),Ge=l.subarray(_[ge],ye?l.length:_[ge+1]),Ue=p.subarray(b[ge],ye?p.length:b[ge+1]),Ve=d.subarray(x[ge],ye?d.length:x[ge+1]),ze=je.length>0&&Ue.length>0;break;case 2:Ne="points",je=h.subarray(g[ge],ye?h.length:g[ge+1]),He=cP(c.subarray(y[ge],ye?c.length:y[ge+1])),ze=je.length>0;break;case 3:Ne="lines",je=h.subarray(g[ge],ye?h.length:g[ge+1]),Ue=p.subarray(b[ge],ye?p.length:b[ge+1]),ze=je.length>0&&Ue.length>0;break;default:continue}ze&&(s.createMesh(re.apply(fe,{id:we,origin:X,primitive:Ne,positionsCompressed:je,normalsCompressed:Ge,colorsCompressed:He,indices:Ue,edgeIndices:Ve,positionsDecodeMatrix:ie,color:be,metallic:Pe,roughness:Te,opacity:xe})),ce.push(we))}}ce.length>0&&s.createEntity(re.apply(de,{id:ae,isObject:!0,meshIds:ce}))}}}(e,t,n,s)}},dP=window.pako||Bx;dP.inflate||(dP=dP.default);var fP=q.vec4(),mP=q.vec4();var vP=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();var gP={version:9,parse:function(e,t,i,s){var r=function(e){return{metadata:e[0],positions:e[1],normals:e[2],colors:e[3],indices:e[4],edgeIndices:e[5],matrices:e[6],reusedGeometriesDecodeMatrix:e[7],eachGeometryPrimitiveType:e[8],eachGeometryPositionsPortion:e[9],eachGeometryNormalsPortion:e[10],eachGeometryColorsPortion:e[11],eachGeometryIndicesPortion:e[12],eachGeometryEdgeIndicesPortion:e[13],eachMeshGeometriesPortion:e[14],eachMeshMatricesPortion:e[15],eachMeshMaterial:e[16],eachEntityId:e[17],eachEntityMeshesPortion:e[18],eachTileAABB:e[19],eachTileEntitiesPortion:e[20]}}(i),n=function(e){function t(e,t){return 0===e.length?[]:dP.inflate(e,t).buffer}return{metadata:JSON.parse(dP.inflate(e.metadata,{to:"string"})),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityId:JSON.parse(dP.inflate(e.eachEntityId,{to:"string"})),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(r);!function(e,t,i,s){var r=i.metadata,n=i.positions,o=i.normals,a=i.colors,u=i.indices,h=i.edgeIndices,l=i.matrices,c=i.reusedGeometriesDecodeMatrix,p=i.eachGeometryPrimitiveType,d=i.eachGeometryPositionsPortion,f=i.eachGeometryNormalsPortion,m=i.eachGeometryColorsPortion,v=i.eachGeometryIndicesPortion,g=i.eachGeometryEdgeIndicesPortion,_=i.eachMeshGeometriesPortion,y=i.eachMeshMatricesPortion,b=i.eachMeshMaterial,x=i.eachEntityId,P=i.eachEntityMeshesPortion,T=i.eachTileAABB,w=i.eachTileEntitiesPortion,M=d.length,I=_.length,C=P.length,D=w.length,A=0,k=s.id;e.metaScene.metaModels[k]||(e.metaScene.createMetaModel(k,r,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds}),s.once("destroyed",(function(){e.metaScene.destroyMetaModel(k)})));for(var E=new Uint32Array(M),F=0;F<I;F++){var R=_[F];void 0!==E[R]?E[R]++:E[R]=1}for(var S=q.vec3(),O=q.AABB3(),B={},L=0;L<D;L++){var N=L===D-1,j=w[L],G=N?C-1:w[L+1]-1,H=6*L,U=T.subarray(H,H+6);q.getAABB3Center(U,S),O[0]=U[0]-S[0],O[1]=U[1]-S[1],O[2]=U[2]-S[2],O[3]=U[3]-S[0],O[4]=U[4]-S[1],O[5]=U[5]-S[2];for(var V=ui.createPositionsDecodeMatrix(O),z={},W=j;W<=G;W++){var X=x[W],Y=t.globalizeObjectIds?q.globalizeObjectId(s.id,X):X,K=W===C-1,J=P[W],Z=K?_.length-1:P[W+1]-1,Q=[],$=e.metaScene.metaObjects[Y],ee={},te={};if($){if(t.excludeTypesMap&&$.type&&t.excludeTypesMap[$.type])continue;if(t.includeTypesMap&&$.type&&!t.includeTypesMap[$.type])continue;var ie=t.objectDefaults?t.objectDefaults[$.type]||t.objectDefaults.DEFAULT:null;ie&&(!1===ie.visible&&(ee.visible=!1),!1===ie.pickable&&(ee.pickable=!1),ie.colorize&&(te.color=ie.colorize),void 0!==ie.opacity&&null!==ie.opacity&&(te.opacity=ie.opacity),void 0!==ie.metallic&&null!==ie.metallic&&(te.metallic=ie.metallic),void 0!==ie.roughness&&null!==ie.roughness&&(te.roughness=ie.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(var se=J;se<=Z;se++){var ne=_[se],oe=E[ne]>1,ae=ne===M-1,ue=vP(b.subarray(6*se,6*se+3)),he=b[6*se+3]/255,le=b[6*se+4]/255,ce=b[6*se+5]/255,pe=A++;if(oe){var de=y[se],fe=l.slice(de,de+16),me="geometry."+L+"."+ne,ve=B[me];if(!ve){ve={batchThisMesh:!t.reuseGeometries};var ge=!1;switch(p[ne]){case 0:ve.primitiveName="solid",ve.geometryPositions=n.subarray(d[ne],ae?n.length:d[ne+1]),ve.geometryNormals=o.subarray(f[ne],ae?o.length:f[ne+1]),ve.geometryIndices=u.subarray(v[ne],ae?u.length:v[ne+1]),ve.geometryEdgeIndices=h.subarray(g[ne],ae?h.length:g[ne+1]),ge=ve.geometryPositions.length>0&&ve.geometryIndices.length>0;break;case 1:ve.primitiveName="surface",ve.geometryPositions=n.subarray(d[ne],ae?n.length:d[ne+1]),ve.geometryNormals=o.subarray(f[ne],ae?o.length:f[ne+1]),ve.geometryIndices=u.subarray(v[ne],ae?u.length:v[ne+1]),ve.geometryEdgeIndices=h.subarray(g[ne],ae?h.length:g[ne+1]),ge=ve.geometryPositions.length>0&&ve.geometryIndices.length>0;break;case 2:ve.primitiveName="points",ve.geometryPositions=n.subarray(d[ne],ae?n.length:d[ne+1]),ve.geometryColors=a.subarray(m[ne],ae?a.length:m[ne+1]),ge=ve.geometryPositions.length>0;break;case 3:ve.primitiveName="lines",ve.geometryPositions=n.subarray(d[ne],ae?n.length:d[ne+1]),ve.geometryIndices=u.subarray(v[ne],ae?u.length:v[ne+1]),ge=ve.geometryPositions.length>0&&ve.geometryIndices.length>0;break;default:continue}if(ge||(ve=null),ve&&(ve.geometryPositions.length,ve.batchThisMesh)){ve.decompressedPositions=new Float32Array(ve.geometryPositions.length),ve.transformedAndRecompressedPositions=new Uint16Array(ve.geometryPositions.length);for(var _e=ve.geometryPositions,ye=ve.decompressedPositions,be=0,xe=_e.length;be<xe;be+=3)ye[be+0]=_e[be+0]*c[0]+c[12],ye[be+1]=_e[be+1]*c[5]+c[13],ye[be+2]=_e[be+2]*c[10]+c[14];ve.geometryPositions=null,B[me]=ve}}if(ve)if(ve.batchThisMesh){for(var Pe=ve.decompressedPositions,Te=ve.transformedAndRecompressedPositions,we=0,Me=Pe.length;we<Me;we+=3)fP[0]=Pe[we+0],fP[1]=Pe[we+1],fP[2]=Pe[we+2],fP[3]=1,q.transformVec4(fe,fP,mP),ui.compressPosition(mP,O,fP),Te[we+0]=fP[0],Te[we+1]=fP[1],Te[we+2]=fP[2];s.createMesh(re.apply(te,{id:pe,origin:S,primitive:ve.primitiveName,positionsCompressed:Te,normalsCompressed:ve.geometryNormals,colorsCompressed:ve.geometryColors,indices:ve.geometryIndices,edgeIndices:ve.geometryEdgeIndices,positionsDecodeMatrix:V,color:ue,metallic:le,roughness:ce,opacity:he})),Q.push(pe)}else z[me]||(s.createGeometry({id:me,primitive:ve.primitiveName,positionsCompressed:ve.geometryPositions,normalsCompressed:ve.geometryNormals,colorsCompressed:ve.geometryColors,indices:ve.geometryIndices,edgeIndices:ve.geometryEdgeIndices,positionsDecodeMatrix:c}),z[me]=!0),s.createMesh(re.apply(te,{id:pe,geometryId:me,origin:S,matrix:fe,color:ue,metallic:le,roughness:ce,opacity:he})),Q.push(pe)}else{var Ie=void 0,Ce=void 0,De=void 0,Ae=void 0,ke=void 0,Ee=void 0,Fe=!1;switch(p[ne]){case 0:Ie="solid",Ce=n.subarray(d[ne],ae?n.length:d[ne+1]),De=o.subarray(f[ne],ae?o.length:f[ne+1]),ke=u.subarray(v[ne],ae?u.length:v[ne+1]),Ee=h.subarray(g[ne],ae?h.length:g[ne+1]),Fe=Ce.length>0&&ke.length>0;break;case 1:Ie="surface",Ce=n.subarray(d[ne],ae?n.length:d[ne+1]),De=o.subarray(f[ne],ae?o.length:f[ne+1]),ke=u.subarray(v[ne],ae?u.length:v[ne+1]),Ee=h.subarray(g[ne],ae?h.length:g[ne+1]),Fe=Ce.length>0&&ke.length>0;break;case 2:Ie="points",Ce=n.subarray(d[ne],ae?n.length:d[ne+1]),Ae=a.subarray(m[ne],ae?a.length:m[ne+1]),Fe=Ce.length>0;break;case 3:Ie="lines",Ce=n.subarray(d[ne],ae?n.length:d[ne+1]),ke=u.subarray(v[ne],ae?u.length:v[ne+1]),Fe=Ce.length>0&&ke.length>0;break;default:continue}Fe&&(s.createMesh(re.apply(te,{id:pe,origin:S,primitive:Ie,positionsCompressed:Ce,normalsCompressed:De,colorsCompressed:Ae,indices:ke,edgeIndices:Ee,positionsDecodeMatrix:V,color:ue,metallic:le,roughness:ce,opacity:he})),Q.push(pe))}}Q.length>0&&s.createEntity(re.apply(ee,{id:Y,isObject:!0,meshIds:Q}))}}}(e,t,n,s)}},_P=window.pako||Bx;_P.inflate||(_P=_P.default);var yP=q.vec4(),bP=q.vec4();var xP=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();!function(){var e=document.createElement("canvas"),t=e.getContext("2d")}();var PP={version:10,parse:function(e,t,i,s){var r=function(e){var t=0;return{metadata:e[t++],textureData:e[t++],eachTextureDataPortion:e[t++],eachTextureAttributes:e[t++],positions:e[t++],normals:e[t++],colors:e[t++],uvs:e[t++],indices:e[t++],edgeIndices:e[t++],eachTextureSetTextures:e[t++],matrices:e[t++],reusedGeometriesDecodeMatrix:e[t++],eachGeometryPrimitiveType:e[t++],eachGeometryPositionsPortion:e[t++],eachGeometryNormalsPortion:e[t++],eachGeometryColorsPortion:e[t++],eachGeometryUVsPortion:e[t++],eachGeometryIndicesPortion:e[t++],eachGeometryEdgeIndicesPortion:e[t++],eachMeshGeometriesPortion:e[t++],eachMeshMatricesPortion:e[t++],eachMeshTextureSet:e[t++],eachMeshMaterialAttributes:e[t++],eachEntityId:e[t++],eachEntityMeshesPortion:e[t++],eachTileAABB:e[t++],eachTileEntitiesPortion:e[t++]}}(i),n=function(e){function t(e,t){return 0===e.length?[]:_P.inflate(e,t).buffer}return{metadata:JSON.parse(_P.inflate(e.metadata,{to:"string"})),textureData:new Uint8Array(t(e.textureData)),eachTextureDataPortion:new Uint32Array(t(e.eachTextureDataPortion)),eachTextureAttributes:new Uint16Array(t(e.eachTextureAttributes)),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),uvs:new Float32Array(t(e.uvs)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),eachTextureSetTextures:new Int32Array(t(e.eachTextureSetTextures)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryUVsPortion:new Uint32Array(t(e.eachGeometryUVsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshTextureSet:new Int32Array(t(e.eachMeshTextureSet)),eachMeshMaterialAttributes:new Uint8Array(t(e.eachMeshMaterialAttributes)),eachEntityId:JSON.parse(_P.inflate(e.eachEntityId,{to:"string"})),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(r);!function(e,t,i,s){var r=i.metadata,n=i.textureData,o=i.eachTextureDataPortion,a=i.eachTextureAttributes,u=i.positions,h=i.normals,l=i.colors,c=i.uvs,p=i.indices,d=i.edgeIndices,f=i.eachTextureSetTextures,m=i.matrices,v=i.reusedGeometriesDecodeMatrix,g=i.eachGeometryPrimitiveType,_=i.eachGeometryPositionsPortion,y=i.eachGeometryNormalsPortion,b=i.eachGeometryColorsPortion,x=i.eachGeometryUVsPortion,P=i.eachGeometryIndicesPortion,T=i.eachGeometryEdgeIndicesPortion,w=i.eachMeshGeometriesPortion,M=i.eachMeshMatricesPortion,I=i.eachMeshTextureSet,C=i.eachMeshMaterialAttributes,D=i.eachEntityId,A=i.eachEntityMeshesPortion,k=i.eachTileAABB,E=i.eachTileEntitiesPortion,F=o.length,R=f.length/5,S=_.length,O=w.length,B=A.length,L=E.length,N=0,j=s.id;e.metaScene.metaModels[j]||(e.metaScene.createMetaModel(j,r,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds}),s.once("destroyed",(function(){e.metaScene.destroyMetaModel(j)})));for(var G=0;G<F;G++){var H=G===F-1,U=o[G],V=H?n.length:o[G+1],z=V-U>0,W=9*G,X=1===a[W+0],Y=a[W+1];a[W+2],a[W+3];var K=a[W+4],J=a[W+5],Z=a[W+6],Q=a[W+7],$=a[W+8];if(z){var ee=new Uint8Array(n.subarray(U,V)).buffer,te="texture-".concat(G);if(X)s.createTexture({id:te,buffers:[ee],minFilter:K,magFilter:J,wrapS:Z,wrapT:Q,wrapR:$});else{var ie=new Blob([ee],{type:10001===Y?"image/jpeg":10002===Y?"image/png":"image/gif"}),se=(window.URL||window.webkitURL).createObjectURL(ie),ne=document.createElement("img");ne.src=se,s.createTexture({id:te,image:ne,minFilter:K,magFilter:J,wrapS:Z,wrapT:Q,wrapR:$})}}}for(var oe=0;oe<R;oe++){var ae=5*oe,ue="textureSet-".concat(oe),he=f[ae+0],le=f[ae+1],ce=f[ae+2],pe=f[ae+3],de=f[ae+4];s.createTextureSet({id:ue,colorTextureId:he>=0?"texture-".concat(he):null,normalsTextureId:ce>=0?"texture-".concat(ce):null,metallicRoughnessTextureId:le>=0?"texture-".concat(le):null,emissiveTextureId:pe>=0?"texture-".concat(pe):null,occlusionTextureId:de>=0?"texture-".concat(de):null})}for(var fe=new Uint32Array(S),me=0;me<O;me++){var ve=w[me];void 0!==fe[ve]?fe[ve]++:fe[ve]=1}for(var ge=q.vec3(),_e=q.AABB3(),ye={},be=0;be<L;be++){var xe=be===L-1,Pe=E[be],Te=xe?B-1:E[be+1]-1,we=6*be,Me=k.subarray(we,we+6);q.getAABB3Center(Me,ge),_e[0]=Me[0]-ge[0],_e[1]=Me[1]-ge[1],_e[2]=Me[2]-ge[2],_e[3]=Me[3]-ge[0],_e[4]=Me[4]-ge[1],_e[5]=Me[5]-ge[2];for(var Ie=ui.createPositionsDecodeMatrix(_e),Ce={},De=Pe;De<=Te;De++){var Ae=D[De],ke=t.globalizeObjectIds?q.globalizeObjectId(s.id,Ae):Ae,Ee=De===B-1,Fe=A[De],Re=Ee?w.length-1:A[De+1]-1,Se=[],Oe=e.metaScene.metaObjects[ke],Be={},Le={};if(Oe){if(t.excludeTypesMap&&Oe.type&&t.excludeTypesMap[Oe.type])continue;if(t.includeTypesMap&&Oe.type&&!t.includeTypesMap[Oe.type])continue;var Ne=t.objectDefaults?t.objectDefaults[Oe.type]||t.objectDefaults.DEFAULT:null;Ne&&(!1===Ne.visible&&(Be.visible=!1),!1===Ne.pickable&&(Be.pickable=!1),Ne.colorize&&(Le.color=Ne.colorize),void 0!==Ne.opacity&&null!==Ne.opacity&&(Le.opacity=Ne.opacity),void 0!==Ne.metallic&&null!==Ne.metallic&&(Le.metallic=Ne.metallic),void 0!==Ne.roughness&&null!==Ne.roughness&&(Le.roughness=Ne.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(var je=Fe;je<=Re;je++){var Ge=w[je],He=fe[Ge]>1,Ue=Ge===S-1,Ve=I[je],ze=Ve>=0?"textureSet-".concat(Ve):null,We=xP(C.subarray(6*je,6*je+3)),Xe=C[6*je+3]/255,Ye=C[6*je+4]/255,Ke=C[6*je+5]/255,Je=N++;if(He){var Ze=M[je],Qe=m.slice(Ze,Ze+16),qe="geometry."+be+"."+Ge,$e=ye[qe];if(!$e){$e={batchThisMesh:!t.reuseGeometries};var et=!1;switch(g[Ge]){case 0:$e.primitiveName="solid",$e.geometryPositions=u.subarray(_[Ge],Ue?u.length:_[Ge+1]),$e.geometryNormals=h.subarray(y[Ge],Ue?h.length:y[Ge+1]),$e.geometryUVs=c.subarray(x[Ge],Ue?c.length:x[Ge+1]),$e.geometryIndices=p.subarray(P[Ge],Ue?p.length:P[Ge+1]),$e.geometryEdgeIndices=d.subarray(T[Ge],Ue?d.length:T[Ge+1]),et=$e.geometryPositions.length>0&&$e.geometryIndices.length>0;break;case 1:$e.primitiveName="surface",$e.geometryPositions=u.subarray(_[Ge],Ue?u.length:_[Ge+1]),$e.geometryNormals=h.subarray(y[Ge],Ue?h.length:y[Ge+1]),$e.geometryUVs=c.subarray(x[Ge],Ue?c.length:x[Ge+1]),$e.geometryIndices=p.subarray(P[Ge],Ue?p.length:P[Ge+1]),$e.geometryEdgeIndices=d.subarray(T[Ge],Ue?d.length:T[Ge+1]),et=$e.geometryPositions.length>0&&$e.geometryIndices.length>0;break;case 2:$e.primitiveName="points",$e.geometryPositions=u.subarray(_[Ge],Ue?u.length:_[Ge+1]),$e.geometryColors=l.subarray(b[Ge],Ue?l.length:b[Ge+1]),et=$e.geometryPositions.length>0;break;case 3:$e.primitiveName="lines",$e.geometryPositions=u.subarray(_[Ge],Ue?u.length:_[Ge+1]),$e.geometryIndices=p.subarray(P[Ge],Ue?p.length:P[Ge+1]),et=$e.geometryPositions.length>0&&$e.geometryIndices.length>0;break;default:continue}if(et||($e=null),$e&&($e.geometryPositions.length,$e.batchThisMesh)){$e.decompressedPositions=new Float32Array($e.geometryPositions.length),$e.transformedAndRecompressedPositions=new Uint16Array($e.geometryPositions.length);for(var tt=$e.geometryPositions,it=$e.decompressedPositions,st=0,rt=tt.length;st<rt;st+=3)it[st+0]=tt[st+0]*v[0]+v[12],it[st+1]=tt[st+1]*v[5]+v[13],it[st+2]=tt[st+2]*v[10]+v[14];$e.geometryPositions=null,ye[qe]=$e}}if($e)if($e.batchThisMesh){for(var nt=$e.decompressedPositions,ot=$e.transformedAndRecompressedPositions,at=0,ut=nt.length;at<ut;at+=3)yP[0]=nt[at+0],yP[1]=nt[at+1],yP[2]=nt[at+2],yP[3]=1,q.transformVec4(Qe,yP,bP),ui.compressPosition(bP,_e,yP),ot[at+0]=yP[0],ot[at+1]=yP[1],ot[at+2]=yP[2];s.createMesh(re.apply(Le,{id:Je,textureSetId:ze,origin:ge,primitive:$e.primitiveName,positionsCompressed:ot,normalsCompressed:$e.geometryNormals,uv:$e.geometryUVs,colorsCompressed:$e.geometryColors,indices:$e.geometryIndices,edgeIndices:$e.geometryEdgeIndices,positionsDecodeMatrix:Ie,color:We,metallic:Ye,roughness:Ke,opacity:Xe})),Se.push(Je)}else Ce[qe]||(s.createGeometry({id:qe,primitive:$e.primitiveName,positionsCompressed:$e.geometryPositions,normalsCompressed:$e.geometryNormals,uv:$e.geometryUVs,colorsCompressed:$e.geometryColors,indices:$e.geometryIndices,edgeIndices:$e.geometryEdgeIndices,positionsDecodeMatrix:v}),Ce[qe]=!0),s.createMesh(re.apply(Le,{id:Je,geometryId:qe,textureSetId:ze,matrix:Qe,color:We,metallic:Ye,roughness:Ke,opacity:Xe,origin:ge})),Se.push(Je)}else{var ht=void 0,lt=void 0,ct=void 0,pt=void 0,dt=void 0,ft=void 0,mt=void 0,vt=!1;switch(g[Ge]){case 0:ht="solid",lt=u.subarray(_[Ge],Ue?u.length:_[Ge+1]),ct=h.subarray(y[Ge],Ue?h.length:y[Ge+1]),pt=c.subarray(x[Ge],Ue?c.length:x[Ge+1]),ft=p.subarray(P[Ge],Ue?p.length:P[Ge+1]),mt=d.subarray(T[Ge],Ue?d.length:T[Ge+1]),vt=lt.length>0&&ft.length>0;break;case 1:ht="surface",lt=u.subarray(_[Ge],Ue?u.length:_[Ge+1]),ct=h.subarray(y[Ge],Ue?h.length:y[Ge+1]),pt=c.subarray(x[Ge],Ue?c.length:x[Ge+1]),ft=p.subarray(P[Ge],Ue?p.length:P[Ge+1]),mt=d.subarray(T[Ge],Ue?d.length:T[Ge+1]),vt=lt.length>0&&ft.length>0;break;case 2:ht="points",lt=u.subarray(_[Ge],Ue?u.length:_[Ge+1]),dt=l.subarray(b[Ge],Ue?l.length:b[Ge+1]),vt=lt.length>0;break;case 3:ht="lines",lt=u.subarray(_[Ge],Ue?u.length:_[Ge+1]),ft=p.subarray(P[Ge],Ue?p.length:P[Ge+1]),vt=lt.length>0&&ft.length>0;break;default:continue}vt&&(s.createMesh(re.apply(Le,{id:Je,textureSetId:ze,origin:ge,primitive:ht,positionsCompressed:lt,normalsCompressed:ct,uv:pt&&pt.length>0?pt:null,colorsCompressed:dt,indices:ft,edgeIndices:mt,positionsDecodeMatrix:Ie,color:We,metallic:Ye,roughness:Ke,opacity:Xe})),Se.push(Je))}}Se.length>0&&s.createEntity(re.apply(Be,{id:ke,isObject:!0,meshIds:Se}))}}}(e,t,n,s)}},TP={};TP[Gx.version]=Gx,TP[Vx.version]=Vx,TP[Xx.version]=Xx,TP[Jx.version]=Jx,TP[qx.version]=qx,TP[iP.version]=iP,TP[oP.version]=oP,TP[pP.version]=pP,TP[gP.version]=gP,TP[PP.version]=PP;var wP=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,"XKTLoader",e,r))._maxGeometryBatchSize=r.maxGeometryBatchSize,s.textureTranscoder=r.textureTranscoder,s.dataSource=r.dataSource,s.objectDefaults=r.objectDefaults,s.includeTypes=r.includeTypes,s.excludeTypes=r.excludeTypes,s.excludeUnclassifiedObjects=r.excludeUnclassifiedObjects,s.reuseGeometries=r.reuseGeometries,s}return I(i,[{key:"supportedVersions",get:function(){return Object.keys(TP)}},{key:"textureTranscoder",get:function(){return this._textureTranscoder},set:function(e){this._textureTranscoder=e}},{key:"dataSource",get:function(){return this._dataSource},set:function(e){this._dataSource=e||new Ox}},{key:"objectDefaults",get:function(){return this._objectDefaults},set:function(e){this._objectDefaults=e||Gb}},{key:"includeTypes",get:function(){return this._includeTypes},set:function(e){this._includeTypes=e}},{key:"excludeTypes",get:function(){return this._excludeTypes},set:function(e){this._excludeTypes=e}},{key:"excludeUnclassifiedObjects",get:function(){return this._excludeUnclassifiedObjects},set:function(e){this._excludeUnclassifiedObjects=!!e}},{key:"globalizeObjectIds",get:function(){return this._globalizeObjectIds},set:function(e){this._globalizeObjectIds=!!e}},{key:"reuseGeometries",get:function(){return this._reuseGeometries},set:function(e){this._reuseGeometries=!1!==e}},{key:"load",value:function(){var e,t=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i.id&&this.viewer.scene.components[i.id]&&(this.error("Component with this ID already exists in viewer: "+i.id+" - will autogenerate this ID"),delete i.id);var s=(e=i.useDataTextures?new ur(this.viewer.scene,re.apply(i,{isModel:!0,origin:i.origin,targetLodFps:i.useDataTextures.targetLodFps||!1,enableViewFrustumCulling:i.useDataTextures.enableViewFrustumCulling||!1,disableVertexWelding:i.useDataTextures.disableVertexWelding||!1,disableIndexRebucketing:i.useDataTextures.disableIndexRebucketing||!1})):new Op(this.viewer.scene,re.apply(i,{isModel:!0,textureTranscoder:this._textureTranscoder,maxGeometryBatchSize:this._maxGeometryBatchSize,origin:i.origin}))).id;if(!i.src&&!i.xkt)return this.error("load() param expected: src or xkt"),e;var r={},n=i.includeTypes||this._includeTypes,o=i.excludeTypes||this._excludeTypes,a=i.objectDefaults||this._objectDefaults;if(r.reuseGeometries=null!==i.reuseGeometries&&void 0!==i.reuseGeometries?i.reuseGeometries:!1!==this._reuseGeometries,n){r.includeTypesMap={};for(var u=0,h=n.length;u<h;u++)r.includeTypesMap[n[u]]=!0}if(o){r.excludeTypesMap={};for(var l=0,c=o.length;l<c;l++)r.excludeTypesMap[o[l]]=!0}if(a&&(r.objectDefaults=a),r.excludeUnclassifiedObjects=void 0!==i.excludeUnclassifiedObjects?!!i.excludeUnclassifiedObjects:this._excludeUnclassifiedObjects,r.globalizeObjectIds=void 0!==i.globalizeObjectIds&&null!==i.globalizeObjectIds?!!i.globalizeObjectIds:this._globalizeObjectIds,i.metaModelSrc||i.metaModelData){var p=function(a){return!!t.viewer.metaScene.createMetaModel(s,a,{includeTypes:n,excludeTypes:o,globalizeObjectIds:r.globalizeObjectIds})&&(i.src?t._loadModel(i.src,i,r,e):t._parseModel(i.xkt,i,r,e),e.once("destroyed",(function(){t.viewer.metaScene.destroyMetaModel(e.id)})),!0)};if(i.metaModelSrc){var d=i.metaModelSrc;this.viewer.scene.canvas.spinner.processes++,this._dataSource.getMetaModel(d,(function(i){e.destroyed||(p(i)||(t.error("load(): Failed to load model metadata for model '".concat(s," from '").concat(d,"' - metadata not valid")),e.fire("error","Metadata not valid")),t.viewer.scene.canvas.spinner.processes--)}),(function(i){t.error("load(): Failed to load model metadata for model '".concat(s," from  '").concat(d,"' - ").concat(i)),e.fire("error","Failed to load model metadata from  '".concat(d,"' - ").concat(i)),t.viewer.scene.canvas.spinner.processes--}))}else i.metaModelData&&(p(i.metaModelData)||(this.error("load(): Failed to load model metadata for model '".concat(s," from '").concat(i.metaModelSrc,"' - metadata not valid")),e.fire("error","Metadata not valid")))}else i.src?this._loadModel(i.src,i,r,e):this._parseModel(i.xkt,i,r,e);return e}},{key:"_loadModel",value:function(e,t,i,s){var r=this,n=this.viewer.scene.canvas.spinner;n.processes++,this._dataSource.getXKT(t.src,(function(e){r._parseModel(e,t,i,s),n.processes--}),(function(e){n.processes--,r.error(e),s.fire("error",e)}))}},{key:"_parseModel",value:function(e,t,i,s){if(!s.destroyed){var r=new DataView(e),n=new Uint8Array(e),o=r.getUint32(0,!0),a=TP[o];if(a){this.log("Loading .xkt V"+o);for(var u=r.getUint32(4,!0),h=[],l=4*(u+2),c=0;c<u;c++){var p=r.getUint32(4*(c+2),!0);h.push(n.subarray(l,l+p)),l+=p}a.parse(this.viewer,i,h,s),s.finalize(),this._createDefaultMetaModelIfNeeded(s,t,i),s.scene.once("tick",(function(){s.destroyed||(s.scene.fire("modelLoaded",s.id),s.fire("loaded",!0,!1))}))}else this.error("Unsupported .XKT file version: "+o+" - this XKTLoaderPlugin supports versions "+Object.keys(TP))}}},{key:"_createDefaultMetaModelIfNeeded",value:function(e,t,i){var s,r=this,n=e.id;if(!this.viewer.metaScene.metaModels[n]){var a={metaObjects:[]};a.metaObjects.push({id:n,type:"default",name:n,parent:null});for(var h=e.entityList,l=0,c=h.length;l<c;l++){var p=h[l];p.isObject&&a.metaObjects.push({id:p.id,type:"default",name:p.id,parent:n})}var d=t.src;this.viewer.metaScene.createMetaModel(n,a,{includeTypes:i.includeTypes,excludeTypes:i.excludeTypes,globalizeObjectIds:i.globalizeObjectIds,getProperties:(s=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r._dataSource.getProperties(d,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})}),e.once("destroyed",(function(){r.viewer.metaScene.destroyMetaModel(n)}))}}}]),i}(),MP={};!function(e){var t,i="File format is not recognized.",s="Error while reading zip file.",r="Error while reading file data.",n=524288,o="text/plain";try{t=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(e){}function a(){this.crc=-1}function u(){}function h(e,t){var i,s;return i=new ArrayBuffer(e),s=new Uint8Array(i),t&&s.set(t,0),{buffer:i,array:s,view:new DataView(i)}}function l(){}function c(e){var t,i=this;i.size=0,i.init=function(s,r){var n=new Blob([e],{type:o});(t=new d(n)).init((function(){i.size=t.size,s()}),r)},i.readUint8Array=function(e,i,s,r){t.readUint8Array(e,i,s,r)}}function p(t){var i,s=this;s.size=0,s.init=function(e){for(var r=t.length;"="==t.charAt(r-1);)r--;i=t.indexOf(",")+1,s.size=Math.floor(.75*(r-i)),e()},s.readUint8Array=function(s,r,n){var o,a=h(r),u=4*Math.floor(s/3),l=4*Math.ceil((s+r)/3),c=e.atob(t.substring(u+i,l+i)),p=s-3*Math.floor(u/4);for(o=p;o<p+r;o++)a.array[o-p]=c.charCodeAt(o);n(a.array)}}function d(e){var t=this;t.size=0,t.init=function(i){t.size=e.size,i()},t.readUint8Array=function(t,i,s,r){var n=new FileReader;n.onload=function(e){s(new Uint8Array(e.target.result))},n.onerror=r;try{n.readAsArrayBuffer(function(e,t,i){if(t<0||i<0||t+i>e.size)throw new RangeError("offset:"+t+", length:"+i+", size:"+e.size);return e.slice?e.slice(t,t+i):e.webkitSlice?e.webkitSlice(t,t+i):e.mozSlice?e.mozSlice(t,t+i):e.msSlice?e.msSlice(t,t+i):void 0}(e,t,i))}catch(e){r(e)}}}function f(){}function m(e){var i,s=this;s.init=function(e){i=new Blob([],{type:o}),e()},s.writeUint8Array=function(e,s){i=new Blob([i,t?e:e.buffer],{type:o}),s()},s.getData=function(t,s){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=s,r.readAsText(i,e)}}function v(t){var i=this,s="",r="";i.init=function(e){s+="data:"+(t||"")+";base64,",e()},i.writeUint8Array=function(t,i){var n,o=r.length,a=r;for(r="",n=0;n<3*Math.floor((o+t.length)/3)-o;n++)a+=String.fromCharCode(t[n]);for(;n<t.length;n++)r+=String.fromCharCode(t[n]);a.length>2?s+=e.btoa(a):r=a,i()},i.getData=function(t){t(s+e.btoa(r))}}function g(e){var i,s=this;s.init=function(t){i=new Blob([],{type:e}),t()},s.writeUint8Array=function(s,r){i=new Blob([i,t?s:s.buffer],{type:e}),r()},s.getData=function(e){e(i)}}function _(e,t,i,s,r,o,a,u,h,l){var c,p,d,f=0,m=t.sn;function v(){e.removeEventListener("message",g,!1),u(p,d)}function g(t){var i=t.data,r=i.data,n=i.error;if(n)return n.toString=function(){return"Error: "+this.message},void h(n);if(i.sn===m)switch("number"==typeof i.codecTime&&(e.codecTime+=i.codecTime),"number"==typeof i.crcTime&&(e.crcTime+=i.crcTime),i.type){case"append":r?(p+=r.length,s.writeUint8Array(r,(function(){_()}),l)):_();break;case"flush":d=i.crc,r?(p+=r.length,s.writeUint8Array(r,(function(){v()}),l)):v();break;case"progress":a&&a(c+i.loaded,o);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",i)}}function _(){(c=f*n)<=o?i.readUint8Array(r+c,Math.min(n,o-c),(function(i){a&&a(c,o);var s=0===c?t:{sn:m};s.type="append",s.data=i;try{e.postMessage(s,[i.buffer])}catch(t){e.postMessage(s)}f++}),h):e.postMessage({sn:m,type:"flush"})}p=0,e.addEventListener("message",g,!1),_()}function y(e,t,i,s,r,o,u,h,l,c){var p,d=0,f=0,m="input"===o,v="output"===o,g=new a;!function o(){var a;if((p=d*n)<r)t.readUint8Array(s+p,Math.min(n,r-p),(function(t){var s;try{s=e.append(t,(function(e){u&&u(p+e,r)}))}catch(e){return void l(e)}s?(f+=s.length,i.writeUint8Array(s,(function(){d++,setTimeout(o,1)}),c),v&&g.append(s)):(d++,setTimeout(o,1)),m&&g.append(t),u&&u(p,r)}),l);else{try{a=e.flush()}catch(e){return void l(e)}a?(v&&g.append(a),f+=a.length,i.writeUint8Array(a,(function(){h(f,g.get())}),c)):h(f,g.get())}}()}function b(t,i,s,r,n,o,a,h,l,c,p){var d="input";e.zip.useWebWorkers&&a?_(t,{sn:i,codecClass:"NOOP",crcType:d},s,r,n,o,l,h,c,p):y(new u,s,r,n,o,d,l,h,c,p)}function x(e){var t,i,s="",r=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "];for(t=0;t<e.length;t++)s+=(i=255&e.charCodeAt(t))>127?r[i-128]:String.fromCharCode(i);return s}function P(e){return decodeURIComponent(escape(e))}function T(e){var t,i="";for(t=0;t<e.length;t++)i+=String.fromCharCode(e[t]);return i}function w(e,t,i,s,r){e.version=t.view.getUint16(i,!0),e.bitFlag=t.view.getUint16(i+2,!0),e.compressionMethod=t.view.getUint16(i+4,!0),e.lastModDateRaw=t.view.getUint32(i+6,!0),e.lastModDate=function(e){var t=(4294901760&e)>>16,i=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&i)>>11,(2016&i)>>5,2*(31&i),0)}catch(e){}}(e.lastModDateRaw),1!=(1&e.bitFlag)?((s||8!=(8&e.bitFlag))&&(e.crc32=t.view.getUint32(i+10,!0),e.compressedSize=t.view.getUint32(i+14,!0),e.uncompressedSize=t.view.getUint32(i+18,!0)),4294967295!==e.compressedSize&&4294967295!==e.uncompressedSize?(e.filenameLength=t.view.getUint16(i+22,!0),e.extraFieldLength=t.view.getUint16(i+24,!0)):r("File is using Zip64 (4gb+ file size).")):r("File contains encrypted entry.")}function M(t,n,o){var a=0;function u(){}u.prototype.getData=function(s,n,u,l){var c=this;function p(e,t){l&&!function(e){var t=h(4);return t.view.setUint32(0,e),c.crc32==t.view.getUint32(0)}(t)?o("CRC failed."):s.getData((function(e){n(e)}))}function d(e){o(e||r)}function f(e){o(e||"Error while writing file data.")}t.readUint8Array(c.offset,30,(function(r){var n,m=h(r.length,r);1347093252==m.view.getUint32(0)?(w(c,m,4,!1,o),n=c.offset+30+c.filenameLength+c.extraFieldLength,s.init((function(){0===c.compressionMethod?b(c._worker,a++,t,s,n,c.compressedSize,l,p,u,d,f):function(t,i,s,r,n,o,a,u,h,l,c){var p=a?"output":"none";e.zip.useWebWorkers?_(t,{sn:i,codecClass:"Inflater",crcType:p},s,r,n,o,h,u,l,c):y(new e.zip.Inflater,s,r,n,o,p,h,u,l,c)}(c._worker,a++,t,s,n,c.compressedSize,l,p,u,d,f)}),f)):o(i)}),d)};var l={getEntries:function(e){var r=this._worker;!function(e){t.size<22?o(i):r(22,(function(){r(Math.min(65558,t.size),(function(){o(i)}))}));function r(i,r){t.readUint8Array(t.size-i,i,(function(t){for(var i=t.length-22;i>=0;i--)if(80===t[i]&&75===t[i+1]&&5===t[i+2]&&6===t[i+3])return void e(new DataView(t.buffer,i,22));r()}),(function(){o(s)}))}}((function(n){var a,l;a=n.getUint32(16,!0),l=n.getUint16(8,!0),a<0||a>=t.size?o(i):t.readUint8Array(a,t.size-a,(function(t){var s,n,a,c,p=0,d=[],f=h(t.length,t);for(s=0;s<l;s++){if((n=new u)._worker=r,1347092738!=f.view.getUint32(p))return void o(i);w(n,f,p+6,!0,o),n.commentLength=f.view.getUint16(p+32,!0),n.directory=16==(16&f.view.getUint8(p+38)),n.offset=f.view.getUint32(p+42,!0),a=T(f.array.subarray(p+46,p+46+n.filenameLength)),n.filename=2048==(2048&n.bitFlag)?P(a):x(a),n.directory||"/"!=n.filename.charAt(n.filename.length-1)||(n.directory=!0),c=T(f.array.subarray(p+46+n.filenameLength+n.extraFieldLength,p+46+n.filenameLength+n.extraFieldLength+n.commentLength)),n.comment=2048==(2048&n.bitFlag)?P(c):x(c),d.push(n),p+=46+n.filenameLength+n.extraFieldLength+n.commentLength}e(d)}),(function(){o(s)}))}))},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null),e&&e()},_worker:null};e.zip.useWebWorkers?k("inflater",(function(e){l._worker=e,n(l)}),(function(e){o(e)})):n(l)}function I(e){return unescape(encodeURIComponent(e))}function C(e){var t,i=[];for(t=0;t<e.length;t++)i.push(e.charCodeAt(t));return i}function D(t,i,s,n){var o={},a=[],u=0,l=0;function c(e){s(e||"Error while writing zip file.")}function p(e){s(e||r)}var d={add:function(i,r,d,f,m){var v,g,x,P=this._worker;function T(e,i){var s=h(16);u+=e||0,s.view.setUint32(0,1347094280),void 0!==i&&(v.view.setUint32(10,i,!0),s.view.setUint32(4,i,!0)),r&&(s.view.setUint32(8,e,!0),v.view.setUint32(14,e,!0),s.view.setUint32(12,r.size,!0),v.view.setUint32(18,r.size,!0)),t.writeUint8Array(s.array,(function(){u+=16,d()}),c)}function w(){m=m||{},i=i.trim(),m.directory&&"/"!=i.charAt(i.length-1)&&(i+="/"),o.hasOwnProperty(i)?s("File already exists."):(g=C(I(i)),a.push(i),function(e){var s;x=m.lastModDate||new Date,v=h(26),o[i]={headerArray:v.array,directory:m.directory,filename:g,offset:u,comment:C(I(m.comment||""))},v.view.setUint32(0,335546376),m.version&&v.view.setUint8(0,m.version),n||0===m.level||m.directory||v.view.setUint16(4,2048),v.view.setUint16(6,(x.getHours()<<6|x.getMinutes())<<5|x.getSeconds()/2,!0),v.view.setUint16(8,(x.getFullYear()-1980<<4|x.getMonth()+1)<<5|x.getDate(),!0),v.view.setUint16(22,g.length,!0),(s=h(30+g.length)).view.setUint32(0,1347093252),s.array.set(v.array,4),s.array.set(g,30),u+=s.array.length,t.writeUint8Array(s.array,e,c)}((function(){r?n||0===m.level?b(P,l++,r,t,0,r.size,!0,T,f,p,c):function(t,i,s,r,n,o,a,u,h){var l="input";e.zip.useWebWorkers?_(t,{sn:i,options:{level:n},codecClass:"Deflater",crcType:l},s,r,0,s.size,a,o,u,h):y(new e.zip.Deflater,s,r,0,s.size,l,a,o,u,h)}(P,l++,r,t,m.level,T,f,p,c):T()})))}r?r.init(w,p):w()},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null);var i,s,r,n=0,l=0;for(s=0;s<a.length;s++)n+=46+(r=o[a[s]]).filename.length+r.comment.length;for(i=h(n+22),s=0;s<a.length;s++)r=o[a[s]],i.view.setUint32(l,1347092738),i.view.setUint16(l+4,5120),i.array.set(r.headerArray,l+6),i.view.setUint16(l+32,r.comment.length,!0),r.directory&&i.view.setUint8(l+38,16),i.view.setUint32(l+42,r.offset,!0),i.array.set(r.filename,l+46),i.array.set(r.comment,l+46+r.filename.length),l+=46+r.filename.length+r.comment.length;i.view.setUint32(l,1347093766),i.view.setUint16(l+8,a.length,!0),i.view.setUint16(l+10,a.length,!0),i.view.setUint32(l+12,n,!0),i.view.setUint32(l+16,u,!0),t.writeUint8Array(i.array,(function(){t.getData(e)}),c)},_worker:null};e.zip.useWebWorkers?k("deflater",(function(e){d._worker=e,i(d)}),(function(e){s(e)})):i(d)}a.prototype.append=function(e){for(var t=0|this.crc,i=this.table,s=0,r=0|e.length;s<r;s++)t=t>>>8^i[255&(t^e[s])];this.crc=t},a.prototype.get=function(){return~this.crc},a.prototype.table=function(){var e,t,i,s=[];for(e=0;e<256;e++){for(i=e,t=0;t<8;t++)1&i?i=i>>>1^3988292384:i>>>=1;s[e]=i}return s}(),u.prototype.append=function(e,t){return e},u.prototype.flush=function(){},c.prototype=new l,c.prototype.constructor=c,p.prototype=new l,p.prototype.constructor=p,d.prototype=new l,d.prototype.constructor=d,f.prototype.getData=function(e){e(this.data)},m.prototype=new f,m.prototype.constructor=m,v.prototype=new f,v.prototype.constructor=v,g.prototype=new f,g.prototype.constructor=g;var A={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};function k(t,i,s){if(null===e.zip.workerScripts||null===e.zip.workerScriptsPath){var r;if(e.zip.workerScripts){if(r=e.zip.workerScripts[t],!Array.isArray(r))return void s(new Error("zip.workerScripts."+t+" is not an array!"));r=function(e){var t=document.createElement("a");return e.map((function(e){return t.href=e,t.href}))}(r)}else(r=A[t].slice(0))[0]=(e.zip.workerScriptsPath||"")+r[0];var n=new Worker(r[0]);n.codecTime=n.crcTime=0,n.postMessage({type:"importScripts",scripts:r.slice(1)}),n.addEventListener("message",(function e(t){var r=t.data;if(r.error)return n.terminate(),void s(r.error);"importScripts"===r.type&&(n.removeEventListener("message",e),n.removeEventListener("error",o),i(n))})),n.addEventListener("error",o)}else s(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));function o(e){n.terminate(),s(e)}}function E(e){console.error(e)}e.zip={Reader:l,Writer:f,BlobReader:d,Data64URIReader:p,TextReader:c,BlobWriter:g,Data64URIWriter:v,TextWriter:m,createReader:function(e,t,i){i=i||E,e.init((function(){M(e,t,i)}),i)},createWriter:function(e,t,i,s){i=i||E,s=!!s,e.init((function(){D(e,t,i,s)}),i)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null}}(MP);var IP=MP.zip;!function(e){var t,i,s=e.Reader,r=e.Writer;try{i=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(e){}function n(e){var t=this;function i(i,s){var r;t.data?i():((r=new XMLHttpRequest).addEventListener("load",(function(){t.size||(t.size=Number(r.getResponseHeader("Content-Length"))||Number(r.response.byteLength)),t.data=new Uint8Array(r.response),i()}),!1),r.addEventListener("error",s,!1),r.open("GET",e),r.responseType="arraybuffer",r.send())}t.size=0,t.init=function(s,r){if(function(e){var t=document.createElement("a");return t.href=e,"http:"===t.protocol||"https:"===t.protocol}(e)){var n=new XMLHttpRequest;n.addEventListener("load",(function(){t.size=Number(n.getResponseHeader("Content-Length")),t.size?s():i(s,r)}),!1),n.addEventListener("error",r,!1),n.open("HEAD",e),n.send()}else i(s,r)},t.readUint8Array=function(e,s,r,n){i((function(){r(new Uint8Array(t.data.subarray(e,e+s)))}),n)}}function o(e){var t=this;t.size=0,t.init=function(i,s){var r=new XMLHttpRequest;r.addEventListener("load",(function(){t.size=Number(r.getResponseHeader("Content-Length")),"bytes"==r.getResponseHeader("Accept-Ranges")?i():s("HTTP Range not supported.")}),!1),r.addEventListener("error",s,!1),r.open("HEAD",e),r.send()},t.readUint8Array=function(t,i,s,r){!function(t,i,s,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="arraybuffer",n.setRequestHeader("Range","bytes="+t+"-"+(t+i-1)),n.addEventListener("load",(function(){s(n.response)}),!1),n.addEventListener("error",r,!1),n.send()}(t,i,(function(e){s(new Uint8Array(e))}),r)}}function a(e){var t=this;t.size=0,t.init=function(i,s){t.size=e.byteLength,i()},t.readUint8Array=function(t,i,s,r){s(new Uint8Array(e.slice(t,t+i)))}}function u(){var e,t=this;t.init=function(t,i){e=new Uint8Array,t()},t.writeUint8Array=function(t,i,s){var r=new Uint8Array(e.length+t.length);r.set(e),r.set(t,e.length),e=r,i()},t.getData=function(t){t(e.buffer)}}function h(e,t){var s,r=this;r.init=function(t,i){e.createWriter((function(e){s=e,t()}),i)},r.writeUint8Array=function(e,r,n){var o=new Blob([i?e:e.buffer],{type:t});s.onwrite=function(){s.onwrite=null,r()},s.onerror=n,s.write(o)},r.getData=function(t){e.file(t)}}n.prototype=new s,n.prototype.constructor=n,o.prototype=new s,o.prototype.constructor=o,a.prototype=new s,a.prototype.constructor=a,u.prototype=new r,u.prototype.constructor=u,h.prototype=new r,h.prototype.constructor=h,e.FileWriter=h,e.HttpReader=n,e.HttpRangeReader=o,e.ArrayBufferReader=a,e.ArrayBufferWriter=u,e.fs&&((t=e.fs.ZipDirectoryEntry).prototype.addHttpContent=function(i,s,r){return function(i,s,r,n){if(i.directory)return n?new t(i.fs,s,r,i):new e.fs.ZipFileEntry(i.fs,s,r,i);throw"Parent entry is not a directory."}(this,i,{data:s,Reader:r?o:n})},t.prototype.importHttpContent=function(e,t,i,s){this.importZip(t?new o(e):new n(e),i,s)},e.fs.FS.prototype.importHttpContent=function(e,i,s,r){this.entries=[],this.root=new t(this),this.root.importHttpContent(e,i,s,r)})}(IP);var CP=["4.2"],DP=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};w(this,e),this.supportedSchemas=CP,this._xrayOpacity=.7,this._src=null,this._options=i,this.viewpoint=null,i.workerScriptsPath?(IP.workerScriptsPath=i.workerScriptsPath,this.src=i.src,this.xrayOpacity=.7,this.displayEffect=i.displayEffect,this.createMetaModel=i.createMetaModel):t.error("Config expected: workerScriptsPath")}return I(e,[{key:"load",value:function(e,t,i,s,r,n){switch(s.materialType){case"MetallicMaterial":t._defaultMaterial=new ha(t,{baseColor:[1,1,1],metallic:.6,roughness:.6});break;case"SpecularMaterial":t._defaultMaterial=new pa(t,{diffuse:[1,1,1],specular:q.vec3([1,1,1]),glossiness:.5});break;default:t._defaultMaterial=new Tr(t,{reflectivity:.75,shiness:100,diffuse:[1,1,1]})}t._wireframeMaterial=new oa(t,{color:[0,0,0],lineWidth:2});var o=t.scene.canvas.spinner;o.processes++,AP(e,t,i,s,(function(){o.processes--,r&&r(),t.fire("loaded",!0,!1)}),(function(e){o.processes--,t.error(e),n&&n(e),t.fire("error",e)}),(function(e){console.log("Error, Will Robinson: "+e)}))}}]),e}(),AP=function(e,t,i,s,r,n){!function(e,t,i){var s=new LP;s.load(e,(function(){t(s)}),(function(e){i("Error loading ZIP archive: "+e)}))}(i,(function(i){kP(e,i,s,t,r,n)}),n)},kP=function(){return function(t,i,s,r,n){var o={plugin:t,zip:i,edgeThreshold:30,materialType:s.materialType,scene:r.scene,modelNode:r,info:{references:{}},materials:{}};s.createMetaModel&&(o.metaModelData={modelId:r.id,metaObjects:[{name:r.id,type:"Default",id:r.id}]}),r.scene.loading++,function(t,i){t.zip.getFile("Manifest.xml",(function(s,r){for(var n=r.children,o=0,a=n.length;o<a;o++){var u=n[o];if("Manifest"===u.type)e(t,u,i)}}))}(o,(function(){o.metaModelData&&t.viewer.metaScene.createMetaModel(r.id,o.metaModelData),r.scene.loading--,n()}))};function e(e,i,s){for(var r=i.children,n=0,o=r.length;n<o;n++){var a=r[n];if("Root"===a.type){var u=a.children[0];e.zip.getFile(u,(function(i,r){t(e,r,s)}))}}}function t(e,t,s){for(var r=t.children,n=0,o=r.length;n<o;n++){var a=r[n];if("Model_3dxml"===a.type)i(e,a,s)}}function i(e,t,i){for(var r=t.children,a=0,u=r.length;a<u;a++){var h=r[a];switch(h.type){case"Header":s(e,h);break;case"ProductStructure":n(e,h,i);break;case"DefaultView":o(e,h)}}}function s(e,t){for(var i=t.children,s={},n=0,o=i.length;n<o;n++){var a=i[n];switch(a.type){case"SchemaVersion":s.schemaVersion=a.children[0],r(e,s.schemaVersion)||e.plugin.error("Schema version not supported: "+s.schemaVersion+" - supported versions are: "+CP.join(","));break;case"Title":s.title=a.children[0];break;case"Author":s.author=a.children[0];break;case"Created":s.created=a.children[0]}}e.modelNode.meta=s}function r(e,t){for(var i=0,s=CP.length;i<s;i++)if(t===CP[i])return!0;return!1}function n(e,t,i){!function(e,t,i){for(var s={},r=t.children,n=0,o=0,u=r.length;o<u;o++){"ReferenceRep"===(h=r[o]).type&&n++}for(o=0,u=r.length;o<u;o++){var h;if("ReferenceRep"===(h=r[o]).type)if(h.associatedFile){var l=NP(h.associatedFile);!function(){var t=h.id;e.zip.getFile(l,(function(r,o){var u=r.getElementsByTagName("MaterialId");EP(e,u,(function(){var r={id:t};a(e,o,r),s[t]=r,0==--n&&i(s)}))}),(function(e){}))}()}}}(e,t,(function(s){for(var r=t.children,n={},o={},a={},u=0,h=r.length;u<h;u++){var l=r[u];switch(l.type){case"Reference3D":n[l.id]={type:"Reference3D",id:l.id,name:l.name,instance3Ds:{},instanceReps:{}};break;case"InstanceRep":for(var c=0,p=l.children.length;c<p;c++){switch((g=l.children[c]).type){case"IsAggregatedBy":d=g.children[0];break;case"IsInstanceOf":f=g.children[0]}}o[l.id]={type:"InstanceRep",id:l.id,name:l.name,isAggregatedBy:d,isInstanceOf:f,referenceReps:{}};break;case"Instance3D":var d,f,v;for(c=0,p=l.children.length;c<p;c++){var g;switch((g=l.children[c]).type){case"IsAggregatedBy":d=g.children[0];break;case"IsInstanceOf":f=g.children[0];break;case"RelativeMatrix":v=g.children[0]}}a[l.id]={type:"Instance3D",id:l.id,name:l.name,isAggregatedBy:d,isInstanceOf:f,relativeMatrix:v,reference3Ds:{}}}}for(var _ in a){(b=n[(y=a[_]).isAggregatedBy])?b.instance3Ds[y.id]=y:alert("foo")}for(var _ in a){var y,b=n[(y=a[_]).isInstanceOf];y.reference3Ds[b.id]=b,b.instance3D=y}for(var _ in o){var x=s[(P=o[_]).isInstanceOf];x&&(P.referenceReps[x.id]=x)}for(var _ in o){var P;(b=n[(P=o[_]).isAggregatedBy])&&(b.instanceReps[P.id]=P)}function T(e,t,i){for(var s in t.instance3Ds)w(e,t.instance3Ds[s],i);for(var s in t.instanceReps)M(e,t.instanceReps[s],i)}function w(e,t,i){if(t.relativeMatrix){var s=m(t.relativeMatrix,12),r=[s[9],s[10],s[11]],n=s.slice(0,9),o=q.mat3ToMat4(n,q.identityMat4()),a=new na(e.modelNode,{position:r});e.metaModelData&&e.metaModelData.metaObjects.push({id:a.id,type:"Default",name:t.name,parent:i?i.id:e.modelNode.id}),i?i.addChild(a,!0):e.modelNode.addChild(a,!0),i=a,a=new na(e.modelNode,{matrix:o}),e.metaModelData&&e.metaModelData.metaObjects.push({id:a.id,type:"Default",name:t.name,parent:i?i.id:e.modelNode.id}),i.addChild(a,!0),i=a}else{a=new na(e.modelNode,{});e.metaModelData&&e.metaModelData.metaObjects.push({id:a.id,type:"Default",name:t.name,parent:i?i.id:e.modelNode.id}),i?i.addChild(a,!0):e.modelNode.addChild(a,!0),i=a}for(var u in t.reference3Ds)T(e,t.reference3Ds[u],i)}function M(e,t,i){if(t.referenceReps)for(var s in t.referenceReps){var r=t.referenceReps[s];for(var n in r)if("id"!==n){var o=r[n],a="lines"===o.geometry.primitive?e.modelNode._wireframeMaterial:o.materialId?e.materials[o.materialId]:null,u=o.color,h=new Uo(e.modelNode,{isObject:!0,geometry:o.geometry,material:a||e.modelNode._defaultMaterial,colorize:u,backfaces:!1});e.metaModelData&&e.metaModelData.metaObjects.push({id:h.id,type:"Default",name:t.name,parent:i?i.id:e.modelNode.id}),i?i.addChild(h,!0):e.modelNode.addChild(h,!0),h.colorize=u}}}for(var _ in n){if(!(b=n[_]).instance3D)return T(e,b,null),void i()}alert("No root Reference3D element found in this modelNode - can't load."),i()}))}function o(e,t){for(var i=t.children,s=0,r=i.length;s<r;s++){var n=i[s];if("Viewpoint"===n.type){var o=n.children;e.modelNode.viewpoint={};for(var a=0,u=o.length;a<u;a++){var h=o[s];switch(h.type){case"Position":e.modelNode.viewpoint.eye=m(h.children[0],3);break;case"Sight":e.modelNode.viewpoint.look=m(h.children[0],3);break;case"Up":e.modelNode.viewpoint.up=m(h.children[0],3)}}}}}function a(e,t,i){for(var s=t.children,r=0,n=s.length;r<n;r++){var o=s[r];if("XMLRepresentation"===o.type)u(e,o,i)}}function u(e,t,i){for(var s=t.children,r=0,n=s.length;r<n;r++){var o=s[r];if("Root"===o.type)h(e,o,i)}}function h(e,t,i){t["xsi:type"];for(var s=t.children,r=0,n=s.length;r<n;r++){var o=s[r];if("Rep"===o.type)l(e,o,i)}}function l(e,t,i){t["xsi:type"];for(var s={edgeThreshold:e.edgeThreshold||30,compressGeometry:!0},r=t.children,n=0,o=r.length;n<o;n++){var a=r[n];switch(a.type){case"Rep":l(e,a,i);break;case"Edges":break;case"Faces":s.primitive="triangles",c(e,a,s);break;case"VertexBuffer":f(e,a,s);break;case"SurfaceAttributes":v(e,a,s)}}if(s.positions){var u=new _r(e.modelNode,s);i[u.id]={geometry:u,color:s.color||[1,1,1,1],materialId:s.materialId}}}function c(e,t,i){for(var s=t.children,r=0,n=s.length;r<n;r++){var o=s[r];if("Face"===o.type)p(e,o,i)}}function p(e,t,i){var s=t.strips;if(s){var r=function(e){for(var t=e.split(","),i=[],s=0,r=t.length;s<r;s++){var n=t[s].trim();if(n.length>0){for(var o=n.trim().split(" "),a=new Int16Array(o.length),u=0,h=0,l=o.length;h<l;h++)""!==o[h]&&(a[u++]=parseInt(o[h]));i.push(a)}}return i}(s);if(r.length>0){i.primitive="triangles";for(var n=[],o=0,a=r.length;o<a;o++)for(var u=d(r[o]),h=0,l=u.length;h<l;h++)n.push(u[h]);i.indices=n}}else{var c=t.triangles;c&&(i.primitive="triangles",i.indices=function(e){e=e.trim().split(" ");for(var t=new Int32Array(e.length),i=0,s=e.length;i<s;i++){var r=e[i];t[i]=parseInt(r)}return t}(c))}var p=t.children;for(o=0,a=p.length;o<a;o++){var f=p[o];if("SurfaceAttributes"===f.type)v(e,f,i)}}function d(e){for(var t=[],i=0,s=e.length;i<s-2;i++)1&i?(t.push(e[i]),t.push(e[i+2]),t.push(e[i+1])):(t.push(e[i]),t.push(e[i+1]),t.push(e[i+2]));return t}function f(e,t,i){for(var s=t.children,r=0,n=s.length;r<n;r++){var o=s[r];switch(o.type){case"Positions":i.positions=m(o.children[0],3);break;case"Normals":i.normals=m(o.children[0],3);break;case"TextureCoordinates":i.uv=m(o.children[0],2)}}}function m(e,t){e=e.split(",");for(var i=new Float32Array(e.length*t),s=0,r=0,n=e.length;r<n;r++)for(var o=e[r],a=0,u=(o=o.split(" ")).length;a<u;a++)""!==o[a]&&(i[s++]=parseFloat(o[a]));return i}function v(e,t,i){i.color=[1,1,1,1];for(var s,r,n=t.children,o=0,a=n.length;o<a;o++){var u=n[o];switch(u.type){case"Color":i.color[0]=u.red,i.color[1]=u.green,i.color[2]=u.blue,i.color[3]=u.alpha;break;case"MaterialApplication":for(var h=u.children,l=0,c=h.length;l<c;l++){var p=h[l];if("MaterialId"===p.type){var d=(s=p.id,r=void 0,-1!==(r=s.lastIndexOf("#"))?s.substring(r+1):s);e.materials[d]||e.plugin.error("material  not found: "+d),i.materialId=d}}}}}}();function EP(e,t,i){var s={};!function r(n,o){if(n>=t.length)i();else{var a=t[n].id,u=a.lastIndexOf(":");u>0&&(a=a.substring(u+1));var h=a.lastIndexOf("#");h>0&&(a=a.substring(0,h)),s[a]?r(n+1):function(e,t,i){e.zip.getFile(t,(function(t,s){!function(e,t,i){for(var s,r=t.children,n=0,o=r.length;n<o;n++)"Model_3dxml"===(s=r[n]).type&&FP(e,s,i)}(e,s,i)}))}(e,a,(function(){s[a]=!0,r(n+1)}))}}(0)}function FP(e,t,i){for(var s,r=t.children,n=0,o=r.length;n<o;n++)"CATMaterialRef"===(s=r[n]).type&&RP(e,s,i)}function RP(e,t,i){for(var s={},r=t.children,n=0,o=0,a=r.length;o<a;o++){if("MaterialDomainInstance"===(d=r[o]).type){for(var u,h,l=0,c=d.children.length;l<c;l++){var p=d.children[l];switch(p.type){case"IsAggregatedBy":u=p.children[0];break;case"IsInstanceOf":h=p.children[0]}}s[h]=u}}for(o=0,a=r.length;o<a;o++){if("MaterialDomain"===(d=r[o]).type)n++}for(o=0,a=r.length;o<a;o++){var d;if("MaterialDomain"===(d=r[o]).type)d.associatedFile&&function(){var t=d.id,r=NP(d.associatedFile);e.zip.getFile(r,(function(r,o){e.materials[s[t]]=SP(e,o),0==--n&&i()}),(function(e){}))}()}}function SP(e,t){for(var i=t.children,s=0,r=i.length;s<r;s++){var n=i[s];if("Osm"===n.type)return OP(e,n)}}function OP(e,t){for(var i=t.children,s=0,r=i.length;s<r;s++){var n=i[s];switch(n.type){case"RenderingRootFeature":break;case"Feature":if("RenderingFeature"===n.Alias){var o,a,u,h,l={},c={},p=n.children;for(o=0,a=p.length;o<a;o++)switch((u=p[o]).Name){case"AmbientCoef":l.ambient=parseFloat(u.Value);break;case"DiffuseCoef":l.diffuse=parseFloat(u.Value);break;case"EmissiveCoef":l.emissive=parseFloat(u.Value);break;case"SpecularExponent":l.specular=parseFloat(u.Value)}for(o=0,a=p.length;o<a;o++)switch((u=p[o]).Name){case"AmbientColor":c.ambient=BP(u.Value,l.ambient);break;case"DiffuseColor":c.diffuse=BP(u.Value,l.diffuse);break;case"EmissiveColor":c.emissive=BP(u.Value,l.emissive);break;case"SpecularColor":c.specular=BP(u.Value,l.specular);break;case"Transparency":var d=1-parseFloat(u.Value);d<1&&(c.alpha=d,c.alphaMode="blend")}switch(e.materialType){case"MetallicMaterial":h=new ha(e.modelNode,{baseColor:c.diffuse,metallic:.7,roughness:.5,emissive:c.emissive,alpha:c.alpha,alphaMode:c.alphaMode});break;case"SpecularMaterial":h=new pa(e.modelNode,{diffuse:c.diffuse,specular:c.specular,glossiness:.5,emissive:c.emissive,alpha:c.alpha,alphaMode:c.alphaMode});break;default:h=new Tr(e.modelNode,{reflectivity:.5,ambient:c.ambient,diffuse:c.diffuse,specular:c.specular,emissive:c.emissive,alphaMode:c.alphaMode,alpha:t.alpha})}return h}}}}function BP(e,t){t=void 0!==t?t:.5;var i=e.indexOf("["),s=e.indexOf("]");e=(e=e.substring(i+1,s-i)).split(",");for(var r=new Float32Array(e.length),n=0,o=0,a=e.length;o<a;o++)for(var u=e[o],h=0,l=(u=u.trim().split(" ")).length;h<l;h++)""!==u[h]&&(r[n++]=parseFloat(u[h])*t);return r}var LP=function(){var e={};function t(e,i){if(e.nodeType===e.TEXT_NODE){var s=e.nodeValue;if(null===s.match(/^\s+$/))return s}else if(e.nodeType===e.ELEMENT_NODE||e.nodeType===e.DOCUMENT_NODE){var r={type:e.nodeName,children:[]};if(e.nodeType===e.ELEMENT_NODE)for(var n=0;n<e.attributes.length;n++){var o=e.attributes[n];r[i[o.nodeName]||o.nodeName]=o.nodeValue}for(var a=0;a<e.childNodes.length;a++){(n=t(e.childNodes[a],i))&&r.children.push(n)}return r}}this.load=function(t,i,s){IP.createReader(new IP.HttpReader(t),(function(t){t.getEntries((function(t){if(t.length>0)for(var s=0,r=t.length;s<r;s++){var n=t[s];e[n.filename]=n}i()}))}),s)},this.getFile=function(i,s,r){var n=e[i];if(!n){var o="ZIP entry not found: "+i;return console.error(o),void(r&&r(o))}n.getData(new IP.TextWriter,(function(e){var i=(new DOMParser).parseFromString(e,"text/xml"),r=t(i,{});s(i,r)}))},this.destroy=function(){undefined.close((function(){}))}};function NP(e){var t="urn:3DXML:";return 0===e.indexOf(t)?e.substring(t.length):e}var jP,GP=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),s=t.call(this,"XML3DLoader",e,r),r.workerScriptsPath?(s._workerScriptsPath=r.workerScriptsPath,s._loader=new DP(x(s),r),s.supportedSchemas=s._loader.supportedSchemas,s):(s.error("Config expected: workerScriptsPath"),b(s))}return I(i,[{key:"load",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.workerScriptsPath=this._workerScriptsPath,e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);var t=new na(this.viewer.scene,re.apply(e,{isModel:!0})),i=e.src;return i?(this._loader.load(this,t,i,e),t):(this.error("load() param expected: src"),t)}}]),i}(),HP=Object.defineProperty,UP=Object.getOwnPropertySymbols,VP=Object.prototype.hasOwnProperty,zP=Object.prototype.propertyIsEnumerable,WP=function(e,t,i){return t in e?HP(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},XP=function(e,t){for(var i in t||(t={}))VP.call(t,i)&&WP(e,i,t[i]);if(UP){var s,r=n(UP(t));try{for(r.s();!(s=r.n()).done;){i=s.value;zP.call(t,i)&&WP(e,i,t[i])}}catch(e){r.e(e)}finally{r.f()}}return e},YP=function(e){if("undefined"!=typeof require)return require(e);throw new Error('Dynamic require of "'+e+'" is not supported')},KP=function(e,t){return function(){return t||(0,e[Object.keys(e)[0]])((t={exports:{}}).exports,t),t.exports}},JP=function(e,t,i){return new Promise((function(s,r){var n=function(e){try{a(i.next(e))}catch(e){r(e)}},o=function(e){try{a(i.throw(e))}catch(e){r(e)}},a=function(e){return e.done?s(e.value):Promise.resolve(e.value).then(n,o)};a((i=i.apply(e,t)).next())}))},ZP=KP({"(disabled):crypto":function(){}}),QP=KP({"dist/web-ifc-mt.js":function(e,t){var i,s=(i="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(i=i||__filename),function(e){function t(){return R.buffer!=W&&ae(R.buffer),X}function s(){return R.buffer!=W&&ae(R.buffer),Y}function r(){return R.buffer!=W&&ae(R.buffer),K}function n(){return R.buffer!=W&&ae(R.buffer),J}function o(){return R.buffer!=W&&ae(R.buffer),Z}function a(){return R.buffer!=W&&ae(R.buffer),Q}function u(){return R.buffer!=W&&ae(R.buffer),$}var h,l,c=void 0!==(e=e||{})?e:{};c.ready=new Promise((function(e,t){h=e,l=t}));var p,d={};for(p in c)c.hasOwnProperty(p)&&(d[p]=c[p]);var f,m,v,g,_,y="./this.program",b=function(e,t){throw t},x="object"===("undefined"==typeof window?"undefined":T(window)),P="function"==typeof importScripts,w="object"===("undefined"==typeof process?"undefined":T(process))&&"object"===T(process.versions)&&"string"==typeof process.versions.node,M=c.ENVIRONMENT_IS_PTHREAD||!1,I="";function C(e){return c.locateFile?c.locateFile(e,I):I+e}if(w){var D;I=P?YP("path").dirname(I)+"/":__dirname+"/",f=function(e,t){return g||(g=YP("fs")),_||(_=YP("path")),e=_.normalize(e),g.readFileSync(e,t?null:"utf8")},v=function(e){var t=f(e,!0);return t.buffer||(t=new Uint8Array(t)),L(t.buffer),t},m=function(e,t,i){g||(g=YP("fs")),_||(_=YP("path")),e=_.normalize(e),g.readFile(e,(function(e,s){e?i(e):t(s.buffer)}))},process.argv.length>1&&(y=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof vs))throw e})),process.on("unhandledRejection",Te),b=function(e,t){if(fe())throw process.exitCode=e,t;process.exit(e)},c.inspect=function(){return"[Emscripten Module object]"};try{D=YP("worker_threads")}catch(e){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),e}global.Worker=D.Worker}else(x||P)&&(P?I=self.location.href:"undefined"!=typeof document&&document.currentScript&&(I=document.currentScript.src),i&&(I=i),I=0!==I.indexOf("blob:")?I.substr(0,I.lastIndexOf("/")+1):"",w?(f=function(e,t){return g||(g=YP("fs")),_||(_=YP("path")),e=_.normalize(e),g.readFileSync(e,t?null:"utf8")},v=function(e){var t=f(e,!0);return t.buffer||(t=new Uint8Array(t)),L(t.buffer),t},m=function(e,t,i){g||(g=YP("fs")),_||(_=YP("path")),e=_.normalize(e),g.readFile(e,(function(e,s){e?i(e):t(s.buffer)}))}):(f=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},P&&(v=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),m=function(e,t,i){var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(){200==s.status||0==s.status&&s.response?t(s.response):i()},s.onerror=i,s.send(null)}));w&&"undefined"==typeof performance&&(global.performance=YP("perf_hooks").performance);var A,k=c.print||console.log.bind(console),E=c.printErr||console.warn.bind(console);for(p in d)d.hasOwnProperty(p)&&(c[p]=d[p]);function F(e){F.shown||(F.shown={}),F.shown[e]||(F.shown[e]=1,E(e))}d=null,c.arguments,c.thisProgram&&(y=c.thisProgram),c.quit&&(b=c.quit),c.wasmBinary&&(A=c.wasmBinary);var R,S,O=c.noExitRuntime||!0;"object"!==("undefined"==typeof WebAssembly?"undefined":T(WebAssembly))&&Te("no native wasm support detected");var B=!1;function L(e,t){e||Te("Assertion failed: "+t)}function N(e){var t=new TextDecoder(e);this.decode=function(e){return e.buffer instanceof SharedArrayBuffer&&(e=new Uint8Array(e)),t.decode.call(t,e)}}var j="undefined"!=typeof TextDecoder?new N("utf8"):void 0;function G(e,t,i){for(var s=(t>>>=0)+i,r=t;e[r>>>0]&&!(r>=s);)++r;if(r-t>16&&e.subarray&&j)return j.decode(e.subarray(t>>>0,r>>>0));for(var n="";t<r;){var o=e[t++>>>0];if(128&o){var a=63&e[t++>>>0];if(192!=(224&o)){var u=63&e[t++>>>0];if((o=224==(240&o)?(15&o)<<12|a<<6|u:(7&o)<<18|a<<12|u<<6|63&e[t++>>>0])<65536)n+=String.fromCharCode(o);else{var h=o-65536;n+=String.fromCharCode(55296|h>>10,56320|1023&h)}}else n+=String.fromCharCode((31&o)<<6|a)}else n+=String.fromCharCode(o)}return n}function H(e,t){return(e>>>=0)?G(s(),e,t):""}function U(e,t,i,s){if(!(s>0))return 0;for(var r=i>>>=0,n=i+s-1,o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o)),a<=127){if(i>=n)break;t[i++>>>0]=a}else if(a<=2047){if(i+1>=n)break;t[i++>>>0]=192|a>>6,t[i++>>>0]=128|63&a}else if(a<=65535){if(i+2>=n)break;t[i++>>>0]=224|a>>12,t[i++>>>0]=128|a>>6&63,t[i++>>>0]=128|63&a}else{if(i+3>=n)break;t[i++>>>0]=240|a>>18,t[i++>>>0]=128|a>>12&63,t[i++>>>0]=128|a>>6&63,t[i++>>>0]=128|63&a}}return t[i>>>0]=0,i-r}function V(e,t,i){return U(e,s(),t,i)}function z(e){for(var t=0,i=0;i<e.length;++i){var s=e.charCodeAt(i);s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++i)),s<=127?++t:t+=s<=2047?2:s<=65535?3:4}return t}var W,X,Y,K,J,Z,Q,q,$,ee="undefined"!=typeof TextDecoder?new N("utf-16le"):void 0;function te(e,t){for(var i=e,o=i>>1,a=o+t/2;!(o>=a)&&n()[o>>>0];)++o;if((i=o<<1)-e>32&&ee)return ee.decode(s().subarray(e>>>0,i>>>0));for(var u="",h=0;!(h>=t/2);++h){var l=r()[e+2*h>>>1];if(0==l)break;u+=String.fromCharCode(l)}return u}function ie(e,t,i){if(void 0===i&&(i=2147483647),i<2)return 0;for(var s=t,n=(i-=2)<2*e.length?i/2:e.length,o=0;o<n;++o){var a=e.charCodeAt(o);r()[t>>>1]=a,t+=2}return r()[t>>>1]=0,t-s}function se(e){return 2*e.length}function re(e,t){for(var i=0,s="";!(i>=t/4);){var r=o()[e+4*i>>>2];if(0==r)break;if(++i,r>=65536){var n=r-65536;s+=String.fromCharCode(55296|n>>10,56320|1023&n)}else s+=String.fromCharCode(r)}return s}function ne(e,t,i){if(void 0===i&&(i=2147483647),i<4)return 0;for(var s=t>>>=0,r=s+i-4,n=0;n<e.length;++n){var a=e.charCodeAt(n);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++n)),o()[t>>>2]=a,(t+=4)+4>r)break}return o()[t>>>2]=0,t-s}function oe(e){for(var t=0,i=0;i<e.length;++i){var s=e.charCodeAt(i);s>=55296&&s<=57343&&++i,t+=4}return t}function ae(e){W=e,c.HEAP8=X=new Int8Array(e),c.HEAP16=K=new Int16Array(e),c.HEAP32=Z=new Int32Array(e),c.HEAPU8=Y=new Uint8Array(e),c.HEAPU16=J=new Uint16Array(e),c.HEAPU32=Q=new Uint32Array(e),c.HEAPF32=q=new Float32Array(e),c.HEAPF64=$=new Float64Array(e)}M&&(W=c.buffer);var ue,he=c.INITIAL_MEMORY||16777216;if(M)R=c.wasmMemory,W=c.buffer;else if(c.wasmMemory)R=c.wasmMemory;else if(!((R=new WebAssembly.Memory({initial:he/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw E("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),w&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");R&&(W=R.buffer),he=W.byteLength,ae(W);var le=[],ce=[],pe=[],de=[];function fe(){return O||!1}function me(){M||(c.noFSInit||je.init.initialized||je.init(),je.ignorePermissions=!1,De(ce))}var ve,ge,_e,ye=0,be=null;function xe(e){ye++,c.monitorRunDependencies&&c.monitorRunDependencies(ye)}function Pe(e){if(ye--,c.monitorRunDependencies&&c.monitorRunDependencies(ye),0==ye&&be){var t=be;be=null,t()}}function Te(e){c.onAbort&&c.onAbort(e),M&&console.error("Pthread aborting at "+(new Error).stack),E(e+=""),B=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw l(t),t}function we(e){return e.startsWith("data:application/octet-stream;base64,")}function Me(e){return e.startsWith("file://")}function Ie(e){try{if(e==ve&&A)return new Uint8Array(A);if(v)return v(e);throw"both async and sync fetching of the wasm failed"}catch(e){Te(e)}}c.preloadedImages={},c.preloadedAudios={},we(ve="web-ifc-mt.wasm")||(ve=C(ve));var Ce={44848:function(){throw"Canceled!"},44866:function(e,t){setTimeout((function(){qi(e,t)}),0)}};function De(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var i=t.func;"number"==typeof i?void 0===t.arg?ue.get(i)():ue.get(i)(t.arg):i(void 0===t.arg?null:t.arg)}else t(c)}}function Ae(e,i){if(e<=0||e>t().length||!0&e||i<0)return-28;if(0==i)return 0;i>=2147483647&&(i=1/0);var s=Atomics.load(o(),ms>>2),r=0;if(s==e&&Atomics.compareExchange(o(),ms>>2,s,0)==s&&(r=1,--i<=0))return 1;var n=Atomics.notify(o(),e>>2,i);if(n>=0)return n+r;throw"Atomics.notify returned an unexpected value "+n}c._emscripten_futex_wake=Ae;var ke,Ee={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],initMainThreadBlock:function(){for(var e=navigator.hardwareConcurrency,t=0;t<e;++t)Ee.allocateUnusedWorker()},initRuntime:function(){for(var e=Ki(228),t=0;t<57;++t)a()[e/4+t>>>0]=0;o()[e+12>>>2]=e;var i=e+152;o()[i>>>2]=i;var s=Ki(512);for(t=0;t<128;++t)a()[s/4+t>>>0]=0;Atomics.store(a(),e+100>>2,s),Atomics.store(a(),e+40>>2,e),ss(e,!P,1),Qi(e)},initWorker:function(){},pthreads:{},threadExitHandlers:[],runExitHandlers:function(){for(;Ee.threadExitHandlers.length>0;)Ee.threadExitHandlers.pop()();as()},runExitHandlersAndDeinitThread:function(e,t){Atomics.store(a(),e+56>>2,1),Atomics.store(a(),e+60>>2,0),Ee.runExitHandlers(),Atomics.store(a(),e+4>>2,t),Atomics.store(a(),e+0>>2,1),Ae(e+0,2147483647),ss(0,0,0)},setExitStatus:function(e){},threadExit:function(e){var t=os();t&&(Ee.runExitHandlersAndDeinitThread(t,e),M&&postMessage({cmd:"exit"}))},threadCancel:function(){Ee.runExitHandlersAndDeinitThread(os(),-1),postMessage({cmd:"cancelDone"})},terminateAllThreads:function(){for(var e in Ee.pthreads)(s=Ee.pthreads[e])&&s.worker&&Ee.returnWorkerToPool(s.worker);Ee.pthreads={};for(var t=0;t<Ee.unusedWorkers.length;++t)(i=Ee.unusedWorkers[t]).terminate();for(Ee.unusedWorkers=[],t=0;t<Ee.runningWorkers.length;++t){var i,s=(i=Ee.runningWorkers[t]).pthread;Ee.freeThreadData(s),i.terminate()}Ee.runningWorkers=[]},freeThreadData:function(e){if(e){if(e.threadInfoStruct){var t=o()[e.threadInfoStruct+100>>>2];o()[e.threadInfoStruct+100>>>2]=0,Ji(t),Ji(e.threadInfoStruct)}e.threadInfoStruct=0,e.allocatedOwnStack&&e.stackBase&&Ji(e.stackBase),e.stackBase=0,e.worker&&(e.worker.pthread=null)}},returnWorkerToPool:function(e){Ee.runWithoutMainThreadQueuedCalls((function(){delete Ee.pthreads[e.pthread.threadInfoStruct],Ee.unusedWorkers.push(e),Ee.runningWorkers.splice(Ee.runningWorkers.indexOf(e),1),Ee.freeThreadData(e.pthread),e.pthread=void 0}))},runWithoutMainThreadQueuedCalls:function(e){o()[fs>>>2]=0;try{e()}finally{o()[fs>>>2]=1}},receiveObjectTransfer:function(e){},threadInit:function(){for(var e in Ee.tlsInitFunctions)Ee.tlsInitFunctions[e]()},loadWasmModuleToWorker:function(e,t){e.onmessage=function(i){var s=i.data,r=s.cmd;if(e.pthread&&(Ee.currentProxiedOperationCallerThread=e.pthread.threadInfoStruct),s.targetThread&&s.targetThread!=os()){var n=Ee.pthreads[s.targetThread];return n?n.worker.postMessage(i.data,s.transferList):console.error('Internal error! Worker sent a message "'+r+'" to target pthread '+s.targetThread+", but that thread no longer exists!"),void(Ee.currentProxiedOperationCallerThread=void 0)}if("processQueuedMainThreadWork"===r)es();else if("spawnThread"===r)Si(i.data);else if("cleanupThread"===r)!function(e){if(M)throw"Internal Error! cleanupThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in cleanupThread!";var t=Ee.pthreads[e];if(t){o()[e+12>>>2]=0;var i=t.worker;Ee.returnWorkerToPool(i)}}(s.thread);else if("killThread"===r)!function(e){if(M)throw"Internal Error! killThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in killThread!";o()[e+12>>>2]=0;var t=Ee.pthreads[e];t.worker.terminate(),Ee.freeThreadData(t),Ee.runningWorkers.splice(Ee.runningWorkers.indexOf(t.worker),1),t.worker.pthread=void 0}(s.thread);else if("cancelThread"===r)!function(e){if(M)throw"Internal Error! cancelThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in cancelThread!";Ee.pthreads[e].worker.postMessage({cmd:"cancel"})}(s.thread);else if("loaded"===r)e.loaded=!0,t&&t(e),e.runPthread&&(e.runPthread(),delete e.runPthread);else if("print"===r)k("Thread "+s.threadId+": "+s.text);else if("printErr"===r)E("Thread "+s.threadId+": "+s.text);else if("alert"===r)alert("Thread "+s.threadId+": "+s.text);else if("exit"===r)e.pthread&&Atomics.load(a(),e.pthread.threadInfoStruct+64>>2)&&Ee.returnWorkerToPool(e);else if("exitProcess"===r)try{_s(s.returnCode)}catch(e){if(e instanceof vs)return;throw e}else"cancelDone"===r?Ee.returnWorkerToPool(e):"objectTransfer"===r?Ee.receiveObjectTransfer(i.data):"setimmediate"===i.data.target?e.postMessage(i.data):E("worker sent an unknown command "+r);Ee.currentProxiedOperationCallerThread=void 0},e.onerror=function(e){E("pthread sent an error! "+e.filename+":"+e.lineno+": "+e.message)},w&&(e.on("message",(function(t){e.onmessage({data:t})})),e.on("error",(function(t){e.onerror(t)})),e.on("exit",(function(e){}))),e.postMessage({cmd:"load",urlOrBlob:c.mainScriptUrlOrBlob||i,wasmMemory:R,wasmModule:S})},allocateUnusedWorker:function(){var e=C("web-ifc-mt.worker.js");Ee.unusedWorkers.push(new Worker(e))},getNewWorker:function(){return 0==Ee.unusedWorkers.length&&(Ee.allocateUnusedWorker(),Ee.loadWasmModuleToWorker(Ee.unusedWorkers[0])),Ee.unusedWorkers.pop()},busySpinWait:function(e){for(var t=performance.now()+e;performance.now()<t;);}};function Fe(e){return o()[ns()>>>2]=e,e}function Re(e){this.excPtr=e,this.ptr=e-16,this.set_type=function(e){o()[this.ptr+4>>>2]=e},this.get_type=function(){return o()[this.ptr+4>>>2]},this.set_destructor=function(e){o()[this.ptr+8>>>2]=e},this.get_destructor=function(){return o()[this.ptr+8>>>2]},this.set_refcount=function(e){o()[this.ptr>>>2]=e},this.set_caught=function(e){e=e?1:0,t()[this.ptr+12>>>0]=e},this.get_caught=function(){return 0!=t()[this.ptr+12>>>0]},this.set_rethrown=function(e){e=e?1:0,t()[this.ptr+13>>>0]=e},this.get_rethrown=function(){return 0!=t()[this.ptr+13>>>0]},this.init=function(e,t){this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){Atomics.add(o(),this.ptr+0>>2,1)},this.release_ref=function(){return 1===Atomics.sub(o(),this.ptr+0>>2,1)}}c.establishStackSpace=function(e,t){cs(e,t),hs(e)},c.invokeEntryPoint=function(e,t){return ue.get(e)(t)},ke=w?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:M?function(){return performance.now()-c.__performance_now_clock_drift}:function(){return performance.now()};var Se={splitPath:function(e){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1)},normalizeArray:function(e,t){for(var i=0,s=e.length-1;s>=0;s--){var r=e[s];"."===r?e.splice(s,1):".."===r?(e.splice(s,1),i++):i&&(e.splice(s,1),i--)}if(t)for(;i;i--)e.unshift("..");return e},normalize:function(e){var t="/"===e.charAt(0),i="/"===e.substr(-1);return e=Se.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"),e||t||(e="."),e&&i&&(e+="/"),(t?"/":"")+e},dirname:function(e){var t=Se.splitPath(e),i=t[0],s=t[1];return i||s?(s&&(s=s.substr(0,s.length-1)),i+s):"."},basename:function(e){if("/"===e)return"/";var t=(e=(e=Se.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)},extname:function(e){return Se.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return Se.normalize(e.join("/"))},join2:function(e,t){return Se.normalize(e+"/"+t)}},Oe={resolve:function(){for(var e="",t=!1,i=arguments.length-1;i>=-1&&!t;i--){var s=i>=0?arguments[i]:je.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");if(!s)return"";e=s+"/"+e,t="/"===s.charAt(0)}return e=Se.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"),(t?"/":"")+e||"."},relative:function(e,t){function i(e){for(var t=0;t<e.length&&""===e[t];t++);for(var i=e.length-1;i>=0&&""===e[i];i--);return t>i?[]:e.slice(t,i-t+1)}e=Oe.resolve(e).substr(1),t=Oe.resolve(t).substr(1);for(var s=i(e.split("/")),r=i(t.split("/")),n=Math.min(s.length,r.length),o=n,a=0;a<n;a++)if(s[a]!==r[a]){o=a;break}var u=[];for(a=o;a<s.length;a++)u.push("..");return(u=u.concat(r.slice(o))).join("/")}},Be={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){Be.ttys[e]={input:[],output:[],ops:t},je.registerDevice(e,Be.stream_ops)},stream_ops:{open:function(e){var t=Be.ttys[e.node.rdev];if(!t)throw new je.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.flush(e.tty)},flush:function(e){e.tty.ops.flush(e.tty)},read:function(e,t,i,s,r){if(!e.tty||!e.tty.ops.get_char)throw new je.ErrnoError(60);for(var n=0,o=0;o<s;o++){var a;try{a=e.tty.ops.get_char(e.tty)}catch(e){throw new je.ErrnoError(29)}if(void 0===a&&0===n)throw new je.ErrnoError(6);if(null==a)break;n++,t[i+o]=a}return n&&(e.node.timestamp=Date.now()),n},write:function(e,t,i,s,r){if(!e.tty||!e.tty.ops.put_char)throw new je.ErrnoError(60);try{for(var n=0;n<s;n++)e.tty.ops.put_char(e.tty,t[i+n])}catch(e){throw new je.ErrnoError(29)}return s&&(e.node.timestamp=Date.now()),n}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if(w){var i=Buffer.alloc(256),s=0;try{s=g.readSync(process.stdin.fd,i,0,256,null)}catch(e){if(!e.toString().includes("EOF"))throw e;s=0}t=s>0?i.slice(0,s).toString("utf-8"):null}else"undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n");if(!t)return null;e.input=Xi(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(k(G(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(k(G(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(E(G(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(E(G(e.output,0)),e.output=[])}}};function Le(e){e=function(e,t){return t||(t=16),Math.ceil(e/t)*t}(e,65536);var t=ps(65536,e);return t?(function(e,t){s().fill(0,e,e+t)}(t,e),t):0}var Ne={ops_table:null,mount:function(e){return Ne.createNode(null,"/",16895,0)},createNode:function(e,t,i,s){if(je.isBlkdev(i)||je.isFIFO(i))throw new je.ErrnoError(63);Ne.ops_table||(Ne.ops_table={dir:{node:{getattr:Ne.node_ops.getattr,setattr:Ne.node_ops.setattr,lookup:Ne.node_ops.lookup,mknod:Ne.node_ops.mknod,rename:Ne.node_ops.rename,unlink:Ne.node_ops.unlink,rmdir:Ne.node_ops.rmdir,readdir:Ne.node_ops.readdir,symlink:Ne.node_ops.symlink},stream:{llseek:Ne.stream_ops.llseek}},file:{node:{getattr:Ne.node_ops.getattr,setattr:Ne.node_ops.setattr},stream:{llseek:Ne.stream_ops.llseek,read:Ne.stream_ops.read,write:Ne.stream_ops.write,allocate:Ne.stream_ops.allocate,mmap:Ne.stream_ops.mmap,msync:Ne.stream_ops.msync}},link:{node:{getattr:Ne.node_ops.getattr,setattr:Ne.node_ops.setattr,readlink:Ne.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Ne.node_ops.getattr,setattr:Ne.node_ops.setattr},stream:je.chrdev_stream_ops}});var r=je.createNode(e,t,i,s);return je.isDir(r.mode)?(r.node_ops=Ne.ops_table.dir.node,r.stream_ops=Ne.ops_table.dir.stream,r.contents={}):je.isFile(r.mode)?(r.node_ops=Ne.ops_table.file.node,r.stream_ops=Ne.ops_table.file.stream,r.usedBytes=0,r.contents=null):je.isLink(r.mode)?(r.node_ops=Ne.ops_table.link.node,r.stream_ops=Ne.ops_table.link.stream):je.isChrdev(r.mode)&&(r.node_ops=Ne.ops_table.chrdev.node,r.stream_ops=Ne.ops_table.chrdev.stream),r.timestamp=Date.now(),e&&(e.contents[t]=r,e.timestamp=r.timestamp),r},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){t>>>=0;var i=e.contents?e.contents.length:0;if(!(i>=t)){t=Math.max(t,i*(i<1048576?2:1.125)>>>0),0!=i&&(t=Math.max(t,256));var s=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(s.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(t>>>=0,e.usedBytes!=t)if(0==t)e.contents=null,e.usedBytes=0;else{var i=e.contents;e.contents=new Uint8Array(t),i&&e.contents.set(i.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=je.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,je.isDir(e.mode)?t.size=4096:je.isFile(e.mode)?t.size=e.usedBytes:je.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&Ne.resizeFileStorage(e,t.size)},lookup:function(e,t){throw je.genericErrors[44]},mknod:function(e,t,i,s){return Ne.createNode(e,t,i,s)},rename:function(e,t,i){if(je.isDir(e.mode)){var s;try{s=je.lookupNode(t,i)}catch(e){}if(s)for(var r in s.contents)throw new je.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=i,t.contents[i]=e,t.timestamp=e.parent.timestamp,e.parent=t},unlink:function(e,t){delete e.contents[t],e.timestamp=Date.now()},rmdir:function(e,t){var i=je.lookupNode(e,t);for(var s in i.contents)throw new je.ErrnoError(55);delete e.contents[t],e.timestamp=Date.now()},readdir:function(e){var t=[".",".."];for(var i in e.contents)e.contents.hasOwnProperty(i)&&t.push(i);return t},symlink:function(e,t,i){var s=Ne.createNode(e,t,41471,0);return s.link=i,s},readlink:function(e){if(!je.isLink(e.mode))throw new je.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,i,s,r){var n=e.node.contents;if(r>=e.node.usedBytes)return 0;var o=Math.min(e.node.usedBytes-r,s);if(o>8&&n.subarray)t.set(n.subarray(r,r+o),i);else for(var a=0;a<o;a++)t[i+a]=n[r+a];return o},write:function(e,i,s,r,n,o){if(i.buffer===t().buffer&&(o=!1),!r)return 0;var a=e.node;if(a.timestamp=Date.now(),i.subarray&&(!a.contents||a.contents.subarray)){if(o)return a.contents=i.subarray(s,s+r),a.usedBytes=r,r;if(0===a.usedBytes&&0===n)return a.contents=i.slice(s,s+r),a.usedBytes=r,r;if(n+r<=a.usedBytes)return a.contents.set(i.subarray(s,s+r),n),r}if(Ne.expandFileStorage(a,n+r),a.contents.subarray&&i.subarray)a.contents.set(i.subarray(s,s+r),n);else for(var u=0;u<r;u++)a.contents[n+u]=i[s+u];return a.usedBytes=Math.max(a.usedBytes,n+r),r},llseek:function(e,t,i){var s=t;if(1===i?s+=e.position:2===i&&je.isFile(e.node.mode)&&(s+=e.node.usedBytes),s<0)throw new je.ErrnoError(28);return s},allocate:function(e,t,i){Ne.expandFileStorage(e.node,t+i),e.node.usedBytes=Math.max(e.node.usedBytes,t+i)},mmap:function(e,i,s,r,n,o){if(0!==i)throw new je.ErrnoError(28);if(!je.isFile(e.node.mode))throw new je.ErrnoError(43);var a,u,h=e.node.contents;if(2&o||h.buffer!==W){if((r>0||r+s<h.length)&&(h=h.subarray?h.subarray(r,r+s):Array.prototype.slice.call(h,r,r+s)),u=!0,!(a=Le(s)))throw new je.ErrnoError(48);a>>>=0,t().set(h,a>>>0)}else u=!1,a=h.byteOffset;return{ptr:a,allocated:u}},msync:function(e,t,i,s,r){if(!je.isFile(e.node.mode))throw new je.ErrnoError(43);return 2&r||Ne.stream_ops.write(e,t,0,s,i,!1),0}}},je={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(e,t){if(t=t||{},!(e=Oe.resolve(je.cwd(),e)))return{path:"",node:null};var i={follow_mount:!0,recurse_count:0};for(var s in i)void 0===t[s]&&(t[s]=i[s]);if(t.recurse_count>8)throw new je.ErrnoError(32);for(var r=Se.normalizeArray(e.split("/").filter((function(e){return!!e})),!1),n=je.root,o="/",a=0;a<r.length;a++){var u=a===r.length-1;if(u&&t.parent)break;if(n=je.lookupNode(n,r[a]),o=Se.join2(o,r[a]),je.isMountpoint(n)&&(!u||u&&t.follow_mount)&&(n=n.mounted.root),!u||t.follow)for(var h=0;je.isLink(n.mode);){var l=je.readlink(o);if(o=Oe.resolve(Se.dirname(o),l),n=je.lookupPath(o,{recurse_count:t.recurse_count}).node,h++>40)throw new je.ErrnoError(32)}}return{path:o,node:n}},getPath:function(e){for(var t;;){if(je.isRoot(e)){var i=e.mount.mountpoint;return t?"/"!==i[i.length-1]?i+"/"+t:i+t:i}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:function(e,t){for(var i=0,s=0;s<t.length;s++)i=(i<<5)-i+t.charCodeAt(s)|0;return(e+i>>>0)%je.nameTable.length},hashAddNode:function(e){var t=je.hashName(e.parent.id,e.name);e.name_next=je.nameTable[t],je.nameTable[t]=e},hashRemoveNode:function(e){var t=je.hashName(e.parent.id,e.name);if(je.nameTable[t]===e)je.nameTable[t]=e.name_next;else for(var i=je.nameTable[t];i;){if(i.name_next===e){i.name_next=e.name_next;break}i=i.name_next}},lookupNode:function(e,t){var i=je.mayLookup(e);if(i)throw new je.ErrnoError(i,e);for(var s=je.hashName(e.id,t),r=je.nameTable[s];r;r=r.name_next){var n=r.name;if(r.parent.id===e.id&&n===t)return r}return je.lookup(e,t)},createNode:function(e,t,i,s){var r=new je.FSNode(e,t,i,s);return je.hashAddNode(r),r},destroyNode:function(e){je.hashRemoveNode(e)},isRoot:function(e){return e===e.parent},isMountpoint:function(e){return!!e.mounted},isFile:function(e){return 32768==(61440&e)},isDir:function(e){return 16384==(61440&e)},isLink:function(e){return 40960==(61440&e)},isChrdev:function(e){return 8192==(61440&e)},isBlkdev:function(e){return 24576==(61440&e)},isFIFO:function(e){return 4096==(61440&e)},isSocket:function(e){return 49152==(49152&e)},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(e){var t=je.flagModes[e];if(void 0===t)throw new Error("Unknown file open mode: "+e);return t},flagsToPermissionString:function(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:function(e,t){return je.ignorePermissions||(!t.includes("r")||292&e.mode)&&(!t.includes("w")||146&e.mode)&&(!t.includes("x")||73&e.mode)?0:2},mayLookup:function(e){var t=je.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:function(e,t){try{return je.lookupNode(e,t),20}catch(e){}return je.nodePermissions(e,"wx")},mayDelete:function(e,t,i){var s;try{s=je.lookupNode(e,t)}catch(e){return e.errno}var r=je.nodePermissions(e,"wx");if(r)return r;if(i){if(!je.isDir(s.mode))return 54;if(je.isRoot(s)||je.getPath(s)===je.cwd())return 10}else if(je.isDir(s.mode))return 31;return 0},mayOpen:function(e,t){return e?je.isLink(e.mode)?32:je.isDir(e.mode)&&("r"!==je.flagsToPermissionString(t)||512&t)?31:je.nodePermissions(e,je.flagsToPermissionString(t)):44},MAX_OPEN_FDS:4096,nextfd:function(e,t){e=e||0,t=t||je.MAX_OPEN_FDS;for(var i=e;i<=t;i++)if(!je.streams[i])return i;throw new je.ErrnoError(33)},getStream:function(e){return je.streams[e]},createStream:function(e,t,i){je.FSStream||(je.FSStream=function(){},je.FSStream.prototype={object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}});var s=new je.FSStream;for(var r in e)s[r]=e[r];e=s;var n=je.nextfd(t,i);return e.fd=n,je.streams[n]=e,e},closeStream:function(e){je.streams[e]=null},chrdev_stream_ops:{open:function(e){var t=je.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:function(){throw new je.ErrnoError(70)}},major:function(e){return e>>8},minor:function(e){return 255&e},makedev:function(e,t){return e<<8|t},registerDevice:function(e,t){je.devices[e]={stream_ops:t}},getDevice:function(e){return je.devices[e]},getMounts:function(e){for(var t=[],i=[e];i.length;){var s=i.pop();t.push(s),i.push.apply(i,s.mounts)}return t},syncfs:function(e,t){"function"==typeof e&&(t=e,e=!1),je.syncFSRequests++,je.syncFSRequests>1&&E("warning: "+je.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var i=je.getMounts(je.root.mount),s=0;function r(e){return je.syncFSRequests--,t(e)}function n(e){if(e)return n.errored?void 0:(n.errored=!0,r(e));++s>=i.length&&r(null)}i.forEach((function(t){if(!t.type.syncfs)return n(null);t.type.syncfs(t,e,n)}))},mount:function(e,t,i){var s,r="/"===i,n=!i;if(r&&je.root)throw new je.ErrnoError(10);if(!r&&!n){var o=je.lookupPath(i,{follow_mount:!1});if(i=o.path,s=o.node,je.isMountpoint(s))throw new je.ErrnoError(10);if(!je.isDir(s.mode))throw new je.ErrnoError(54)}var a={type:e,opts:t,mountpoint:i,mounts:[]},u=e.mount(a);return u.mount=a,a.root=u,r?je.root=u:s&&(s.mounted=a,s.mount&&s.mount.mounts.push(a)),u},unmount:function(e){var t=je.lookupPath(e,{follow_mount:!1});if(!je.isMountpoint(t.node))throw new je.ErrnoError(28);var i=t.node,s=i.mounted,r=je.getMounts(s);Object.keys(je.nameTable).forEach((function(e){for(var t=je.nameTable[e];t;){var i=t.name_next;r.includes(t.mount)&&je.destroyNode(t),t=i}})),i.mounted=null;var n=i.mount.mounts.indexOf(s);i.mount.mounts.splice(n,1)},lookup:function(e,t){return e.node_ops.lookup(e,t)},mknod:function(e,t,i){var s=je.lookupPath(e,{parent:!0}).node,r=Se.basename(e);if(!r||"."===r||".."===r)throw new je.ErrnoError(28);var n=je.mayCreate(s,r);if(n)throw new je.ErrnoError(n);if(!s.node_ops.mknod)throw new je.ErrnoError(63);return s.node_ops.mknod(s,r,t,i)},create:function(e,t){return t=void 0!==t?t:438,t&=4095,t|=32768,je.mknod(e,t,0)},mkdir:function(e,t){return t=void 0!==t?t:511,t&=1023,t|=16384,je.mknod(e,t,0)},mkdirTree:function(e,t){for(var i=e.split("/"),s="",r=0;r<i.length;++r)if(i[r]){s+="/"+i[r];try{je.mkdir(s,t)}catch(e){if(20!=e.errno)throw e}}},mkdev:function(e,t,i){return void 0===i&&(i=t,t=438),t|=8192,je.mknod(e,t,i)},symlink:function(e,t){if(!Oe.resolve(e))throw new je.ErrnoError(44);var i=je.lookupPath(t,{parent:!0}).node;if(!i)throw new je.ErrnoError(44);var s=Se.basename(t),r=je.mayCreate(i,s);if(r)throw new je.ErrnoError(r);if(!i.node_ops.symlink)throw new je.ErrnoError(63);return i.node_ops.symlink(i,s,e)},rename:function(e,t){var i,s,r=Se.dirname(e),n=Se.dirname(t),o=Se.basename(e),a=Se.basename(t);if(i=je.lookupPath(e,{parent:!0}).node,s=je.lookupPath(t,{parent:!0}).node,!i||!s)throw new je.ErrnoError(44);if(i.mount!==s.mount)throw new je.ErrnoError(75);var u,h=je.lookupNode(i,o),l=Oe.relative(e,n);if("."!==l.charAt(0))throw new je.ErrnoError(28);if("."!==(l=Oe.relative(t,r)).charAt(0))throw new je.ErrnoError(55);try{u=je.lookupNode(s,a)}catch(e){}if(h!==u){var c=je.isDir(h.mode),p=je.mayDelete(i,o,c);if(p)throw new je.ErrnoError(p);if(p=u?je.mayDelete(s,a,c):je.mayCreate(s,a))throw new je.ErrnoError(p);if(!i.node_ops.rename)throw new je.ErrnoError(63);if(je.isMountpoint(h)||u&&je.isMountpoint(u))throw new je.ErrnoError(10);if(s!==i&&(p=je.nodePermissions(i,"w")))throw new je.ErrnoError(p);try{je.trackingDelegate.willMovePath&&je.trackingDelegate.willMovePath(e,t)}catch(i){E("FS.trackingDelegate['willMovePath']('"+e+"', '"+t+"') threw an exception: "+i.message)}je.hashRemoveNode(h);try{i.node_ops.rename(h,s,a)}catch(e){throw e}finally{je.hashAddNode(h)}try{je.trackingDelegate.onMovePath&&je.trackingDelegate.onMovePath(e,t)}catch(i){E("FS.trackingDelegate['onMovePath']('"+e+"', '"+t+"') threw an exception: "+i.message)}}},rmdir:function(e){var t=je.lookupPath(e,{parent:!0}).node,i=Se.basename(e),s=je.lookupNode(t,i),r=je.mayDelete(t,i,!0);if(r)throw new je.ErrnoError(r);if(!t.node_ops.rmdir)throw new je.ErrnoError(63);if(je.isMountpoint(s))throw new je.ErrnoError(10);try{je.trackingDelegate.willDeletePath&&je.trackingDelegate.willDeletePath(e)}catch(t){E("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.rmdir(t,i),je.destroyNode(s);try{je.trackingDelegate.onDeletePath&&je.trackingDelegate.onDeletePath(e)}catch(t){E("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readdir:function(e){var t=je.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new je.ErrnoError(54);return t.node_ops.readdir(t)},unlink:function(e){var t=je.lookupPath(e,{parent:!0}).node,i=Se.basename(e),s=je.lookupNode(t,i),r=je.mayDelete(t,i,!1);if(r)throw new je.ErrnoError(r);if(!t.node_ops.unlink)throw new je.ErrnoError(63);if(je.isMountpoint(s))throw new je.ErrnoError(10);try{je.trackingDelegate.willDeletePath&&je.trackingDelegate.willDeletePath(e)}catch(t){E("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.unlink(t,i),je.destroyNode(s);try{je.trackingDelegate.onDeletePath&&je.trackingDelegate.onDeletePath(e)}catch(t){E("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readlink:function(e){var t=je.lookupPath(e).node;if(!t)throw new je.ErrnoError(44);if(!t.node_ops.readlink)throw new je.ErrnoError(28);return Oe.resolve(je.getPath(t.parent),t.node_ops.readlink(t))},stat:function(e,t){var i=je.lookupPath(e,{follow:!t}).node;if(!i)throw new je.ErrnoError(44);if(!i.node_ops.getattr)throw new je.ErrnoError(63);return i.node_ops.getattr(i)},lstat:function(e){return je.stat(e,!0)},chmod:function(e,t,i){var s;if(!(s="string"==typeof e?je.lookupPath(e,{follow:!i}).node:e).node_ops.setattr)throw new je.ErrnoError(63);s.node_ops.setattr(s,{mode:4095&t|-4096&s.mode,timestamp:Date.now()})},lchmod:function(e,t){je.chmod(e,t,!0)},fchmod:function(e,t){var i=je.getStream(e);if(!i)throw new je.ErrnoError(8);je.chmod(i.node,t)},chown:function(e,t,i,s){var r;if(!(r="string"==typeof e?je.lookupPath(e,{follow:!s}).node:e).node_ops.setattr)throw new je.ErrnoError(63);r.node_ops.setattr(r,{timestamp:Date.now()})},lchown:function(e,t,i){je.chown(e,t,i,!0)},fchown:function(e,t,i){var s=je.getStream(e);if(!s)throw new je.ErrnoError(8);je.chown(s.node,t,i)},truncate:function(e,t){if(t<0)throw new je.ErrnoError(28);var i;if(!(i="string"==typeof e?je.lookupPath(e,{follow:!0}).node:e).node_ops.setattr)throw new je.ErrnoError(63);if(je.isDir(i.mode))throw new je.ErrnoError(31);if(!je.isFile(i.mode))throw new je.ErrnoError(28);var s=je.nodePermissions(i,"w");if(s)throw new je.ErrnoError(s);i.node_ops.setattr(i,{size:t,timestamp:Date.now()})},ftruncate:function(e,t){var i=je.getStream(e);if(!i)throw new je.ErrnoError(8);if(0==(2097155&i.flags))throw new je.ErrnoError(28);je.truncate(i.node,t)},utime:function(e,t,i){var s=je.lookupPath(e,{follow:!0}).node;s.node_ops.setattr(s,{timestamp:Math.max(t,i)})},open:function(e,t,i,s,r){if(""===e)throw new je.ErrnoError(44);var n;if(i=void 0===i?438:i,i=64&(t="string"==typeof t?je.modeStringToFlags(t):t)?4095&i|32768:0,"object"===T(e))n=e;else{e=Se.normalize(e);try{n=je.lookupPath(e,{follow:!(131072&t)}).node}catch(e){}}var o=!1;if(64&t)if(n){if(128&t)throw new je.ErrnoError(20)}else n=je.mknod(e,i,0),o=!0;if(!n)throw new je.ErrnoError(44);if(je.isChrdev(n.mode)&&(t&=-513),65536&t&&!je.isDir(n.mode))throw new je.ErrnoError(54);if(!o){var a=je.mayOpen(n,t);if(a)throw new je.ErrnoError(a)}512&t&&je.truncate(n,0),t&=-131713;var u=je.createStream({node:n,path:je.getPath(n),flags:t,seekable:!0,position:0,stream_ops:n.stream_ops,ungotten:[],error:!1},s,r);u.stream_ops.open&&u.stream_ops.open(u),!c.logReadFiles||1&t||(je.readFiles||(je.readFiles={}),e in je.readFiles||(je.readFiles[e]=1,E("FS.trackingDelegate error on read file: "+e)));try{if(je.trackingDelegate.onOpenFile){var h=0;1!=(2097155&t)&&(h|=je.tracking.openFlags.READ),0!=(2097155&t)&&(h|=je.tracking.openFlags.WRITE),je.trackingDelegate.onOpenFile(e,h)}}catch(t){E("FS.trackingDelegate['onOpenFile']('"+e+"', flags) threw an exception: "+t.message)}return u},close:function(e){if(je.isClosed(e))throw new je.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(e){throw e}finally{je.closeStream(e.fd)}e.fd=null},isClosed:function(e){return null===e.fd},llseek:function(e,t,i){if(je.isClosed(e))throw new je.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new je.ErrnoError(70);if(0!=i&&1!=i&&2!=i)throw new je.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,i),e.ungotten=[],e.position},read:function(e,t,i,s,r){if(i>>>=0,s<0||r<0)throw new je.ErrnoError(28);if(je.isClosed(e))throw new je.ErrnoError(8);if(1==(2097155&e.flags))throw new je.ErrnoError(8);if(je.isDir(e.node.mode))throw new je.ErrnoError(31);if(!e.stream_ops.read)throw new je.ErrnoError(28);var n=void 0!==r;if(n){if(!e.seekable)throw new je.ErrnoError(70)}else r=e.position;var o=e.stream_ops.read(e,t,i,s,r);return n||(e.position+=o),o},write:function(e,t,i,s,r,n){if(i>>>=0,s<0||r<0)throw new je.ErrnoError(28);if(je.isClosed(e))throw new je.ErrnoError(8);if(0==(2097155&e.flags))throw new je.ErrnoError(8);if(je.isDir(e.node.mode))throw new je.ErrnoError(31);if(!e.stream_ops.write)throw new je.ErrnoError(28);e.seekable&&1024&e.flags&&je.llseek(e,0,2);var o=void 0!==r;if(o){if(!e.seekable)throw new je.ErrnoError(70)}else r=e.position;var a=e.stream_ops.write(e,t,i,s,r,n);o||(e.position+=a);try{e.path&&je.trackingDelegate.onWriteToFile&&je.trackingDelegate.onWriteToFile(e.path)}catch(t){E("FS.trackingDelegate['onWriteToFile']('"+e.path+"') threw an exception: "+t.message)}return a},allocate:function(e,t,i){if(je.isClosed(e))throw new je.ErrnoError(8);if(t<0||i<=0)throw new je.ErrnoError(28);if(0==(2097155&e.flags))throw new je.ErrnoError(8);if(!je.isFile(e.node.mode)&&!je.isDir(e.node.mode))throw new je.ErrnoError(43);if(!e.stream_ops.allocate)throw new je.ErrnoError(138);e.stream_ops.allocate(e,t,i)},mmap:function(e,t,i,s,r,n){if(t>>>=0,0!=(2&r)&&0==(2&n)&&2!=(2097155&e.flags))throw new je.ErrnoError(2);if(1==(2097155&e.flags))throw new je.ErrnoError(2);if(!e.stream_ops.mmap)throw new je.ErrnoError(43);return e.stream_ops.mmap(e,t,i,s,r,n)},msync:function(e,t,i,s,r){return i>>>=0,e&&e.stream_ops.msync?e.stream_ops.msync(e,t,i,s,r):0},munmap:function(e){return 0},ioctl:function(e,t,i){if(!e.stream_ops.ioctl)throw new je.ErrnoError(59);return e.stream_ops.ioctl(e,t,i)},readFile:function(e,t){if((t=t||{}).flags=t.flags||0,t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw new Error('Invalid encoding type "'+t.encoding+'"');var i,s=je.open(e,t.flags),r=je.stat(e).size,n=new Uint8Array(r);return je.read(s,n,0,r,0),"utf8"===t.encoding?i=G(n,0):"binary"===t.encoding&&(i=n),je.close(s),i},writeFile:function(e,t,i){(i=i||{}).flags=i.flags||577;var s=je.open(e,i.flags,i.mode);if("string"==typeof t){var r=new Uint8Array(z(t)+1),n=U(t,r,0,r.length);je.write(s,r,0,n,void 0,i.canOwn)}else{if(!ArrayBuffer.isView(t))throw new Error("Unsupported data type");je.write(s,t,0,t.byteLength,void 0,i.canOwn)}je.close(s)},cwd:function(){return je.currentPath},chdir:function(e){var t=je.lookupPath(e,{follow:!0});if(null===t.node)throw new je.ErrnoError(44);if(!je.isDir(t.node.mode))throw new je.ErrnoError(54);var i=je.nodePermissions(t.node,"x");if(i)throw new je.ErrnoError(i);je.currentPath=t.path},createDefaultDirectories:function(){je.mkdir("/tmp"),je.mkdir("/home"),je.mkdir("/home/web_user")},createDefaultDevices:function(){je.mkdir("/dev"),je.registerDevice(je.makedev(1,3),{read:function(){return 0},write:function(e,t,i,s,r){return s}}),je.mkdev("/dev/null",je.makedev(1,3)),Be.register(je.makedev(5,0),Be.default_tty_ops),Be.register(je.makedev(6,0),Be.default_tty1_ops),je.mkdev("/dev/tty",je.makedev(5,0)),je.mkdev("/dev/tty1",je.makedev(6,0));var e=function(){if("object"===("undefined"==typeof crypto?"undefined":T(crypto))&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}if(w)try{var t=ZP();return function(){return t.randomBytes(1)[0]}}catch(e){}return function(){Te("randomDevice")}}();je.createDevice("/dev","random",e),je.createDevice("/dev","urandom",e),je.mkdir("/dev/shm"),je.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){je.mkdir("/proc");var e=je.mkdir("/proc/self");je.mkdir("/proc/self/fd"),je.mount({mount:function(){var t=je.createNode(e,"fd",16895,73);return t.node_ops={lookup:function(e,t){var i=+t,s=je.getStream(i);if(!s)throw new je.ErrnoError(8);var r={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return s.path}}};return r.parent=r,r}},t}},{},"/proc/self/fd")},createStandardStreams:function(){c.stdin?je.createDevice("/dev","stdin",c.stdin):je.symlink("/dev/tty","/dev/stdin"),c.stdout?je.createDevice("/dev","stdout",null,c.stdout):je.symlink("/dev/tty","/dev/stdout"),c.stderr?je.createDevice("/dev","stderr",null,c.stderr):je.symlink("/dev/tty1","/dev/stderr"),je.open("/dev/stdin",0),je.open("/dev/stdout",1),je.open("/dev/stderr",1)},ensureErrnoError:function(){je.ErrnoError||(je.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){this.errno=e},this.setErrno(e),this.message="FS error"},je.ErrnoError.prototype=new Error,je.ErrnoError.prototype.constructor=je.ErrnoError,[44].forEach((function(e){je.genericErrors[e]=new je.ErrnoError(e),je.genericErrors[e].stack="<generic error, no stack>"})))},staticInit:function(){je.ensureErrnoError(),je.nameTable=new Array(4096),je.mount(Ne,{},"/"),je.createDefaultDirectories(),je.createDefaultDevices(),je.createSpecialDirectories(),je.filesystems={MEMFS:Ne}},init:function(e,t,i){je.init.initialized=!0,je.ensureErrnoError(),c.stdin=e||c.stdin,c.stdout=t||c.stdout,c.stderr=i||c.stderr,je.createStandardStreams()},quit:function(){je.init.initialized=!1;var e=c._fflush;e&&e(0);for(var t=0;t<je.streams.length;t++){var i=je.streams[t];i&&je.close(i)}},getMode:function(e,t){var i=0;return e&&(i|=365),t&&(i|=146),i},findObject:function(e,t){var i=je.analyzePath(e,t);return i.exists?i.object:null},analyzePath:function(e,t){try{e=(s=je.lookupPath(e,{follow:!t})).path}catch(e){}var i={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var s=je.lookupPath(e,{parent:!0});i.parentExists=!0,i.parentPath=s.path,i.parentObject=s.node,i.name=Se.basename(e),s=je.lookupPath(e,{follow:!t}),i.exists=!0,i.path=s.path,i.object=s.node,i.name=s.node.name,i.isRoot="/"===s.path}catch(e){i.error=e.errno}return i},createPath:function(e,t,i,s){e="string"==typeof e?e:je.getPath(e);for(var r=t.split("/").reverse();r.length;){var n=r.pop();if(n){var o=Se.join2(e,n);try{je.mkdir(o)}catch(e){}e=o}}return o},createFile:function(e,t,i,s,r){var n=Se.join2("string"==typeof e?e:je.getPath(e),t),o=je.getMode(s,r);return je.create(n,o)},createDataFile:function(e,t,i,s,r,n){var o=t?Se.join2("string"==typeof e?e:je.getPath(e),t):e,a=je.getMode(s,r),u=je.create(o,a);if(i){if("string"==typeof i){for(var h=new Array(i.length),l=0,c=i.length;l<c;++l)h[l]=i.charCodeAt(l);i=h}je.chmod(u,146|a);var p=je.open(u,577);je.write(p,i,0,i.length,0,n),je.close(p),je.chmod(u,a)}return u},createDevice:function(e,t,i,s){var r=Se.join2("string"==typeof e?e:je.getPath(e),t),n=je.getMode(!!i,!!s);je.createDevice.major||(je.createDevice.major=64);var o=je.makedev(je.createDevice.major++,0);return je.registerDevice(o,{open:function(e){e.seekable=!1},close:function(e){s&&s.buffer&&s.buffer.length&&s(10)},read:function(e,t,s,r,n){for(var o=0,a=0;a<r;a++){var u;try{u=i()}catch(e){throw new je.ErrnoError(29)}if(void 0===u&&0===o)throw new je.ErrnoError(6);if(null==u)break;o++,t[s+a]=u}return o&&(e.node.timestamp=Date.now()),o},write:function(e,t,i,r,n){for(var o=0;o<r;o++)try{s(t[i+o])}catch(e){throw new je.ErrnoError(29)}return r&&(e.node.timestamp=Date.now()),o}}),je.mkdev(r,n,o)},forceLoadFile:function(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!f)throw new Error("Cannot load without read() or XMLHttpRequest.");try{e.contents=Xi(f(e.url),!0),e.usedBytes=e.contents.length}catch(e){throw new je.ErrnoError(29)}},createLazyFile:function(e,t,i,s,r){function n(){this.lengthKnown=!1,this.chunks=[]}if(n.prototype.get=function(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,i=e/this.chunkSize|0;return this.getter(i)[t]}},n.prototype.setDataGetter=function(e){this.getter=e},n.prototype.cacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",i,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+i+". Status: "+e.status);var t,s=Number(e.getResponseHeader("Content-length")),r=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,n=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,o=1048576;r||(o=s);var a=this;a.setDataGetter((function(e){var t=e*o,r=(e+1)*o-1;if(r=Math.min(r,s-1),void 0===a.chunks[e]&&(a.chunks[e]=function(e,t){if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>s-1)throw new Error("only "+s+" bytes available! programmer error!");var r=new XMLHttpRequest;if(r.open("GET",i,!1),s!==o&&r.setRequestHeader("Range","bytes="+e+"-"+t),"undefined"!=typeof Uint8Array&&(r.responseType="arraybuffer"),r.overrideMimeType&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(null),!(r.status>=200&&r.status<300||304===r.status))throw new Error("Couldn't load "+i+". Status: "+r.status);return void 0!==r.response?new Uint8Array(r.response||[]):Xi(r.responseText||"",!0)}(t,r)),void 0===a.chunks[e])throw new Error("doXHR failed!");return a.chunks[e]})),!n&&s||(o=s=1,s=this.getter(0).length,o=s,k("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=s,this._chunkSize=o,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest){if(!P)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var o=new n;Object.defineProperties(o,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var a={isDevice:!1,contents:o}}else a={isDevice:!1,url:i};var u=je.createFile(e,t,a,s,r);a.contents?u.contents=a.contents:a.url&&(u.contents=null,u.url=a.url),Object.defineProperties(u,{usedBytes:{get:function(){return this.contents.length}}});var h={};return Object.keys(u.stream_ops).forEach((function(e){var t=u.stream_ops[e];h[e]=function(){return je.forceLoadFile(u),t.apply(null,arguments)}})),h.read=function(e,t,i,s,r){je.forceLoadFile(u);var n=e.node.contents;if(r>=n.length)return 0;var o=Math.min(n.length-r,s);if(n.slice)for(var a=0;a<o;a++)t[i+a]=n[r+a];else for(a=0;a<o;a++)t[i+a]=n.get(r+a);return o},u.stream_ops=h,u},createPreloadedFile:function(e,t,i,s,r,n,o,a,u,h){Browser.init();var l=t?Oe.resolve(Se.join2(e,t)):e;function p(i){function p(i){h&&h(),a||je.createDataFile(e,t,i,s,r,u),n&&n(),Pe()}var d=!1;c.preloadPlugins.forEach((function(e){d||e.canHandle(l)&&(e.handle(i,l,p,(function(){o&&o(),Pe()})),d=!0)})),d||p(i)}xe(),"string"==typeof i?function(e,t,i,s){var r=s?"":"al "+e;m(e,(function(i){L(i,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(i)),r&&Pe()}),(function(t){if(!i)throw'Loading data file "'+e+'" failed.';i()})),r&&xe()}(i,(function(e){p(e)}),o):p(i)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(e,t,i){t=t||function(){},i=i||function(){};var s=je.indexedDB();try{var r=s.open(je.DB_NAME(),je.DB_VERSION)}catch(e){return i(e)}r.onupgradeneeded=function(){k("creating db"),r.result.createObjectStore(je.DB_STORE_NAME)},r.onsuccess=function(){var s=r.result.transaction([je.DB_STORE_NAME],"readwrite"),n=s.objectStore(je.DB_STORE_NAME),o=0,a=0,u=e.length;function h(){0==a?t():i()}e.forEach((function(e){var t=n.put(je.analyzePath(e).object.contents,e);t.onsuccess=function(){++o+a==u&&h()},t.onerror=function(){a++,o+a==u&&h()}})),s.onerror=i},r.onerror=i},loadFilesFromDB:function(e,t,i){t=t||function(){},i=i||function(){};var s=je.indexedDB();try{var r=s.open(je.DB_NAME(),je.DB_VERSION)}catch(e){return i(e)}r.onupgradeneeded=i,r.onsuccess=function(){var s=r.result;try{var n=s.transaction([je.DB_STORE_NAME],"readonly")}catch(e){return void i(e)}var o=n.objectStore(je.DB_STORE_NAME),a=0,u=0,h=e.length;function l(){0==u?t():i()}e.forEach((function(e){var t=o.get(e);t.onsuccess=function(){je.analyzePath(e).exists&&je.unlink(e),je.createDataFile(Se.dirname(e),Se.basename(e),t.result,!0,!0,!0),++a+u==h&&l()},t.onerror=function(){u++,a+u==h&&l()}})),n.onerror=i},r.onerror=i}},Ge={mappings:{},DEFAULT_POLLMASK:5,umask:511,calculateAt:function(e,t,i){if("/"===t[0])return t;var s;if(-100===e)s=je.cwd();else{var r=je.getStream(e);if(!r)throw new je.ErrnoError(8);s=r.path}if(0==t.length){if(!i)throw new je.ErrnoError(44);return s}return Se.join2(s,t)},doStat:function(e,t,i){try{var s=e(t)}catch(e){if(e&&e.node&&Se.normalize(t)!==Se.normalize(je.getPath(e.node)))return-54;throw e}return o()[i>>>2]=s.dev,o()[i+4>>>2]=0,o()[i+8>>>2]=s.ino,o()[i+12>>>2]=s.mode,o()[i+16>>>2]=s.nlink,o()[i+20>>>2]=s.uid,o()[i+24>>>2]=s.gid,o()[i+28>>>2]=s.rdev,o()[i+32>>>2]=0,_e=[s.size>>>0,(ge=s.size,+Math.abs(ge)>=1?ge>0?(0|Math.min(+Math.floor(ge/4294967296),4294967295))>>>0:~~+Math.ceil((ge-+(~~ge>>>0))/4294967296)>>>0:0)],o()[i+40>>>2]=_e[0],o()[i+44>>>2]=_e[1],o()[i+48>>>2]=4096,o()[i+52>>>2]=s.blocks,o()[i+56>>>2]=s.atime.getTime()/1e3|0,o()[i+60>>>2]=0,o()[i+64>>>2]=s.mtime.getTime()/1e3|0,o()[i+68>>>2]=0,o()[i+72>>>2]=s.ctime.getTime()/1e3|0,o()[i+76>>>2]=0,_e=[s.ino>>>0,(ge=s.ino,+Math.abs(ge)>=1?ge>0?(0|Math.min(+Math.floor(ge/4294967296),4294967295))>>>0:~~+Math.ceil((ge-+(~~ge>>>0))/4294967296)>>>0:0)],o()[i+80>>>2]=_e[0],o()[i+84>>>2]=_e[1],0},doMsync:function(e,t,i,r,n){var o=s().slice(e,e+i);je.msync(t,o,n,i,r)},doMkdir:function(e,t){return"/"===(e=Se.normalize(e))[e.length-1]&&(e=e.substr(0,e.length-1)),je.mkdir(e,t,0),0},doMknod:function(e,t,i){switch(61440&t){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return je.mknod(e,t,i),0},doReadlink:function(e,i,s){if(s<=0)return-28;var r=je.readlink(e),n=Math.min(s,z(r)),o=t()[i+n>>>0];return V(r,i,s+1),t()[i+n>>>0]=o,n},doAccess:function(e,t){if(-8&t)return-28;var i;if(!(i=je.lookupPath(e,{follow:!0}).node))return-44;var s="";return 4&t&&(s+="r"),2&t&&(s+="w"),1&t&&(s+="x"),s&&je.nodePermissions(i,s)?-2:0},doDup:function(e,t,i){var s=je.getStream(i);return s&&je.close(s),je.open(e,t,0,i,i).fd},doReadv:function(e,i,s,r){for(var n=0,a=0;a<s;a++){var u=o()[i+8*a>>>2],h=o()[i+(8*a+4)>>>2],l=je.read(e,t(),u,h,r);if(l<0)return-1;if(n+=l,l<h)break}return n},doWritev:function(e,i,s,r){for(var n=0,a=0;a<s;a++){var u=o()[i+8*a>>>2],h=o()[i+(8*a+4)>>>2],l=je.write(e,t(),u,h,r);if(l<0)return-1;n+=l}return n},varargs:void 0,get:function(){return Ge.varargs+=4,o()[Ge.varargs-4>>>2]},getStr:function(e){return H(e)},getStreamFromFD:function(e){var t=je.getStream(e);if(!t)throw new je.ErrnoError(8);return t},get64:function(e,t){return e}};function He(e,t,i){if(M)return fi(2,1,e,t,i);Ge.varargs=i;try{var s=Ge.getStreamFromFD(e);switch(t){case 0:return(n=Ge.get())<0?-28:je.open(s.path,s.flags,0,n).fd;case 1:case 2:case 13:case 14:return 0;case 3:return s.flags;case 4:var n=Ge.get();return s.flags|=n,0;case 12:return n=Ge.get(),r()[n+0>>>1]=2,0;case 16:case 8:default:return-28;case 9:return Fe(28),-1}}catch(e){return void 0!==je&&e instanceof je.ErrnoError||Te(e),-e.errno}}function Ue(e,t,i){if(M)return fi(3,1,e,t,i);Ge.varargs=i;try{var s=Ge.getStreamFromFD(e);switch(t){case 21509:case 21505:case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:case 21523:case 21524:return s.tty?0:-59;case 21519:if(!s.tty)return-59;var r=Ge.get();return o()[r>>>2]=0,0;case 21520:return s.tty?-28:-59;case 21531:return r=Ge.get(),je.ioctl(s,t,r);default:Te("bad ioctl syscall "+t)}}catch(e){return void 0!==je&&e instanceof je.ErrnoError||Te(e),-e.errno}}function Ve(e,t,i){if(M)return fi(4,1,e,t,i);Ge.varargs=i;try{var s=Ge.getStr(e),r=i?Ge.get():0;return je.open(s,t,r).fd}catch(e){return void 0!==je&&e instanceof je.ErrnoError||Te(e),-e.errno}}var ze={};function We(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function Xe(e){return this.fromWireType(a()[e>>>2])}var Ye={},Ke={},Je={};function Ze(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function Qe(e,t){return e=Ze(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function qe(e,t){var i=Qe(t,(function(e){this.name=t,this.message=e;var i=new Error(e).stack;void 0!==i&&(this.stack=this.toString()+"\n"+i.replace(/^Error(:[^\n]*)?\n/,""))}));return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},i}var $e=void 0;function et(e){throw new $e(e)}function tt(e,t,i){function s(t){var s=i(t);s.length!==e.length&&et("Mismatched type converter count");for(var r=0;r<e.length;++r)ut(e[r],s[r])}e.forEach((function(e){Je[e]=t}));var r=new Array(t.length),n=[],o=0;t.forEach((function(e,t){Ke.hasOwnProperty(e)?r[t]=Ke[e]:(n.push(e),Ye.hasOwnProperty(e)||(Ye[e]=[]),Ye[e].push((function(){r[t]=Ke[e],++o===n.length&&s(r)})))})),0===n.length&&s(r)}var it={};function st(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var rt=void 0;function nt(e){for(var t="",i=e;s()[i>>>0];)t+=rt[s()[i++>>>0]];return t}var ot=void 0;function at(e){throw new ot(e)}function ut(e,t,i){if(i=i||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var s=t.name;if(e||at('type "'+s+'" must have a positive integer typeid pointer'),Ke.hasOwnProperty(e)){if(i.ignoreDuplicateRegistrations)return;at("Cannot register type '"+s+"' twice")}if(Ke[e]=t,delete Je[e],Ye.hasOwnProperty(e)){var r=Ye[e];delete Ye[e],r.forEach((function(e){e()}))}}function ht(e){if(!(this instanceof Tt))return!1;if(!(e instanceof Tt))return!1;for(var t=this.$$.ptrType.registeredClass,i=this.$$.ptr,s=e.$$.ptrType.registeredClass,r=e.$$.ptr;t.baseClass;)i=t.upcast(i),t=t.baseClass;for(;s.baseClass;)r=s.upcast(r),s=s.baseClass;return t===s&&i===r}function lt(e){return{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType}}function ct(e){at(e.$$.ptrType.registeredClass.name+" instance already deleted")}var pt=!1;function dt(e){}function ft(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function mt(e){return"undefined"==typeof FinalizationGroup?(mt=function(e){return e},e):(pt=new FinalizationGroup((function(e){for(var t=e.next();!t.done;t=e.next()){var i=t.value;i.ptr?ft(i):console.warn("object already deleted: "+i.ptr)}})),dt=function(e){pt.unregister(e.$$)},(mt=function(e){return pt.register(e,e.$$,e.$$),e})(e))}function vt(){if(this.$$.ptr||ct(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e=mt(Object.create(Object.getPrototypeOf(this),{$$:{value:lt(this.$$)}}));return e.$$.count.value+=1,e.$$.deleteScheduled=!1,e}function gt(){this.$$.ptr||ct(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&at("Object already scheduled for deletion"),dt(this),ft(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function _t(){return!this.$$.ptr}var yt=void 0,bt=[];function xt(){for(;bt.length;){var e=bt.pop();e.$$.deleteScheduled=!1,e.delete()}}function Pt(){return this.$$.ptr||ct(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&at("Object already scheduled for deletion"),bt.push(this),1===bt.length&&yt&&yt(xt),this.$$.deleteScheduled=!0,this}function Tt(){}var wt={};function Mt(e,t,i){if(void 0===e[t].overloadTable){var s=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||at("Function '"+i+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[s.argCount]=s}}function It(e,t,i){c.hasOwnProperty(e)?((void 0===i||void 0!==c[e].overloadTable&&void 0!==c[e].overloadTable[i])&&at("Cannot register public name '"+e+"' twice"),Mt(c,e,e),c.hasOwnProperty(i)&&at("Cannot register multiple overloads of a function with the same number of arguments ("+i+")!"),c[e].overloadTable[i]=t):(c[e]=t,void 0!==i&&(c[e].numArguments=i))}function Ct(e,t,i,s,r,n,o,a){this.name=e,this.constructor=t,this.instancePrototype=i,this.rawDestructor=s,this.baseClass=r,this.getActualType=n,this.upcast=o,this.downcast=a,this.pureVirtualFunctions=[]}function Dt(e,t,i){for(;t!==i;)t.upcast||at("Expected null or instance of "+i.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function At(e,t){if(null===t)return this.isReference&&at("null is not a valid "+this.name),0;t.$$||at('Cannot pass "'+oi(t)+'" as a '+this.name),t.$$.ptr||at("Cannot pass deleted object as a pointer of type "+this.name);var i=t.$$.ptrType.registeredClass;return Dt(t.$$.ptr,i,this.registeredClass)}function kt(e,t){var i;if(null===t)return this.isReference&&at("null is not a valid "+this.name),this.isSmartPointer?(i=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,i),i):0;t.$$||at('Cannot pass "'+oi(t)+'" as a '+this.name),t.$$.ptr||at("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&at("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var s=t.$$.ptrType.registeredClass;if(i=Dt(t.$$.ptr,s,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&at("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?i=t.$$.smartPtr:at("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:i=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)i=t.$$.smartPtr;else{var r=t.clone();i=this.rawShare(i,si((function(){r.delete()}))),null!==e&&e.push(this.rawDestructor,i)}break;default:at("Unsupporting sharing policy")}return i}function Et(e,t){if(null===t)return this.isReference&&at("null is not a valid "+this.name),0;t.$$||at('Cannot pass "'+oi(t)+'" as a '+this.name),t.$$.ptr||at("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&at("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var i=t.$$.ptrType.registeredClass;return Dt(t.$$.ptr,i,this.registeredClass)}function Ft(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function Rt(e){this.rawDestructor&&this.rawDestructor(e)}function St(e){null!==e&&e.delete()}function Ot(e,t,i){if(t===i)return e;if(void 0===i.baseClass)return null;var s=Ot(e,t,i.baseClass);return null===s?null:i.downcast(s)}function Bt(){return Object.keys(jt).length}function Lt(){var e=[];for(var t in jt)jt.hasOwnProperty(t)&&e.push(jt[t]);return e}function Nt(e){yt=e,bt.length&&yt&&yt(xt)}var jt={};function Gt(e,t){return t=function(e,t){for(void 0===t&&at("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),jt[t]}function Ht(e,t){return t.ptrType&&t.ptr||et("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!=!!t.smartPtr&&et("Both smartPtrType and smartPtr must be specified"),t.count={value:1},mt(Object.create(e,{$$:{value:t}}))}function Ut(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var i=Gt(this.registeredClass,t);if(void 0!==i){if(0===i.$$.count.value)return i.$$.ptr=t,i.$$.smartPtr=e,i.clone();var s=i.clone();return this.destructor(e),s}function r(){return this.isSmartPointer?Ht(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):Ht(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var n,o=this.registeredClass.getActualType(t),a=wt[o];if(!a)return r.call(this);n=this.isConst?a.constPointerType:a.pointerType;var u=Ot(t,this.registeredClass,n.registeredClass);return null===u?r.call(this):this.isSmartPointer?Ht(n.registeredClass.instancePrototype,{ptrType:n,ptr:u,smartPtrType:this,smartPtr:e}):Ht(n.registeredClass.instancePrototype,{ptrType:n,ptr:u})}function Vt(e,t,i,s,r,n,o,a,u,h,l){this.name=e,this.registeredClass=t,this.isReference=i,this.isConst=s,this.isSmartPointer=r,this.pointeeType=n,this.sharingPolicy=o,this.rawGetPointee=a,this.rawConstructor=u,this.rawShare=h,this.rawDestructor=l,r||void 0!==t.baseClass?this.toWireType=kt:s?(this.toWireType=At,this.destructorFunction=null):(this.toWireType=Et,this.destructorFunction=null)}function zt(e,t,i){c.hasOwnProperty(e)||et("Replacing nonexistant public symbol"),void 0!==c[e].overloadTable&&void 0!==i?c[e].overloadTable[i]=t:(c[e]=t,c[e].argCount=i)}function Wt(e,t,i){return e.includes("j")?function(e,t,i){var s=c["dynCall_"+e];return i&&i.length?s.apply(null,[t].concat(i)):s.call(null,t)}(e,t,i):ue.get(t).apply(null,i)}function Xt(e,t){var i,s,r,n=(e=nt(e)).includes("j")?(i=e,s=t,r=[],function(){r.length=arguments.length;for(var e=0;e<arguments.length;e++)r[e]=arguments[e];return Wt(i,s,r)}):ue.get(t);return"function"!=typeof n&&at("unknown function pointer with signature "+e+": "+t),n}var Yt=void 0;function Kt(e){var t=Zi(e),i=nt(t);return Ji(t),i}function Jt(e,t){var i=[],s={};throw t.forEach((function e(t){s[t]||Ke[t]||(Je[t]?Je[t].forEach(e):(i.push(t),s[t]=!0))})),new Yt(e+": "+i.map(Kt).join([", "]))}function Zt(e,t){for(var i=[],s=0;s<e;s++)i.push(o()[(t>>2)+s>>>0]);return i}function Qt(e,t,i,s,r){var n=t.length;n<2&&at("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var o=null!==t[1]&&null!==i,a=!1,u=1;u<t.length;++u)if(null!==t[u]&&void 0===t[u].destructorFunction){a=!0;break}var h="void"!==t[0].name,l="",c="";for(u=0;u<n-2;++u)l+=(0!==u?", ":"")+"arg"+u,c+=(0!==u?", ":"")+"arg"+u+"Wired";var p="return function "+Ze(e)+"("+l+") {\nif (arguments.length !== "+(n-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(n-2)+" args!');\n}\n";a&&(p+="var destructors = [];\n");var d=a?"destructors":"null",f=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],m=[at,s,r,We,t[0],t[1]];for(o&&(p+="var thisWired = classParam.toWireType("+d+", this);\n"),u=0;u<n-2;++u)p+="var arg"+u+"Wired = argType"+u+".toWireType("+d+", arg"+u+"); // "+t[u+2].name+"\n",f.push("argType"+u),m.push(t[u+2]);if(o&&(c="thisWired"+(c.length>0?", ":"")+c),p+=(h?"var rv = ":"")+"invoker(fn"+(c.length>0?", ":"")+c+");\n",a)p+="runDestructors(destructors);\n";else for(u=o?1:2;u<t.length;++u){var v=1===u?"thisWired":"arg"+(u-2)+"Wired";null!==t[u].destructorFunction&&(p+=v+"_dtor("+v+"); // "+t[u].name+"\n",f.push(v+"_dtor"),m.push(t[u].destructorFunction))}h&&(p+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),p+="}\n",f.push(p);var g=function(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+T(e)+" which is not a function");var i=Qe(e.name||"unknownFunctionName",(function(){}));i.prototype=e.prototype;var s=new i,r=e.apply(s,t);return r instanceof Object?r:s}(Function,f).apply(null,m);return g}var qt=[],$t=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function ei(e){e>4&&0==--$t[e].refcount&&($t[e]=void 0,qt.push(e))}function ti(){for(var e=0,t=5;t<$t.length;++t)void 0!==$t[t]&&++e;return e}function ii(){for(var e=5;e<$t.length;++e)if(void 0!==$t[e])return $t[e];return null}function si(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=qt.length?qt.pop():$t.length;return $t[t]={refcount:1,value:e},t}}function ri(e,i,u){switch(i){case 0:return function(e){var i=u?t():s();return this.fromWireType(i[e>>>0])};case 1:return function(e){var t=u?r():n();return this.fromWireType(t[e>>>1])};case 2:return function(e){var t=u?o():a();return this.fromWireType(t[e>>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function ni(e,t){var i=Ke[e];return void 0===i&&at(t+" has unknown type "+Kt(e)),i}function oi(e){if(null===e)return"null";var t=T(e);return"object"===t||"array"===t||"function"===t?e.toString():""+e}function ai(e,t){switch(t){case 2:return function(e){return this.fromWireType((R.buffer!=W&&ae(R.buffer),q)[e>>>2])};case 3:return function(e){return this.fromWireType(u()[e>>>3])};default:throw new TypeError("Unknown float type: "+e)}}function ui(e,i,u){switch(i){case 0:return u?function(e){return t()[e>>>0]}:function(e){return s()[e>>>0]};case 1:return u?function(e){return r()[e>>>1]}:function(e){return n()[e>>>1]};case 2:return u?function(e){return o()[e>>>2]}:function(e){return a()[e>>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function hi(e){return e||at("Cannot use deleted val. handle = "+e),$t[e].value}var li={};function ci(e){var t=li[e];return void 0===t?nt(e):t}function pi(){return"object"===("undefined"==typeof globalThis?"undefined":T(globalThis))?globalThis:Function("return this")()}var di=[];function fi(e,t){for(var i=arguments.length-2,s=us(),r=i,n=ls(8*r),o=n>>3,a=0;a<i;a++){var h=arguments[2+a];u()[o+a>>>0]=h}var l=ts(e,r,n,t);return hs(s),l}var mi=[];function vi(e){try{return R.grow(e-W.byteLength+65535>>>16),ae(R.buffer),1}catch(e){}}var gi={inEventHandler:0,removeAllEventListeners:function(){for(var e=gi.eventHandlers.length-1;e>=0;--e)gi._removeHandler(e);gi.eventHandlers=[],gi.deferredCalls=[]},registerRemoveEventListeners:function(){gi.removeEventListenersRegistered||(gi.removeEventListenersRegistered=!0)},deferredCalls:[],deferCall:function(e,t,i){function s(e,t){if(e.length!=t.length)return!1;for(var i in e)if(e[i]!=t[i])return!1;return!0}for(var r in gi.deferredCalls){var n=gi.deferredCalls[r];if(n.targetFunction==e&&s(n.argsList,i))return}gi.deferredCalls.push({targetFunction:e,precedence:t,argsList:i}),gi.deferredCalls.sort((function(e,t){return e.precedence<t.precedence}))},removeDeferredCalls:function(e){for(var t=0;t<gi.deferredCalls.length;++t)gi.deferredCalls[t].targetFunction==e&&(gi.deferredCalls.splice(t,1),--t)},canPerformEventHandlerRequests:function(){return gi.inEventHandler&&gi.currentEventHandler.allowsDeferredCalls},runDeferredCalls:function(){if(gi.canPerformEventHandlerRequests())for(var e=0;e<gi.deferredCalls.length;++e){var t=gi.deferredCalls[e];gi.deferredCalls.splice(e,1),--e,t.targetFunction.apply(null,t.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:function(e,t){for(var i=0;i<gi.eventHandlers.length;++i)gi.eventHandlers[i].target!=e||t&&t!=gi.eventHandlers[i].eventTypeString||gi._removeHandler(i--)},_removeHandler:function(e){var t=gi.eventHandlers[e];t.target.removeEventListener(t.eventTypeString,t.eventListenerFunc,t.useCapture),gi.eventHandlers.splice(e,1)},registerOrRemoveHandler:function(e){var t=function(t){++gi.inEventHandler,gi.currentEventHandler=e,gi.runDeferredCalls(),e.handlerFunc(t),gi.runDeferredCalls(),--gi.inEventHandler};if(e.callbackfunc)e.eventListenerFunc=t,e.target.addEventListener(e.eventTypeString,t,e.useCapture),gi.eventHandlers.push(e),gi.registerRemoveEventListeners();else for(var i=0;i<gi.eventHandlers.length;++i)gi.eventHandlers[i].target==e.target&&gi.eventHandlers[i].eventTypeString==e.eventTypeString&&gi._removeHandler(i--)},queueEventHandlerOnThread_iiii:function(e,t,i,s,r){var n=us(),a=ls(12);o()[a>>>2]=i,o()[a+4>>>2]=s,o()[a+8>>>2]=r,is(0,e,637534208,t,s,a),hs(n)},getTargetThreadForEventCallback:function(e){switch(e){case 1:return 0;case 2:return Ee.currentProxiedOperationCallerThread;default:return e}},getNodeNameForTarget:function(e){return e?e==window?"#window":e==screen?"#screen":e&&e.nodeName?e.nodeName:"":""},fullscreenEnabled:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}};function _i(e,t,i,s){var r,n,a,u=us(),h=ls(12),l=0;t&&(n=z(r=t)+1,a=Ki(n),V(r,a,n),l=a),o()[h>>>2]=l,o()[h+4>>>2]=i,o()[h+8>>>2]=s,is(0,e,657457152,0,l,h),hs(u)}var yi=[0,"undefined"!=typeof document?document:0,"undefined"!=typeof window?window:0];function bi(e){var t;return e=(t=e)>2?H(t):t,yi[e]||("undefined"!=typeof document?document.querySelector(e):void 0)}function xi(e){return bi(e)}function Pi(e,t,i){var s=xi(e);if(!s)return-4;if(s.canvasSharedPtr&&(o()[s.canvasSharedPtr>>>2]=t,o()[s.canvasSharedPtr+4>>>2]=i),!s.offscreenCanvas&&s.controlTransferredOffscreen)return s.canvasSharedPtr?(function(e,t,i,s){_i(e,t=t?H(t):"",i,s)}(o()[s.canvasSharedPtr+8>>>2],e,t,i),1):-4;s.offscreenCanvas&&(s=s.offscreenCanvas);var r=!1;if(s.GLctxObject&&s.GLctxObject.GLctx){var n=s.GLctxObject.GLctx.getParameter(2978);r=0===n[0]&&0===n[1]&&n[2]===s.width&&n[3]===s.height}return s.width=t,s.height=i,r&&s.GLctxObject.GLctx.viewport(0,0,t,i),0}function Ti(e,t,i){return M?fi(5,1,e,t,i):Pi(e,t,i)}var wi={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:{},offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(e){wi.lastError||(wi.lastError=e)},getNewId:function(e){for(var t=wi.counter++,i=e.length;i<t;i++)e[i]=null;return t},getSource:function(e,t,i,s){for(var r="",n=0;n<t;++n){var a=s?o()[s+4*n>>>2]:-1;r+=H(o()[i+4*n>>>2],a<0?void 0:a)}return r},createContext:function(e,t){e.getContextSafariWebGL2Fixed||(e.getContextSafariWebGL2Fixed=e.getContext,e.getContext=function(t,i){var s=e.getContextSafariWebGL2Fixed(t,i);return"webgl"==t==s instanceof WebGLRenderingContext?s:null});var i=e.getContext("webgl",t);return i?wi.registerContext(i,t):0},registerContext:function(e,t){var i=Ki(8);o()[i+4>>>2]=os();var s={handle:i,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=s),wi.contexts[i]=s,(void 0===t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&wi.initExtensions(s),i},makeContextCurrent:function(e){return wi.currentContext=wi.contexts[e],c.ctx=Hi=wi.currentContext&&wi.currentContext.GLctx,!(e&&!Hi)},getContext:function(e){return wi.contexts[e]},deleteContext:function(e){wi.currentContext===wi.contexts[e]&&(wi.currentContext=null),"object"===T(gi)&&gi.removeAllHandlersOnTarget(wi.contexts[e].GLctx.canvas),wi.contexts[e]&&wi.contexts[e].GLctx.canvas&&(wi.contexts[e].GLctx.canvas.GLctxObject=void 0),Ji(wi.contexts[e].handle),wi.contexts[e]=null},initExtensions:function(e){if(e||(e=wi.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var t,i=e.GLctx;!function(e){var t=e.getExtension("ANGLE_instanced_arrays");t&&(e.vertexAttribDivisor=function(e,i){t.vertexAttribDivisorANGLE(e,i)},e.drawArraysInstanced=function(e,i,s,r){t.drawArraysInstancedANGLE(e,i,s,r)},e.drawElementsInstanced=function(e,i,s,r,n){t.drawElementsInstancedANGLE(e,i,s,r,n)})}(i),function(e){var t=e.getExtension("OES_vertex_array_object");t&&(e.createVertexArray=function(){return t.createVertexArrayOES()},e.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},e.bindVertexArray=function(e){t.bindVertexArrayOES(e)},e.isVertexArray=function(e){return t.isVertexArrayOES(e)})}(i),function(e){var t=e.getExtension("WEBGL_draw_buffers");t&&(e.drawBuffers=function(e,i){t.drawBuffersWEBGL(e,i)})}(i),i.disjointTimerQueryExt=i.getExtension("EXT_disjoint_timer_query"),(t=i).multiDrawWebgl=t.getExtension("WEBGL_multi_draw"),(i.getSupportedExtensions()||[]).forEach((function(e){e.includes("lose_context")||e.includes("debug")||i.getExtension(e)}))}}},Mi=["default","low-power","high-performance"],Ii={};function Ci(){if(!Ci.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"===("undefined"==typeof navigator?"undefined":T(navigator))&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:y||"./this.program"};for(var t in Ii)void 0===Ii[t]?delete e[t]:e[t]=Ii[t];var i=[];for(var t in e)i.push(t+"="+e[t]);Ci.strings=i}return Ci.strings}function Di(e,i){if(M)return fi(6,1,e,i);try{var s=0;return Ci().forEach((function(r,n){var a=i+s;o()[e+4*n>>>2]=a,function(e,i,s){for(var r=0;r<e.length;++r)t()[i++>>>0]=e.charCodeAt(r);s||(t()[i>>>0]=0)}(r,a),s+=r.length+1})),0}catch(e){return void 0!==je&&e instanceof je.ErrnoError||Te(e),e.errno}}function Ai(e,t){if(M)return fi(7,1,e,t);try{var i=Ci();o()[e>>>2]=i.length;var s=0;return i.forEach((function(e){s+=e.length+1})),o()[t>>>2]=s,0}catch(e){return void 0!==je&&e instanceof je.ErrnoError||Te(e),e.errno}}function ki(e){if(M)return fi(8,1,e);try{var t=Ge.getStreamFromFD(e);return je.close(t),0}catch(e){return void 0!==je&&e instanceof je.ErrnoError||Te(e),e.errno}}function Ei(e,t,i,s){if(M)return fi(9,1,e,t,i,s);try{var r=Ge.getStreamFromFD(e),n=Ge.doReadv(r,t,i);return o()[s>>>2]=n,0}catch(e){return void 0!==je&&e instanceof je.ErrnoError||Te(e),e.errno}}function Fi(e,t,i,s,r){if(M)return fi(10,1,e,t,i,s,r);try{var n=Ge.getStreamFromFD(e),a=4294967296*i+(t>>>0),u=9007199254740992;return a<=-u||a>=u?-61:(je.llseek(n,a,s),_e=[n.position>>>0,(ge=n.position,+Math.abs(ge)>=1?ge>0?(0|Math.min(+Math.floor(ge/4294967296),4294967295))>>>0:~~+Math.ceil((ge-+(~~ge>>>0))/4294967296)>>>0:0)],o()[r>>>2]=_e[0],o()[r+4>>>2]=_e[1],n.getdents&&0===a&&0===s&&(n.getdents=null),0)}catch(e){return void 0!==je&&e instanceof je.ErrnoError||Te(e),e.errno}}function Ri(e,t,i,s){if(M)return fi(11,1,e,t,i,s);try{var r=Ge.getStreamFromFD(e),n=Ge.doWritev(r,t,i);return o()[s>>>2]=n,0}catch(e){return void 0!==je&&e instanceof je.ErrnoError||Te(e),e.errno}}function Si(e){if(M)throw"Internal Error! spawnThread() can only ever be called from main application thread!";var t=Ee.getNewWorker();if(!t)return 6;if(void 0!==t.pthread)throw"Internal error!";if(!e.pthread_ptr)throw"Internal error, no pthread ptr!";Ee.runningWorkers.push(t);for(var i=Ki(512),s=0;s<128;++s)o()[i+4*s>>>2]=0;var r=e.stackBase+e.stackSize,n=Ee.pthreads[e.pthread_ptr]={worker:t,stackBase:e.stackBase,stackSize:e.stackSize,allocatedOwnStack:e.allocatedOwnStack,threadInfoStruct:e.pthread_ptr},u=n.threadInfoStruct>>2;Atomics.store(a(),u+16,e.detached),Atomics.store(a(),u+25,i),Atomics.store(a(),u+10,n.threadInfoStruct),Atomics.store(a(),u+20,e.stackSize),Atomics.store(a(),u+19,r),Atomics.store(a(),u+26,e.stackSize),Atomics.store(a(),u+28,r),Atomics.store(a(),u+29,e.detached);var h=rs()+40;Atomics.store(a(),u+43,h),t.pthread=n;var l={cmd:"run",start_routine:e.startRoutine,arg:e.arg,threadInfoStruct:e.pthread_ptr,stackBase:e.stackBase,stackSize:e.stackSize};return t.runPthread=function(){l.time=performance.now(),t.postMessage(l,e.transferList)},t.loaded&&(t.runPthread(),delete t.runPthread),0}function Oi(e){return e%4==0&&(e%100!=0||e%400==0)}function Bi(e,t){for(var i=0,s=0;s<=t;i+=e[s++]);return i}var Li=[31,29,31,30,31,30,31,31,30,31,30,31],Ni=[31,28,31,30,31,30,31,31,30,31,30,31];function ji(e,t){for(var i=new Date(e.getTime());t>0;){var s=Oi(i.getFullYear()),r=i.getMonth(),n=(s?Li:Ni)[r];if(!(t>n-i.getDate()))return i.setDate(i.getDate()+t),i;t-=n-i.getDate()+1,i.setDate(1),r<11?i.setMonth(r+1):(i.setMonth(0),i.setFullYear(i.getFullYear()+1))}return i}function Gi(e,i,s,r){var n=o()[r+40>>>2],a={tm_sec:o()[r>>>2],tm_min:o()[r+4>>>2],tm_hour:o()[r+8>>>2],tm_mday:o()[r+12>>>2],tm_mon:o()[r+16>>>2],tm_year:o()[r+20>>>2],tm_wday:o()[r+24>>>2],tm_yday:o()[r+28>>>2],tm_isdst:o()[r+32>>>2],tm_gmtoff:o()[r+36>>>2],tm_zone:n?H(n):""},u=H(s),h={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var l in h)u=u.replace(new RegExp(l,"g"),h[l]);var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],p=["January","February","March","April","May","June","July","August","September","October","November","December"];function d(e,t,i){for(var s="number"==typeof e?e.toString():e||"";s.length<t;)s=i[0]+s;return s}function f(e,t){return d(e,t,"0")}function m(e,t){function i(e){return e<0?-1:e>0?1:0}var s;return 0===(s=i(e.getFullYear()-t.getFullYear()))&&0===(s=i(e.getMonth()-t.getMonth()))&&(s=i(e.getDate()-t.getDate())),s}function v(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function g(e){var t=ji(new Date(e.tm_year+1900,0,1),e.tm_yday),i=new Date(t.getFullYear(),0,4),s=new Date(t.getFullYear()+1,0,4),r=v(i),n=v(s);return m(r,t)<=0?m(n,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var _={"%a":function(e){return c[e.tm_wday].substring(0,3)},"%A":function(e){return c[e.tm_wday]},"%b":function(e){return p[e.tm_mon].substring(0,3)},"%B":function(e){return p[e.tm_mon]},"%C":function(e){return f((e.tm_year+1900)/100|0,2)},"%d":function(e){return f(e.tm_mday,2)},"%e":function(e){return d(e.tm_mday,2," ")},"%g":function(e){return g(e).toString().substring(2)},"%G":function(e){return g(e)},"%H":function(e){return f(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),f(t,2)},"%j":function(e){return f(e.tm_mday+Bi(Oi(e.tm_year+1900)?Li:Ni,e.tm_mon-1),3)},"%m":function(e){return f(e.tm_mon+1,2)},"%M":function(e){return f(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return f(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=new Date(e.tm_year+1900,0,1),i=0===t.getDay()?t:ji(t,7-t.getDay()),s=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(m(i,s)<0){var r=Bi(Oi(s.getFullYear())?Li:Ni,s.getMonth()-1)-31,n=31-i.getDate()+r+s.getDate();return f(Math.ceil(n/7),2)}return 0===m(i,t)?"01":"00"},"%V":function(e){var t,i=new Date(e.tm_year+1900,0,4),s=new Date(e.tm_year+1901,0,4),r=v(i),n=v(s),o=ji(new Date(e.tm_year+1900,0,1),e.tm_yday);return m(o,r)<0?"53":m(n,o)<=0?"01":(t=r.getFullYear()<e.tm_year+1900?e.tm_yday+32-r.getDate():e.tm_yday+1-r.getDate(),f(Math.ceil(t/7),2))},"%w":function(e){return e.tm_wday},"%W":function(e){var t=new Date(e.tm_year,0,1),i=1===t.getDay()?t:ji(t,0===t.getDay()?1:7-t.getDay()+1),s=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(m(i,s)<0){var r=Bi(Oi(s.getFullYear())?Li:Ni,s.getMonth()-1)-31,n=31-i.getDate()+r+s.getDate();return f(Math.ceil(n/7),2)}return 0===m(i,t)?"01":"00"},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,i=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(i?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var l in _)u.includes(l)&&(u=u.replace(new RegExp(l,"g"),_[l](a)));var y,b,x=Xi(u,!1);return x.length>i?0:(y=x,b=e,t().set(y,b>>>0),x.length-1)}M||Ee.initMainThreadBlock();var Hi,Ui=function(e,t,i,s){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=je.nextInode++,this.name=t,this.mode=i,this.node_ops={},this.stream_ops={},this.rdev=s},Vi=365,zi=146;Object.defineProperties(Ui.prototype,{read:{get:function(){return(this.mode&Vi)===Vi},set:function(e){e?this.mode|=Vi:this.mode&=-366}},write:{get:function(){return(this.mode&zi)===zi},set:function(e){e?this.mode|=zi:this.mode&=-147}},isFolder:{get:function(){return je.isDir(this.mode)}},isDevice:{get:function(){return je.isChrdev(this.mode)}}}),je.FSNode=Ui,je.staticInit(),c.FS_createPath=je.createPath,c.FS_createDataFile=je.createDataFile,c.FS_createPreloadedFile=je.createPreloadedFile,c.FS_createLazyFile=je.createLazyFile,c.FS_createDevice=je.createDevice,c.FS_unlink=je.unlink,$e=c.InternalError=qe(Error,"InternalError"),function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);rt=e}(),ot=c.BindingError=qe(Error,"BindingError"),Tt.prototype.isAliasOf=ht,Tt.prototype.clone=vt,Tt.prototype.delete=gt,Tt.prototype.isDeleted=_t,Tt.prototype.deleteLater=Pt,Vt.prototype.getPointee=Ft,Vt.prototype.destructor=Rt,Vt.prototype.argPackAdvance=8,Vt.prototype.readValueFromPointer=Xe,Vt.prototype.deleteObject=St,Vt.prototype.fromWireType=Ut,c.getInheritedInstanceCount=Bt,c.getLiveInheritedInstances=Lt,c.flushPendingDeletes=xt,c.setDelayFunction=Nt,Yt=c.UnboundTypeError=qe(Error,"UnboundTypeError"),c.count_emval_handles=ti,c.get_first_emval=ii;var Wi=[null,function(e,t){if(M)return fi(1,1,e,t)},He,Ue,Ve,Ti,Di,Ai,ki,Ei,Fi,Ri];function Xi(e,t,i){var s=i>0?i:z(e)+1,r=new Array(s),n=U(e,r,0,r.length);return t&&(r.length=n),r}var Yi={l:function(e,t,i,s){Te("Assertion failed: "+H(e)+", at: "+[t?H(t):"unknown filename",i,s?H(s):"unknown function"])},B:function(e){return Ki(e+16)+16},ka:function(e,t){Ee.threadExitHandlers.push((function(){ue.get(e)(t)}))},A:function(e,t,i){throw new Re(e).init(t,i),e},D:He,V:Ue,W:Ve,ma:function(e){var t=ze[e];delete ze[e];var i=t.elements,s=i.length,r=i.map((function(e){return e.getterReturnType})).concat(i.map((function(e){return e.setterArgumentType}))),n=t.rawConstructor,o=t.rawDestructor;tt([e],r,(function(e){return i.forEach((function(t,i){var r=e[i],n=t.getter,o=t.getterContext,a=e[i+s],u=t.setter,h=t.setterContext;t.read=function(e){return r.fromWireType(n(o,e))},t.write=function(e,t){var i=[];u(h,e,a.toWireType(i,t)),We(i)}})),[{name:t.name,fromWireType:function(e){for(var t=new Array(s),r=0;r<s;++r)t[r]=i[r].read(e);return o(e),t},toWireType:function(e,r){if(s!==r.length)throw new TypeError("Incorrect number of tuple elements for "+t.name+": expected="+s+", actual="+r.length);for(var a=n(),u=0;u<s;++u)i[u].write(a,r[u]);return null!==e&&e.push(o,a),a},argPackAdvance:8,readValueFromPointer:Xe,destructorFunction:o}]}))},s:function(e){var t=it[e];delete it[e];var i=t.rawConstructor,s=t.rawDestructor,r=t.fields;tt([e],r.map((function(e){return e.getterReturnType})).concat(r.map((function(e){return e.setterArgumentType}))),(function(e){var n={};return r.forEach((function(t,i){var s=t.fieldName,o=e[i],a=t.getter,u=t.getterContext,h=e[i+r.length],l=t.setter,c=t.setterContext;n[s]={read:function(e){return o.fromWireType(a(u,e))},write:function(e,t){var i=[];l(c,e,h.toWireType(i,t)),We(i)}}})),[{name:t.name,fromWireType:function(e){var t={};for(var i in n)t[i]=n[i].read(e);return s(e),t},toWireType:function(e,t){for(var r in n)if(!(r in t))throw new TypeError('Missing field:  "'+r+'"');var o=i();for(r in n)n[r].write(o,t[r]);return null!==e&&e.push(s,o),o},argPackAdvance:8,readValueFromPointer:Xe,destructorFunction:s}]}))},O:function(e,t,i,s,r){},ia:function(e,i,s,n,a){var u=st(s);ut(e,{name:i=nt(i),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?n:a},argPackAdvance:8,readValueFromPointer:function(e){var n;if(1===s)n=t();else if(2===s)n=r();else{if(4!==s)throw new TypeError("Unknown boolean type size: "+i);n=o()}return this.fromWireType(n[e>>>u])},destructorFunction:null})},v:function(e,t,i,s,r,n,o,a,u,h,l,c,p){l=nt(l),n=Xt(r,n),a&&(a=Xt(o,a)),h&&(h=Xt(u,h)),p=Xt(c,p);var d=Ze(l);It(d,(function(){Jt("Cannot construct "+l+" due to unbound types",[s])})),tt([e,t,i],s?[s]:[],(function(t){var i,r;t=t[0],r=s?(i=t.registeredClass).instancePrototype:Tt.prototype;var o=Qe(d,(function(){if(Object.getPrototypeOf(this)!==u)throw new ot("Use 'new' to construct "+l);if(void 0===c.constructor_body)throw new ot(l+" has no accessible constructor");var e=c.constructor_body[arguments.length];if(void 0===e)throw new ot("Tried to invoke ctor of "+l+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(c.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),u=Object.create(r,{constructor:{value:o}});o.prototype=u;var c=new Ct(l,o,u,p,i,n,a,h),f=new Vt(l,c,!0,!1,!1),m=new Vt(l+"*",c,!1,!1,!1),v=new Vt(l+" const*",c,!1,!0,!1);return wt[e]={pointerType:m,constPointerType:v},zt(d,o),[f,m,v]}))},u:function(e,t,i,s,r,n){L(t>0);var o=Zt(t,i);r=Xt(s,r);var a=[n],u=[];tt([],[e],(function(e){var i="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new ot("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=function(){Jt("Cannot construct "+e.name+" due to unbound types",o)},tt([],o,(function(s){return e.registeredClass.constructor_body[t-1]=function(){arguments.length!==t-1&&at(i+" called with "+arguments.length+" arguments, expected "+(t-1)),u.length=0,a.length=t;for(var e=1;e<t;++e)a[e]=s[e].toWireType(u,arguments[e-1]);var n=r.apply(null,a);return We(u),s[0].fromWireType(n)},[]})),[]}))},c:function(e,t,i,s,r,n,o,a){var u=Zt(i,s);t=nt(t),n=Xt(r,n),tt([],[e],(function(e){var s=(e=e[0]).name+"."+t;function r(){Jt("Cannot call "+s+" due to unbound types",u)}t.startsWith("@@")&&(t=Symbol[t.substring(2)]),a&&e.registeredClass.pureVirtualFunctions.push(t);var h=e.registeredClass.instancePrototype,l=h[t];return void 0===l||void 0===l.overloadTable&&l.className!==e.name&&l.argCount===i-2?(r.argCount=i-2,r.className=e.name,h[t]=r):(Mt(h,t,s),h[t].overloadTable[i-2]=r),tt([],u,(function(r){var a=Qt(s,r,e,n,o);return void 0===h[t].overloadTable?(a.argCount=i-2,h[t]=a):h[t].overloadTable[i-2]=a,[]})),[]}))},ha:function(e,t){ut(e,{name:t=nt(t),fromWireType:function(e){var t=$t[e].value;return ei(e),t},toWireType:function(e,t){return si(t)},argPackAdvance:8,readValueFromPointer:Xe,destructorFunction:null})},la:function(e,t,i,s){var r=st(i);function n(){}t=nt(t),n.values={},ut(e,{name:t,constructor:n,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:ri(t,r,s),destructorFunction:null}),It(t,n)},y:function(e,t,i){var s=ni(e,"enum");t=nt(t);var r=s.constructor,n=Object.create(s.constructor.prototype,{value:{value:i},constructor:{value:Qe(s.name+"_"+t,(function(){}))}});r.values[i]=n,r[t]=n},J:function(e,t,i){var s=st(i);ut(e,{name:t=nt(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+oi(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:ai(t,s),destructorFunction:null})},f:function(e,t,i,s,r,n){var o=Zt(t,i);e=nt(e),r=Xt(s,r),It(e,(function(){Jt("Cannot call "+e+" due to unbound types",o)}),t-1),tt([],o,(function(i){var s=[i[0],null].concat(i.slice(1));return zt(e,Qt(e,s,null,r,n),t-1),[]}))},p:function(e,t,i,s,r){t=nt(t),-1===r&&(r=4294967295);var n=st(i),o=function(e){return e};if(0===s){var a=32-8*i;o=function(e){return e<<a>>>a}}var u=t.includes("unsigned");ut(e,{name:t,fromWireType:o,toWireType:function(e,i){if("number"!=typeof i&&"boolean"!=typeof i)throw new TypeError('Cannot convert "'+oi(i)+'" to '+this.name);if(i<s||i>r)throw new TypeError('Passing a number "'+oi(i)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+s+", "+r+"]!");return u?i>>>0:0|i},argPackAdvance:8,readValueFromPointer:ui(t,n,0!==s),destructorFunction:null})},k:function(e,t,i){var s=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function r(e){e>>=2;var t=a(),i=t[e>>>0],r=t[e+1>>>0];return new s(W,r,i)}ut(e,{name:i=nt(i),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{ignoreDuplicateRegistrations:!0})},K:function(e,t){var i="std::string"===(t=nt(t));ut(e,{name:t,fromWireType:function(e){var t,r=a()[e>>>2];if(i)for(var n=e+4,o=0;o<=r;++o){var u=e+4+o;if(o==r||0==s()[u>>>0]){var h=H(n,u-n);void 0===t?t=h:(t+=String.fromCharCode(0),t+=h),n=u+1}}else{var l=new Array(r);for(o=0;o<r;++o)l[o]=String.fromCharCode(s()[e+4+o>>>0]);t=l.join("")}return Ji(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;r||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||at("Cannot pass non-string to std::string");var n=(i&&r?function(){return z(t)}:function(){return t.length})(),o=Ki(4+n+1);if(o>>>=0,a()[o>>>2]=n,i&&r)V(t,o+4,n+1);else if(r)for(var u=0;u<n;++u){var h=t.charCodeAt(u);h>255&&(Ji(o),at("String has UTF-16 code units that do not fit in 8 bits")),s()[o+4+u>>>0]=h}else for(u=0;u<n;++u)s()[o+4+u>>>0]=t[u];return null!==e&&e.push(Ji,o),o},argPackAdvance:8,readValueFromPointer:Xe,destructorFunction:function(e){Ji(e)}})},z:function(e,t,i){var s,r,o,u,h;i=nt(i),2===t?(s=te,r=ie,u=se,o=function(){return n()},h=1):4===t&&(s=re,r=ne,u=oe,o=function(){return a()},h=2),ut(e,{name:i,fromWireType:function(e){for(var i,r=a()[e>>>2],n=o(),u=e+4,l=0;l<=r;++l){var c=e+4+l*t;if(l==r||0==n[c>>>h]){var p=s(u,c-u);void 0===i?i=p:(i+=String.fromCharCode(0),i+=p),u=c+t}}return Ji(e),i},toWireType:function(e,s){"string"!=typeof s&&at("Cannot pass non-string to C++ string type "+i);var n=u(s),o=Ki(4+n+t);return o>>>=0,a()[o>>>2]=n>>h,r(s,o+4,n+t),null!==e&&e.push(Ji,o),o},argPackAdvance:8,readValueFromPointer:Xe,destructorFunction:function(e){Ji(e)}})},na:function(e,t,i,s,r,n){ze[e]={name:nt(t),rawConstructor:Xt(i,s),rawDestructor:Xt(r,n),elements:[]}},h:function(e,t,i,s,r,n,o,a,u){ze[e].elements.push({getterReturnType:t,getter:Xt(i,s),getterContext:r,setterArgumentType:n,setter:Xt(o,a),setterContext:u})},t:function(e,t,i,s,r,n){it[e]={name:nt(t),rawConstructor:Xt(i,s),rawDestructor:Xt(r,n),fields:[]}},e:function(e,t,i,s,r,n,o,a,u,h){it[e].fields.push({fieldName:nt(t),getterReturnType:i,getter:Xt(s,r),getterContext:n,setterArgumentType:o,setter:Xt(a,u),setterContext:h})},ja:function(e,t){ut(e,{isVoid:!0,name:t=nt(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},ea:function(e,t){if(e==t)postMessage({cmd:"processQueuedMainThreadWork"});else if(M)postMessage({targetThread:e,cmd:"processThreadQueue"});else{var i=Ee.pthreads[e],s=i&&i.worker;if(!s)return;s.postMessage({cmd:"processThreadQueue"})}return 1},n:function(e,t,i){e=hi(e),t=ni(t,"emval::as");var s=[],r=si(s);return o()[i>>>2]=r,t.toWireType(s,e)},L:function(e,t,i,s){e=hi(e);for(var r=function(e,t){for(var i=new Array(e),s=0;s<e;++s)i[s]=ni(o()[(t>>2)+s>>>0],"parameter "+s);return i}(t,i),n=new Array(t),a=0;a<t;++a){var u=r[a];n[a]=u.readValueFromPointer(s),s+=u.argPackAdvance}return si(e.apply(void 0,n))},b:ei,U:function(e){return 0===e?si(pi()):(e=ci(e),si(pi()[e]))},o:function(e,t){return si((e=hi(e))[t=hi(t)])},j:function(e){e>4&&($t[e].refcount+=1)},ca:function(e,t){return(e=hi(e))instanceof(t=hi(t))},M:function(e){return"number"==typeof(e=hi(e))},C:function(){return si([])},g:function(e){return si(ci(e))},w:function(){return si({})},m:function(e){We($t[e].value),ei(e)},i:function(e,t,i){e=hi(e),t=hi(t),i=hi(i),e[t]=i},d:function(e,t){return si((e=ni(e,"_emval_take_value")).readValueFromPointer(t))},I:function(){Te()},T:function(e,t){var i;if(0===e)i=Date.now();else{if(1!==e&&4!==e)return Fe(28),-1;i=ke()}return o()[t>>>2]=i/1e3|0,o()[t+4>>>2]=i%1e3*1e3*1e3|0,0},G:function(e,t,i){var r=function(e,t){var i;for(di.length=0,t>>=2;i=s()[e++>>>0];){var r=i<105;r&&1&t&&t++,di.push(r?u()[t++>>>1]:o()[t>>>0]),++t}return di}(t,i);return Ce[e].apply(null,r)},_:function(){w||P||F("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")},F:function(e,t){},r:function(e,i,s){if(e<=0||e>t().length||!0&e)return-28;if(x){if(Atomics.load(o(),e>>2)!=i)return-6;var r=performance.now(),n=r+s;for(Atomics.exchange(o(),ms>>2,e);;){if((r=performance.now())>n)return Atomics.exchange(o(),ms>>2,0),-73;if(0==Atomics.exchange(o(),ms>>2,0))break;if(es(),Atomics.load(o(),e>>2)!=i)return-6;Atomics.exchange(o(),ms>>2,e)}return 0}var a=Atomics.wait(o(),e>>2,i,s);if("timed-out"===a)return-73;if("not-equal"===a)return-6;if("ok"===a)return 0;throw"Atomics.wait returned an unexpected value "+a},q:Ae,x:ke,R:function(e,t,i){s().copyWithin(e>>>0,t>>>0,t+i>>>0)},$:function(e,t,i){mi.length=t;for(var s=i>>3,r=0;r<t;r++)mi[r]=u()[s+r>>>0];return(e<0?Ce[-e-1]:Wi[e]).apply(null,mi)},S:function(e){var t=s().length;if((e>>>=0)<=t)return!1;var i,r,n=4294901760;if(e>n)return!1;for(var o=1;o<=4;o*=2){var a=t*(1+.2/o);if(a=Math.min(a,e+100663296),vi(Math.min(n,((i=Math.max(e,a))%(r=65536)>0&&(i+=r-i%r),i))))return!0}return!1},aa:function(e,t,i){return xi(e)?Pi(e,t,i):Ti(e,t,i)},E:function(e){},ba:function(e,t){return function(e,t){var i=t>>2,s=o()[i+6>>>0],r={alpha:!!o()[i+0>>>0],depth:!!o()[i+1>>>0],stencil:!!o()[i+2>>>0],antialias:!!o()[i+3>>>0],premultipliedAlpha:!!o()[i+4>>>0],preserveDrawingBuffer:!!o()[i+5>>>0],powerPreference:Mi[s],failIfMajorPerformanceCaveat:!!o()[i+7>>>0],majorVersion:o()[i+8>>>0],minorVersion:o()[i+9>>>0],enableExtensionsByDefault:o()[i+10>>>0],explicitSwapControl:o()[i+11>>>0],proxyContextToMainThread:o()[i+12>>>0],renderViaOffscreenBackBuffer:o()[i+13>>>0]},n=xi(e);return n?r.explicitSwapControl?0:wi.createContext(n,r):0}(e,t)},Y:Di,Z:Ai,H:ki,ga:Ei,N:Fi,fa:Ri,Q:function(){Ee.initRuntime()},a:R||c.wasmMemory,da:function(e,t,i,s){if("undefined"==typeof SharedArrayBuffer)return E("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;if(!e)return E("pthread_create called with a null thread pointer!"),28;var r=[];if(M&&0===r.length)return $i(687865856,e,t,i,s);var n=0,u=0,h=0;t&&-1!=t?(n=o()[t>>>2],n+=81920,u=o()[t+8>>>2],h=0!==o()[t+12>>>2]):n=2097152;var l=0==u;l?u=ps(16,n):L((u-=n)>0);for(var c=Ki(228),p=0;p<57;++p)a()[(c>>2)+p>>>0]=0;o()[e>>>2]=c,o()[c+12>>>2]=c;var d=c+152;o()[d>>>2]=d;var f={stackBase:u,stackSize:n,allocatedOwnStack:l,detached:h,startRoutine:i,pthread_ptr:c,arg:s,transferList:r};return M?(f.cmd="spawnThread",postMessage(f,r),0):Si(f)},P:function(e){},X:function(e,t,i,s){return Gi(e,t,i,s)}};!function(){var e={a:Yi};function t(e,t){var i,s=e.exports;if(c.asm=s,ue=c.asm.ta,i=c.asm.oa,ce.unshift(i),Ee.tlsInitFunctions.push(c.asm.sa),S=t,!M){var r=Ee.unusedWorkers.length;Ee.unusedWorkers.forEach((function(e){Ee.loadWasmModuleToWorker(e,(function(){--r||Pe()}))}))}}function i(e){t(e.instance,e.module)}function s(t){return function(){if(!A&&(x||P)){if("function"==typeof fetch&&!Me(ve))return fetch(ve,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ve+"'";return e.arrayBuffer()})).catch((function(){return Ie(ve)}));if(m)return new Promise((function(e,t){m(ve,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return Ie(ve)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){E("failed to asynchronously prepare wasm: "+e),Te(e)}))}if(M||xe(),c.instantiateWasm)try{return c.instantiateWasm(e,t)}catch(e){return E("Module.instantiateWasm callback failed with error: "+e),!1}(A||"function"!=typeof WebAssembly.instantiateStreaming||we(ve)||Me(ve)||"function"!=typeof fetch?s(i):fetch(ve,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(i,(function(e){return E("wasm streaming compile failed: "+e),E("falling back to ArrayBuffer instantiation"),s(i)}))}))).catch(l)}(),c.___wasm_call_ctors=function(){return(c.___wasm_call_ctors=c.asm.oa).apply(null,arguments)},c._main=function(){return(c._main=c.asm.pa).apply(null,arguments)};var Ki=c._malloc=function(){return(Ki=c._malloc=c.asm.qa).apply(null,arguments)},Ji=c._free=function(){return(Ji=c._free=c.asm.ra).apply(null,arguments)};c._emscripten_tls_init=function(){return(c._emscripten_tls_init=c.asm.sa).apply(null,arguments)};var Zi=c.___getTypeName=function(){return(Zi=c.___getTypeName=c.asm.ua).apply(null,arguments)};c.___embind_register_native_and_builtin_types=function(){return(c.___embind_register_native_and_builtin_types=c.asm.va).apply(null,arguments)},c._emscripten_current_thread_process_queued_calls=function(){return(c._emscripten_current_thread_process_queued_calls=c.asm.wa).apply(null,arguments)};var Qi=c._emscripten_register_main_browser_thread_id=function(){return(Qi=c._emscripten_register_main_browser_thread_id=c.asm.xa).apply(null,arguments)},qi=c.__emscripten_do_dispatch_to_thread=function(){return(qi=c.__emscripten_do_dispatch_to_thread=c.asm.ya).apply(null,arguments)},$i=c._emscripten_sync_run_in_main_thread_4=function(){return($i=c._emscripten_sync_run_in_main_thread_4=c.asm.za).apply(null,arguments)},es=c._emscripten_main_thread_process_queued_calls=function(){return(es=c._emscripten_main_thread_process_queued_calls=c.asm.Aa).apply(null,arguments)},ts=c._emscripten_run_in_main_runtime_thread_js=function(){return(ts=c._emscripten_run_in_main_runtime_thread_js=c.asm.Ba).apply(null,arguments)},is=c.__emscripten_call_on_thread=function(){return(is=c.__emscripten_call_on_thread=c.asm.Ca).apply(null,arguments)},ss=c.__emscripten_thread_init=function(){return(ss=c.__emscripten_thread_init=c.asm.Da).apply(null,arguments)},rs=c._emscripten_get_global_libc=function(){return(rs=c._emscripten_get_global_libc=c.asm.Ea).apply(null,arguments)},ns=c.___errno_location=function(){return(ns=c.___errno_location=c.asm.Fa).apply(null,arguments)},os=c._pthread_self=function(){return(os=c._pthread_self=c.asm.Ga).apply(null,arguments)},as=c.___pthread_tsd_run_dtors=function(){return(as=c.___pthread_tsd_run_dtors=c.asm.Ha).apply(null,arguments)},us=c.stackSave=function(){return(us=c.stackSave=c.asm.Ia).apply(null,arguments)},hs=c.stackRestore=function(){return(hs=c.stackRestore=c.asm.Ja).apply(null,arguments)},ls=c.stackAlloc=function(){return(ls=c.stackAlloc=c.asm.Ka).apply(null,arguments)},cs=c._emscripten_stack_set_limits=function(){return(cs=c._emscripten_stack_set_limits=c.asm.La).apply(null,arguments)},ps=c._memalign=function(){return(ps=c._memalign=c.asm.Ma).apply(null,arguments)};c.dynCall_jiji=function(){return(c.dynCall_jiji=c.asm.Na).apply(null,arguments)},c.dynCall_viijii=function(){return(c.dynCall_viijii=c.asm.Oa).apply(null,arguments)},c.dynCall_iiiiij=function(){return(c.dynCall_iiiiij=c.asm.Pa).apply(null,arguments)},c.dynCall_iiiiijj=function(){return(c.dynCall_iiiiijj=c.asm.Qa).apply(null,arguments)},c.dynCall_iiiiiijj=function(){return(c.dynCall_iiiiiijj=c.asm.Ra).apply(null,arguments)};var ds,fs=c.__emscripten_allow_main_runtime_queued_calls=44840,ms=c.__emscripten_main_thread_futex=48292;function vs(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function gs(e){if(!(ye>0)){if(M)return h(c),me(),void postMessage({cmd:"loaded"});!function(){if(!M){if(c.preRun)for("function"==typeof c.preRun&&(c.preRun=[c.preRun]);c.preRun.length;)e=c.preRun.shift(),le.unshift(e);var e;De(le)}}(),ye>0||(c.setStatus?(c.setStatus("Running..."),setTimeout((function(){setTimeout((function(){c.setStatus("")}),1),t()}),1)):t())}function t(){ds||(ds=!0,c.calledRun=!0,B||(me(),M||De(pe),h(c),c.onRuntimeInitialized&&c.onRuntimeInitialized(),ys&&function(e){var t=c._main;try{_s(t(0,0),!0)}catch(e){if(e instanceof vs||"unwind"==e)return;var i=e;e&&"object"===T(e)&&e.stack&&(i=[e,e.stack]),E("exception thrown: "+i),b(1,e)}}(),function(){if(!M){if(c.postRun)for("function"==typeof c.postRun&&(c.postRun=[c.postRun]);c.postRun.length;)e=c.postRun.shift(),de.unshift(e);var e;De(de)}}()))}}function _s(e,t){if(!t&&M)throw postMessage({cmd:"exitProcess",returnCode:e}),new vs(e);fe()||(Ee.terminateAllThreads(),c.onExit&&c.onExit(e),B=!0),b(e,new vs(e))}if(c.addRunDependency=xe,c.removeRunDependency=Pe,c.FS_createPath=je.createPath,c.FS_createDataFile=je.createDataFile,c.FS_createPreloadedFile=je.createPreloadedFile,c.FS_createLazyFile=je.createLazyFile,c.FS_createDevice=je.createDevice,c.FS_unlink=je.unlink,c.keepRuntimeAlive=fe,c.FS=je,c.PThread=Ee,c.PThread=Ee,c.wasmMemory=R,c.ExitStatus=vs,be=function e(){ds||gs(),ds||(be=e)},c.run=gs,c.preInit)for("function"==typeof c.preInit&&(c.preInit=[c.preInit]);c.preInit.length>0;)c.preInit.pop()();var ys=!0;return c.noInitialRun&&(ys=!1),M&&(O=!1,Ee.initWorker()),gs(),e.ready});"object"===T(e)&&"object"===T(t)?t.exports=s:"function"==typeof define&&define.amd?define([],(function(){return s})):"object"===T(e)&&(e.WebIFCWasm=s)}}),qP=KP({"dist/web-ifc.js":function(e,t){var i,s=(i="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(i=i||__filename),function(e){var t,s,r=void 0!==(e=e||{})?e:{};r.ready=new Promise((function(e,i){t=e,s=i}));var n,o={};for(n in r)r.hasOwnProperty(n)&&(o[n]=r[n]);var a,u,h,l,c,p="./this.program",d=function(e,t){throw t},f="object"===("undefined"==typeof window?"undefined":T(window)),m="function"==typeof importScripts,v="object"===("undefined"==typeof process?"undefined":T(process))&&"object"===T(process.versions)&&"string"==typeof process.versions.node,g="";v?(g=m?YP("path").dirname(g)+"/":__dirname+"/",a=function(e,t){return l||(l=YP("fs")),c||(c=YP("path")),e=c.normalize(e),l.readFileSync(e,t?null:"utf8")},h=function(e){var t=a(e,!0);return t.buffer||(t=new Uint8Array(t)),M(t.buffer),t},u=function(e,t,i){l||(l=YP("fs")),c||(c=YP("path")),e=c.normalize(e),l.readFile(e,(function(e,s){e?i(e):t(s.buffer)}))},process.argv.length>1&&(p=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof ci))throw e})),process.on("unhandledRejection",he),d=function(e,t){if(ee())throw process.exitCode=e,t;process.exit(e)},r.inspect=function(){return"[Emscripten Module object]"}):(f||m)&&(m?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),i&&(g=i),g=0!==g.indexOf("blob:")?g.substr(0,g.lastIndexOf("/")+1):"",a=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},m&&(h=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),u=function(e,t,i){var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(){200==s.status||0==s.status&&s.response?t(s.response):i()},s.onerror=i,s.send(null)});var _,y=r.print||console.log.bind(console),b=r.printErr||console.warn.bind(console);for(n in o)o.hasOwnProperty(n)&&(r[n]=o[n]);o=null,r.arguments,r.thisProgram&&(p=r.thisProgram),r.quit&&(d=r.quit),r.wasmBinary&&(_=r.wasmBinary);var x,P=r.noExitRuntime||!0;"object"!==("undefined"==typeof WebAssembly?"undefined":T(WebAssembly))&&he("no native wasm support detected");var w=!1;function M(e,t){e||he("Assertion failed: "+t)}var I="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function C(e,t,i){for(var s=(t>>>=0)+i,r=t;e[r>>>0]&&!(r>=s);)++r;if(r-t>16&&e.subarray&&I)return I.decode(e.subarray(t>>>0,r>>>0));for(var n="";t<r;){var o=e[t++>>>0];if(128&o){var a=63&e[t++>>>0];if(192!=(224&o)){var u=63&e[t++>>>0];if((o=224==(240&o)?(15&o)<<12|a<<6|u:(7&o)<<18|a<<12|u<<6|63&e[t++>>>0])<65536)n+=String.fromCharCode(o);else{var h=o-65536;n+=String.fromCharCode(55296|h>>10,56320|1023&h)}}else n+=String.fromCharCode((31&o)<<6|a)}else n+=String.fromCharCode(o)}return n}function D(e,t){return(e>>>=0)?C(S,e,t):""}function A(e,t,i,s){if(!(s>0))return 0;for(var r=i>>>=0,n=i+s-1,o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o)),a<=127){if(i>=n)break;t[i++>>>0]=a}else if(a<=2047){if(i+1>=n)break;t[i++>>>0]=192|a>>6,t[i++>>>0]=128|63&a}else if(a<=65535){if(i+2>=n)break;t[i++>>>0]=224|a>>12,t[i++>>>0]=128|a>>6&63,t[i++>>>0]=128|63&a}else{if(i+3>=n)break;t[i++>>>0]=240|a>>18,t[i++>>>0]=128|a>>12&63,t[i++>>>0]=128|a>>6&63,t[i++>>>0]=128|63&a}}return t[i>>>0]=0,i-r}function k(e,t,i){return A(e,S,t,i)}function E(e){for(var t=0,i=0;i<e.length;++i){var s=e.charCodeAt(i);s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++i)),s<=127?++t:t+=s<=2047?2:s<=65535?3:4}return t}var F,R,S,O,B,L,N,j,G,H,U="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function V(e,t){for(var i=e,s=i>>1,r=s+t/2;!(s>=r)&&B[s>>>0];)++s;if((i=s<<1)-e>32&&U)return U.decode(S.subarray(e>>>0,i>>>0));for(var n="",o=0;!(o>=t/2);++o){var a=O[e+2*o>>>1];if(0==a)break;n+=String.fromCharCode(a)}return n}function z(e,t,i){if(void 0===i&&(i=2147483647),i<2)return 0;for(var s=t,r=(i-=2)<2*e.length?i/2:e.length,n=0;n<r;++n){var o=e.charCodeAt(n);O[t>>>1]=o,t+=2}return O[t>>>1]=0,t-s}function W(e){return 2*e.length}function X(e,t){for(var i=0,s="";!(i>=t/4);){var r=L[e+4*i>>>2];if(0==r)break;if(++i,r>=65536){var n=r-65536;s+=String.fromCharCode(55296|n>>10,56320|1023&n)}else s+=String.fromCharCode(r)}return s}function Y(e,t,i){if(void 0===i&&(i=2147483647),i<4)return 0;for(var s=t>>>=0,r=s+i-4,n=0;n<e.length;++n){var o=e.charCodeAt(n);if(o>=55296&&o<=57343&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++n)),L[t>>>2]=o,(t+=4)+4>r)break}return L[t>>>2]=0,t-s}function K(e){for(var t=0,i=0;i<e.length;++i){var s=e.charCodeAt(i);s>=55296&&s<=57343&&++i,t+=4}return t}function J(e){F=e,r.HEAP8=R=new Int8Array(e),r.HEAP16=O=new Int16Array(e),r.HEAP32=L=new Int32Array(e),r.HEAPU8=S=new Uint8Array(e),r.HEAPU16=B=new Uint16Array(e),r.HEAPU32=N=new Uint32Array(e),r.HEAPF32=j=new Float32Array(e),r.HEAPF64=G=new Float64Array(e)}r.INITIAL_MEMORY;var Z=[],Q=[],q=[],$=[];function ee(){return P||!1}var te,ie,se,re,ne=0,oe=null;function ae(e){ne++,r.monitorRunDependencies&&r.monitorRunDependencies(ne)}function ue(e){if(ne--,r.monitorRunDependencies&&r.monitorRunDependencies(ne),0==ne&&oe){var t=oe;oe=null,t()}}function he(e){r.onAbort&&r.onAbort(e),b(e+=""),w=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw s(t),t}function le(e){return e.startsWith("data:application/octet-stream;base64,")}function ce(e){return e.startsWith("file://")}function pe(e){try{if(e==te&&_)return new Uint8Array(_);if(h)return h(e);throw"both async and sync fetching of the wasm failed"}catch(e){he(e)}}function de(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var i=t.func;"number"==typeof i?void 0===t.arg?H.get(i)():H.get(i)(t.arg):i(void 0===t.arg?null:t.arg)}else t(r)}}function fe(e){this.excPtr=e,this.ptr=e-16,this.set_type=function(e){L[this.ptr+4>>>2]=e},this.get_type=function(){return L[this.ptr+4>>>2]},this.set_destructor=function(e){L[this.ptr+8>>>2]=e},this.get_destructor=function(){return L[this.ptr+8>>>2]},this.set_refcount=function(e){L[this.ptr>>>2]=e},this.set_caught=function(e){e=e?1:0,R[this.ptr+12>>>0]=e},this.get_caught=function(){return 0!=R[this.ptr+12>>>0]},this.set_rethrown=function(e){e=e?1:0,R[this.ptr+13>>>0]=e},this.get_rethrown=function(){return 0!=R[this.ptr+13>>>0]},this.init=function(e,t){this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=L[this.ptr>>>2];L[this.ptr>>>2]=e+1},this.release_ref=function(){var e=L[this.ptr>>>2];return L[this.ptr>>>2]=e-1,1===e}}function me(e){return L[li()>>>2]=e,e}r.preloadedImages={},r.preloadedAudios={},le(te="web-ifc.wasm")||(ie=te,te=r.locateFile?r.locateFile(ie,g):g+ie);var ve={splitPath:function(e){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1)},normalizeArray:function(e,t){for(var i=0,s=e.length-1;s>=0;s--){var r=e[s];"."===r?e.splice(s,1):".."===r?(e.splice(s,1),i++):i&&(e.splice(s,1),i--)}if(t)for(;i;i--)e.unshift("..");return e},normalize:function(e){var t="/"===e.charAt(0),i="/"===e.substr(-1);return e=ve.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"),e||t||(e="."),e&&i&&(e+="/"),(t?"/":"")+e},dirname:function(e){var t=ve.splitPath(e),i=t[0],s=t[1];return i||s?(s&&(s=s.substr(0,s.length-1)),i+s):"."},basename:function(e){if("/"===e)return"/";var t=(e=(e=ve.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)},extname:function(e){return ve.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return ve.normalize(e.join("/"))},join2:function(e,t){return ve.normalize(e+"/"+t)}},ge={resolve:function(){for(var e="",t=!1,i=arguments.length-1;i>=-1&&!t;i--){var s=i>=0?arguments[i]:be.cwd();if("string"!=typeof s)throw new TypeError("Arguments to path.resolve must be strings");if(!s)return"";e=s+"/"+e,t="/"===s.charAt(0)}return e=ve.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"),(t?"/":"")+e||"."},relative:function(e,t){function i(e){for(var t=0;t<e.length&&""===e[t];t++);for(var i=e.length-1;i>=0&&""===e[i];i--);return t>i?[]:e.slice(t,i-t+1)}e=ge.resolve(e).substr(1),t=ge.resolve(t).substr(1);for(var s=i(e.split("/")),r=i(t.split("/")),n=Math.min(s.length,r.length),o=n,a=0;a<n;a++)if(s[a]!==r[a]){o=a;break}var u=[];for(a=o;a<s.length;a++)u.push("..");return(u=u.concat(r.slice(o))).join("/")}},_e={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){_e.ttys[e]={input:[],output:[],ops:t},be.registerDevice(e,_e.stream_ops)},stream_ops:{open:function(e){var t=_e.ttys[e.node.rdev];if(!t)throw new be.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.flush(e.tty)},flush:function(e){e.tty.ops.flush(e.tty)},read:function(e,t,i,s,r){if(!e.tty||!e.tty.ops.get_char)throw new be.ErrnoError(60);for(var n=0,o=0;o<s;o++){var a;try{a=e.tty.ops.get_char(e.tty)}catch(e){throw new be.ErrnoError(29)}if(void 0===a&&0===n)throw new be.ErrnoError(6);if(null==a)break;n++,t[i+o]=a}return n&&(e.node.timestamp=Date.now()),n},write:function(e,t,i,s,r){if(!e.tty||!e.tty.ops.put_char)throw new be.ErrnoError(60);try{for(var n=0;n<s;n++)e.tty.ops.put_char(e.tty,t[i+n])}catch(e){throw new be.ErrnoError(29)}return s&&(e.node.timestamp=Date.now()),n}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if(v){var i=Buffer.alloc(256),s=0;try{s=l.readSync(process.stdin.fd,i,0,256,null)}catch(e){if(!e.toString().includes("EOF"))throw e;s=0}t=s>0?i.slice(0,s).toString("utf-8"):null}else"undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n");if(!t)return null;e.input=ri(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(y(C(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(y(C(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(b(C(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(b(C(e.output,0)),e.output=[])}}},ye={ops_table:null,mount:function(e){return ye.createNode(null,"/",16895,0)},createNode:function(e,t,i,s){if(be.isBlkdev(i)||be.isFIFO(i))throw new be.ErrnoError(63);ye.ops_table||(ye.ops_table={dir:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr,lookup:ye.node_ops.lookup,mknod:ye.node_ops.mknod,rename:ye.node_ops.rename,unlink:ye.node_ops.unlink,rmdir:ye.node_ops.rmdir,readdir:ye.node_ops.readdir,symlink:ye.node_ops.symlink},stream:{llseek:ye.stream_ops.llseek}},file:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr},stream:{llseek:ye.stream_ops.llseek,read:ye.stream_ops.read,write:ye.stream_ops.write,allocate:ye.stream_ops.allocate,mmap:ye.stream_ops.mmap,msync:ye.stream_ops.msync}},link:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr,readlink:ye.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr},stream:be.chrdev_stream_ops}});var r=be.createNode(e,t,i,s);return be.isDir(r.mode)?(r.node_ops=ye.ops_table.dir.node,r.stream_ops=ye.ops_table.dir.stream,r.contents={}):be.isFile(r.mode)?(r.node_ops=ye.ops_table.file.node,r.stream_ops=ye.ops_table.file.stream,r.usedBytes=0,r.contents=null):be.isLink(r.mode)?(r.node_ops=ye.ops_table.link.node,r.stream_ops=ye.ops_table.link.stream):be.isChrdev(r.mode)&&(r.node_ops=ye.ops_table.chrdev.node,r.stream_ops=ye.ops_table.chrdev.stream),r.timestamp=Date.now(),e&&(e.contents[t]=r,e.timestamp=r.timestamp),r},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){t>>>=0;var i=e.contents?e.contents.length:0;if(!(i>=t)){t=Math.max(t,i*(i<1048576?2:1.125)>>>0),0!=i&&(t=Math.max(t,256));var s=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(s.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(t>>>=0,e.usedBytes!=t)if(0==t)e.contents=null,e.usedBytes=0;else{var i=e.contents;e.contents=new Uint8Array(t),i&&e.contents.set(i.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=be.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,be.isDir(e.mode)?t.size=4096:be.isFile(e.mode)?t.size=e.usedBytes:be.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&ye.resizeFileStorage(e,t.size)},lookup:function(e,t){throw be.genericErrors[44]},mknod:function(e,t,i,s){return ye.createNode(e,t,i,s)},rename:function(e,t,i){if(be.isDir(e.mode)){var s;try{s=be.lookupNode(t,i)}catch(e){}if(s)for(var r in s.contents)throw new be.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=i,t.contents[i]=e,t.timestamp=e.parent.timestamp,e.parent=t},unlink:function(e,t){delete e.contents[t],e.timestamp=Date.now()},rmdir:function(e,t){var i=be.lookupNode(e,t);for(var s in i.contents)throw new be.ErrnoError(55);delete e.contents[t],e.timestamp=Date.now()},readdir:function(e){var t=[".",".."];for(var i in e.contents)e.contents.hasOwnProperty(i)&&t.push(i);return t},symlink:function(e,t,i){var s=ye.createNode(e,t,41471,0);return s.link=i,s},readlink:function(e){if(!be.isLink(e.mode))throw new be.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,i,s,r){var n=e.node.contents;if(r>=e.node.usedBytes)return 0;var o=Math.min(e.node.usedBytes-r,s);if(o>8&&n.subarray)t.set(n.subarray(r,r+o),i);else for(var a=0;a<o;a++)t[i+a]=n[r+a];return o},write:function(e,t,i,s,r,n){if(t.buffer===R.buffer&&(n=!1),!s)return 0;var o=e.node;if(o.timestamp=Date.now(),t.subarray&&(!o.contents||o.contents.subarray)){if(n)return o.contents=t.subarray(i,i+s),o.usedBytes=s,s;if(0===o.usedBytes&&0===r)return o.contents=t.slice(i,i+s),o.usedBytes=s,s;if(r+s<=o.usedBytes)return o.contents.set(t.subarray(i,i+s),r),s}if(ye.expandFileStorage(o,r+s),o.contents.subarray&&t.subarray)o.contents.set(t.subarray(i,i+s),r);else for(var a=0;a<s;a++)o.contents[r+a]=t[i+a];return o.usedBytes=Math.max(o.usedBytes,r+s),s},llseek:function(e,t,i){var s=t;if(1===i?s+=e.position:2===i&&be.isFile(e.node.mode)&&(s+=e.node.usedBytes),s<0)throw new be.ErrnoError(28);return s},allocate:function(e,t,i){ye.expandFileStorage(e.node,t+i),e.node.usedBytes=Math.max(e.node.usedBytes,t+i)},mmap:function(e,t,i,s,r,n){if(0!==t)throw new be.ErrnoError(28);if(!be.isFile(e.node.mode))throw new be.ErrnoError(43);var o,a,u=e.node.contents;if(2&n||u.buffer!==F){if((s>0||s+i<u.length)&&(u=u.subarray?u.subarray(s,s+i):Array.prototype.slice.call(u,s,s+i)),a=!0,!(o=void he()))throw new be.ErrnoError(48);o>>>=0,R.set(u,o>>>0)}else a=!1,o=u.byteOffset;return{ptr:o,allocated:a}},msync:function(e,t,i,s,r){if(!be.isFile(e.node.mode))throw new be.ErrnoError(43);return 2&r||ye.stream_ops.write(e,t,0,s,i,!1),0}}},be={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(e,t){if(t=t||{},!(e=ge.resolve(be.cwd(),e)))return{path:"",node:null};var i={follow_mount:!0,recurse_count:0};for(var s in i)void 0===t[s]&&(t[s]=i[s]);if(t.recurse_count>8)throw new be.ErrnoError(32);for(var r=ve.normalizeArray(e.split("/").filter((function(e){return!!e})),!1),n=be.root,o="/",a=0;a<r.length;a++){var u=a===r.length-1;if(u&&t.parent)break;if(n=be.lookupNode(n,r[a]),o=ve.join2(o,r[a]),be.isMountpoint(n)&&(!u||u&&t.follow_mount)&&(n=n.mounted.root),!u||t.follow)for(var h=0;be.isLink(n.mode);){var l=be.readlink(o);if(o=ge.resolve(ve.dirname(o),l),n=be.lookupPath(o,{recurse_count:t.recurse_count}).node,h++>40)throw new be.ErrnoError(32)}}return{path:o,node:n}},getPath:function(e){for(var t;;){if(be.isRoot(e)){var i=e.mount.mountpoint;return t?"/"!==i[i.length-1]?i+"/"+t:i+t:i}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:function(e,t){for(var i=0,s=0;s<t.length;s++)i=(i<<5)-i+t.charCodeAt(s)|0;return(e+i>>>0)%be.nameTable.length},hashAddNode:function(e){var t=be.hashName(e.parent.id,e.name);e.name_next=be.nameTable[t],be.nameTable[t]=e},hashRemoveNode:function(e){var t=be.hashName(e.parent.id,e.name);if(be.nameTable[t]===e)be.nameTable[t]=e.name_next;else for(var i=be.nameTable[t];i;){if(i.name_next===e){i.name_next=e.name_next;break}i=i.name_next}},lookupNode:function(e,t){var i=be.mayLookup(e);if(i)throw new be.ErrnoError(i,e);for(var s=be.hashName(e.id,t),r=be.nameTable[s];r;r=r.name_next){var n=r.name;if(r.parent.id===e.id&&n===t)return r}return be.lookup(e,t)},createNode:function(e,t,i,s){var r=new be.FSNode(e,t,i,s);return be.hashAddNode(r),r},destroyNode:function(e){be.hashRemoveNode(e)},isRoot:function(e){return e===e.parent},isMountpoint:function(e){return!!e.mounted},isFile:function(e){return 32768==(61440&e)},isDir:function(e){return 16384==(61440&e)},isLink:function(e){return 40960==(61440&e)},isChrdev:function(e){return 8192==(61440&e)},isBlkdev:function(e){return 24576==(61440&e)},isFIFO:function(e){return 4096==(61440&e)},isSocket:function(e){return 49152==(49152&e)},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(e){var t=be.flagModes[e];if(void 0===t)throw new Error("Unknown file open mode: "+e);return t},flagsToPermissionString:function(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:function(e,t){return be.ignorePermissions||(!t.includes("r")||292&e.mode)&&(!t.includes("w")||146&e.mode)&&(!t.includes("x")||73&e.mode)?0:2},mayLookup:function(e){var t=be.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:function(e,t){try{return be.lookupNode(e,t),20}catch(e){}return be.nodePermissions(e,"wx")},mayDelete:function(e,t,i){var s;try{s=be.lookupNode(e,t)}catch(e){return e.errno}var r=be.nodePermissions(e,"wx");if(r)return r;if(i){if(!be.isDir(s.mode))return 54;if(be.isRoot(s)||be.getPath(s)===be.cwd())return 10}else if(be.isDir(s.mode))return 31;return 0},mayOpen:function(e,t){return e?be.isLink(e.mode)?32:be.isDir(e.mode)&&("r"!==be.flagsToPermissionString(t)||512&t)?31:be.nodePermissions(e,be.flagsToPermissionString(t)):44},MAX_OPEN_FDS:4096,nextfd:function(e,t){e=e||0,t=t||be.MAX_OPEN_FDS;for(var i=e;i<=t;i++)if(!be.streams[i])return i;throw new be.ErrnoError(33)},getStream:function(e){return be.streams[e]},createStream:function(e,t,i){be.FSStream||(be.FSStream=function(){},be.FSStream.prototype={object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}});var s=new be.FSStream;for(var r in e)s[r]=e[r];e=s;var n=be.nextfd(t,i);return e.fd=n,be.streams[n]=e,e},closeStream:function(e){be.streams[e]=null},chrdev_stream_ops:{open:function(e){var t=be.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:function(){throw new be.ErrnoError(70)}},major:function(e){return e>>8},minor:function(e){return 255&e},makedev:function(e,t){return e<<8|t},registerDevice:function(e,t){be.devices[e]={stream_ops:t}},getDevice:function(e){return be.devices[e]},getMounts:function(e){for(var t=[],i=[e];i.length;){var s=i.pop();t.push(s),i.push.apply(i,s.mounts)}return t},syncfs:function(e,t){"function"==typeof e&&(t=e,e=!1),be.syncFSRequests++,be.syncFSRequests>1&&b("warning: "+be.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var i=be.getMounts(be.root.mount),s=0;function r(e){return be.syncFSRequests--,t(e)}function n(e){if(e)return n.errored?void 0:(n.errored=!0,r(e));++s>=i.length&&r(null)}i.forEach((function(t){if(!t.type.syncfs)return n(null);t.type.syncfs(t,e,n)}))},mount:function(e,t,i){var s,r="/"===i,n=!i;if(r&&be.root)throw new be.ErrnoError(10);if(!r&&!n){var o=be.lookupPath(i,{follow_mount:!1});if(i=o.path,s=o.node,be.isMountpoint(s))throw new be.ErrnoError(10);if(!be.isDir(s.mode))throw new be.ErrnoError(54)}var a={type:e,opts:t,mountpoint:i,mounts:[]},u=e.mount(a);return u.mount=a,a.root=u,r?be.root=u:s&&(s.mounted=a,s.mount&&s.mount.mounts.push(a)),u},unmount:function(e){var t=be.lookupPath(e,{follow_mount:!1});if(!be.isMountpoint(t.node))throw new be.ErrnoError(28);var i=t.node,s=i.mounted,r=be.getMounts(s);Object.keys(be.nameTable).forEach((function(e){for(var t=be.nameTable[e];t;){var i=t.name_next;r.includes(t.mount)&&be.destroyNode(t),t=i}})),i.mounted=null;var n=i.mount.mounts.indexOf(s);i.mount.mounts.splice(n,1)},lookup:function(e,t){return e.node_ops.lookup(e,t)},mknod:function(e,t,i){var s=be.lookupPath(e,{parent:!0}).node,r=ve.basename(e);if(!r||"."===r||".."===r)throw new be.ErrnoError(28);var n=be.mayCreate(s,r);if(n)throw new be.ErrnoError(n);if(!s.node_ops.mknod)throw new be.ErrnoError(63);return s.node_ops.mknod(s,r,t,i)},create:function(e,t){return t=void 0!==t?t:438,t&=4095,t|=32768,be.mknod(e,t,0)},mkdir:function(e,t){return t=void 0!==t?t:511,t&=1023,t|=16384,be.mknod(e,t,0)},mkdirTree:function(e,t){for(var i=e.split("/"),s="",r=0;r<i.length;++r)if(i[r]){s+="/"+i[r];try{be.mkdir(s,t)}catch(e){if(20!=e.errno)throw e}}},mkdev:function(e,t,i){return void 0===i&&(i=t,t=438),t|=8192,be.mknod(e,t,i)},symlink:function(e,t){if(!ge.resolve(e))throw new be.ErrnoError(44);var i=be.lookupPath(t,{parent:!0}).node;if(!i)throw new be.ErrnoError(44);var s=ve.basename(t),r=be.mayCreate(i,s);if(r)throw new be.ErrnoError(r);if(!i.node_ops.symlink)throw new be.ErrnoError(63);return i.node_ops.symlink(i,s,e)},rename:function(e,t){var i,s,r=ve.dirname(e),n=ve.dirname(t),o=ve.basename(e),a=ve.basename(t);if(i=be.lookupPath(e,{parent:!0}).node,s=be.lookupPath(t,{parent:!0}).node,!i||!s)throw new be.ErrnoError(44);if(i.mount!==s.mount)throw new be.ErrnoError(75);var u,h=be.lookupNode(i,o),l=ge.relative(e,n);if("."!==l.charAt(0))throw new be.ErrnoError(28);if("."!==(l=ge.relative(t,r)).charAt(0))throw new be.ErrnoError(55);try{u=be.lookupNode(s,a)}catch(e){}if(h!==u){var c=be.isDir(h.mode),p=be.mayDelete(i,o,c);if(p)throw new be.ErrnoError(p);if(p=u?be.mayDelete(s,a,c):be.mayCreate(s,a))throw new be.ErrnoError(p);if(!i.node_ops.rename)throw new be.ErrnoError(63);if(be.isMountpoint(h)||u&&be.isMountpoint(u))throw new be.ErrnoError(10);if(s!==i&&(p=be.nodePermissions(i,"w")))throw new be.ErrnoError(p);try{be.trackingDelegate.willMovePath&&be.trackingDelegate.willMovePath(e,t)}catch(i){b("FS.trackingDelegate['willMovePath']('"+e+"', '"+t+"') threw an exception: "+i.message)}be.hashRemoveNode(h);try{i.node_ops.rename(h,s,a)}catch(e){throw e}finally{be.hashAddNode(h)}try{be.trackingDelegate.onMovePath&&be.trackingDelegate.onMovePath(e,t)}catch(i){b("FS.trackingDelegate['onMovePath']('"+e+"', '"+t+"') threw an exception: "+i.message)}}},rmdir:function(e){var t=be.lookupPath(e,{parent:!0}).node,i=ve.basename(e),s=be.lookupNode(t,i),r=be.mayDelete(t,i,!0);if(r)throw new be.ErrnoError(r);if(!t.node_ops.rmdir)throw new be.ErrnoError(63);if(be.isMountpoint(s))throw new be.ErrnoError(10);try{be.trackingDelegate.willDeletePath&&be.trackingDelegate.willDeletePath(e)}catch(t){b("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.rmdir(t,i),be.destroyNode(s);try{be.trackingDelegate.onDeletePath&&be.trackingDelegate.onDeletePath(e)}catch(t){b("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readdir:function(e){var t=be.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new be.ErrnoError(54);return t.node_ops.readdir(t)},unlink:function(e){var t=be.lookupPath(e,{parent:!0}).node,i=ve.basename(e),s=be.lookupNode(t,i),r=be.mayDelete(t,i,!1);if(r)throw new be.ErrnoError(r);if(!t.node_ops.unlink)throw new be.ErrnoError(63);if(be.isMountpoint(s))throw new be.ErrnoError(10);try{be.trackingDelegate.willDeletePath&&be.trackingDelegate.willDeletePath(e)}catch(t){b("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.unlink(t,i),be.destroyNode(s);try{be.trackingDelegate.onDeletePath&&be.trackingDelegate.onDeletePath(e)}catch(t){b("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readlink:function(e){var t=be.lookupPath(e).node;if(!t)throw new be.ErrnoError(44);if(!t.node_ops.readlink)throw new be.ErrnoError(28);return ge.resolve(be.getPath(t.parent),t.node_ops.readlink(t))},stat:function(e,t){var i=be.lookupPath(e,{follow:!t}).node;if(!i)throw new be.ErrnoError(44);if(!i.node_ops.getattr)throw new be.ErrnoError(63);return i.node_ops.getattr(i)},lstat:function(e){return be.stat(e,!0)},chmod:function(e,t,i){var s;if(!(s="string"==typeof e?be.lookupPath(e,{follow:!i}).node:e).node_ops.setattr)throw new be.ErrnoError(63);s.node_ops.setattr(s,{mode:4095&t|-4096&s.mode,timestamp:Date.now()})},lchmod:function(e,t){be.chmod(e,t,!0)},fchmod:function(e,t){var i=be.getStream(e);if(!i)throw new be.ErrnoError(8);be.chmod(i.node,t)},chown:function(e,t,i,s){var r;if(!(r="string"==typeof e?be.lookupPath(e,{follow:!s}).node:e).node_ops.setattr)throw new be.ErrnoError(63);r.node_ops.setattr(r,{timestamp:Date.now()})},lchown:function(e,t,i){be.chown(e,t,i,!0)},fchown:function(e,t,i){var s=be.getStream(e);if(!s)throw new be.ErrnoError(8);be.chown(s.node,t,i)},truncate:function(e,t){if(t<0)throw new be.ErrnoError(28);var i;if(!(i="string"==typeof e?be.lookupPath(e,{follow:!0}).node:e).node_ops.setattr)throw new be.ErrnoError(63);if(be.isDir(i.mode))throw new be.ErrnoError(31);if(!be.isFile(i.mode))throw new be.ErrnoError(28);var s=be.nodePermissions(i,"w");if(s)throw new be.ErrnoError(s);i.node_ops.setattr(i,{size:t,timestamp:Date.now()})},ftruncate:function(e,t){var i=be.getStream(e);if(!i)throw new be.ErrnoError(8);if(0==(2097155&i.flags))throw new be.ErrnoError(28);be.truncate(i.node,t)},utime:function(e,t,i){var s=be.lookupPath(e,{follow:!0}).node;s.node_ops.setattr(s,{timestamp:Math.max(t,i)})},open:function(e,t,i,s,n){if(""===e)throw new be.ErrnoError(44);var o;if(i=void 0===i?438:i,i=64&(t="string"==typeof t?be.modeStringToFlags(t):t)?4095&i|32768:0,"object"===T(e))o=e;else{e=ve.normalize(e);try{o=be.lookupPath(e,{follow:!(131072&t)}).node}catch(e){}}var a=!1;if(64&t)if(o){if(128&t)throw new be.ErrnoError(20)}else o=be.mknod(e,i,0),a=!0;if(!o)throw new be.ErrnoError(44);if(be.isChrdev(o.mode)&&(t&=-513),65536&t&&!be.isDir(o.mode))throw new be.ErrnoError(54);if(!a){var u=be.mayOpen(o,t);if(u)throw new be.ErrnoError(u)}512&t&&be.truncate(o,0),t&=-131713;var h=be.createStream({node:o,path:be.getPath(o),flags:t,seekable:!0,position:0,stream_ops:o.stream_ops,ungotten:[],error:!1},s,n);h.stream_ops.open&&h.stream_ops.open(h),!r.logReadFiles||1&t||(be.readFiles||(be.readFiles={}),e in be.readFiles||(be.readFiles[e]=1,b("FS.trackingDelegate error on read file: "+e)));try{if(be.trackingDelegate.onOpenFile){var l=0;1!=(2097155&t)&&(l|=be.tracking.openFlags.READ),0!=(2097155&t)&&(l|=be.tracking.openFlags.WRITE),be.trackingDelegate.onOpenFile(e,l)}}catch(t){b("FS.trackingDelegate['onOpenFile']('"+e+"', flags) threw an exception: "+t.message)}return h},close:function(e){if(be.isClosed(e))throw new be.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(e){throw e}finally{be.closeStream(e.fd)}e.fd=null},isClosed:function(e){return null===e.fd},llseek:function(e,t,i){if(be.isClosed(e))throw new be.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new be.ErrnoError(70);if(0!=i&&1!=i&&2!=i)throw new be.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,i),e.ungotten=[],e.position},read:function(e,t,i,s,r){if(i>>>=0,s<0||r<0)throw new be.ErrnoError(28);if(be.isClosed(e))throw new be.ErrnoError(8);if(1==(2097155&e.flags))throw new be.ErrnoError(8);if(be.isDir(e.node.mode))throw new be.ErrnoError(31);if(!e.stream_ops.read)throw new be.ErrnoError(28);var n=void 0!==r;if(n){if(!e.seekable)throw new be.ErrnoError(70)}else r=e.position;var o=e.stream_ops.read(e,t,i,s,r);return n||(e.position+=o),o},write:function(e,t,i,s,r,n){if(i>>>=0,s<0||r<0)throw new be.ErrnoError(28);if(be.isClosed(e))throw new be.ErrnoError(8);if(0==(2097155&e.flags))throw new be.ErrnoError(8);if(be.isDir(e.node.mode))throw new be.ErrnoError(31);if(!e.stream_ops.write)throw new be.ErrnoError(28);e.seekable&&1024&e.flags&&be.llseek(e,0,2);var o=void 0!==r;if(o){if(!e.seekable)throw new be.ErrnoError(70)}else r=e.position;var a=e.stream_ops.write(e,t,i,s,r,n);o||(e.position+=a);try{e.path&&be.trackingDelegate.onWriteToFile&&be.trackingDelegate.onWriteToFile(e.path)}catch(t){b("FS.trackingDelegate['onWriteToFile']('"+e.path+"') threw an exception: "+t.message)}return a},allocate:function(e,t,i){if(be.isClosed(e))throw new be.ErrnoError(8);if(t<0||i<=0)throw new be.ErrnoError(28);if(0==(2097155&e.flags))throw new be.ErrnoError(8);if(!be.isFile(e.node.mode)&&!be.isDir(e.node.mode))throw new be.ErrnoError(43);if(!e.stream_ops.allocate)throw new be.ErrnoError(138);e.stream_ops.allocate(e,t,i)},mmap:function(e,t,i,s,r,n){if(t>>>=0,0!=(2&r)&&0==(2&n)&&2!=(2097155&e.flags))throw new be.ErrnoError(2);if(1==(2097155&e.flags))throw new be.ErrnoError(2);if(!e.stream_ops.mmap)throw new be.ErrnoError(43);return e.stream_ops.mmap(e,t,i,s,r,n)},msync:function(e,t,i,s,r){return i>>>=0,e&&e.stream_ops.msync?e.stream_ops.msync(e,t,i,s,r):0},munmap:function(e){return 0},ioctl:function(e,t,i){if(!e.stream_ops.ioctl)throw new be.ErrnoError(59);return e.stream_ops.ioctl(e,t,i)},readFile:function(e,t){if((t=t||{}).flags=t.flags||0,t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw new Error('Invalid encoding type "'+t.encoding+'"');var i,s=be.open(e,t.flags),r=be.stat(e).size,n=new Uint8Array(r);return be.read(s,n,0,r,0),"utf8"===t.encoding?i=C(n,0):"binary"===t.encoding&&(i=n),be.close(s),i},writeFile:function(e,t,i){(i=i||{}).flags=i.flags||577;var s=be.open(e,i.flags,i.mode);if("string"==typeof t){var r=new Uint8Array(E(t)+1),n=A(t,r,0,r.length);be.write(s,r,0,n,void 0,i.canOwn)}else{if(!ArrayBuffer.isView(t))throw new Error("Unsupported data type");be.write(s,t,0,t.byteLength,void 0,i.canOwn)}be.close(s)},cwd:function(){return be.currentPath},chdir:function(e){var t=be.lookupPath(e,{follow:!0});if(null===t.node)throw new be.ErrnoError(44);if(!be.isDir(t.node.mode))throw new be.ErrnoError(54);var i=be.nodePermissions(t.node,"x");if(i)throw new be.ErrnoError(i);be.currentPath=t.path},createDefaultDirectories:function(){be.mkdir("/tmp"),be.mkdir("/home"),be.mkdir("/home/web_user")},createDefaultDevices:function(){be.mkdir("/dev"),be.registerDevice(be.makedev(1,3),{read:function(){return 0},write:function(e,t,i,s,r){return s}}),be.mkdev("/dev/null",be.makedev(1,3)),_e.register(be.makedev(5,0),_e.default_tty_ops),_e.register(be.makedev(6,0),_e.default_tty1_ops),be.mkdev("/dev/tty",be.makedev(5,0)),be.mkdev("/dev/tty1",be.makedev(6,0));var e=function(){if("object"===("undefined"==typeof crypto?"undefined":T(crypto))&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}if(v)try{var t=ZP();return function(){return t.randomBytes(1)[0]}}catch(e){}return function(){he("randomDevice")}}();be.createDevice("/dev","random",e),be.createDevice("/dev","urandom",e),be.mkdir("/dev/shm"),be.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){be.mkdir("/proc");var e=be.mkdir("/proc/self");be.mkdir("/proc/self/fd"),be.mount({mount:function(){var t=be.createNode(e,"fd",16895,73);return t.node_ops={lookup:function(e,t){var i=+t,s=be.getStream(i);if(!s)throw new be.ErrnoError(8);var r={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return s.path}}};return r.parent=r,r}},t}},{},"/proc/self/fd")},createStandardStreams:function(){r.stdin?be.createDevice("/dev","stdin",r.stdin):be.symlink("/dev/tty","/dev/stdin"),r.stdout?be.createDevice("/dev","stdout",null,r.stdout):be.symlink("/dev/tty","/dev/stdout"),r.stderr?be.createDevice("/dev","stderr",null,r.stderr):be.symlink("/dev/tty1","/dev/stderr"),be.open("/dev/stdin",0),be.open("/dev/stdout",1),be.open("/dev/stderr",1)},ensureErrnoError:function(){be.ErrnoError||(be.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){this.errno=e},this.setErrno(e),this.message="FS error"},be.ErrnoError.prototype=new Error,be.ErrnoError.prototype.constructor=be.ErrnoError,[44].forEach((function(e){be.genericErrors[e]=new be.ErrnoError(e),be.genericErrors[e].stack="<generic error, no stack>"})))},staticInit:function(){be.ensureErrnoError(),be.nameTable=new Array(4096),be.mount(ye,{},"/"),be.createDefaultDirectories(),be.createDefaultDevices(),be.createSpecialDirectories(),be.filesystems={MEMFS:ye}},init:function(e,t,i){be.init.initialized=!0,be.ensureErrnoError(),r.stdin=e||r.stdin,r.stdout=t||r.stdout,r.stderr=i||r.stderr,be.createStandardStreams()},quit:function(){be.init.initialized=!1;var e=r._fflush;e&&e(0);for(var t=0;t<be.streams.length;t++){var i=be.streams[t];i&&be.close(i)}},getMode:function(e,t){var i=0;return e&&(i|=365),t&&(i|=146),i},findObject:function(e,t){var i=be.analyzePath(e,t);return i.exists?i.object:null},analyzePath:function(e,t){try{e=(s=be.lookupPath(e,{follow:!t})).path}catch(e){}var i={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var s=be.lookupPath(e,{parent:!0});i.parentExists=!0,i.parentPath=s.path,i.parentObject=s.node,i.name=ve.basename(e),s=be.lookupPath(e,{follow:!t}),i.exists=!0,i.path=s.path,i.object=s.node,i.name=s.node.name,i.isRoot="/"===s.path}catch(e){i.error=e.errno}return i},createPath:function(e,t,i,s){e="string"==typeof e?e:be.getPath(e);for(var r=t.split("/").reverse();r.length;){var n=r.pop();if(n){var o=ve.join2(e,n);try{be.mkdir(o)}catch(e){}e=o}}return o},createFile:function(e,t,i,s,r){var n=ve.join2("string"==typeof e?e:be.getPath(e),t),o=be.getMode(s,r);return be.create(n,o)},createDataFile:function(e,t,i,s,r,n){var o=t?ve.join2("string"==typeof e?e:be.getPath(e),t):e,a=be.getMode(s,r),u=be.create(o,a);if(i){if("string"==typeof i){for(var h=new Array(i.length),l=0,c=i.length;l<c;++l)h[l]=i.charCodeAt(l);i=h}be.chmod(u,146|a);var p=be.open(u,577);be.write(p,i,0,i.length,0,n),be.close(p),be.chmod(u,a)}return u},createDevice:function(e,t,i,s){var r=ve.join2("string"==typeof e?e:be.getPath(e),t),n=be.getMode(!!i,!!s);be.createDevice.major||(be.createDevice.major=64);var o=be.makedev(be.createDevice.major++,0);return be.registerDevice(o,{open:function(e){e.seekable=!1},close:function(e){s&&s.buffer&&s.buffer.length&&s(10)},read:function(e,t,s,r,n){for(var o=0,a=0;a<r;a++){var u;try{u=i()}catch(e){throw new be.ErrnoError(29)}if(void 0===u&&0===o)throw new be.ErrnoError(6);if(null==u)break;o++,t[s+a]=u}return o&&(e.node.timestamp=Date.now()),o},write:function(e,t,i,r,n){for(var o=0;o<r;o++)try{s(t[i+o])}catch(e){throw new be.ErrnoError(29)}return r&&(e.node.timestamp=Date.now()),o}}),be.mkdev(r,n,o)},forceLoadFile:function(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!a)throw new Error("Cannot load without read() or XMLHttpRequest.");try{e.contents=ri(a(e.url),!0),e.usedBytes=e.contents.length}catch(e){throw new be.ErrnoError(29)}},createLazyFile:function(e,t,i,s,r){function n(){this.lengthKnown=!1,this.chunks=[]}if(n.prototype.get=function(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,i=e/this.chunkSize|0;return this.getter(i)[t]}},n.prototype.setDataGetter=function(e){this.getter=e},n.prototype.cacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",i,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+i+". Status: "+e.status);var t,s=Number(e.getResponseHeader("Content-length")),r=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,n=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,o=1048576;r||(o=s);var a=this;a.setDataGetter((function(e){var t=e*o,r=(e+1)*o-1;if(r=Math.min(r,s-1),void 0===a.chunks[e]&&(a.chunks[e]=function(e,t){if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>s-1)throw new Error("only "+s+" bytes available! programmer error!");var r=new XMLHttpRequest;if(r.open("GET",i,!1),s!==o&&r.setRequestHeader("Range","bytes="+e+"-"+t),"undefined"!=typeof Uint8Array&&(r.responseType="arraybuffer"),r.overrideMimeType&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(null),!(r.status>=200&&r.status<300||304===r.status))throw new Error("Couldn't load "+i+". Status: "+r.status);return void 0!==r.response?new Uint8Array(r.response||[]):ri(r.responseText||"",!0)}(t,r)),void 0===a.chunks[e])throw new Error("doXHR failed!");return a.chunks[e]})),!n&&s||(o=s=1,s=this.getter(0).length,o=s,y("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=s,this._chunkSize=o,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest){if(!m)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var o=new n;Object.defineProperties(o,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var a={isDevice:!1,contents:o}}else a={isDevice:!1,url:i};var u=be.createFile(e,t,a,s,r);a.contents?u.contents=a.contents:a.url&&(u.contents=null,u.url=a.url),Object.defineProperties(u,{usedBytes:{get:function(){return this.contents.length}}});var h={};return Object.keys(u.stream_ops).forEach((function(e){var t=u.stream_ops[e];h[e]=function(){return be.forceLoadFile(u),t.apply(null,arguments)}})),h.read=function(e,t,i,s,r){be.forceLoadFile(u);var n=e.node.contents;if(r>=n.length)return 0;var o=Math.min(n.length-r,s);if(n.slice)for(var a=0;a<o;a++)t[i+a]=n[r+a];else for(a=0;a<o;a++)t[i+a]=n.get(r+a);return o},u.stream_ops=h,u},createPreloadedFile:function(e,t,i,s,n,o,a,h,l,c){Browser.init();var p=t?ge.resolve(ve.join2(e,t)):e;function d(i){function u(i){c&&c(),h||be.createDataFile(e,t,i,s,n,l),o&&o(),ue()}var d=!1;r.preloadPlugins.forEach((function(e){d||e.canHandle(p)&&(e.handle(i,p,u,(function(){a&&a(),ue()})),d=!0)})),d||u(i)}ae(),"string"==typeof i?function(e,t,i,s){var r=s?"":"al "+e;u(e,(function(i){M(i,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(i)),r&&ue()}),(function(t){if(!i)throw'Loading data file "'+e+'" failed.';i()})),r&&ae()}(i,(function(e){d(e)}),a):d(i)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(e,t,i){t=t||function(){},i=i||function(){};var s=be.indexedDB();try{var r=s.open(be.DB_NAME(),be.DB_VERSION)}catch(e){return i(e)}r.onupgradeneeded=function(){y("creating db"),r.result.createObjectStore(be.DB_STORE_NAME)},r.onsuccess=function(){var s=r.result.transaction([be.DB_STORE_NAME],"readwrite"),n=s.objectStore(be.DB_STORE_NAME),o=0,a=0,u=e.length;function h(){0==a?t():i()}e.forEach((function(e){var t=n.put(be.analyzePath(e).object.contents,e);t.onsuccess=function(){++o+a==u&&h()},t.onerror=function(){a++,o+a==u&&h()}})),s.onerror=i},r.onerror=i},loadFilesFromDB:function(e,t,i){t=t||function(){},i=i||function(){};var s=be.indexedDB();try{var r=s.open(be.DB_NAME(),be.DB_VERSION)}catch(e){return i(e)}r.onupgradeneeded=i,r.onsuccess=function(){var s=r.result;try{var n=s.transaction([be.DB_STORE_NAME],"readonly")}catch(e){return void i(e)}var o=n.objectStore(be.DB_STORE_NAME),a=0,u=0,h=e.length;function l(){0==u?t():i()}e.forEach((function(e){var t=o.get(e);t.onsuccess=function(){be.analyzePath(e).exists&&be.unlink(e),be.createDataFile(ve.dirname(e),ve.basename(e),t.result,!0,!0,!0),++a+u==h&&l()},t.onerror=function(){u++,a+u==h&&l()}})),n.onerror=i},r.onerror=i}},xe={mappings:{},DEFAULT_POLLMASK:5,umask:511,calculateAt:function(e,t,i){if("/"===t[0])return t;var s;if(-100===e)s=be.cwd();else{var r=be.getStream(e);if(!r)throw new be.ErrnoError(8);s=r.path}if(0==t.length){if(!i)throw new be.ErrnoError(44);return s}return ve.join2(s,t)},doStat:function(e,t,i){try{var s=e(t)}catch(e){if(e&&e.node&&ve.normalize(t)!==ve.normalize(be.getPath(e.node)))return-54;throw e}return L[i>>>2]=s.dev,L[i+4>>>2]=0,L[i+8>>>2]=s.ino,L[i+12>>>2]=s.mode,L[i+16>>>2]=s.nlink,L[i+20>>>2]=s.uid,L[i+24>>>2]=s.gid,L[i+28>>>2]=s.rdev,L[i+32>>>2]=0,re=[s.size>>>0,(se=s.size,+Math.abs(se)>=1?se>0?(0|Math.min(+Math.floor(se/4294967296),4294967295))>>>0:~~+Math.ceil((se-+(~~se>>>0))/4294967296)>>>0:0)],L[i+40>>>2]=re[0],L[i+44>>>2]=re[1],L[i+48>>>2]=4096,L[i+52>>>2]=s.blocks,L[i+56>>>2]=s.atime.getTime()/1e3|0,L[i+60>>>2]=0,L[i+64>>>2]=s.mtime.getTime()/1e3|0,L[i+68>>>2]=0,L[i+72>>>2]=s.ctime.getTime()/1e3|0,L[i+76>>>2]=0,re=[s.ino>>>0,(se=s.ino,+Math.abs(se)>=1?se>0?(0|Math.min(+Math.floor(se/4294967296),4294967295))>>>0:~~+Math.ceil((se-+(~~se>>>0))/4294967296)>>>0:0)],L[i+80>>>2]=re[0],L[i+84>>>2]=re[1],0},doMsync:function(e,t,i,s,r){var n=S.slice(e,e+i);be.msync(t,n,r,i,s)},doMkdir:function(e,t){return"/"===(e=ve.normalize(e))[e.length-1]&&(e=e.substr(0,e.length-1)),be.mkdir(e,t,0),0},doMknod:function(e,t,i){switch(61440&t){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return be.mknod(e,t,i),0},doReadlink:function(e,t,i){if(i<=0)return-28;var s=be.readlink(e),r=Math.min(i,E(s)),n=R[t+r>>>0];return k(s,t,i+1),R[t+r>>>0]=n,r},doAccess:function(e,t){if(-8&t)return-28;var i;if(!(i=be.lookupPath(e,{follow:!0}).node))return-44;var s="";return 4&t&&(s+="r"),2&t&&(s+="w"),1&t&&(s+="x"),s&&be.nodePermissions(i,s)?-2:0},doDup:function(e,t,i){var s=be.getStream(i);return s&&be.close(s),be.open(e,t,0,i,i).fd},doReadv:function(e,t,i,s){for(var r=0,n=0;n<i;n++){var o=L[t+8*n>>>2],a=L[t+(8*n+4)>>>2],u=be.read(e,R,o,a,s);if(u<0)return-1;if(r+=u,u<a)break}return r},doWritev:function(e,t,i,s){for(var r=0,n=0;n<i;n++){var o=L[t+8*n>>>2],a=L[t+(8*n+4)>>>2],u=be.write(e,R,o,a,s);if(u<0)return-1;r+=u}return r},varargs:void 0,get:function(){return xe.varargs+=4,L[xe.varargs-4>>>2]},getStr:function(e){return D(e)},getStreamFromFD:function(e){var t=be.getStream(e);if(!t)throw new be.ErrnoError(8);return t},get64:function(e,t){return e}},Pe={};function Te(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function we(e){return this.fromWireType(N[e>>>2])}var Me={},Ie={},Ce={};function De(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function Ae(e,t){return e=De(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function ke(e,t){var i=Ae(t,(function(e){this.name=t,this.message=e;var i=new Error(e).stack;void 0!==i&&(this.stack=this.toString()+"\n"+i.replace(/^Error(:[^\n]*)?\n/,""))}));return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},i}var Ee=void 0;function Fe(e){throw new Ee(e)}function Re(e,t,i){function s(t){var s=i(t);s.length!==e.length&&Fe("Mismatched type converter count");for(var r=0;r<e.length;++r)Ge(e[r],s[r])}e.forEach((function(e){Ce[e]=t}));var r=new Array(t.length),n=[],o=0;t.forEach((function(e,t){Ie.hasOwnProperty(e)?r[t]=Ie[e]:(n.push(e),Me.hasOwnProperty(e)||(Me[e]=[]),Me[e].push((function(){r[t]=Ie[e],++o===n.length&&s(r)})))})),0===n.length&&s(r)}var Se={};function Oe(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var Be=void 0;function Le(e){for(var t="",i=e;S[i>>>0];)t+=Be[S[i++>>>0]];return t}var Ne=void 0;function je(e){throw new Ne(e)}function Ge(e,t,i){if(i=i||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var s=t.name;if(e||je('type "'+s+'" must have a positive integer typeid pointer'),Ie.hasOwnProperty(e)){if(i.ignoreDuplicateRegistrations)return;je("Cannot register type '"+s+"' twice")}if(Ie[e]=t,delete Ce[e],Me.hasOwnProperty(e)){var r=Me[e];delete Me[e],r.forEach((function(e){e()}))}}function He(e){if(!(this instanceof tt))return!1;if(!(e instanceof tt))return!1;for(var t=this.$$.ptrType.registeredClass,i=this.$$.ptr,s=e.$$.ptrType.registeredClass,r=e.$$.ptr;t.baseClass;)i=t.upcast(i),t=t.baseClass;for(;s.baseClass;)r=s.upcast(r),s=s.baseClass;return t===s&&i===r}function Ue(e){return{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType}}function Ve(e){je(e.$$.ptrType.registeredClass.name+" instance already deleted")}var ze=!1;function We(e){}function Xe(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function Ye(e){return"undefined"==typeof FinalizationGroup?(Ye=function(e){return e},e):(ze=new FinalizationGroup((function(e){for(var t=e.next();!t.done;t=e.next()){var i=t.value;i.ptr?Xe(i):console.warn("object already deleted: "+i.ptr)}})),We=function(e){ze.unregister(e.$$)},(Ye=function(e){return ze.register(e,e.$$,e.$$),e})(e))}function Ke(){if(this.$$.ptr||Ve(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e=Ye(Object.create(Object.getPrototypeOf(this),{$$:{value:Ue(this.$$)}}));return e.$$.count.value+=1,e.$$.deleteScheduled=!1,e}function Je(){this.$$.ptr||Ve(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&je("Object already scheduled for deletion"),We(this),Xe(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Ze(){return!this.$$.ptr}var Qe=void 0,qe=[];function $e(){for(;qe.length;){var e=qe.pop();e.$$.deleteScheduled=!1,e.delete()}}function et(){return this.$$.ptr||Ve(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&je("Object already scheduled for deletion"),qe.push(this),1===qe.length&&Qe&&Qe($e),this.$$.deleteScheduled=!0,this}function tt(){}var it={};function st(e,t,i){if(void 0===e[t].overloadTable){var s=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||je("Function '"+i+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[s.argCount]=s}}function rt(e,t,i){r.hasOwnProperty(e)?((void 0===i||void 0!==r[e].overloadTable&&void 0!==r[e].overloadTable[i])&&je("Cannot register public name '"+e+"' twice"),st(r,e,e),r.hasOwnProperty(i)&&je("Cannot register multiple overloads of a function with the same number of arguments ("+i+")!"),r[e].overloadTable[i]=t):(r[e]=t,void 0!==i&&(r[e].numArguments=i))}function nt(e,t,i,s,r,n,o,a){this.name=e,this.constructor=t,this.instancePrototype=i,this.rawDestructor=s,this.baseClass=r,this.getActualType=n,this.upcast=o,this.downcast=a,this.pureVirtualFunctions=[]}function ot(e,t,i){for(;t!==i;)t.upcast||je("Expected null or instance of "+i.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function at(e,t){if(null===t)return this.isReference&&je("null is not a valid "+this.name),0;t.$$||je('Cannot pass "'+Nt(t)+'" as a '+this.name),t.$$.ptr||je("Cannot pass deleted object as a pointer of type "+this.name);var i=t.$$.ptrType.registeredClass;return ot(t.$$.ptr,i,this.registeredClass)}function ut(e,t){var i;if(null===t)return this.isReference&&je("null is not a valid "+this.name),this.isSmartPointer?(i=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,i),i):0;t.$$||je('Cannot pass "'+Nt(t)+'" as a '+this.name),t.$$.ptr||je("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&je("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var s=t.$$.ptrType.registeredClass;if(i=ot(t.$$.ptr,s,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&je("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?i=t.$$.smartPtr:je("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:i=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)i=t.$$.smartPtr;else{var r=t.clone();i=this.rawShare(i,Ot((function(){r.delete()}))),null!==e&&e.push(this.rawDestructor,i)}break;default:je("Unsupporting sharing policy")}return i}function ht(e,t){if(null===t)return this.isReference&&je("null is not a valid "+this.name),0;t.$$||je('Cannot pass "'+Nt(t)+'" as a '+this.name),t.$$.ptr||je("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&je("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var i=t.$$.ptrType.registeredClass;return ot(t.$$.ptr,i,this.registeredClass)}function lt(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function ct(e){this.rawDestructor&&this.rawDestructor(e)}function pt(e){null!==e&&e.delete()}function dt(e,t,i){if(t===i)return e;if(void 0===i.baseClass)return null;var s=dt(e,t,i.baseClass);return null===s?null:i.downcast(s)}function ft(){return Object.keys(gt).length}function mt(){var e=[];for(var t in gt)gt.hasOwnProperty(t)&&e.push(gt[t]);return e}function vt(e){Qe=e,qe.length&&Qe&&Qe($e)}var gt={};function _t(e,t){return t=function(e,t){for(void 0===t&&je("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),gt[t]}function yt(e,t){return t.ptrType&&t.ptr||Fe("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!=!!t.smartPtr&&Fe("Both smartPtrType and smartPtr must be specified"),t.count={value:1},Ye(Object.create(e,{$$:{value:t}}))}function bt(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var i=_t(this.registeredClass,t);if(void 0!==i){if(0===i.$$.count.value)return i.$$.ptr=t,i.$$.smartPtr=e,i.clone();var s=i.clone();return this.destructor(e),s}function r(){return this.isSmartPointer?yt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):yt(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var n,o=this.registeredClass.getActualType(t),a=it[o];if(!a)return r.call(this);n=this.isConst?a.constPointerType:a.pointerType;var u=dt(t,this.registeredClass,n.registeredClass);return null===u?r.call(this):this.isSmartPointer?yt(n.registeredClass.instancePrototype,{ptrType:n,ptr:u,smartPtrType:this,smartPtr:e}):yt(n.registeredClass.instancePrototype,{ptrType:n,ptr:u})}function xt(e,t,i,s,r,n,o,a,u,h,l){this.name=e,this.registeredClass=t,this.isReference=i,this.isConst=s,this.isSmartPointer=r,this.pointeeType=n,this.sharingPolicy=o,this.rawGetPointee=a,this.rawConstructor=u,this.rawShare=h,this.rawDestructor=l,r||void 0!==t.baseClass?this.toWireType=ut:s?(this.toWireType=at,this.destructorFunction=null):(this.toWireType=ht,this.destructorFunction=null)}function Pt(e,t,i){r.hasOwnProperty(e)||Fe("Replacing nonexistant public symbol"),void 0!==r[e].overloadTable&&void 0!==i?r[e].overloadTable[i]=t:(r[e]=t,r[e].argCount=i)}function Tt(e,t,i){return e.includes("j")?function(e,t,i){var s=r["dynCall_"+e];return i&&i.length?s.apply(null,[t].concat(i)):s.call(null,t)}(e,t,i):H.get(t).apply(null,i)}function wt(e,t){var i,s,r,n=(e=Le(e)).includes("j")?(i=e,s=t,r=[],function(){r.length=arguments.length;for(var e=0;e<arguments.length;e++)r[e]=arguments[e];return Tt(i,s,r)}):H.get(t);return"function"!=typeof n&&je("unknown function pointer with signature "+e+": "+t),n}var Mt=void 0;function It(e){var t=ui(e),i=Le(t);return ai(t),i}function Ct(e,t){var i=[],s={};throw t.forEach((function e(t){s[t]||Ie[t]||(Ce[t]?Ce[t].forEach(e):(i.push(t),s[t]=!0))})),new Mt(e+": "+i.map(It).join([", "]))}function Dt(e,t){for(var i=[],s=0;s<e;s++)i.push(L[(t>>2)+s>>>0]);return i}function At(e,t,i,s,r){var n=t.length;n<2&&je("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var o=null!==t[1]&&null!==i,a=!1,u=1;u<t.length;++u)if(null!==t[u]&&void 0===t[u].destructorFunction){a=!0;break}var h="void"!==t[0].name,l="",c="";for(u=0;u<n-2;++u)l+=(0!==u?", ":"")+"arg"+u,c+=(0!==u?", ":"")+"arg"+u+"Wired";var p="return function "+De(e)+"("+l+") {\nif (arguments.length !== "+(n-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(n-2)+" args!');\n}\n";a&&(p+="var destructors = [];\n");var d=a?"destructors":"null",f=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],m=[je,s,r,Te,t[0],t[1]];for(o&&(p+="var thisWired = classParam.toWireType("+d+", this);\n"),u=0;u<n-2;++u)p+="var arg"+u+"Wired = argType"+u+".toWireType("+d+", arg"+u+"); // "+t[u+2].name+"\n",f.push("argType"+u),m.push(t[u+2]);if(o&&(c="thisWired"+(c.length>0?", ":"")+c),p+=(h?"var rv = ":"")+"invoker(fn"+(c.length>0?", ":"")+c+");\n",a)p+="runDestructors(destructors);\n";else for(u=o?1:2;u<t.length;++u){var v=1===u?"thisWired":"arg"+(u-2)+"Wired";null!==t[u].destructorFunction&&(p+=v+"_dtor("+v+"); // "+t[u].name+"\n",f.push(v+"_dtor"),m.push(t[u].destructorFunction))}h&&(p+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),p+="}\n",f.push(p);var g=function(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+T(e)+" which is not a function");var i=Ae(e.name||"unknownFunctionName",(function(){}));i.prototype=e.prototype;var s=new i,r=e.apply(s,t);return r instanceof Object?r:s}(Function,f).apply(null,m);return g}var kt=[],Et=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Ft(e){e>4&&0==--Et[e].refcount&&(Et[e]=void 0,kt.push(e))}function Rt(){for(var e=0,t=5;t<Et.length;++t)void 0!==Et[t]&&++e;return e}function St(){for(var e=5;e<Et.length;++e)if(void 0!==Et[e])return Et[e];return null}function Ot(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=kt.length?kt.pop():Et.length;return Et[t]={refcount:1,value:e},t}}function Bt(e,t,i){switch(t){case 0:return function(e){var t=i?R:S;return this.fromWireType(t[e>>>0])};case 1:return function(e){var t=i?O:B;return this.fromWireType(t[e>>>1])};case 2:return function(e){var t=i?L:N;return this.fromWireType(t[e>>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function Lt(e,t){var i=Ie[e];return void 0===i&&je(t+" has unknown type "+It(e)),i}function Nt(e){if(null===e)return"null";var t=T(e);return"object"===t||"array"===t||"function"===t?e.toString():""+e}function jt(e,t){switch(t){case 2:return function(e){return this.fromWireType(j[e>>>2])};case 3:return function(e){return this.fromWireType(G[e>>>3])};default:throw new TypeError("Unknown float type: "+e)}}function Gt(e,t,i){switch(t){case 0:return i?function(e){return R[e>>>0]}:function(e){return S[e>>>0]};case 1:return i?function(e){return O[e>>>1]}:function(e){return B[e>>>1]};case 2:return i?function(e){return L[e>>>2]}:function(e){return N[e>>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function Ht(e){return e||je("Cannot use deleted val. handle = "+e),Et[e].value}var Ut,Vt={};function zt(e){var t=Vt[e];return void 0===t?Le(e):t}function Wt(){return"object"===("undefined"==typeof globalThis?"undefined":T(globalThis))?globalThis:Function("return this")()}function Xt(e){try{return x.grow(e-F.byteLength+65535>>>16),J(x.buffer),1}catch(e){}}Ut=v?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:function(){return performance.now()};var Yt={};function Kt(){if(!Kt.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"===("undefined"==typeof navigator?"undefined":T(navigator))&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:p||"./this.program"};for(var t in Yt)void 0===Yt[t]?delete e[t]:e[t]=Yt[t];var i=[];for(var t in e)i.push(t+"="+e[t]);Kt.strings=i}return Kt.strings}function Jt(e){return e%4==0&&(e%100!=0||e%400==0)}function Zt(e,t){for(var i=0,s=0;s<=t;i+=e[s++]);return i}var Qt=[31,29,31,30,31,30,31,31,30,31,30,31],qt=[31,28,31,30,31,30,31,31,30,31,30,31];function $t(e,t){for(var i=new Date(e.getTime());t>0;){var s=Jt(i.getFullYear()),r=i.getMonth(),n=(s?Qt:qt)[r];if(!(t>n-i.getDate()))return i.setDate(i.getDate()+t),i;t-=n-i.getDate()+1,i.setDate(1),r<11?i.setMonth(r+1):(i.setMonth(0),i.setFullYear(i.getFullYear()+1))}return i}function ei(e,t,i,s){var r=L[s+40>>>2],n={tm_sec:L[s>>>2],tm_min:L[s+4>>>2],tm_hour:L[s+8>>>2],tm_mday:L[s+12>>>2],tm_mon:L[s+16>>>2],tm_year:L[s+20>>>2],tm_wday:L[s+24>>>2],tm_yday:L[s+28>>>2],tm_isdst:L[s+32>>>2],tm_gmtoff:L[s+36>>>2],tm_zone:r?D(r):""},o=D(i),a={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var u in a)o=o.replace(new RegExp(u,"g"),a[u]);var h=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["January","February","March","April","May","June","July","August","September","October","November","December"];function c(e,t,i){for(var s="number"==typeof e?e.toString():e||"";s.length<t;)s=i[0]+s;return s}function p(e,t){return c(e,t,"0")}function d(e,t){function i(e){return e<0?-1:e>0?1:0}var s;return 0===(s=i(e.getFullYear()-t.getFullYear()))&&0===(s=i(e.getMonth()-t.getMonth()))&&(s=i(e.getDate()-t.getDate())),s}function f(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function m(e){var t=$t(new Date(e.tm_year+1900,0,1),e.tm_yday),i=new Date(t.getFullYear(),0,4),s=new Date(t.getFullYear()+1,0,4),r=f(i),n=f(s);return d(r,t)<=0?d(n,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var v={"%a":function(e){return h[e.tm_wday].substring(0,3)},"%A":function(e){return h[e.tm_wday]},"%b":function(e){return l[e.tm_mon].substring(0,3)},"%B":function(e){return l[e.tm_mon]},"%C":function(e){return p((e.tm_year+1900)/100|0,2)},"%d":function(e){return p(e.tm_mday,2)},"%e":function(e){return c(e.tm_mday,2," ")},"%g":function(e){return m(e).toString().substring(2)},"%G":function(e){return m(e)},"%H":function(e){return p(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),p(t,2)},"%j":function(e){return p(e.tm_mday+Zt(Jt(e.tm_year+1900)?Qt:qt,e.tm_mon-1),3)},"%m":function(e){return p(e.tm_mon+1,2)},"%M":function(e){return p(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return p(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=new Date(e.tm_year+1900,0,1),i=0===t.getDay()?t:$t(t,7-t.getDay()),s=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(d(i,s)<0){var r=Zt(Jt(s.getFullYear())?Qt:qt,s.getMonth()-1)-31,n=31-i.getDate()+r+s.getDate();return p(Math.ceil(n/7),2)}return 0===d(i,t)?"01":"00"},"%V":function(e){var t,i=new Date(e.tm_year+1900,0,4),s=new Date(e.tm_year+1901,0,4),r=f(i),n=f(s),o=$t(new Date(e.tm_year+1900,0,1),e.tm_yday);return d(o,r)<0?"53":d(n,o)<=0?"01":(t=r.getFullYear()<e.tm_year+1900?e.tm_yday+32-r.getDate():e.tm_yday+1-r.getDate(),p(Math.ceil(t/7),2))},"%w":function(e){return e.tm_wday},"%W":function(e){var t=new Date(e.tm_year,0,1),i=1===t.getDay()?t:$t(t,0===t.getDay()?1:7-t.getDay()+1),s=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(d(i,s)<0){var r=Zt(Jt(s.getFullYear())?Qt:qt,s.getMonth()-1)-31,n=31-i.getDate()+r+s.getDate();return p(Math.ceil(n/7),2)}return 0===d(i,t)?"01":"00"},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,i=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(i?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var u in v)o.includes(u)&&(o=o.replace(new RegExp(u,"g"),v[u](n)));var g,_,y=ri(o,!1);return y.length>t?0:(g=y,_=e,R.set(g,_>>>0),y.length-1)}var ti=function(e,t,i,s){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=be.nextInode++,this.name=t,this.mode=i,this.node_ops={},this.stream_ops={},this.rdev=s},ii=365,si=146;function ri(e,t,i){var s=i>0?i:E(e)+1,r=new Array(s),n=A(e,r,0,r.length);return t&&(r.length=n),r}Object.defineProperties(ti.prototype,{read:{get:function(){return(this.mode&ii)===ii},set:function(e){e?this.mode|=ii:this.mode&=-366}},write:{get:function(){return(this.mode&si)===si},set:function(e){e?this.mode|=si:this.mode&=-147}},isFolder:{get:function(){return be.isDir(this.mode)}},isDevice:{get:function(){return be.isChrdev(this.mode)}}}),be.FSNode=ti,be.staticInit(),r.FS_createPath=be.createPath,r.FS_createDataFile=be.createDataFile,r.FS_createPreloadedFile=be.createPreloadedFile,r.FS_createLazyFile=be.createLazyFile,r.FS_createDevice=be.createDevice,r.FS_unlink=be.unlink,Ee=r.InternalError=ke(Error,"InternalError"),function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);Be=e}(),Ne=r.BindingError=ke(Error,"BindingError"),tt.prototype.isAliasOf=He,tt.prototype.clone=Ke,tt.prototype.delete=Je,tt.prototype.isDeleted=Ze,tt.prototype.deleteLater=et,xt.prototype.getPointee=lt,xt.prototype.destructor=ct,xt.prototype.argPackAdvance=8,xt.prototype.readValueFromPointer=we,xt.prototype.deleteObject=pt,xt.prototype.fromWireType=bt,r.getInheritedInstanceCount=ft,r.getLiveInheritedInstances=mt,r.flushPendingDeletes=$e,r.setDelayFunction=vt,Mt=r.UnboundTypeError=ke(Error,"UnboundTypeError"),r.count_emval_handles=Rt,r.get_first_emval=St;var ni={y:function(e,t,i,s){he("Assertion failed: "+D(e)+", at: "+[t?D(t):"unknown filename",i,s?D(s):"unknown function"])},x:function(e){return oi(e+16)+16},w:function(e,t,i){throw new fe(e).init(t,i),e},A:function(e,t,i){xe.varargs=i;try{var s=xe.getStreamFromFD(e);switch(t){case 0:return(r=xe.get())<0?-28:be.open(s.path,s.flags,0,r).fd;case 1:case 2:case 13:case 14:return 0;case 3:return s.flags;case 4:var r=xe.get();return s.flags|=r,0;case 12:return r=xe.get(),O[r+0>>>1]=2,0;case 16:case 8:default:return-28;case 9:return me(28),-1}}catch(e){return void 0!==be&&e instanceof be.ErrnoError||he(e),-e.errno}},O:function(e,t,i){xe.varargs=i;try{var s=xe.getStreamFromFD(e);switch(t){case 21509:case 21505:case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:case 21523:case 21524:return s.tty?0:-59;case 21519:if(!s.tty)return-59;var r=xe.get();return L[r>>>2]=0,0;case 21520:return s.tty?-28:-59;case 21531:return r=xe.get(),be.ioctl(s,t,r);default:he("bad ioctl syscall "+t)}}catch(e){return void 0!==be&&e instanceof be.ErrnoError||he(e),-e.errno}},P:function(e,t,i){xe.varargs=i;try{var s=xe.getStr(e),r=i?xe.get():0;return be.open(s,t,r).fd}catch(e){return void 0!==be&&e instanceof be.ErrnoError||he(e),-e.errno}},Z:function(e){var t=Pe[e];delete Pe[e];var i=t.elements,s=i.length,r=i.map((function(e){return e.getterReturnType})).concat(i.map((function(e){return e.setterArgumentType}))),n=t.rawConstructor,o=t.rawDestructor;Re([e],r,(function(e){return i.forEach((function(t,i){var r=e[i],n=t.getter,o=t.getterContext,a=e[i+s],u=t.setter,h=t.setterContext;t.read=function(e){return r.fromWireType(n(o,e))},t.write=function(e,t){var i=[];u(h,e,a.toWireType(i,t)),Te(i)}})),[{name:t.name,fromWireType:function(e){for(var t=new Array(s),r=0;r<s;++r)t[r]=i[r].read(e);return o(e),t},toWireType:function(e,r){if(s!==r.length)throw new TypeError("Incorrect number of tuple elements for "+t.name+": expected="+s+", actual="+r.length);for(var a=n(),u=0;u<s;++u)i[u].write(a,r[u]);return null!==e&&e.push(o,a),a},argPackAdvance:8,readValueFromPointer:we,destructorFunction:o}]}))},o:function(e){var t=Se[e];delete Se[e];var i=t.rawConstructor,s=t.rawDestructor,r=t.fields;Re([e],r.map((function(e){return e.getterReturnType})).concat(r.map((function(e){return e.setterArgumentType}))),(function(e){var n={};return r.forEach((function(t,i){var s=t.fieldName,o=e[i],a=t.getter,u=t.getterContext,h=e[i+r.length],l=t.setter,c=t.setterContext;n[s]={read:function(e){return o.fromWireType(a(u,e))},write:function(e,t){var i=[];l(c,e,h.toWireType(i,t)),Te(i)}}})),[{name:t.name,fromWireType:function(e){var t={};for(var i in n)t[i]=n[i].read(e);return s(e),t},toWireType:function(e,t){for(var r in n)if(!(r in t))throw new TypeError('Missing field:  "'+r+'"');var o=i();for(r in n)n[r].write(o,t[r]);return null!==e&&e.push(s,o),o},argPackAdvance:8,readValueFromPointer:we,destructorFunction:s}]}))},J:function(e,t,i,s,r){},W:function(e,t,i,s,r){var n=Oe(i);Ge(e,{name:t=Le(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?s:r},argPackAdvance:8,readValueFromPointer:function(e){var s;if(1===i)s=R;else if(2===i)s=O;else{if(4!==i)throw new TypeError("Unknown boolean type size: "+t);s=L}return this.fromWireType(s[e>>>n])},destructorFunction:null})},r:function(e,t,i,s,r,n,o,a,u,h,l,c,p){l=Le(l),n=wt(r,n),a&&(a=wt(o,a)),h&&(h=wt(u,h)),p=wt(c,p);var d=De(l);rt(d,(function(){Ct("Cannot construct "+l+" due to unbound types",[s])})),Re([e,t,i],s?[s]:[],(function(t){var i,r;t=t[0],r=s?(i=t.registeredClass).instancePrototype:tt.prototype;var o=Ae(d,(function(){if(Object.getPrototypeOf(this)!==u)throw new Ne("Use 'new' to construct "+l);if(void 0===c.constructor_body)throw new Ne(l+" has no accessible constructor");var e=c.constructor_body[arguments.length];if(void 0===e)throw new Ne("Tried to invoke ctor of "+l+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(c.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),u=Object.create(r,{constructor:{value:o}});o.prototype=u;var c=new nt(l,o,u,p,i,n,a,h),f=new xt(l,c,!0,!1,!1),m=new xt(l+"*",c,!1,!1,!1),v=new xt(l+" const*",c,!1,!0,!1);return it[e]={pointerType:m,constPointerType:v},Pt(d,o),[f,m,v]}))},q:function(e,t,i,s,r,n){M(t>0);var o=Dt(t,i);r=wt(s,r);var a=[n],u=[];Re([],[e],(function(e){var i="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new Ne("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=function(){Ct("Cannot construct "+e.name+" due to unbound types",o)},Re([],o,(function(s){return e.registeredClass.constructor_body[t-1]=function(){arguments.length!==t-1&&je(i+" called with "+arguments.length+" arguments, expected "+(t-1)),u.length=0,a.length=t;for(var e=1;e<t;++e)a[e]=s[e].toWireType(u,arguments[e-1]);var n=r.apply(null,a);return Te(u),s[0].fromWireType(n)},[]})),[]}))},b:function(e,t,i,s,r,n,o,a){var u=Dt(i,s);t=Le(t),n=wt(r,n),Re([],[e],(function(e){var s=(e=e[0]).name+"."+t;function r(){Ct("Cannot call "+s+" due to unbound types",u)}t.startsWith("@@")&&(t=Symbol[t.substring(2)]),a&&e.registeredClass.pureVirtualFunctions.push(t);var h=e.registeredClass.instancePrototype,l=h[t];return void 0===l||void 0===l.overloadTable&&l.className!==e.name&&l.argCount===i-2?(r.argCount=i-2,r.className=e.name,h[t]=r):(st(h,t,s),h[t].overloadTable[i-2]=r),Re([],u,(function(r){var a=At(s,r,e,n,o);return void 0===h[t].overloadTable?(a.argCount=i-2,h[t]=a):h[t].overloadTable[i-2]=a,[]})),[]}))},V:function(e,t){Ge(e,{name:t=Le(t),fromWireType:function(e){var t=Et[e].value;return Ft(e),t},toWireType:function(e,t){return Ot(t)},argPackAdvance:8,readValueFromPointer:we,destructorFunction:null})},Y:function(e,t,i,s){var r=Oe(i);function n(){}t=Le(t),n.values={},Ge(e,{name:t,constructor:n,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:Bt(t,r,s),destructorFunction:null}),rt(t,n)},t:function(e,t,i){var s=Lt(e,"enum");t=Le(t);var r=s.constructor,n=Object.create(s.constructor.prototype,{value:{value:i},constructor:{value:Ae(s.name+"_"+t,(function(){}))}});r.values[i]=n,r[t]=n},D:function(e,t,i){var s=Oe(i);Ge(e,{name:t=Le(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+Nt(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:jt(t,s),destructorFunction:null})},e:function(e,t,i,s,r,n){var o=Dt(t,i);e=Le(e),r=wt(s,r),rt(e,(function(){Ct("Cannot call "+e+" due to unbound types",o)}),t-1),Re([],o,(function(i){var s=[i[0],null].concat(i.slice(1));return Pt(e,At(e,s,null,r,n),t-1),[]}))},n:function(e,t,i,s,r){t=Le(t),-1===r&&(r=4294967295);var n=Oe(i),o=function(e){return e};if(0===s){var a=32-8*i;o=function(e){return e<<a>>>a}}var u=t.includes("unsigned");Ge(e,{name:t,fromWireType:o,toWireType:function(e,i){if("number"!=typeof i&&"boolean"!=typeof i)throw new TypeError('Cannot convert "'+Nt(i)+'" to '+this.name);if(i<s||i>r)throw new TypeError('Passing a number "'+Nt(i)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+s+", "+r+"]!");return u?i>>>0:0|i},argPackAdvance:8,readValueFromPointer:Gt(t,n,0!==s),destructorFunction:null})},j:function(e,t,i){var s=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function r(e){var t=N,i=t[(e>>=2)>>>0],r=t[e+1>>>0];return new s(F,r,i)}Ge(e,{name:i=Le(i),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{ignoreDuplicateRegistrations:!0})},E:function(e,t){var i="std::string"===(t=Le(t));Ge(e,{name:t,fromWireType:function(e){var t,s=N[e>>>2];if(i)for(var r=e+4,n=0;n<=s;++n){var o=e+4+n;if(n==s||0==S[o>>>0]){var a=D(r,o-r);void 0===t?t=a:(t+=String.fromCharCode(0),t+=a),r=o+1}}else{var u=new Array(s);for(n=0;n<s;++n)u[n]=String.fromCharCode(S[e+4+n>>>0]);t=u.join("")}return ai(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var s="string"==typeof t;s||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||je("Cannot pass non-string to std::string");var r=(i&&s?function(){return E(t)}:function(){return t.length})(),n=oi(4+r+1);if(N[(n>>>=0)>>>2]=r,i&&s)k(t,n+4,r+1);else if(s)for(var o=0;o<r;++o){var a=t.charCodeAt(o);a>255&&(ai(n),je("String has UTF-16 code units that do not fit in 8 bits")),S[n+4+o>>>0]=a}else for(o=0;o<r;++o)S[n+4+o>>>0]=t[o];return null!==e&&e.push(ai,n),n},argPackAdvance:8,readValueFromPointer:we,destructorFunction:function(e){ai(e)}})},v:function(e,t,i){var s,r,n,o,a;i=Le(i),2===t?(s=V,r=z,o=W,n=function(){return B},a=1):4===t&&(s=X,r=Y,o=K,n=function(){return N},a=2),Ge(e,{name:i,fromWireType:function(e){for(var i,r=N[e>>>2],o=n(),u=e+4,h=0;h<=r;++h){var l=e+4+h*t;if(h==r||0==o[l>>>a]){var c=s(u,l-u);void 0===i?i=c:(i+=String.fromCharCode(0),i+=c),u=l+t}}return ai(e),i},toWireType:function(e,s){"string"!=typeof s&&je("Cannot pass non-string to C++ string type "+i);var n=o(s),u=oi(4+n+t);return N[(u>>>=0)>>>2]=n>>a,r(s,u+4,n+t),null!==e&&e.push(ai,u),u},argPackAdvance:8,readValueFromPointer:we,destructorFunction:function(e){ai(e)}})},_:function(e,t,i,s,r,n){Pe[e]={name:Le(t),rawConstructor:wt(i,s),rawDestructor:wt(r,n),elements:[]}},g:function(e,t,i,s,r,n,o,a,u){Pe[e].elements.push({getterReturnType:t,getter:wt(i,s),getterContext:r,setterArgumentType:n,setter:wt(o,a),setterContext:u})},p:function(e,t,i,s,r,n){Se[e]={name:Le(t),rawConstructor:wt(i,s),rawDestructor:wt(r,n),fields:[]}},d:function(e,t,i,s,r,n,o,a,u,h){Se[e].fields.push({fieldName:Le(t),getterReturnType:i,getter:wt(s,r),getterContext:n,setterArgumentType:o,setter:wt(a,u),setterContext:h})},X:function(e,t){Ge(e,{isVoid:!0,name:t=Le(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},l:function(e,t,i){e=Ht(e),t=Lt(t,"emval::as");var s=[],r=Ot(s);return L[i>>>2]=r,t.toWireType(s,e)},F:function(e,t,i,s){e=Ht(e);for(var r=function(e,t){for(var i=new Array(e),s=0;s<e;++s)i[s]=Lt(L[(t>>2)+s>>>0],"parameter "+s);return i}(t,i),n=new Array(t),o=0;o<t;++o){var a=r[o];n[o]=a.readValueFromPointer(s),s+=a.argPackAdvance}return Ot(e.apply(void 0,n))},a:Ft,H:function(e){return 0===e?Ot(Wt()):(e=zt(e),Ot(Wt()[e]))},m:function(e,t){return Ot((e=Ht(e))[t=Ht(t)])},i:function(e){e>4&&(Et[e].refcount+=1)},L:function(e,t){return(e=Ht(e))instanceof(t=Ht(t))},G:function(e){return"number"==typeof(e=Ht(e))},z:function(){return Ot([])},f:function(e){return Ot(zt(e))},s:function(){return Ot({})},k:function(e){Te(Et[e].value),Ft(e)},h:function(e,t,i){e=Ht(e),t=Ht(t),i=Ht(i),e[t]=i},c:function(e,t){return Ot((e=Lt(e,"_emval_take_value")).readValueFromPointer(t))},C:function(){he()},N:function(e,t){var i;if(0===e)i=Date.now();else{if(1!==e&&4!==e)return me(28),-1;i=Ut()}return L[t>>>2]=i/1e3|0,L[t+4>>>2]=i%1e3*1e3*1e3|0,0},M:function(e,t,i){S.copyWithin(e>>>0,t>>>0,t+i>>>0)},u:function(e){var t,i,s=S.length,r=4294901760;if((e>>>=0)>r)return!1;for(var n=1;n<=4;n*=2){var o=s*(1+.2/n);if(o=Math.min(o,e+100663296),Xt(Math.min(r,((t=Math.max(e,o))%(i=65536)>0&&(t+=i-t%i),t))))return!0}return!1},R:function(e,t){try{var i=0;return Kt().forEach((function(s,r){var n=t+i;L[e+4*r>>>2]=n,function(e,t,i){for(var s=0;s<e.length;++s)R[t++>>>0]=e.charCodeAt(s);i||(R[t>>>0]=0)}(s,n),i+=s.length+1})),0}catch(e){return void 0!==be&&e instanceof be.ErrnoError||he(e),e.errno}},S:function(e,t){try{var i=Kt();L[e>>>2]=i.length;var s=0;return i.forEach((function(e){s+=e.length+1})),L[t>>>2]=s,0}catch(e){return void 0!==be&&e instanceof be.ErrnoError||he(e),e.errno}},B:function(e){try{var t=xe.getStreamFromFD(e);return be.close(t),0}catch(e){return void 0!==be&&e instanceof be.ErrnoError||he(e),e.errno}},U:function(e,t,i,s){try{var r=xe.getStreamFromFD(e),n=xe.doReadv(r,t,i);return L[s>>>2]=n,0}catch(e){return void 0!==be&&e instanceof be.ErrnoError||he(e),e.errno}},I:function(e,t,i,s,r){try{var n=xe.getStreamFromFD(e),o=4294967296*i+(t>>>0),a=9007199254740992;return o<=-a||o>=a?-61:(be.llseek(n,o,s),re=[n.position>>>0,(se=n.position,+Math.abs(se)>=1?se>0?(0|Math.min(+Math.floor(se/4294967296),4294967295))>>>0:~~+Math.ceil((se-+(~~se>>>0))/4294967296)>>>0:0)],L[r>>>2]=re[0],L[r+4>>>2]=re[1],n.getdents&&0===o&&0===s&&(n.getdents=null),0)}catch(e){return void 0!==be&&e instanceof be.ErrnoError||he(e),e.errno}},T:function(e,t,i,s){try{var r=xe.getStreamFromFD(e),n=xe.doWritev(r,t,i);return L[s>>>2]=n,0}catch(e){return void 0!==be&&e instanceof be.ErrnoError||he(e),e.errno}},K:function(e){},Q:function(e,t,i,s){return ei(e,t,i,s)}};!function(){var e={a:ni};function t(e,t){var i,s=e.exports;r.asm=s,J((x=r.asm.$).buffer),H=r.asm.ha,i=r.asm.aa,Q.unshift(i),ue()}function i(e){t(e.instance)}function n(t){return function(){if(!_&&(f||m)){if("function"==typeof fetch&&!ce(te))return fetch(te,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+te+"'";return e.arrayBuffer()})).catch((function(){return pe(te)}));if(u)return new Promise((function(e,t){u(te,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return pe(te)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){b("failed to asynchronously prepare wasm: "+e),he(e)}))}if(ae(),r.instantiateWasm)try{return r.instantiateWasm(e,t)}catch(e){return b("Module.instantiateWasm callback failed with error: "+e),!1}(_||"function"!=typeof WebAssembly.instantiateStreaming||le(te)||ce(te)||"function"!=typeof fetch?n(i):fetch(te,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(i,(function(e){return b("wasm streaming compile failed: "+e),b("falling back to ArrayBuffer instantiation"),n(i)}))}))).catch(s)}(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.aa).apply(null,arguments)},r._main=function(){return(r._main=r.asm.ba).apply(null,arguments)};var oi=r._malloc=function(){return(oi=r._malloc=r.asm.ca).apply(null,arguments)},ai=r._free=function(){return(ai=r._free=r.asm.da).apply(null,arguments)},ui=r.___getTypeName=function(){return(ui=r.___getTypeName=r.asm.ea).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.fa).apply(null,arguments)};var hi,li=r.___errno_location=function(){return(li=r.___errno_location=r.asm.ga).apply(null,arguments)};function ci(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function pi(e){var t,i=r._main;try{t=i(0,0),ee()||(r.onExit&&r.onExit(t),w=!0),d(t,new ci(t))}catch(e){if(e instanceof ci||"unwind"==e)return;var s=e;e&&"object"===T(e)&&e.stack&&(s=[e,e.stack]),b("exception thrown: "+s),d(1,e)}}function di(e){function i(){hi||(hi=!0,r.calledRun=!0,w||(r.noFSInit||be.init.initialized||be.init(),be.ignorePermissions=!1,de(Q),de(q),t(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),fi&&pi(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)e=r.postRun.shift(),$.unshift(e);var e;de($)}()))}ne>0||(function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)e=r.preRun.shift(),Z.unshift(e);var e;de(Z)}(),ne>0||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),i()}),1)):i()))}if(r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.ia).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.ja).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.ka).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.la).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.ma).apply(null,arguments)},r.addRunDependency=ae,r.removeRunDependency=ue,r.FS_createPath=be.createPath,r.FS_createDataFile=be.createDataFile,r.FS_createPreloadedFile=be.createPreloadedFile,r.FS_createLazyFile=be.createLazyFile,r.FS_createDevice=be.createDevice,r.FS_unlink=be.unlink,r.FS=be,oe=function e(){hi||di(),hi||(oe=e)},r.run=di,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();var fi=!0;return r.noInitialRun&&(fi=!1),di(),e.ready});"object"===T(e)&&"object"===T(t)?t.exports=s:"function"==typeof define&&define.amd?define([],(function(){return s})):"object"===T(e)&&(e.WebIFCWasm=s)}}),$P=[4288193352,1634111441,177149247,2056796094,3087945054,325726236,1674181508,277319702,753842376,2906023776,4196446775,32344328,644574406,963979645,4031249490,3299480353,2979338954,1095909175,3124254112,2938176219,635142910,3758799889,1051757585,4217484030,3999819293,3902619387,3296154744,1677625105,639361253,843113511,905975707,3221913625,3571504051,2272882330,25142252,4136498852,3640358203,1973544240,3495092785,4074379575,3426335179,1335981549,1052013943,1062813311,1945004755,3040386961,3041715199,395920057,3242481149,342316401,3518393246,1360408905,1904799276,862014818,3310460725,264262732,402227799,1003880860,1758889154,4123344466,1623761950,1658829314,2814081492,3747195512,484807127,1209101575,2853485674,24185140,1310830890,3415622556,647756555,2827207264,2143335405,1287392070,819412036,1426591983,2058353004,4278956645,182646315,2188021234,3132237377,987401354,707683696,2223149337,3508470533,900683007,263784265,1509553395,3493046030,3009204131,3319311131,2068733104,4175244083,2176052936,76236018,629592764,1154579445,377706215,1437502449,1073191201,1911478936,2474470126,3588315303,3079942009,3694346114,1687234759,310824031,3612865200,3171933400,1156407060,3740093272,1946335990,3651124850,738039164,2295281155,3219374653,90941305,2262370178,3024970846,3283111854,4021432810,979691226,3027567501,2320036040,2016517767,3053780830,4086658281,1329646415,4097777520,1529196076,3127900445,3027962421,3420628829,3856911033,1999602285,1412071761,2706606064,463610769,1404847402,331165859,4252922144,682877961,3544373492,1179482911,1004757350,4243806635,214636428,2445595289,2757150158,3136571912,1807405624,530289379,1621171031,2082059205,734778138,1235345126,3689010777,3657597509,1975003073,3979015343,2218152070,603775116,3101698114,1162798199,413509423,812556717,3824725483,2347447852,3663046924,3825984169,1620046519,3026737570,630975310,4292641817,4207607924,1530820697,2391383451,2769231204,926996030,2391406946,4156078855,3512223829,4237592921,3304561284,486154966],eT={3821786052:function(e){return tT.FromTape(e.ID,e.type,e.arguments)},2296667514:function(e){return iT.FromTape(e.ID,e.type,e.arguments)},3630933823:function(e){return sT.FromTape(e.ID,e.type,e.arguments)},4288193352:function(e){return rT.FromTape(e.ID,e.type,e.arguments)},2874132201:function(e){return nT.FromTape(e.ID,e.type,e.arguments)},618182010:function(e){return oT.FromTape(e.ID,e.type,e.arguments)},1635779807:function(e){return aT.FromTape(e.ID,e.type,e.arguments)},2603310189:function(e){return uT.FromTape(e.ID,e.type,e.arguments)},3406155212:function(e){return hT.FromTape(e.ID,e.type,e.arguments)},1634111441:function(e){return lT.FromTape(e.ID,e.type,e.arguments)},177149247:function(e){return cT.FromTape(e.ID,e.type,e.arguments)},1411407467:function(e){return pT.FromTape(e.ID,e.type,e.arguments)},3352864051:function(e){return dT.FromTape(e.ID,e.type,e.arguments)},2056796094:function(e){return fT.FromTape(e.ID,e.type,e.arguments)},1871374353:function(e){return mT.FromTape(e.ID,e.type,e.arguments)},3087945054:function(e){return vT.FromTape(e.ID,e.type,e.arguments)},3001207471:function(e){return gT.FromTape(e.ID,e.type,e.arguments)},325726236:function(e){return _T.FromTape(e.ID,e.type,e.arguments)},749761778:function(e){return yT.FromTape(e.ID,e.type,e.arguments)},3199563722:function(e){return bT.FromTape(e.ID,e.type,e.arguments)},2483840362:function(e){return xT.FromTape(e.ID,e.type,e.arguments)},3379348081:function(e){return PT.FromTape(e.ID,e.type,e.arguments)},3239324667:function(e){return TT.FromTape(e.ID,e.type,e.arguments)},4263986512:function(e){return wT.FromTape(e.ID,e.type,e.arguments)},53199957:function(e){return MT.FromTape(e.ID,e.type,e.arguments)},2029264950:function(e){return IT.FromTape(e.ID,e.type,e.arguments)},3512275521:function(e){return CT.FromTape(e.ID,e.type,e.arguments)},1674181508:function(e){return DT.FromTape(e.ID,e.type,e.arguments)},669184980:function(e){return AT.FromTape(e.ID,e.type,e.arguments)},639542469:function(e){return kT.FromTape(e.ID,e.type,e.arguments)},411424972:function(e){return ET.FromTape(e.ID,e.type,e.arguments)},130549933:function(e){return FT.FromTape(e.ID,e.type,e.arguments)},3869604511:function(e){return RT.FromTape(e.ID,e.type,e.arguments)},3798115385:function(e){return ST.FromTape(e.ID,e.type,e.arguments)},1310608509:function(e){return OT.FromTape(e.ID,e.type,e.arguments)},2705031697:function(e){return BT.FromTape(e.ID,e.type,e.arguments)},3460190687:function(e){return LT.FromTape(e.ID,e.type,e.arguments)},3207858831:function(e){return NT.FromTape(e.ID,e.type,e.arguments)},277319702:function(e){return jT.FromTape(e.ID,e.type,e.arguments)},1532957894:function(e){return GT.FromTape(e.ID,e.type,e.arguments)},4261334040:function(e){return HT.FromTape(e.ID,e.type,e.arguments)},3125803723:function(e){return UT.FromTape(e.ID,e.type,e.arguments)},2740243338:function(e){return VT.FromTape(e.ID,e.type,e.arguments)},1967976161:function(e){return zT.FromTape(e.ID,e.type,e.arguments)},2461110595:function(e){return WT.FromTape(e.ID,e.type,e.arguments)},2887950389:function(e){return XT.FromTape(e.ID,e.type,e.arguments)},167062518:function(e){return YT.FromTape(e.ID,e.type,e.arguments)},753842376:function(e){return KT.FromTape(e.ID,e.type,e.arguments)},2906023776:function(e){return JT.FromTape(e.ID,e.type,e.arguments)},819618141:function(e){return ZT.FromTape(e.ID,e.type,e.arguments)},4196446775:function(e){return QT.FromTape(e.ID,e.type,e.arguments)},3649138523:function(e){return qT.FromTape(e.ID,e.type,e.arguments)},616511568:function(e){return $T.FromTape(e.ID,e.type,e.arguments)},1334484129:function(e){return ew.FromTape(e.ID,e.type,e.arguments)},32344328:function(e){return tw.FromTape(e.ID,e.type,e.arguments)},231477066:function(e){return iw.FromTape(e.ID,e.type,e.arguments)},3649129432:function(e){return sw.FromTape(e.ID,e.type,e.arguments)},2736907675:function(e){return rw.FromTape(e.ID,e.type,e.arguments)},4037036970:function(e){return nw.FromTape(e.ID,e.type,e.arguments)},1136057603:function(e){return ow.FromTape(e.ID,e.type,e.arguments)},1560379544:function(e){return aw.FromTape(e.ID,e.type,e.arguments)},3367102660:function(e){return uw.FromTape(e.ID,e.type,e.arguments)},1387855156:function(e){return hw.FromTape(e.ID,e.type,e.arguments)},2069777674:function(e){return lw.FromTape(e.ID,e.type,e.arguments)},1260505505:function(e){return cw.FromTape(e.ID,e.type,e.arguments)},4182860854:function(e){return pw.FromTape(e.ID,e.type,e.arguments)},2581212453:function(e){return dw.FromTape(e.ID,e.type,e.arguments)},2713105998:function(e){return fw.FromTape(e.ID,e.type,e.arguments)},644574406:function(e){return mw.FromTape(e.ID,e.type,e.arguments)},963979645:function(e){return vw.FromTape(e.ID,e.type,e.arguments)},4031249490:function(e){return gw.FromTape(e.ID,e.type,e.arguments)},3299480353:function(e){return _w.FromTape(e.ID,e.type,e.arguments)},2979338954:function(e){return yw.FromTape(e.ID,e.type,e.arguments)},39481116:function(e){return bw.FromTape(e.ID,e.type,e.arguments)},1095909175:function(e){return xw.FromTape(e.ID,e.type,e.arguments)},1909888760:function(e){return Pw.FromTape(e.ID,e.type,e.arguments)},1950629157:function(e){return Tw.FromTape(e.ID,e.type,e.arguments)},3124254112:function(e){return ww.FromTape(e.ID,e.type,e.arguments)},1177604601:function(e){return Mw.FromTape(e.ID,e.type,e.arguments)},2938176219:function(e){return Iw.FromTape(e.ID,e.type,e.arguments)},2188180465:function(e){return Cw.FromTape(e.ID,e.type,e.arguments)},2898889636:function(e){return Dw.FromTape(e.ID,e.type,e.arguments)},635142910:function(e){return Aw.FromTape(e.ID,e.type,e.arguments)},395041908:function(e){return kw.FromTape(e.ID,e.type,e.arguments)},3758799889:function(e){return Ew.FromTape(e.ID,e.type,e.arguments)},3293546465:function(e){return Fw.FromTape(e.ID,e.type,e.arguments)},1051757585:function(e){return Rw.FromTape(e.ID,e.type,e.arguments)},2674252688:function(e){return Sw.FromTape(e.ID,e.type,e.arguments)},4217484030:function(e){return Ow.FromTape(e.ID,e.type,e.arguments)},1285652485:function(e){return Bw.FromTape(e.ID,e.type,e.arguments)},3999819293:function(e){return Lw.FromTape(e.ID,e.type,e.arguments)},3203706013:function(e){return Nw.FromTape(e.ID,e.type,e.arguments)},1123145078:function(e){return jw.FromTape(e.ID,e.type,e.arguments)},574549367:function(e){return Gw.FromTape(e.ID,e.type,e.arguments)},1675464909:function(e){return Hw.FromTape(e.ID,e.type,e.arguments)},2059837836:function(e){return Uw.FromTape(e.ID,e.type,e.arguments)},59481748:function(e){return Vw.FromTape(e.ID,e.type,e.arguments)},3749851601:function(e){return zw.FromTape(e.ID,e.type,e.arguments)},3486308946:function(e){return Ww.FromTape(e.ID,e.type,e.arguments)},3331915920:function(e){return Xw.FromTape(e.ID,e.type,e.arguments)},1416205885:function(e){return Yw.FromTape(e.ID,e.type,e.arguments)},3150382593:function(e){return Kw.FromTape(e.ID,e.type,e.arguments)},3902619387:function(e){return Jw.FromTape(e.ID,e.type,e.arguments)},2951183804:function(e){return Zw.FromTape(e.ID,e.type,e.arguments)},3296154744:function(e){return Qw.FromTape(e.ID,e.type,e.arguments)},2197970202:function(e){return qw.FromTape(e.ID,e.type,e.arguments)},2611217952:function(e){return $w.FromTape(e.ID,e.type,e.arguments)},2937912522:function(e){return eM.FromTape(e.ID,e.type,e.arguments)},1383045692:function(e){return tM.FromTape(e.ID,e.type,e.arguments)},1062206242:function(e){return iM.FromTape(e.ID,e.type,e.arguments)},1677625105:function(e){return sM.FromTape(e.ID,e.type,e.arguments)},3893394355:function(e){return rM.FromTape(e.ID,e.type,e.arguments)},747523909:function(e){return nM.FromTape(e.ID,e.type,e.arguments)},647927063:function(e){return oM.FromTape(e.ID,e.type,e.arguments)},2205249479:function(e){return aM.FromTape(e.ID,e.type,e.arguments)},639361253:function(e){return uM.FromTape(e.ID,e.type,e.arguments)},2301859152:function(e){return hM.FromTape(e.ID,e.type,e.arguments)},776857604:function(e){return lM.FromTape(e.ID,e.type,e.arguments)},3285139300:function(e){return cM.FromTape(e.ID,e.type,e.arguments)},3264961684:function(e){return pM.FromTape(e.ID,e.type,e.arguments)},843113511:function(e){return dM.FromTape(e.ID,e.type,e.arguments)},905975707:function(e){return fM.FromTape(e.ID,e.type,e.arguments)},300633059:function(e){return mM.FromTape(e.ID,e.type,e.arguments)},3221913625:function(e){return vM.FromTape(e.ID,e.type,e.arguments)},400855858:function(e){return gM.FromTape(e.ID,e.type,e.arguments)},2542286263:function(e){return _M.FromTape(e.ID,e.type,e.arguments)},3875453745:function(e){return yM.FromTape(e.ID,e.type,e.arguments)},3732776249:function(e){return bM.FromTape(e.ID,e.type,e.arguments)},15328376:function(e){return xM.FromTape(e.ID,e.type,e.arguments)},2485617015:function(e){return PM.FromTape(e.ID,e.type,e.arguments)},1485152156:function(e){return TM.FromTape(e.ID,e.type,e.arguments)},3571504051:function(e){return wM.FromTape(e.ID,e.type,e.arguments)},3850581409:function(e){return MM.FromTape(e.ID,e.type,e.arguments)},2272882330:function(e){return IM.FromTape(e.ID,e.type,e.arguments)},2816379211:function(e){return CM.FromTape(e.ID,e.type,e.arguments)},2510884976:function(e){return DM.FromTape(e.ID,e.type,e.arguments)},370225590:function(e){return AM.FromTape(e.ID,e.type,e.arguments)},1981873012:function(e){return kM.FromTape(e.ID,e.type,e.arguments)},2859738748:function(e){return EM.FromTape(e.ID,e.type,e.arguments)},45288368:function(e){return FM.FromTape(e.ID,e.type,e.arguments)},2614616156:function(e){return RM.FromTape(e.ID,e.type,e.arguments)},2732653382:function(e){return SM.FromTape(e.ID,e.type,e.arguments)},775493141:function(e){return OM.FromTape(e.ID,e.type,e.arguments)},1959218052:function(e){return BM.FromTape(e.ID,e.type,e.arguments)},3898045240:function(e){return LM.FromTape(e.ID,e.type,e.arguments)},2185764099:function(e){return NM.FromTape(e.ID,e.type,e.arguments)},1060000209:function(e){return jM.FromTape(e.ID,e.type,e.arguments)},4105962743:function(e){return GM.FromTape(e.ID,e.type,e.arguments)},488727124:function(e){return HM.FromTape(e.ID,e.type,e.arguments)},1525564444:function(e){return UM.FromTape(e.ID,e.type,e.arguments)},2559216714:function(e){return VM.FromTape(e.ID,e.type,e.arguments)},2574617495:function(e){return zM.FromTape(e.ID,e.type,e.arguments)},3419103109:function(e){return WM.FromTape(e.ID,e.type,e.arguments)},3050246964:function(e){return XM.FromTape(e.ID,e.type,e.arguments)},3293443760:function(e){return YM.FromTape(e.ID,e.type,e.arguments)},25142252:function(e){return KM.FromTape(e.ID,e.type,e.arguments)},578613899:function(e){return JM.FromTape(e.ID,e.type,e.arguments)},2889183280:function(e){return ZM.FromTape(e.ID,e.type,e.arguments)},2713554722:function(e){return QM.FromTape(e.ID,e.type,e.arguments)},4136498852:function(e){return qM.FromTape(e.ID,e.type,e.arguments)},335055490:function(e){return $M.FromTape(e.ID,e.type,e.arguments)},3640358203:function(e){return eI.FromTape(e.ID,e.type,e.arguments)},2954562838:function(e){return tI.FromTape(e.ID,e.type,e.arguments)},1785450214:function(e){return iI.FromTape(e.ID,e.type,e.arguments)},1466758467:function(e){return sI.FromTape(e.ID,e.type,e.arguments)},3895139033:function(e){return rI.FromTape(e.ID,e.type,e.arguments)},1419761937:function(e){return nI.FromTape(e.ID,e.type,e.arguments)},602808272:function(e){return oI.FromTape(e.ID,e.type,e.arguments)},1973544240:function(e){return aI.FromTape(e.ID,e.type,e.arguments)},1916426348:function(e){return uI.FromTape(e.ID,e.type,e.arguments)},3295246426:function(e){return hI.FromTape(e.ID,e.type,e.arguments)},1815067380:function(e){return lI.FromTape(e.ID,e.type,e.arguments)},2506170314:function(e){return cI.FromTape(e.ID,e.type,e.arguments)},2147822146:function(e){return pI.FromTape(e.ID,e.type,e.arguments)},539742890:function(e){return dI.FromTape(e.ID,e.type,e.arguments)},3495092785:function(e){return fI.FromTape(e.ID,e.type,e.arguments)},1457835157:function(e){return mI.FromTape(e.ID,e.type,e.arguments)},2601014836:function(e){return vI.FromTape(e.ID,e.type,e.arguments)},2827736869:function(e){return gI.FromTape(e.ID,e.type,e.arguments)},2629017746:function(e){return _I.FromTape(e.ID,e.type,e.arguments)},1186437898:function(e){return yI.FromTape(e.ID,e.type,e.arguments)},3800577675:function(e){return bI.FromTape(e.ID,e.type,e.arguments)},1105321065:function(e){return xI.FromTape(e.ID,e.type,e.arguments)},2367409068:function(e){return PI.FromTape(e.ID,e.type,e.arguments)},3510044353:function(e){return TI.FromTape(e.ID,e.type,e.arguments)},1213902940:function(e){return wI.FromTape(e.ID,e.type,e.arguments)},4074379575:function(e){return MI.FromTape(e.ID,e.type,e.arguments)},3961806047:function(e){return II.FromTape(e.ID,e.type,e.arguments)},3426335179:function(e){return CI.FromTape(e.ID,e.type,e.arguments)},1306400036:function(e){return DI.FromTape(e.ID,e.type,e.arguments)},3632507154:function(e){return AI.FromTape(e.ID,e.type,e.arguments)},1765591967:function(e){return kI.FromTape(e.ID,e.type,e.arguments)},1045800335:function(e){return EI.FromTape(e.ID,e.type,e.arguments)},2949456006:function(e){return FI.FromTape(e.ID,e.type,e.arguments)},32440307:function(e){return RI.FromTape(e.ID,e.type,e.arguments)},1335981549:function(e){return SI.FromTape(e.ID,e.type,e.arguments)},2635815018:function(e){return OI.FromTape(e.ID,e.type,e.arguments)},1945343521:function(e){return BI.FromTape(e.ID,e.type,e.arguments)},1052013943:function(e){return LI.FromTape(e.ID,e.type,e.arguments)},1599208980:function(e){return NI.FromTape(e.ID,e.type,e.arguments)},562808652:function(e){return jI.FromTape(e.ID,e.type,e.arguments)},1062813311:function(e){return GI.FromTape(e.ID,e.type,e.arguments)},2063403501:function(e){return HI.FromTape(e.ID,e.type,e.arguments)},1945004755:function(e){return UI.FromTape(e.ID,e.type,e.arguments)},3256556792:function(e){return VI.FromTape(e.ID,e.type,e.arguments)},3040386961:function(e){return zI.FromTape(e.ID,e.type,e.arguments)},3849074793:function(e){return WI.FromTape(e.ID,e.type,e.arguments)},3041715199:function(e){return XI.FromTape(e.ID,e.type,e.arguments)},3205830791:function(e){return YI.FromTape(e.ID,e.type,e.arguments)},1154170062:function(e){return KI.FromTape(e.ID,e.type,e.arguments)},770865208:function(e){return JI.FromTape(e.ID,e.type,e.arguments)},3732053477:function(e){return ZI.FromTape(e.ID,e.type,e.arguments)},395920057:function(e){return QI.FromTape(e.ID,e.type,e.arguments)},2963535650:function(e){return qI.FromTape(e.ID,e.type,e.arguments)},1714330368:function(e){return $I.FromTape(e.ID,e.type,e.arguments)},3242481149:function(e){return eC.FromTape(e.ID,e.type,e.arguments)},526551008:function(e){return tC.FromTape(e.ID,e.type,e.arguments)},2323601079:function(e){return iC.FromTape(e.ID,e.type,e.arguments)},445594917:function(e){return sC.FromTape(e.ID,e.type,e.arguments)},4006246654:function(e){return rC.FromTape(e.ID,e.type,e.arguments)},342316401:function(e){return nC.FromTape(e.ID,e.type,e.arguments)},869906466:function(e){return oC.FromTape(e.ID,e.type,e.arguments)},3518393246:function(e){return aC.FromTape(e.ID,e.type,e.arguments)},3760055223:function(e){return uC.FromTape(e.ID,e.type,e.arguments)},1360408905:function(e){return hC.FromTape(e.ID,e.type,e.arguments)},2030761528:function(e){return lC.FromTape(e.ID,e.type,e.arguments)},3900360178:function(e){return cC.FromTape(e.ID,e.type,e.arguments)},476780140:function(e){return pC.FromTape(e.ID,e.type,e.arguments)},1472233963:function(e){return dC.FromTape(e.ID,e.type,e.arguments)},1904799276:function(e){return fC.FromTape(e.ID,e.type,e.arguments)},663422040:function(e){return mC.FromTape(e.ID,e.type,e.arguments)},862014818:function(e){return vC.FromTape(e.ID,e.type,e.arguments)},2417008758:function(e){return gC.FromTape(e.ID,e.type,e.arguments)},3310460725:function(e){return _C.FromTape(e.ID,e.type,e.arguments)},3277789161:function(e){return yC.FromTape(e.ID,e.type,e.arguments)},264262732:function(e){return bC.FromTape(e.ID,e.type,e.arguments)},1534661035:function(e){return xC.FromTape(e.ID,e.type,e.arguments)},402227799:function(e){return PC.FromTape(e.ID,e.type,e.arguments)},1217240411:function(e){return TC.FromTape(e.ID,e.type,e.arguments)},1003880860:function(e){return wC.FromTape(e.ID,e.type,e.arguments)},712377611:function(e){return MC.FromTape(e.ID,e.type,e.arguments)},1758889154:function(e){return IC.FromTape(e.ID,e.type,e.arguments)},4123344466:function(e){return CC.FromTape(e.ID,e.type,e.arguments)},2397081782:function(e){return DC.FromTape(e.ID,e.type,e.arguments)},1623761950:function(e){return AC.FromTape(e.ID,e.type,e.arguments)},2590856083:function(e){return kC.FromTape(e.ID,e.type,e.arguments)},1883228015:function(e){return EC.FromTape(e.ID,e.type,e.arguments)},339256511:function(e){return FC.FromTape(e.ID,e.type,e.arguments)},2777663545:function(e){return RC.FromTape(e.ID,e.type,e.arguments)},1704287377:function(e){return SC.FromTape(e.ID,e.type,e.arguments)},2835456948:function(e){return OC.FromTape(e.ID,e.type,e.arguments)},1658829314:function(e){return BC.FromTape(e.ID,e.type,e.arguments)},2107101300:function(e){return LC.FromTape(e.ID,e.type,e.arguments)},2814081492:function(e){return NC.FromTape(e.ID,e.type,e.arguments)},132023988:function(e){return jC.FromTape(e.ID,e.type,e.arguments)},3747195512:function(e){return GC.FromTape(e.ID,e.type,e.arguments)},3174744832:function(e){return HC.FromTape(e.ID,e.type,e.arguments)},484807127:function(e){return UC.FromTape(e.ID,e.type,e.arguments)},3390157468:function(e){return VC.FromTape(e.ID,e.type,e.arguments)},4148101412:function(e){return zC.FromTape(e.ID,e.type,e.arguments)},211053100:function(e){return WC.FromTape(e.ID,e.type,e.arguments)},4024345920:function(e){return XC.FromTape(e.ID,e.type,e.arguments)},297599258:function(e){return YC.FromTape(e.ID,e.type,e.arguments)},4294318154:function(e){return KC.FromTape(e.ID,e.type,e.arguments)},3200245327:function(e){return JC.FromTape(e.ID,e.type,e.arguments)},1437805879:function(e){return ZC.FromTape(e.ID,e.type,e.arguments)},1209101575:function(e){return QC.FromTape(e.ID,e.type,e.arguments)},2853485674:function(e){return qC.FromTape(e.ID,e.type,e.arguments)},2242383968:function(e){return $C.FromTape(e.ID,e.type,e.arguments)},1040185647:function(e){return eD.FromTape(e.ID,e.type,e.arguments)},3548104201:function(e){return tD.FromTape(e.ID,e.type,e.arguments)},477187591:function(e){return iD.FromTape(e.ID,e.type,e.arguments)},2804161546:function(e){return sD.FromTape(e.ID,e.type,e.arguments)},2556980723:function(e){return rD.FromTape(e.ID,e.type,e.arguments)},2047409740:function(e){return nD.FromTape(e.ID,e.type,e.arguments)},1809719519:function(e){return oD.FromTape(e.ID,e.type,e.arguments)},803316827:function(e){return aD.FromTape(e.ID,e.type,e.arguments)},3008276851:function(e){return uD.FromTape(e.ID,e.type,e.arguments)},807026263:function(e){return hD.FromTape(e.ID,e.type,e.arguments)},3737207727:function(e){return lD.FromTape(e.ID,e.type,e.arguments)},24185140:function(e){return cD.FromTape(e.ID,e.type,e.arguments)},1310830890:function(e){return pD.FromTape(e.ID,e.type,e.arguments)},4219587988:function(e){return dD.FromTape(e.ID,e.type,e.arguments)},3415622556:function(e){return fD.FromTape(e.ID,e.type,e.arguments)},346874300:function(e){return mD.FromTape(e.ID,e.type,e.arguments)},647756555:function(e){return vD.FromTape(e.ID,e.type,e.arguments)},2489546625:function(e){return gD.FromTape(e.ID,e.type,e.arguments)},2827207264:function(e){return _D.FromTape(e.ID,e.type,e.arguments)},2143335405:function(e){return yD.FromTape(e.ID,e.type,e.arguments)},1287392070:function(e){return bD.FromTape(e.ID,e.type,e.arguments)},738692330:function(e){return xD.FromTape(e.ID,e.type,e.arguments)},374418227:function(e){return PD.FromTape(e.ID,e.type,e.arguments)},315944413:function(e){return TD.FromTape(e.ID,e.type,e.arguments)},819412036:function(e){return wD.FromTape(e.ID,e.type,e.arguments)},1810631287:function(e){return MD.FromTape(e.ID,e.type,e.arguments)},1426591983:function(e){return ID.FromTape(e.ID,e.type,e.arguments)},4222183408:function(e){return CD.FromTape(e.ID,e.type,e.arguments)},2652556860:function(e){return DD.FromTape(e.ID,e.type,e.arguments)},2058353004:function(e){return AD.FromTape(e.ID,e.type,e.arguments)},3907093117:function(e){return kD.FromTape(e.ID,e.type,e.arguments)},4278956645:function(e){return ED.FromTape(e.ID,e.type,e.arguments)},3198132628:function(e){return FD.FromTape(e.ID,e.type,e.arguments)},182646315:function(e){return RD.FromTape(e.ID,e.type,e.arguments)},4037862832:function(e){return SD.FromTape(e.ID,e.type,e.arguments)},2188021234:function(e){return OD.FromTape(e.ID,e.type,e.arguments)},3815607619:function(e){return BD.FromTape(e.ID,e.type,e.arguments)},3132237377:function(e){return LD.FromTape(e.ID,e.type,e.arguments)},1482959167:function(e){return ND.FromTape(e.ID,e.type,e.arguments)},987401354:function(e){return jD.FromTape(e.ID,e.type,e.arguments)},1834744321:function(e){return GD.FromTape(e.ID,e.type,e.arguments)},707683696:function(e){return HD.FromTape(e.ID,e.type,e.arguments)},1339347760:function(e){return UD.FromTape(e.ID,e.type,e.arguments)},2223149337:function(e){return VD.FromTape(e.ID,e.type,e.arguments)},2297155007:function(e){return zD.FromTape(e.ID,e.type,e.arguments)},3508470533:function(e){return WD.FromTape(e.ID,e.type,e.arguments)},3009222698:function(e){return XD.FromTape(e.ID,e.type,e.arguments)},900683007:function(e){return YD.FromTape(e.ID,e.type,e.arguments)},1893162501:function(e){return KD.FromTape(e.ID,e.type,e.arguments)},263784265:function(e){return JD.FromTape(e.ID,e.type,e.arguments)},4238390223:function(e){return ZD.FromTape(e.ID,e.type,e.arguments)},1509553395:function(e){return QD.FromTape(e.ID,e.type,e.arguments)},1268542332:function(e){return qD.FromTape(e.ID,e.type,e.arguments)},3493046030:function(e){return $D.FromTape(e.ID,e.type,e.arguments)},4095422895:function(e){return eA.FromTape(e.ID,e.type,e.arguments)},987898635:function(e){return tA.FromTape(e.ID,e.type,e.arguments)},3448662350:function(e){return iA.FromTape(e.ID,e.type,e.arguments)},2453401579:function(e){return sA.FromTape(e.ID,e.type,e.arguments)},4142052618:function(e){return rA.FromTape(e.ID,e.type,e.arguments)},3590301190:function(e){return nA.FromTape(e.ID,e.type,e.arguments)},3009204131:function(e){return oA.FromTape(e.ID,e.type,e.arguments)},852622518:function(e){return aA.FromTape(e.ID,e.type,e.arguments)},178086475:function(e){return uA.FromTape(e.ID,e.type,e.arguments)},2706460486:function(e){return hA.FromTape(e.ID,e.type,e.arguments)},812098782:function(e){return lA.FromTape(e.ID,e.type,e.arguments)},3319311131:function(e){return cA.FromTape(e.ID,e.type,e.arguments)},1251058090:function(e){return pA.FromTape(e.ID,e.type,e.arguments)},2068733104:function(e){return dA.FromTape(e.ID,e.type,e.arguments)},1806887404:function(e){return fA.FromTape(e.ID,e.type,e.arguments)},1484403080:function(e){return mA.FromTape(e.ID,e.type,e.arguments)},3905492369:function(e){return vA.FromTape(e.ID,e.type,e.arguments)},3570813810:function(e){return gA.FromTape(e.ID,e.type,e.arguments)},2571569899:function(e){return _A.FromTape(e.ID,e.type,e.arguments)},178912537:function(e){return yA.FromTape(e.ID,e.type,e.arguments)},2294589976:function(e){return bA.FromTape(e.ID,e.type,e.arguments)},1437953363:function(e){return xA.FromTape(e.ID,e.type,e.arguments)},2133299955:function(e){return PA.FromTape(e.ID,e.type,e.arguments)},4175244083:function(e){return TA.FromTape(e.ID,e.type,e.arguments)},3946677679:function(e){return wA.FromTape(e.ID,e.type,e.arguments)},3113134337:function(e){return MA.FromTape(e.ID,e.type,e.arguments)},2391368822:function(e){return IA.FromTape(e.ID,e.type,e.arguments)},3741457305:function(e){return CA.FromTape(e.ID,e.type,e.arguments)},3020489413:function(e){return DA.FromTape(e.ID,e.type,e.arguments)},2176052936:function(e){return AA.FromTape(e.ID,e.type,e.arguments)},4288270099:function(e){return kA.FromTape(e.ID,e.type,e.arguments)},572779678:function(e){return EA.FromTape(e.ID,e.type,e.arguments)},3827777499:function(e){return FA.FromTape(e.ID,e.type,e.arguments)},428585644:function(e){return RA.FromTape(e.ID,e.type,e.arguments)},1585845231:function(e){return SA.FromTape(e.ID,e.type,e.arguments)},76236018:function(e){return OA.FromTape(e.ID,e.type,e.arguments)},1051575348:function(e){return BA.FromTape(e.ID,e.type,e.arguments)},2655187982:function(e){return LA.FromTape(e.ID,e.type,e.arguments)},3452421091:function(e){return NA.FromTape(e.ID,e.type,e.arguments)},4162380809:function(e){return jA.FromTape(e.ID,e.type,e.arguments)},629592764:function(e){return GA.FromTape(e.ID,e.type,e.arguments)},1161773419:function(e){return HA.FromTape(e.ID,e.type,e.arguments)},1566485204:function(e){return UA.FromTape(e.ID,e.type,e.arguments)},1402838566:function(e){return VA.FromTape(e.ID,e.type,e.arguments)},125510826:function(e){return zA.FromTape(e.ID,e.type,e.arguments)},2604431987:function(e){return WA.FromTape(e.ID,e.type,e.arguments)},4266656042:function(e){return XA.FromTape(e.ID,e.type,e.arguments)},1520743889:function(e){return YA.FromTape(e.ID,e.type,e.arguments)},3422422726:function(e){return KA.FromTape(e.ID,e.type,e.arguments)},1281925730:function(e){return JA.FromTape(e.ID,e.type,e.arguments)},3092502836:function(e){return ZA.FromTape(e.ID,e.type,e.arguments)},388784114:function(e){return QA.FromTape(e.ID,e.type,e.arguments)},1154579445:function(e){return qA.FromTape(e.ID,e.type,e.arguments)},2624227202:function(e){return $A.FromTape(e.ID,e.type,e.arguments)},1008929658:function(e){return ek.FromTape(e.ID,e.type,e.arguments)},1425443689:function(e){return tk.FromTape(e.ID,e.type,e.arguments)},3057273783:function(e){return ik.FromTape(e.ID,e.type,e.arguments)},2347385850:function(e){return sk.FromTape(e.ID,e.type,e.arguments)},1838606355:function(e){return rk.FromTape(e.ID,e.type,e.arguments)},1847130766:function(e){return nk.FromTape(e.ID,e.type,e.arguments)},3708119e3:function(e){return ok.FromTape(e.ID,e.type,e.arguments)},2852063980:function(e){return ak.FromTape(e.ID,e.type,e.arguments)},760658860:function(e){return uk.FromTape(e.ID,e.type,e.arguments)},2022407955:function(e){return hk.FromTape(e.ID,e.type,e.arguments)},248100487:function(e){return lk.FromTape(e.ID,e.type,e.arguments)},3303938423:function(e){return ck.FromTape(e.ID,e.type,e.arguments)},1303795690:function(e){return pk.FromTape(e.ID,e.type,e.arguments)},1847252529:function(e){return dk.FromTape(e.ID,e.type,e.arguments)},2199411900:function(e){return fk.FromTape(e.ID,e.type,e.arguments)},2235152071:function(e){return mk.FromTape(e.ID,e.type,e.arguments)},164193824:function(e){return vk.FromTape(e.ID,e.type,e.arguments)},3079605661:function(e){return gk.FromTape(e.ID,e.type,e.arguments)},3404854881:function(e){return _k.FromTape(e.ID,e.type,e.arguments)},552965576:function(e){return yk.FromTape(e.ID,e.type,e.arguments)},3265635763:function(e){return bk.FromTape(e.ID,e.type,e.arguments)},853536259:function(e){return xk.FromTape(e.ID,e.type,e.arguments)},1507914824:function(e){return Pk.FromTape(e.ID,e.type,e.arguments)},2597039031:function(e){return Tk.FromTape(e.ID,e.type,e.arguments)},377706215:function(e){return wk.FromTape(e.ID,e.type,e.arguments)},2108223431:function(e){return Mk.FromTape(e.ID,e.type,e.arguments)},1437502449:function(e){return Ik.FromTape(e.ID,e.type,e.arguments)},1114901282:function(e){return Ck.FromTape(e.ID,e.type,e.arguments)},1073191201:function(e){return Dk.FromTape(e.ID,e.type,e.arguments)},1911478936:function(e){return Ak.FromTape(e.ID,e.type,e.arguments)},3181161470:function(e){return kk.FromTape(e.ID,e.type,e.arguments)},3368373690:function(e){return Ek.FromTape(e.ID,e.type,e.arguments)},2998442950:function(e){return Fk.FromTape(e.ID,e.type,e.arguments)},2706619895:function(e){return Rk.FromTape(e.ID,e.type,e.arguments)},2474470126:function(e){return Sk.FromTape(e.ID,e.type,e.arguments)},977012517:function(e){return Ok.FromTape(e.ID,e.type,e.arguments)},1918398963:function(e){return Bk.FromTape(e.ID,e.type,e.arguments)},3888040117:function(e){return Lk.FromTape(e.ID,e.type,e.arguments)},219451334:function(e){return Nk.FromTape(e.ID,e.type,e.arguments)},3701648758:function(e){return jk.FromTape(e.ID,e.type,e.arguments)},2251480897:function(e){return Gk.FromTape(e.ID,e.type,e.arguments)},4143007308:function(e){return Hk.FromTape(e.ID,e.type,e.arguments)},590820931:function(e){return Uk.FromTape(e.ID,e.type,e.arguments)},3388369263:function(e){return Vk.FromTape(e.ID,e.type,e.arguments)},3505215534:function(e){return zk.FromTape(e.ID,e.type,e.arguments)},2485787929:function(e){return Wk.FromTape(e.ID,e.type,e.arguments)},2665983363:function(e){return Xk.FromTape(e.ID,e.type,e.arguments)},3588315303:function(e){return Yk.FromTape(e.ID,e.type,e.arguments)},3079942009:function(e){return Kk.FromTape(e.ID,e.type,e.arguments)},4251960020:function(e){return Jk.FromTape(e.ID,e.type,e.arguments)},1411181986:function(e){return Zk.FromTape(e.ID,e.type,e.arguments)},643959842:function(e){return Qk.FromTape(e.ID,e.type,e.arguments)},1029017970:function(e){return qk.FromTape(e.ID,e.type,e.arguments)},144952367:function(e){return $k.FromTape(e.ID,e.type,e.arguments)},3694346114:function(e){return eE.FromTape(e.ID,e.type,e.arguments)},2837617999:function(e){return tE.FromTape(e.ID,e.type,e.arguments)},1207048766:function(e){return iE.FromTape(e.ID,e.type,e.arguments)},2529465313:function(e){return sE.FromTape(e.ID,e.type,e.arguments)},2519244187:function(e){return rE.FromTape(e.ID,e.type,e.arguments)},1682466193:function(e){return nE.FromTape(e.ID,e.type,e.arguments)},2382730787:function(e){return oE.FromTape(e.ID,e.type,e.arguments)},3566463478:function(e){return aE.FromTape(e.ID,e.type,e.arguments)},3327091369:function(e){return uE.FromTape(e.ID,e.type,e.arguments)},2077209135:function(e){return hE.FromTape(e.ID,e.type,e.arguments)},101040310:function(e){return lE.FromTape(e.ID,e.type,e.arguments)},3021840470:function(e){return cE.FromTape(e.ID,e.type,e.arguments)},2483315170:function(e){return pE.FromTape(e.ID,e.type,e.arguments)},2226359599:function(e){return dE.FromTape(e.ID,e.type,e.arguments)},1687234759:function(e){return fE.FromTape(e.ID,e.type,e.arguments)},1158309216:function(e){return mE.FromTape(e.ID,e.type,e.arguments)},310824031:function(e){return vE.FromTape(e.ID,e.type,e.arguments)},804291784:function(e){return gE.FromTape(e.ID,e.type,e.arguments)},3612865200:function(e){return _E.FromTape(e.ID,e.type,e.arguments)},4231323485:function(e){return yE.FromTape(e.ID,e.type,e.arguments)},597895409:function(e){return bE.FromTape(e.ID,e.type,e.arguments)},2004835150:function(e){return xE.FromTape(e.ID,e.type,e.arguments)},603570806:function(e){return PE.FromTape(e.ID,e.type,e.arguments)},1663979128:function(e){return TE.FromTape(e.ID,e.type,e.arguments)},220341763:function(e){return wE.FromTape(e.ID,e.type,e.arguments)},3171933400:function(e){return ME.FromTape(e.ID,e.type,e.arguments)},1156407060:function(e){return IE.FromTape(e.ID,e.type,e.arguments)},4017108033:function(e){return CE.FromTape(e.ID,e.type,e.arguments)},2067069095:function(e){return DE.FromTape(e.ID,e.type,e.arguments)},4022376103:function(e){return AE.FromTape(e.ID,e.type,e.arguments)},1423911732:function(e){return kE.FromTape(e.ID,e.type,e.arguments)},2924175390:function(e){return EE.FromTape(e.ID,e.type,e.arguments)},2775532180:function(e){return FE.FromTape(e.ID,e.type,e.arguments)},2839578677:function(e){return RE.FromTape(e.ID,e.type,e.arguments)},3724593414:function(e){return SE.FromTape(e.ID,e.type,e.arguments)},3740093272:function(e){return OE.FromTape(e.ID,e.type,e.arguments)},1946335990:function(e){return BE.FromTape(e.ID,e.type,e.arguments)},3355820592:function(e){return LE.FromTape(e.ID,e.type,e.arguments)},759155922:function(e){return NE.FromTape(e.ID,e.type,e.arguments)},2559016684:function(e){return jE.FromTape(e.ID,e.type,e.arguments)},3727388367:function(e){return GE.FromTape(e.ID,e.type,e.arguments)},3778827333:function(e){return HE.FromTape(e.ID,e.type,e.arguments)},3967405729:function(e){return UE.FromTape(e.ID,e.type,e.arguments)},1775413392:function(e){return VE.FromTape(e.ID,e.type,e.arguments)},677532197:function(e){return zE.FromTape(e.ID,e.type,e.arguments)},2022622350:function(e){return WE.FromTape(e.ID,e.type,e.arguments)},1304840413:function(e){return XE.FromTape(e.ID,e.type,e.arguments)},3119450353:function(e){return YE.FromTape(e.ID,e.type,e.arguments)},2417041796:function(e){return KE.FromTape(e.ID,e.type,e.arguments)},2744685151:function(e){return JE.FromTape(e.ID,e.type,e.arguments)},569719735:function(e){return ZE.FromTape(e.ID,e.type,e.arguments)},2945172077:function(e){return QE.FromTape(e.ID,e.type,e.arguments)},4208778838:function(e){return qE.FromTape(e.ID,e.type,e.arguments)},673634403:function(e){return $E.FromTape(e.ID,e.type,e.arguments)},2095639259:function(e){return eF.FromTape(e.ID,e.type,e.arguments)},3958567839:function(e){return tF.FromTape(e.ID,e.type,e.arguments)},2802850158:function(e){return iF.FromTape(e.ID,e.type,e.arguments)},103090709:function(e){return sF.FromTape(e.ID,e.type,e.arguments)},653396225:function(e){return rF.FromTape(e.ID,e.type,e.arguments)},2904328755:function(e){return nF.FromTape(e.ID,e.type,e.arguments)},3843373140:function(e){return oF.FromTape(e.ID,e.type,e.arguments)},3651124850:function(e){return aF.FromTape(e.ID,e.type,e.arguments)},2598011224:function(e){return uF.FromTape(e.ID,e.type,e.arguments)},986844984:function(e){return hF.FromTape(e.ID,e.type,e.arguments)},871118103:function(e){return lF.FromTape(e.ID,e.type,e.arguments)},1680319473:function(e){return cF.FromTape(e.ID,e.type,e.arguments)},148025276:function(e){return pF.FromTape(e.ID,e.type,e.arguments)},4166981789:function(e){return dF.FromTape(e.ID,e.type,e.arguments)},3710013099:function(e){return fF.FromTape(e.ID,e.type,e.arguments)},2752243245:function(e){return mF.FromTape(e.ID,e.type,e.arguments)},941946838:function(e){return vF.FromTape(e.ID,e.type,e.arguments)},1451395588:function(e){return gF.FromTape(e.ID,e.type,e.arguments)},3357820518:function(e){return _F.FromTape(e.ID,e.type,e.arguments)},492091185:function(e){return yF.FromTape(e.ID,e.type,e.arguments)},3650150729:function(e){return bF.FromTape(e.ID,e.type,e.arguments)},110355661:function(e){return xF.FromTape(e.ID,e.type,e.arguments)},3521284610:function(e){return PF.FromTape(e.ID,e.type,e.arguments)},1482703590:function(e){return TF.FromTape(e.ID,e.type,e.arguments)},738039164:function(e){return wF.FromTape(e.ID,e.type,e.arguments)},2295281155:function(e){return MF.FromTape(e.ID,e.type,e.arguments)},655969474:function(e){return IF.FromTape(e.ID,e.type,e.arguments)},1842657554:function(e){return CF.FromTape(e.ID,e.type,e.arguments)},3219374653:function(e){return DF.FromTape(e.ID,e.type,e.arguments)},90941305:function(e){return AF.FromTape(e.ID,e.type,e.arguments)},2250791053:function(e){return kF.FromTape(e.ID,e.type,e.arguments)},2044713172:function(e){return EF.FromTape(e.ID,e.type,e.arguments)},2093928680:function(e){return FF.FromTape(e.ID,e.type,e.arguments)},931644368:function(e){return RF.FromTape(e.ID,e.type,e.arguments)},2090586900:function(e){return SF.FromTape(e.ID,e.type,e.arguments)},3252649465:function(e){return OF.FromTape(e.ID,e.type,e.arguments)},2405470396:function(e){return BF.FromTape(e.ID,e.type,e.arguments)},825690147:function(e){return LF.FromTape(e.ID,e.type,e.arguments)},2262370178:function(e){return NF.FromTape(e.ID,e.type,e.arguments)},2893384427:function(e){return jF.FromTape(e.ID,e.type,e.arguments)},3024970846:function(e){return GF.FromTape(e.ID,e.type,e.arguments)},3283111854:function(e){return HF.FromTape(e.ID,e.type,e.arguments)},2324767716:function(e){return UF.FromTape(e.ID,e.type,e.arguments)},1469900589:function(e){return VF.FromTape(e.ID,e.type,e.arguments)},1232101972:function(e){return zF.FromTape(e.ID,e.type,e.arguments)},683857671:function(e){return WF.FromTape(e.ID,e.type,e.arguments)},2770003689:function(e){return XF.FromTape(e.ID,e.type,e.arguments)},3615266464:function(e){return YF.FromTape(e.ID,e.type,e.arguments)},2798486643:function(e){return KF.FromTape(e.ID,e.type,e.arguments)},3454111270:function(e){return JF.FromTape(e.ID,e.type,e.arguments)},3915482550:function(e){return ZF.FromTape(e.ID,e.type,e.arguments)},2433181523:function(e){return QF.FromTape(e.ID,e.type,e.arguments)},4021432810:function(e){return qF.FromTape(e.ID,e.type,e.arguments)},3413951693:function(e){return $F.FromTape(e.ID,e.type,e.arguments)},1580146022:function(e){return eR.FromTape(e.ID,e.type,e.arguments)},3765753017:function(e){return tR.FromTape(e.ID,e.type,e.arguments)},979691226:function(e){return iR.FromTape(e.ID,e.type,e.arguments)},2572171363:function(e){return sR.FromTape(e.ID,e.type,e.arguments)},3027567501:function(e){return rR.FromTape(e.ID,e.type,e.arguments)},964333572:function(e){return nR.FromTape(e.ID,e.type,e.arguments)},2320036040:function(e){return oR.FromTape(e.ID,e.type,e.arguments)},2310774935:function(e){return aR.FromTape(e.ID,e.type,e.arguments)},160246688:function(e){return uR.FromTape(e.ID,e.type,e.arguments)},3939117080:function(e){return hR.FromTape(e.ID,e.type,e.arguments)},1683148259:function(e){return lR.FromTape(e.ID,e.type,e.arguments)},2495723537:function(e){return cR.FromTape(e.ID,e.type,e.arguments)},1307041759:function(e){return pR.FromTape(e.ID,e.type,e.arguments)},1027710054:function(e){return dR.FromTape(e.ID,e.type,e.arguments)},4278684876:function(e){return fR.FromTape(e.ID,e.type,e.arguments)},2857406711:function(e){return mR.FromTape(e.ID,e.type,e.arguments)},205026976:function(e){return vR.FromTape(e.ID,e.type,e.arguments)},1865459582:function(e){return gR.FromTape(e.ID,e.type,e.arguments)},4095574036:function(e){return _R.FromTape(e.ID,e.type,e.arguments)},919958153:function(e){return yR.FromTape(e.ID,e.type,e.arguments)},2728634034:function(e){return bR.FromTape(e.ID,e.type,e.arguments)},982818633:function(e){return xR.FromTape(e.ID,e.type,e.arguments)},3840914261:function(e){return PR.FromTape(e.ID,e.type,e.arguments)},2655215786:function(e){return TR.FromTape(e.ID,e.type,e.arguments)},826625072:function(e){return wR.FromTape(e.ID,e.type,e.arguments)},1204542856:function(e){return MR.FromTape(e.ID,e.type,e.arguments)},3945020480:function(e){return IR.FromTape(e.ID,e.type,e.arguments)},4201705270:function(e){return CR.FromTape(e.ID,e.type,e.arguments)},3190031847:function(e){return DR.FromTape(e.ID,e.type,e.arguments)},2127690289:function(e){return AR.FromTape(e.ID,e.type,e.arguments)},1638771189:function(e){return kR.FromTape(e.ID,e.type,e.arguments)},504942748:function(e){return ER.FromTape(e.ID,e.type,e.arguments)},3678494232:function(e){return FR.FromTape(e.ID,e.type,e.arguments)},3242617779:function(e){return RR.FromTape(e.ID,e.type,e.arguments)},886880790:function(e){return SR.FromTape(e.ID,e.type,e.arguments)},2802773753:function(e){return OR.FromTape(e.ID,e.type,e.arguments)},2565941209:function(e){return BR.FromTape(e.ID,e.type,e.arguments)},2551354335:function(e){return LR.FromTape(e.ID,e.type,e.arguments)},693640335:function(e){return NR.FromTape(e.ID,e.type,e.arguments)},1462361463:function(e){return jR.FromTape(e.ID,e.type,e.arguments)},4186316022:function(e){return GR.FromTape(e.ID,e.type,e.arguments)},307848117:function(e){return HR.FromTape(e.ID,e.type,e.arguments)},781010003:function(e){return UR.FromTape(e.ID,e.type,e.arguments)},3940055652:function(e){return VR.FromTape(e.ID,e.type,e.arguments)},279856033:function(e){return zR.FromTape(e.ID,e.type,e.arguments)},427948657:function(e){return WR.FromTape(e.ID,e.type,e.arguments)},3268803585:function(e){return XR.FromTape(e.ID,e.type,e.arguments)},1441486842:function(e){return YR.FromTape(e.ID,e.type,e.arguments)},750771296:function(e){return KR.FromTape(e.ID,e.type,e.arguments)},1245217292:function(e){return JR.FromTape(e.ID,e.type,e.arguments)},4122056220:function(e){return ZR.FromTape(e.ID,e.type,e.arguments)},366585022:function(e){return QR.FromTape(e.ID,e.type,e.arguments)},3451746338:function(e){return qR.FromTape(e.ID,e.type,e.arguments)},3523091289:function(e){return $R.FromTape(e.ID,e.type,e.arguments)},1521410863:function(e){return eS.FromTape(e.ID,e.type,e.arguments)},1401173127:function(e){return tS.FromTape(e.ID,e.type,e.arguments)},478536968:function(e){return iS.FromTape(e.ID,e.type,e.arguments)},816062949:function(e){return sS.FromTape(e.ID,e.type,e.arguments)},1076942058:function(e){return rS.FromTape(e.ID,e.type,e.arguments)},3377609919:function(e){return nS.FromTape(e.ID,e.type,e.arguments)},3008791417:function(e){return oS.FromTape(e.ID,e.type,e.arguments)},1660063152:function(e){return aS.FromTape(e.ID,e.type,e.arguments)},2914609552:function(e){return uS.FromTape(e.ID,e.type,e.arguments)},2943643501:function(e){return hS.FromTape(e.ID,e.type,e.arguments)},1608871552:function(e){return lS.FromTape(e.ID,e.type,e.arguments)},2439245199:function(e){return cS.FromTape(e.ID,e.type,e.arguments)},1042787934:function(e){return pS.FromTape(e.ID,e.type,e.arguments)},1856042241:function(e){return dS.FromTape(e.ID,e.type,e.arguments)},3243963512:function(e){return fS.FromTape(e.ID,e.type,e.arguments)},4158566097:function(e){return mS.FromTape(e.ID,e.type,e.arguments)},3626867408:function(e){return vS.FromTape(e.ID,e.type,e.arguments)},2016517767:function(e){return gS.FromTape(e.ID,e.type,e.arguments)},2781568857:function(e){return _S.FromTape(e.ID,e.type,e.arguments)},2341007311:function(e){return yS.FromTape(e.ID,e.type,e.arguments)},2778083089:function(e){return bS.FromTape(e.ID,e.type,e.arguments)},448429030:function(e){return xS.FromTape(e.ID,e.type,e.arguments)},3053780830:function(e){return PS.FromTape(e.ID,e.type,e.arguments)},1768891740:function(e){return TS.FromTape(e.ID,e.type,e.arguments)},1054537805:function(e){return wS.FromTape(e.ID,e.type,e.arguments)},2157484638:function(e){return MS.FromTape(e.ID,e.type,e.arguments)},2042790032:function(e){return IS.FromTape(e.ID,e.type,e.arguments)},4165799628:function(e){return CS.FromTape(e.ID,e.type,e.arguments)},1862484736:function(e){return DS.FromTape(e.ID,e.type,e.arguments)},1290935644:function(e){return AS.FromTape(e.ID,e.type,e.arguments)},1509187699:function(e){return kS.FromTape(e.ID,e.type,e.arguments)},4086658281:function(e){return ES.FromTape(e.ID,e.type,e.arguments)},1783015770:function(e){return FS.FromTape(e.ID,e.type,e.arguments)},1329646415:function(e){return RS.FromTape(e.ID,e.type,e.arguments)},4074543187:function(e){return SS.FromTape(e.ID,e.type,e.arguments)},867548509:function(e){return OS.FromTape(e.ID,e.type,e.arguments)},3982875396:function(e){return BS.FromTape(e.ID,e.type,e.arguments)},4240577450:function(e){return LS.FromTape(e.ID,e.type,e.arguments)},4124623270:function(e){return NS.FromTape(e.ID,e.type,e.arguments)},3692461612:function(e){return jS.FromTape(e.ID,e.type,e.arguments)},3663146110:function(e){return GS.FromTape(e.ID,e.type,e.arguments)},4097777520:function(e){return HS.FromTape(e.ID,e.type,e.arguments)},1529196076:function(e){return US.FromTape(e.ID,e.type,e.arguments)},3127900445:function(e){return VS.FromTape(e.ID,e.type,e.arguments)},3027962421:function(e){return zS.FromTape(e.ID,e.type,e.arguments)},2533589738:function(e){return WS.FromTape(e.ID,e.type,e.arguments)},2609359061:function(e){return XS.FromTape(e.ID,e.type,e.arguments)},3420628829:function(e){return YS.FromTape(e.ID,e.type,e.arguments)},1072016465:function(e){return KS.FromTape(e.ID,e.type,e.arguments)},723233188:function(e){return JS.FromTape(e.ID,e.type,e.arguments)},3856911033:function(e){return ZS.FromTape(e.ID,e.type,e.arguments)},1999602285:function(e){return QS.FromTape(e.ID,e.type,e.arguments)},1305183839:function(e){return qS.FromTape(e.ID,e.type,e.arguments)},3812236995:function(e){return $S.FromTape(e.ID,e.type,e.arguments)},1412071761:function(e){return eO.FromTape(e.ID,e.type,e.arguments)},710998568:function(e){return tO.FromTape(e.ID,e.type,e.arguments)},2706606064:function(e){return iO.FromTape(e.ID,e.type,e.arguments)},3893378262:function(e){return sO.FromTape(e.ID,e.type,e.arguments)},463610769:function(e){return rO.FromTape(e.ID,e.type,e.arguments)},2481509218:function(e){return nO.FromTape(e.ID,e.type,e.arguments)},451544542:function(e){return oO.FromTape(e.ID,e.type,e.arguments)},4015995234:function(e){return aO.FromTape(e.ID,e.type,e.arguments)},1404847402:function(e){return uO.FromTape(e.ID,e.type,e.arguments)},3112655638:function(e){return hO.FromTape(e.ID,e.type,e.arguments)},331165859:function(e){return lO.FromTape(e.ID,e.type,e.arguments)},4252922144:function(e){return cO.FromTape(e.ID,e.type,e.arguments)},1039846685:function(e){return pO.FromTape(e.ID,e.type,e.arguments)},338393293:function(e){return dO.FromTape(e.ID,e.type,e.arguments)},682877961:function(e){return fO.FromTape(e.ID,e.type,e.arguments)},3544373492:function(e){return mO.FromTape(e.ID,e.type,e.arguments)},2515109513:function(e){return vO.FromTape(e.ID,e.type,e.arguments)},1179482911:function(e){return gO.FromTape(e.ID,e.type,e.arguments)},2273995522:function(e){return _O.FromTape(e.ID,e.type,e.arguments)},1004757350:function(e){return yO.FromTape(e.ID,e.type,e.arguments)},4243806635:function(e){return bO.FromTape(e.ID,e.type,e.arguments)},214636428:function(e){return xO.FromTape(e.ID,e.type,e.arguments)},2445595289:function(e){return PO.FromTape(e.ID,e.type,e.arguments)},2757150158:function(e){return TO.FromTape(e.ID,e.type,e.arguments)},3136571912:function(e){return wO.FromTape(e.ID,e.type,e.arguments)},1807405624:function(e){return MO.FromTape(e.ID,e.type,e.arguments)},2162789131:function(e){return IO.FromTape(e.ID,e.type,e.arguments)},385403989:function(e){return CO.FromTape(e.ID,e.type,e.arguments)},3478079324:function(e){return DO.FromTape(e.ID,e.type,e.arguments)},1252848954:function(e){return AO.FromTape(e.ID,e.type,e.arguments)},1595516126:function(e){return kO.FromTape(e.ID,e.type,e.arguments)},609421318:function(e){return EO.FromTape(e.ID,e.type,e.arguments)},2668620305:function(e){return FO.FromTape(e.ID,e.type,e.arguments)},2473145415:function(e){return RO.FromTape(e.ID,e.type,e.arguments)},1973038258:function(e){return SO.FromTape(e.ID,e.type,e.arguments)},1597423693:function(e){return OO.FromTape(e.ID,e.type,e.arguments)},1190533807:function(e){return BO.FromTape(e.ID,e.type,e.arguments)},2525727697:function(e){return LO.FromTape(e.ID,e.type,e.arguments)},3408363356:function(e){return NO.FromTape(e.ID,e.type,e.arguments)},530289379:function(e){return jO.FromTape(e.ID,e.type,e.arguments)},1621171031:function(e){return GO.FromTape(e.ID,e.type,e.arguments)},2082059205:function(e){return HO.FromTape(e.ID,e.type,e.arguments)},734778138:function(e){return UO.FromTape(e.ID,e.type,e.arguments)},1235345126:function(e){return VO.FromTape(e.ID,e.type,e.arguments)},3689010777:function(e){return zO.FromTape(e.ID,e.type,e.arguments)},2986769608:function(e){return WO.FromTape(e.ID,e.type,e.arguments)},3657597509:function(e){return XO.FromTape(e.ID,e.type,e.arguments)},1975003073:function(e){return YO.FromTape(e.ID,e.type,e.arguments)},3979015343:function(e){return KO.FromTape(e.ID,e.type,e.arguments)},2218152070:function(e){return JO.FromTape(e.ID,e.type,e.arguments)},603775116:function(e){return ZO.FromTape(e.ID,e.type,e.arguments)},2830218821:function(e){return QO.FromTape(e.ID,e.type,e.arguments)},3958052878:function(e){return qO.FromTape(e.ID,e.type,e.arguments)},3049322572:function(e){return $O.FromTape(e.ID,e.type,e.arguments)},148013059:function(e){return eB.FromTape(e.ID,e.type,e.arguments)},4095615324:function(e){return tB.FromTape(e.ID,e.type,e.arguments)},2233826070:function(e){return iB.FromTape(e.ID,e.type,e.arguments)},2513912981:function(e){return sB.FromTape(e.ID,e.type,e.arguments)},699246055:function(e){return rB.FromTape(e.ID,e.type,e.arguments)},2028607225:function(e){return nB.FromTape(e.ID,e.type,e.arguments)},3101698114:function(e){return oB.FromTape(e.ID,e.type,e.arguments)},2809605785:function(e){return aB.FromTape(e.ID,e.type,e.arguments)},4124788165:function(e){return uB.FromTape(e.ID,e.type,e.arguments)},2934153892:function(e){return hB.FromTape(e.ID,e.type,e.arguments)},1300840506:function(e){return lB.FromTape(e.ID,e.type,e.arguments)},3303107099:function(e){return cB.FromTape(e.ID,e.type,e.arguments)},1607154358:function(e){return pB.FromTape(e.ID,e.type,e.arguments)},1878645084:function(e){return dB.FromTape(e.ID,e.type,e.arguments)},846575682:function(e){return fB.FromTape(e.ID,e.type,e.arguments)},1351298697:function(e){return mB.FromTape(e.ID,e.type,e.arguments)},626085974:function(e){return vB.FromTape(e.ID,e.type,e.arguments)},2247615214:function(e){return gB.FromTape(e.ID,e.type,e.arguments)},1260650574:function(e){return _B.FromTape(e.ID,e.type,e.arguments)},1096409881:function(e){return yB.FromTape(e.ID,e.type,e.arguments)},230924584:function(e){return bB.FromTape(e.ID,e.type,e.arguments)},1162798199:function(e){return xB.FromTape(e.ID,e.type,e.arguments)},2315554128:function(e){return PB.FromTape(e.ID,e.type,e.arguments)},2254336722:function(e){return TB.FromTape(e.ID,e.type,e.arguments)},413509423:function(e){return wB.FromTape(e.ID,e.type,e.arguments)},1580310250:function(e){return MB.FromTape(e.ID,e.type,e.arguments)},3071757647:function(e){return IB.FromTape(e.ID,e.type,e.arguments)},985171141:function(e){return CB.FromTape(e.ID,e.type,e.arguments)},2043862942:function(e){return DB.FromTape(e.ID,e.type,e.arguments)},531007025:function(e){return AB.FromTape(e.ID,e.type,e.arguments)},812556717:function(e){return kB.FromTape(e.ID,e.type,e.arguments)},5716631:function(e){return EB.FromTape(e.ID,e.type,e.arguments)},3473067441:function(e){return FB.FromTape(e.ID,e.type,e.arguments)},1549132990:function(e){return RB.FromTape(e.ID,e.type,e.arguments)},2771591690:function(e){return SB.FromTape(e.ID,e.type,e.arguments)},3206491090:function(e){return OB.FromTape(e.ID,e.type,e.arguments)},912023232:function(e){return BB.FromTape(e.ID,e.type,e.arguments)},3824725483:function(e){return LB.FromTape(e.ID,e.type,e.arguments)},2347447852:function(e){return NB.FromTape(e.ID,e.type,e.arguments)},3081323446:function(e){return jB.FromTape(e.ID,e.type,e.arguments)},3663046924:function(e){return GB.FromTape(e.ID,e.type,e.arguments)},2281632017:function(e){return HB.FromTape(e.ID,e.type,e.arguments)},2415094496:function(e){return UB.FromTape(e.ID,e.type,e.arguments)},2387106220:function(e){return VB.FromTape(e.ID,e.type,e.arguments)},901063453:function(e){return zB.FromTape(e.ID,e.type,e.arguments)},4282788508:function(e){return WB.FromTape(e.ID,e.type,e.arguments)},3124975700:function(e){return XB.FromTape(e.ID,e.type,e.arguments)},1447204868:function(e){return YB.FromTape(e.ID,e.type,e.arguments)},1983826977:function(e){return KB.FromTape(e.ID,e.type,e.arguments)},2636378356:function(e){return JB.FromTape(e.ID,e.type,e.arguments)},1640371178:function(e){return ZB.FromTape(e.ID,e.type,e.arguments)},280115917:function(e){return QB.FromTape(e.ID,e.type,e.arguments)},1742049831:function(e){return qB.FromTape(e.ID,e.type,e.arguments)},2552916305:function(e){return $B.FromTape(e.ID,e.type,e.arguments)},1210645708:function(e){return eL.FromTape(e.ID,e.type,e.arguments)},3611470254:function(e){return tL.FromTape(e.ID,e.type,e.arguments)},1199560280:function(e){return iL.FromTape(e.ID,e.type,e.arguments)},3101149627:function(e){return sL.FromTape(e.ID,e.type,e.arguments)},581633288:function(e){return rL.FromTape(e.ID,e.type,e.arguments)},1377556343:function(e){return nL.FromTape(e.ID,e.type,e.arguments)},1735638870:function(e){return oL.FromTape(e.ID,e.type,e.arguments)},1935646853:function(e){return aL.FromTape(e.ID,e.type,e.arguments)},3825984169:function(e){return uL.FromTape(e.ID,e.type,e.arguments)},1692211062:function(e){return hL.FromTape(e.ID,e.type,e.arguments)},2595432518:function(e){return lL.FromTape(e.ID,e.type,e.arguments)},1620046519:function(e){return cL.FromTape(e.ID,e.type,e.arguments)},2097647324:function(e){return pL.FromTape(e.ID,e.type,e.arguments)},2715220739:function(e){return dL.FromTape(e.ID,e.type,e.arguments)},2916149573:function(e){return fL.FromTape(e.ID,e.type,e.arguments)},1229763772:function(e){return mL.FromTape(e.ID,e.type,e.arguments)},3593883385:function(e){return vL.FromTape(e.ID,e.type,e.arguments)},3026737570:function(e){return gL.FromTape(e.ID,e.type,e.arguments)},1600972822:function(e){return _L.FromTape(e.ID,e.type,e.arguments)},1628702193:function(e){return yL.FromTape(e.ID,e.type,e.arguments)},3736923433:function(e){return bL.FromTape(e.ID,e.type,e.arguments)},2347495698:function(e){return xL.FromTape(e.ID,e.type,e.arguments)},3698973494:function(e){return PL.FromTape(e.ID,e.type,e.arguments)},427810014:function(e){return TL.FromTape(e.ID,e.type,e.arguments)},180925521:function(e){return wL.FromTape(e.ID,e.type,e.arguments)},630975310:function(e){return ML.FromTape(e.ID,e.type,e.arguments)},3179687236:function(e){return IL.FromTape(e.ID,e.type,e.arguments)},4292641817:function(e){return CL.FromTape(e.ID,e.type,e.arguments)},1911125066:function(e){return DL.FromTape(e.ID,e.type,e.arguments)},4207607924:function(e){return AL.FromTape(e.ID,e.type,e.arguments)},728799441:function(e){return kL.FromTape(e.ID,e.type,e.arguments)},1417489154:function(e){return EL.FromTape(e.ID,e.type,e.arguments)},2799835756:function(e){return FL.FromTape(e.ID,e.type,e.arguments)},2759199220:function(e){return RL.FromTape(e.ID,e.type,e.arguments)},1907098498:function(e){return SL.FromTape(e.ID,e.type,e.arguments)},1530820697:function(e){return OL.FromTape(e.ID,e.type,e.arguments)},3956297820:function(e){return BL.FromTape(e.ID,e.type,e.arguments)},2391383451:function(e){return LL.FromTape(e.ID,e.type,e.arguments)},3313531582:function(e){return NL.FromTape(e.ID,e.type,e.arguments)},2769231204:function(e){return jL.FromTape(e.ID,e.type,e.arguments)},891718957:function(e){return GL.FromTape(e.ID,e.type,e.arguments)},926996030:function(e){return HL.FromTape(e.ID,e.type,e.arguments)},2391406946:function(e){return UL.FromTape(e.ID,e.type,e.arguments)},4156078855:function(e){return VL.FromTape(e.ID,e.type,e.arguments)},3512223829:function(e){return zL.FromTape(e.ID,e.type,e.arguments)},1898987631:function(e){return WL.FromTape(e.ID,e.type,e.arguments)},4237592921:function(e){return XL.FromTape(e.ID,e.type,e.arguments)},1133259667:function(e){return YL.FromTape(e.ID,e.type,e.arguments)},3304561284:function(e){return KL.FromTape(e.ID,e.type,e.arguments)},336235671:function(e){return JL.FromTape(e.ID,e.type,e.arguments)},512836454:function(e){return ZL.FromTape(e.ID,e.type,e.arguments)},486154966:function(e){return QL.FromTape(e.ID,e.type,e.arguments)},1299126871:function(e){return qL.FromTape(e.ID,e.type,e.arguments)},4009809668:function(e){return $L.FromTape(e.ID,e.type,e.arguments)},4088093105:function(e){return eN.FromTape(e.ID,e.type,e.arguments)},1028945134:function(e){return tN.FromTape(e.ID,e.type,e.arguments)},4218914973:function(e){return iN.FromTape(e.ID,e.type,e.arguments)},3342526732:function(e){return sN.FromTape(e.ID,e.type,e.arguments)},1236880293:function(e){return rN.FromTape(e.ID,e.type,e.arguments)},2543172580:function(e){return nN.FromTape(e.ID,e.type,e.arguments)},1033361043:function(e){return oN.FromTape(e.ID,e.type,e.arguments)}},tT=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.PredefinedType=h,this.Status=l,this.LongDescription=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.Status),e.push(this.LongDescription),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),iT=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.TheActor=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.TheActor),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),sT=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Role=s,this.UserDefinedRole=r,this.Description=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Role),e.push(this.UserDefinedRole),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),rT=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),nT=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),oT=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Purpose=s,this.Description=r,this.UserDefinedPurpose=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Purpose),e.push(this.Description),e.push(this.UserDefinedPurpose),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),aT=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Outer=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Outer),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),uT=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Outer=s,this.Voids=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Outer),e.push(this.Voids),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),hT=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Bounds=s,this.FaceSurface=r,this.SameSense=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Bounds),e.push(this.FaceSurface),e.push(this.SameSense),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),lT=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),cT=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),pT=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),dT=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),fT=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),mT=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),vT=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),gT=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),_T=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Axis=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Axis),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),yT=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.StartDistAlong=s,this.Segments=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.StartDistAlong),e.push(this.Segments),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),bT=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.TangentialContinuity=s,this.StartTag=r,this.EndTag=n,this.CurveGeometry=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.CurveGeometry),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),xT=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.TangentialContinuity=s,this.StartTag=r,this.EndTag=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),PT=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.TangentialContinuity=s,this.StartTag=r,this.EndTag=n,this.StartDistAlong=o,this.HorizontalLength=a,this.StartHeight=u,this.StartGradient=h,this.Radius=l,this.IsConvex=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.StartDistAlong),e.push(this.HorizontalLength),e.push(this.StartHeight),e.push(this.StartGradient),e.push(this.Radius),e.push(this.IsConvex),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),TT=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.TangentialContinuity=s,this.StartTag=r,this.EndTag=n,this.StartDistAlong=o,this.HorizontalLength=a,this.StartHeight=u,this.StartGradient=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.StartDistAlong),e.push(this.HorizontalLength),e.push(this.StartHeight),e.push(this.StartGradient),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),wT=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.TangentialContinuity=s,this.StartTag=r,this.EndTag=n,this.StartDistAlong=o,this.HorizontalLength=a,this.StartHeight=u,this.StartGradient=h,this.ParabolaConstant=l,this.IsConvex=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.StartDistAlong),e.push(this.HorizontalLength),e.push(this.StartHeight),e.push(this.StartGradient),e.push(this.ParabolaConstant),e.push(this.IsConvex),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),MT=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Segments=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Segments),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),IT=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.TangentialContinuity=s,this.StartTag=r,this.EndTag=n,this.StartDistAlong=o,this.HorizontalLength=a,this.StartHeight=u,this.StartGradient=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.StartDistAlong),e.push(this.HorizontalLength),e.push(this.StartHeight),e.push(this.StartGradient),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),CT=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Horizontal=s,this.Vertical=r,this.Tag=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Horizontal),e.push(this.Vertical),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),DT=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),AT=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.OuterBoundary=s,this.InnerBoundaries=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.OuterBoundary),e.push(this.InnerBoundaries),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),kT=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.ApplicationDeveloper=s,this.Version=r,this.ApplicationFullName=n,this.ApplicationIdentifier=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ApplicationDeveloper),e.push(this.Version),e.push(this.ApplicationFullName),e.push(this.ApplicationIdentifier),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),ET=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.AppliedValue=n,this.UnitBasis=o,this.ApplicableDate=a,this.FixedUntilDate=u,this.Category=h,this.Condition=l,this.ArithmeticOperator=c,this.Components=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.AppliedValue),e.push(this.UnitBasis),e.push(this.ApplicableDate),e.push(this.FixedUntilDate),e.push(this.Category),e.push(this.Condition),e.push(this.ArithmeticOperator),e.push(this.Components),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),FT=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.Identifier=s,this.Name=r,this.Description=n,this.TimeOfApproval=o,this.Status=a,this.Level=u,this.Qualifier=h,this.RequestingApproval=l,this.GivingApproval=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Identifier),e.push(this.Name),e.push(this.Description),e.push(this.TimeOfApproval),e.push(this.Status),e.push(this.Level),e.push(this.Qualifier),e.push(this.RequestingApproval),e.push(this.GivingApproval),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),RT=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.RelatingApproval=n,this.RelatedApprovals=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingApproval),e.push(this.RelatedApprovals),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),ST=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.OuterCurve=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.OuterCurve),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),OT=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Curve=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Curve),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),BT=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.OuterCurve=n,this.InnerCurves=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.OuterCurve),e.push(this.InnerCurves),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),LT=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.OriginalValue=h,this.CurrentValue=l,this.TotalReplacementCost=c,this.Owner=p,this.User=d,this.ResponsiblePerson=f,this.IncorporationDate=m,this.DepreciatedValue=v}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.OriginalValue),e.push(this.CurrentValue),e.push(this.TotalReplacementCost),e.push(this.Owner),e.push(this.User),e.push(this.ResponsiblePerson),e.push(this.IncorporationDate),e.push(this.DepreciatedValue),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),NT=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v,g){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n,this.BottomFlangeWidth=o,this.OverallDepth=a,this.WebThickness=u,this.BottomFlangeThickness=h,this.BottomFlangeFilletRadius=l,this.TopFlangeWidth=c,this.TopFlangeThickness=p,this.TopFlangeFilletRadius=d,this.BottomFlangeEdgeRadius=f,this.BottomFlangeSlope=m,this.TopFlangeEdgeRadius=v,this.TopFlangeSlope=g}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.BottomFlangeWidth),e.push(this.OverallDepth),e.push(this.WebThickness),e.push(this.BottomFlangeThickness),e.push(this.BottomFlangeFilletRadius),e.push(this.TopFlangeWidth),e.push(this.TopFlangeThickness),e.push(this.TopFlangeFilletRadius),e.push(this.BottomFlangeEdgeRadius),e.push(this.BottomFlangeSlope),e.push(this.TopFlangeEdgeRadius),e.push(this.TopFlangeSlope),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),jT=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),GT=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),HT=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Location=s,this.Axis=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Location),e.push(this.Axis),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),UT=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Location=s,this.RefDirection=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Location),e.push(this.RefDirection),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),VT=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Location=s,this.Axis=r,this.RefDirection=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Location),e.push(this.Axis),e.push(this.RefDirection),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),zT=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Degree=s,this.ControlPointsList=r,this.CurveForm=n,this.ClosedCurve=o,this.SelfIntersect=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Degree),e.push(this.ControlPointsList),e.push(this.CurveForm),e.push(this.ClosedCurve),e.push(this.SelfIntersect),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),WT=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.Degree=s,this.ControlPointsList=r,this.CurveForm=n,this.ClosedCurve=o,this.SelfIntersect=a,this.KnotMultiplicities=u,this.Knots=h,this.KnotSpec=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Degree),e.push(this.ControlPointsList),e.push(this.CurveForm),e.push(this.ClosedCurve),e.push(this.SelfIntersect),e.push(this.KnotMultiplicities),e.push(this.Knots),e.push(this.KnotSpec),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),XT=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.UDegree=s,this.VDegree=r,this.ControlPointsList=n,this.SurfaceForm=o,this.UClosed=a,this.VClosed=u,this.SelfIntersect=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.UDegree),e.push(this.VDegree),e.push(this.ControlPointsList),e.push(this.SurfaceForm),e.push(this.UClosed),e.push(this.VClosed),e.push(this.SelfIntersect),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),YT=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.UDegree=s,this.VDegree=r,this.ControlPointsList=n,this.SurfaceForm=o,this.UClosed=a,this.VClosed=u,this.SelfIntersect=h,this.UMultiplicities=l,this.VMultiplicities=c,this.UKnots=p,this.VKnots=d,this.KnotSpec=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.UDegree),e.push(this.VDegree),e.push(this.ControlPointsList),e.push(this.SurfaceForm),e.push(this.UClosed),e.push(this.VClosed),e.push(this.SelfIntersect),e.push(this.UMultiplicities),e.push(this.VMultiplicities),e.push(this.UKnots),e.push(this.VKnots),e.push(this.KnotSpec),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),KT=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),JT=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ZT=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),QT=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),qT=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),$T=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.RepeatS=s,this.RepeatT=r,this.Mode=n,this.TextureTransform=o,this.Parameter=a,this.RasterFormat=u,this.RasterCode=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.RepeatS),e.push(this.RepeatT),e.push(this.Mode),e.push(this.TextureTransform),e.push(this.Parameter),e.push(this.RasterFormat),e.push(this.RasterCode),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ew=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Position=s,this.XLength=r,this.YLength=n,this.ZLength=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Position),e.push(this.XLength),e.push(this.YLength),e.push(this.ZLength),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),tw=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),iw=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),sw=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Operator=s,this.FirstOperand=r,this.SecondOperand=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Operator),e.push(this.FirstOperand),e.push(this.SecondOperand),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),rw=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Operator=s,this.FirstOperand=r,this.SecondOperand=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Operator),e.push(this.FirstOperand),e.push(this.SecondOperand),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),nw=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Name=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),ow=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Segments=s,this.SelfIntersect=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Segments),e.push(this.SelfIntersect),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),aw=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.TranslationalStiffnessByLengthX=r,this.TranslationalStiffnessByLengthY=n,this.TranslationalStiffnessByLengthZ=o,this.RotationalStiffnessByLengthX=a,this.RotationalStiffnessByLengthY=u,this.RotationalStiffnessByLengthZ=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.TranslationalStiffnessByLengthX),e.push(this.TranslationalStiffnessByLengthY),e.push(this.TranslationalStiffnessByLengthZ),e.push(this.RotationalStiffnessByLengthX),e.push(this.RotationalStiffnessByLengthY),e.push(this.RotationalStiffnessByLengthZ),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),uw=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.TranslationalStiffnessByAreaX=r,this.TranslationalStiffnessByAreaY=n,this.TranslationalStiffnessByAreaZ=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.TranslationalStiffnessByAreaX),e.push(this.TranslationalStiffnessByAreaY),e.push(this.TranslationalStiffnessByAreaZ),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),hw=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.TranslationalStiffnessX=r,this.TranslationalStiffnessY=n,this.TranslationalStiffnessZ=o,this.RotationalStiffnessX=a,this.RotationalStiffnessY=u,this.RotationalStiffnessZ=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.TranslationalStiffnessX),e.push(this.TranslationalStiffnessY),e.push(this.TranslationalStiffnessZ),e.push(this.RotationalStiffnessX),e.push(this.RotationalStiffnessY),e.push(this.RotationalStiffnessZ),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),lw=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.TranslationalStiffnessX=r,this.TranslationalStiffnessY=n,this.TranslationalStiffnessZ=o,this.RotationalStiffnessX=a,this.RotationalStiffnessY=u,this.RotationalStiffnessZ=h,this.WarpingStiffness=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.TranslationalStiffnessX),e.push(this.TranslationalStiffnessY),e.push(this.TranslationalStiffnessZ),e.push(this.RotationalStiffnessX),e.push(this.RotationalStiffnessY),e.push(this.RotationalStiffnessZ),e.push(this.WarpingStiffness),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),cw=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),pw=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),dw=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Corner=s,this.XDim=r,this.YDim=n,this.ZDim=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Corner),e.push(this.XDim),e.push(this.YDim),e.push(this.ZDim),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),fw=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.BaseSurface=s,this.AgreementFlag=r,this.Enclosure=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.BaseSurface),e.push(this.AgreementFlag),e.push(this.Enclosure),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),mw=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.LongName=l,this.CompositionType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),vw=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.LongName=l,this.CompositionType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),gw=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.LongName=l,this.CompositionType=c,this.ElevationOfRefHeight=p,this.ElevationOfTerrain=d,this.BuildingAddress=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.ElevationOfRefHeight),e.push(this.ElevationOfTerrain),e.push(this.BuildingAddress),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),_w=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),yw=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),bw=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),xw=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Pw=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Tw=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ww=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.LongName=l,this.CompositionType=c,this.Elevation=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.Elevation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Mw=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.PredefinedType=u,this.LongName=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.LongName),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Iw=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Cw=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Dw=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n,this.Depth=o,this.Width=a,this.WallThickness=u,this.Girth=h,this.InternalFilletRadius=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.Width),e.push(this.WallThickness),e.push(this.Girth),e.push(this.InternalFilletRadius),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Aw=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),kw=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Ew=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Fw=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Rw=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Sw=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Ow=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Bw=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Lw=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Nw=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),jw=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Coordinates=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Coordinates),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),Gw=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),Hw=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.CoordList=s,this.TagList=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.CoordList),e.push(this.TagList),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),Uw=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.CoordList=s,this.TagList=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.CoordList),e.push(this.TagList),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),Vw=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Axis1=s,this.Axis2=r,this.LocalOrigin=n,this.Scale=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),zw=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Axis1=s,this.Axis2=r,this.LocalOrigin=n,this.Scale=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),Ww=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Axis1=s,this.Axis2=r,this.LocalOrigin=n,this.Scale=o,this.Scale2=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e.push(this.Scale2),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Xw=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Axis1=s,this.Axis2=r,this.LocalOrigin=n,this.Scale=o,this.Axis3=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e.push(this.Axis3),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Yw=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.Axis1=s,this.Axis2=r,this.LocalOrigin=n,this.Scale=o,this.Axis3=a,this.Scale2=u,this.Scale3=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e.push(this.Axis3),e.push(this.Scale2),e.push(this.Scale3),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Kw=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Curve=n,this.Thickness=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Curve),e.push(this.Thickness),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),Jw=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Zw=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Qw=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),qw=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),$w=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Position=s,this.Radius=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Position),e.push(this.Radius),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),eM=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n,this.Radius=o,this.WallThickness=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Radius),e.push(this.WallThickness),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),tM=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n,this.Radius=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Radius),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),iM=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.StartPoint=s,this.StartDirection=r,this.SegmentLength=n,this.Radius=o,this.IsCCW=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.StartPoint),e.push(this.StartDirection),e.push(this.SegmentLength),e.push(this.Radius),e.push(this.IsCCW),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),sM=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),rM=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),nM=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.Source=s,this.Edition=r,this.EditionDate=n,this.Name=o,this.Description=a,this.Location=u,this.ReferenceTokens=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Source),e.push(this.Edition),e.push(this.EditionDate),e.push(this.Name),e.push(this.Description),e.push(this.Location),e.push(this.ReferenceTokens),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),oM=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.Location=s,this.Identification=r,this.Name=n,this.ReferencedSource=o,this.Description=a,this.Sort=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e.push(this.ReferencedSource),e.push(this.Description),e.push(this.Sort),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),aM=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.CfsFaces=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.CfsFaces),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),uM=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),hM=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),lM=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Red=r,this.Green=n,this.Blue=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Red),e.push(this.Green),e.push(this.Blue),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),cM=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.ColourList=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ColourList),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),pM=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Name=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),dM=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),fM=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),mM=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),vM=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),gM=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),_M=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.UsageName=n,this.HasProperties=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.UsageName),e.push(this.HasProperties),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),yM=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.UsageName=a,this.TemplateType=u,this.HasPropertyTemplates=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.UsageName),e.push(this.TemplateType),e.push(this.HasPropertyTemplates),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),bM=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Segments=s,this.SelfIntersect=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Segments),e.push(this.SelfIntersect),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),xM=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Segments=s,this.SelfIntersect=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Segments),e.push(this.SelfIntersect),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),PM=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Transition=s,this.SameSense=r,this.ParentCurve=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Transition),e.push(this.SameSense),e.push(this.ParentCurve),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),TM=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Profiles=n,this.Label=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Profiles),e.push(this.Label),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),wM=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),MM=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),IM=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),CM=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),DM=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Position=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Position),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),AM=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.CfsFaces=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.CfsFaces),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),kM=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.CurveOnRelatingElement=s,this.CurveOnRelatedElement=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.CurveOnRelatingElement),e.push(this.CurveOnRelatedElement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),EM=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),FM=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.PointOnRelatingElement=s,this.PointOnRelatedElement=r,this.EccentricityInX=n,this.EccentricityInY=o,this.EccentricityInZ=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.PointOnRelatingElement),e.push(this.PointOnRelatedElement),e.push(this.EccentricityInX),e.push(this.EccentricityInY),e.push(this.EccentricityInZ),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),RM=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.PointOnRelatingElement=s,this.PointOnRelatedElement=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.PointOnRelatingElement),e.push(this.PointOnRelatedElement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),SM=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.SurfaceOnRelatingElement=s,this.SurfaceOnRelatedElement=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SurfaceOnRelatingElement),e.push(this.SurfaceOnRelatedElement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),OM=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.VolumeOnRelatingElement=s,this.VolumeOnRelatedElement=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.VolumeOnRelatingElement),e.push(this.VolumeOnRelatedElement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),BM=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.ConstraintGrade=n,this.ConstraintSource=o,this.CreatingActor=a,this.CreationTime=u,this.UserDefinedGrade=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.ConstraintGrade),e.push(this.ConstraintSource),e.push(this.CreatingActor),e.push(this.CreationTime),e.push(this.UserDefinedGrade),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),LM=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.LongDescription=h,this.Usage=l,this.BaseCosts=c,this.BaseQuantity=p,this.PredefinedType=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),NM=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.Identification=h,this.LongDescription=l,this.ResourceType=c,this.BaseCosts=p,this.BaseQuantity=d,this.PredefinedType=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),jM=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.LongDescription=h,this.Usage=l,this.BaseCosts=c,this.BaseQuantity=p,this.PredefinedType=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),GM=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.Identification=h,this.LongDescription=l,this.ResourceType=c,this.BaseCosts=p,this.BaseQuantity=d,this.PredefinedType=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),HM=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.LongDescription=h,this.Usage=l,this.BaseCosts=c,this.BaseQuantity=p,this.PredefinedType=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),UM=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.Identification=h,this.LongDescription=l,this.ResourceType=c,this.BaseCosts=p,this.BaseQuantity=d,this.PredefinedType=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),VM=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.LongDescription=h,this.Usage=l,this.BaseCosts=c,this.BaseQuantity=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),zM=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.Identification=h,this.LongDescription=l,this.ResourceType=c,this.BaseCosts=p,this.BaseQuantity=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),WM=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.LongName=u,this.Phase=h,this.RepresentationContexts=l,this.UnitsInContext=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.Phase),e.push(this.RepresentationContexts),e.push(this.UnitsInContext),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),XM=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Dimensions=s,this.UnitType=r,this.Name=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Dimensions),e.push(this.UnitType),e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),YM=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),KM=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),JM=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ZM=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Dimensions=s,this.UnitType=r,this.Name=n,this.ConversionFactor=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Dimensions),e.push(this.UnitType),e.push(this.Name),e.push(this.ConversionFactor),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),QM=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Dimensions=s,this.UnitType=r,this.Name=n,this.ConversionFactor=o,this.ConversionOffset=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Dimensions),e.push(this.UnitType),e.push(this.Name),e.push(this.ConversionFactor),e.push(this.ConversionOffset),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),qM=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),$M=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),eI=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),tI=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),iI=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.SourceCRS=s,this.TargetCRS=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SourceCRS),e.push(this.TargetCRS),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),sI=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.GeodeticDatum=n,this.VerticalDatum=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.GeodeticDatum),e.push(this.VerticalDatum),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),rI=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.PredefinedType=h,this.CostValues=l,this.CostQuantities=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.CostValues),e.push(this.CostQuantities),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),nI=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.PredefinedType=h,this.Status=l,this.SubmittedOn=c,this.UpdateDate=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.Status),e.push(this.SubmittedOn),e.push(this.UpdateDate),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),oI=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.AppliedValue=n,this.UnitBasis=o,this.ApplicableDate=a,this.FixedUntilDate=u,this.Category=h,this.Condition=l,this.ArithmeticOperator=c,this.Components=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.AppliedValue),e.push(this.UnitBasis),e.push(this.ApplicableDate),e.push(this.FixedUntilDate),e.push(this.Category),e.push(this.Condition),e.push(this.ArithmeticOperator),e.push(this.Components),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),aI=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),uI=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),hI=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.LongDescription=h,this.Usage=l,this.BaseCosts=c,this.BaseQuantity=p,this.PredefinedType=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),lI=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.Identification=h,this.LongDescription=l,this.ResourceType=c,this.BaseCosts=p,this.BaseQuantity=d,this.PredefinedType=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),cI=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Position=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Position),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),pI=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.TreeRootExpression=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.TreeRootExpression),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),dI=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.RelatingMonetaryUnit=n,this.RelatedMonetaryUnit=o,this.ExchangeRate=a,this.RateDateTime=u,this.RateSource=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingMonetaryUnit),e.push(this.RelatedMonetaryUnit),e.push(this.ExchangeRate),e.push(this.RateDateTime),e.push(this.RateSource),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),fI=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),mI=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),vI=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),gI=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.BasisSurface=s,this.OuterBoundary=r,this.InnerBoundaries=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.BasisSurface),e.push(this.OuterBoundary),e.push(this.InnerBoundaries),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),_I=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.BasisSurface=s,this.Boundaries=r,this.ImplicitOuter=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.BasisSurface),e.push(this.Boundaries),e.push(this.ImplicitOuter),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),yI=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.StartPoint=s,this.StartDirection=r,this.SegmentLength=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.StartPoint),e.push(this.StartDirection),e.push(this.SegmentLength),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),bI=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.CurveFont=r,this.CurveWidth=n,this.CurveColour=o,this.ModelOrDraughting=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.CurveFont),e.push(this.CurveWidth),e.push(this.CurveColour),e.push(this.ModelOrDraughting),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),xI=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.PatternList=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.PatternList),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),PI=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.CurveFont=r,this.CurveFontScaling=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.CurveFont),e.push(this.CurveFontScaling),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),TI=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.VisibleSegmentLength=s,this.InvisibleSegmentLength=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.VisibleSegmentLength),e.push(this.InvisibleSegmentLength),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),wI=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Position=s,this.Radius=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Position),e.push(this.Radius),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),MI=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),II=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),CI=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),DI=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),AI=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.ParentProfile=n,this.Operator=o,this.Label=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.ParentProfile),e.push(this.Operator),e.push(this.Label),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),kI=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Elements=s,this.UnitType=r,this.UserDefinedType=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Elements),e.push(this.UnitType),e.push(this.UserDefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),EI=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Unit=s,this.Exponent=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Unit),e.push(this.Exponent),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),FI=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.LengthExponent=s,this.MassExponent=r,this.TimeExponent=n,this.ElectricCurrentExponent=o,this.ThermodynamicTemperatureExponent=a,this.AmountOfSubstanceExponent=u,this.LuminousIntensityExponent=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.LengthExponent),e.push(this.MassExponent),e.push(this.TimeExponent),e.push(this.ElectricCurrentExponent),e.push(this.ThermodynamicTemperatureExponent),e.push(this.AmountOfSubstanceExponent),e.push(this.LuminousIntensityExponent),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),RI=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.DirectionRatios=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.DirectionRatios),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),SI=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),OI=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),BI=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.DistanceAlong=s,this.OffsetLateral=r,this.OffsetVertical=n,this.OffsetLongitudinal=o,this.AlongHorizontal=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.DistanceAlong),e.push(this.OffsetLateral),e.push(this.OffsetVertical),e.push(this.OffsetLongitudinal),e.push(this.AlongHorizontal),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),LI=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),NI=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),jI=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.LongName=u,this.PredefinedType=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),GI=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),HI=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),UI=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),VI=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),zI=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),WI=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),XI=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.FlowDirection=l,this.PredefinedType=c,this.SystemType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.FlowDirection),e.push(this.PredefinedType),e.push(this.SystemType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),YI=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.LongName=u,this.PredefinedType=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),KI=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v,g,_,y){w(this,e),this.expressID=t,this.type=i,this.Identification=s,this.Name=r,this.Description=n,this.Location=o,this.Purpose=a,this.IntendedUse=u,this.Scope=h,this.Revision=l,this.DocumentOwner=c,this.Editors=p,this.CreationTime=d,this.LastRevisionTime=f,this.ElectronicFormat=m,this.ValidFrom=v,this.ValidUntil=g,this.Confidentiality=_,this.Status=y}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Identification),e.push(this.Name),e.push(this.Description),e.push(this.Location),e.push(this.Purpose),e.push(this.IntendedUse),e.push(this.Scope),e.push(this.Revision),e.push(this.DocumentOwner),e.push(this.Editors),e.push(this.CreationTime),e.push(this.LastRevisionTime),e.push(this.ElectronicFormat),e.push(this.ValidFrom),e.push(this.ValidUntil),e.push(this.Confidentiality),e.push(this.Status),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),JI=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.RelatingDocument=n,this.RelatedDocuments=o,this.RelationshipType=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingDocument),e.push(this.RelatedDocuments),e.push(this.RelationshipType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ZI=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Location=s,this.Identification=r,this.Name=n,this.Description=o,this.ReferencedDocument=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e.push(this.Description),e.push(this.ReferencedDocument),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),QI=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.OverallHeight=c,this.OverallWidth=p,this.PredefinedType=d,this.OperationType=f,this.UserDefinedOperationType=m}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.OverallHeight),e.push(this.OverallWidth),e.push(this.PredefinedType),e.push(this.OperationType),e.push(this.UserDefinedOperationType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),qI=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v,g,_,y){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.LiningDepth=a,this.LiningThickness=u,this.ThresholdDepth=h,this.ThresholdThickness=l,this.TransomThickness=c,this.TransomOffset=p,this.LiningOffset=d,this.ThresholdOffset=f,this.CasingThickness=m,this.CasingDepth=v,this.ShapeAspectStyle=g,this.LiningToPanelOffsetX=_,this.LiningToPanelOffsetY=y}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.LiningDepth),e.push(this.LiningThickness),e.push(this.ThresholdDepth),e.push(this.ThresholdThickness),e.push(this.TransomThickness),e.push(this.TransomOffset),e.push(this.LiningOffset),e.push(this.ThresholdOffset),e.push(this.CasingThickness),e.push(this.CasingDepth),e.push(this.ShapeAspectStyle),e.push(this.LiningToPanelOffsetX),e.push(this.LiningToPanelOffsetY),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),$I=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.PanelDepth=a,this.PanelOperation=u,this.PanelWidth=h,this.PanelPosition=l,this.ShapeAspectStyle=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.PanelDepth),e.push(this.PanelOperation),e.push(this.PanelWidth),e.push(this.PanelPosition),e.push(this.ShapeAspectStyle),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),eC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.OverallHeight=c,this.OverallWidth=p,this.PredefinedType=d,this.OperationType=f,this.UserDefinedOperationType=m}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.OverallHeight),e.push(this.OverallWidth),e.push(this.PredefinedType),e.push(this.OperationType),e.push(this.UserDefinedOperationType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),tC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.OperationType=c,this.ConstructionType=p,this.ParameterTakesPrecedence=d,this.Sizeable=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.OperationType),e.push(this.ConstructionType),e.push(this.ParameterTakesPrecedence),e.push(this.Sizeable),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),iC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p,this.OperationType=d,this.ParameterTakesPrecedence=f,this.UserDefinedOperationType=m}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.OperationType),e.push(this.ParameterTakesPrecedence),e.push(this.UserDefinedOperationType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),sC=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Name=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),rC=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Name=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),nC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),oC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),aC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),uC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),hC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),lC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),cC=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.EdgeStart=s,this.EdgeEnd=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.EdgeStart),e.push(this.EdgeEnd),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),pC=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.EdgeStart=s,this.EdgeEnd=r,this.EdgeGeometry=n,this.SameSense=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.EdgeStart),e.push(this.EdgeEnd),e.push(this.EdgeGeometry),e.push(this.SameSense),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),dC=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.EdgeList=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.EdgeList),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),fC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),mC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),vC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),gC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),_C=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),yC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),bC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),xC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),PC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),TC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),wC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),MC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),IC=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),CC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.AssemblyPlace=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.AssemblyPlace),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),DC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),AC=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),kC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),EC=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.MethodOfMeasurement=a,this.Quantities=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.MethodOfMeasurement),e.push(this.Quantities),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),FC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),RC=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Position=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Position),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),SC=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Position=s,this.SemiAxis1=r,this.SemiAxis2=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Position),e.push(this.SemiAxis1),e.push(this.SemiAxis2),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),OC=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n,this.SemiAxis1=o,this.SemiAxis2=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.SemiAxis1),e.push(this.SemiAxis2),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),BC=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),LC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),NC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),jC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),GC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),HC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),UC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),VC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),zC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.LongDescription=h,this.PredefinedType=l,this.EventTriggerType=c,this.UserDefinedEventTriggerType=p,this.EventOccurenceTime=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.PredefinedType),e.push(this.EventTriggerType),e.push(this.UserDefinedEventTriggerType),e.push(this.EventOccurenceTime),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),WC=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.DataOrigin=r,this.UserDefinedDataOrigin=n,this.ActualDate=o,this.EarlyDate=a,this.LateDate=u,this.ScheduleDate=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.ActualDate),e.push(this.EarlyDate),e.push(this.LateDate),e.push(this.ScheduleDate),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),XC=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.Identification=h,this.LongDescription=l,this.ProcessType=c,this.PredefinedType=p,this.EventTriggerType=d,this.UserDefinedEventTriggerType=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ProcessType),e.push(this.PredefinedType),e.push(this.EventTriggerType),e.push(this.UserDefinedEventTriggerType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),YC=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Properties=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Properties),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),KC=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),JC=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Location=s,this.Identification=r,this.Name=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),ZC=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.RelatingReference=n,this.RelatedResourceObjects=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingReference),e.push(this.RelatedResourceObjects),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),QC=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.LongName=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),qC=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.LongName=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),$C=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Location=s,this.Identification=r,this.Name=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),eD=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Location=s,this.Identification=r,this.Name=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),tD=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Location=s,this.Identification=r,this.Name=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),iD=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.SweptArea=s,this.Position=r,this.ExtrudedDirection=n,this.Depth=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.ExtrudedDirection),e.push(this.Depth),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),sD=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.SweptArea=s,this.Position=r,this.ExtrudedDirection=n,this.Depth=o,this.EndSweptArea=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.ExtrudedDirection),e.push(this.Depth),e.push(this.EndSweptArea),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),rD=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Bounds=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Bounds),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),nD=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.FbsmFaces=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.FbsmFaces),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),oD=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Bound=s,this.Orientation=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Bound),e.push(this.Orientation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),aD=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Bound=s,this.Orientation=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Bound),e.push(this.Orientation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),uD=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Bounds=s,this.FaceSurface=r,this.SameSense=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Bounds),e.push(this.FaceSurface),e.push(this.SameSense),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),hD=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Outer=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Outer),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),lD=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Outer=s,this.Voids=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Outer),e.push(this.Voids),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),cD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.LongName=l,this.CompositionType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),pD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.LongName=l,this.CompositionType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),dD=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.TensionFailureX=r,this.TensionFailureY=n,this.TensionFailureZ=o,this.CompressionFailureX=a,this.CompressionFailureY=u,this.CompressionFailureZ=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.TensionFailureX),e.push(this.TensionFailureY),e.push(this.TensionFailureZ),e.push(this.CompressionFailureX),e.push(this.CompressionFailureY),e.push(this.CompressionFailureZ),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),fD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),mD=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),vD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),gD=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),_D=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),yD=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),bD=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),xD=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.FillStyles=r,this.ModelorDraughting=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.FillStyles),e.push(this.ModelorDraughting),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),PD=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.HatchLineAppearance=s,this.StartOfNextHatchLine=r,this.PointOfReferenceHatchLine=n,this.PatternStart=o,this.HatchLineAngle=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.HatchLineAppearance),e.push(this.StartOfNextHatchLine),e.push(this.PointOfReferenceHatchLine),e.push(this.PatternStart),e.push(this.HatchLineAngle),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),TD=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.TilingPattern=s,this.Tiles=r,this.TilingScale=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.TilingPattern),e.push(this.Tiles),e.push(this.TilingScale),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),wD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),MD=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ID=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),CD=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),DD=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.SweptArea=s,this.Position=r,this.Directrix=n,this.StartParam=o,this.EndParam=a,this.FixedReference=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.Directrix),e.push(this.StartParam),e.push(this.EndParam),e.push(this.FixedReference),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),AD=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),kD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ED=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),FD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),RD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),SD=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),OD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),BD=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),LD=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ND=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),jD=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),GD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),HD=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),UD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),VD=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),zD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),WD=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),XD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),YD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),KD=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),JD=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ZD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),QD=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),qD=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.AssemblyPlace=p,this.PredefinedType=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.AssemblyPlace),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),$D=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),eA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),tA=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Elements=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Elements),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),iA=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.ContextIdentifier=s,this.ContextType=r,this.CoordinateSpaceDimension=n,this.Precision=o,this.WorldCoordinateSystem=a,this.TrueNorth=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ContextIdentifier),e.push(this.ContextType),e.push(this.CoordinateSpaceDimension),e.push(this.Precision),e.push(this.WorldCoordinateSystem),e.push(this.TrueNorth),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),sA=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),rA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.ContextIdentifier=s,this.ContextType=r,this.CoordinateSpaceDimension=n,this.Precision=o,this.WorldCoordinateSystem=a,this.TrueNorth=u,this.ParentContext=h,this.TargetScale=l,this.TargetView=c,this.UserDefinedTargetView=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ContextIdentifier),e.push(this.ContextType),e.push(this.CoordinateSpaceDimension),e.push(this.Precision),e.push(this.WorldCoordinateSystem),e.push(this.TrueNorth),e.push(this.ParentContext),e.push(this.TargetScale),e.push(this.TargetView),e.push(this.UserDefinedTargetView),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),nA=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Elements=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Elements),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),oA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.UAxes=l,this.VAxes=c,this.WAxes=p,this.PredefinedType=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.UAxes),e.push(this.VAxes),e.push(this.WAxes),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),aA=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.AxisTag=s,this.AxisCurve=r,this.SameSense=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.AxisTag),e.push(this.AxisCurve),e.push(this.SameSense),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),uA=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.PlacementRelTo=s,this.PlacementLocation=r,this.PlacementRefDirection=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.PlacementRelTo),e.push(this.PlacementLocation),e.push(this.PlacementRefDirection),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),hA=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),lA=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.BaseSurface=s,this.AgreementFlag=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.BaseSurface),e.push(this.AgreementFlag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),cA=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),pA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),dA=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),fA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),mA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n,this.OverallWidth=o,this.OverallDepth=a,this.WebThickness=u,this.FlangeThickness=h,this.FilletRadius=l,this.FlangeEdgeRadius=c,this.FlangeSlope=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.OverallWidth),e.push(this.OverallDepth),e.push(this.WebThickness),e.push(this.FlangeThickness),e.push(this.FilletRadius),e.push(this.FlangeEdgeRadius),e.push(this.FlangeSlope),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),vA=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.RepeatS=s,this.RepeatT=r,this.Mode=n,this.TextureTransform=o,this.Parameter=a,this.URLReference=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.RepeatS),e.push(this.RepeatT),e.push(this.Mode),e.push(this.TextureTransform),e.push(this.Parameter),e.push(this.URLReference),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),gA=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.MappedTo=s,this.Opacity=r,this.Colours=n,this.ColourIndex=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.MappedTo),e.push(this.Opacity),e.push(this.Colours),e.push(this.ColourIndex),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),_A=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Points=s,this.Segments=r,this.SelfIntersect=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Points),e.push(this.Segments),e.push(this.SelfIntersect),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),yA=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.CoordIndex=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.CoordIndex),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),bA=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.CoordIndex=s,this.InnerCoordIndices=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.CoordIndex),e.push(this.InnerCoordIndices),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),xA=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Maps=s,this.MappedTo=r,this.TexCoords=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Maps),e.push(this.MappedTo),e.push(this.TexCoords),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),PA=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Maps=s,this.MappedTo=r,this.TexCoords=n,this.TexCoordIndex=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Maps),e.push(this.MappedTo),e.push(this.TexCoords),e.push(this.TexCoordIndex),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),TA=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),wA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),MA=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Curve3D=s,this.AssociatedGeometry=r,this.MasterRepresentation=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Curve3D),e.push(this.AssociatedGeometry),e.push(this.MasterRepresentation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),IA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.PredefinedType=u,this.Jurisdiction=h,this.ResponsiblePersons=l,this.LastUpdateDate=c,this.CurrentValue=p,this.OriginalValue=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.Jurisdiction),e.push(this.ResponsiblePersons),e.push(this.LastUpdateDate),e.push(this.CurrentValue),e.push(this.OriginalValue),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),CA=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.StartTime=n,this.EndTime=o,this.TimeSeriesDataType=a,this.DataOrigin=u,this.UserDefinedDataOrigin=h,this.Unit=l,this.Values=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.StartTime),e.push(this.EndTime),e.push(this.TimeSeriesDataType),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.Unit),e.push(this.Values),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),DA=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.TimeStamp=s,this.ListValues=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.TimeStamp),e.push(this.ListValues),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),AA=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),kA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),EA=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n,this.Depth=o,this.Width=a,this.Thickness=u,this.FilletRadius=h,this.EdgeRadius=l,this.LegSlope=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.Width),e.push(this.Thickness),e.push(this.FilletRadius),e.push(this.EdgeRadius),e.push(this.LegSlope),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),FA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.LongDescription=h,this.Usage=l,this.BaseCosts=c,this.BaseQuantity=p,this.PredefinedType=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),RA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.Identification=h,this.LongDescription=l,this.ResourceType=c,this.BaseCosts=p,this.BaseQuantity=d,this.PredefinedType=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),SA=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.DataOrigin=r,this.UserDefinedDataOrigin=n,this.LagValue=o,this.DurationType=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.LagValue),e.push(this.DurationType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),OA=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),BA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),LA=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Version=r,this.Publisher=n,this.VersionDate=o,this.Location=a,this.Description=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Version),e.push(this.Publisher),e.push(this.VersionDate),e.push(this.Location),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),NA=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.Location=s,this.Identification=r,this.Name=n,this.Description=o,this.Language=a,this.ReferencedLibrary=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e.push(this.Description),e.push(this.Language),e.push(this.ReferencedLibrary),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),jA=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.MainPlaneAngle=s,this.SecondaryPlaneAngle=r,this.LuminousIntensity=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.MainPlaneAngle),e.push(this.SecondaryPlaneAngle),e.push(this.LuminousIntensity),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),GA=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),HA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),UA=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.LightDistributionCurve=s,this.DistributionData=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.LightDistributionCurve),e.push(this.DistributionData),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),VA=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.LightColour=r,this.AmbientIntensity=n,this.Intensity=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),zA=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.LightColour=r,this.AmbientIntensity=n,this.Intensity=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),WA=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.LightColour=r,this.AmbientIntensity=n,this.Intensity=o,this.Orientation=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e.push(this.Orientation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),XA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.LightColour=r,this.AmbientIntensity=n,this.Intensity=o,this.Position=a,this.ColourAppearance=u,this.ColourTemperature=h,this.LuminousFlux=l,this.LightEmissionSource=c,this.LightDistributionDataSource=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e.push(this.Position),e.push(this.ColourAppearance),e.push(this.ColourTemperature),e.push(this.LuminousFlux),e.push(this.LightEmissionSource),e.push(this.LightDistributionDataSource),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),YA=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.LightColour=r,this.AmbientIntensity=n,this.Intensity=o,this.Position=a,this.Radius=u,this.ConstantAttenuation=h,this.DistanceAttenuation=l,this.QuadricAttenuation=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e.push(this.Position),e.push(this.Radius),e.push(this.ConstantAttenuation),e.push(this.DistanceAttenuation),e.push(this.QuadricAttenuation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),KA=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.LightColour=r,this.AmbientIntensity=n,this.Intensity=o,this.Position=a,this.Radius=u,this.ConstantAttenuation=h,this.DistanceAttenuation=l,this.QuadricAttenuation=c,this.Orientation=p,this.ConcentrationExponent=d,this.SpreadAngle=f,this.BeamWidthAngle=m}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e.push(this.Position),e.push(this.Radius),e.push(this.ConstantAttenuation),e.push(this.DistanceAttenuation),e.push(this.QuadricAttenuation),e.push(this.Orientation),e.push(this.ConcentrationExponent),e.push(this.SpreadAngle),e.push(this.BeamWidthAngle),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),JA=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Pnt=s,this.Dir=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Pnt),e.push(this.Dir),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),ZA=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.StartPoint=s,this.StartDirection=r,this.SegmentLength=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.StartPoint),e.push(this.StartDirection),e.push(this.SegmentLength),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),QA=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.PlacementRelTo=s,this.PlacementMeasuredAlong=r,this.Distance=n,this.Orientation=o,this.CartesianPosition=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.PlacementRelTo),e.push(this.PlacementMeasuredAlong),e.push(this.Distance),e.push(this.Orientation),e.push(this.CartesianPosition),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),qA=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Axis=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Axis),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),$A=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.PlacementRelTo=s,this.RelativePlacement=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.PlacementRelTo),e.push(this.RelativePlacement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),ek=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),tk=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Outer=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Outer),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),ik=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.SourceCRS=s,this.TargetCRS=r,this.Eastings=n,this.Northings=o,this.OrthogonalHeight=a,this.XAxisAbscissa=u,this.XAxisOrdinate=h,this.Scale=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SourceCRS),e.push(this.TargetCRS),e.push(this.Eastings),e.push(this.Northings),e.push(this.OrthogonalHeight),e.push(this.XAxisAbscissa),e.push(this.XAxisOrdinate),e.push(this.Scale),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),sk=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.MappingSource=s,this.MappingTarget=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.MappingSource),e.push(this.MappingTarget),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),rk=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Category=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Category),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),nk=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.MaterialClassifications=s,this.ClassifiedMaterial=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.MaterialClassifications),e.push(this.ClassifiedMaterial),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),ok=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Material=n,this.Fraction=o,this.Category=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Material),e.push(this.Fraction),e.push(this.Category),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ak=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.MaterialConstituents=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.MaterialConstituents),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),uk=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),hk=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Representations=n,this.RepresentedMaterial=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Representations),e.push(this.RepresentedMaterial),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),lk=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.Material=s,this.LayerThickness=r,this.IsVentilated=n,this.Name=o,this.Description=a,this.Category=u,this.Priority=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Material),e.push(this.LayerThickness),e.push(this.IsVentilated),e.push(this.Name),e.push(this.Description),e.push(this.Category),e.push(this.Priority),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ck=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.MaterialLayers=s,this.LayerSetName=r,this.Description=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.MaterialLayers),e.push(this.LayerSetName),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),pk=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.ForLayerSet=s,this.LayerSetDirection=r,this.DirectionSense=n,this.OffsetFromReferenceLine=o,this.ReferenceExtent=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ForLayerSet),e.push(this.LayerSetDirection),e.push(this.DirectionSense),e.push(this.OffsetFromReferenceLine),e.push(this.ReferenceExtent),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),dk=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.Material=s,this.LayerThickness=r,this.IsVentilated=n,this.Name=o,this.Description=a,this.Category=u,this.Priority=h,this.OffsetDirection=l,this.OffsetValues=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Material),e.push(this.LayerThickness),e.push(this.IsVentilated),e.push(this.Name),e.push(this.Description),e.push(this.Category),e.push(this.Priority),e.push(this.OffsetDirection),e.push(this.OffsetValues),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),fk=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Materials=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Materials),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),mk=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Material=n,this.Profile=o,this.Priority=a,this.Category=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Material),e.push(this.Profile),e.push(this.Priority),e.push(this.Category),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),vk=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.MaterialProfiles=n,this.CompositeProfile=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.MaterialProfiles),e.push(this.CompositeProfile),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),gk=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.ForProfileSet=s,this.CardinalPoint=r,this.ReferenceExtent=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ForProfileSet),e.push(this.CardinalPoint),e.push(this.ReferenceExtent),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),_k=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.ForProfileSet=s,this.CardinalPoint=r,this.ReferenceExtent=n,this.ForProfileEndSet=o,this.CardinalEndPoint=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ForProfileSet),e.push(this.CardinalPoint),e.push(this.ReferenceExtent),e.push(this.ForProfileEndSet),e.push(this.CardinalEndPoint),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),yk=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Material=n,this.Profile=o,this.Priority=a,this.Category=u,this.OffsetValues=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Material),e.push(this.Profile),e.push(this.Priority),e.push(this.Category),e.push(this.OffsetValues),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),bk=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Properties=n,this.Material=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Properties),e.push(this.Material),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),xk=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.RelatingMaterial=n,this.RelatedMaterials=o,this.Expression=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingMaterial),e.push(this.RelatedMaterials),e.push(this.Expression),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Pk=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),Tk=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.ValueComponent=s,this.UnitComponent=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ValueComponent),e.push(this.UnitComponent),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),wk=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.NominalDiameter=c,this.NominalLength=p,this.PredefinedType=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.NominalDiameter),e.push(this.NominalLength),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Mk=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p,this.NominalDiameter=d,this.NominalLength=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.NominalDiameter),e.push(this.NominalLength),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Ik=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Ck=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Dk=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Ak=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),kk=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Ek=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.ConstraintGrade=n,this.ConstraintSource=o,this.CreatingActor=a,this.CreationTime=u,this.UserDefinedGrade=h,this.Benchmark=l,this.ValueSource=c,this.DataValue=p,this.ReferencePath=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.ConstraintGrade),e.push(this.ConstraintSource),e.push(this.CreatingActor),e.push(this.CreationTime),e.push(this.UserDefinedGrade),e.push(this.Benchmark),e.push(this.ValueSource),e.push(this.DataValue),e.push(this.ReferencePath),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Fk=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.ParentProfile=n,this.Operator=o,this.Label=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.ParentProfile),e.push(this.Operator),e.push(this.Label),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Rk=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Currency=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Currency),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),Sk=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Ok=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Bk=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Dimensions=s,this.UnitType=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Dimensions),e.push(this.UnitType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),Lk=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Nk=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),jk=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.PlacementRelTo=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.PlacementRelTo),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),Gk=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.ConstraintGrade=n,this.ConstraintSource=o,this.CreatingActor=a,this.CreationTime=u,this.UserDefinedGrade=h,this.BenchmarkValues=l,this.LogicalAggregator=c,this.ObjectiveQualifier=p,this.UserDefinedQualifier=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.ConstraintGrade),e.push(this.ConstraintSource),e.push(this.CreatingActor),e.push(this.CreationTime),e.push(this.UserDefinedGrade),e.push(this.BenchmarkValues),e.push(this.LogicalAggregator),e.push(this.ObjectiveQualifier),e.push(this.UserDefinedQualifier),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Hk=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.TheActor=u,this.PredefinedType=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.TheActor),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Uk=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.BasisCurve=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.BasisCurve),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),Vk=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.BasisCurve=s,this.Distance=r,this.SelfIntersect=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.BasisCurve),e.push(this.Distance),e.push(this.SelfIntersect),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),zk=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.BasisCurve=s,this.Distance=r,this.SelfIntersect=n,this.RefDirection=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.BasisCurve),e.push(this.Distance),e.push(this.SelfIntersect),e.push(this.RefDirection),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),Wk=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.BasisCurve=s,this.OffsetValues=r,this.Tag=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.BasisCurve),e.push(this.OffsetValues),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),Xk=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.CfsFaces=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.CfsFaces),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),Yk=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Kk=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Jk=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Identification=s,this.Name=r,this.Description=n,this.Roles=o,this.Addresses=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Identification),e.push(this.Name),e.push(this.Description),e.push(this.Roles),e.push(this.Addresses),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),Zk=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.RelatingOrganization=n,this.RelatedOrganizations=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingOrganization),e.push(this.RelatedOrganizations),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),Qk=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.LateralAxisDirection=s,this.VerticalAxisDirection=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.LateralAxisDirection),e.push(this.VerticalAxisDirection),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),qk=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.EdgeStart=s,this.EdgeEnd=r,this.EdgeElement=n,this.Orientation=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.EdgeStart),e.push(this.EdgeEnd),e.push(this.EdgeElement),e.push(this.Orientation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),$k=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Segments=s,this.SelfIntersect=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Segments),e.push(this.SelfIntersect),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),eE=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),tE=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),iE=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.OwningUser=s,this.OwningApplication=r,this.State=n,this.ChangeAction=o,this.LastModifiedDate=a,this.LastModifyingUser=u,this.LastModifyingApplication=h,this.CreationDate=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.OwningUser),e.push(this.OwningApplication),e.push(this.State),e.push(this.ChangeAction),e.push(this.LastModifiedDate),e.push(this.LastModifyingUser),e.push(this.LastModifyingApplication),e.push(this.CreationDate),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),sE=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),rE=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.EdgeList=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.EdgeList),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),nE=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.BasisSurface=s,this.ReferenceCurve=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.BasisSurface),e.push(this.ReferenceCurve),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),oE=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.LifeCyclePhase=h,this.PredefinedType=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LifeCyclePhase),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),aE=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.OperationType=a,this.PanelPosition=u,this.FrameDepth=h,this.FrameThickness=l,this.ShapeAspectStyle=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.OperationType),e.push(this.PanelPosition),e.push(this.FrameDepth),e.push(this.FrameThickness),e.push(this.ShapeAspectStyle),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),uE=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.PredefinedType=h,this.Status=l,this.LongDescription=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.Status),e.push(this.LongDescription),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),hE=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.Identification=s,this.FamilyName=r,this.GivenName=n,this.MiddleNames=o,this.PrefixTitles=a,this.SuffixTitles=u,this.Roles=h,this.Addresses=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Identification),e.push(this.FamilyName),e.push(this.GivenName),e.push(this.MiddleNames),e.push(this.PrefixTitles),e.push(this.SuffixTitles),e.push(this.Roles),e.push(this.Addresses),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),lE=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.ThePerson=s,this.TheOrganization=r,this.Roles=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ThePerson),e.push(this.TheOrganization),e.push(this.Roles),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),cE=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.HasQuantities=n,this.Discrimination=o,this.Quality=a,this.Usage=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.HasQuantities),e.push(this.Discrimination),e.push(this.Quality),e.push(this.Usage),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),pE=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),dE=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Unit=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),fE=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c,this.ConstructionType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e.push(this.ConstructionType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),mE=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),vE=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),gE=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),_E=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),yE=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),bE=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.RepeatS=s,this.RepeatT=r,this.Mode=n,this.TextureTransform=o,this.Parameter=a,this.Width=u,this.Height=h,this.ColourComponents=l,this.Pixel=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.RepeatS),e.push(this.RepeatT),e.push(this.Mode),e.push(this.TextureTransform),e.push(this.Parameter),e.push(this.Width),e.push(this.Height),e.push(this.ColourComponents),e.push(this.Pixel),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),xE=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Location=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Location),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),PE=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.SizeInX=s,this.SizeInY=r,this.Placement=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SizeInX),e.push(this.SizeInY),e.push(this.Placement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),TE=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.SizeInX=s,this.SizeInY=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SizeInX),e.push(this.SizeInY),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),wE=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Position=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Position),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),ME=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),IE=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),CE=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),DE=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),AE=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.BasisCurve=s,this.PointParameter=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.BasisCurve),e.push(this.PointParameter),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),kE=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.BasisSurface=s,this.PointParameterU=r,this.PointParameterV=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.BasisSurface),e.push(this.PointParameterU),e.push(this.PointParameterV),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),EE=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Polygon=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Polygon),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),FE=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.BaseSurface=s,this.AgreementFlag=r,this.Position=n,this.PolygonalBoundary=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.BaseSurface),e.push(this.AgreementFlag),e.push(this.Position),e.push(this.PolygonalBoundary),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),RE=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Coordinates=s,this.Closed=r,this.Faces=n,this.PnIndex=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Coordinates),e.push(this.Closed),e.push(this.Faces),e.push(this.PnIndex),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),SE=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Points=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Points),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),OE=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),BE=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),LE=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.Purpose=s,this.Description=r,this.UserDefinedPurpose=n,this.InternalLocation=o,this.AddressLines=a,this.PostalBox=u,this.Town=h,this.Region=l,this.PostalCode=c,this.Country=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Purpose),e.push(this.Description),e.push(this.UserDefinedPurpose),e.push(this.InternalLocation),e.push(this.AddressLines),e.push(this.PostalBox),e.push(this.Town),e.push(this.Region),e.push(this.PostalCode),e.push(this.Country),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),NE=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Name=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),jE=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Name=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),GE=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Name=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),HE=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),UE=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),VE=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Name=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),zE=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),WE=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.AssignedItems=n,this.Identifier=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.AssignedItems),e.push(this.Identifier),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),XE=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.AssignedItems=n,this.Identifier=o,this.LayerOn=a,this.LayerFrozen=u,this.LayerBlocked=h,this.LayerStyles=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.AssignedItems),e.push(this.Identifier),e.push(this.LayerOn),e.push(this.LayerFrozen),e.push(this.LayerBlocked),e.push(this.LayerStyles),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),YE=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Name=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),KE=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Styles=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Styles),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),JE=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.LongDescription=h,this.PredefinedType=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ZE=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.Identification=h,this.LongDescription=l,this.ProcessType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ProcessType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),QE=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.LongDescription=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),qE=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),$E=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Representations=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Representations),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),eF=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Representations=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Representations),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),tF=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),iF=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Properties=n,this.ProfileDefinition=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Properties),e.push(this.ProfileDefinition),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),sF=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.LongName=u,this.Phase=h,this.RepresentationContexts=l,this.UnitsInContext=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.Phase),e.push(this.RepresentationContexts),e.push(this.UnitsInContext),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),rF=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.LongName=u,this.Phase=h,this.RepresentationContexts=l,this.UnitsInContext=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.Phase),e.push(this.RepresentationContexts),e.push(this.UnitsInContext),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),nF=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.PredefinedType=h,this.Status=l,this.LongDescription=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.Status),e.push(this.LongDescription),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),oF=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.GeodeticDatum=n,this.VerticalDatum=o,this.MapProjection=a,this.MapZone=u,this.MapUnit=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.GeodeticDatum),e.push(this.VerticalDatum),e.push(this.MapProjection),e.push(this.MapZone),e.push(this.MapUnit),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),aF=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),uF=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),hF=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),lF=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.UpperBoundValue=n,this.LowerBoundValue=o,this.Unit=a,this.SetPointValue=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.UpperBoundValue),e.push(this.LowerBoundValue),e.push(this.Unit),e.push(this.SetPointValue),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),cF=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),pF=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.DependingProperty=n,this.DependantProperty=o,this.Expression=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.DependingProperty),e.push(this.DependantProperty),e.push(this.Expression),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),dF=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.EnumerationValues=n,this.EnumerationReference=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.EnumerationValues),e.push(this.EnumerationReference),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),fF=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.EnumerationValues=r,this.Unit=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.EnumerationValues),e.push(this.Unit),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),mF=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.ListValues=n,this.Unit=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.ListValues),e.push(this.Unit),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),vF=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.UsageName=n,this.PropertyReference=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.UsageName),e.push(this.PropertyReference),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),gF=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.HasProperties=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.HasProperties),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),_F=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),yF=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.TemplateType=a,this.ApplicableEntity=u,this.HasPropertyTemplates=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.TemplateType),e.push(this.ApplicableEntity),e.push(this.HasPropertyTemplates),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),bF=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.NominalValue=n,this.Unit=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.NominalValue),e.push(this.Unit),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),xF=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.DefiningValues=n,this.DefinedValues=o,this.Expression=a,this.DefiningUnit=u,this.DefinedUnit=h,this.CurveInterpolation=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.DefiningValues),e.push(this.DefinedValues),e.push(this.Expression),e.push(this.DefiningUnit),e.push(this.DefinedUnit),e.push(this.CurveInterpolation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),PF=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),TF=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),wF=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),MF=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),IF=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),CF=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),DF=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.ProxyType=l,this.Tag=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.ProxyType),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),AF=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),kF=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),EF=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Unit=n,this.AreaValue=o,this.Formula=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.AreaValue),e.push(this.Formula),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),FF=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Unit=n,this.CountValue=o,this.Formula=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.CountValue),e.push(this.Formula),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),RF=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Unit=n,this.LengthValue=o,this.Formula=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.LengthValue),e.push(this.Formula),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),SF=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),OF=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Unit=n,this.TimeValue=o,this.Formula=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.TimeValue),e.push(this.Formula),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),BF=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Unit=n,this.VolumeValue=o,this.Formula=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.VolumeValue),e.push(this.Formula),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),LF=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.Unit=n,this.WeightValue=o,this.Formula=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.WeightValue),e.push(this.Formula),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),NF=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),jF=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),GF=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),HF=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),UF=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),VF=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),zF=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.Degree=s,this.ControlPointsList=r,this.CurveForm=n,this.ClosedCurve=o,this.SelfIntersect=a,this.KnotMultiplicities=u,this.Knots=h,this.KnotSpec=l,this.WeightsData=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Degree),e.push(this.ControlPointsList),e.push(this.CurveForm),e.push(this.ClosedCurve),e.push(this.SelfIntersect),e.push(this.KnotMultiplicities),e.push(this.Knots),e.push(this.KnotSpec),e.push(this.WeightsData),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),WF=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m){w(this,e),this.expressID=t,this.type=i,this.UDegree=s,this.VDegree=r,this.ControlPointsList=n,this.SurfaceForm=o,this.UClosed=a,this.VClosed=u,this.SelfIntersect=h,this.UMultiplicities=l,this.VMultiplicities=c,this.UKnots=p,this.VKnots=d,this.KnotSpec=f,this.WeightsData=m}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.UDegree),e.push(this.VDegree),e.push(this.ControlPointsList),e.push(this.SurfaceForm),e.push(this.UClosed),e.push(this.VClosed),e.push(this.SelfIntersect),e.push(this.UMultiplicities),e.push(this.VMultiplicities),e.push(this.UKnots),e.push(this.VKnots),e.push(this.KnotSpec),e.push(this.WeightsData),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),XF=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n,this.XDim=o,this.YDim=a,this.WallThickness=u,this.InnerFilletRadius=h,this.OuterFilletRadius=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.XDim),e.push(this.YDim),e.push(this.WallThickness),e.push(this.InnerFilletRadius),e.push(this.OuterFilletRadius),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),YF=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n,this.XDim=o,this.YDim=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.XDim),e.push(this.YDim),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),KF=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Position=s,this.XLength=r,this.YLength=n,this.Height=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Position),e.push(this.XLength),e.push(this.YLength),e.push(this.Height),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),JF=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.BasisSurface=s,this.U1=r,this.V1=n,this.U2=o,this.V2=a,this.Usense=u,this.Vsense=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.BasisSurface),e.push(this.U1),e.push(this.V1),e.push(this.U2),e.push(this.V2),e.push(this.Usense),e.push(this.Vsense),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ZF=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.RecurrenceType=s,this.DayComponent=r,this.WeekdayComponent=n,this.MonthComponent=o,this.Position=a,this.Interval=u,this.Occurrences=h,this.TimePeriods=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.RecurrenceType),e.push(this.DayComponent),e.push(this.WeekdayComponent),e.push(this.MonthComponent),e.push(this.Position),e.push(this.Interval),e.push(this.Occurrences),e.push(this.TimePeriods),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),QF=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.TypeIdentifier=s,this.AttributeIdentifier=r,this.InstanceName=n,this.ListPositions=o,this.InnerReference=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.TypeIdentifier),e.push(this.AttributeIdentifier),e.push(this.InstanceName),e.push(this.ListPositions),e.push(this.InnerReference),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),qF=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.PredefinedType=l,this.RestartDistance=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.RestartDistance),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),$F=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.StartTime=n,this.EndTime=o,this.TimeSeriesDataType=a,this.DataOrigin=u,this.UserDefinedDataOrigin=h,this.Unit=l,this.TimeStep=c,this.Values=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.StartTime),e.push(this.EndTime),e.push(this.TimeSeriesDataType),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.Unit),e.push(this.TimeStep),e.push(this.Values),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),eR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.TotalCrossSectionArea=s,this.SteelGrade=r,this.BarSurface=n,this.EffectiveDepth=o,this.NominalBarDiameter=a,this.BarCount=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.TotalCrossSectionArea),e.push(this.SteelGrade),e.push(this.BarSurface),e.push(this.EffectiveDepth),e.push(this.NominalBarDiameter),e.push(this.BarCount),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),tR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.DefinitionType=a,this.ReinforcementSectionDefinitions=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.DefinitionType),e.push(this.ReinforcementSectionDefinitions),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),iR=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.SteelGrade=c,this.NominalDiameter=p,this.CrossSectionArea=d,this.BarLength=f,this.PredefinedType=m,this.BarSurface=v}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.NominalDiameter),e.push(this.CrossSectionArea),e.push(this.BarLength),e.push(this.PredefinedType),e.push(this.BarSurface),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),sR=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v,g,_){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p,this.NominalDiameter=d,this.CrossSectionArea=f,this.BarLength=m,this.BarSurface=v,this.BendingShapeCode=g,this.BendingParameters=_}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.NominalDiameter),e.push(this.CrossSectionArea),e.push(this.BarLength),e.push(this.BarSurface),e.push(this.BendingShapeCode),e.push(this.BendingParameters),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),rR=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.SteelGrade=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),nR=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),oR=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v,g,_,y,b){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.SteelGrade=c,this.MeshLength=p,this.MeshWidth=d,this.LongitudinalBarNominalDiameter=f,this.TransverseBarNominalDiameter=m,this.LongitudinalBarCrossSectionArea=v,this.TransverseBarCrossSectionArea=g,this.LongitudinalBarSpacing=_,this.TransverseBarSpacing=y,this.PredefinedType=b}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.MeshLength),e.push(this.MeshWidth),e.push(this.LongitudinalBarNominalDiameter),e.push(this.TransverseBarNominalDiameter),e.push(this.LongitudinalBarCrossSectionArea),e.push(this.TransverseBarCrossSectionArea),e.push(this.LongitudinalBarSpacing),e.push(this.TransverseBarSpacing),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),aR=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v,g,_,y,b,x,P){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p,this.MeshLength=d,this.MeshWidth=f,this.LongitudinalBarNominalDiameter=m,this.TransverseBarNominalDiameter=v,this.LongitudinalBarCrossSectionArea=g,this.TransverseBarCrossSectionArea=_,this.LongitudinalBarSpacing=y,this.TransverseBarSpacing=b,this.BendingShapeCode=x,this.BendingParameters=P}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.MeshLength),e.push(this.MeshWidth),e.push(this.LongitudinalBarNominalDiameter),e.push(this.TransverseBarNominalDiameter),e.push(this.LongitudinalBarCrossSectionArea),e.push(this.TransverseBarCrossSectionArea),e.push(this.LongitudinalBarSpacing),e.push(this.TransverseBarSpacing),e.push(this.BendingShapeCode),e.push(this.BendingParameters),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),uR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingObject=a,this.RelatedObjects=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingObject),e.push(this.RelatedObjects),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),hR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),lR=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=u,this.RelatingActor=h,this.ActingRole=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingActor),e.push(this.ActingRole),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),cR=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=u,this.RelatingControl=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingControl),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),pR=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=u,this.RelatingGroup=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingGroup),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),dR=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=u,this.RelatingGroup=h,this.Factor=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingGroup),e.push(this.Factor),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),fR=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=u,this.RelatingProcess=h,this.QuantityInProcess=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingProcess),e.push(this.QuantityInProcess),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),mR=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=u,this.RelatingProduct=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingProduct),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),vR=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatedObjectsType=u,this.RelatingResource=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingResource),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),gR=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),_R=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatingApproval=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingApproval),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),yR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatingClassification=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingClassification),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),bR=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.Intent=u,this.RelatingConstraint=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.Intent),e.push(this.RelatingConstraint),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),xR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatingDocument=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingDocument),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),PR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatingLibrary=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingLibrary),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),TR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatingMaterial=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingMaterial),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),wR=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),MR=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ConnectionGeometry=a,this.RelatingElement=u,this.RelatedElement=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ConnectionGeometry),e.push(this.RelatingElement),e.push(this.RelatedElement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),IR=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ConnectionGeometry=a,this.RelatingElement=u,this.RelatedElement=h,this.RelatingPriorities=l,this.RelatedPriorities=c,this.RelatedConnectionType=p,this.RelatingConnectionType=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ConnectionGeometry),e.push(this.RelatingElement),e.push(this.RelatedElement),e.push(this.RelatingPriorities),e.push(this.RelatedPriorities),e.push(this.RelatedConnectionType),e.push(this.RelatingConnectionType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),CR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingPort=a,this.RelatedElement=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingPort),e.push(this.RelatedElement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),DR=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingPort=a,this.RelatedPort=u,this.RealizingElement=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingPort),e.push(this.RelatedPort),e.push(this.RealizingElement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),AR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingElement=a,this.RelatedStructuralActivity=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingElement),e.push(this.RelatedStructuralActivity),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),kR=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingStructuralMember=a,this.RelatedStructuralConnection=u,this.AppliedCondition=h,this.AdditionalConditions=l,this.SupportedLength=c,this.ConditionCoordinateSystem=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingStructuralMember),e.push(this.RelatedStructuralConnection),e.push(this.AppliedCondition),e.push(this.AdditionalConditions),e.push(this.SupportedLength),e.push(this.ConditionCoordinateSystem),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ER=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingStructuralMember=a,this.RelatedStructuralConnection=u,this.AppliedCondition=h,this.AdditionalConditions=l,this.SupportedLength=c,this.ConditionCoordinateSystem=p,this.ConnectionConstraint=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingStructuralMember),e.push(this.RelatedStructuralConnection),e.push(this.AppliedCondition),e.push(this.AdditionalConditions),e.push(this.SupportedLength),e.push(this.ConditionCoordinateSystem),e.push(this.ConnectionConstraint),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),FR=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ConnectionGeometry=a,this.RelatingElement=u,this.RelatedElement=h,this.RealizingElements=l,this.ConnectionType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ConnectionGeometry),e.push(this.RelatingElement),e.push(this.RelatedElement),e.push(this.RealizingElements),e.push(this.ConnectionType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),RR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedElements=a,this.RelatingStructure=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedElements),e.push(this.RelatingStructure),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),SR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingBuildingElement=a,this.RelatedCoverings=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingBuildingElement),e.push(this.RelatedCoverings),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),OR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingSpace=a,this.RelatedCoverings=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSpace),e.push(this.RelatedCoverings),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),BR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingContext=a,this.RelatedDefinitions=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingContext),e.push(this.RelatedDefinitions),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),LR=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),NR=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),jR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatingObject=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingObject),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),GR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatingPropertyDefinition=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingPropertyDefinition),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),HR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedPropertySets=a,this.RelatingTemplate=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedPropertySets),e.push(this.RelatingTemplate),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),UR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedObjects=a,this.RelatingType=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),VR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingOpeningElement=a,this.RelatedBuildingElement=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingOpeningElement),e.push(this.RelatedBuildingElement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),zR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedControlElements=a,this.RelatingFlowElement=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedControlElements),e.push(this.RelatingFlowElement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),WR=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingElement=a,this.RelatedElement=u,this.InterferenceGeometry=h,this.InterferenceType=l,this.ImpliedOrder=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingElement),e.push(this.RelatedElement),e.push(this.InterferenceGeometry),e.push(this.InterferenceType),e.push(this.ImpliedOrder),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),XR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingObject=a,this.RelatedObjects=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingObject),e.push(this.RelatedObjects),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),YR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingPositioningElement=a,this.RelatedProducts=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingPositioningElement),e.push(this.RelatedProducts),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),KR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingElement=a,this.RelatedFeatureElement=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingElement),e.push(this.RelatedFeatureElement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),JR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatedElements=a,this.RelatingStructure=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedElements),e.push(this.RelatingStructure),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ZR=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingProcess=a,this.RelatedProcess=u,this.TimeLag=h,this.SequenceType=l,this.UserDefinedSequenceType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingProcess),e.push(this.RelatedProcess),e.push(this.TimeLag),e.push(this.SequenceType),e.push(this.UserDefinedSequenceType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),QR=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingSystem=a,this.RelatedBuildings=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSystem),e.push(this.RelatedBuildings),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),qR=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingSpace=a,this.RelatedBuildingElement=u,this.ConnectionGeometry=h,this.PhysicalOrVirtualBoundary=l,this.InternalOrExternalBoundary=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSpace),e.push(this.RelatedBuildingElement),e.push(this.ConnectionGeometry),e.push(this.PhysicalOrVirtualBoundary),e.push(this.InternalOrExternalBoundary),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),$R=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingSpace=a,this.RelatedBuildingElement=u,this.ConnectionGeometry=h,this.PhysicalOrVirtualBoundary=l,this.InternalOrExternalBoundary=c,this.ParentBoundary=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSpace),e.push(this.RelatedBuildingElement),e.push(this.ConnectionGeometry),e.push(this.PhysicalOrVirtualBoundary),e.push(this.InternalOrExternalBoundary),e.push(this.ParentBoundary),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),eS=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingSpace=a,this.RelatedBuildingElement=u,this.ConnectionGeometry=h,this.PhysicalOrVirtualBoundary=l,this.InternalOrExternalBoundary=c,this.ParentBoundary=p,this.CorrespondingBoundary=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSpace),e.push(this.RelatedBuildingElement),e.push(this.ConnectionGeometry),e.push(this.PhysicalOrVirtualBoundary),e.push(this.InternalOrExternalBoundary),e.push(this.ParentBoundary),e.push(this.CorrespondingBoundary),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),tS=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.RelatingBuildingElement=a,this.RelatedOpeningElement=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingBuildingElement),e.push(this.RelatedOpeningElement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),iS=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),sS=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Transition=s,this.SameSense=r,this.ParentCurve=n,this.ParamLength=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Transition),e.push(this.SameSense),e.push(this.ParentCurve),e.push(this.ParamLength),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),rS=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.ContextOfItems=s,this.RepresentationIdentifier=r,this.RepresentationType=n,this.Items=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),nS=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.ContextIdentifier=s,this.ContextType=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ContextIdentifier),e.push(this.ContextType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),oS=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),aS=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.MappingOrigin=s,this.MappedRepresentation=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.MappingOrigin),e.push(this.MappedRepresentation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),uS=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.LongDescription=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),hS=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.RelatedResourceObjects=n,this.RelatingApproval=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatedResourceObjects),e.push(this.RelatingApproval),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),lS=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.RelatingConstraint=n,this.RelatedResourceObjects=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingConstraint),e.push(this.RelatedResourceObjects),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),cS=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),pS=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v,g,_,y,b){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.DataOrigin=r,this.UserDefinedDataOrigin=n,this.ScheduleWork=o,this.ScheduleUsage=a,this.ScheduleStart=u,this.ScheduleFinish=h,this.ScheduleContour=l,this.LevelingDelay=c,this.IsOverAllocated=p,this.StatusTime=d,this.ActualWork=f,this.ActualUsage=m,this.ActualStart=v,this.ActualFinish=g,this.RemainingWork=_,this.RemainingUsage=y,this.Completion=b}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.ScheduleWork),e.push(this.ScheduleUsage),e.push(this.ScheduleStart),e.push(this.ScheduleFinish),e.push(this.ScheduleContour),e.push(this.LevelingDelay),e.push(this.IsOverAllocated),e.push(this.StatusTime),e.push(this.ActualWork),e.push(this.ActualUsage),e.push(this.ActualStart),e.push(this.ActualFinish),e.push(this.RemainingWork),e.push(this.RemainingUsage),e.push(this.Completion),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),dS=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.SweptArea=s,this.Position=r,this.Axis=n,this.Angle=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.Axis),e.push(this.Angle),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),fS=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.SweptArea=s,this.Position=r,this.Axis=n,this.Angle=o,this.EndSweptArea=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.Axis),e.push(this.Angle),e.push(this.EndSweptArea),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),mS=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Position=s,this.Height=r,this.BottomRadius=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Position),e.push(this.Height),e.push(this.BottomRadius),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),vS=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Position=s,this.Height=r,this.Radius=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Position),e.push(this.Height),e.push(this.Radius),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),gS=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),_S=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),yS=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),bS=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n,this.XDim=o,this.YDim=a,this.RoundingRadius=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.XDim),e.push(this.YDim),e.push(this.RoundingRadius),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),xS=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Dimensions=s,this.UnitType=r,this.Prefix=n,this.Name=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Dimensions),e.push(this.UnitType),e.push(this.Prefix),e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),PS=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),TS=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),wS=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.DataOrigin=r,this.UserDefinedDataOrigin=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),MS=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Curve3D=s,this.AssociatedGeometry=r,this.MasterRepresentation=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Curve3D),e.push(this.AssociatedGeometry),e.push(this.MasterRepresentation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),IS=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.SectionType=s,this.StartProfile=r,this.EndProfile=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SectionType),e.push(this.StartProfile),e.push(this.EndProfile),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),CS=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.LongitudinalStartPosition=s,this.LongitudinalEndPosition=r,this.TransversePosition=n,this.ReinforcementRole=o,this.SectionDefinition=a,this.CrossSectionReinforcementDefinitions=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.LongitudinalStartPosition),e.push(this.LongitudinalEndPosition),e.push(this.TransversePosition),e.push(this.ReinforcementRole),e.push(this.SectionDefinition),e.push(this.CrossSectionReinforcementDefinitions),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),DS=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Directrix=s,this.CrossSections=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Directrix),e.push(this.CrossSections),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),AS=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Directrix=s,this.CrossSections=r,this.CrossSectionPositions=n,this.FixedAxisVertical=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Directrix),e.push(this.CrossSections),e.push(this.CrossSectionPositions),e.push(this.FixedAxisVertical),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),kS=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.SpineCurve=s,this.CrossSections=r,this.CrossSectionPositions=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SpineCurve),e.push(this.CrossSections),e.push(this.CrossSectionPositions),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),ES=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),FS=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),RS=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),SS=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),OS=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.ShapeRepresentations=s,this.Name=r,this.Description=n,this.ProductDefinitional=o,this.PartOfProductDefinitionShape=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ShapeRepresentations),e.push(this.Name),e.push(this.Description),e.push(this.ProductDefinitional),e.push(this.PartOfProductDefinitionShape),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),BS=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.ContextOfItems=s,this.RepresentationIdentifier=r,this.RepresentationType=n,this.Items=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),LS=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.ContextOfItems=s,this.RepresentationIdentifier=r,this.RepresentationType=n,this.Items=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),NS=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.SbsmBoundary=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SbsmBoundary),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),jS=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),GS=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.TemplateType=a,this.PrimaryMeasureType=u,this.SecondaryMeasureType=h,this.Enumerators=l,this.PrimaryUnit=c,this.SecondaryUnit=p,this.Expression=d,this.AccessState=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.TemplateType),e.push(this.PrimaryMeasureType),e.push(this.SecondaryMeasureType),e.push(this.Enumerators),e.push(this.PrimaryUnit),e.push(this.SecondaryUnit),e.push(this.Expression),e.push(this.AccessState),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),HS=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.LongName=l,this.CompositionType=c,this.RefLatitude=p,this.RefLongitude=d,this.RefElevation=f,this.LandTitleNumber=m,this.SiteAddress=v}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.RefLatitude),e.push(this.RefLongitude),e.push(this.RefElevation),e.push(this.LandTitleNumber),e.push(this.SiteAddress),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),US=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),VS=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),zS=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),WS=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),XS=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.SlippageX=r,this.SlippageY=n,this.SlippageZ=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.SlippageX),e.push(this.SlippageY),e.push(this.SlippageZ),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),YS=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),KS=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),JS=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),ZS=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.LongName=l,this.CompositionType=c,this.PredefinedType=p,this.ElevationWithFlooring=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.PredefinedType),e.push(this.ElevationWithFlooring),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),QS=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),qS=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),$S=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p,this.LongName=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.LongName),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),eO=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.LongName=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),tO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),iO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.LongName=l,this.CompositionType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),sO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),rO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.LongName=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),nO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p,this.LongName=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.LongName),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),oO=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Position=s,this.Radius=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Position),e.push(this.Radius),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),aO=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Position=s,this.Radius=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Position),e.push(this.Radius),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),uO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),hO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),lO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),cO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.NumberOfRisers=c,this.NumberOfTreads=p,this.RiserHeight=d,this.TreadLength=f,this.PredefinedType=m}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.NumberOfRisers),e.push(this.NumberOfTreads),e.push(this.RiserHeight),e.push(this.TreadLength),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),pO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),dO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),fO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.DestabilizingLoad=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),mO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),vO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.PredefinedType=u,this.OrientationOf2DPlane=h,this.LoadedBy=l,this.HasResults=c,this.SharedPlacement=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.OrientationOf2DPlane),e.push(this.LoadedBy),e.push(this.HasResults),e.push(this.SharedPlacement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),gO=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedCondition=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedCondition),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),_O=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Name=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),yO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.DestabilizingLoad=p,this.ProjectedOrTrue=d,this.PredefinedType=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e.push(this.ProjectedOrTrue),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),bO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedCondition=l,this.Axis=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedCondition),e.push(this.Axis),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),xO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.PredefinedType=l,this.Axis=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.Axis),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),PO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.PredefinedType=l,this.Axis=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.Axis),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),TO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),wO=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),MO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.DestabilizingLoad=p,this.ProjectedOrTrue=d,this.PredefinedType=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e.push(this.ProjectedOrTrue),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),IO=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Name=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),CO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.PredefinedType=u,this.ActionType=h,this.ActionSource=l,this.Coefficient=c,this.Purpose=p,this.SelfWeightCoefficients=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.ActionType),e.push(this.ActionSource),e.push(this.Coefficient),e.push(this.Purpose),e.push(this.SelfWeightCoefficients),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),DO=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Values=r,this.Locations=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Values),e.push(this.Locations),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),AO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.PredefinedType=u,this.ActionType=h,this.ActionSource=l,this.Coefficient=c,this.Purpose=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.ActionType),e.push(this.ActionSource),e.push(this.Coefficient),e.push(this.Purpose),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),kO=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.LinearForceX=r,this.LinearForceY=n,this.LinearForceZ=o,this.LinearMomentX=a,this.LinearMomentY=u,this.LinearMomentZ=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.LinearForceX),e.push(this.LinearForceY),e.push(this.LinearForceZ),e.push(this.LinearMomentX),e.push(this.LinearMomentY),e.push(this.LinearMomentZ),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),EO=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Name=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),FO=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.PlanarForceX=r,this.PlanarForceY=n,this.PlanarForceZ=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.PlanarForceX),e.push(this.PlanarForceY),e.push(this.PlanarForceZ),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),RO=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.DisplacementX=r,this.DisplacementY=n,this.DisplacementZ=o,this.RotationalDisplacementRX=a,this.RotationalDisplacementRY=u,this.RotationalDisplacementRZ=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.DisplacementX),e.push(this.DisplacementY),e.push(this.DisplacementZ),e.push(this.RotationalDisplacementRX),e.push(this.RotationalDisplacementRY),e.push(this.RotationalDisplacementRZ),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),SO=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.DisplacementX=r,this.DisplacementY=n,this.DisplacementZ=o,this.RotationalDisplacementRX=a,this.RotationalDisplacementRY=u,this.RotationalDisplacementRZ=h,this.Distortion=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.DisplacementX),e.push(this.DisplacementY),e.push(this.DisplacementZ),e.push(this.RotationalDisplacementRX),e.push(this.RotationalDisplacementRY),e.push(this.RotationalDisplacementRZ),e.push(this.Distortion),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),OO=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.ForceX=r,this.ForceY=n,this.ForceZ=o,this.MomentX=a,this.MomentY=u,this.MomentZ=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.ForceX),e.push(this.ForceY),e.push(this.ForceZ),e.push(this.MomentX),e.push(this.MomentY),e.push(this.MomentZ),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),BO=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.ForceX=r,this.ForceY=n,this.ForceZ=o,this.MomentX=a,this.MomentY=u,this.MomentZ=h,this.WarpingMoment=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.ForceX),e.push(this.ForceY),e.push(this.ForceZ),e.push(this.MomentX),e.push(this.MomentY),e.push(this.MomentZ),e.push(this.WarpingMoment),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),LO=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Name=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),NO=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.DeltaTConstant=r,this.DeltaTY=n,this.DeltaTZ=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.DeltaTConstant),e.push(this.DeltaTY),e.push(this.DeltaTZ),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),jO=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),GO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.DestabilizingLoad=p,this.ProjectedOrTrue=d,this.PredefinedType=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e.push(this.ProjectedOrTrue),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),HO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.DestabilizingLoad=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),UO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedCondition=l,this.ConditionCoordinateSystem=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedCondition),e.push(this.ConditionCoordinateSystem),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),VO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),zO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),WO=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.TheoryType=u,this.ResultForLoadGroup=h,this.IsLinear=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.TheoryType),e.push(this.ResultForLoadGroup),e.push(this.IsLinear),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),XO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.DestabilizingLoad=p,this.ProjectedOrTrue=d,this.PredefinedType=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e.push(this.ProjectedOrTrue),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),YO=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedCondition=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedCondition),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),KO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.PredefinedType=l,this.Thickness=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.Thickness),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),JO=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.PredefinedType=l,this.Thickness=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.Thickness),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ZO=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),QO=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.ContextOfItems=s,this.RepresentationIdentifier=r,this.RepresentationType=n,this.Items=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),qO=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Item=s,this.Styles=r,this.Name=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Item),e.push(this.Styles),e.push(this.Name),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),$O=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.ContextOfItems=s,this.RepresentationIdentifier=r,this.RepresentationType=n,this.Items=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),eB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.LongDescription=h,this.Usage=l,this.BaseCosts=c,this.BaseQuantity=p,this.PredefinedType=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),tB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.Identification=h,this.LongDescription=l,this.ResourceType=c,this.BaseCosts=p,this.BaseQuantity=d,this.PredefinedType=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),iB=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.EdgeStart=s,this.EdgeEnd=r,this.ParentEdge=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.EdgeStart),e.push(this.EdgeEnd),e.push(this.ParentEdge),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),sB=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),rB=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Curve3D=s,this.AssociatedGeometry=r,this.MasterRepresentation=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Curve3D),e.push(this.AssociatedGeometry),e.push(this.MasterRepresentation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),nB=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.SweptArea=s,this.Position=r,this.Directrix=n,this.StartParam=o,this.EndParam=a,this.ReferenceSurface=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.Directrix),e.push(this.StartParam),e.push(this.EndParam),e.push(this.ReferenceSurface),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),oB=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),aB=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.SweptCurve=s,this.Position=r,this.ExtrudedDirection=n,this.Depth=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SweptCurve),e.push(this.Position),e.push(this.ExtrudedDirection),e.push(this.Depth),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),uB=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.SweptCurve=s,this.Position=r,this.AxisPosition=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SweptCurve),e.push(this.Position),e.push(this.AxisPosition),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),hB=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.SurfaceReinforcement1=r,this.SurfaceReinforcement2=n,this.ShearReinforcement=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.SurfaceReinforcement1),e.push(this.SurfaceReinforcement2),e.push(this.ShearReinforcement),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),lB=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Side=r,this.Styles=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Side),e.push(this.Styles),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),cB=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.DiffuseTransmissionColour=s,this.DiffuseReflectionColour=r,this.TransmissionColour=n,this.ReflectanceColour=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.DiffuseTransmissionColour),e.push(this.DiffuseReflectionColour),e.push(this.TransmissionColour),e.push(this.ReflectanceColour),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),pB=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.RefractionIndex=s,this.DispersionFactor=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.RefractionIndex),e.push(this.DispersionFactor),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),dB=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.SurfaceColour=s,this.Transparency=r,this.DiffuseColour=n,this.TransmissionColour=o,this.DiffuseTransmissionColour=a,this.ReflectionColour=u,this.SpecularColour=h,this.SpecularHighlight=l,this.ReflectanceMethod=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SurfaceColour),e.push(this.Transparency),e.push(this.DiffuseColour),e.push(this.TransmissionColour),e.push(this.DiffuseTransmissionColour),e.push(this.ReflectionColour),e.push(this.SpecularColour),e.push(this.SpecularHighlight),e.push(this.ReflectanceMethod),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),fB=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.SurfaceColour=s,this.Transparency=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SurfaceColour),e.push(this.Transparency),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),mB=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Textures=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Textures),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),vB=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.RepeatS=s,this.RepeatT=r,this.Mode=n,this.TextureTransform=o,this.Parameter=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.RepeatS),e.push(this.RepeatT),e.push(this.Mode),e.push(this.TextureTransform),e.push(this.Parameter),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),gB=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.SweptArea=s,this.Position=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SweptArea),e.push(this.Position),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),_B=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Directrix=s,this.Radius=r,this.InnerRadius=n,this.StartParam=o,this.EndParam=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Directrix),e.push(this.Radius),e.push(this.InnerRadius),e.push(this.StartParam),e.push(this.EndParam),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),yB=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.Directrix=s,this.Radius=r,this.InnerRadius=n,this.StartParam=o,this.EndParam=a,this.FilletRadius=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Directrix),e.push(this.Radius),e.push(this.InnerRadius),e.push(this.StartParam),e.push(this.EndParam),e.push(this.FilletRadius),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),bB=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.SweptCurve=s,this.Position=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.SweptCurve),e.push(this.Position),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),xB=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),PB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),TB=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),wB=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),MB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),IB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n,this.Depth=o,this.FlangeWidth=a,this.WebThickness=u,this.FlangeThickness=h,this.FilletRadius=l,this.FlangeEdgeRadius=c,this.WebEdgeRadius=p,this.WebSlope=d,this.FlangeSlope=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.FlangeWidth),e.push(this.WebThickness),e.push(this.FlangeThickness),e.push(this.FilletRadius),e.push(this.FlangeEdgeRadius),e.push(this.WebEdgeRadius),e.push(this.WebSlope),e.push(this.FlangeSlope),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),CB=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Rows=r,this.Columns=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Rows),e.push(this.Columns),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),DB=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Identifier=s,this.Name=r,this.Description=n,this.Unit=o,this.ReferencePath=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Identifier),e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.ReferencePath),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),AB=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.RowCells=s,this.IsHeading=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.RowCells),e.push(this.IsHeading),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),kB=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),EB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),FB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.LongDescription=h,this.Status=l,this.WorkMethod=c,this.IsMilestone=p,this.Priority=d,this.TaskTime=f,this.PredefinedType=m}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Status),e.push(this.WorkMethod),e.push(this.IsMilestone),e.push(this.Priority),e.push(this.TaskTime),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),RB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v,g,_,y,b,x,P){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.DataOrigin=r,this.UserDefinedDataOrigin=n,this.DurationType=o,this.ScheduleDuration=a,this.ScheduleStart=u,this.ScheduleFinish=h,this.EarlyStart=l,this.EarlyFinish=c,this.LateStart=p,this.LateFinish=d,this.FreeFloat=f,this.TotalFloat=m,this.IsCritical=v,this.StatusTime=g,this.ActualDuration=_,this.ActualStart=y,this.ActualFinish=b,this.RemainingTime=x,this.Completion=P}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.DurationType),e.push(this.ScheduleDuration),e.push(this.ScheduleStart),e.push(this.ScheduleFinish),e.push(this.EarlyStart),e.push(this.EarlyFinish),e.push(this.LateStart),e.push(this.LateFinish),e.push(this.FreeFloat),e.push(this.TotalFloat),e.push(this.IsCritical),e.push(this.StatusTime),e.push(this.ActualDuration),e.push(this.ActualStart),e.push(this.ActualFinish),e.push(this.RemainingTime),e.push(this.Completion),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),SB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v,g,_,y,b,x,P,T){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.DataOrigin=r,this.UserDefinedDataOrigin=n,this.DurationType=o,this.ScheduleDuration=a,this.ScheduleStart=u,this.ScheduleFinish=h,this.EarlyStart=l,this.EarlyFinish=c,this.LateStart=p,this.LateFinish=d,this.FreeFloat=f,this.TotalFloat=m,this.IsCritical=v,this.StatusTime=g,this.ActualDuration=_,this.ActualStart=y,this.ActualFinish=b,this.RemainingTime=x,this.Completion=P,this.Recurrence=T}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.DurationType),e.push(this.ScheduleDuration),e.push(this.ScheduleStart),e.push(this.ScheduleFinish),e.push(this.EarlyStart),e.push(this.EarlyFinish),e.push(this.LateStart),e.push(this.LateFinish),e.push(this.FreeFloat),e.push(this.TotalFloat),e.push(this.IsCritical),e.push(this.StatusTime),e.push(this.ActualDuration),e.push(this.ActualStart),e.push(this.ActualFinish),e.push(this.RemainingTime),e.push(this.Completion),e.push(this.Recurrence),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),OB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.Identification=h,this.LongDescription=l,this.ProcessType=c,this.PredefinedType=p,this.WorkMethod=d}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ProcessType),e.push(this.PredefinedType),e.push(this.WorkMethod),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),BB=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.Purpose=s,this.Description=r,this.UserDefinedPurpose=n,this.TelephoneNumbers=o,this.FacsimileNumbers=a,this.PagerNumber=u,this.ElectronicMailAddresses=h,this.WWWHomePageURL=l,this.MessagingIDs=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Purpose),e.push(this.Description),e.push(this.UserDefinedPurpose),e.push(this.TelephoneNumbers),e.push(this.FacsimileNumbers),e.push(this.PagerNumber),e.push(this.ElectronicMailAddresses),e.push(this.WWWHomePageURL),e.push(this.MessagingIDs),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),LB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v,g,_,y){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.SteelGrade=c,this.PredefinedType=p,this.NominalDiameter=d,this.CrossSectionArea=f,this.TensionForce=m,this.PreStress=v,this.FrictionCoefficient=g,this.AnchorageSlip=_,this.MinCurvatureRadius=y}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.PredefinedType),e.push(this.NominalDiameter),e.push(this.CrossSectionArea),e.push(this.TensionForce),e.push(this.PreStress),e.push(this.FrictionCoefficient),e.push(this.AnchorageSlip),e.push(this.MinCurvatureRadius),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),NB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.SteelGrade=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),jB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),GB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.SteelGrade=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),HB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),UB=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p,this.NominalDiameter=d,this.CrossSectionArea=f,this.SheathDiameter=m}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.NominalDiameter),e.push(this.CrossSectionArea),e.push(this.SheathDiameter),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),VB=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Coordinates=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Coordinates),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),zB=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),WB=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Literal=s,this.Placement=r,this.Path=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Literal),e.push(this.Placement),e.push(this.Path),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),XB=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Literal=s,this.Placement=r,this.Path=n,this.Extent=o,this.BoxAlignment=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Literal),e.push(this.Placement),e.push(this.Path),e.push(this.Extent),e.push(this.BoxAlignment),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),YB=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.TextCharacterAppearance=r,this.TextStyle=n,this.TextFontStyle=o,this.ModelOrDraughting=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.TextCharacterAppearance),e.push(this.TextStyle),e.push(this.TextFontStyle),e.push(this.ModelOrDraughting),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),KB=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.FontFamily=r,this.FontStyle=n,this.FontVariant=o,this.FontWeight=a,this.FontSize=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.FontFamily),e.push(this.FontStyle),e.push(this.FontVariant),e.push(this.FontWeight),e.push(this.FontSize),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),JB=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Colour=s,this.BackgroundColour=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Colour),e.push(this.BackgroundColour),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),ZB=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.TextIndent=s,this.TextAlign=r,this.TextDecoration=n,this.LetterSpacing=o,this.WordSpacing=a,this.TextTransform=u,this.LineHeight=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.TextIndent),e.push(this.TextAlign),e.push(this.TextDecoration),e.push(this.LetterSpacing),e.push(this.WordSpacing),e.push(this.TextTransform),e.push(this.LineHeight),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),QB=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Maps=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Maps),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),qB=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Maps=s,this.Mode=r,this.Parameter=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Maps),e.push(this.Mode),e.push(this.Parameter),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),$B=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Maps=s,this.Vertices=r,this.MappedTo=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Maps),e.push(this.Vertices),e.push(this.MappedTo),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),eL=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Coordinates=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Coordinates),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),tL=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.TexCoordsList=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.TexCoordsList),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),iL=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.StartTime=s,this.EndTime=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.StartTime),e.push(this.EndTime),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),sL=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.Description=r,this.StartTime=n,this.EndTime=o,this.TimeSeriesDataType=a,this.DataOrigin=u,this.UserDefinedDataOrigin=h,this.Unit=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.Description),e.push(this.StartTime),e.push(this.EndTime),e.push(this.TimeSeriesDataType),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.Unit),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),rL=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.ListValues=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ListValues),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),nL=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),oL=function(){function e(t,i,s,r,n,o){w(this,e),this.expressID=t,this.type=i,this.ContextOfItems=s,this.RepresentationIdentifier=r,this.RepresentationType=n,this.Items=o}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++])}}]),e}(),aL=function(){function e(t,i,s,r,n){w(this,e),this.expressID=t,this.type=i,this.Position=s,this.MajorRadius=r,this.MinorRadius=n}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Position),e.push(this.MajorRadius),e.push(this.MinorRadius),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++])}}]),e}(),uL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),hL=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),lL=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.StartPoint=s,this.StartDirection=r,this.SegmentLength=n,this.StartRadius=o,this.EndRadius=a,this.IsStartRadiusCCW=u,this.IsEndRadiusCCW=h,this.TransitionCurveType=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.StartPoint),e.push(this.StartDirection),e.push(this.SegmentLength),e.push(this.StartRadius),e.push(this.EndRadius),e.push(this.IsStartRadiusCCW),e.push(this.IsEndRadiusCCW),e.push(this.TransitionCurveType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),cL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),pL=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),dL=function(){function e(t,i,s,r,n,o,a,u,h){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n,this.BottomXDim=o,this.TopXDim=a,this.YDim=u,this.TopXOffset=h}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.BottomXDim),e.push(this.TopXDim),e.push(this.YDim),e.push(this.TopXOffset),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),fL=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.Coordinates=s,this.Normals=r,this.Closed=n,this.CoordIndex=o,this.PnIndex=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Coordinates),e.push(this.Normals),e.push(this.Closed),e.push(this.CoordIndex),e.push(this.PnIndex),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),mL=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.Coordinates=s,this.Normals=r,this.Closed=n,this.CoordIndex=o,this.PnIndex=a,this.Flags=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Coordinates),e.push(this.Normals),e.push(this.Closed),e.push(this.CoordIndex),e.push(this.PnIndex),e.push(this.Flags),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),vL=function(){function e(t,i,s,r,n,o,a){w(this,e),this.expressID=t,this.type=i,this.BasisCurve=s,this.Trim1=r,this.Trim2=n,this.SenseAgreement=o,this.MasterRepresentation=a}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.BasisCurve),e.push(this.Trim1),e.push(this.Trim2),e.push(this.SenseAgreement),e.push(this.MasterRepresentation),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),gL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),_L=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),yL=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),bL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.Identification=h,this.LongDescription=l,this.ProcessType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ProcessType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),xL=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),PL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.Identification=h,this.LongDescription=l,this.ResourceType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),TL=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n,this.Depth=o,this.FlangeWidth=a,this.WebThickness=u,this.FlangeThickness=h,this.FilletRadius=l,this.EdgeRadius=c,this.FlangeSlope=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.FlangeWidth),e.push(this.WebThickness),e.push(this.FlangeThickness),e.push(this.FilletRadius),e.push(this.EdgeRadius),e.push(this.FlangeSlope),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),wL=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.Units=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Units),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),ML=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),IL=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),CL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),DL=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),AL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),kL=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),EL=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.Orientation=s,this.Magnitude=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Orientation),e.push(this.Magnitude),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),FL=function(){function e(t,i){w(this,e),this.expressID=t,this.type=i}return I(e,[{key:"ToTape",value:function(){return[]}}],[{key:"FromTape",value:function(t,i,s){return new e(t,i)}}]),e}(),RL=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.LoopVertex=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.LoopVertex),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),SL=function(){function e(t,i,s){w(this,e),this.expressID=t,this.type=i,this.VertexGeometry=s}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.VertexGeometry),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++])}}]),e}(),OL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),BL=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),LL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),NL=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),jL=function(){function e(t,i,s,r,n,o,a,u,h,l){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),GL=function(){function e(t,i,s,r){w(this,e),this.expressID=t,this.type=i,this.IntersectingAxes=s,this.OffsetDistances=r}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.IntersectingAxes),e.push(this.OffsetDistances),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++])}}]),e}(),HL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),UL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),VL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),zL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),WL=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),XL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),YL=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),KL=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.OverallHeight=c,this.OverallWidth=p,this.PredefinedType=d,this.PartitioningType=f,this.UserDefinedPartitioningType=m}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.OverallHeight),e.push(this.OverallWidth),e.push(this.PredefinedType),e.push(this.PartitioningType),e.push(this.UserDefinedPartitioningType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),JL=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v,g,_){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.LiningDepth=a,this.LiningThickness=u,this.TransomThickness=h,this.MullionThickness=l,this.FirstTransomOffset=c,this.SecondTransomOffset=p,this.FirstMullionOffset=d,this.SecondMullionOffset=f,this.ShapeAspectStyle=m,this.LiningOffset=v,this.LiningToPanelOffsetX=g,this.LiningToPanelOffsetY=_}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.LiningDepth),e.push(this.LiningThickness),e.push(this.TransomThickness),e.push(this.MullionThickness),e.push(this.FirstTransomOffset),e.push(this.SecondTransomOffset),e.push(this.FirstMullionOffset),e.push(this.SecondMullionOffset),e.push(this.ShapeAspectStyle),e.push(this.LiningOffset),e.push(this.LiningToPanelOffsetX),e.push(this.LiningToPanelOffsetY),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),ZL=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.OperationType=a,this.PanelPosition=u,this.FrameDepth=h,this.FrameThickness=l,this.ShapeAspectStyle=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.OperationType),e.push(this.PanelPosition),e.push(this.FrameDepth),e.push(this.FrameThickness),e.push(this.ShapeAspectStyle),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),QL=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.ObjectPlacement=u,this.Representation=h,this.Tag=l,this.OverallHeight=c,this.OverallWidth=p,this.PredefinedType=d,this.PartitioningType=f,this.UserDefinedPartitioningType=m}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.OverallHeight),e.push(this.OverallWidth),e.push(this.PredefinedType),e.push(this.PartitioningType),e.push(this.UserDefinedPartitioningType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),qL=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ConstructionType=c,this.OperationType=p,this.ParameterTakesPrecedence=d,this.Sizeable=f}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ConstructionType),e.push(this.OperationType),e.push(this.ParameterTakesPrecedence),e.push(this.Sizeable),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),$L=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ApplicableOccurrence=a,this.HasPropertySets=u,this.RepresentationMaps=h,this.Tag=l,this.ElementType=c,this.PredefinedType=p,this.PartitioningType=d,this.ParameterTakesPrecedence=f,this.UserDefinedPartitioningType=m}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.PartitioningType),e.push(this.ParameterTakesPrecedence),e.push(this.UserDefinedPartitioningType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),eN=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.WorkingTimes=h,this.ExceptionTimes=l,this.PredefinedType=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.WorkingTimes),e.push(this.ExceptionTimes),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),tN=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.CreationDate=h,this.Creators=l,this.Purpose=c,this.Duration=p,this.TotalFloat=d,this.StartTime=f,this.FinishTime=m}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.CreationDate),e.push(this.Creators),e.push(this.Purpose),e.push(this.Duration),e.push(this.TotalFloat),e.push(this.StartTime),e.push(this.FinishTime),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),iN=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.CreationDate=h,this.Creators=l,this.Purpose=c,this.Duration=p,this.TotalFloat=d,this.StartTime=f,this.FinishTime=m,this.PredefinedType=v}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.CreationDate),e.push(this.Creators),e.push(this.Purpose),e.push(this.Duration),e.push(this.TotalFloat),e.push(this.StartTime),e.push(this.FinishTime),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),sN=function(){function e(t,i,s,r,n,o,a,u,h,l,c,p,d,f,m,v){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.Identification=u,this.CreationDate=h,this.Creators=l,this.Purpose=c,this.Duration=p,this.TotalFloat=d,this.StartTime=f,this.FinishTime=m,this.PredefinedType=v}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.CreationDate),e.push(this.Creators),e.push(this.Purpose),e.push(this.Duration),e.push(this.TotalFloat),e.push(this.StartTime),e.push(this.FinishTime),e.push(this.PredefinedType),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),rN=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.Name=s,this.DataOrigin=r,this.UserDefinedDataOrigin=n,this.RecurrencePattern=o,this.Start=a,this.Finish=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.RecurrencePattern),e.push(this.Start),e.push(this.Finish),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),nN=function(){function e(t,i,s,r,n,o,a,u,h,l,c){w(this,e),this.expressID=t,this.type=i,this.ProfileType=s,this.ProfileName=r,this.Position=n,this.Depth=o,this.FlangeWidth=a,this.WebThickness=u,this.FlangeThickness=h,this.FilletRadius=l,this.EdgeRadius=c}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.FlangeWidth),e.push(this.WebThickness),e.push(this.FlangeThickness),e.push(this.FilletRadius),e.push(this.EdgeRadius),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),oN=function(){function e(t,i,s,r,n,o,a,u){w(this,e),this.expressID=t,this.type=i,this.GlobalId=s,this.OwnerHistory=r,this.Name=n,this.Description=o,this.ObjectType=a,this.LongName=u}return I(e,[{key:"ToTape",value:function(){var e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e}}],[{key:"FromTape",value:function(t,i,s){var r=0;return new e(t,i,s[r++],s[r++],s[r++],s[r++],s[r++],s[r++])}}]),e}(),aN={103090709:"IFCPROJECT",4097777520:"IFCSITE",4031249490:"IFCBUILDING",3124254112:"IFCBUILDINGSTOREY",3856911033:"IFCSPACE",1674181508:"IFCANNOTATION",25142252:"IFCCONTROLLER",32344328:"IFCBOILER",76236018:"IFCLAMP",90941305:"IFCPUMP",177149247:"IFCAIRTERMINALBOX",182646315:"IFCFLOWINSTRUMENT",263784265:"IFCFURNISHINGELEMENT",264262732:"IFCELECTRICGENERATOR",277319702:"IFCAUDIOVISUALAPPLIANCE",310824031:"IFCPIPEFITTING",331165859:"IFCSTAIR",342316401:"IFCDUCTFITTING",377706215:"IFCMECHANICALFASTENER",395920057:"IFCDOOR",402227799:"IFCELECTRICMOTOR",413509423:"IFCSYSTEMFURNITUREELEMENT",484807127:"IFCEVAPORATOR",486154966:"IFCWINDOWSTANDARDCASE",629592764:"IFCLIGHTFIXTURE",630975310:"IFCUNITARYCONTROLELEMENT",635142910:"IFCCABLECARRIERFITTING",639361253:"IFCCOIL",647756555:"IFCFASTENER",707683696:"IFCFLOWSTORAGEDEVICE",738039164:"IFCPROTECTIVEDEVICE",753842376:"IFCBEAM",812556717:"IFCTANK",819412036:"IFCFILTER",843113511:"IFCCOLUMN",862014818:"IFCELECTRICDISTRIBUTIONBOARD",900683007:"IFCFOOTING",905975707:"IFCCOLUMNSTANDARDCASE",926996030:"IFCVOIDINGFEATURE",979691226:"IFCREINFORCINGBAR",987401354:"IFCFLOWSEGMENT",1003880860:"IFCELECTRICTIMECONTROL",1051757585:"IFCCABLEFITTING",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1073191201:"IFCMEMBER",1095909175:"IFCBUILDINGELEMENTPROXY",1156407060:"IFCPLATESTANDARDCASE",1162798199:"IFCSWITCHINGDEVICE",1329646415:"IFCSHADINGDEVICE",1335981549:"IFCDISCRETEACCESSORY",1360408905:"IFCDUCTSILENCER",1404847402:"IFCSTACKTERMINAL",1426591983:"IFCFIRESUPPRESSIONTERMINAL",1437502449:"IFCMEDICALDEVICE",1509553395:"IFCFURNITURE",1529196076:"IFCSLAB",1620046519:"IFCTRANSPORTELEMENT",1634111441:"IFCAIRTERMINAL",1658829314:"IFCENERGYCONVERSIONDEVICE",1677625105:"IFCCIVILELEMENT",1687234759:"IFCPILE",1904799276:"IFCELECTRICAPPLIANCE",1911478936:"IFCMEMBERSTANDARDCASE",1945004755:"IFCDISTRIBUTIONELEMENT",1973544240:"IFCCOVERING",1999602285:"IFCSPACEHEATER",2016517767:"IFCROOF",2056796094:"IFCAIRTOAIRHEATRECOVERY",2058353004:"IFCFLOWCONTROLLER",2068733104:"IFCHUMIDIFIER",2176052936:"IFCJUNCTIONBOX",2188021234:"IFCFLOWMETER",2223149337:"IFCFLOWTERMINAL",2262370178:"IFCRAILING",2272882330:"IFCCONDENSER",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",2320036040:"IFCREINFORCINGMESH",2347447852:"IFCTENDONANCHOR",2391383451:"IFCVIBRATIONISOLATOR",2391406946:"IFCWALL",2474470126:"IFCMOTORCONNECTION",2769231204:"IFCVIRTUALELEMENT",2814081492:"IFCENGINE",2906023776:"IFCBEAMSTANDARDCASE",2938176219:"IFCBURNER",2979338954:"IFCBUILDINGELEMENTPART",3024970846:"IFCRAMP",3026737570:"IFCTUBEBUNDLE",3027962421:"IFCSLABSTANDARDCASE",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",3053780830:"IFCSANITARYTERMINAL",3079942009:"IFCOPENINGSTANDARDCASE",3087945054:"IFCALARM",3101698114:"IFCSURFACEFEATURE",3127900445:"IFCSLABELEMENTEDCASE",3132237377:"IFCFLOWMOVINGDEVICE",3171933400:"IFCPLATE",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",3242481149:"IFCDOORSTANDARDCASE",3283111854:"IFCRAMPFLIGHT",3296154744:"IFCCHIMNEY",3304561284:"IFCWINDOW",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",3319311131:"IFCHEATEXCHANGER",3415622556:"IFCFAN",3420628829:"IFCSOLARDEVICE",3493046030:"IFCGEOGRAPHICELEMENT",3495092785:"IFCCURTAINWALL",3508470533:"IFCFLOWTREATMENTDEVICE",3512223829:"IFCWALLSTANDARDCASE",3518393246:"IFCDUCTSEGMENT",3571504051:"IFCCOMPRESSOR",3588315303:"IFCOPENINGELEMENT",3612865200:"IFCPIPESEGMENT",3640358203:"IFCCOOLINGTOWER",3651124850:"IFCPROJECTIONELEMENT",3694346114:"IFCOUTLET",3747195512:"IFCEVAPORATIVECOOLER",3758799889:"IFCCABLECARRIERSEGMENT",3824725483:"IFCTENDON",3825984169:"IFCTRANSFORMER",3902619387:"IFCCHILLER",4074379575:"IFCDAMPER",4086658281:"IFCSENSOR",4123344466:"IFCELEMENTASSEMBLY",4136498852:"IFCCOOLEDBEAM",4156078855:"IFCWALLELEMENTEDCASE",4175244083:"IFCINTERCEPTOR",4207607924:"IFCVALVE",4217484030:"IFCCABLESEGMENT",4237592921:"IFCWASTETERMINAL",4252922144:"IFCSTAIRFLIGHT",4278956645:"IFCFLOWFITTING",4288193352:"IFCACTUATOR",4292641817:"IFCUNITARYEQUIPMENT",3009204131:"IFCGRID"},uN={3821786052:"IFCACTIONREQUEST",2296667514:"IFCACTOR",3630933823:"IFCACTORROLE",4288193352:"IFCACTUATOR",2874132201:"IFCACTUATORTYPE",618182010:"IFCADDRESS",1635779807:"IFCADVANCEDBREP",2603310189:"IFCADVANCEDBREPWITHVOIDS",3406155212:"IFCADVANCEDFACE",1634111441:"IFCAIRTERMINAL",177149247:"IFCAIRTERMINALBOX",1411407467:"IFCAIRTERMINALBOXTYPE",3352864051:"IFCAIRTERMINALTYPE",2056796094:"IFCAIRTOAIRHEATRECOVERY",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3087945054:"IFCALARM",3001207471:"IFCALARMTYPE",325726236:"IFCALIGNMENT",749761778:"IFCALIGNMENT2DHORIZONTAL",3199563722:"IFCALIGNMENT2DHORIZONTALSEGMENT",2483840362:"IFCALIGNMENT2DSEGMENT",3379348081:"IFCALIGNMENT2DVERSEGCIRCULARARC",3239324667:"IFCALIGNMENT2DVERSEGLINE",4263986512:"IFCALIGNMENT2DVERSEGPARABOLICARC",53199957:"IFCALIGNMENT2DVERTICAL",2029264950:"IFCALIGNMENT2DVERTICALSEGMENT",3512275521:"IFCALIGNMENTCURVE",1674181508:"IFCANNOTATION",669184980:"IFCANNOTATIONFILLAREA",639542469:"IFCAPPLICATION",411424972:"IFCAPPLIEDVALUE",130549933:"IFCAPPROVAL",3869604511:"IFCAPPROVALRELATIONSHIP",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",1310608509:"IFCARBITRARYOPENPROFILEDEF",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",3460190687:"IFCASSET",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",277319702:"IFCAUDIOVISUALAPPLIANCE",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4261334040:"IFCAXIS1PLACEMENT",3125803723:"IFCAXIS2PLACEMENT2D",2740243338:"IFCAXIS2PLACEMENT3D",1967976161:"IFCBSPLINECURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",167062518:"IFCBSPLINESURFACEWITHKNOTS",753842376:"IFCBEAM",2906023776:"IFCBEAMSTANDARDCASE",819618141:"IFCBEAMTYPE",4196446775:"IFCBEARING",3649138523:"IFCBEARINGTYPE",616511568:"IFCBLOBTEXTURE",1334484129:"IFCBLOCK",32344328:"IFCBOILER",231477066:"IFCBOILERTYPE",3649129432:"IFCBOOLEANCLIPPINGRESULT",2736907675:"IFCBOOLEANRESULT",4037036970:"IFCBOUNDARYCONDITION",1136057603:"IFCBOUNDARYCURVE",1560379544:"IFCBOUNDARYEDGECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1387855156:"IFCBOUNDARYNODECONDITION",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1260505505:"IFCBOUNDEDCURVE",4182860854:"IFCBOUNDEDSURFACE",2581212453:"IFCBOUNDINGBOX",2713105998:"IFCBOXEDHALFSPACE",644574406:"IFCBRIDGE",963979645:"IFCBRIDGEPART",4031249490:"IFCBUILDING",3299480353:"IFCBUILDINGELEMENT",2979338954:"IFCBUILDINGELEMENTPART",39481116:"IFCBUILDINGELEMENTPARTTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1950629157:"IFCBUILDINGELEMENTTYPE",3124254112:"IFCBUILDINGSTOREY",1177604601:"IFCBUILDINGSYSTEM",2938176219:"IFCBURNER",2188180465:"IFCBURNERTYPE",2898889636:"IFCCSHAPEPROFILEDEF",635142910:"IFCCABLECARRIERFITTING",395041908:"IFCCABLECARRIERFITTINGTYPE",3758799889:"IFCCABLECARRIERSEGMENT",3293546465:"IFCCABLECARRIERSEGMENTTYPE",1051757585:"IFCCABLEFITTING",2674252688:"IFCCABLEFITTINGTYPE",4217484030:"IFCCABLESEGMENT",1285652485:"IFCCABLESEGMENTTYPE",3999819293:"IFCCAISSONFOUNDATION",3203706013:"IFCCAISSONFOUNDATIONTYPE",1123145078:"IFCCARTESIANPOINT",574549367:"IFCCARTESIANPOINTLIST",1675464909:"IFCCARTESIANPOINTLIST2D",2059837836:"IFCCARTESIANPOINTLIST3D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3150382593:"IFCCENTERLINEPROFILEDEF",3902619387:"IFCCHILLER",2951183804:"IFCCHILLERTYPE",3296154744:"IFCCHIMNEY",2197970202:"IFCCHIMNEYTYPE",2611217952:"IFCCIRCLE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",1383045692:"IFCCIRCLEPROFILEDEF",1062206242:"IFCCIRCULARARCSEGMENT2D",1677625105:"IFCCIVILELEMENT",3893394355:"IFCCIVILELEMENTTYPE",747523909:"IFCCLASSIFICATION",647927063:"IFCCLASSIFICATIONREFERENCE",2205249479:"IFCCLOSEDSHELL",639361253:"IFCCOIL",2301859152:"IFCCOILTYPE",776857604:"IFCCOLOURRGB",3285139300:"IFCCOLOURRGBLIST",3264961684:"IFCCOLOURSPECIFICATION",843113511:"IFCCOLUMN",905975707:"IFCCOLUMNSTANDARDCASE",300633059:"IFCCOLUMNTYPE",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",2542286263:"IFCCOMPLEXPROPERTY",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3732776249:"IFCCOMPOSITECURVE",15328376:"IFCCOMPOSITECURVEONSURFACE",2485617015:"IFCCOMPOSITECURVESEGMENT",1485152156:"IFCCOMPOSITEPROFILEDEF",3571504051:"IFCCOMPRESSOR",3850581409:"IFCCOMPRESSORTYPE",2272882330:"IFCCONDENSER",2816379211:"IFCCONDENSERTYPE",2510884976:"IFCCONIC",370225590:"IFCCONNECTEDFACESET",1981873012:"IFCCONNECTIONCURVEGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",45288368:"IFCCONNECTIONPOINTECCENTRICITY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",1959218052:"IFCCONSTRAINT",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",2559216714:"IFCCONSTRUCTIONRESOURCE",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",3419103109:"IFCCONTEXT",3050246964:"IFCCONTEXTDEPENDENTUNIT",3293443760:"IFCCONTROL",25142252:"IFCCONTROLLER",578613899:"IFCCONTROLLERTYPE",2889183280:"IFCCONVERSIONBASEDUNIT",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",4136498852:"IFCCOOLEDBEAM",335055490:"IFCCOOLEDBEAMTYPE",3640358203:"IFCCOOLINGTOWER",2954562838:"IFCCOOLINGTOWERTYPE",1785450214:"IFCCOORDINATEOPERATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",3895139033:"IFCCOSTITEM",1419761937:"IFCCOSTSCHEDULE",602808272:"IFCCOSTVALUE",1973544240:"IFCCOVERING",1916426348:"IFCCOVERINGTYPE",3295246426:"IFCCREWRESOURCE",1815067380:"IFCCREWRESOURCETYPE",2506170314:"IFCCSGPRIMITIVE3D",2147822146:"IFCCSGSOLID",539742890:"IFCCURRENCYRELATIONSHIP",3495092785:"IFCCURTAINWALL",1457835157:"IFCCURTAINWALLTYPE",2601014836:"IFCCURVE",2827736869:"IFCCURVEBOUNDEDPLANE",2629017746:"IFCCURVEBOUNDEDSURFACE",1186437898:"IFCCURVESEGMENT2D",3800577675:"IFCCURVESTYLE",1105321065:"IFCCURVESTYLEFONT",2367409068:"IFCCURVESTYLEFONTANDSCALING",3510044353:"IFCCURVESTYLEFONTPATTERN",1213902940:"IFCCYLINDRICALSURFACE",4074379575:"IFCDAMPER",3961806047:"IFCDAMPERTYPE",3426335179:"IFCDEEPFOUNDATION",1306400036:"IFCDEEPFOUNDATIONTYPE",3632507154:"IFCDERIVEDPROFILEDEF",1765591967:"IFCDERIVEDUNIT",1045800335:"IFCDERIVEDUNITELEMENT",2949456006:"IFCDIMENSIONALEXPONENTS",32440307:"IFCDIRECTION",1335981549:"IFCDISCRETEACCESSORY",2635815018:"IFCDISCRETEACCESSORYTYPE",1945343521:"IFCDISTANCEEXPRESSION",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",562808652:"IFCDISTRIBUTIONCIRCUIT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1945004755:"IFCDISTRIBUTIONELEMENT",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3041715199:"IFCDISTRIBUTIONPORT",3205830791:"IFCDISTRIBUTIONSYSTEM",1154170062:"IFCDOCUMENTINFORMATION",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",3732053477:"IFCDOCUMENTREFERENCE",395920057:"IFCDOOR",2963535650:"IFCDOORLININGPROPERTIES",1714330368:"IFCDOORPANELPROPERTIES",3242481149:"IFCDOORSTANDARDCASE",526551008:"IFCDOORSTYLE",2323601079:"IFCDOORTYPE",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",342316401:"IFCDUCTFITTING",869906466:"IFCDUCTFITTINGTYPE",3518393246:"IFCDUCTSEGMENT",3760055223:"IFCDUCTSEGMENTTYPE",1360408905:"IFCDUCTSILENCER",2030761528:"IFCDUCTSILENCERTYPE",3900360178:"IFCEDGE",476780140:"IFCEDGECURVE",1472233963:"IFCEDGELOOP",1904799276:"IFCELECTRICAPPLIANCE",663422040:"IFCELECTRICAPPLIANCETYPE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",264262732:"IFCELECTRICGENERATOR",1534661035:"IFCELECTRICGENERATORTYPE",402227799:"IFCELECTRICMOTOR",1217240411:"IFCELECTRICMOTORTYPE",1003880860:"IFCELECTRICTIMECONTROL",712377611:"IFCELECTRICTIMECONTROLTYPE",1758889154:"IFCELEMENT",4123344466:"IFCELEMENTASSEMBLY",2397081782:"IFCELEMENTASSEMBLYTYPE",1623761950:"IFCELEMENTCOMPONENT",2590856083:"IFCELEMENTCOMPONENTTYPE",1883228015:"IFCELEMENTQUANTITY",339256511:"IFCELEMENTTYPE",2777663545:"IFCELEMENTARYSURFACE",1704287377:"IFCELLIPSE",2835456948:"IFCELLIPSEPROFILEDEF",1658829314:"IFCENERGYCONVERSIONDEVICE",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",2814081492:"IFCENGINE",132023988:"IFCENGINETYPE",3747195512:"IFCEVAPORATIVECOOLER",3174744832:"IFCEVAPORATIVECOOLERTYPE",484807127:"IFCEVAPORATOR",3390157468:"IFCEVAPORATORTYPE",4148101412:"IFCEVENT",211053100:"IFCEVENTTIME",4024345920:"IFCEVENTTYPE",297599258:"IFCEXTENDEDPROPERTIES",4294318154:"IFCEXTERNALINFORMATION",3200245327:"IFCEXTERNALREFERENCE",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",1209101575:"IFCEXTERNALSPATIALELEMENT",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",477187591:"IFCEXTRUDEDAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",2556980723:"IFCFACE",2047409740:"IFCFACEBASEDSURFACEMODEL",1809719519:"IFCFACEBOUND",803316827:"IFCFACEOUTERBOUND",3008276851:"IFCFACESURFACE",807026263:"IFCFACETEDBREP",3737207727:"IFCFACETEDBREPWITHVOIDS",24185140:"IFCFACILITY",1310830890:"IFCFACILITYPART",4219587988:"IFCFAILURECONNECTIONCONDITION",3415622556:"IFCFAN",346874300:"IFCFANTYPE",647756555:"IFCFASTENER",2489546625:"IFCFASTENERTYPE",2827207264:"IFCFEATUREELEMENT",2143335405:"IFCFEATUREELEMENTADDITION",1287392070:"IFCFEATUREELEMENTSUBTRACTION",738692330:"IFCFILLAREASTYLE",374418227:"IFCFILLAREASTYLEHATCHING",315944413:"IFCFILLAREASTYLETILES",819412036:"IFCFILTER",1810631287:"IFCFILTERTYPE",1426591983:"IFCFIRESUPPRESSIONTERMINAL",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2058353004:"IFCFLOWCONTROLLER",3907093117:"IFCFLOWCONTROLLERTYPE",4278956645:"IFCFLOWFITTING",3198132628:"IFCFLOWFITTINGTYPE",182646315:"IFCFLOWINSTRUMENT",4037862832:"IFCFLOWINSTRUMENTTYPE",2188021234:"IFCFLOWMETER",3815607619:"IFCFLOWMETERTYPE",3132237377:"IFCFLOWMOVINGDEVICE",1482959167:"IFCFLOWMOVINGDEVICETYPE",987401354:"IFCFLOWSEGMENT",1834744321:"IFCFLOWSEGMENTTYPE",707683696:"IFCFLOWSTORAGEDEVICE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",2223149337:"IFCFLOWTERMINAL",2297155007:"IFCFLOWTERMINALTYPE",3508470533:"IFCFLOWTREATMENTDEVICE",3009222698:"IFCFLOWTREATMENTDEVICETYPE",900683007:"IFCFOOTING",1893162501:"IFCFOOTINGTYPE",263784265:"IFCFURNISHINGELEMENT",4238390223:"IFCFURNISHINGELEMENTTYPE",1509553395:"IFCFURNITURE",1268542332:"IFCFURNITURETYPE",3493046030:"IFCGEOGRAPHICELEMENT",4095422895:"IFCGEOGRAPHICELEMENTTYPE",987898635:"IFCGEOMETRICCURVESET",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",3590301190:"IFCGEOMETRICSET",3009204131:"IFCGRID",852622518:"IFCGRIDAXIS",178086475:"IFCGRIDPLACEMENT",2706460486:"IFCGROUP",812098782:"IFCHALFSPACESOLID",3319311131:"IFCHEATEXCHANGER",1251058090:"IFCHEATEXCHANGERTYPE",2068733104:"IFCHUMIDIFIER",1806887404:"IFCHUMIDIFIERTYPE",1484403080:"IFCISHAPEPROFILEDEF",3905492369:"IFCIMAGETEXTURE",3570813810:"IFCINDEXEDCOLOURMAP",2571569899:"IFCINDEXEDPOLYCURVE",178912537:"IFCINDEXEDPOLYGONALFACE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",1437953363:"IFCINDEXEDTEXTUREMAP",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",4175244083:"IFCINTERCEPTOR",3946677679:"IFCINTERCEPTORTYPE",3113134337:"IFCINTERSECTIONCURVE",2391368822:"IFCINVENTORY",3741457305:"IFCIRREGULARTIMESERIES",3020489413:"IFCIRREGULARTIMESERIESVALUE",2176052936:"IFCJUNCTIONBOX",4288270099:"IFCJUNCTIONBOXTYPE",572779678:"IFCLSHAPEPROFILEDEF",3827777499:"IFCLABORRESOURCE",428585644:"IFCLABORRESOURCETYPE",1585845231:"IFCLAGTIME",76236018:"IFCLAMP",1051575348:"IFCLAMPTYPE",2655187982:"IFCLIBRARYINFORMATION",3452421091:"IFCLIBRARYREFERENCE",4162380809:"IFCLIGHTDISTRIBUTIONDATA",629592764:"IFCLIGHTFIXTURE",1161773419:"IFCLIGHTFIXTURETYPE",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",1402838566:"IFCLIGHTSOURCE",125510826:"IFCLIGHTSOURCEAMBIENT",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",1520743889:"IFCLIGHTSOURCEPOSITIONAL",3422422726:"IFCLIGHTSOURCESPOT",1281925730:"IFCLINE",3092502836:"IFCLINESEGMENT2D",388784114:"IFCLINEARPLACEMENT",1154579445:"IFCLINEARPOSITIONINGELEMENT",2624227202:"IFCLOCALPLACEMENT",1008929658:"IFCLOOP",1425443689:"IFCMANIFOLDSOLIDBREP",3057273783:"IFCMAPCONVERSION",2347385850:"IFCMAPPEDITEM",1838606355:"IFCMATERIAL",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",3708119e3:"IFCMATERIALCONSTITUENT",2852063980:"IFCMATERIALCONSTITUENTSET",760658860:"IFCMATERIALDEFINITION",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",248100487:"IFCMATERIALLAYER",3303938423:"IFCMATERIALLAYERSET",1303795690:"IFCMATERIALLAYERSETUSAGE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",2199411900:"IFCMATERIALLIST",2235152071:"IFCMATERIALPROFILE",164193824:"IFCMATERIALPROFILESET",3079605661:"IFCMATERIALPROFILESETUSAGE",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",552965576:"IFCMATERIALPROFILEWITHOFFSETS",3265635763:"IFCMATERIALPROPERTIES",853536259:"IFCMATERIALRELATIONSHIP",1507914824:"IFCMATERIALUSAGEDEFINITION",2597039031:"IFCMEASUREWITHUNIT",377706215:"IFCMECHANICALFASTENER",2108223431:"IFCMECHANICALFASTENERTYPE",1437502449:"IFCMEDICALDEVICE",1114901282:"IFCMEDICALDEVICETYPE",1073191201:"IFCMEMBER",1911478936:"IFCMEMBERSTANDARDCASE",3181161470:"IFCMEMBERTYPE",3368373690:"IFCMETRIC",2998442950:"IFCMIRROREDPROFILEDEF",2706619895:"IFCMONETARYUNIT",2474470126:"IFCMOTORCONNECTION",977012517:"IFCMOTORCONNECTIONTYPE",1918398963:"IFCNAMEDUNIT",3888040117:"IFCOBJECT",219451334:"IFCOBJECTDEFINITION",3701648758:"IFCOBJECTPLACEMENT",2251480897:"IFCOBJECTIVE",4143007308:"IFCOCCUPANT",590820931:"IFCOFFSETCURVE",3388369263:"IFCOFFSETCURVE2D",3505215534:"IFCOFFSETCURVE3D",2485787929:"IFCOFFSETCURVEBYDISTANCES",2665983363:"IFCOPENSHELL",3588315303:"IFCOPENINGELEMENT",3079942009:"IFCOPENINGSTANDARDCASE",4251960020:"IFCORGANIZATION",1411181986:"IFCORGANIZATIONRELATIONSHIP",643959842:"IFCORIENTATIONEXPRESSION",1029017970:"IFCORIENTEDEDGE",144952367:"IFCOUTERBOUNDARYCURVE",3694346114:"IFCOUTLET",2837617999:"IFCOUTLETTYPE",1207048766:"IFCOWNERHISTORY",2529465313:"IFCPARAMETERIZEDPROFILEDEF",2519244187:"IFCPATH",1682466193:"IFCPCURVE",2382730787:"IFCPERFORMANCEHISTORY",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3327091369:"IFCPERMIT",2077209135:"IFCPERSON",101040310:"IFCPERSONANDORGANIZATION",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2483315170:"IFCPHYSICALQUANTITY",2226359599:"IFCPHYSICALSIMPLEQUANTITY",1687234759:"IFCPILE",1158309216:"IFCPILETYPE",310824031:"IFCPIPEFITTING",804291784:"IFCPIPEFITTINGTYPE",3612865200:"IFCPIPESEGMENT",4231323485:"IFCPIPESEGMENTTYPE",597895409:"IFCPIXELTEXTURE",2004835150:"IFCPLACEMENT",603570806:"IFCPLANARBOX",1663979128:"IFCPLANAREXTENT",220341763:"IFCPLANE",3171933400:"IFCPLATE",1156407060:"IFCPLATESTANDARDCASE",4017108033:"IFCPLATETYPE",2067069095:"IFCPOINT",4022376103:"IFCPOINTONCURVE",1423911732:"IFCPOINTONSURFACE",2924175390:"IFCPOLYLOOP",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2839578677:"IFCPOLYGONALFACESET",3724593414:"IFCPOLYLINE",3740093272:"IFCPORT",1946335990:"IFCPOSITIONINGELEMENT",3355820592:"IFCPOSTALADDRESS",759155922:"IFCPREDEFINEDCOLOUR",2559016684:"IFCPREDEFINEDCURVEFONT",3727388367:"IFCPREDEFINEDITEM",3778827333:"IFCPREDEFINEDPROPERTIES",3967405729:"IFCPREDEFINEDPROPERTYSET",1775413392:"IFCPREDEFINEDTEXTFONT",677532197:"IFCPRESENTATIONITEM",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",3119450353:"IFCPRESENTATIONSTYLE",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",2744685151:"IFCPROCEDURE",569719735:"IFCPROCEDURETYPE",2945172077:"IFCPROCESS",4208778838:"IFCPRODUCT",673634403:"IFCPRODUCTDEFINITIONSHAPE",2095639259:"IFCPRODUCTREPRESENTATION",3958567839:"IFCPROFILEDEF",2802850158:"IFCPROFILEPROPERTIES",103090709:"IFCPROJECT",653396225:"IFCPROJECTLIBRARY",2904328755:"IFCPROJECTORDER",3843373140:"IFCPROJECTEDCRS",3651124850:"IFCPROJECTIONELEMENT",2598011224:"IFCPROPERTY",986844984:"IFCPROPERTYABSTRACTION",871118103:"IFCPROPERTYBOUNDEDVALUE",1680319473:"IFCPROPERTYDEFINITION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",4166981789:"IFCPROPERTYENUMERATEDVALUE",3710013099:"IFCPROPERTYENUMERATION",2752243245:"IFCPROPERTYLISTVALUE",941946838:"IFCPROPERTYREFERENCEVALUE",1451395588:"IFCPROPERTYSET",3357820518:"IFCPROPERTYSETDEFINITION",492091185:"IFCPROPERTYSETTEMPLATE",3650150729:"IFCPROPERTYSINGLEVALUE",110355661:"IFCPROPERTYTABLEVALUE",3521284610:"IFCPROPERTYTEMPLATE",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",738039164:"IFCPROTECTIVEDEVICE",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3219374653:"IFCPROXY",90941305:"IFCPUMP",2250791053:"IFCPUMPTYPE",2044713172:"IFCQUANTITYAREA",2093928680:"IFCQUANTITYCOUNT",931644368:"IFCQUANTITYLENGTH",2090586900:"IFCQUANTITYSET",3252649465:"IFCQUANTITYTIME",2405470396:"IFCQUANTITYVOLUME",825690147:"IFCQUANTITYWEIGHT",2262370178:"IFCRAILING",2893384427:"IFCRAILINGTYPE",3024970846:"IFCRAMP",3283111854:"IFCRAMPFLIGHT",2324767716:"IFCRAMPFLIGHTTYPE",1469900589:"IFCRAMPTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3615266464:"IFCRECTANGLEPROFILEDEF",2798486643:"IFCRECTANGULARPYRAMID",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",3915482550:"IFCRECURRENCEPATTERN",2433181523:"IFCREFERENCE",4021432810:"IFCREFERENT",3413951693:"IFCREGULARTIMESERIES",1580146022:"IFCREINFORCEMENTBARPROPERTIES",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",979691226:"IFCREINFORCINGBAR",2572171363:"IFCREINFORCINGBARTYPE",3027567501:"IFCREINFORCINGELEMENT",964333572:"IFCREINFORCINGELEMENTTYPE",2320036040:"IFCREINFORCINGMESH",2310774935:"IFCREINFORCINGMESHTYPE",160246688:"IFCRELAGGREGATES",3939117080:"IFCRELASSIGNS",1683148259:"IFCRELASSIGNSTOACTOR",2495723537:"IFCRELASSIGNSTOCONTROL",1307041759:"IFCRELASSIGNSTOGROUP",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",4278684876:"IFCRELASSIGNSTOPROCESS",2857406711:"IFCRELASSIGNSTOPRODUCT",205026976:"IFCRELASSIGNSTORESOURCE",1865459582:"IFCRELASSOCIATES",4095574036:"IFCRELASSOCIATESAPPROVAL",919958153:"IFCRELASSOCIATESCLASSIFICATION",2728634034:"IFCRELASSOCIATESCONSTRAINT",982818633:"IFCRELASSOCIATESDOCUMENT",3840914261:"IFCRELASSOCIATESLIBRARY",2655215786:"IFCRELASSOCIATESMATERIAL",826625072:"IFCRELCONNECTS",1204542856:"IFCRELCONNECTSELEMENTS",3945020480:"IFCRELCONNECTSPATHELEMENTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3190031847:"IFCRELCONNECTSPORTS",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",504942748:"IFCRELCONNECTSWITHECCENTRICITY",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",886880790:"IFCRELCOVERSBLDGELEMENTS",2802773753:"IFCRELCOVERSSPACES",2565941209:"IFCRELDECLARES",2551354335:"IFCRELDECOMPOSES",693640335:"IFCRELDEFINES",1462361463:"IFCRELDEFINESBYOBJECT",4186316022:"IFCRELDEFINESBYPROPERTIES",307848117:"IFCRELDEFINESBYTEMPLATE",781010003:"IFCRELDEFINESBYTYPE",3940055652:"IFCRELFILLSELEMENT",279856033:"IFCRELFLOWCONTROLELEMENTS",427948657:"IFCRELINTERFERESELEMENTS",3268803585:"IFCRELNESTS",1441486842:"IFCRELPOSITIONS",750771296:"IFCRELPROJECTSELEMENT",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",4122056220:"IFCRELSEQUENCE",366585022:"IFCRELSERVICESBUILDINGS",3451746338:"IFCRELSPACEBOUNDARY",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",1401173127:"IFCRELVOIDSELEMENT",478536968:"IFCRELATIONSHIP",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1076942058:"IFCREPRESENTATION",3377609919:"IFCREPRESENTATIONCONTEXT",3008791417:"IFCREPRESENTATIONITEM",1660063152:"IFCREPRESENTATIONMAP",2914609552:"IFCRESOURCE",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2439245199:"IFCRESOURCELEVELRELATIONSHIP",1042787934:"IFCRESOURCETIME",1856042241:"IFCREVOLVEDAREASOLID",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",4158566097:"IFCRIGHTCIRCULARCONE",3626867408:"IFCRIGHTCIRCULARCYLINDER",2016517767:"IFCROOF",2781568857:"IFCROOFTYPE",2341007311:"IFCROOT",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",448429030:"IFCSIUNIT",3053780830:"IFCSANITARYTERMINAL",1768891740:"IFCSANITARYTERMINALTYPE",1054537805:"IFCSCHEDULINGTIME",2157484638:"IFCSEAMCURVE",2042790032:"IFCSECTIONPROPERTIES",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",1862484736:"IFCSECTIONEDSOLID",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1509187699:"IFCSECTIONEDSPINE",4086658281:"IFCSENSOR",1783015770:"IFCSENSORTYPE",1329646415:"IFCSHADINGDEVICE",4074543187:"IFCSHADINGDEVICETYPE",867548509:"IFCSHAPEASPECT",3982875396:"IFCSHAPEMODEL",4240577450:"IFCSHAPEREPRESENTATION",4124623270:"IFCSHELLBASEDSURFACEMODEL",3692461612:"IFCSIMPLEPROPERTY",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",4097777520:"IFCSITE",1529196076:"IFCSLAB",3127900445:"IFCSLABELEMENTEDCASE",3027962421:"IFCSLABSTANDARDCASE",2533589738:"IFCSLABTYPE",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",3420628829:"IFCSOLARDEVICE",1072016465:"IFCSOLARDEVICETYPE",723233188:"IFCSOLIDMODEL",3856911033:"IFCSPACE",1999602285:"IFCSPACEHEATER",1305183839:"IFCSPACEHEATERTYPE",3812236995:"IFCSPACETYPE",1412071761:"IFCSPATIALELEMENT",710998568:"IFCSPATIALELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",463610769:"IFCSPATIALZONE",2481509218:"IFCSPATIALZONETYPE",451544542:"IFCSPHERE",4015995234:"IFCSPHERICALSURFACE",1404847402:"IFCSTACKTERMINAL",3112655638:"IFCSTACKTERMINALTYPE",331165859:"IFCSTAIR",4252922144:"IFCSTAIRFLIGHT",1039846685:"IFCSTAIRFLIGHTTYPE",338393293:"IFCSTAIRTYPE",682877961:"IFCSTRUCTURALACTION",3544373492:"IFCSTRUCTURALACTIVITY",2515109513:"IFCSTRUCTURALANALYSISMODEL",1179482911:"IFCSTRUCTURALCONNECTION",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",1004757350:"IFCSTRUCTURALCURVEACTION",4243806635:"IFCSTRUCTURALCURVECONNECTION",214636428:"IFCSTRUCTURALCURVEMEMBER",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",2757150158:"IFCSTRUCTURALCURVEREACTION",3136571912:"IFCSTRUCTURALITEM",1807405624:"IFCSTRUCTURALLINEARACTION",2162789131:"IFCSTRUCTURALLOAD",385403989:"IFCSTRUCTURALLOADCASE",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1252848954:"IFCSTRUCTURALLOADGROUP",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",609421318:"IFCSTRUCTURALLOADORRESULT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",2525727697:"IFCSTRUCTURALLOADSTATIC",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",530289379:"IFCSTRUCTURALMEMBER",1621171031:"IFCSTRUCTURALPLANARACTION",2082059205:"IFCSTRUCTURALPOINTACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",1235345126:"IFCSTRUCTURALPOINTREACTION",3689010777:"IFCSTRUCTURALREACTION",2986769608:"IFCSTRUCTURALRESULTGROUP",3657597509:"IFCSTRUCTURALSURFACEACTION",1975003073:"IFCSTRUCTURALSURFACECONNECTION",3979015343:"IFCSTRUCTURALSURFACEMEMBER",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",603775116:"IFCSTRUCTURALSURFACEREACTION",2830218821:"IFCSTYLEMODEL",3958052878:"IFCSTYLEDITEM",3049322572:"IFCSTYLEDREPRESENTATION",148013059:"IFCSUBCONTRACTRESOURCE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",2233826070:"IFCSUBEDGE",2513912981:"IFCSURFACE",699246055:"IFCSURFACECURVE",2028607225:"IFCSURFACECURVESWEPTAREASOLID",3101698114:"IFCSURFACEFEATURE",2809605785:"IFCSURFACEOFLINEAREXTRUSION",4124788165:"IFCSURFACEOFREVOLUTION",2934153892:"IFCSURFACEREINFORCEMENTAREA",1300840506:"IFCSURFACESTYLE",3303107099:"IFCSURFACESTYLELIGHTING",1607154358:"IFCSURFACESTYLEREFRACTION",1878645084:"IFCSURFACESTYLERENDERING",846575682:"IFCSURFACESTYLESHADING",1351298697:"IFCSURFACESTYLEWITHTEXTURES",626085974:"IFCSURFACETEXTURE",2247615214:"IFCSWEPTAREASOLID",1260650574:"IFCSWEPTDISKSOLID",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",230924584:"IFCSWEPTSURFACE",1162798199:"IFCSWITCHINGDEVICE",2315554128:"IFCSWITCHINGDEVICETYPE",2254336722:"IFCSYSTEM",413509423:"IFCSYSTEMFURNITUREELEMENT",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",3071757647:"IFCTSHAPEPROFILEDEF",985171141:"IFCTABLE",2043862942:"IFCTABLECOLUMN",531007025:"IFCTABLEROW",812556717:"IFCTANK",5716631:"IFCTANKTYPE",3473067441:"IFCTASK",1549132990:"IFCTASKTIME",2771591690:"IFCTASKTIMERECURRING",3206491090:"IFCTASKTYPE",912023232:"IFCTELECOMADDRESS",3824725483:"IFCTENDON",2347447852:"IFCTENDONANCHOR",3081323446:"IFCTENDONANCHORTYPE",3663046924:"IFCTENDONCONDUIT",2281632017:"IFCTENDONCONDUITTYPE",2415094496:"IFCTENDONTYPE",2387106220:"IFCTESSELLATEDFACESET",901063453:"IFCTESSELLATEDITEM",4282788508:"IFCTEXTLITERAL",3124975700:"IFCTEXTLITERALWITHEXTENT",1447204868:"IFCTEXTSTYLE",1983826977:"IFCTEXTSTYLEFONTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1640371178:"IFCTEXTSTYLETEXTMODEL",280115917:"IFCTEXTURECOORDINATE",1742049831:"IFCTEXTURECOORDINATEGENERATOR",2552916305:"IFCTEXTUREMAP",1210645708:"IFCTEXTUREVERTEX",3611470254:"IFCTEXTUREVERTEXLIST",1199560280:"IFCTIMEPERIOD",3101149627:"IFCTIMESERIES",581633288:"IFCTIMESERIESVALUE",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",1735638870:"IFCTOPOLOGYREPRESENTATION",1935646853:"IFCTOROIDALSURFACE",3825984169:"IFCTRANSFORMER",1692211062:"IFCTRANSFORMERTYPE",2595432518:"IFCTRANSITIONCURVESEGMENT2D",1620046519:"IFCTRANSPORTELEMENT",2097647324:"IFCTRANSPORTELEMENTTYPE",2715220739:"IFCTRAPEZIUMPROFILEDEF",2916149573:"IFCTRIANGULATEDFACESET",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3593883385:"IFCTRIMMEDCURVE",3026737570:"IFCTUBEBUNDLE",1600972822:"IFCTUBEBUNDLETYPE",1628702193:"IFCTYPEOBJECT",3736923433:"IFCTYPEPROCESS",2347495698:"IFCTYPEPRODUCT",3698973494:"IFCTYPERESOURCE",427810014:"IFCUSHAPEPROFILEDEF",180925521:"IFCUNITASSIGNMENT",630975310:"IFCUNITARYCONTROLELEMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",4292641817:"IFCUNITARYEQUIPMENT",1911125066:"IFCUNITARYEQUIPMENTTYPE",4207607924:"IFCVALVE",728799441:"IFCVALVETYPE",1417489154:"IFCVECTOR",2799835756:"IFCVERTEX",2759199220:"IFCVERTEXLOOP",1907098498:"IFCVERTEXPOINT",1530820697:"IFCVIBRATIONDAMPER",3956297820:"IFCVIBRATIONDAMPERTYPE",2391383451:"IFCVIBRATIONISOLATOR",3313531582:"IFCVIBRATIONISOLATORTYPE",2769231204:"IFCVIRTUALELEMENT",891718957:"IFCVIRTUALGRIDINTERSECTION",926996030:"IFCVOIDINGFEATURE",2391406946:"IFCWALL",4156078855:"IFCWALLELEMENTEDCASE",3512223829:"IFCWALLSTANDARDCASE",1898987631:"IFCWALLTYPE",4237592921:"IFCWASTETERMINAL",1133259667:"IFCWASTETERMINALTYPE",3304561284:"IFCWINDOW",336235671:"IFCWINDOWLININGPROPERTIES",512836454:"IFCWINDOWPANELPROPERTIES",486154966:"IFCWINDOWSTANDARDCASE",1299126871:"IFCWINDOWSTYLE",4009809668:"IFCWINDOWTYPE",4088093105:"IFCWORKCALENDAR",1028945134:"IFCWORKCONTROL",4218914973:"IFCWORKPLAN",3342526732:"IFCWORKSCHEDULE",1236880293:"IFCWORKTIME",2543172580:"IFCZSHAPEPROFILEDEF",1033361043:"IFCZONE"},hN={aggregates:{name:160246688,relating:"RelatingObject",related:"RelatedObjects",key:"children"},spatial:{name:3242617779,relating:"RelatingStructure",related:"RelatedElements",key:"children"},psets:{name:4186316022,relating:"RelatingPropertyDefinition",related:"RelatedObjects",key:"hasPsets"},materials:{name:2655215786,relating:"RelatingMaterial",related:"RelatedObjects",key:"hasMaterial"},type:{name:781010003,relating:"RelatingType",related:"RelatedObjects",key:"hasType"}},lN=function(){function e(t){w(this,e),this.api=t}return I(e,[{key:"getIfcType",value:function(e){return uN[e]}},{key:"getItemProperties",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return JP(this,null,o().mark((function s(){return o().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.api.GetLine(e,t,i));case 1:case"end":return s.stop()}}),s,this)})))}},{key:"getPropertySets",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return JP(this,null,o().mark((function s(){return o().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.getProperty(e,t,i,hN.psets);case 2:return s.abrupt("return",s.sent);case 3:case"end":return s.stop()}}),s,this)})))}},{key:"getTypeProperties",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return JP(this,null,o().mark((function s(){return o().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.getProperty(e,t,i,hN.type);case 2:return s.abrupt("return",s.sent);case 3:case"end":return s.stop()}}),s,this)})))}},{key:"getMaterialsProperties",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return JP(this,null,o().mark((function s(){return o().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.getProperty(e,t,i,hN.materials);case 2:return s.abrupt("return",s.sent);case 3:case"end":return s.stop()}}),s,this)})))}},{key:"getSpatialStructure",value:function(t,i){return JP(this,null,o().mark((function s(){var r,n,a,u;return o().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.getAllTypesOfModel(t);case 2:return s.next=4,this.getSpatialTreeChunks(t);case 4:return r=s.sent,s.next=7,this.api.GetLineIDsWithType(t,103090709);case 7:return n=s.sent,a=n.get(0),u=e.newIfcProject(a),s.next=12,this.getSpatialNode(t,u,r,i);case 12:return this.cleanupTypes(),s.abrupt("return",u);case 14:case"end":return s.stop()}}),s,this)})))}},{key:"getAllItemsOfType",value:function(e,t,i){return JP(this,null,o().mark((function s(){var r,n,a,u,h;return o().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return r=[],s.next=3,this.api.GetLineIDsWithType(e,t);case 3:for(n=s.sent,a=0;a<n.size();a++)r.push(n.get(a));if(i){s.next=7;break}return s.abrupt("return",r);case 7:u=[],h=0;case 9:if(!(h<r.length)){s.next=18;break}return s.t0=u,s.next=13,this.api.GetLine(e,r[h]);case 13:s.t1=s.sent,s.t0.push.call(s.t0,s.t1);case 15:h++,s.next=9;break;case 18:return s.abrupt("return",u);case 19:case"end":return s.stop()}}),s,this)})))}},{key:"getProperty",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0;return JP(this,null,o().mark((function r(){var n,a,u;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.getAllRelatedItemsOfType(e,t,s);case 2:n=r.sent,a=[],u=0;case 5:if(!(u<n.length)){r.next=14;break}return r.t0=a,r.next=9,this.api.GetLine(e,n[u],i);case 9:r.t1=r.sent,r.t0.push.call(r.t0,r.t1);case 11:u++,r.next=5;break;case 14:return r.abrupt("return",a);case 15:case"end":return r.stop()}}),r,this)})))}},{key:"getChunks",value:function(e,t,i){return JP(this,null,o().mark((function s(){var r,n,a;return o().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.api.GetLineIDsWithType(e,i.name);case 2:r=s.sent,n=0;case 4:if(!(n<r.size())){s.next=12;break}return s.next=7,this.api.GetLine(e,r.get(n),!1);case 7:a=s.sent,this.saveChunk(t,i,a);case 9:n++,s.next=4;break;case 12:case"end":return s.stop()}}),s,this)})))}},{key:"getSpatialNode",value:function(e,t,i,s){return JP(this,null,o().mark((function r(){return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.getChildren(e,t,i,hN.aggregates,s);case 2:return r.next=4,this.getChildren(e,t,i,hN.spatial,s);case 4:case"end":return r.stop()}}),r,this)})))}},{key:"getChildren",value:function(e,t,i,s,r){return JP(this,null,o().mark((function n(){var a,u,h,l,c,p,d;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=(a=i[t.expressID])){n.next=3;break}return n.abrupt("return");case 3:u=s.key,h=[],l=0;case 6:if(!(l<a.length)){n.next=20;break}if(c=a[l],p=this.newNode(c),!r){n.next=14;break}return n.next=12,this.getItemProperties(e,p.expressID);case 12:d=n.sent,p=XP(XP({},d),p);case 14:return n.next=16,this.getSpatialNode(e,p,i,r);case 16:h.push(p);case 17:l++,n.next=6;break;case 20:t[u]=h;case 21:case"end":return n.stop()}}),n,this)})))}},{key:"newNode",value:function(e){return{expressID:e,type:this.getNodeType(e),children:[]}}},{key:"getNodeType",value:function(e){var t=this.types[e];return aN[t]}},{key:"getSpatialTreeChunks",value:function(e){return JP(this,null,o().mark((function t(){var i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i={},t.next=3,this.getChunks(e,i,hN.aggregates);case 3:return t.next=5,this.getChunks(e,i,hN.spatial);case 5:return t.abrupt("return",i);case 6:case"end":return t.stop()}}),t,this)})))}},{key:"saveChunk",value:function(e,t,i){var s=i[t.relating].value,r=i[t.related].map((function(e){return e.value}));null==e[s]?e[s]=r:e[s]=e[s].concat(r)}},{key:"getRelated",value:function(e,t,i){var s=e[t.relating];Array.isArray(s)?s.forEach((function(e){return i.push(e.value)})):i.push(s.value)}},{key:"getAllRelatedItemsOfType",value:function(t,i,s){return JP(this,null,o().mark((function r(){var n,a,u,h;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.api.GetLineIDsWithType(t,s.name);case 2:n=r.sent,a=[],u=0;case 5:if(!(u<n.size())){r.next=14;break}return r.next=8,this.api.GetLine(t,n.get(u));case 8:h=r.sent,e.isRelated(i,h,s)&&this.getRelated(h,s,a);case 11:u++,r.next=5;break;case 14:return r.abrupt("return",a);case 15:case"end":return r.stop()}}),r,this)})))}},{key:"cleanupTypes",value:function(){this.types={}}},{key:"getAllTypesOfModel",value:function(e){return JP(this,null,o().mark((function t(){var i,s,r,n,a,u,h;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i={},s=Object.keys(aN).map((function(e){return parseInt(e)})),r=0;case 3:if(!(r<s.length)){t.next=13;break}return n=s[r],t.next=7,this.api.GetLineIDsWithType(e,n);case 7:for(a=t.sent,u=a.size(),h=0;h<u;h++)i[a.get(h)]=n;case 10:r++,t.next=3;break;case 13:this.types=i;case 14:case"end":return t.stop()}}),t,this)})))}}],[{key:"isRelated",value:function(e,t,i){var s=t[i.related];return Array.isArray(s)?s.map((function(e){return e.value})).includes(e):s.value===e}},{key:"newIfcProject",value:function(e){return{expressID:e,type:"IFCPROJECT",children:[]}}}]),e}();jP="undefined"!=typeof self&&self.crossOriginIsolated?QP():qP();var cN=function(){function e(){w(this,e),this.wasmModule=void 0,this.fs=void 0,this.wasmPath="",this.isWasmPathAbsolute=!1,this.ifcGuidMap=new Map,this.properties=new lN(this)}return I(e,[{key:"Init",value:function(e){return JP(this,null,o().mark((function t(){var i,s=this;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!jP){t.next=8;break}return i=function(e,t){return e.endsWith(".wasm")?s.isWasmPathAbsolute?s.wasmPath+e:t+s.wasmPath+e:t+e},t.next=4,jP({noInitialRun:!0,locateFile:e||i});case 4:this.wasmModule=t.sent,this.fs=this.wasmModule.FS,t.next=9;break;case 8:console.error("Could not find wasm module at './web-ifc' from web-ifc-api.ts");case 9:case"end":return t.stop()}}),t,this)})))}},{key:"OpenModel",value:function(e,t){var i=this,s=XP({COORDINATE_TO_ORIGIN:!1,USE_FAST_BOOLS:!1,CIRCLE_SEGMENTS_LOW:5,CIRCLE_SEGMENTS_MEDIUM:8,CIRCLE_SEGMENTS_HIGH:12,BOOL_ABORT_THRESHOLD:1e4},t),r=0;return this.wasmModule.OpenModel(s,(function(t,s){var n=Math.min(e.byteLength-r,s),o=i.wasmModule.HEAPU8.subarray(t,t+s),a=e.subarray(r,r+n);return o.set(a),r+=n,n}))}},{key:"CreateModel",value:function(e){var t=XP({COORDINATE_TO_ORIGIN:!1,USE_FAST_BOOLS:!1,CIRCLE_SEGMENTS_LOW:5,CIRCLE_SEGMENTS_MEDIUM:8,CIRCLE_SEGMENTS_HIGH:12,BOOL_ABORT_THRESHOLD:1e4},e);return this.wasmModule.CreateModel(t)}},{key:"ExportFileAsIFC",value:function(e){this.wasmModule.ExportFileAsIFC(e);var t=this.fs.readFile("/export.ifc");return this.wasmModule.FS_unlink("/export.ifc"),t}},{key:"GetGeometry",value:function(e,t){return this.wasmModule.GetGeometry(e,t)}},{key:"GetLine",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=this.GetRawLineData(e,t),r=eT[s.type](s);return i&&this.FlattenLine(e,r),r}},{key:"GetAndClearErrors",value:function(e){return this.wasmModule.GetAndClearErrors(e)}},{key:"WriteLine",value:function(e,t){var i=this;Object.keys(t).forEach((function(s){var r=t[s];if(r&&void 0!==r.expressID)i.WriteLine(e,r),t[s]={type:5,value:r.expressID};else if(Array.isArray(r)&&r.length>0)for(var n=0;n<r.length;n++)void 0!==r[n].expressID&&(i.WriteLine(e,r[n]),t[s][n]={type:5,value:r[n].expressID})}));var s={ID:t.expressID,type:t.type,arguments:t.ToTape()};this.WriteRawLineData(e,s)}},{key:"FlattenLine",value:function(e,t){var i=this;Object.keys(t).forEach((function(s){var r=t[s];if(r&&5===r.type)t[s]=i.GetLine(e,r.value,!0);else if(Array.isArray(r)&&r.length>0&&5===r[0].type)for(var n=0;n<r.length;n++)t[s][n]=i.GetLine(e,r[n].value,!0)}))}},{key:"GetRawLineData",value:function(e,t){return this.wasmModule.GetLine(e,t)}},{key:"WriteRawLineData",value:function(e,t){return this.wasmModule.WriteLine(e,t.ID,t.type,t.arguments)}},{key:"GetLineIDsWithType",value:function(e,t){return this.wasmModule.GetLineIDsWithType(e,t)}},{key:"GetAllLines",value:function(e){return this.wasmModule.GetAllLines(e)}},{key:"SetGeometryTransformation",value:function(e,t){16==t.length?this.wasmModule.SetGeometryTransformation(e,t):console.log("Bad transformation matrix size: ".concat(t.length))}},{key:"GetCoordinationMatrix",value:function(e){return this.wasmModule.GetCoordinationMatrix(e)}},{key:"GetVertexArray",value:function(e,t){return this.getSubArray(this.wasmModule.HEAPF32,e,t)}},{key:"GetIndexArray",value:function(e,t){return this.getSubArray(this.wasmModule.HEAPU32,e,t)}},{key:"getSubArray",value:function(e,t,i){return e.subarray(t/4,t/4+i).slice(0)}},{key:"CloseModel",value:function(e){this.ifcGuidMap.delete(e),this.wasmModule.CloseModel(e)}},{key:"StreamAllMeshes",value:function(e,t){this.wasmModule.StreamAllMeshes(e,t)}},{key:"StreamAllMeshesWithTypes",value:function(e,t,i){this.wasmModule.StreamAllMeshesWithTypes(e,t,i)}},{key:"IsModelOpen",value:function(e){return this.wasmModule.IsModelOpen(e)}},{key:"LoadAllGeometry",value:function(e){return this.wasmModule.LoadAllGeometry(e)}},{key:"GetFlatMesh",value:function(e,t){return this.wasmModule.GetFlatMesh(e,t)}},{key:"CreateIfcGuidToExpressIdMapping",value:function(e){for(var t=new Map,i=0;i<$P.length;i++)for(var s=$P[i],r=this.GetLineIDsWithType(e,s),n=r.size(),o=0;o<n;o++){var a=r.get(o),u=this.GetLine(e,a).GlobalId.value;t.set(a,u),t.set(u,a)}this.ifcGuidMap.set(e,t)}},{key:"SetWasmPath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.wasmPath=e,this.isWasmPathAbsolute=t}}]),e}(),pN=function(){function e(){w(this,e)}return I(e,[{key:"getIFC",value:function(e,t,i){var s=function(){};t=t||s,i=i||s;var r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){var n=!!r[2],o=r[3];o=window.decodeURIComponent(o),n&&(o=window.atob(o));try{for(var a=new ArrayBuffer(o.length),u=new Uint8Array(a),h=0;h<o.length;h++)u[h]=o.charCodeAt(h);t(a)}catch(e){i(e)}}else{var l=new XMLHttpRequest;l.open("GET",e,!0),l.responseType="arraybuffer",l.onreadystatechange=function(){4===l.readyState&&(200===l.status?t(l.response):i("getXKT error : "+l.response))},l.send(null)}}}]),e}(),dN=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,"ifcLoader",e,r)).dataSource=r.dataSource,s.objectDefaults=r.objectDefaults,s.includeTypes=r.includeTypes,s.excludeTypes=r.excludeTypes,s.excludeUnclassifiedObjects=r.excludeUnclassifiedObjects,s._ifcAPI=new cN,r.wasmPath&&s._ifcAPI.SetWasmPath(r.wasmPath),s._ifcAPI.Init().then((function(){s.fire("initialized",!0,!1)})).catch((function(e){s.error(e)})),s}return I(i,[{key:"supportedVersions",get:function(){return["2x3","4"]}},{key:"dataSource",get:function(){return this._dataSource},set:function(e){this._dataSource=e||new pN}},{key:"objectDefaults",get:function(){return this._objectDefaults},set:function(e){this._objectDefaults=e||Gb}},{key:"includeTypes",get:function(){return this._includeTypes},set:function(e){this._includeTypes=e}},{key:"excludeTypes",get:function(){return this._excludeTypes},set:function(e){this._excludeTypes=e}},{key:"excludeUnclassifiedObjects",get:function(){return this._excludeUnclassifiedObjects},set:function(e){this._excludeUnclassifiedObjects=!!e}},{key:"globalizeObjectIds",get:function(){return this._globalizeObjectIds},set:function(e){this._globalizeObjectIds=!!e}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id);var i=new Op(this.viewer.scene,re.apply(t,{isModel:!0}));if(!t.src&&!t.ifc)return this.error("load() param expected: src or IFC"),i;var s={autoNormals:!0};if(!1!==t.loadMetadata){var r=t.includeTypes||this._includeTypes,n=t.excludeTypes||this._excludeTypes,o=t.objectDefaults||this._objectDefaults;if(r){s.includeTypesMap={};for(var a=0,u=r.length;a<u;a++)s.includeTypesMap[r[a]]=!0}if(n){s.excludeTypesMap={};for(var h=0,l=n.length;h<l;h++)s.excludeTypesMap[n[h]]=!0}o&&(s.objectDefaults=o),s.excludeUnclassifiedObjects=void 0!==t.excludeUnclassifiedObjects?!!t.excludeUnclassifiedObjects:this._excludeUnclassifiedObjects,s.globalizeObjectIds=void 0!==t.globalizeObjectIds?!!t.globalizeObjectIds:this._globalizeObjectIds}return this.on("initialized",(function(){t.src?e._loadModel(t.src,t,s,i):e._parseModel(t.ifc,t,s,i)})),i}},{key:"_loadModel",value:function(e,t,i,s){var r=this,n=this.viewer.scene.canvas.spinner;n.processes++,this._dataSource.getIFC(t.src,(function(e){r._parseModel(e,t,i,s),n.processes--}),(function(e){n.processes--,r.error(e),s.fire("error",e)}))}},{key:"_parseModel",value:function(e,t,i,s){if(!s.destroyed){var r=t.stats||{};r.sourceFormat="IFC",r.schemaVersion="",r.title="",r.author="",r.created="",r.numMetaObjects=0,r.numPropertySets=0,r.numObjects=0,r.numGeometries=0,r.numTriangles=0,r.numVertices=0,i.wasmPath&&this._ifcAPI.SetWasmPath(i.wasmPath);var n=new Uint8Array(e),o=this._ifcAPI.OpenModel(n),a=this._ifcAPI.GetLineIDsWithType(o,103090709).get(0),u=!1!==t.loadMetadata,h={modelID:o,sceneModel:s,loadMetadata:u,metadata:u?{id:"",projectId:""+a,author:"",createdAt:"",schema:"",creatingApplication:"",metaObjects:[],propertySets:[]}:null,metaObjects:{},options:i,log:function(e){},nextId:0,stats:r};if(u){if(i.includeTypes){h.includeTypes={};for(var l=0,c=i.includeTypes.length;l<c;l++)h.includeTypes[i.includeTypes[l]]=!0}if(i.excludeTypes){h.excludeTypes={};for(var p=0,d=i.excludeTypes.length;p<d;p++)h.excludeTypes[i.excludeTypes[p]]=!0}this._parseMetaObjects(h),this._parsePropertySets(h)}if(this._parseGeometry(h),s.finalize(),u){var f=s.id;this.viewer.metaScene.createMetaModel(f,h.metadata,i)}s.scene.once("tick",(function(){s.destroyed||(s.scene.fire("modelLoaded",s.id),s.fire("loaded",!0,!1))}))}}},{key:"_parseMetaObjects",value:function(e){var t=this._ifcAPI.GetLineIDsWithType(e.modelID,103090709).get(0),i=this._ifcAPI.GetLine(e.modelID,t);this._parseSpatialChildren(e,i)}},{key:"_parseSpatialChildren",value:function(e,t,i){var s=t.__proto__.constructor.name;if((!e.includeTypes||e.includeTypes[s])&&(!e.excludeTypes||!e.excludeTypes[s])){this._createMetaObject(e,t,i);var r=t.GlobalId.value;this._parseRelatedItemsOfType(e,t.expressID,"RelatingObject","RelatedObjects",160246688,r),this._parseRelatedItemsOfType(e,t.expressID,"RelatingStructure","RelatedElements",3242617779,r)}}},{key:"_createMetaObject",value:function(e,t,i){var s=t.GlobalId.value,r=t.__proto__.constructor.name,n={id:s,name:r,type:t.Name&&""!==t.Name.value?t.Name.value:r,parent:i};e.metadata.metaObjects.push(n),e.metaObjects[s]=n,e.stats.numMetaObjects++}},{key:"_parseRelatedItemsOfType",value:function(e,t,i,s,r,n){for(var o=this,a=this._ifcAPI.GetLineIDsWithType(e.modelID,r),u=0;u<a.size();u++){var h=a.get(u),l=this._ifcAPI.GetLine(e.modelID,h),c=l[i],p=!1;if(Array.isArray(c))p=c.map((function(e){return e.value})).includes(t);else p=c.value===t;if(p){var d=l[s];if(Array.isArray(d))d.forEach((function(t){var i=o._ifcAPI.GetLine(e.modelID,t.value);o._parseSpatialChildren(e,i,n)}));else{var f=this._ifcAPI.GetLine(e.modelID,d.value);this._parseSpatialChildren(e,f,n)}}}}},{key:"_parsePropertySets",value:function(e){for(var t=this._ifcAPI.GetLineIDsWithType(e.modelID,4186316022),i=0;i<t.size();i++){var s=t.get(i),r=this._ifcAPI.GetLine(e.modelID,s,!0);if(r){var n=r.RelatingPropertyDefinition;if(!n)continue;var o=n.GlobalId.value,a=n.HasProperties;if(a&&a.length>0){for(var u=n.Name.value,h=[],l=0,c=a.length;l<c;l++){var p=a[l],d=p.Name,f=p.NominalValue;if(d&&f){var m={name:d.value,type:f.type,value:f.value,valueType:f.valueType};p.Description?m.description=p.Description.value:f.description&&(m.description=f.description),h.push(m)}}var v={id:o,type:"Default",name:u,properties:h};e.metadata.propertySets.push(v),e.stats.numPropertySets++;var g=r.RelatedObjects;if(!g||0===g.length)return;for(var _=0,y=g.length;_<y;_++){var b=g[_].GlobalId.value,x=e.metaObjects[b];x&&(x.propertySetIds||(x.propertySetIds=[]),x.propertySetIds.push(o))}}}}}},{key:"_parseGeometry",value:function(e){var t=this;this._ifcAPI.StreamAllMeshes(e.modelID,(function(i){var s=i.expressID,r=i.geometries,n=[],o=t._ifcAPI.GetLine(e.modelID,s).GlobalId.value;if(e.loadMetadata){var a=o,u=e.metaObjects[a];if(e.includeTypes&&(!u||!e.includeTypes[u.type]))return;if(e.excludeTypes&&(!u||e.excludeTypes[u.type]))return}for(var h=q.mat4(),l=q.vec3(),c=0,p=r.size();c<p;c++){for(var d=r.get(c),f=t._ifcAPI.GetGeometry(e.modelID,d.geometryExpressID),m=t._ifcAPI.GetVertexArray(f.GetVertexData(),f.GetVertexDataSize()),v=t._ifcAPI.GetIndexArray(f.GetIndexData(),f.GetIndexDataSize()),g=new Float64Array(m.length/2),_=new Float32Array(m.length/2),y=0,b=0,x=m.length/6;y<x;y++,b+=3)g[b+0]=m[6*y+0],g[b+1]=m[6*y+1],g[b+2]=m[6*y+2];h.set(d.flatTransformation),q.transformPositions3(h,g);var P=ke(g,g,l);if(!e.options.autoNormals)for(var T=0,w=0,M=m.length/6;T<M;T++,w+=3)_[w+0]=m[6*T+3],_[w+1]=m[6*T+4],_[w+2]=m[6*T+5];e.stats.numGeometries++,e.stats.numVertices+=g.length/3,e.stats.numTriangles+=v.length/3;var I="mesh"+e.nextId++;e.sceneModel.createMesh({id:I,primitive:"triangles",origin:P?l:null,positions:g,normals:e.options.autoNormals?null:_,indices:v,color:[d.color.x,d.color.y,d.color.z],opacity:d.color.w}),n.push(I)}var C=e.options.globalizeObjectIds?q.globalizeObjectId(e.sceneModel.id,o):o;e.sceneModel.createEntity({id:C,meshIds:n,isObject:!0}),e.stats.numObjects++}))}}]),i}(),fN=function(){function e(){w(this,e)}return I(e,[{key:"getLAS",value:function(e,t,i){var s=function(){};t=t||s,i=i||s;var r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){var n=!!r[2],o=r[3];o=window.decodeURIComponent(o),n&&(o=window.atob(o));try{for(var a=new ArrayBuffer(o.length),u=new Uint8Array(a),h=0;h<o.length;h++)u[h]=o.charCodeAt(h);t(a)}catch(e){i(e)}}else{var l=new XMLHttpRequest;l.open("GET",e,!0),l.responseType="arraybuffer",l.onreadystatechange=function(){4===l.readyState&&(200===l.status?t(l.response):i("getXKT error : "+l.response))},l.send(null)}}}]),e}(),mN={name:"LAS",id:"las",module:"las",version:"3.2.6",worker:!0,extensions:["las","laz"],mimeTypes:["application/octet-stream"],text:!0,binary:!0,tests:["LAS"],options:{las:{shape:"mesh",fp64:!1,skip:1,colorDepth:8}}},vN=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,"lasLoader",e,r)).dataSource=r.dataSource,s.skip=r.skip,s.fp64=r.fp64,s.colorDepth=r.colorDepth,s}return I(i,[{key:"dataSource",get:function(){return this._dataSource},set:function(e){this._dataSource=e||new fN}},{key:"skip",get:function(){return this._skip},set:function(e){this._skip=e||1}},{key:"fp64",get:function(){return this._fp64},set:function(e){this._fp64=!!e}},{key:"colorDepth",get:function(){return this._colorDepth},set:function(e){this._colorDepth=e||"auto"}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id);var i=new Op(this.viewer.scene,re.apply(t,{isModel:!0}));if(!t.src&&!t.las)return this.error("load() param expected: src or las"),i;var s={las:{skip:this._skip,fp64:this._fp64,colorDepth:this._colorDepth}};if(t.src)this._loadModel(t.src,t,s,i);else{var r=this.viewer.scene.canvas.spinner;r.processes++,this._parseModel(t.las,t,s,i).then((function(){r.processes--}),(function(t){r.processes--,e.error(t),i.fire("error",t)}))}return i}},{key:"_loadModel",value:function(e,t,i,s){var r=this,n=this.viewer.scene.canvas.spinner;n.processes++,this._dataSource.getLAS(t.src,(function(e){r._parseModel(e,t,i,s).then((function(){n.processes--}),(function(e){n.processes--,r.error(e),s.fire("error",e)}))}),(function(e){n.processes--,r.error(e),s.fire("error",e)}))}},{key:"_parseModel",value:function(e,t,i,s){var r=this;function n(e){var i=e.value;if(t.rotateX&&i)for(var s=0,r=i.length;s<r;s+=3){var n=i[s+1];i[s+1]=i[s+2],i[s+2]=n}return i}function o(e,t){for(var i=e.value,s=e.size,r=t.value,n=4*r.length,o=new Uint8Array(n),a=0,u=0,h=0,l=r.length;a<l;a++,h+=s,u+=4)o[u+0]=i[h+0],o[u+1]=i[h+1],o[u+2]=i[h+2],o[u+3]=Math.round(r[a]/65536*255);return o}function a(e){for(var t=e.intensity,i=4*t.length,s=new Uint8Array(i),r=0,n=0,o=t.length;r<o;r++,n+=4)s[n+0]=0,s[n+1]=0,s[n+2]=0,s[n+3]=Math.round(t[r]/65536*255);return s}return new Promise((function(u,h){if(s.destroyed)h();else{var l=t.stats||{};l.sourceFormat="LAS",l.schemaVersion="",l.title="",l.author="",l.created="",l.numMetaObjects=0,l.numPropertySets=0,l.numObjects=0,l.numGeometries=0,l.numTriangles=0,l.numVertices=0;try{Lv(e,mN,i).then((function(e){var l,c,p=e.attributes,d=e.loaderData,f=void 0!==d.pointsFormatId?d.pointsFormatId:-1;if(!p.POSITION)return s.finalize(),void h("No positions found in file");switch(f){case 0:l=n(p.POSITION),c=a(p.intensity);break;case 1:if(!p.intensity)return s.finalize(),void h("No positions found in file");l=n(p.POSITION),c=a(p.intensity);break;case 2:case 3:if(!p.intensity)return s.finalize(),void h("No positions found in file");l=n(p.POSITION),c=o(p.COLOR_0,p.intensity)}s.createMesh({id:"pointsMesh",primitive:"points",positions:l,colorsCompressed:c});var m=q.createUUID();if(s.createEntity({id:m,meshIds:["pointsMesh"],isObject:!0}),s.finalize(),!1!==t.loadMetadata){var v=q.createUUID(),g={projectId:"",author:"",createdAt:"",schema:"",creatingApplication:"",metaObjects:[{id:v,name:"Model",type:"Model"},{id:m,name:"PointCloud (LAS)",type:"PointCloud",parent:v}],propertySets:[]},_=s.id;r.viewer.metaScene.createMetaModel(_,g,i)}s.scene.once("tick",(function(){s.destroyed||(s.scene.fire("modelLoaded",s.id),s.fire("loaded",!0,!1))})),u()}))}catch(e){s.finalize(),h(e)}}}))}}]),i}(),gN=function(){function e(){w(this,e)}return I(e,[{key:"getCityJSON",value:function(e,t,i){re.loadJSON(e,(function(e){t(e)}),(function(e){i(e)}))}}]),e}();function _N(e,t,i){i=i||2;var s,r,n,o,a,u,h,l=t&&t.length,c=l?t[0]*i:e.length,p=yN(e,0,c,i,!0),d=[];if(!p||p.next===p.prev)return d;if(l&&(p=function(e,t,i,s){var r,n,o,a=[];for(r=0,n=t.length;r<n;r++)(o=yN(e,t[r]*s,r<n-1?t[r+1]*s:e.length,s,!1))===o.next&&(o.steiner=!0),a.push(kN(o));for(a.sort(IN),r=0;r<a.length;r++)CN(a[r],i),i=bN(i,i.next);return i}(e,t,p,i)),e.length>80*i){s=n=e[0],r=o=e[1];for(var f=i;f<c;f+=i)(a=e[f])<s&&(s=a),(u=e[f+1])<r&&(r=u),a>n&&(n=a),u>o&&(o=u);h=0!==(h=Math.max(n-s,o-r))?1/h:0}return xN(p,d,i,s,r,h),d}function yN(e,t,i,s,r){var n,o;if(r===VN(e,t,i,s)>0)for(n=t;n<i;n+=s)o=GN(n,e[n],e[n+1],o);else for(n=i-s;n>=t;n-=s)o=GN(n,e[n],e[n+1],o);return o&&SN(o,o.next)&&(HN(o),o=o.next),o}function bN(e,t){if(!e)return e;t||(t=e);var i,s=e;do{if(i=!1,s.steiner||!SN(s,s.next)&&0!==RN(s.prev,s,s.next))s=s.next;else{if(HN(s),(s=t=s.prev)===s.next)break;i=!0}}while(i||s!==t);return t}function xN(e,t,i,s,r,n,o){if(e){!o&&n&&function(e,t,i,s){var r=e;do{null===r.z&&(r.z=AN(r.x,r.y,t,i,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,i,s,r,n,o,a,u,h=1;do{for(i=e,e=null,n=null,o=0;i;){for(o++,s=i,a=0,t=0;t<h&&(a++,s=s.nextZ);t++);for(u=h;a>0||u>0&&s;)0!==a&&(0===u||!s||i.z<=s.z)?(r=i,i=i.nextZ,a--):(r=s,s=s.nextZ,u--),n?n.nextZ=r:e=r,r.prevZ=n,n=r;i=s}n.nextZ=null,h*=2}while(o>1)}(r)}(e,s,r,n);for(var a,u,h=e;e.prev!==e.next;)if(a=e.prev,u=e.next,n?TN(e,s,r,n):PN(e))t.push(a.i/i),t.push(e.i/i),t.push(u.i/i),HN(e),e=u.next,h=u.next;else if((e=u)===h){o?1===o?xN(e=wN(bN(e),t,i),t,i,s,r,n,2):2===o&&MN(e,t,i,s,r,n):xN(bN(e),t,i,s,r,n,1);break}}}function PN(e){var t=e.prev,i=e,s=e.next;if(RN(t,i,s)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(EN(t.x,t.y,i.x,i.y,s.x,s.y,r.x,r.y)&&RN(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function TN(e,t,i,s){var r=e.prev,n=e,o=e.next;if(RN(r,n,o)>=0)return!1;for(var a=r.x<n.x?r.x<o.x?r.x:o.x:n.x<o.x?n.x:o.x,u=r.y<n.y?r.y<o.y?r.y:o.y:n.y<o.y?n.y:o.y,h=r.x>n.x?r.x>o.x?r.x:o.x:n.x>o.x?n.x:o.x,l=r.y>n.y?r.y>o.y?r.y:o.y:n.y>o.y?n.y:o.y,c=AN(a,u,t,i,s),p=AN(h,l,t,i,s),d=e.prevZ,f=e.nextZ;d&&d.z>=c&&f&&f.z<=p;){if(d!==e.prev&&d!==e.next&&EN(r.x,r.y,n.x,n.y,o.x,o.y,d.x,d.y)&&RN(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,f!==e.prev&&f!==e.next&&EN(r.x,r.y,n.x,n.y,o.x,o.y,f.x,f.y)&&RN(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;d&&d.z>=c;){if(d!==e.prev&&d!==e.next&&EN(r.x,r.y,n.x,n.y,o.x,o.y,d.x,d.y)&&RN(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;f&&f.z<=p;){if(f!==e.prev&&f!==e.next&&EN(r.x,r.y,n.x,n.y,o.x,o.y,f.x,f.y)&&RN(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function wN(e,t,i){var s=e;do{var r=s.prev,n=s.next.next;!SN(r,n)&&ON(r,s,s.next,n)&&NN(r,n)&&NN(n,r)&&(t.push(r.i/i),t.push(s.i/i),t.push(n.i/i),HN(s),HN(s.next),s=e=n),s=s.next}while(s!==e);return bN(s)}function MN(e,t,i,s,r,n){var o=e;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&FN(o,a)){var u=jN(o,a);return o=bN(o,o.next),u=bN(u,u.next),xN(o,t,i,s,r,n),void xN(u,t,i,s,r,n)}a=a.next}o=o.next}while(o!==e)}function IN(e,t){return e.x-t.x}function CN(e,t){if(t=function(e,t){var i,s=t,r=e.x,n=e.y,o=-1/0;do{if(n<=s.y&&n>=s.next.y&&s.next.y!==s.y){var a=s.x+(n-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(a<=r&&a>o){if(o=a,a===r){if(n===s.y)return s;if(n===s.next.y)return s.next}i=s.x<s.next.x?s:s.next}}s=s.next}while(s!==t);if(!i)return null;if(r===o)return i;var u,h=i,l=i.x,c=i.y,p=1/0;s=i;do{r>=s.x&&s.x>=l&&r!==s.x&&EN(n<c?r:o,n,l,c,n<c?o:r,n,s.x,s.y)&&(u=Math.abs(n-s.y)/(r-s.x),NN(s,e)&&(u<p||u===p&&(s.x>i.x||s.x===i.x&&DN(i,s)))&&(i=s,p=u)),s=s.next}while(s!==h);return i}(e,t),t){var i=jN(t,e);bN(t,t.next),bN(i,i.next)}}function DN(e,t){return RN(e.prev,e,t.prev)<0&&RN(t.next,e,e.next)<0}function AN(e,t,i,s,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function kN(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function EN(e,t,i,s,r,n,o,a){return(r-o)*(t-a)-(e-o)*(n-a)>=0&&(e-o)*(s-a)-(i-o)*(t-a)>=0&&(i-o)*(n-a)-(r-o)*(s-a)>=0}function FN(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&ON(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(NN(e,t)&&NN(t,e)&&function(e,t){var i=e,s=!1,r=(e.x+t.x)/2,n=(e.y+t.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==e);return s}(e,t)&&(RN(e.prev,e,t.prev)||RN(e,t.prev,t))||SN(e,t)&&RN(e.prev,e,e.next)>0&&RN(t.prev,t,t.next)>0)}function RN(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function SN(e,t){return e.x===t.x&&e.y===t.y}function ON(e,t,i,s){var r=LN(RN(e,t,i)),n=LN(RN(e,t,s)),o=LN(RN(i,s,e)),a=LN(RN(i,s,t));return r!==n&&o!==a||(!(0!==r||!BN(e,i,t))||(!(0!==n||!BN(e,s,t))||(!(0!==o||!BN(i,e,s))||!(0!==a||!BN(i,t,s)))))}function BN(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function LN(e){return e>0?1:e<0?-1:0}function NN(e,t){return RN(e.prev,e,e.next)<0?RN(e,t,e.next)>=0&&RN(e,e.prev,t)>=0:RN(e,t,e.prev)<0||RN(e,e.next,t)<0}function jN(e,t){var i=new UN(e.i,e.x,e.y),s=new UN(t.i,t.x,t.y),r=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}function GN(e,t,i,s){var r=new UN(e,t,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function HN(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function UN(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function VN(e,t,i,s){for(var r=0,n=t,o=i-s;n<i;n+=s)r+=(e[o]-e[n])*(e[n+1]+e[o+1]),o=n;return r}_N.deviation=function(e,t,i,s){var r=t&&t.length,n=r?t[0]*i:e.length,o=Math.abs(VN(e,0,n,i));if(r)for(var a=0,u=t.length;a<u;a++){var h=t[a]*i,l=a<u-1?t[a+1]*i:e.length;o-=Math.abs(VN(e,h,l,i))}var c=0;for(a=0;a<s.length;a+=3){var p=s[a]*i,d=s[a+1]*i,f=s[a+2]*i;c+=Math.abs((e[p]-e[f])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[f+1]-e[p+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},_N.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},s=0,r=0;r<e.length;r++){for(var n=0;n<e[r].length;n++)for(var o=0;o<t;o++)i.vertices.push(e[r][n][o]);r>0&&(s+=e[r-1].length,i.holes.push(s))}return i};var zN=q.vec2(),WN=q.vec3(),XN=q.vec3(),YN=q.vec3(),KN=function(e){g(i,X);var t=y(i);function i(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w(this,i),(s=t.call(this,"cityJSONLoader",e,r)).dataSource=r.dataSource,s}return I(i,[{key:"dataSource",get:function(){return this._dataSource},set:function(e){this._dataSource=e||new gN}},{key:"load",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);var t=new Op(this.viewer.scene,re.apply(e,{isModel:!0}));if(!e.src&&!e.cityJSON)return this.error("load() param expected: src or cityJSON"),t;var i={};if(e.src)this._loadModel(e.src,e,i,t);else{var s=this.viewer.scene.canvas.spinner;s.processes++,this._parseModel(e.cityJSON,e,i,t),s.processes--}return t}},{key:"_loadModel",value:function(e,t,i,s){var r=this,n=this.viewer.scene.canvas.spinner;n.processes++,this._dataSource.getCityJSON(t.src,(function(e){r._parseModel(e,t,i,s),n.processes--}),(function(e){n.processes--,r.error(e),s.fire("error",e)}))}},{key:"_parseModel",value:function(e,t,i,s){if(!s.destroyed){var r=e.transform?this._transformVertices(e.vertices,e.transform,i.rotateX):e.vertices,n=t.stats||{};n.sourceFormat=e.type||"CityJSON",n.schemaVersion=e.version||"",n.title="",n.author="",n.created="",n.numMetaObjects=0,n.numPropertySets=0,n.numObjects=0,n.numGeometries=0,n.numTriangles=0,n.numVertices=0;var o=!1!==t.loadMetadata,a=o?{id:q.createUUID(),name:"Model",type:"Model"}:null,u=o?{id:"",projectId:"",author:"",createdAt:"",schema:e.version||"",creatingApplication:"",metaObjects:[a],propertySets:[]}:null,h={data:e,vertices:r,sceneModel:s,loadMetadata:o,metadata:u,rootMetaObject:a,nextId:0,stats:n};if(this._parseCityJSON(h),s.finalize(),o){var l=s.id;this.viewer.metaScene.createMetaModel(l,h.metadata,i)}s.scene.once("tick",(function(){s.destroyed||(s.scene.fire("modelLoaded",s.id),s.fire("loaded",!0,!1))}))}}},{key:"_transformVertices",value:function(e,t,i){for(var s=[],r=t.scale||q.vec3([1,1,1]),n=t.translate||q.vec3([0,0,0]),o=0,a=0;o<e.length;o++,a+=3){var u=e[o][0]*r[0]+n[0],h=e[o][1]*r[1]+n[1],l=e[o][2]*r[2]+n[2];i?s.push([u,l,h]):s.push([u,h,l])}return s}},{key:"_parseCityJSON",value:function(e){var t=e.data.CityObjects;for(var i in t)if(t.hasOwnProperty(i)){var s=t[i];this._parseCityObject(e,s,i)}}},{key:"_parseCityObject",value:function(e,t,i){var s=e.sceneModel,r=e.data;if(e.loadMetadata){var n=i,o=t.type,a=o+" : "+i,u=t.parents?t.parents[0]:e.rootMetaObject.id;e.metadata.metaObjects.push({id:n,name:a,type:o,parent:u})}if(e.stats.numMetaObjects++,t.geometry&&t.geometry.length>0){for(var h=[],l=0,c=t.geometry.length;l<c;l++){var p=t.geometry[l],d=void 0,f=void 0,m=r.appearance;if(m){var v=m.materials;if(v){var g=p.material;if(g){var _=Object.keys(g);if(_.length>0){var y=g[_[0]];if(void 0!==y.value)d=v[y.value];else{var b=y.values;if(b){f=[];for(var x=0,P=b.length;x<P;x++){var T=v[b[l]];f.push(T)}}}}}}}f?this._parseGeometrySurfacesWithOwnMaterials(e,p,f,h):this._parseGeometrySurfacesWithSharedMaterial(e,p,d,h)}h.length>0&&(s.createEntity({id:i,meshIds:h,isObject:!0}),e.stats.numObjects++)}}},{key:"_parseGeometrySurfacesWithOwnMaterials",value:function(e,t,i,s){switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":var r=t.boundaries;this._parseSurfacesWithOwnMaterials(e,i,r,s);break;case"Solid":for(var n=t.boundaries,o=0;o<n.length;o++){var a=n[o];this._parseSurfacesWithOwnMaterials(e,i,a,s)}break;case"MultiSolid":case"CompositeSolid":for(var u=t.boundaries,h=0;h<u.length;h++)for(var l=0;l<u[h].length;l++){var c=u[h][l];this._parseSurfacesWithOwnMaterials(e,i,c,s)}}}},{key:"_parseSurfacesWithOwnMaterials",value:function(e,t,i,s){for(var n=e.vertices,o=e.sceneModel,a=0;a<i.length;a++){for(var u=i[a],h=t[a]||{diffuseColor:[.8,.8,.8],transparency:1},l=[],c=[],p=[],d={positions:[],indices:[]},f=0;f<u.length;f++){l.length>0&&c.push(l.length);var m=this._extractLocalIndices(e,u[f],p,d);l.push.apply(l,r(m))}if(3===l.length)d.indices.push(l[0]),d.indices.push(l[1]),d.indices.push(l[2]);else if(l.length>3){for(var v=[],g=0;g<l.length;g++)v.push({x:n[p[l[g]]][0],y:n[p[l[g]]][1],z:n[p[l[g]]][2]});for(var _=this._getNormalOfPositions(v,q.vec3()),y=[],b=0;b<v.length;b++)this._to2D(v[b],_,zN),y.unshift(zN[0]),y.unshift(zN[1]);for(var x=_N(y,c,2),P=0;P<x.length;P+=3)d.indices.unshift(l[x[P]]),d.indices.unshift(l[x[P+1]]),d.indices.unshift(l[x[P+2]])}var T=""+e.nextId++;o.createMesh({id:T,primitive:"triangles",positions:d.positions,indices:d.indices,color:h&&h.diffuseColor?h.diffuseColor:[.8,.8,.8],opacity:h&&void 0!==h.transparency?1-h.transparency:1}),s.push(T),e.stats.numGeometries++,e.stats.numVertices+=d.positions.length/3,e.stats.numTriangles+=d.indices.length/3}}},{key:"_parseGeometrySurfacesWithSharedMaterial",value:function(e,t,i,s){var r=e.sceneModel,n=[],o={positions:[],indices:[]};switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":var a=t.boundaries;this._parseSurfacesWithSharedMaterial(e,a,n,o);break;case"Solid":for(var u=t.boundaries,h=0;h<u.length;h++){var l=u[h];this._parseSurfacesWithSharedMaterial(e,l,n,o)}break;case"MultiSolid":case"CompositeSolid":for(var c=t.boundaries,p=0;p<c.length;p++)for(var d=0;d<c[p].length;d++){var f=c[p][d];this._parseSurfacesWithSharedMaterial(e,f,n,o)}}if(o.positions.length>0&&o.indices.length>0){var m=""+e.nextId++;r.createMesh({id:m,primitive:"triangles",positions:o.positions,indices:o.indices,color:i&&i.diffuseColor?i.diffuseColor:[.8,.8,.8],opacity:1}),s.push(m),e.stats.numGeometries++,e.stats.numVertices+=o.positions.length/3,e.stats.numTriangles+=o.indices.length/3}}},{key:"_parseSurfacesWithSharedMaterial",value:function(e,t,i,s){for(var n=e.vertices,o=0;o<t.length;o++){for(var a=[],u=[],h=0;h<t[o].length;h++){a.length>0&&u.push(a.length);var l=this._extractLocalIndices(e,t[o][h],i,s);a.push.apply(a,r(l))}if(3===a.length)s.indices.push(a[0]),s.indices.push(a[1]),s.indices.push(a[2]);else if(a.length>3){for(var c=[],p=0;p<a.length;p++)c.push({x:n[i[a[p]]][0],y:n[i[a[p]]][1],z:n[i[a[p]]][2]});for(var d=this._getNormalOfPositions(c,q.vec3()),f=[],m=0;m<c.length;m++)this._to2D(c[m],d,zN),f.unshift(zN[0]),f.unshift(zN[1]);for(var v=_N(f,u,2),g=0;g<v.length;g+=3)s.indices.unshift(a[v[g]]),s.indices.unshift(a[v[g+1]]),s.indices.unshift(a[v[g+2]])}}}},{key:"_extractLocalIndices",value:function(e,t,i,s){for(var r=e.vertices,n=[],o=0,a=t.length;o<a;o++){var u=t[o];if(i.includes(u)){var h=i.indexOf(u);n.push(h)}else s.positions.push(r[u][0]),s.positions.push(r[u][1]),s.positions.push(r[u][2]),n.push(i.length),i.push(u)}return n}},{key:"_getNormalOfPositions",value:function(e,t){for(var i=0;i<e.length;i++){var s=i+1;s===e.length&&(s=0),t[0]+=(e[i].y-e[s].y)*(e[i].z+e[s].z),t[1]+=(e[i].z-e[s].z)*(e[i].x+e[s].x),t[2]+=(e[i].x-e[s].x)*(e[i].y+e[s].y)}return q.normalizeVec3(t)}},{key:"_to2D",value:function(e,t,i){var s=WN,r=XN,n=YN;s[0]=e.x,s[1]=e.y,s[2]=e.z,r[0]=t.x,r[1]=t.y,r[2]=t.z,n[0]=1.1,n[1]=1.1,n[2]=1.1,q.lenVec3(q.subVec3(n,r))<.01&&(n[0]+=1,n[1]+=2,n[2]+=3);var o=q.dotVec3(n,r),a=q.mulVec3Scalar(r,o,q.vec3());n[0]-=a[0],n[1]-=a[1],n[2]-=a[2],q.normalizeVec3(n);var u=q.cross3Vec3(r,n,q.vec3()),h=q.dotVec3(s,n),l=q.dotVec3(s,u);i[0]=h,i[1]=l}}]),i}();export{un as AlphaFormat,fr as AmbientLight,Ve as AngleMeasurementsPlugin,Ke as AnnotationsPlugin,Ko as AxisGizmoPlugin,ja as BCFViewpointsPlugin,Ra as Bitmap,Qr as ByteType,Cu as CameraMemento,eu as CameraPath,au as CameraPathAnimation,KN as CityJSONLoaderPlugin,Nr as ClampToEdgeWrapping,fe as Component,Qn as CompressedMediaType,Ad as Configs,W as ContextMenu,Fu as CubicBezierCurve,Qa as Curve,ur as DataTextureSceneModel,bp as DefaultLoadingManager,dn as DepthFormat,fn as DepthStencilFormat,dr as DirLight,Fd as DistanceMeasurementsPlugin,Cr as EdgeMaterial,Mr as EmphasisMaterial,Rd as FastNavPlugin,sn as FloatType,Pa as Fresnel,wu as Frustum,Tu as FrustumPlane,Kn as GIFMediaType,Sd as GLTFDefaultDataSource,Hb as GLTFLoaderPlugin,rn as HalfFloatType,pu as ImagePlane,en as IntType,Jn as JPEGMediaType,Ip as KTX2TextureTranscoder,vN as LASLoaderPlugin,oa as LambertMaterial,_u as LightMap,Sa as LineSet,Xn as LinearEncoding,Wr as LinearFilter,Jr as LinearMipMapLinearFilter,Yr as LinearMipMapNearestFilter,Kr as LinearMipmapLinearFilter,Xr as LinearMipmapNearestFilter,xp as Loader,yp as LoadingManager,Ka as LocaleService,pn as LuminanceAlphaFormat,cn as LuminanceFormat,G as Map,Se as Marker,Uo as Mesh,ha as MetallicMaterial,jr as MirroredRepeatWrapping,Au as ModelMemento,Wb as NavCubePlugin,Gr as NearestFilter,zr as NearestMipMapLinearFilter,Hr as NearestMipMapNearestFilter,Vr as NearestMipmapLinearFilter,Ur as NearestMipmapNearestFilter,na as Node,tx as OBJLoaderPlugin,Eu as ObjectsMemento,Zn as PNGMediaType,Ru as Path,Bp as PerformanceModel,Tr as PhongMaterial,X as Plugin,du as PointLight,Su as QuadraticBezierCurve,$ as Queue,ln as RGBAFormat,yn as RGBAIntegerFormat,Un as RGBA_ASTC_10x10_Format,jn as RGBA_ASTC_10x5_Format,Gn as RGBA_ASTC_10x6_Format,Hn as RGBA_ASTC_10x8_Format,Vn as RGBA_ASTC_12x10_Format,zn as RGBA_ASTC_12x12_Format,En as RGBA_ASTC_4x4_Format,Fn as RGBA_ASTC_5x4_Format,Rn as RGBA_ASTC_5x5_Format,Sn as RGBA_ASTC_6x5_Format,On as RGBA_ASTC_6x6_Format,Bn as RGBA_ASTC_8x5_Format,Ln as RGBA_ASTC_8x6_Format,Nn as RGBA_ASTC_8x8_Format,Wn as RGBA_BPTC_Format,kn as RGBA_ETC2_EAC_Format,Cn as RGBA_PVRTC_2BPPV1_Format,In as RGBA_PVRTC_4BPPV1_Format,xn as RGBA_S3TC_DXT1_Format,Pn as RGBA_S3TC_DXT3_Format,Tn as RGBA_S3TC_DXT5_Format,hn as RGBFormat,Dn as RGB_ETC1_Format,An as RGB_ETC2_Format,Mn as RGB_PVRTC_2BPPV1_Format,wn as RGB_PVRTC_4BPPV1_Format,bn as RGB_S3TC_DXT1_Format,gn as RGFormat,_n as RGIntegerFormat,_r as ReadableGeometry,mn as RedFormat,vn as RedIntegerFormat,gu as ReflectionMap,Lr as RepeatWrapping,cx as STLDefaultDataSource,bx as STLLoaderPlugin,Ou as SceneModel,Jo as SectionPlane,hx as SectionPlanesPlugin,qr as ShortType,Lp as Skybox,lx as SkyboxesPlugin,pa as SpecularMaterial,qa as SplineCurve,yu as SpriteMarker,Cx as StoreyViewsPlugin,xa as Texture,Np as TextureTranscoder,Ax as TreeViewPlugin,Zr as UnsignedByteType,an as UnsignedInt248Type,tn as UnsignedIntType,nn as UnsignedShort4444Type,on as UnsignedShort5551Type,$r as UnsignedShortType,Ma as VBOGeometry,Op as VBOSceneModel,Sx as ViewCullPlugin,Dd as Viewer,dN as WebIFCLoaderPlugin,wp as WorkerPool,Ox as XKTDefaultDataSource,wP as XKTLoaderPlugin,GP as XML3DLoaderPlugin,yr as buildBoxGeometry,Aa as buildBoxLinesGeometry,zo as buildCylinderGeometry,ka as buildGridGeometry,Ea as buildPlaneGeometry,Wo as buildSphereGeometry,Fa as buildTorusGeometry,Yo as buildVectorTextGeometry,Iu as frustumIntersectsAABB3,Dp as getKTX2TextureTranscoder,Ca as load3DSGeometry,Da as loadOBJGeometry,q as math,Yn as sRGBEncoding,Mu as setFrustum,ee as stats,re as utils};
