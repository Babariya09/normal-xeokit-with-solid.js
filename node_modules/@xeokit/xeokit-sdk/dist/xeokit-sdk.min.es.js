class e{constructor(e,t){this.items=e||[],this._lastUniqueId=(t||0)+1}addItem(){let e;if(2===arguments.length){const t=arguments[0];if(e=arguments[1],this.items[t])throw"ID clash: '"+t+"'";return this.items[t]=e,t}for(e=arguments[0]||{};;){const t=this._lastUniqueId++;if(!this.items[t])return this.items[t]=e,t}}removeItem(e){const t=this.items[e];return delete this.items[e],t}}const t=new e;class s{constructor(e){this.id=e,this.parentItem=null,this.groups=[],this.menuElement=null,this.shown=!1,this.mouseOver=0}}class i{constructor(){this.items=[]}}class r{constructor(e,t,s,i,r){this.id=e,this.getTitle=t,this.doAction=s,this.getEnabled=i,this.getShown=r,this.itemElement=null,this.subMenu=null,this.enabled=!0}}class o{constructor(e={}){this._id=t.addItem(),this._context=null,this._enabled=!1,this._itemsCfg=[],this._rootMenu=null,this._menuList=[],this._menuMap={},this._itemList=[],this._itemMap={},this._shown=!1,this._nextId=0,this._eventSubs={},!1!==e.hideOnMouseDown&&(document.addEventListener("mousedown",(e=>{e.target.classList.contains("xeokit-context-menu-item")||this.hide()})),document.addEventListener("touchstart",this._canvasTouchStartHandler=e=>{e.target.classList.contains("xeokit-context-menu-item")||this.hide()})),e.items&&(this.items=e.items),this._hideOnAction=!1!==e.hideOnAction,this.context=e.context,this.enabled=!1!==e.enabled,this.hide()}on(e,t){let s=this._eventSubs[e];s||(s=[],this._eventSubs[e]=s),s.push(t)}fire(e,t){const s=this._eventSubs[e];if(s)for(let e=0,i=s.length;e<i;e++)s[e](t)}set items(e){this._clear(),this._itemsCfg=e||[],this._parseItems(e),this._createUI()}get items(){return this._itemsCfg}set enabled(e){(e=!!e)!==this._enabled&&(this._enabled=e,this._enabled||this.hide())}get enabled(){return this._enabled}set context(e){this._context=e}get context(){return this._context}show(e,t){this._context?this._enabled&&(this._shown||(this._hideAllMenus(),this._updateItemsTitles(),this._updateItemsEnabledStatus(),this._showMenu(this._rootMenu.id,e,t),this._shown=!0,this.fire("shown",{}))):console.error("ContextMenu cannot be shown without a context - set context first")}get shown(){return this._shown}hide(){this._enabled&&this._shown&&(this._hideAllMenus(),this._shown=!1,this.fire("hidden",{}))}destroy(){this._context=null,this._clear(),null!==this._id&&(t.removeItem(this._id),this._id=null)}_clear(){for(let e=0,t=this._menuList.length;e<t;e++){const t=this._menuList[e].menuElement;t.parentElement.removeChild(t)}this._itemsCfg=[],this._rootMenu=null,this._menuList=[],this._menuMap={},this._itemList=[],this._itemMap={}}_parseItems(e){const t=e=>{const o=this._getNextId(),n=new s(o);for(let s=0,o=e.length;s<o;s++){const o=e[s],a=new i;n.groups.push(a);for(let e=0,s=o.length;e<s;e++){const s=o[e],i=s.items,h=i&&i.length>0,l=this._getNextId(),u=s.getTitle||(()=>s.title||""),c=s.doAction||s.callback||(()=>{}),p=s.getEnabled||(()=>!0),d=s.getShown||(()=>!0),m=new r(l,u,c,p,d);if(m.parentMenu=n,a.items.push(m),h){const e=t(i);m.subMenu=e,e.parentItem=m}this._itemList.push(m),this._itemMap[m.id]=m}}return this._menuList.push(n),this._menuMap[n.id]=n,n};this._rootMenu=t(e)}_getNextId(){return"ContextMenu_"+this._id+"_"+this._nextId++}_createUI(){const e=t=>{this._createMenuUI(t);const s=t.groups;for(let t=0,i=s.length;t<i;t++){const i=s[t].items;for(let t=0,s=i.length;t<s;t++){const s=i[t].subMenu;s&&e(s)}}};e(this._rootMenu)}_createMenuUI(e){const t=e.groups,s=[];if(s.push('<div class="xeokit-context-menu '+e.id+'" style="z-index:300000; position: absolute;">'),s.push("<ul>"),t)for(let e=0,i=t.length;e<i;e++){const r=e,o=i,n=t[e].items;if(n)for(let e=0,t=n.length;e<t;e++){const i=n[e],a=i.subMenu,h=i.title||"";a?s.push('<li id="'+i.id+'" class="xeokit-context-menu-item" style="'+(r===o-1||e<t-1?"border-bottom: 0":"border-bottom: 1px solid black")+'">'+h+" [MORE]</li>"):s.push('<li id="'+i.id+'" class="xeokit-context-menu-item" style="'+(r===o-1||e<t-1?"border-bottom: 0":"border-bottom: 1px solid black")+'">'+h+"</li>")}}s.push("</ul>"),s.push("</div>");const i=s.join("");document.body.insertAdjacentHTML("beforeend",i);const r=document.querySelector("."+e.id);e.menuElement=r,r.style["border-radius"]="4px",r.style.display="none",r.style["z-index"]=3e5,r.style.background="white",r.style.border="1px solid black",r.style["box-shadow"]="0 4px 5px 0 gray",r.oncontextmenu=e=>{e.preventDefault()};const o=this;let n=null;if(t)for(let e=0,s=t.length;e<s;e++){const s=t[e].items;if(s)for(let e=0,t=s.length;e<t;e++){const t=s[e],i=t.subMenu;t.itemElement=document.getElementById(t.id),t.itemElement?(t.itemElement.addEventListener("mouseenter",(e=>{e.preventDefault();const s=t.subMenu;if(!s)return void(n&&(o._hideMenu(n.id),n=null));if(n&&n.id!==s.id&&(o._hideMenu(n.id),n=null),!1===t.enabled)return;const i=t.itemElement,r=s.menuElement,a=i.getBoundingClientRect();r.getBoundingClientRect();a.right+200>window.innerWidth?o._showMenu(s.id,a.left-200,a.top-1):o._showMenu(s.id,a.right-5,a.top-1),n=s})),i||(t.itemElement.addEventListener("click",(e=>{e.preventDefault(),o._context&&!1!==t.enabled&&(t.doAction&&t.doAction(o._context),this._hideOnAction?o.hide():(o._updateItemsTitles(),o._updateItemsEnabledStatus()))})),t.itemElement.addEventListener("mouseenter",(e=>{e.preventDefault(),!1!==t.enabled&&t.doHover&&t.doHover(o._context)})))):console.error("ContextMenu item element not found: "+t.id)}}}_updateItemsTitles(){if(this._context)for(let e=0,t=this._itemList.length;e<t;e++){const t=this._itemList[e],s=t.itemElement;if(!s)continue;const i=t.getShown;if(!i||!i(this._context))continue;const r=t.getTitle(this._context);t.subMenu,s.innerText=r}}_updateItemsEnabledStatus(){if(this._context)for(let e=0,t=this._itemList.length;e<t;e++){const t=this._itemList[e],s=t.itemElement;if(!s)continue;const i=t.getEnabled;if(!i)continue;const r=t.getShown;if(!r)continue;const o=r(this._context);if(t.shown=o,!o){s.style.visibility="hidden",s.style.height="0",s.style.padding="0";continue}s.style.visibility="visible",s.style.height="auto",s.style.padding=null;const n=i(this._context);t.enabled=n,n?s.classList.remove("disabled"):s.classList.add("disabled")}}_showMenu(e,t,s){const i=this._menuMap[e];if(!i)return void console.error("Menu not found: "+e);if(i.shown)return;const r=i.menuElement;r&&(this._showMenuElement(r,t,s),i.shown=!0)}_hideMenu(e){const t=this._menuMap[e];if(!t)return void console.error("Menu not found: "+e);if(!t.shown)return;const s=t.menuElement;s&&(this._hideMenuElement(s),t.shown=!1)}_hideAllMenus(){for(let e=0,t=this._menuList.length;e<t;e++){const t=this._menuList[e];this._hideMenu(t.id)}}_showMenuElement(e,t,s){e.style.display="block";const i=e.offsetHeight,r=e.offsetWidth;s+i>window.innerHeight&&(s=window.innerHeight-i),t+r>window.innerWidth&&(t=window.innerWidth-r),e.style.left=t+"px",e.style.top=s+"px"}_hideMenuElement(e){e.style.display="none"}}class n{constructor(e,t,s){this.id=s&&s.id?s.id:e,this.viewer=t,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._eventSubsNum=null,this._events=null,this._eventCallDepth=0,t.addPlugin(this)}fire(e,t,s){this._events||(this._events={}),this._eventSubs||(this._eventSubs={},this._eventSubsNum={}),!0!==s&&(this._events[e]=t||!0);const i=this._eventSubs[e];let r;if(i)for(const s in i)i.hasOwnProperty(s)&&(r=i[s],this._eventCallDepth++,this._eventCallDepth<300?r.callback.call(r.scope,t):this.error("fire: potential stack overflow from recursive event '"+e+"' - dropping this event"),this._eventCallDepth--)}on(t,s,i){this._events||(this._events={}),this._subIdMap||(this._subIdMap=new e),this._subIdEvents||(this._subIdEvents={}),this._eventSubs||(this._eventSubs={}),this._eventSubsNum||(this._eventSubsNum={});let r=this._eventSubs[t];r?this._eventSubsNum[t]++:(r={},this._eventSubs[t]=r,this._eventSubsNum[t]=1);const o=this._subIdMap.addItem();r[o]={callback:s,scope:i||this},this._subIdEvents[o]=t;const n=this._events[t];return void 0!==n&&s.call(i||this,n),o}off(e){if(null==e)return;if(!this._subIdEvents)return;const t=this._subIdEvents[e];if(t){delete this._subIdEvents[e];const s=this._eventSubs[t];s&&(delete s[e],this._eventSubsNum[t]--),this._subIdMap.removeItem(e)}}once(e,t,s){const i=this,r=this.on(e,(function(e){i.off(r),t.call(s||this,e)}),s)}hasSubs(e){return this._eventSubsNum&&this._eventSubsNum[e]>0}log(e){console.log(`[xeokit plugin ${this.id}]: ${e}`)}warn(e){console.warn(`[xeokit plugin ${this.id}]: ${e}`)}error(e){console.error(`[xeokit plugin ${this.id}]: ${e}`)}send(e,t){}destroy(){this.viewer.removePlugin(this)}}let a=!0,h=a?Float64Array:Float32Array;const l=new h(16),u=new h(16),c=new h(4),p={setDoublePrecisionEnabled(e){a=e,h=a?Float64Array:Float32Array},getDoublePrecisionEnabled:()=>a,MIN_DOUBLE:-Number.MAX_SAFE_INTEGER,MAX_DOUBLE:Number.MAX_SAFE_INTEGER,DEGTORAD:.0174532925,RADTODEG:57.295779513,unglobalizeObjectId(e,t){const s=t.indexOf("#");return s===e.length&&t.startsWith(e)?t.substring(s+1):t},globalizeObjectId:(e,t)=>e+"#"+t,vec2:e=>new h(e||2),vec3:e=>new h(e||3),vec4:e=>new h(e||4),mat3:e=>new h(e||9),mat3ToMat4:(e,t=new h(16))=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t),mat4:e=>new h(e||16),mat4ToMat3(e,t){},doublesToFloats(e,t,s){const i=new h(2);for(let r=0,o=e.length;r<o;r++)p.splitDouble(e[r],i),t[r]=i[0],s[r]=i[1]},splitDouble(e,t){const s=h.from([e])[0],i=e-s;t[0]=s,t[1]=i},createUUID:(()=>{const e=[];for(let t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return()=>{const t=4294967295*Math.random()|0,s=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return`${e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]}-${e[255&s]}${e[s>>8&255]}-${e[s>>16&15|64]}${e[s>>24&255]}-${e[63&i|128]}${e[i>>8&255]}-${e[i>>16&255]}${e[i>>24&255]}${e[255&r]}${e[r>>8&255]}${e[r>>16&255]}${e[r>>24&255]}`}})(),clamp:(e,t,s)=>Math.max(t,Math.min(s,e)),fmod(e,t){if(e<t)return console.error("math.fmod : Attempting to find modulus within negative range - would be infinite loop - ignoring"),e;for(;t<=e;)e-=t;return e},compareVec3:(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2],negateVec3:(e,t)=>(t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t),negateVec4:(e,t)=>(t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t),addVec4:(e,t,s)=>(s||(s=e),s[0]=e[0]+t[0],s[1]=e[1]+t[1],s[2]=e[2]+t[2],s[3]=e[3]+t[3],s),addVec4Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]+t,s[1]=e[1]+t,s[2]=e[2]+t,s[3]=e[3]+t,s),addVec3:(e,t,s)=>(s||(s=e),s[0]=e[0]+t[0],s[1]=e[1]+t[1],s[2]=e[2]+t[2],s),addVec3Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]+t,s[1]=e[1]+t,s[2]=e[2]+t,s),subVec4:(e,t,s)=>(s||(s=e),s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],s[3]=e[3]-t[3],s),subVec3:(e,t,s)=>(s||(s=e),s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],s),subVec2:(e,t,s)=>(s||(s=e),s[0]=e[0]-t[0],s[1]=e[1]-t[1],s),geometricMeanVec2(...e){const t=new h(e[0]);for(let s=1;s<e.length;s++)t[0]+=e[s][0],t[1]+=e[s][1];return t[0]/=e.length,t[1]/=e.length,t},subVec4Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]-t,s[1]=e[1]-t,s[2]=e[2]-t,s[3]=e[3]-t,s),subScalarVec4:(e,t,s)=>(s||(s=e),s[0]=t-e[0],s[1]=t-e[1],s[2]=t-e[2],s[3]=t-e[3],s),mulVec4:(e,t,s)=>(s||(s=e),s[0]=e[0]*t[0],s[1]=e[1]*t[1],s[2]=e[2]*t[2],s[3]=e[3]*t[3],s),mulVec4Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]*t,s[1]=e[1]*t,s[2]=e[2]*t,s[3]=e[3]*t,s),mulVec3Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]*t,s[1]=e[1]*t,s[2]=e[2]*t,s),mulVec2Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]*t,s[1]=e[1]*t,s),divVec3:(e,t,s)=>(s||(s=e),s[0]=e[0]/t[0],s[1]=e[1]/t[1],s[2]=e[2]/t[2],s),divVec4:(e,t,s)=>(s||(s=e),s[0]=e[0]/t[0],s[1]=e[1]/t[1],s[2]=e[2]/t[2],s[3]=e[3]/t[3],s),divScalarVec3:(e,t,s)=>(s||(s=t),s[0]=e/t[0],s[1]=e/t[1],s[2]=e/t[2],s),divVec3Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]/t,s[1]=e[1]/t,s[2]=e[2]/t,s),divVec4Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]/t,s[1]=e[1]/t,s[2]=e[2]/t,s[3]=e[3]/t,s),divScalarVec4:(e,t,s)=>(s||(s=t),s[0]=e/t[0],s[1]=e/t[1],s[2]=e/t[2],s[3]=e/t[3],s),dotVec4:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],cross3Vec4(e,t){const s=e[0],i=e[1],r=e[2],o=t[0],n=t[1],a=t[2];return[i*a-r*n,r*o-s*a,s*n-i*o,0]},cross3Vec3(e,t,s){s||(s=e);const i=e[0],r=e[1],o=e[2],n=t[0],a=t[1],h=t[2];return s[0]=r*h-o*a,s[1]=o*n-i*h,s[2]=i*a-r*n,s},sqLenVec4:e=>p.dotVec4(e,e),lenVec4:e=>Math.sqrt(p.sqLenVec4(e)),dotVec3:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2],dotVec2:(e,t)=>e[0]*t[0]+e[1]*t[1],sqLenVec3:e=>p.dotVec3(e,e),sqLenVec2:e=>p.dotVec2(e,e),lenVec3:e=>Math.sqrt(p.sqLenVec3(e)),distVec3:(()=>{const e=new h(3);return(t,s)=>p.lenVec3(p.subVec3(t,s,e))})(),lenVec2:e=>Math.sqrt(p.sqLenVec2(e)),distVec2:(()=>{const e=new h(2);return(t,s)=>p.lenVec2(p.subVec2(t,s,e))})(),rcpVec3:(e,t)=>p.divScalarVec3(1,e,t),normalizeVec4(e,t){const s=1/p.lenVec4(e);return p.mulVec4Scalar(e,s,t)},normalizeVec3(e,t){const s=1/p.lenVec3(e);return p.mulVec3Scalar(e,s,t)},normalizeVec2(e,t){const s=1/p.lenVec2(e);return p.mulVec2Scalar(e,s,t)},angleVec3(e,t){let s=p.dotVec3(e,t)/Math.sqrt(p.sqLenVec3(e)*p.sqLenVec3(t));return s=s<-1?-1:s>1?1:s,Math.acos(s)},vec3FromMat4Scale:(()=>{const e=new h(3);return(t,s)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],s[0]=p.lenVec3(e),e[0]=t[4],e[1]=t[5],e[2]=t[6],s[1]=p.lenVec3(e),e[0]=t[8],e[1]=t[9],e[2]=t[10],s[2]=p.lenVec3(e),s)})(),vecToArray:(()=>{function e(e){return Math.round(1e5*e)/1e5}return t=>{for(let s=0,i=(t=Array.prototype.slice.call(t)).length;s<i;s++)t[s]=e(t[s]);return t}})(),xyzArrayToObject:e=>({x:e[0],y:e[1],z:e[2]}),xyzObjectToArray:(e,t)=>((t=t||p.vec3())[0]=e.x,t[1]=e.y,t[2]=e.z,t),dupMat4:e=>e.slice(0,16),mat4To3:e=>[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]],m4s:e=>[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],setMat4ToZeroes:()=>p.m4s(0),setMat4ToOnes:()=>p.m4s(1),diagonalMat4v:e=>new h([e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,e[3]]),diagonalMat4c:(e,t,s,i)=>p.diagonalMat4v([e,t,s,i]),diagonalMat4s:e=>p.diagonalMat4c(e,e,e,e),identityMat4:(e=new h(16))=>(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e),identityMat3:(e=new h(9))=>(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e),isIdentityMat4:e=>1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15],negateMat4:(e,t)=>(t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t),addMat4:(e,t,s)=>(s||(s=e),s[0]=e[0]+t[0],s[1]=e[1]+t[1],s[2]=e[2]+t[2],s[3]=e[3]+t[3],s[4]=e[4]+t[4],s[5]=e[5]+t[5],s[6]=e[6]+t[6],s[7]=e[7]+t[7],s[8]=e[8]+t[8],s[9]=e[9]+t[9],s[10]=e[10]+t[10],s[11]=e[11]+t[11],s[12]=e[12]+t[12],s[13]=e[13]+t[13],s[14]=e[14]+t[14],s[15]=e[15]+t[15],s),addMat4Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]+t,s[1]=e[1]+t,s[2]=e[2]+t,s[3]=e[3]+t,s[4]=e[4]+t,s[5]=e[5]+t,s[6]=e[6]+t,s[7]=e[7]+t,s[8]=e[8]+t,s[9]=e[9]+t,s[10]=e[10]+t,s[11]=e[11]+t,s[12]=e[12]+t,s[13]=e[13]+t,s[14]=e[14]+t,s[15]=e[15]+t,s),addScalarMat4:(e,t,s)=>p.addMat4Scalar(t,e,s),subMat4:(e,t,s)=>(s||(s=e),s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],s[3]=e[3]-t[3],s[4]=e[4]-t[4],s[5]=e[5]-t[5],s[6]=e[6]-t[6],s[7]=e[7]-t[7],s[8]=e[8]-t[8],s[9]=e[9]-t[9],s[10]=e[10]-t[10],s[11]=e[11]-t[11],s[12]=e[12]-t[12],s[13]=e[13]-t[13],s[14]=e[14]-t[14],s[15]=e[15]-t[15],s),subMat4Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]-t,s[1]=e[1]-t,s[2]=e[2]-t,s[3]=e[3]-t,s[4]=e[4]-t,s[5]=e[5]-t,s[6]=e[6]-t,s[7]=e[7]-t,s[8]=e[8]-t,s[9]=e[9]-t,s[10]=e[10]-t,s[11]=e[11]-t,s[12]=e[12]-t,s[13]=e[13]-t,s[14]=e[14]-t,s[15]=e[15]-t,s),subScalarMat4:(e,t,s)=>(s||(s=t),s[0]=e-t[0],s[1]=e-t[1],s[2]=e-t[2],s[3]=e-t[3],s[4]=e-t[4],s[5]=e-t[5],s[6]=e-t[6],s[7]=e-t[7],s[8]=e-t[8],s[9]=e-t[9],s[10]=e-t[10],s[11]=e-t[11],s[12]=e-t[12],s[13]=e-t[13],s[14]=e-t[14],s[15]=e-t[15],s),mulMat4(e,t,s){s||(s=e);const i=e[0],r=e[1],o=e[2],n=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],p=e[9],d=e[10],m=e[11],f=e[12],g=e[13],_=e[14],y=e[15],v=t[0],b=t[1],x=t[2],P=t[3],T=t[4],w=t[5],M=t[6],I=t[7],C=t[8],D=t[9],A=t[10],E=t[11],F=t[12],R=t[13],S=t[14],O=t[15];return s[0]=v*i+b*a+x*c+P*f,s[1]=v*r+b*h+x*p+P*g,s[2]=v*o+b*l+x*d+P*_,s[3]=v*n+b*u+x*m+P*y,s[4]=T*i+w*a+M*c+I*f,s[5]=T*r+w*h+M*p+I*g,s[6]=T*o+w*l+M*d+I*_,s[7]=T*n+w*u+M*m+I*y,s[8]=C*i+D*a+A*c+E*f,s[9]=C*r+D*h+A*p+E*g,s[10]=C*o+D*l+A*d+E*_,s[11]=C*n+D*u+A*m+E*y,s[12]=F*i+R*a+S*c+O*f,s[13]=F*r+R*h+S*p+O*g,s[14]=F*o+R*l+S*d+O*_,s[15]=F*n+R*u+S*m+O*y,s},mulMat3(e,t,s){s||(s=new h(9));const i=e[0],r=e[3],o=e[6],n=e[1],a=e[4],l=e[7],u=e[2],c=e[5],p=e[8],d=t[0],m=t[3],f=t[6],g=t[1],_=t[4],y=t[7],v=t[2],b=t[5],x=t[8];return s[0]=i*d+r*g+o*v,s[3]=i*m+r*_+o*b,s[6]=i*f+r*y+o*x,s[1]=n*d+a*g+l*v,s[4]=n*m+a*_+l*b,s[7]=n*f+a*y+l*x,s[2]=u*d+c*g+p*v,s[5]=u*m+c*_+p*b,s[8]=u*f+c*y+p*x,s},mulMat4Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]*t,s[1]=e[1]*t,s[2]=e[2]*t,s[3]=e[3]*t,s[4]=e[4]*t,s[5]=e[5]*t,s[6]=e[6]*t,s[7]=e[7]*t,s[8]=e[8]*t,s[9]=e[9]*t,s[10]=e[10]*t,s[11]=e[11]*t,s[12]=e[12]*t,s[13]=e[13]*t,s[14]=e[14]*t,s[15]=e[15]*t,s),mulMat4v4(e,t,s=p.vec4()){const i=t[0],r=t[1],o=t[2],n=t[3];return s[0]=e[0]*i+e[4]*r+e[8]*o+e[12]*n,s[1]=e[1]*i+e[5]*r+e[9]*o+e[13]*n,s[2]=e[2]*i+e[6]*r+e[10]*o+e[14]*n,s[3]=e[3]*i+e[7]*r+e[11]*o+e[15]*n,s},transposeMat4(e,t){const s=e[4],i=e[14],r=e[8],o=e[13],n=e[12],a=e[9];if(!t||e===t){const t=e[1],h=e[2],l=e[3],u=e[6],c=e[7],p=e[11];return e[1]=s,e[2]=r,e[3]=n,e[4]=t,e[6]=a,e[7]=o,e[8]=h,e[9]=u,e[11]=i,e[12]=l,e[13]=c,e[14]=p,e}return t[0]=e[0],t[1]=s,t[2]=r,t[3]=n,t[4]=e[1],t[5]=e[5],t[6]=a,t[7]=o,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=i,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},transposeMat3(e,t){if(t===e){const s=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=s,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},determinantMat4(e){const t=e[0],s=e[1],i=e[2],r=e[3],o=e[4],n=e[5],a=e[6],h=e[7],l=e[8],u=e[9],c=e[10],p=e[11],d=e[12],m=e[13],f=e[14],g=e[15];return d*u*a*r-l*m*a*r-d*n*c*r+o*m*c*r+l*n*f*r-o*u*f*r-d*u*i*h+l*m*i*h+d*s*c*h-t*m*c*h-l*s*f*h+t*u*f*h+d*n*i*p-o*m*i*p-d*s*a*p+t*m*a*p+o*s*f*p-t*n*f*p-l*n*i*g+o*u*i*g+l*s*a*g-t*u*a*g-o*s*c*g+t*n*c*g},inverseMat4(e,t){t||(t=e);const s=e[0],i=e[1],r=e[2],o=e[3],n=e[4],a=e[5],h=e[6],l=e[7],u=e[8],c=e[9],p=e[10],d=e[11],m=e[12],f=e[13],g=e[14],_=e[15],y=s*a-i*n,v=s*h-r*n,b=s*l-o*n,x=i*h-r*a,P=i*l-o*a,T=r*l-o*h,w=u*f-c*m,M=u*g-p*m,I=u*_-d*m,C=c*g-p*f,D=c*_-d*f,A=p*_-d*g,E=1/(y*A-v*D+b*C+x*I-P*M+T*w);return t[0]=(a*A-h*D+l*C)*E,t[1]=(-i*A+r*D-o*C)*E,t[2]=(f*T-g*P+_*x)*E,t[3]=(-c*T+p*P-d*x)*E,t[4]=(-n*A+h*I-l*M)*E,t[5]=(s*A-r*I+o*M)*E,t[6]=(-m*T+g*b-_*v)*E,t[7]=(u*T-p*b+d*v)*E,t[8]=(n*D-a*I+l*w)*E,t[9]=(-s*D+i*I-o*w)*E,t[10]=(m*P-f*b+_*y)*E,t[11]=(-u*P+c*b-d*y)*E,t[12]=(-n*C+a*M-h*w)*E,t[13]=(s*C-i*M+r*w)*E,t[14]=(-m*x+f*v-g*y)*E,t[15]=(u*x-c*v+p*y)*E,t},traceMat4:e=>e[0]+e[5]+e[10]+e[15],translationMat4v(e,t){const s=t||p.identityMat4();return s[12]=e[0],s[13]=e[1],s[14]=e[2],s},translationMat3v(e,t){const s=t||p.identityMat3();return s[6]=e[0],s[7]=e[1],s},translationMat4c:(()=>{const e=new h(3);return(t,s,i,r)=>(e[0]=t,e[1]=s,e[2]=i,p.translationMat4v(e,r))})(),translationMat4s:(e,t)=>p.translationMat4c(e,e,e,t),translateMat4v:(e,t)=>p.translateMat4c(e[0],e[1],e[2],t),translateMat4c(e,t,s,i){const r=i[3];i[0]+=r*e,i[1]+=r*t,i[2]+=r*s;const o=i[7];i[4]+=o*e,i[5]+=o*t,i[6]+=o*s;const n=i[11];i[8]+=n*e,i[9]+=n*t,i[10]+=n*s;const a=i[15];return i[12]+=a*e,i[13]+=a*t,i[14]+=a*s,i},setMat4Translation:(e,t,s)=>(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=t[0],s[13]=t[1],s[14]=t[2],s[15]=e[15],s),rotationMat4v(e,t,s){const i=p.normalizeVec4([t[0],t[1],t[2],0],[]),r=Math.sin(e),o=Math.cos(e),n=1-o,a=i[0],h=i[1],l=i[2];let u,c,d,m,f,g;return u=a*h,c=h*l,d=l*a,m=a*r,f=h*r,g=l*r,(s=s||p.mat4())[0]=n*a*a+o,s[1]=n*u+g,s[2]=n*d-f,s[3]=0,s[4]=n*u-g,s[5]=n*h*h+o,s[6]=n*c+m,s[7]=0,s[8]=n*d+f,s[9]=n*c-m,s[10]=n*l*l+o,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},rotationMat4c:(e,t,s,i,r)=>p.rotationMat4v(e,[t,s,i],r),scalingMat4v:(e,t=p.identityMat4())=>(t[0]=e[0],t[5]=e[1],t[10]=e[2],t),scalingMat3v:(e,t=p.identityMat3())=>(t[0]=e[0],t[4]=e[1],t),scalingMat4c:(()=>{const e=new h(3);return(t,s,i,r)=>(e[0]=t,e[1]=s,e[2]=i,p.scalingMat4v(e,r))})(),scaleMat4c:(e,t,s,i)=>(i[0]*=e,i[4]*=t,i[8]*=s,i[1]*=e,i[5]*=t,i[9]*=s,i[2]*=e,i[6]*=t,i[10]*=s,i[3]*=e,i[7]*=t,i[11]*=s,i),scaleMat4v(e,t){const s=e[0],i=e[1],r=e[2];return t[0]*=s,t[4]*=i,t[8]*=r,t[1]*=s,t[5]*=i,t[9]*=r,t[2]*=s,t[6]*=i,t[10]*=r,t[3]*=s,t[7]*=i,t[11]*=r,t},scalingMat4s:e=>p.scalingMat4c(e,e,e),rotationTranslationMat4(e,t,s=p.mat4()){const i=e[0],r=e[1],o=e[2],n=e[3],a=i+i,h=r+r,l=o+o,u=i*a,c=i*h,d=i*l,m=r*h,f=r*l,g=o*l,_=n*a,y=n*h,v=n*l;return s[0]=1-(m+g),s[1]=c+v,s[2]=d-y,s[3]=0,s[4]=c-v,s[5]=1-(u+g),s[6]=f+_,s[7]=0,s[8]=d+y,s[9]=f-_,s[10]=1-(u+m),s[11]=0,s[12]=t[0],s[13]=t[1],s[14]=t[2],s[15]=1,s},mat4ToEuler(e,t,s=p.vec4()){const i=p.clamp,r=e[0],o=e[4],n=e[8],a=e[1],h=e[5],l=e[9],u=e[2],c=e[6],d=e[10];return"XYZ"===t?(s[1]=Math.asin(i(n,-1,1)),Math.abs(n)<.99999?(s[0]=Math.atan2(-l,d),s[2]=Math.atan2(-o,r)):(s[0]=Math.atan2(c,h),s[2]=0)):"YXZ"===t?(s[0]=Math.asin(-i(l,-1,1)),Math.abs(l)<.99999?(s[1]=Math.atan2(n,d),s[2]=Math.atan2(a,h)):(s[1]=Math.atan2(-u,r),s[2]=0)):"ZXY"===t?(s[0]=Math.asin(i(c,-1,1)),Math.abs(c)<.99999?(s[1]=Math.atan2(-u,d),s[2]=Math.atan2(-o,h)):(s[1]=0,s[2]=Math.atan2(a,r))):"ZYX"===t?(s[1]=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(s[0]=Math.atan2(c,d),s[2]=Math.atan2(a,r)):(s[0]=0,s[2]=Math.atan2(-o,h))):"YZX"===t?(s[2]=Math.asin(i(a,-1,1)),Math.abs(a)<.99999?(s[0]=Math.atan2(-l,h),s[1]=Math.atan2(-u,r)):(s[0]=0,s[1]=Math.atan2(n,d))):"XZY"===t&&(s[2]=Math.asin(-i(o,-1,1)),Math.abs(o)<.99999?(s[0]=Math.atan2(c,h),s[1]=Math.atan2(n,r)):(s[0]=Math.atan2(-l,d),s[1]=0)),s},composeMat4:(e,t,s,i=p.mat4())=>(p.quaternionToRotationMat4(t,i),p.scaleMat4v(s,i),p.translateMat4v(e,i),i),decomposeMat4:(()=>{const e=new h(3),t=new h(16);return function(s,i,r,o){e[0]=s[0],e[1]=s[1],e[2]=s[2];let n=p.lenVec3(e);e[0]=s[4],e[1]=s[5],e[2]=s[6];const a=p.lenVec3(e);e[8]=s[8],e[9]=s[9],e[10]=s[10];const h=p.lenVec3(e);p.determinantMat4(s)<0&&(n=-n),i[0]=s[12],i[1]=s[13],i[2]=s[14],t.set(s);const l=1/n,u=1/a,c=1/h;return t[0]*=l,t[1]*=l,t[2]*=l,t[4]*=u,t[5]*=u,t[6]*=u,t[8]*=c,t[9]*=c,t[10]*=c,p.mat4ToQuaternion(t,r),o[0]=n,o[1]=a,o[2]=h,this}})(),getColMat4(e,t){const s=4*t;return[e[s],e[s+1],e[s+2],e[s+3]]},setRowMat4(e,t,s){e[t]=s[0],e[t+4]=s[1],e[t+8]=s[2],e[t+12]=s[3]},lookAtMat4v(e,t,s,i){i||(i=p.mat4());const r=e[0],o=e[1],n=e[2],a=s[0],h=s[1],l=s[2],u=t[0],c=t[1],d=t[2];if(r===u&&o===c&&n===d)return p.identityMat4();let m,f,g,_,y,v,b,x,P,T;return m=r-u,f=o-c,g=n-d,T=1/Math.sqrt(m*m+f*f+g*g),m*=T,f*=T,g*=T,_=h*g-l*f,y=l*m-a*g,v=a*f-h*m,T=Math.sqrt(_*_+y*y+v*v),T?(T=1/T,_*=T,y*=T,v*=T):(_=0,y=0,v=0),b=f*v-g*y,x=g*_-m*v,P=m*y-f*_,T=Math.sqrt(b*b+x*x+P*P),T?(T=1/T,b*=T,x*=T,P*=T):(b=0,x=0,P=0),i[0]=_,i[1]=b,i[2]=m,i[3]=0,i[4]=y,i[5]=x,i[6]=f,i[7]=0,i[8]=v,i[9]=P,i[10]=g,i[11]=0,i[12]=-(_*r+y*o+v*n),i[13]=-(b*r+x*o+P*n),i[14]=-(m*r+f*o+g*n),i[15]=1,i},lookAtMat4c:(e,t,s,i,r,o,n,a,h)=>p.lookAtMat4v([e,t,s],[i,r,o],[n,a,h],[]),orthoMat4c(e,t,s,i,r,o,n){n||(n=p.mat4());const a=t-e,h=i-s,l=o-r;return n[0]=2/a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2/h,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=-2/l,n[11]=0,n[12]=-(e+t)/a,n[13]=-(i+s)/h,n[14]=-(o+r)/l,n[15]=1,n},frustumMat4v(e,t,s){s||(s=p.mat4());const i=[e[0],e[1],e[2],0],r=[t[0],t[1],t[2],0];p.addVec4(r,i,l),p.subVec4(r,i,u);const o=2*i[2],n=u[0],a=u[1],h=u[2];return s[0]=o/n,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=o/a,s[6]=0,s[7]=0,s[8]=l[0]/n,s[9]=l[1]/a,s[10]=-l[2]/h,s[11]=-1,s[12]=0,s[13]=0,s[14]=-o*r[2]/h,s[15]=0,s},frustumMat4(e,t,s,i,r,o,n){n||(n=p.mat4());const a=t-e,h=i-s,l=o-r;return n[0]=2*r/a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*r/h,n[6]=0,n[7]=0,n[8]=(t+e)/a,n[9]=(i+s)/h,n[10]=-(o+r)/l,n[11]=-1,n[12]=0,n[13]=0,n[14]=-o*r*2/l,n[15]=0,n},perspectiveMat4(e,t,s,i,r){const o=[],n=[];return o[2]=s,n[2]=i,n[1]=o[2]*Math.tan(e/2),o[1]=-n[1],n[0]=n[1]*t,o[0]=-n[0],p.frustumMat4v(o,n,r)},compareMat4:(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15],transformPoint3(e,t,s=p.vec3()){const i=t[0],r=t[1],o=t[2];return s[0]=e[0]*i+e[4]*r+e[8]*o+e[12],s[1]=e[1]*i+e[5]*r+e[9]*o+e[13],s[2]=e[2]*i+e[6]*r+e[10]*o+e[14],s},transformPoint4:(e,t,s=p.vec4())=>(s[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],s[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],s[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],s[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],s),transformPoints3(e,t,s){const i=s||[],r=t.length;let o,n,a,h;const l=e[0],u=e[1],c=e[2],p=e[3],d=e[4],m=e[5],f=e[6],g=e[7],_=e[8],y=e[9],v=e[10],b=e[11],x=e[12],P=e[13],T=e[14],w=e[15];let M;for(let e=0;e<r;++e)h=t[e],o=h[0],n=h[1],a=h[2],M=i[e]||(i[e]=[0,0,0]),M[0]=l*o+d*n+_*a+x,M[1]=u*o+m*n+y*a+P,M[2]=c*o+f*n+v*a+T,M[3]=p*o+g*n+b*a+w;return i.length=r,i},transformPositions3(e,t,s=t){let i;const r=t.length;let o,n,a;const h=e[0],l=e[1],u=e[2];e[3];const c=e[4],p=e[5],d=e[6];e[7];const m=e[8],f=e[9],g=e[10];e[11];const _=e[12],y=e[13],v=e[14];for(e[15],i=0;i<r;i+=3)o=t[i+0],n=t[i+1],a=t[i+2],s[i+0]=h*o+c*n+m*a+_,s[i+1]=l*o+p*n+f*a+y,s[i+2]=u*o+d*n+g*a+v;return s},transformPositions4(e,t,s=t){let i;const r=t.length;let o,n,a;const h=e[0],l=e[1],u=e[2],c=e[3],p=e[4],d=e[5],m=e[6],f=e[7],g=e[8],_=e[9],y=e[10],v=e[11],b=e[12],x=e[13],P=e[14],T=e[15];for(i=0;i<r;i+=4)o=t[i+0],n=t[i+1],a=t[i+2],s[i+0]=h*o+p*n+g*a+b,s[i+1]=l*o+d*n+_*a+x,s[i+2]=u*o+m*n+y*a+P,s[i+3]=c*o+f*n+v*a+T;return s},transformVec3(e,t,s){const i=t[0],r=t[1],o=t[2];return(s=s||this.vec3())[0]=e[0]*i+e[4]*r+e[8]*o,s[1]=e[1]*i+e[5]*r+e[9]*o,s[2]=e[2]*i+e[6]*r+e[10]*o,s},transformVec4(e,t,s){const i=t[0],r=t[1],o=t[2],n=t[3];return(s=s||p.vec4())[0]=e[0]*i+e[4]*r+e[8]*o+e[12]*n,s[1]=e[1]*i+e[5]*r+e[9]*o+e[13]*n,s[2]=e[2]*i+e[6]*r+e[10]*o+e[14]*n,s[3]=e[3]*i+e[7]*r+e[11]*o+e[15]*n,s},rotateVec2(e,t,s,i=e){const r=Math.cos(s),o=Math.sin(s),n=e[0]-t[0],a=e[1]-t[1];return i[0]=n*r-a*o+t[0],i[1]=n*o+a*r+t[1],e},rotateVec3X(e,t,s,i){const r=[],o=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],o[0]=r[0],o[1]=r[1]*Math.cos(s)-r[2]*Math.sin(s),o[2]=r[1]*Math.sin(s)+r[2]*Math.cos(s),i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i},rotateVec3Y(e,t,s,i){const r=[],o=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],o[0]=r[2]*Math.sin(s)+r[0]*Math.cos(s),o[1]=r[1],o[2]=r[2]*Math.cos(s)-r[0]*Math.sin(s),i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i},rotateVec3Z(e,t,s,i){const r=[],o=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],o[0]=r[0]*Math.cos(s)-r[1]*Math.sin(s),o[1]=r[0]*Math.sin(s)+r[1]*Math.cos(s),o[2]=r[2],i[0]=o[0]+t[0],i[1]=o[1]+t[1],i[2]=o[2]+t[2],i},projectVec4(e,t){const s=1/e[3];return(t=t||p.vec2())[0]=e[0]*s,t[1]=e[1]*s,t},unprojectVec3:(()=>{const e=new h(16),t=new h(16),s=new h(16);return function(i,r,o,n){return this.transformVec3(this.mulMat4(this.inverseMat4(r,e),this.inverseMat4(o,t),s),i,n)}})(),lerpVec3(e,t,s,i,r,o){const n=o||p.vec3(),a=(e-t)/(s-t);return n[0]=i[0]+a*(r[0]-i[0]),n[1]=i[1]+a*(r[1]-i[1]),n[2]=i[2]+a*(r[2]-i[2]),n},lerpMat4(e,t,s,i,r,o){const n=o||p.mat4(),a=(e-t)/(s-t);return n[0]=i[0]+a*(r[0]-i[0]),n[1]=i[1]+a*(r[1]-i[1]),n[2]=i[2]+a*(r[2]-i[2]),n[3]=i[3]+a*(r[3]-i[3]),n[4]=i[4]+a*(r[4]-i[4]),n[5]=i[5]+a*(r[5]-i[5]),n[6]=i[6]+a*(r[6]-i[6]),n[7]=i[7]+a*(r[7]-i[7]),n[8]=i[8]+a*(r[8]-i[8]),n[9]=i[9]+a*(r[9]-i[9]),n[10]=i[10]+a*(r[10]-i[10]),n[11]=i[11]+a*(r[11]-i[11]),n[12]=i[12]+a*(r[12]-i[12]),n[13]=i[13]+a*(r[13]-i[13]),n[14]=i[14]+a*(r[14]-i[14]),n[15]=i[15]+a*(r[15]-i[15]),n},flatten(e){const t=[];let s,i,r,o,n;for(s=0,i=e.length;s<i;s++)for(n=e[s],r=0,o=n.length;r<o;r++)t.push(n[r]);return t},identityQuaternion:(e=p.vec4())=>(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e),eulerToQuaternion(e,t,s=p.vec4()){const i=e[0]*p.DEGTORAD/2,r=e[1]*p.DEGTORAD/2,o=e[2]*p.DEGTORAD/2,n=Math.cos(i),a=Math.cos(r),h=Math.cos(o),l=Math.sin(i),u=Math.sin(r),c=Math.sin(o);return"XYZ"===t?(s[0]=l*a*h+n*u*c,s[1]=n*u*h-l*a*c,s[2]=n*a*c+l*u*h,s[3]=n*a*h-l*u*c):"YXZ"===t?(s[0]=l*a*h+n*u*c,s[1]=n*u*h-l*a*c,s[2]=n*a*c-l*u*h,s[3]=n*a*h+l*u*c):"ZXY"===t?(s[0]=l*a*h-n*u*c,s[1]=n*u*h+l*a*c,s[2]=n*a*c+l*u*h,s[3]=n*a*h-l*u*c):"ZYX"===t?(s[0]=l*a*h-n*u*c,s[1]=n*u*h+l*a*c,s[2]=n*a*c-l*u*h,s[3]=n*a*h+l*u*c):"YZX"===t?(s[0]=l*a*h+n*u*c,s[1]=n*u*h+l*a*c,s[2]=n*a*c-l*u*h,s[3]=n*a*h-l*u*c):"XZY"===t&&(s[0]=l*a*h-n*u*c,s[1]=n*u*h-l*a*c,s[2]=n*a*c+l*u*h,s[3]=n*a*h+l*u*c),s},mat4ToQuaternion(e,t=p.vec4()){const s=e[0],i=e[4],r=e[8],o=e[1],n=e[5],a=e[9],h=e[2],l=e[6],u=e[10];let c;const d=s+n+u;return d>0?(c=.5/Math.sqrt(d+1),t[3]=.25/c,t[0]=(l-a)*c,t[1]=(r-h)*c,t[2]=(o-i)*c):s>n&&s>u?(c=2*Math.sqrt(1+s-n-u),t[3]=(l-a)/c,t[0]=.25*c,t[1]=(i+o)/c,t[2]=(r+h)/c):n>u?(c=2*Math.sqrt(1+n-s-u),t[3]=(r-h)/c,t[0]=(i+o)/c,t[1]=.25*c,t[2]=(a+l)/c):(c=2*Math.sqrt(1+u-s-n),t[3]=(o-i)/c,t[0]=(r+h)/c,t[1]=(a+l)/c,t[2]=.25*c),t},vec3PairToQuaternion(e,t,s=p.vec4()){const i=Math.sqrt(p.dotVec3(e,e)*p.dotVec3(t,t));let r=i+p.dotVec3(e,t);return r<1e-8*i?(r=0,Math.abs(e[0])>Math.abs(e[2])?(s[0]=-e[1],s[1]=e[0],s[2]=0):(s[0]=0,s[1]=-e[2],s[2]=e[1])):p.cross3Vec3(e,t,s),s[3]=r,p.normalizeQuaternion(s)},angleAxisToQuaternion(e,t=p.vec4()){const s=e[3]/2,i=Math.sin(s);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(s),t},quaternionToEuler:(()=>{const e=new h(16);return(t,s,i)=>(i=i||p.vec3(),p.quaternionToRotationMat4(t,e),p.mat4ToEuler(e,s,i),i)})(),mulQuaternions(e,t,s=p.vec4()){const i=e[0],r=e[1],o=e[2],n=e[3],a=t[0],h=t[1],l=t[2],u=t[3];return s[0]=n*a+i*u+r*l-o*h,s[1]=n*h+r*u+o*a-i*l,s[2]=n*l+o*u+i*h-r*a,s[3]=n*u-i*a-r*h-o*l,s},vec3ApplyQuaternion(e,t,s=p.vec3()){const i=t[0],r=t[1],o=t[2],n=e[0],a=e[1],h=e[2],l=e[3],u=l*i+a*o-h*r,c=l*r+h*i-n*o,d=l*o+n*r-a*i,m=-n*i-a*r-h*o;return s[0]=u*l+m*-n+c*-h-d*-a,s[1]=c*l+m*-a+d*-n-u*-h,s[2]=d*l+m*-h+u*-a-c*-n,s},quaternionToMat4(e,t){t=p.identityMat4(t);const s=e[0],i=e[1],r=e[2],o=e[3],n=2*s,a=2*i,h=2*r,l=n*o,u=a*o,c=h*o,d=n*s,m=a*s,f=h*s,g=a*i,_=h*i,y=h*r;return t[0]=1-(g+y),t[1]=m+c,t[2]=f-u,t[4]=m-c,t[5]=1-(d+y),t[6]=_+l,t[8]=f+u,t[9]=_-l,t[10]=1-(d+g),t},quaternionToRotationMat4(e,t){const s=e[0],i=e[1],r=e[2],o=e[3],n=s+s,a=i+i,h=r+r,l=s*n,u=s*a,c=s*h,p=i*a,d=i*h,m=r*h,f=o*n,g=o*a,_=o*h;return t[0]=1-(p+m),t[4]=u-_,t[8]=c+g,t[1]=u+_,t[5]=1-(l+m),t[9]=d-f,t[2]=c-g,t[6]=d+f,t[10]=1-(l+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},normalizeQuaternion(e,t=e){const s=p.lenVec4([e[0],e[1],e[2],e[3]]);return t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s,t[3]=e[3]/s,t},conjugateQuaternion:(e,t=e)=>(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t),inverseQuaternion:(e,t)=>p.normalizeQuaternion(p.conjugateQuaternion(e,t)),quaternionToAngleAxis(e,t=p.vec4()){const s=(e=p.normalizeQuaternion(e,c))[3],i=2*Math.acos(s),r=Math.sqrt(1-s*s);return r<.001?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r),t[3]=i,t},AABB3:e=>new h(e||6),AABB2:e=>new h(e||4),OBB3:e=>new h(e||32),OBB2:e=>new h(e||16),Sphere3:(e,t,s,i)=>new h([e,t,s,i]),transformOBB3(e,t,s=t){let i;const r=t.length;let o,n,a;const h=e[0],l=e[1],u=e[2],c=e[3],p=e[4],d=e[5],m=e[6],f=e[7],g=e[8],_=e[9],y=e[10],v=e[11],b=e[12],x=e[13],P=e[14],T=e[15];for(i=0;i<r;i+=4)o=t[i+0],n=t[i+1],a=t[i+2],s[i+0]=h*o+p*n+g*a+b,s[i+1]=l*o+d*n+_*a+x,s[i+2]=u*o+m*n+y*a+P,s[i+3]=c*o+f*n+v*a+T;return s},containsAABB3:function(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&t[4]<=e[4]&&e[2]<=t[2]&&t[5]<=e[5]},getAABB3Diag:(()=>{const e=new h(3),t=new h(3),s=new h(3);return i=>(e[0]=i[0],e[1]=i[1],e[2]=i[2],t[0]=i[3],t[1]=i[4],t[2]=i[5],p.subVec3(t,e,s),Math.abs(p.lenVec3(s)))})(),getAABB3DiagPoint:(()=>{const e=new h(3),t=new h(3),s=new h(3);return(i,r)=>{e[0]=i[0],e[1]=i[1],e[2]=i[2],t[0]=i[3],t[1]=i[4],t[2]=i[5];const o=p.subVec3(t,e,s),n=r[0]-i[0],a=i[3]-r[0],h=r[1]-i[1],l=i[4]-r[1],u=r[2]-i[2],c=i[5]-r[2];return o[0]+=n>a?n:a,o[1]+=h>l?h:l,o[2]+=u>c?u:c,Math.abs(p.lenVec3(o))}})(),getAABB3Area:e=>(e[3]-e[0])*(e[4]-e[1])*(e[5]-e[2]),getAABB3Center(e,t){const s=t||p.vec3();return s[0]=(e[0]+e[3])/2,s[1]=(e[1]+e[4])/2,s[2]=(e[2]+e[5])/2,s},getAABB2Center(e,t){const s=t||p.vec2();return s[0]=(e[2]+e[0])/2,s[1]=(e[3]+e[1])/2,s},collapseAABB3:(e=p.AABB3())=>(e[0]=p.MAX_DOUBLE,e[1]=p.MAX_DOUBLE,e[2]=p.MAX_DOUBLE,e[3]=p.MIN_DOUBLE,e[4]=p.MIN_DOUBLE,e[5]=p.MIN_DOUBLE,e),AABB3ToOBB3:(e,t=p.OBB3())=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t),positions3ToAABB3:(()=>{const e=new h(3);return(t,s,i)=>{s=s||p.AABB3();let r,o,n,a=p.MAX_DOUBLE,h=p.MAX_DOUBLE,l=p.MAX_DOUBLE,u=p.MIN_DOUBLE,c=p.MIN_DOUBLE,d=p.MIN_DOUBLE;for(let s=0,m=t.length;s<m;s+=3)i?(e[0]=t[s+0],e[1]=t[s+1],e[2]=t[s+2],p.decompressPosition(e,i,e),r=e[0],o=e[1],n=e[2]):(r=t[s+0],o=t[s+1],n=t[s+2]),r<a&&(a=r),o<h&&(h=o),n<l&&(l=n),r>u&&(u=r),o>c&&(c=o),n>d&&(d=n);return s[0]=a,s[1]=h,s[2]=l,s[3]=u,s[4]=c,s[5]=d,s}})(),OBB3ToAABB3(e,t=p.AABB3()){let s,i,r,o=p.MAX_DOUBLE,n=p.MAX_DOUBLE,a=p.MAX_DOUBLE,h=p.MIN_DOUBLE,l=p.MIN_DOUBLE,u=p.MIN_DOUBLE;for(let t=0,c=e.length;t<c;t+=4)s=e[t+0],i=e[t+1],r=e[t+2],s<o&&(o=s),i<n&&(n=i),r<a&&(a=r),s>h&&(h=s),i>l&&(l=i),r>u&&(u=r);return t[0]=o,t[1]=n,t[2]=a,t[3]=h,t[4]=l,t[5]=u,t},points3ToAABB3(e,t=p.AABB3()){let s,i,r,o=p.MAX_DOUBLE,n=p.MAX_DOUBLE,a=p.MAX_DOUBLE,h=p.MIN_DOUBLE,l=p.MIN_DOUBLE,u=p.MIN_DOUBLE;for(let t=0,c=e.length;t<c;t++)s=e[t][0],i=e[t][1],r=e[t][2],s<o&&(o=s),i<n&&(n=i),r<a&&(a=r),s>h&&(h=s),i>l&&(l=i),r>u&&(u=r);return t[0]=o,t[1]=n,t[2]=a,t[3]=h,t[4]=l,t[5]=u,t},points3ToSphere3:(()=>{const e=new h(3);return(t,s)=>{s=s||p.vec4();let i,r=0,o=0,n=0;const a=t.length;for(i=0;i<a;i++)r+=t[i][0],o+=t[i][1],n+=t[i][2];s[0]=r/a,s[1]=o/a,s[2]=n/a;let h,l=0;for(i=0;i<a;i++)h=Math.abs(p.lenVec3(p.subVec3(t[i],s,e))),h>l&&(l=h);return s[3]=l,s}})(),positions3ToSphere3:(()=>{const e=new h(3),t=new h(3);return(s,i)=>{i=i||p.vec4();let r,o=0,n=0,a=0;const h=s.length;let l=0;for(r=0;r<h;r+=3)o+=s[r],n+=s[r+1],a+=s[r+2];const u=h/3;let c;for(i[0]=o/u,i[1]=n/u,i[2]=a/u,r=0;r<h;r+=3)e[0]=s[r],e[1]=s[r+1],e[2]=s[r+2],c=Math.abs(p.lenVec3(p.subVec3(e,i,t))),c>l&&(l=c);return i[3]=l,i}})(),OBB3ToSphere3:(()=>{const e=new h(3),t=new h(3);return(s,i)=>{i=i||p.vec4();let r,o=0,n=0,a=0;const h=s.length,l=h/4;for(r=0;r<h;r+=4)o+=s[r+0],n+=s[r+1],a+=s[r+2];i[0]=o/l,i[1]=n/l,i[2]=a/l;let u,c=0;for(r=0;r<h;r+=4)e[0]=s[r+0],e[1]=s[r+1],e[2]=s[r+2],u=Math.abs(p.lenVec3(p.subVec3(e,i,t))),u>c&&(c=u);return i[3]=c,i}})(),getSphere3Center:(e,t=p.vec3())=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t),getPositionsCenter(e,t=p.vec3()){let s=0,i=0,r=0;for(var o=0,n=e.length;o<n;o+=3)s+=e[o+0],i+=e[o+1],r+=e[o+2];const a=e.length/3;return t[0]=s/a,t[1]=i/a,t[2]=r/a,t},expandAABB3:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e),expandAABB3Point3:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e),expandAABB3Points3(e,t){for(var s,i,r,o=0,n=t.length;o<n;o+=3)s=t[o],i=t[o+1],r=t[o+2],e[0]>s&&(e[0]=s),e[1]>i&&(e[1]=i),e[2]>r&&(e[2]=r),e[3]<s&&(e[3]=s),e[4]<i&&(e[4]=i),e[5]<r&&(e[5]=r);return e},collapseAABB2:(e=p.AABB2())=>(e[0]=p.MAX_DOUBLE,e[1]=p.MAX_DOUBLE,e[2]=p.MIN_DOUBLE,e[3]=p.MIN_DOUBLE,e),point3AABB3Intersect:(e,t)=>e[0]>t[0]||e[3]<t[0]||e[1]>t[1]||e[4]<t[1]||e[2]>t[2]||e[5]<t[2],planeAABB3Intersect(e,t,s){let i,r;e[0]>0?(i=e[0]*s[0],r=e[0]*s[3]):(i=e[0]*s[3],r=e[0]*s[0]),e[1]>0?(i+=e[1]*s[1],r+=e[1]*s[4]):(i+=e[1]*s[4],r+=e[1]*s[1]),e[2]>0?(i+=e[2]*s[2],r+=e[2]*s[5]):(i+=e[2]*s[5],r+=e[2]*s[2]);if(i<=-t&&r<=-t)return-1;return i>=-t&&r>=-t?1:0},OBB3ToAABB2(e,t=p.AABB2()){let s,i,r,o,n=p.MAX_DOUBLE,a=p.MAX_DOUBLE,h=p.MIN_DOUBLE,l=p.MIN_DOUBLE;for(let t=0,u=e.length;t<u;t+=4)s=e[t+0],i=e[t+1],r=e[t+3]||1,o=1/r,s*=o,i*=o,s<n&&(n=s),i<a&&(a=i),s>h&&(h=s),i>l&&(l=i);return t[0]=n,t[1]=a,t[2]=h,t[3]=l,t},expandAABB2:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e),expandAABB2Point2:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1]),e),AABB2ToCanvas(e,t,s,i=e){const r=.5*(e[0]+1),o=.5*(e[1]+1),n=.5*(e[2]+1),a=.5*(e[3]+1);return i[0]=Math.floor(r*t),i[1]=s-Math.floor(a*s),i[2]=Math.floor(n*t),i[3]=s-Math.floor(o*s),i},tangentQuadraticBezier:(e,t,s,i)=>2*(1-e)*(s-t)+2*e*(i-s),tangentQuadraticBezier3:(e,t,s,i,r)=>-3*t*(1-e)*(1-e)+3*s*(1-e)*(1-e)-6*e*s*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*r,tangentSpline:e=>6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e),catmullRomInterpolate(e,t,s,i,r){const o=.5*(s-e),n=.5*(i-t),a=r*r;return(2*t-2*s+o+n)*(r*a)+(-3*t+3*s-2*o-n)*a+o*r+t},b2p0(e,t){const s=1-e;return s*s*t},b2p1:(e,t)=>2*(1-e)*e*t,b2p2:(e,t)=>e*e*t,b2(e,t,s,i){return this.b2p0(e,t)+this.b2p1(e,s)+this.b2p2(e,i)},b3p0(e,t){const s=1-e;return s*s*s*t},b3p1(e,t){const s=1-e;return 3*s*s*e*t},b3p2:(e,t)=>3*(1-e)*e*e*t,b3p3:(e,t)=>e*e*e*t,b3(e,t,s,i,r){return this.b3p0(e,t)+this.b3p1(e,s)+this.b3p2(e,i)+this.b3p3(e,r)},triangleNormal(e,t,s,i=p.vec3()){const r=t[0]-e[0],o=t[1]-e[1],n=t[2]-e[2],a=s[0]-e[0],h=s[1]-e[1],l=s[2]-e[2],u=o*l-n*h,c=n*a-r*l,d=r*h-o*a,m=Math.sqrt(u*u+c*c+d*d);return 0===m?(i[0]=0,i[1]=0,i[2]=0):(i[0]=u/m,i[1]=c/m,i[2]=d/m),i},rayTriangleIntersect:(()=>{const e=new h(3),t=new h(3),s=new h(3),i=new h(3),r=new h(3);return(o,n,a,h,l,u)=>{u=u||p.vec3();const c=p.subVec3(h,a,e),d=p.subVec3(l,a,t),m=p.cross3Vec3(n,d,s),f=p.dotVec3(c,m);if(f<1e-6)return null;const g=p.subVec3(o,a,i),_=p.dotVec3(g,m);if(_<0||_>f)return null;const y=p.cross3Vec3(g,c,r),v=p.dotVec3(n,y);if(v<0||_+v>f)return null;const b=p.dotVec3(d,y)/f;return u[0]=o[0]+b*n[0],u[1]=o[1]+b*n[1],u[2]=o[2]+b*n[2],u}})(),rayPlaneIntersect:(()=>{const e=new h(3),t=new h(3),s=new h(3),i=new h(3);return(r,o,n,a,h,l)=>{l=l||p.vec3(),o=p.normalizeVec3(o,e);const u=p.subVec3(a,n,t),c=p.subVec3(h,n,s),d=p.cross3Vec3(u,c,i);p.normalizeVec3(d,d);const m=-p.dotVec3(n,d),f=-(p.dotVec3(r,d)+m)/p.dotVec3(o,d);return l[0]=r[0]+f*o[0],l[1]=r[1]+f*o[1],l[2]=r[2]+f*o[2],l}})(),cartesianToBarycentric:(()=>{const e=new h(3),t=new h(3),s=new h(3);return(i,r,o,n,a)=>{const h=p.subVec3(n,r,e),l=p.subVec3(o,r,t),u=p.subVec3(i,r,s),c=p.dotVec3(h,h),d=p.dotVec3(h,l),m=p.dotVec3(h,u),f=p.dotVec3(l,l),g=p.dotVec3(l,u),_=c*f-d*d;if(0===_)return null;const y=1/_,v=(f*m-d*g)*y,b=(c*g-d*m)*y;return a[0]=1-v-b,a[1]=b,a[2]=v,a}})(),barycentricInsideTriangle(e){const t=e[1],s=e[2];return s>=0&&t>=0&&s+t<1},barycentricToCartesian(e,t,s,i,r=p.vec3()){const o=e[0],n=e[1],a=e[2];return r[0]=t[0]*o+s[0]*n+i[0]*a,r[1]=t[1]*o+s[1]*n+i[1]*a,r[2]=t[2]*o+s[2]*n+i[2]*a,r},mergeVertices(e,t,s,i){const r={},o=[],n=[],a=t?[]:null,h=s?[]:null,l=[];let u,c,p,d;const m=1e4;let f,g,_=0;for(f=0,g=e.length;f<g;f+=3)u=e[f],c=e[f+1],p=e[f+2],d=`${Math.round(u*m)}_${Math.round(c*m)}_${Math.round(p*m)}`,void 0===r[d]&&(r[d]=n.length/3,n.push(u),n.push(c),n.push(p),t&&(a.push(t[f]),a.push(t[f+1]),a.push(t[f+2])),s&&(h.push(s[_]),h.push(s[_+1]))),o[f/3]=r[d],_+=2;for(f=0,g=i.length;f<g;f++)l[f]=o[i[f]];const y={positions:n,indices:l};return a&&(y.normals=a),h&&(y.uv=h),y},buildNormals:(()=>{const e=new h(3),t=new h(3),s=new h(3),i=new h(3),r=new h(3),o=new h(3);return(n,a,h)=>{let l,u;const c=new Array(n.length/3);let d,m,f,g,_,y,v;for(l=0,u=a.length;l<u;l+=3){d=a[l],m=a[l+1],f=a[l+2],e[0]=n[3*d],e[1]=n[3*d+1],e[2]=n[3*d+2],t[0]=n[3*m],t[1]=n[3*m+1],t[2]=n[3*m+2],s[0]=n[3*f],s[1]=n[3*f+1],s[2]=n[3*f+2],p.subVec3(t,e,i),p.subVec3(s,e,r);const h=p.vec3();p.normalizeVec3(p.cross3Vec3(i,r,o),h),c[d]||(c[d]=[]),c[m]||(c[m]=[]),c[f]||(c[f]=[]),c[d].push(h),c[m].push(h),c[f].push(h)}for(h=h&&h.length===n.length?h:new Float32Array(n.length),l=0,u=c.length;l<u;l++){g=c[l].length,_=0,y=0,v=0;for(let e=0;e<g;e++)_+=c[l][e][0],y+=c[l][e][1],v+=c[l][e][2];h[3*l]=_/g,h[3*l+1]=y/g,h[3*l+2]=v/g}return h}})(),buildTangents:(()=>{const e=new h(3),t=new h(3),s=new h(3),i=new h(3),r=new h(3),o=new h(3),n=new h(3);return(a,h,l)=>{const u=new Float32Array(a.length);for(let c=0;c<h.length;c+=3){let d=h[c];const m=a.subarray(3*d,3*d+3),f=l.subarray(2*d,2*d+2);d=h[c+1];const g=a.subarray(3*d,3*d+3),_=l.subarray(2*d,2*d+2);d=h[c+2];const y=a.subarray(3*d,3*d+3),v=l.subarray(2*d,2*d+2),b=p.subVec3(g,m,e),x=p.subVec3(y,m,t),P=p.subVec2(_,f,s),T=p.subVec2(v,f,i),w=1/(P[0]*T[1]-P[1]*T[0]),M=p.mulVec3Scalar(p.subVec3(p.mulVec3Scalar(b,T[1],r),p.mulVec3Scalar(x,P[1],o),n),w,o);let I;for(let e=0;e<3;e++)I=3*h[c+e],u[I]+=M[0],u[I+1]+=M[1],u[I+2]+=M[2]}return u}})(),buildPickTriangles(e,t,s){const i=t.length,r=s?new Uint16Array(9*i):new Float32Array(9*i),o=new Uint8Array(12*i);let n,a,h,l,u,c,p=0,d=0,m=0;for(let s=0;s<i;s+=3)c=p>>24&255,u=p>>16&255,l=p>>8&255,h=255&p,a=t[s],n=3*a,r[d++]=e[n],r[d++]=e[n+1],r[d++]=e[n+2],o[m++]=h,o[m++]=l,o[m++]=u,o[m++]=c,a=t[s+1],n=3*a,r[d++]=e[n],r[d++]=e[n+1],r[d++]=e[n+2],o[m++]=h,o[m++]=l,o[m++]=u,o[m++]=c,a=t[s+2],n=3*a,r[d++]=e[n],r[d++]=e[n+1],r[d++]=e[n+2],o[m++]=h,o[m++]=l,o[m++]=u,o[m++]=c,p++;return{positions:r,colors:o}},faceToVertexNormals(e,t,s={}){const i=s.smoothNormalsAngleThreshold||20,r={},o=[],n={};let a,h,l,u,c;const d=1e4;let m,f,g,_,y,v;for(f=0,_=e.length;f<_;f+=3){m=f/3,h=e[f],l=e[f+1],u=e[f+2],c=`${Math.round(h*d)}_${Math.round(l*d)}_${Math.round(u*d)}`,void 0===r[c]?r[c]=[m]:r[c].push(m);const s=p.normalizeVec3([t[f],t[f+1],t[f+2]]);o[m]=s,a=p.vec4([s[0],s[1],s[2],1]),n[m]=a}for(c in r)if(r.hasOwnProperty(c)){const e=r[c],t=e.length;for(f=0;f<t;f++){const s=e[f];for(a=n[s],g=0;g<t;g++){if(f===g)continue;const t=e[g];y=o[s],v=o[t];Math.abs(p.angleVec3(y,v)/p.DEGTORAD)<i&&(a[0]+=v[0],a[1]+=v[1],a[2]+=v[2],a[3]+=1)}}}for(f=0,_=t.length;f<_;f+=3)a=n[f/3],t[f+0]=a[0]/a[3],t[f+1]=a[1]/a[3],t[f+2]=a[2]/a[3]},transformRay:(()=>{const e=new h(4),t=new h(4);return(s,i,r,o,n)=>{e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=1,p.transformVec4(s,e,t),o[0]=t[0],o[1]=t[1],o[2]=t[2],e[0]=r[0],e[1]=r[1],e[2]=r[2],p.transformVec3(s,e,t),p.normalizeVec3(t),n[0]=t[0],n[1]=t[1],n[2]=t[2]}})(),canvasPosToWorldRay:(()=>{const e=new h(16),t=new h(16),s=new h(4),i=new h(4),r=new h(4),o=new h(4);return(n,a,h,l,u,c)=>{const d=p.mulMat4(h,a,e),m=p.inverseMat4(d,t),f=n.width,g=n.height,_=(l[0]-f/2)/(f/2),y=-(l[1]-g/2)/(g/2);s[0]=_,s[1]=y,s[2]=-1,s[3]=1,p.transformVec4(m,s,i),p.mulVec4Scalar(i,1/i[3]),r[0]=_,r[1]=y,r[2]=1,r[3]=1,p.transformVec4(m,r,o),p.mulVec4Scalar(o,1/o[3]),u[0]=o[0],u[1]=o[1],u[2]=o[2],p.subVec3(o,i,c),p.normalizeVec3(c)}})(),canvasPosToLocalRay:(()=>{const e=new h(3),t=new h(3);return(s,i,r,o,n,a,h)=>{p.canvasPosToWorldRay(s,i,r,n,e,t),p.worldRayToLocalRay(o,e,t,a,h)}})(),worldRayToLocalRay:(()=>{const e=new h(16),t=new h(4),s=new h(4);return(i,r,o,n,a)=>{const h=p.inverseMat4(i,e);t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=1,p.transformVec4(h,t,s),n[0]=s[0],n[1]=s[1],n[2]=s[2],p.transformVec3(h,o,a)}})(),buildKDTree:(()=>{const e=new Float32Array;function t(s,i,r,o){const n=new h(6),a={triangles:null,left:null,right:null,leaf:!1,splitDim:0,aabb:n};let l,u;for(n[0]=n[1]=n[2]=Number.POSITIVE_INFINITY,n[3]=n[4]=n[5]=Number.NEGATIVE_INFINITY,l=0,u=s.length;l<u;++l){var c=3*s[l];for(let e=0;e<3;++e){const t=3*i[c+e];r[t]<n[0]&&(n[0]=r[t]),r[t]>n[3]&&(n[3]=r[t]),r[t+1]<n[1]&&(n[1]=r[t+1]),r[t+1]>n[4]&&(n[4]=r[t+1]),r[t+2]<n[2]&&(n[2]=r[t+2]),r[t+2]>n[5]&&(n[5]=r[t+2])}}if(s.length<20||o>10)return a.triangles=s,a.leaf=!0,a;e[0]=n[3]-n[0],e[1]=n[4]-n[1],e[2]=n[5]-n[2];let p=0;e[1]>e[p]&&(p=1),e[2]>e[p]&&(p=2),a.splitDim=p;const d=(n[p]+n[p+3])/2,m=new Array(s.length);let f=0;const g=new Array(s.length);let _=0;for(l=0,u=s.length;l<u;++l){const e=i[c=3*s[l]],t=3*i[c+1],o=3*i[c+2];r[3*e+p]<=d||r[t+p]<=d||r[o+p]<=d?m[f++]=s[l]:g[_++]=s[l]}return m.length=f,g.length=_,a.left=t(m,i,r,o+1),a.right=t(g,i,r,o+1),a}return(e,s)=>{const i=e.length/3,r=new Array(i);for(let e=0;e<i;++e)r[e]=e;return t(r,e,s,0)}})(),decompressPosition(e,t,s){(s=s||e)[0]=e[0]*t[0]+t[12],s[1]=e[1]*t[5]+t[13],s[2]=e[2]*t[10]+t[14]},decompressPositions(e,t,s=new Float32Array(e.length)){for(let i=0,r=e.length;i<r;i+=3)s[i+0]=e[i+0]*t[0]+t[12],s[i+1]=e[i+1]*t[5]+t[13],s[i+2]=e[i+2]*t[10]+t[14];return s},decompressUV(e,t,s){s[0]=e[0]*t[0]+t[6],s[1]=e[1]*t[4]+t[7]},decompressUVs(e,t,s=new Float32Array(e.length)){for(let i=0,r=e.length;i<r;i+=3)s[i+0]=e[i+0]*t[0]+t[6],s[i+1]=e[i+1]*t[4]+t[7];return s},octDecodeVec2(e,t){let s=e[0],i=e[1];s=(2*s+1)/255,i=(2*i+1)/255;const r=1-Math.abs(s)-Math.abs(i);r<0&&(s=(1-Math.abs(i))*(s>=0?1:-1),i=(1-Math.abs(s))*(i>=0?1:-1));const o=Math.sqrt(s*s+i*i+r*r);return t[0]=s/o,t[1]=i/o,t[2]=r/o,t},octDecodeVec2s(e,t){for(let s=0,i=0,r=e.length;s<r;s+=2){let r=e[s+0],o=e[s+1];r=(2*r+1)/255,o=(2*o+1)/255;const n=1-Math.abs(r)-Math.abs(o);n<0&&(r=(1-Math.abs(o))*(r>=0?1:-1),o=(1-Math.abs(r))*(o>=0?1:-1));const a=Math.sqrt(r*r+o*o+n*n);t[i+0]=r/a,t[i+1]=o/a,t[i+2]=n/a,i+=3}return t}};p.buildEdgeIndices=function(){const e=[],t=[],s=[],i=[],r=[];let o=0;const n=new Uint16Array(3),a=new Uint16Array(3),h=new Uint16Array(3),l=p.vec3(),u=p.vec3(),c=p.vec3(),d=p.vec3(),m=p.vec3(),f=p.vec3(),g=p.vec3();return function(_,y,v,b){!function(r,o){const n={};let a,h,l,u;const c=Math.pow(10,4);let p,d,m=0;for(p=0,d=r.length;p<d;p+=3)a=r[p],h=r[p+1],l=r[p+2],u=Math.round(a*c)+"_"+Math.round(h*c)+"_"+Math.round(l*c),void 0===n[u]&&(n[u]=m/3,e[m++]=a,e[m++]=h,e[m++]=l),t[p/3]=n[u];for(p=0,d=o.length;p<d;p++)i[p]=t[o[p]],s[i[p]]=o[p]}(_,y),function(t,s){o=0;for(let _=0,y=t;_<y;_+=3){const t=3*i[_],y=3*i[_+1],v=3*i[_+2];s?(n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],a[0]=e[y],a[1]=e[y+1],a[2]=e[y+2],h[0]=e[v],h[1]=e[v+1],h[2]=e[v+2],p.decompressPosition(n,s,l),p.decompressPosition(a,s,u),p.decompressPosition(h,s,c)):(l[0]=e[t],l[1]=e[t+1],l[2]=e[t+2],u[0]=e[y],u[1]=e[y+1],u[2]=e[y+2],c[0]=e[v],c[1]=e[v+1],c[2]=e[v+2]),p.subVec3(c,u,d),p.subVec3(l,u,m),p.cross3Vec3(d,m,f),p.normalizeVec3(f,g);const b=r[o]||(r[o]={normal:p.vec3()});b.normal[0]=g[0],b.normal[1]=g[1],b.normal[2]=g[2],o++}}(y.length,v);const x=[],P=Math.cos(p.DEGTORAD*b),T={};let w,M,I,C,D,A,E,F,R,S,O,B=!1;for(let e=0,t=y.length;e<t;e+=3){const t=e/3;for(let s=0;s<3;s++)w=i[e+s],M=i[e+(s+1)%3],I=Math.min(w,M),C=Math.max(w,M),D=I+","+C,void 0===T[D]?T[D]={index1:I,index2:C,face1:t,face2:void 0}:T[D].face2=t}for(D in T)A=T[D],void 0!==A.face2&&(E=r[A.face1].normal,F=r[A.face2].normal,R=p.dotVec3(E,F),R>P)||(S=s[A.index1],O=s[A.index2],(!B&&S>65535||O>65535)&&(B=!0),x.push(S),x.push(O));return B?new Uint32Array(x):new Uint16Array(x)}}();class d{constructor(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}get length(){return this._length}shift(){if(this._index>=this._headLength){const e=this._head;if(e.length=0,this._head=this._tail,this._tail=e,this._index=0,this._headLength=this._head.length,!this._headLength)return}const e=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,e}push(e){return this._length++,this._tail.push(e),this}unshift(e){return this._head[--this._index]=e,this._length++,this}}const m={build:{version:"0.8"},client:{browser:navigator&&navigator.userAgent?navigator.userAgent:"n/a"},components:{scenes:0,models:0,meshes:0,objects:0},memory:{meshes:0,positions:0,colors:0,normals:0,uvs:0,indices:0,textures:0,transforms:0,materials:0,programs:0},frame:{frameCount:0,fps:0,useProgram:0,bindTexture:0,bindArray:0,drawElements:0,drawArrays:0,tasksRun:0,tasksScheduled:0}};var f=[["0",10],["A",26],["a",26],["_",1],["$",1]].map((function(e){for(var t=[],s=e[0].charCodeAt(0),i=s+e[1],r=s;r<i;++r)t.push(r);return String.fromCharCode.apply(null,t)})).join("");function g(e,t){return(t&&4!==t?[0,6]:[0,6,12,18]).map((function(t){return f.substr(parseInt(e/(1<<t))%64,1)})).reverse().join("")}const _=function(){for(var e={},t=window.location.search.substring(1).split("&"),s=0;s<t.length;s++){var i=t[s].split("=");if(void 0===e[i[0]])e[i[0]]=decodeURIComponent(i[1]);else if("string"==typeof e[i[0]]){var r=[e[i[0]],decodeURIComponent(i[1])];e[i[0]]=r}else e[i[0]].push(decodeURIComponent(i[1]))}return e}();const y={xmlToJson:function e(t,s){if(t.nodeType===t.TEXT_NODE){var i=t.nodeValue;if(null===i.match(/^\s+$/))return i}else if(t.nodeType===t.ELEMENT_NODE||t.nodeType===t.DOCUMENT_NODE){var r={type:t.nodeName,children:[]};if(t.nodeType===t.ELEMENT_NODE)for(var o=0;o<t.attributes.length;o++){var n=t.attributes[o];r[s[n.nodeName]||n.nodeName]=n.nodeValue}for(var a=0;a<t.childNodes.length;a++){(o=e(t.childNodes[a],s))&&r.children.push(o)}return r}},clone:function(e){return JSON.parse(JSON.stringify(e))},compressGuid:function(e){var t=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map((function(t){return parseInt(e.substr(t,2),16)}));return g(t[0],2)+[1,4,7,10,13].map((function(e){return g((t[e]<<16)+(t[e+1]<<8)+t[e+2])})).join("")},findNodeOfType:function(e,t){var s=[],i=function(e){e.type===t&&s.push(e),(e.children||[]).forEach((function(e){i(e)}))};return i(e),s},timeout:function(e){return new Promise((function(t,s){setTimeout(t,e)}))},httpRequest:function(e){return new Promise((function(t,s){var i=new XMLHttpRequest;i.open(e.method||"GET",e.url,!0),i.onload=function(r){console.log(e.url,i.readyState,i.status),4===i.readyState&&(200===i.status?t(i.responseXML):s(i.statusText))},i.send(null)}))},loadJSON:function(e,t,s){var i=e=>{};t=t||i,s=s||i;var r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.open("GET",e,!0),r.addEventListener("load",(function(e){var i=e.target.response;if(200===this.status){var r;try{r=JSON.parse(i)}catch(e){s(`utils.loadJSON(): Failed to parse JSON response - ${e}`)}t(r)}else if(0===this.status){console.warn("loadFile: HTTP Status 0 received.");try{t(JSON.parse(i))}catch(e){s(`utils.loadJSON(): Failed to parse JSON response - ${e}`)}}else s(e)}),!1),r.addEventListener("error",(function(e){s(e)}),!1),r.send(null)},loadArraybuffer:function(e,t,s){var i=e=>{};t=t||i,s=s||i;const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const e=!!r[2];var o=r[3];o=window.decodeURIComponent(o),e&&(o=window.atob(o));try{const e=new ArrayBuffer(o.length),s=new Uint8Array(e);for(var n=0;n<o.length;n++)s[n]=o.charCodeAt(n);window.setTimeout((function(){t(e)}),0)}catch(e){window.setTimeout((function(){s(e)}),0)}}else{const i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t(i.response):s("loadArrayBuffer error : "+i.response))},i.send(null)}},queryString:_,isArray:function(e){return e&&!e.propertyIsEnumerable("length")&&"object"==typeof e&&"number"==typeof e.length},isString:function(e){return"string"==typeof e||e instanceof String},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isID:function(e){return y.isString(e)||y.isNumeric(e)},isSameComponent:function(e,t){return!(!e||!t)&&(y.isNumeric(e)||y.isString(e)?`${e}`:e.id)===(y.isNumeric(t)||y.isString(t)?`${t}`:t.id)},isFunction:function(e){return"function"==typeof e},isObject:function(e){const t={}.constructor;return!!e&&e.constructor===t},copy:function(e){return y.apply(e,{})},apply:function(e,t){for(const s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t},apply2:function(e,t){for(const s in e)e.hasOwnProperty(s)&&void 0!==e[s]&&null!==e[s]&&(t[s]=e[s]);return t},applyIf:function(e,t){for(const s in e)e.hasOwnProperty(s)&&(void 0!==t[s]&&null!==t[s]||(t[s]=e[s]));return t},isEmptyObject:function(e){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0},inQuotes:function(e){return y.isNumeric(e)?`${e}`:`'${e}'`},concat:function(e,t){const s=new e.constructor(e.length+t.length);return s.set(e),s.set(t,e.length),s},flattenParentChildHierarchy:function(e){var t=[];return function e(s){s.id=s.uuid,delete s.oid,t.push(s);var i=s.children;if(i)for(var r=0,o=i.length;r<o;r++){i[r].parent=s.id,e(i[r])}s.children=[]}(e),t}},v={},b=new e,x=new d,P={sceneId:null,time:null,startTime:null,prevTime:null,deltaTime:null},T=[];let w,M=0,I=0;const C=new function(){this.version="1.0.0",this.scenes={},this._superTypes={},this._addScene=function(e){if(e.id){if(C.scenes[e.id])return void console.error(`[ERROR] Scene ${y.inQuotes(e.id)} already exists`)}else e.id=b.addItem({});C.scenes[e.id]=e;const t=e.ticksPerOcclusionTest,s=e.ticksPerRender;v[e.id]={ticksPerOcclusionTest:t,ticksPerRender:s,renderCountdown:s},m.components.scenes++,e.once("destroyed",(()=>{b.removeItem(e.id),delete C.scenes[e.id],delete v[e.id],m.components.scenes--}))},this.clear=function(){let e;for(const t in C.scenes)C.scenes.hasOwnProperty(t)&&(e=C.scenes[t],"default.scene"===t?e.clear():(e.destroy(),delete C.scenes[e.id]))},this.scheduleTask=function(e,t){x.push(e),x.push(t)},this.runTasks=function(e=-1){let t,s,i=(new Date).getTime(),r=0;for(;x.length>0&&(e<0||i<e);)t=x.shift(),s=x.shift(),s?t.call(s):t(),i=(new Date).getTime(),r++;return r},this.getNumTasks=function(){return x.length}},D=function(){let e=Date.now();if(M>0){w=e-M;var t=1e3/w;I+=t,T.push(t),T.length>=30&&(I-=T.shift()),m.frame.fps=Math.round(I/T.length)}!function(e){const t=C.runTasks(e+10),s=C.getNumTasks();m.frame.tasksRun=t,m.frame.tasksScheduled=s,m.frame.tasksBudget=10}(e),function(e){for(var t in P.time=e,C.scenes)if(C.scenes.hasOwnProperty(t)){var s=C.scenes[t];P.sceneId=t,P.startTime=s.startTime,P.deltaTime=null!=P.prevTime?P.time-P.prevTime:0,s.fire("tick",P,!0)}P.prevTime=e}(e),function(){const e=C.scenes,t=!1;let s,i,r,o,n;for(n in e)e.hasOwnProperty(n)&&(s=e[n],i=v[n],i||(i=v[n]={}),r=s.ticksPerOcclusionTest,i.ticksPerOcclusionTest!==r&&(i.ticksPerOcclusionTest=r,i.renderCountdown=r),--s.occlusionTestCountdown<=0&&(s.doOcclusionTest(),s.occlusionTestCountdown=r),o=s.ticksPerRender,i.ticksPerRender!==o&&(i.ticksPerRender=o,i.renderCountdown=o),0==--i.renderCountdown&&(s.render(t),i.renderCountdown=o))}(),M=e,void 0!==window.requestPostAnimationFrame?window.requestPostAnimationFrame(D):requestAnimationFrame(D)};void 0!==window.requestPostAnimationFrame?window.requestPostAnimationFrame(D):requestAnimationFrame(D);class A{get type(){return"Component"}get isComponent(){return!0}constructor(e=null,t={}){if(this.scene=null,"Scene"===this.type)this.scene=this,this.viewer=t.viewer;else{if("Scene"===e.type)this.scene=e;else{if(!(e instanceof A))throw"Invalid param: owner must be a Component";this.scene=e.scene}this._owner=e}this._dontClear=!!t.dontClear,this._renderer=this.scene._renderer,this.meta=t.meta||{},this.id=t.id,this.destroyed=!1,this._attached={},this._attachments=null,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._eventSubsNum=null,this._events=null,this._eventCallDepth=0,this._ownedComponents=null,this!==this.scene&&this.scene._addComponent(this),this._updateScheduled=!1,e&&e._own(this)}glRedraw(){this._renderer&&(this._renderer.imageDirty(),this.castsShadow&&this._renderer.shadowsDirty())}glResort(){this._renderer&&this._renderer.needStateSort()}get owner(){return this._owner}isType(e){return this.type===e}fire(e,t,s){this._events||(this._events={}),this._eventSubs||(this._eventSubs={},this._eventSubsNum={}),!0!==s&&(this._events[e]=t||!0);const i=this._eventSubs[e];let r;if(i)for(const s in i)i.hasOwnProperty(s)&&(r=i[s],this._eventCallDepth++,this._eventCallDepth<300?r.callback.call(r.scope,t):this.error("fire: potential stack overflow from recursive event '"+e+"' - dropping this event"),this._eventCallDepth--)}on(t,s,i){this._events||(this._events={}),this._subIdMap||(this._subIdMap=new e),this._subIdEvents||(this._subIdEvents={}),this._eventSubs||(this._eventSubs={}),this._eventSubsNum||(this._eventSubsNum={});let r=this._eventSubs[t];r?this._eventSubsNum[t]++:(r={},this._eventSubs[t]=r,this._eventSubsNum[t]=1);const o=this._subIdMap.addItem();r[o]={callback:s,scope:i||this},this._subIdEvents[o]=t;const n=this._events[t];return void 0!==n&&s.call(i||this,n),o}off(e){if(null==e)return;if(!this._subIdEvents)return;const t=this._subIdEvents[e];if(t){delete this._subIdEvents[e];const s=this._eventSubs[t];s&&(delete s[e],this._eventSubsNum[t]--),this._subIdMap.removeItem(e)}}once(e,t,s){const i=this,r=this.on(e,(function(e){i.off(r),t.call(s||this,e)}),s)}hasSubs(e){return this._eventSubsNum&&this._eventSubsNum[e]>0}log(e){e="[LOG]"+this._message(e),window.console.log(e),this.scene.fire("log",e)}_message(e){return" ["+this.type+" "+y.inQuotes(this.id)+"]: "+e}warn(e){e="[WARN]"+this._message(e),window.console.warn(e),this.scene.fire("warn",e)}error(e){e="[ERROR]"+this._message(e),window.console.error(e),this.scene.fire("error",e)}_attach(e){const t=e.name;if(!t)return void this.error("Component 'name' expected");let s=e.component;const i=e.sceneDefault,r=e.sceneSingleton,o=e.type,n=e.on,a=!1!==e.recompiles;if(s&&(y.isNumeric(s)||y.isString(s))){const e=s;if(s=this.scene.components[e],!s)return void this.error("Component not found: "+y.inQuotes(e))}if(!s)if(!0===r){const e=this.scene.types[o];for(const t in e)if(e.hasOwnProperty){s=e[t];break}if(!s)return this.error("Scene has no default component for '"+t+"'"),null}else if(!0===i&&(s=this.scene[t],!s))return this.error("Scene has no default component for '"+t+"'"),null;if(s){if(s.scene.id!==this.scene.id)return void this.error("Not in same scene: "+s.type+" "+y.inQuotes(s.id));if(o&&!s.isType(o))return void this.error("Expected a "+o+" type or subtype: "+s.type+" "+y.inQuotes(s.id))}this._attachments||(this._attachments={});const h=this._attached[t];let l,u,c;if(h){if(s&&h.id===s.id)return;const e=this._attachments[h.id];for(l=e.subs,u=0,c=l.length;u<c;u++)h.off(l[u]);delete this._attached[t],delete this._attachments[h.id];const i=e.params.onDetached;i&&(y.isFunction(i)?i(h):i.scope?i.callback.call(i.scope,h):i.callback(h)),e.managingLifecycle&&h.destroy()}if(s){const i={params:e,component:s,subs:[],managingLifecycle:false};i.subs.push(s.once("destroyed",(function(){i.params.component=null,this._attach(i.params)}),this)),a&&i.subs.push(s.on("dirty",(function(){this.fire("dirty",this)}),this)),this._attached[t]=s,this._attachments[s.id]=i;const r=e.onAttached;if(r&&(y.isFunction(r)?r(s):r.scope?r.callback.call(r.scope,s):r.callback(s)),n){let e,t,r,o;for(e in n)if(n.hasOwnProperty(e)){if(t=n[e],y.isFunction(t)?(r=t,o=null):(r=t.callback,o=t.scope),!r)continue;i.subs.push(s.on(e,r,o))}}}return a&&this.fire("dirty",this),this.fire(t,s),s}_checkComponent(e,t){if(!t.isComponent){if(!y.isID(t))return void this.error("Expected a Component or ID");{const e=t;if(!(t=this.scene.components[e]))return void this.error("Component not found: "+e)}}if(e===t.type){if(t.scene.id===this.scene.id)return t;this.error("Not in same scene: "+t.type)}else this.error("Expected a "+e+" Component")}_checkComponent2(e,t){if(!t.isComponent){if(!y.isID(t))return void this.error("Expected a Component or ID");{const e=t;if(!(t=this.scene.components[e]))return void this.error("Component not found: "+e)}}if(t.scene.id===this.scene.id){for(var s=0,i=e.length;s<i;s++)if(e[s]===t.type)return t;return this.error("Expected component types: "+e),null}this.error("Not in same scene: "+t.type)}_own(e){this._ownedComponents||(this._ownedComponents={}),this._ownedComponents[e.id]||(this._ownedComponents[e.id]=e),e.once("destroyed",(()=>{delete this._ownedComponents[e.id]}),this)}_needUpdate(e){this._updateScheduled||(this._updateScheduled=!0,0===e?this._doUpdate():C.scheduleTask(this._doUpdate,this))}_doUpdate(){this._updateScheduled&&(this._updateScheduled=!1,this._update&&this._update())}_update(){}clear(){if(this._ownedComponents)for(var e in this._ownedComponents)if(this._ownedComponents.hasOwnProperty(e)){this._ownedComponents[e].destroy(),delete this._ownedComponents[e]}}destroy(){if(this.destroyed)return;let e,t,s,i,r,o;if(this.fire("destroyed",this.destroyed=!0),this._attachments)for(e in this._attachments)if(this._attachments.hasOwnProperty(e)){for(t=this._attachments[e],s=t.component,i=t.subs,r=0,o=i.length;r<o;r++)s.off(i[r]);t.managingLifecycle&&s.destroy()}if(this._ownedComponents)for(e in this._ownedComponents)this._ownedComponents.hasOwnProperty(e)&&(s=this._ownedComponents[e],s.destroy(),delete this._ownedComponents[e]);this.scene._removeComponent(this),this._attached={},this._attachments=null,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._events=null,this._eventCallDepth=0,this._ownedComponents=null,this._updateScheduled=!1}}const E=1,F=4,R=8,S=16,O=32,B=256,L=512,N=1024,k=2048,j=new Float32Array([0,0,0]),G=new Uint16Array([0,0,0]);class H{constructor(e,t,s,i,r,o){this._isObject=t,this.scene=e.scene,this.model=e,this.meshes=i,this._numTriangles=0;for(var n=0,a=this.meshes.length;n<a;n++){const e=this.meshes[n];e.parent=this,this._numTriangles+=e.numTriangles}this.id=s,this.originalSystemId=p.unglobalizeObjectId(e.id,s),this._flags=r,this._aabb=o,this._offsetAABB=p.AABB3(o),this._offset=p.vec3(),this._colorizeUpdated=!1,this._opacityUpdated=!1,this._culled=!1,this._culledVFC=!1,this._culledLOD=!1,this._isObject&&e.scene._registerObject(this)}get isEntity(){return!0}get isModel(){return!1}get isObject(){return this._isObject}get aabb(){return this._offsetAABB}get numTriangles(){return this._numTriangles}get visible(){return this._getFlag(E)}set visible(e){if(!!(this._flags&E)!==e){this._flags=e?this._flags|E:this._flags&~E;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setVisible(this._flags);this._isObject&&this.model.scene._objectVisibilityUpdated(this),this.model.glRedraw()}}get highlighted(){return this._getFlag(L)}set highlighted(e){if(!!(this._flags&L)!==e){this._flags=e?this._flags|L:this._flags&~L;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setHighlighted(this._flags);this._isObject&&this.model.scene._objectHighlightedUpdated(this),this.model.glRedraw()}}get xrayed(){return this._getFlag(B)}set xrayed(e){if(!!(this._flags&B)!==e){this._flags=e?this._flags|B:this._flags&~B;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setXRayed(this._flags);this._isObject&&this.model.scene._objectXRayedUpdated(this),this.model.glRedraw()}}get selected(){return this._getFlag(N)}set selected(e){if(!!(this._flags&N)!==e){this._flags=e?this._flags|N:this._flags&~N;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setSelected(this._flags);this._isObject&&this.model.scene._objectSelectedUpdated(this),this.model.glRedraw()}}get edges(){return this._getFlag(k)}set edges(e){if(!!(this._flags&k)!==e){this._flags=e?this._flags|k:this._flags&~k;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setEdges(this._flags);this.model.glRedraw()}}get culledVFC(){return!!this._culledVFC}set culledVFC(e){this._culledVFC=e,this.internalSetCulled()}get culledLOD(){return!!this._culledLOD}set culledLOD(e){this._culledLOD=e,this.internalSetCulled()}get culled(){return!!this._culled}set culled(e){this._culled=e,this.internalSetCulled()}internalSetCulled(){let e=!!this._culled||!!this._culledLOD||!!this._culledVFC;if(!!(this._flags&F)!==e){this._flags=e?this._flags|F:this._flags&~F;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setCulled(this._flags);this.model.glRedraw()}}get clippable(){return this._getFlag(S)}set clippable(e){if(!!(this._flags&S)!==e){this._flags=e?this._flags|S:this._flags&~S;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setClippable(this._flags);this.model.glRedraw()}}get collidable(){return this._getFlag(O)}set collidable(e){if(!!(this._flags&O)!==e){this._flags=e?this._flags|O:this._flags&~O;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setCollidable(this._flags)}}get pickable(){return this._getFlag(R)}set pickable(e){if(!!(this._flags&R)!==e){this._flags=e?this._flags|R:this._flags&~R;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setPickable(this._flags)}}get colorize(){if(0===this.meshes.length)return null;const e=this.meshes[0]._colorize;return j[0]=e[0]/255,j[1]=e[1]/255,j[2]=e[2]/255,j}set colorize(e){if(e){G[0]=Math.floor(255*e[0]),G[1]=Math.floor(255*e[1]),G[2]=Math.floor(255*e[2]);for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setColorize(G)}else for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setColorize(null);if(this._isObject){const t=!!e;this.scene._objectColorizeUpdated(this,t),this._colorizeUpdated=t}this.model.glRedraw()}get opacity(){return this.meshes.length>0?this.meshes[0]._colorize[3]/255:1}set opacity(e){if(0===this.meshes.length)return;const t=null!=e,s=this.meshes[0]._colorize[3];let i=255;if(t){if(e<0?e=0:e>1&&(e=1),i=Math.floor(255*e),s===i)return}else if(i=255,s===i)return;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setOpacity(i,this._flags);this._isObject&&(this.scene._objectOpacityUpdated(this,t),this._opacityUpdated=t),this.model.glRedraw()}get offset(){return this._offset}set offset(e){e?(this._offset[0]=e[0],this._offset[1]=e[1],this._offset[2]=e[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setOffset(this._offset);this._offsetAABB[0]=this._aabb[0]+this._offset[0],this._offsetAABB[1]=this._aabb[1]+this._offset[1],this._offsetAABB[2]=this._aabb[2]+this._offset[2],this._offsetAABB[3]=this._aabb[3]+this._offset[0],this._offsetAABB[4]=this._aabb[4]+this._offset[1],this._offsetAABB[5]=this._aabb[5]+this._offset[2],this.scene._aabbDirty=!0,this.scene._objectOffsetUpdated(this,e),this.model._aabbDirty=!0,this.model.glRedraw()}get castsShadow(){return!1}set castsShadow(e){}get receivesShadow(){return!1}set receivesShadow(e){}get saoEnabled(){return this.model.saoEnabled}_getFlag(e){return!!(this._flags&e)}_finalize(){const e=this.model.scene;this._isObject&&(this.visible&&e._objectVisibilityUpdated(this),this.highlighted&&e._objectHighlightedUpdated(this),this.xrayed&&e._objectXRayedUpdated(this),this.selected&&e._objectSelectedUpdated(this));for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._finalize(this._flags)}_finalize2(){for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._finalize2()}_destroy(){const e=this.model.scene;this._isObject&&(e._deregisterObject(this),this.visible&&e._objectVisibilityUpdated(this,!1),this.xrayed&&e._objectXRayedUpdated(this),this.selected&&e._objectSelectedUpdated(this),this.highlighted&&e._objectHighlightedUpdated(this),this._opacityUpdated&&this.scene._objectColorizeUpdated(this,!1),this._opacityUpdated&&this.scene._objectOpacityUpdated(this,!1),this.scene._objectOffsetUpdated(this,!1));for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._destroy();e._aabbDirty=!0}}const V=p.vec3(),U=function(){const e=new Float64Array(16),t=new Float64Array(4),s=new Float64Array(4);return function(i,r,o){return o=o||e,t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=1,p.transformVec4(i,t,s),p.setMat4Translation(i,s,o),o.slice()}}();function z(e,t,s){const i=Float32Array.from([e[0]])[0],r=e[0]-i,o=Float32Array.from([e[1]])[0],n=e[1]-o,a=Float32Array.from([e[2]])[0],h=e[2]-a;t[0]=i,t[1]=o,t[2]=a,s[0]=r,s[1]=n,s[2]=h}function W(e,t,s,i=1e3){const r=p.getPositionsCenter(e,V),o=Math.round(r[0]/i)*i,n=Math.round(r[1]/i)*i,a=Math.round(r[2]/i)*i;s[0]=o,s[1]=n,s[2]=a;const h=0!==s[0]||0!==s[1]||0!==s[2];if(h)for(let s=0,i=e.length;s<i;s+=3)t[s+0]=e[s+0]-o,t[s+1]=e[s+1]-n,t[s+2]=e[s+2]-a;return h}function X(e,t,s,i){const r=p.dotVec3(t,s)+e,o=p.normalizeVec3(t,V);return p.mulVec3Scalar(o,-r,i),i}const Y=p.vec4(),K=p.vec4();class J extends A{constructor(e,t){super(e,t),this._entity=null,this._visible=null,this._worldPos=p.vec3(),this._origin=p.vec3(),this._rtcPos=p.vec3(),this._viewPos=p.vec3(),this._canvasPos=p.vec2(),this._occludable=!1,this._onCameraViewMatrix=this.scene.camera.on("matrix",(()=>{this._viewPosDirty=!0,this._needUpdate()})),this._onCameraProjMatrix=this.scene.camera.on("projMatrix",(()=>{this._canvasPosDirty=!0,this._needUpdate()})),this._onEntityDestroyed=null,this._onEntityModelDestroyed=null,this._renderer.addMarker(this),this.entity=t.entity,this.worldPos=t.worldPos,this.occludable=t.occludable}_update(){if(this._viewPosDirty&&(p.transformPoint3(this.scene.camera.viewMatrix,this._worldPos,this._viewPos),this._viewPosDirty=!1,this._canvasPosDirty=!0,this.fire("viewPos",this._viewPos)),this._canvasPosDirty){Y.set(this._viewPos),Y[3]=1,p.transformPoint4(this.scene.camera.projMatrix,Y,K);const e=this.scene.canvas.boundary;this._canvasPos[0]=Math.floor((1+K[0]/K[3])*e[2]/2),this._canvasPos[1]=Math.floor((1-K[1]/K[3])*e[3]/2),this._canvasPosDirty=!1,this.fire("canvasPos",this._canvasPos)}}_setVisible(e){this._visible,this._visible=e,this.fire("visible",this._visible)}set entity(e){if(this._entity){if(this._entity===e)return;null!==this._onEntityDestroyed&&(this._entity.off(this._onEntityDestroyed),this._onEntityDestroyed=null),null!==this._onEntityModelDestroyed&&(this._entity.model.off(this._onEntityModelDestroyed),this._onEntityModelDestroyed=null)}this._entity=e,this._entity&&(this._entity instanceof H?this._onEntityModelDestroyed=this._entity.model.on("destroyed",(()=>{this._entity=null,this._onEntityModelDestroyed=null})):this._onEntityDestroyed=this._entity.on("destroyed",(()=>{this._entity=null,this._onEntityDestroyed=null}))),this.fire("entity",this._entity,!0)}get entity(){return this._entity}set occludable(e){(e=!!e)!==this._occludable&&(this._occludable=e)}get occludable(){return this._occludable}set worldPos(e){this._worldPos.set(e||[0,0,0]),z(this._worldPos,this._origin,this._rtcPos),this._occludable&&this._renderer.markerWorldPosUpdated(this),this._viewPosDirty=!0,this.fire("worldPos",this._worldPos),this._needUpdate()}get worldPos(){return this._worldPos}get origin(){return this._origin}get rtcPos(){return this._rtcPos}get viewPos(){return this._update(),this._viewPos}get canvasPos(){return this._update(),this._canvasPos}get visible(){return!!this._visible}destroy(){this.fire("destroyed",!0),this.scene.camera.off(this._onCameraViewMatrix),this.scene.camera.off(this._onCameraProjMatrix),this._entity&&(null!==this._onEntityDestroyed&&this._entity.off(this._onEntityDestroyed),null!==this._onEntityModelDestroyed&&this._entity.model.off(this._onEntityModelDestroyed)),this._renderer.removeMarker(this),super.destroy()}}class Z{constructor(e,t={}){this._color=t.color||"black",this._highlightClass="viewer-ruler-wire-highlighted",this._wire=document.createElement("div"),this._wire.className+=this._wire.className?" viewer-ruler-wire":"viewer-ruler-wire",this._wireClickable=document.createElement("div"),this._wireClickable.className+=this._wireClickable.className?" viewer-ruler-wire-clickable":"viewer-ruler-wire-clickable",this._thickness=t.thickness||1,this._thicknessClickable=t.thicknessClickable||6;var s=this._wire,i=s.style;i.border="solid "+this._thickness+"px "+this._color,i.position="absolute",i["z-index"]=void 0===t.zIndex?"2000001":t.zIndex,i.width="0px",i.height="0px",i.visibility="visible",i.top="0px",i.left="0px",i["-webkit-transform-origin"]="0 0",i["-moz-transform-origin"]="0 0",i["-ms-transform-origin"]="0 0",i["-o-transform-origin"]="0 0",i["transform-origin"]="0 0",i["-webkit-transform"]="rotate(0deg)",i["-moz-transform"]="rotate(0deg)",i["-ms-transform"]="rotate(0deg)",i["-o-transform"]="rotate(0deg)",i.transform="rotate(0deg)",i.opacity=1,i["pointer-events"]="none",t.onContextMenu,e.appendChild(s);var r=this._wireClickable,o=r.style;o.border="solid "+this._thicknessClickable+"px "+this._color,o.position="absolute",o["z-index"]=void 0===t.zIndex?"2000002":t.zIndex+1,o.width="0px",o.height="0px",o.visibility="visible",o.top="0px",o.left="0px",o["-webkit-transform-origin"]="0 0",o["-moz-transform-origin"]="0 0",o["-ms-transform-origin"]="0 0",o["-o-transform-origin"]="0 0",o["transform-origin"]="0 0",o["-webkit-transform"]="rotate(0deg)",o["-moz-transform"]="rotate(0deg)",o["-ms-transform"]="rotate(0deg)",o["-o-transform"]="rotate(0deg)",o.transform="rotate(0deg)",o.opacity=0,o["pointer-events"]="none",t.onContextMenu,e.appendChild(r),t.onMouseOver&&r.addEventListener("mouseover",(e=>{t.onMouseOver(e,this)})),t.onMouseLeave&&r.addEventListener("mouseleave",(e=>{t.onMouseLeave(e,this)})),t.onMouseWheel&&r.addEventListener("wheel",(e=>{t.onMouseWheel(e,this)})),t.onContextMenu&&r.addEventListener("contextmenu",(e=>{t.onContextMenu(e,this),e.preventDefault()})),this._x1=0,this._y1=0,this._x2=0,this._y2=0,this._update()}get _visible(){return"visible"===this._wire.style.visibility}_update(){var e=Math.abs(Math.sqrt((this._x1-this._x2)*(this._x1-this._x2)+(this._y1-this._y2)*(this._y1-this._y2))),t=180*Math.atan2(this._y2-this._y1,this._x2-this._x1)/Math.PI,s=this._wire.style;s.width=Math.round(e)+"px",s.left=Math.round(this._x1)+"px",s.top=Math.round(this._y1)+"px",s["-webkit-transform"]="rotate("+t+"deg)",s["-moz-transform"]="rotate("+t+"deg)",s["-ms-transform"]="rotate("+t+"deg)",s["-o-transform"]="rotate("+t+"deg)",s.transform="rotate("+t+"deg)";var i=this._wireClickable.style;i.width=Math.round(e)+"px",i.left=Math.round(this._x1)+"px",i.top=Math.round(this._y1)+"px",i["-webkit-transform"]="rotate("+t+"deg)",i["-moz-transform"]="rotate("+t+"deg)",i["-ms-transform"]="rotate("+t+"deg)",i["-o-transform"]="rotate("+t+"deg)",i.transform="rotate("+t+"deg)"}setStartAndEnd(e,t,s,i){this._x1=e,this._y1=t,this._x2=s,this._y2=i,this._update()}setColor(e){this._color=e||"black",this._wire.style.border="solid "+this._thickness+"px "+this._color}setOpacity(e){this._wire.style.opacity=e}setVisible(e){e=!!e,this._visible!==e&&(this._wire.style.visibility=e?"visible":"hidden")}setClickable(e){this._wireClickable.style["pointer-events"]=e?"all":"none"}setHighlighted(e){this._highlighted!==e&&(this._highlighted=!!e,this._highlighted?this._wire.classList.add(this._highlightClass):this._wire.classList.remove(this._highlightClass))}destroy(e){this._wire.parentElement&&this._wire.parentElement.removeChild(this._wire),this._wireClickable.parentElement&&this._wireClickable.parentElement.removeChild(this._wireClickable)}}class Q{constructor(e,t={}){this._highlightClass="viewer-ruler-dot-highlighted",this._x=0,this._y=0,this._visible=!0,this._dot=document.createElement("div"),this._dot.className+=this._dot.className?" viewer-ruler-dot":"viewer-ruler-dot",this._dotClickable=document.createElement("div"),this._dotClickable.className+=this._dotClickable.className?" viewer-ruler-dot-clickable":"viewer-ruler-dot-clickable";var s=this._dot,i=s.style;i["border-radius"]="25px",i.border="solid 2px white",i.background="lightgreen",i.position="absolute",i["z-index"]=void 0===t.zIndex?"40000005":t.zIndex,i.width="8px",i.height="8px",i.visibility=!1!==t.visible?"visible":"hidden",i.top="0px",i.left="0px",i["box-shadow"]="0 2px 5px 0 #182A3D;",i.opacity=1,i["pointer-events"]="none",t.onContextMenu,e.appendChild(s);var r=this._dotClickable,o=r.style;o["border-radius"]="35px",o.border="solid 10px white",o.position="absolute",o["z-index"]=void 0===t.zIndex?"40000007":t.zIndex+1,o.width="8px",o.height="8px",o.visibility="visible",o.top="0px",o.left="0px",o.opacity=0,o["pointer-events"]="none",t.onContextMenu,e.appendChild(r),t.onMouseOver&&r.addEventListener("mouseover",(e=>{t.onMouseOver(e,this)})),t.onMouseLeave&&r.addEventListener("mouseleave",(e=>{t.onMouseLeave(e,this)})),t.onMouseWheel&&r.addEventListener("wheel",(e=>{t.onMouseWheel(e,this)})),t.onContextMenu&&r.addEventListener("contextmenu",(e=>{t.onContextMenu(e,this),e.preventDefault()})),this.setPos(t.x||0,t.y||0),this.setFillColor(t.fillColor),this.setBorderColor(t.borderColor)}setPos(e,t){this._x=e,this._y=t;var s=this._dot.style;s.left=Math.round(e)-4+"px",s.top=Math.round(t)-4+"px";var i=this._dotClickable.style;i.left=Math.round(e)-9+"px",i.top=Math.round(t)-9+"px"}setFillColor(e){this._dot.style.background=e||"lightgreen"}setBorderColor(e){this._dot.style.border="solid 2px"+(e||"black")}setOpacity(e){this._dot.style.opacity=e}setVisible(e){this._visible!==e&&(this._visible=!!e,this._dot.style.visibility=this._visible?"visible":"hidden")}setClickable(e){this._dotClickable.style["pointer-events"]=e?"all":"none"}setHighlighted(e){this._highlighted!==e&&(this._highlighted=!!e,this._highlighted?this._dot.classList.add(this._highlightClass):this._dot.classList.remove(this._highlightClass))}destroy(){this.setVisible(!1),this._dot.parentElement&&this._dot.parentElement.removeChild(this._dot),this._dotClickable.parentElement&&this._dotClickable.parentElement.removeChild(this._dotClickable)}}class q{constructor(e,t={}){this._highlightClass="viewer-ruler-label-highlighted",this._prefix=t.prefix||"",this._x=0,this._y=0,this._visible=!0,this._culled=!1,this._label=document.createElement("div"),this._label.className+=this._label.className?" viewer-ruler-label":"viewer-ruler-label";var s=this._label,i=s.style;i["border-radius"]="5px",i.color="white",i.padding="4px",i.border="solid 1px",i.background="lightgreen",i.position="absolute",i["z-index"]=void 0===t.zIndex?"5000005":t.zIndex,i.width="auto",i.height="auto",i.visibility="visible",i.top="0px",i.left="0px",i["pointer-events"]="all",i.opacity=1,t.onContextMenu,s.innerText="",e.appendChild(s),this.setPos(t.x||0,t.y||0),this.setFillColor(t.fillColor),this.setBorderColor(t.fillColor),this.setText(t.text),t.onMouseOver&&s.addEventListener("mouseover",(e=>{t.onMouseOver(e,this),e.preventDefault()})),t.onMouseLeave&&s.addEventListener("mouseleave",(e=>{t.onMouseLeave(e,this),e.preventDefault()})),t.onMouseWheel&&s.addEventListener("wheel",(e=>{t.onMouseWheel(e,this)})),t.onContextMenu&&s.addEventListener("contextmenu",(e=>{t.onContextMenu(e,this),e.preventDefault()}))}setPos(e,t){this._x=e,this._y=t;var s=this._label.style;s.left=Math.round(e)-20+"px",s.top=Math.round(t)-12+"px"}setPosOnWire(e,t,s,i){var r=e+.5*(s-e),o=t+.5*(i-t),n=this._label.style;n.left=Math.round(r)-20+"px",n.top=Math.round(o)-12+"px"}setPosBetweenWires(e,t,s,i,r,o){var n=(e+s+r)/3,a=(t+i+o)/3,h=this._label.style;h.left=Math.round(n)-20+"px",h.top=Math.round(a)-12+"px"}setText(e){this._label.innerHTML=this._prefix+(e||"")}setFillColor(e){this._fillColor=e||"lightgreen",this._label.style.background=this._fillColor}setBorderColor(e){this._borderColor=e||"black",this._label.style.border="solid 1px "+this._borderColor}setOpacity(e){this._label.style.opacity=e}setVisible(e){this._visible!==e&&(this._visible=!!e,this._label.style.visibility=this._visible&&!this._culled?"visible":"hidden")}setCulled(e){this._culled!==e&&(this._culled=!!e,this._label.style.visibility=this._visible&&!this._culled?"visible":"hidden")}setHighlighted(e){this._highlighted!==e&&(this._highlighted=!!e,this._highlighted?this._label.classList.add(this._highlightClass):this._label.classList.remove(this._highlightClass))}setClickable(e){this._label.style["pointer-events"]=e?"all":"none"}destroy(){this._label.parentElement&&this._label.parentElement.removeChild(this._label)}}var $=p.vec3(),ee=p.vec3();class te extends A{constructor(e,t={}){if(super(e.viewer.scene,t),this.plugin=e,this._container=t.container,!this._container)throw"config missing: container";this._color=t.color||e.defaultColor;var s=this.plugin.viewer.scene;this._originMarker=new J(s,t.origin),this._cornerMarker=new J(s,t.corner),this._targetMarker=new J(s,t.target),this._originWorld=p.vec3(),this._cornerWorld=p.vec3(),this._targetWorld=p.vec3(),this._wp=new Float64Array(12),this._vp=new Float64Array(12),this._pp=new Float64Array(12),this._cp=new Int16Array(6);const i=t.onMouseOver?e=>{t.onMouseOver(e,this)}:null,r=t.onMouseLeave?e=>{t.onMouseLeave(e,this)}:null,o=t.onContextMenu?e=>{t.onContextMenu(e,this)}:null,n=e=>{this.plugin.viewer.scene.canvas.canvas.dispatchEvent(new WheelEvent("wheel",e))};this._originDot=new Q(this._container,{fillColor:this._color,zIndex:void 0!==e.zIndex?e.zIndex+2:void 0,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._cornerDot=new Q(this._container,{fillColor:this._color,zIndex:void 0!==e.zIndex?e.zIndex+2:void 0,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._targetDot=new Q(this._container,{fillColor:this._color,zIndex:void 0!==e.zIndex?e.zIndex+2:void 0,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._originWire=new Z(this._container,{color:this._color||"blue",thickness:1,zIndex:e.zIndex,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._targetWire=new Z(this._container,{color:this._color||"red",thickness:1,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._angleLabel=new q(this._container,{fillColor:this._color||"#00BBFF",prefix:"",text:"",zIndex:e.zIndex+2,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._wpDirty=!1,this._vpDirty=!1,this._cpDirty=!1,this._visible=!1,this._originVisible=!1,this._cornerVisible=!1,this._targetVisible=!1,this._originWireVisible=!1,this._targetWireVisible=!1,this._angleVisible=!1,this._labelsVisible=!1,this._clickable=!1,this._originMarker.on("worldPos",(e=>{this._originWorld.set(e||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._cornerMarker.on("worldPos",(e=>{this._cornerWorld.set(e||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._targetMarker.on("worldPos",(e=>{this._targetWorld.set(e||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._onViewMatrix=s.camera.on("viewMatrix",(()=>{this._vpDirty=!0,this._needUpdate(0)})),this._onProjMatrix=s.camera.on("projMatrix",(()=>{this._cpDirty=!0,this._needUpdate()})),this._onCanvasBoundary=s.canvas.on("boundary",(()=>{this._cpDirty=!0,this._needUpdate(0)})),this.approximate=t.approximate,this.visible=t.visible,this.originVisible=t.originVisible,this.cornerVisible=t.cornerVisible,this.targetVisible=t.targetVisible,this.originWireVisible=t.originWireVisible,this.targetWireVisible=t.targetWireVisible,this.angleVisible=t.angleVisible,this.labelsVisible=t.labelsVisible}_update(){if(!this._visible)return;const e=this.plugin.viewer.scene;if(this._wpDirty&&(this._wp[0]=this._originWorld[0],this._wp[1]=this._originWorld[1],this._wp[2]=this._originWorld[2],this._wp[3]=1,this._wp[4]=this._cornerWorld[0],this._wp[5]=this._cornerWorld[1],this._wp[6]=this._cornerWorld[2],this._wp[7]=1,this._wp[8]=this._targetWorld[0],this._wp[9]=this._targetWorld[1],this._wp[10]=this._targetWorld[2],this._wp[11]=1,this._wpDirty=!1,this._vpDirty=!0),this._vpDirty&&(p.transformPositions4(e.camera.viewMatrix,this._wp,this._vp),this._vp[3]=1,this._vp[7]=1,this._vp[11]=1,this._vpDirty=!1,this._cpDirty=!0),this._cpDirty){const d=-.3,m=this._originMarker.viewPos[2],f=this._cornerMarker.viewPos[2],g=this._targetMarker.viewPos[2];if(m>d||f>d||g>d)return this._originDot.setVisible(!1),this._cornerDot.setVisible(!1),this._targetDot.setVisible(!1),this._originWire.setVisible(!1),this._targetWire.setVisible(!1),void this._angleLabel.setCulled(!0);p.transformPositions4(e.camera.project.matrix,this._vp,this._pp);var t=this._pp,s=this._cp,i=e.canvas.canvas.getBoundingClientRect();const _=this._container.getBoundingClientRect();for(var r=i.top-_.top,o=i.left-_.left,n=e.canvas.boundary,a=n[2],h=n[3],l=0,u=0,c=t.length;u<c;u+=4)s[l]=o+Math.floor((1+t[u+0]/t[u+3])*a/2),s[l+1]=r+Math.floor((1-t[u+1]/t[u+3])*h/2),l+=2;if(this._originDot.setPos(s[0],s[1]),this._cornerDot.setPos(s[2],s[3]),this._targetDot.setPos(s[4],s[5]),this._originWire.setStartAndEnd(s[0],s[1],s[2],s[3]),this._targetWire.setStartAndEnd(s[2],s[3],s[4],s[5]),this._angleLabel.setPosBetweenWires(s[0],s[1],s[2],s[3],s[4],s[5]),p.subVec3(this._originWorld,this._cornerWorld,$),p.subVec3(this._targetWorld,this._cornerWorld,ee),!(0===$[0]&&0===$[1]&&0===$[2]||0===ee[0]&&0===ee[1]&&0===ee[2])){const e=this._approximate?" ~ ":" = ";p.normalizeVec3($),p.normalizeVec3(ee);const t=Math.abs(p.angleVec3($,ee));this._angle=t/p.DEGTORAD,this._angleLabel.setText(e+this._angle.toFixed(2)+"°")}else this._angleLabel.setText("");this._originDot.setVisible(this._visible&&this._originVisible),this._cornerDot.setVisible(this._visible&&this._cornerVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._originWire.setVisible(this._visible&&this._originWireVisible),this._targetWire.setVisible(this._visible&&this._targetWireVisible),this._angleLabel.setCulled(!(this._visible&&this._angleVisible&&this.labelsVisible)),this._cpDirty=!1}}set approximate(e){e=!1!==e,this._approximate!==e&&(this._approximate=e,this._cpDirty=!0,this._needUpdate(0))}get approximate(){return this._approximate}get origin(){return this._originMarker}get corner(){return this._cornerMarker}get target(){return this._targetMarker}get angle(){return this._update(),this._angle}get color(){return this._color}set color(e){this._originDot.setFillColor(e),this._cornerDot.setFillColor(e),this._targetDot.setFillColor(e),this._originWire.setColor(e||"blue"),this._targetWire.setColor(e||"red"),this._angleLabel.setFillColor(e||"#00BBFF"),this._color=e}set visible(e){e=!1!==e,this._visible=e,this._originDot.setVisible(this._visible&&this._originVisible),this._cornerDot.setVisible(this._visible&&this._cornerVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._originWire.setVisible(this._visible&&this._originWireVisible),this._targetWire.setVisible(this._visible&&this._targetWireVisible),this._angleLabel.setVisible(this._visible&&this._angleVisible),this._cpDirty=!0,this._needUpdate()}get visible(){return this._visible}set originVisible(e){e=!1!==e,this._originVisible=e,this._originDot.setVisible(this._visible&&this._originVisible),this._cpDirty=!0,this._needUpdate()}get originVisible(){return this._originVisible}set cornerVisible(e){e=!1!==e,this._cornerVisible=e,this._cornerDot.setVisible(this._visible&&this._cornerVisible),this._cpDirty=!0,this._needUpdate()}get cornerVisible(){return this._cornerVisible}set targetVisible(e){e=!1!==e,this._targetVisible=e,this._targetDot.setVisible(this._visible&&this._targetVisible),this._cpDirty=!0,this._needUpdate()}get targetVisible(){return this._targetVisible}set originWireVisible(e){e=!1!==e,this._originWireVisible=e,this._originWire.setVisible(this._visible&&this._originWireVisible),this._cpDirty=!0,this._needUpdate()}get originWireVisible(){return this._originWireVisible}set targetWireVisible(e){e=!1!==e,this._targetWireVisible=e,this._targetWire.setVisible(this._visible&&this._targetWireVisible),this._cpDirty=!0,this._needUpdate()}get targetWireVisible(){return this._targetWireVisible}set angleVisible(e){e=!1!==e,this._angleVisible=e,this._angleLabel.setVisible(this._visible&&this._angleVisible),this._cpDirty=!0,this._needUpdate()}get angleVisible(){return this._angleVisible}set labelsVisible(e){e=void 0!==e?Boolean(e):this.plugin.defaultLabelsVisible,this._labelsVisible=e;var t=this._visible&&this._labelsVisible;this._angleLabel.setVisible(t),this._cpDirty=!0,this._needUpdate()}get labelsVisible(){return this._labelsVisible}setHighlighted(e){this._originDot.setHighlighted(e),this._cornerDot.setHighlighted(e),this._targetDot.setHighlighted(e),this._originWire.setHighlighted(e),this._targetWire.setHighlighted(e),this._angleLabel.setHighlighted(e)}set clickable(e){e=!!e,this._clickable=e,this._originDot.setClickable(this._clickable),this._cornerDot.setClickable(this._clickable),this._targetDot.setClickable(this._clickable),this._originWire.setClickable(this._clickable),this._targetWire.setClickable(this._clickable),this._angleLabel.setClickable(this._clickable)}get clickable(){return this._clickable}destroy(){const e=this.plugin.viewer.scene;this._onViewMatrix&&e.camera.off(this._onViewMatrix),this._onProjMatrix&&e.camera.off(this._onProjMatrix),this._onCanvasBoundary&&e.canvas.off(this._onCanvasBoundary),this._originDot.destroy(),this._cornerDot.destroy(),this._targetDot.destroy(),this._originWire.destroy(),this._targetWire.destroy(),this._angleLabel.destroy(),super.destroy()}}class se extends A{constructor(e){super(e.viewer.scene),this.plugin=e,this._active=!1,this._state=0,this._currentAngleMeasurement=null,this._onMouseHoverSurface=null,this._onHoverNothing=null,this._onMouseHoverOff=null,this._onPickedNothing=null,this._onPickedSurface=null,this._onInputMouseDown=null,this._onInputMouseUp=null,this._onCanvasTouchStart=null,this._onCanvasTouchEnd=null}get active(){return this._active}activate(){if(this._active)return;const e=this.plugin,t=this.scene,s=e.viewer.cameraControl,i=t.canvas.canvas,r=t.input,o=t.pickSurfacePrecisionEnabled;let n=!1,a=null,h=p.vec3();const l=p.vec2();let u,c;const d=p.vec2(),m=p.vec2();p.vec3(),this._onMouseHoverSurface=s.on("hoverSurface",(e=>{if(n=!0,a=e.entity,h.set(e.worldPos),l.set(e.canvasPos),this._currentAngleMeasurement)switch(this._state){case 1:this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.cornerVisible=!0,this._currentAngleMeasurement.angleVisible=!1,this._currentAngleMeasurement.corner.entity=e.entity,this._currentAngleMeasurement.corner.worldPos=e.worldPos,i.style.cursor="pointer";break;case 2:this._currentAngleMeasurement.targetWireVisible=!0,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this._currentAngleMeasurement.target.entity=e.entity,this._currentAngleMeasurement.target.worldPos=e.worldPos,i.style.cursor="pointer"}})),this._onInputMouseDown=r.on("mousedown",(e=>{u=e[0],c=e[1]})),this._onInputMouseUp=r.on("mouseup",(e=>{if(!(e[0]>u+5||e[0]<u-5||e[1]>c+5||e[1]<c-5))switch(this._state){case 0:if(n){if(o){const e=t.pick({canvasPos:l,pickSurface:!0,pickSurfacePrecision:o});e&&e.worldPos&&worldPos.set(e.worldPos)}this._currentAngleMeasurement=this.plugin.createMeasurement({id:p.createUUID(),origin:{entity:a,worldPos:h},corner:{entity:a,worldPos:h},target:{entity:a,worldPos:h},approximate:!0}),this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.angleVisible=!1,this._state=1,this.fire("measurementStart",this._currentAngleMeasurement)}break;case 1:if(n){if(o){const e=t.pick({canvasPos:l,pickSurface:!0,pickSurfacePrecision:!0});e&&e.worldPos&&(this._currentAngleMeasurement.corner.worldPos=e.worldPos)}this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this._state=2}else this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null,this._state=0,this.fire("measurementCancel",this._currentAngleMeasurement));break;case 2:if(n){if(o){const e=t.pick({canvasPos:l,pickSurface:!0,pickSurfacePrecision:!0});e&&e.worldPos&&(this._currentAngleMeasurement.target.worldPos=e.worldPos,this._currentAngleMeasurement.approximate=!1)}this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this.fire("measurementEnd",this._currentAngleMeasurement),this._currentAngleMeasurement=null,this._state=0}else this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null,this._state=0,this.fire("measurementCancel",this._currentAngleMeasurement))}})),this._onHoverNothing=s.on("hoverOff",(e=>{if(n=!1,this._currentAngleMeasurement){switch(this._state){case 0:this._currentAngleMeasurement.originVisible=!1;break;case 1:this._currentAngleMeasurement.cornerVisible=!1,this._currentAngleMeasurement.originWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1;break;case 2:this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1}i.style.cursor="default"}})),i.addEventListener("touchstart",this._onCanvasTouchStart=e=>{const t=e.touches,s=e.changedTouches;1===t.length&&1===s.length&&ie(t[0],d)},{passive:!0}),i.addEventListener("touchend",this._onCanvasTouchEnd=e=>{const s=e.touches,i=e.changedTouches;if(0===s.length&&1===i.length){if(ie(i[0],m),m[0]>d[0]+5||m[0]<d[0]-5||m[1]>d[1]+5||m[1]<d[1]-5)return;const e=t.pick({canvasPos:m,pickSurface:!0,pickSurfacePrecision:!1});if(e&&e.worldPos)switch(this._state){case 0:this._currentAngleMeasurement=this.plugin.createMeasurement({id:p.createUUID(),origin:{entity:e.entity,worldPos:e.worldPos},corner:{entity:e.entity,worldPos:e.worldPos},target:{entity:e.entity,worldPos:e.worldPos},approximate:!0}),this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.angleVisible=!1,this._currentAngleMeasurement.clickable=!1,this._state=1,this.fire("measurementStart",this._currentAngleMeasurement);break;case 1:this._currentAngleMeasurement.corner.worldPos=e.worldPos,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this._state=2;break;case 2:this._currentAngleMeasurement.target.worldPos=e.worldPos,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this._currentAngleMeasurement.clickable=!0,this.fire("measurementEnd",this._currentAngleMeasurement),this._currentAngleMeasurement=null,this._state=0}else this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null,this._state=0,this.fire("measurementCancel",this._currentAngleMeasurement))}},{passive:!0}),this._active=!0}deactivate(){if(!this._active)return;this.reset();const e=this.plugin.viewer.scene.input,t=this.plugin.viewer.cameraControl,s=this.plugin.viewer.scene.canvas.canvas;e.off(this._onInputMouseDown),e.off(this._onInputMouseUp),t.off(this._onMouseHoverSurface),t.off(this._onPickedSurface),t.off(this._onHoverNothing),t.off(this._onPickedNothing),s.removeEventListener("touchstart",this._onCanvasTouchStart),s.removeEventListener("touchend",this._onCanvasTouchEnd),this._currentAngleMeasurement=null,this._active=!1}reset(){this._active&&(this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null),this._state=0)}destroy(){this.deactivate(),super.destroy()}}const ie=function(e,t){if(e){let s=e.target,i=0,r=0;for(;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;t[0]=e.pageX-i,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t};class re extends n{constructor(e,t={}){super("AngleMeasurements",e),this._container=t.container||document.body,this._control=new se(this),this._measurements={},this.defaultColor=void 0!==t.defaultColor?t.defaultColor:"#00BBFF",this.defaultLabelsVisible=!1!==t.defaultLabelsVisible,this.zIndex=t.zIndex||1e4,this._onMouseOver=(e,t)=>{this.fire("mouseOver",{plugin:this,angleMeasurement:t,measurement:t,event:e})},this._onMouseLeave=(e,t)=>{this.fire("mouseLeave",{plugin:this,angleMeasurement:t,measurement:t,event:e})},this._onContextMenu=(e,t)=>{this.fire("contextMenu",{plugin:this,angleMeasurement:t,measurement:t,event:e})}}send(e,t){}get control(){return this._control}get measurements(){return this._measurements}createMeasurement(e={}){this.viewer.scene.components[e.id]&&(this.error("Viewer scene component with this ID already exists: "+e.id),delete e.id);const t=e.origin,s=e.corner,i=e.target,r=new te(this,{id:e.id,plugin:this,container:this._container,origin:{entity:t.entity,worldPos:t.worldPos},corner:{entity:s.entity,worldPos:s.worldPos},target:{entity:i.entity,worldPos:i.worldPos},visible:e.visible,originVisible:!0,originWireVisible:!0,cornerVisible:!0,targetWireVisible:!0,targetVisible:!0,onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave,onContextMenu:this._onContextMenu});return this._measurements[r.id]=r,r.on("destroyed",(()=>{delete this._measurements[r.id]})),this.fire("measurementCreated",r),r}destroyMeasurement(e){const t=this._measurements[e];t?(t.destroy(),this.fire("measurementDestroyed",t)):this.log("AngleMeasurement not found: "+e)}setLabelsShown(e){for(const[t,s]of Object.entries(this.measurements))s.labelShown=e}clear(){const e=Object.keys(this._measurements);for(var t=0,s=e.length;t<s;t++)this.destroyMeasurement(e[t])}destroy(){this.clear(),super.destroy()}}class oe extends J{constructor(e,t){if(super(e,t),this.plugin=t.plugin,this._container=t.container,!this._container)throw"config missing: container";if(!t.markerElement&&!t.markerHTML)throw"config missing: need either markerElement or markerHTML";if(!t.labelElement&&!t.labelHTML)throw"config missing: need either labelElement or labelHTML";this._htmlDirty=!1,t.markerElement?(this._marker=t.markerElement,this._marker.addEventListener("click",this._onMouseClickedExternalMarker=()=>{this.plugin.fire("markerClicked",this)}),this._marker.addEventListener("mouseenter",this._onMouseEnterExternalMarker=()=>{this.plugin.fire("markerMouseEnter",this)}),this._marker.addEventListener("mouseleave",this._onMouseLeaveExternalMarker=()=>{this.plugin.fire("markerMouseLeave",this)}),this._markerExternal=!0):(this._markerHTML=t.markerHTML,this._htmlDirty=!0,this._markerExternal=!1),t.labelElement?(this._label=t.labelElement,this._labelExternal=!0):(this._labelHTML=t.labelHTML,this._htmlDirty=!0,this._labelExternal=!1),this._markerShown=!!t.markerShown,this._labelShown=!!t.labelShown,this._values=t.values||{},this._layoutDirty=!0,this._visibilityDirty=!0,this._buildHTML(),this._onTick=this.scene.on("tick",(()=>{this._htmlDirty&&(this._buildHTML(),this._htmlDirty=!1,this._layoutDirty=!0,this._visibilityDirty=!0),(this._layoutDirty||this._visibilityDirty)&&(this._markerShown||this._labelShown)&&(this._updatePosition(),this._layoutDirty=!1),this._visibilityDirty&&(this._marker.style.visibility=this.visible&&this._markerShown?"visible":"hidden",this._label.style.visibility=this.visible&&this._markerShown&&this._labelShown?"visible":"hidden",this._visibilityDirty=!1)})),this.on("canvasPos",(()=>{this._layoutDirty=!0})),this.on("visible",(()=>{this._visibilityDirty=!0})),this.setMarkerShown(!1!==t.markerShown),this.setLabelShown(t.labelShown),this.eye=t.eye?t.eye.slice():null,this.look=t.look?t.look.slice():null,this.up=t.up?t.up.slice():null,this.projection=t.projection}_buildHTML(){if(!this._markerExternal){this._marker&&(this._container.removeChild(this._marker),this._marker=null);let e=this._markerHTML||"<p></p>";y.isArray(e)&&(e=e.join("")),e=this._renderTemplate(e);const t=document.createRange().createContextualFragment(e);this._marker=t.firstChild,this._container.appendChild(this._marker),this._marker.style.visibility=this._markerShown?"visible":"hidden",this._marker.addEventListener("click",(()=>{this.plugin.fire("markerClicked",this)})),this._marker.addEventListener("mouseenter",(()=>{this.plugin.fire("markerMouseEnter",this)})),this._marker.addEventListener("mouseleave",(()=>{this.plugin.fire("markerMouseLeave",this)})),this._marker.addEventListener("wheel",(e=>{this.plugin.viewer.scene.canvas.canvas.dispatchEvent(new WheelEvent("wheel",e))}))}if(!this._labelExternal){this._label&&(this._container.removeChild(this._label),this._label=null);let e=this._labelHTML||"<p></p>";y.isArray(e)&&(e=e.join("")),e=this._renderTemplate(e);const t=document.createRange().createContextualFragment(e);this._label=t.firstChild,this._container.appendChild(this._label),this._label.style.visibility=this._markerShown&&this._labelShown?"visible":"hidden",this._label.addEventListener("wheel",(e=>{this.plugin.viewer.scene.canvas.canvas.dispatchEvent(new WheelEvent("wheel",e))}))}}_updatePosition(){const e=this.scene.canvas.boundary,t=e[0],s=e[1],i=this.canvasPos;this._marker.style.left=Math.floor(t+i[0])-12+"px",this._marker.style.top=Math.floor(s+i[1])-12+"px",this._marker.style["z-index"]=90005+Math.floor(this._viewPos[2])+1;this._label.style.left=20+Math.floor(t+i[0]+20)+"px",this._label.style.top=Math.floor(s+i[1]+-17)+"px",this._label.style["z-index"]=90005+Math.floor(this._viewPos[2])+1}_renderTemplate(e){for(var t in this._values)if(this._values.hasOwnProperty(t)){const s=this._values[t];e=e.replace(new RegExp("{{"+t+"}}","g"),s)}return e}setMarkerShown(e){e=!!e,this._markerShown!==e&&(this._markerShown=e,this._visibilityDirty=!0)}getMarkerShown(){return this._markerShown}setLabelShown(e){e=!!e,this._labelShown!==e&&(this._labelShown=e,this._visibilityDirty=!0)}getLabelShown(){return this._labelShown}setField(e,t){this._values[e]=t||"",this._htmlDirty=!0}getField(e){return this._values[e]}setValues(e){for(var t in e)if(e.hasOwnProperty(t)){const s=e[t];this.setField(t,s)}}getValues(){return this._values}destroy(){this._marker&&(this._markerExternal?(this._marker.removeEventListener("click",this._onMouseClickedExternalMarker),this._marker.removeEventListener("mouseenter",this._onMouseEnterExternalMarker),this._marker.removeEventListener("mouseleave",this._onMouseLeaveExternalMarker),this._marker=null):this._marker.parentNode.removeChild(this._marker)),this._label&&(this._labelExternal||this._label.parentNode.removeChild(this._label),this._label=null),this.scene.off(this._onTick),super.destroy()}}const ne=p.vec3(),ae=p.vec3(),he=p.vec3();class le extends n{constructor(e,t){super("Annotations",e),this._labelHTML=t.labelHTML||"<div></div>",this._markerHTML=t.markerHTML||"<div></div>",this._container=t.container||document.body,this._values=t.values||{},this.annotations={},this.surfaceOffset=t.surfaceOffset}send(e,t){if("clearAnnotations"===e)this.clear()}set surfaceOffset(e){null==e&&(e=.3),this._surfaceOffset=e}get surfaceOffset(){return this._surfaceOffset}createAnnotation(e){var t,s;if(this.viewer.scene.components[e.id]&&(this.error("Viewer component with this ID already exists: "+e.id),delete e.id),e.pickResult=e.pickResult||e.pickRecord,e.pickResult){const i=e.pickResult;if(i.worldPos&&i.worldNormal){const e=p.normalizeVec3(i.worldNormal,ne),r=p.mulVec3Scalar(e,this._surfaceOffset,ae);t=p.addVec3(i.worldPos,r,he),s=i.entity}else this.error("Param 'pickResult' does not have both worldPos and worldNormal")}else t=e.worldPos,s=e.entity;var i=null;e.markerElementId&&((i=document.getElementById(e.markerElementId))||this.error("Can't find DOM element for 'markerElementId' value '"+e.markerElementId+"' - defaulting to internally-generated empty DIV"));var r=null;e.labelElementId&&((r=document.getElementById(e.labelElementId))||this.error("Can't find DOM element for 'labelElementId' value '"+e.labelElementId+"' - defaulting to internally-generated empty DIV"));const o=new oe(this.viewer.scene,{id:e.id,plugin:this,entity:s,worldPos:t,container:this._container,markerElement:i,labelElement:r,markerHTML:e.markerHTML||this._markerHTML,labelHTML:e.labelHTML||this._labelHTML,occludable:e.occludable,values:y.apply(e.values,y.apply(this._values,{})),markerShown:e.markerShown,labelShown:e.labelShown,eye:e.eye,look:e.look,up:e.up,projection:e.projection,visible:!1!==e.visible});return this.annotations[o.id]=o,o.on("destroyed",(()=>{delete this.annotations[o.id],this.fire("annotationDestroyed",o.id)})),this.fire("annotationCreated",o.id),o}destroyAnnotation(e){var t=this.annotations[e];t?t.destroy():this.log("Annotation not found: "+e)}clear(){const e=Object.keys(this.annotations);for(var t=0,s=e.length;t<s;t++)this.destroyAnnotation(e[t])}destroy(){this.clear(),super.destroy()}}class ue extends A{get type(){return"Spinner"}constructor(e,t={}){super(e,t),this._canvas=t.canvas,this._element=null,this._isCustom=!1,t.elementId&&(this._element=document.getElementById(t.elementId),this._element?this._adjustPosition():this.error("Can't find given Spinner HTML element: '"+t.elementId+"' - will automatically create default element")),this._element||this._createDefaultSpinner(),this.processes=0}_createDefaultSpinner(){this._injectDefaultCSS();const e=document.createElement("div"),t=e.style;t["z-index"]="9000",t.position="absolute",e.innerHTML='<div class="sk-fading-circle">                <div class="sk-circle1 sk-circle"></div>                <div class="sk-circle2 sk-circle"></div>                <div class="sk-circle3 sk-circle"></div>                <div class="sk-circle4 sk-circle"></div>                <div class="sk-circle5 sk-circle"></div>                <div class="sk-circle6 sk-circle"></div>                <div class="sk-circle7 sk-circle"></div>                <div class="sk-circle8 sk-circle"></div>                <div class="sk-circle9 sk-circle"></div>                <div class="sk-circle10 sk-circle"></div>                <div class="sk-circle11 sk-circle"></div>                <div class="sk-circle12 sk-circle"></div>                </div>',this._canvas.parentElement.appendChild(e),this._element=e,this._isCustom=!1,this._adjustPosition()}_injectDefaultCSS(){const e="xeokit-spinner-css";if(document.getElementById(e))return;const t=document.createElement("style");t.innerHTML=".sk-fading-circle {        background: transparent;        margin: 20px auto;        width: 50px;        height:50px;        position: relative;        }        .sk-fading-circle .sk-circle {        width: 120%;        height: 120%;        position: absolute;        left: 0;        top: 0;        }        .sk-fading-circle .sk-circle:before {        content: '';        display: block;        margin: 0 auto;        width: 15%;        height: 15%;        background-color: #ff8800;        border-radius: 100%;        -webkit-animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;        animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;        }        .sk-fading-circle .sk-circle2 {        -webkit-transform: rotate(30deg);        -ms-transform: rotate(30deg);        transform: rotate(30deg);    }    .sk-fading-circle .sk-circle3 {        -webkit-transform: rotate(60deg);        -ms-transform: rotate(60deg);        transform: rotate(60deg);    }    .sk-fading-circle .sk-circle4 {        -webkit-transform: rotate(90deg);        -ms-transform: rotate(90deg);        transform: rotate(90deg);    }    .sk-fading-circle .sk-circle5 {        -webkit-transform: rotate(120deg);        -ms-transform: rotate(120deg);        transform: rotate(120deg);    }    .sk-fading-circle .sk-circle6 {        -webkit-transform: rotate(150deg);        -ms-transform: rotate(150deg);        transform: rotate(150deg);    }    .sk-fading-circle .sk-circle7 {        -webkit-transform: rotate(180deg);        -ms-transform: rotate(180deg);        transform: rotate(180deg);    }    .sk-fading-circle .sk-circle8 {        -webkit-transform: rotate(210deg);        -ms-transform: rotate(210deg);        transform: rotate(210deg);    }    .sk-fading-circle .sk-circle9 {        -webkit-transform: rotate(240deg);        -ms-transform: rotate(240deg);        transform: rotate(240deg);    }    .sk-fading-circle .sk-circle10 {        -webkit-transform: rotate(270deg);        -ms-transform: rotate(270deg);        transform: rotate(270deg);    }    .sk-fading-circle .sk-circle11 {        -webkit-transform: rotate(300deg);        -ms-transform: rotate(300deg);        transform: rotate(300deg);    }    .sk-fading-circle .sk-circle12 {        -webkit-transform: rotate(330deg);        -ms-transform: rotate(330deg);        transform: rotate(330deg);    }    .sk-fading-circle .sk-circle2:before {        -webkit-animation-delay: -1.1s;        animation-delay: -1.1s;    }    .sk-fading-circle .sk-circle3:before {        -webkit-animation-delay: -1s;        animation-delay: -1s;    }    .sk-fading-circle .sk-circle4:before {        -webkit-animation-delay: -0.9s;        animation-delay: -0.9s;    }    .sk-fading-circle .sk-circle5:before {        -webkit-animation-delay: -0.8s;        animation-delay: -0.8s;    }    .sk-fading-circle .sk-circle6:before {        -webkit-animation-delay: -0.7s;        animation-delay: -0.7s;    }    .sk-fading-circle .sk-circle7:before {        -webkit-animation-delay: -0.6s;        animation-delay: -0.6s;    }    .sk-fading-circle .sk-circle8:before {        -webkit-animation-delay: -0.5s;        animation-delay: -0.5s;    }    .sk-fading-circle .sk-circle9:before {        -webkit-animation-delay: -0.4s;        animation-delay: -0.4s;    }    .sk-fading-circle .sk-circle10:before {        -webkit-animation-delay: -0.3s;        animation-delay: -0.3s;    }    .sk-fading-circle .sk-circle11:before {        -webkit-animation-delay: -0.2s;        animation-delay: -0.2s;    }    .sk-fading-circle .sk-circle12:before {        -webkit-animation-delay: -0.1s;        animation-delay: -0.1s;    }    @-webkit-keyframes sk-circleFadeDelay {        0%, 39%, 100% { opacity: 0; }        40% { opacity: 1; }    }    @keyframes sk-circleFadeDelay {        0%, 39%, 100% { opacity: 0; }        40% { opacity: 1; }    }",t.id=e,document.body.appendChild(t)}_adjustPosition(){if(this._isCustom)return;const e=this._canvas,t=this._element,s=t.style;s.left=e.offsetLeft+.5*e.clientWidth-.5*t.clientWidth+"px",s.top=e.offsetTop+.5*e.clientHeight-.5*t.clientHeight+"px"}set processes(e){if(e=e||0,this._processes===e)return;if(e<0)return;const t=this._processes;this._processes=e;const s=this._element;s&&(s.style.visibility=this._processes>0?"visible":"hidden"),this.fire("processes",this._processes),0===this._processes&&this._processes!==t&&this.fire("zeroProcesses",this._processes)}get processes(){return this._processes}_destroy(){this._element&&!this._isCustom&&(this._element.parentNode.removeChild(this._element),this._element=null);const e=document.getElementById("xeokit-spinner-css");e&&e.parentNode.removeChild(e)}}const ce={WEBGL:!1,SUPPORTED_EXTENSIONS:{}},pe=document.createElement("canvas");if(pe){const e=pe.getContext("webgl",{antialias:!0})||pe.getContext("experimental-webgl",{antialias:!0});ce.WEBGL=!!e,ce.WEBGL&&(ce.ANTIALIAS=e.getContextAttributes().antialias,e.getShaderPrecisionFormat?e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0?ce.FS_MAX_FLOAT_PRECISION="highp":e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?ce.FS_MAX_FLOAT_PRECISION="mediump":ce.FS_MAX_FLOAT_PRECISION="lowp":ce.FS_MAX_FLOAT_PRECISION="mediump",ce.DEPTH_BUFFER_BITS=e.getParameter(e.DEPTH_BITS),ce.MAX_TEXTURE_SIZE=e.getParameter(e.MAX_TEXTURE_SIZE),ce.MAX_CUBE_MAP_SIZE=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),ce.MAX_RENDERBUFFER_SIZE=e.getParameter(e.MAX_RENDERBUFFER_SIZE),ce.MAX_TEXTURE_UNITS=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),ce.MAX_TEXTURE_IMAGE_UNITS=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),ce.MAX_VERTEX_ATTRIBS=e.getParameter(e.MAX_VERTEX_ATTRIBS),ce.MAX_VERTEX_UNIFORM_VECTORS=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),ce.MAX_FRAGMENT_UNIFORM_VECTORS=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),ce.MAX_VARYING_VECTORS=e.getParameter(e.MAX_VARYING_VECTORS),e.getSupportedExtensions().forEach((function(e){ce.SUPPORTED_EXTENSIONS[e]=!0})))}const de=["webgl2","experimental-webgl","webkit-3d","moz-webgl","moz-glweb20"];class me extends A{constructor(e,t={}){super(e,t),this._backgroundColor=p.vec3([t.backgroundColor?t.backgroundColor[0]:1,t.backgroundColor?t.backgroundColor[1]:1,t.backgroundColor?t.backgroundColor[2]:1]),this._backgroundColorFromAmbientLight=!!t.backgroundColorFromAmbientLight,this.canvas=t.canvas,this.gl=null,this.webgl2=!1,this.transparent=!!t.transparent,this.optimizeResizeDetection=!0,this.contextAttr=t.contextAttr||{},this.contextAttr.alpha=this.transparent,this.contextAttr.preserveDrawingBuffer=!!this.contextAttr.preserveDrawingBuffer,this.contextAttr.stencil=!1,this.contextAttr.premultipliedAlpha=!!this.contextAttr.premultipliedAlpha,this.contextAttr.antialias=!1!==this.contextAttr.antialias,this.resolutionScale=t.resolutionScale,this.canvas.width=Math.round(this.canvas.clientWidth*this._resolutionScale),this.canvas.height=Math.round(this.canvas.clientHeight*this._resolutionScale),this.boundary=[this.canvas.offsetLeft,this.canvas.offsetTop,this.canvas.clientWidth,this.canvas.clientHeight],this._initWebGL(t);const s=this;this.canvas.addEventListener("webglcontextlost",this._webglcontextlostListener=function(e){console.time("webglcontextrestored"),s.scene._webglContextLost(),s.fire("webglcontextlost"),e.preventDefault()},!1),this.canvas.addEventListener("webglcontextrestored",this._webglcontextrestoredListener=function(e){s._initWebGL(),s.gl&&(s.scene._webglContextRestored(s.gl),s.fire("webglcontextrestored",s.gl),e.preventDefault()),console.timeEnd("webglcontextrestored")},!1);let i=null,r=null,o=null,n=null,a=null,h=null,l=null,u=null,c=0;this._tick=this.scene.on("tick",(()=>{if(c++,s._canvasSizeChanged=!1,s.optimizeResizeDetection&&c<10)return;c=0;const e=this.canvas,t=this._resolutionScale!==i,p=window.innerWidth!==r||window.innerHeight!==o,d=e.clientWidth!==n||e.clientHeight!==a,f=e.offsetLeft!==h||e.offsetTop!==l,g=e.parentElement;if(t||p||d||f||g!==u){if(s._canvasSizeChanged=!0,this._spinner._adjustPosition(),t||d||f){const s=e.clientWidth,i=e.clientHeight;if(t||d){let t,s=0;for(const e in C.scenes)C.scenes.hasOwnProperty(e)&&(t=C.scenes[e],s+=Math.round(t.canvas.canvas.clientWidth*this._resolutionScale*(t.canvas.canvas.clientHeight*this._resolutionScale)));m.memory.pixels=s,e.width=Math.round(e.clientWidth*this._resolutionScale),e.height=Math.round(e.clientHeight*this._resolutionScale)}const r=this.boundary;r[0]=e.offsetLeft,r[1]=e.offsetTop,r[2]=s,r[3]=i,t||this.fire("boundary",r),n=s,a=i}t&&(i=this._resolutionScale),p&&(r=window.innerWidth,o=window.innerHeight),f&&(h=e.offsetLeft,l=e.offsetTop),u=g}})),this._spinner=new ue(this.scene,{canvas:this.canvas,elementId:t.spinnerElementId})}get type(){return"Canvas"}get backgroundColorFromAmbientLight(){return this._backgroundColorFromAmbientLight}set backgroundColorFromAmbientLight(e){this._backgroundColorFromAmbientLight=!1!==e,this.glRedraw()}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){e?(this._backgroundColor[0]=e[0],this._backgroundColor[1]=e[1],this._backgroundColor[2]=e[2]):(this._backgroundColor[0]=1,this._backgroundColor[1]=1,this._backgroundColor[2]=1),this.glRedraw()}get resolutionScale(){return this._resolutionScale}set resolutionScale(e){if((e=e||1)===this._resolutionScale)return;this._resolutionScale=e;const t=this.canvas;t.width=Math.round(t.clientWidth*this._resolutionScale),t.height=Math.round(t.clientHeight*this._resolutionScale),this.glRedraw()}get spinner(){return this._spinner}_createCanvas(){const e="xeokit-canvas-"+p.createUUID(),t=document.getElementsByTagName("body")[0],s=document.createElement("div"),i=s.style;i.height="100%",i.width="100%",i.padding="0",i.margin="0",i.background="rgba(0,0,0,0);",i.float="left",i.left="0",i.top="0",i.position="absolute",i.opacity="1.0",i["z-index"]="-10000",s.innerHTML+='<canvas id="'+e+'" style="width: 100%; height: 100%; float: left; margin: 0; padding: 0;"></canvas>',t.appendChild(s),this.canvas=document.getElementById(e)}_getElementXY(e){let t=0,s=0;for(;e;)t+=e.offsetLeft-e.scrollLeft,s+=e.offsetTop-e.scrollTop,e=e.offsetParent;return{x:t,y:s}}_initWebGL(){if(!this.gl)for(let e=0;!this.gl&&e<de.length;e++)try{this.gl=this.canvas.getContext(de[e],this.contextAttr)}catch(e){}this.gl||(this.error("Failed to get a WebGL context"),this.fire("webglContextFailed",!0,!0));{const e=this.gl;let t="__",s=e.activeTexture;e.activeTexture=function(e){t!==e&&(t=e,s.call(this,e))};let i={},r=e.bindTexture;e.bindTexture=function(e,s){i[t]!==s&&(i[t]=s,r.call(this,e,s))}}this.gl&&this.webgl2&&(this.gl.hint(this.gl.FRAGMENT_SHADER_DERIVATIVE_HINT,this.gl.FASTEST),this.gl,WebGL2RenderingContext)}getSnapshot(e){throw"Canvas#getSnapshot() has been replaced by Viewer#getSnapshot() - use that method instead."}readPixels(e,t,s,i){return this.scene._renderer.readPixels(e,t,s,i)}loseWebGLContext(){this.canvas.loseContext&&this.canvas.loseContext()}destroy(){this.scene.off(this._tick),this._spinner._destroy(),this.canvas.removeEventListener("webglcontextlost",this._webglcontextlostListener),this.canvas.removeEventListener("webglcontextrestored",this._webglcontextrestoredListener),this.gl=null,super.destroy()}}class fe{constructor(e){this._scene=e,this._matPool=[],this._matPoolNextFreeIndex=0,this._rtcViewMats={},this._rtcPickViewMats={},this.reset()}reset(){this._matPoolNextFreeIndex=0,this._rtcViewMats={},this._rtcPickViewMats={},this.gl=this._scene.canvas.gl,this.lastProgramId=null,this.pbrEnabled=!1,this.colorTextureEnabled=!1,this.withSAO=!1,this.backfaces=!1,this.frontface=!0,this.textureUnit=0,this.drawElements=0,this.drawArrays=0,this.useProgram=0,this.bindTexture=0,this.bindArray=0,this.pass=0,this.shadowViewMatrix=null,this.shadowProjMatrix=null,this.pickViewMatrix=null,this.pickProjMatrix=null,this.pickZNear=.01,this.pickZFar=5e3,this.pickInvisible=!1,this.lineWidth=1}getRTCViewMatrix(e,t){let s=this._rtcViewMats[e];return s||(s=this._getNewMat(),U(this._scene.camera.viewMatrix,t,s),this._rtcViewMats[e]=s),s}getRTCPickViewMatrix(e,t){let s=this._rtcPickViewMats[e];if(!s){s=this._getNewMat();const i=this.pickViewMatrix||this._scene.camera.viewMatrix;U(i,t,s),this._rtcPickViewMats[e]=s}return s}_getNewMat(){let e=this._matPool[this._matPoolNextFreeIndex];return e||(e=p.mat4(),this._matPool[this._matPoolNextFreeIndex]=e),this._matPoolNextFreeIndex++,e}}class ge{constructor(){this.entity=null,this.primitive=null,this.primIndex=-1,this.pickSurfacePrecision=!1,this.touchInput=!1,this._canvasPos=new Int16Array([0,0]),this._origin=new Float64Array([0,0,0]),this._direction=new Float64Array([0,0,0]),this._indices=new Int32Array(3),this._localPos=new Float64Array([0,0,0]),this._worldPos=new Float64Array([0,0,0]),this._viewPos=new Float64Array([0,0,0]),this._bary=new Float64Array([0,0,0]),this._worldNormal=new Float64Array([0,0,0]),this._uv=new Float64Array([0,0]),this.reset()}get canvasPos(){return this._gotCanvasPos?this._canvasPos:null}set canvasPos(e){e?(this._canvasPos[0]=e[0],this._canvasPos[1]=e[1],this._gotCanvasPos=!0):this._gotCanvasPos=!1}get origin(){return this._gotOrigin?this._origin:null}set origin(e){e?(this._origin[0]=e[0],this._origin[1]=e[1],this._origin[2]=e[2],this._gotOrigin=!0):this._gotOrigin=!1}get direction(){return this._gotDirection?this._direction:null}set direction(e){e?(this._direction[0]=e[0],this._direction[1]=e[1],this._direction[2]=e[2],this._gotDirection=!0):this._gotDirection=!1}get indices(){return this.entity&&this._gotIndices?this._indices:null}set indices(e){e?(this._indices[0]=e[0],this._indices[1]=e[1],this._indices[2]=e[2],this._gotIndices=!0):this._gotIndices=!1}get localPos(){return this.entity&&this._gotLocalPos?this._localPos:null}set localPos(e){e?(this._localPos[0]=e[0],this._localPos[1]=e[1],this._localPos[2]=e[2],this._gotLocalPos=!0):this._gotLocalPos=!1}get worldPos(){return this.entity&&this._gotWorldPos?this._worldPos:null}set worldPos(e){e?(this._worldPos[0]=e[0],this._worldPos[1]=e[1],this._worldPos[2]=e[2],this._gotWorldPos=!0):this._gotWorldPos=!1}get viewPos(){return this.entity&&this._gotViewPos?this._viewPos:null}set viewPos(e){e?(this._viewPos[0]=e[0],this._viewPos[1]=e[1],this._viewPos[2]=e[2],this._gotViewPos=!0):this._gotViewPos=!1}get bary(){return this.entity&&this._gotBary?this._bary:null}set bary(e){e?(this._bary[0]=e[0],this._bary[1]=e[1],this._bary[2]=e[2],this._gotBary=!0):this._gotBary=!1}get worldNormal(){return this.entity&&this._gotWorldNormal?this._worldNormal:null}set worldNormal(e){e?(this._worldNormal[0]=e[0],this._worldNormal[1]=e[1],this._worldNormal[2]=e[2],this._gotWorldNormal=!0):this._gotWorldNormal=!1}get uv(){return this.entity&&this._gotUV?this._uv:null}set uv(e){e?(this._uv[0]=e[0],this._uv[1]=e[1],this._gotUV=!0):this._gotUV=!1}reset(){this.entity=null,this.primIndex=-1,this.primitive=null,this.pickSurfacePrecision=!1,this._gotCanvasPos=!1,this._gotOrigin=!1,this._gotDirection=!1,this._gotIndices=!1,this._gotLocalPos=!1,this._gotWorldPos=!1,this._gotViewPos=!1,this._gotBary=!1,this._gotWorldNormal=!1,this._gotUV=!1,this.touchInput=!1}}class _e{constructor(e,t,s){if(this.allocated=!1,this.compiled=!1,this.handle=e.createShader(t),this.handle){if(this.allocated=!0,e.shaderSource(this.handle,s),e.compileShader(this.handle),this.compiled=e.getShaderParameter(this.handle,e.COMPILE_STATUS),!this.compiled&&!e.isContextLost()){const t=s.split("\n"),i=[];for(let e=0;e<t.length;e++)i.push(e+1+": "+t[e]+"\n");this.errors=[],this.errors.push(""),this.errors.push(e.getShaderInfoLog(this.handle)),this.errors=this.errors.concat(i.join(""))}}else this.errors=["Failed to allocate"]}destroy(){}}class ye{constructor(e,t){this.bindTexture=function(s,i){return!!s.bind(i)&&(e.uniform1i(t,i),!0)}}}class ve{constructor(e,t){this._gl=e,this.location=t}bindArrayBuffer(e){e&&(e.bind(),this._gl.enableVertexAttribArray(this.location),this._gl.vertexAttribPointer(this.location,e.itemSize,e.itemType,e.normalized,e.stride,e.offset))}}const be=new e({});function xe(e){const t=[];let s,i;for(let r=0,o=e.length;r<o;r++)s=e[r],i=s.indexOf("/"),i>0&&"/"===s.charAt(i+1)&&(s=s.substring(0,i)),t.push(s);return t.join("\n")}function Pe(e){console.error(e.join("\n"))}class Te{constructor(e,t){this.id=be.addItem({}),this.source=t,this.init(e)}init(e){if(this.gl=e,this.allocated=!1,this.compiled=!1,this.linked=!1,this.validated=!1,this.errors=null,this.uniforms={},this.samplers={},this.attributes={},this._vertexShader=new _e(e,e.VERTEX_SHADER,xe(this.source.vertex)),this._fragmentShader=new _e(e,e.FRAGMENT_SHADER,xe(this.source.fragment)),!this._vertexShader.allocated)return this.errors=["Vertex shader failed to allocate"].concat(this._vertexShader.errors),void Pe(this.errors);if(!this._fragmentShader.allocated)return this.errors=["Fragment shader failed to allocate"].concat(this._fragmentShader.errors),void Pe(this.errors);if(this.allocated=!0,!this._vertexShader.compiled)return this.errors=["Vertex shader failed to compile"].concat(this._vertexShader.errors),void Pe(this.errors);if(!this._fragmentShader.compiled)return this.errors=["Fragment shader failed to compile"].concat(this._fragmentShader.errors),void Pe(this.errors);let t,s,i,r,o;if(this.compiled=!0,this.handle=e.createProgram(),!this.handle)return void(this.errors=["Failed to allocate program"]);if(e.attachShader(this.handle,this._vertexShader.handle),e.attachShader(this.handle,this._fragmentShader.handle),e.linkProgram(this.handle),this.linked=e.getProgramParameter(this.handle,e.LINK_STATUS),this.validated=!0,!this.linked||!this.validated)return this.errors=[],this.errors.push(""),this.errors.push(e.getProgramInfoLog(this.handle)),this.errors.push("\nVertex shader:\n"),this.errors=this.errors.concat(this.source.vertex),this.errors.push("\nFragment shader:\n"),this.errors=this.errors.concat(this.source.fragment),void Pe(this.errors);const n=e.getProgramParameter(this.handle,e.ACTIVE_UNIFORMS);for(s=0;s<n;++s)i=e.getActiveUniform(this.handle,s),i&&(r=i.name,"\0"===r[r.length-1]&&(r=r.substr(0,r.length-1)),o=e.getUniformLocation(this.handle,r),i.type===e.SAMPLER_2D||i.type===e.SAMPLER_CUBE||35682===i.type||e instanceof WebGL2RenderingContext&&(i.type===e.UNSIGNED_INT_SAMPLER_2D||i.type===e.INT_SAMPLER_2D)?this.samplers[r]=new ye(e,o):this.uniforms[r]=o);const a=e.getProgramParameter(this.handle,e.ACTIVE_ATTRIBUTES);for(s=0;s<a;s++)t=e.getActiveAttrib(this.handle,s),t&&(o=e.getAttribLocation(this.handle,t.name),this.attributes[t.name]=new ve(e,o));this.allocated=!0}bind(){this.allocated&&this.gl.useProgram(this.handle)}getLocation(e){if(this.allocated)return this.uniforms[e]}getAttribute(e){if(this.allocated)return this.attributes[e]}bindTexture(e,t,s){if(!this.allocated)return!1;const i=this.samplers[e];return!!i&&i.bindTexture(t,s)}destroy(){this.allocated&&(be.removeItem(this.id),this.gl.deleteProgram(this.handle),this.gl.deleteShader(this._vertexShader.handle),this.gl.deleteShader(this._fragmentShader.handle),this.handle=null,this.attributes=null,this.uniforms=null,this.samplers=null,this.allocated=!1)}}class we{constructor(e,t,s,i,r,o,n,a,h){switch(this._gl=e,this.type=t,this.allocated=!1,s.constructor){case Uint8Array:this.itemType=e.UNSIGNED_BYTE,this.itemByteSize=1;break;case Int8Array:this.itemType=e.BYTE,this.itemByteSize=1;break;case Uint16Array:this.itemType=e.UNSIGNED_SHORT,this.itemByteSize=2;break;case Int16Array:this.itemType=e.SHORT,this.itemByteSize=2;break;case Uint32Array:this.itemType=e.UNSIGNED_INT,this.itemByteSize=4;break;case Int32Array:this.itemType=e.INT,this.itemByteSize=4;break;default:this.itemType=e.FLOAT,this.itemByteSize=4}this.usage=o,this.length=0,this.dataLength=i,this.numItems=0,this.itemSize=r,this.normalized=!!n,this.stride=a||0,this.offset=h||0,this._allocate(s)}_allocate(e){if(this.allocated=!1,this._handle=this._gl.createBuffer(),!this._handle)throw"Failed to allocate WebGL ArrayBuffer";this._handle&&(this._gl.bindBuffer(this.type,this._handle),this._gl.bufferData(this.type,e.length>this.dataLength?e.slice(0,this.dataLength):e,this.usage),this._gl.bindBuffer(this.type,null),this.length=e.length,this.numItems=this.length/this.itemSize,this.allocated=!0)}setData(e,t){this.allocated&&(e.length+(t||0)>this.length?(this.destroy(),this._allocate(e)):(this._gl.bindBuffer(this.type,this._handle),t||0===t?this._gl.bufferSubData(this.type,t*this.itemByteSize,e):this._gl.bufferData(this.type,e,this.usage),this._gl.bindBuffer(this.type,null)))}bind(){this.allocated&&this._gl.bindBuffer(this.type,this._handle)}unbind(){this.allocated&&this._gl.bindBuffer(this.type,null)}destroy(){this.allocated&&(this._gl.deleteBuffer(this._handle),this._handle=null,this.allocated=!1)}}class Me{constructor(e,t){this.scene=e,this.aabb=p.AABB3(),this.origin=p.vec3(t),this.originHash=this.origin.join(),this.numMarkers=0,this.markers={},this.markerList=[],this.markerIndices={},this.positions=[],this.indices=[],this.positionsBuf=null,this.lenPositionsBuf=0,this.indicesBuf=null,this.sectionPlanesActive=[],this.culledBySectionPlanes=!1,this.occlusionTestList=[],this.lenOcclusionTestList=0,this.pixels=[],this.aabbDirty=!1,this.markerListDirty=!1,this.positionsDirty=!0,this.occlusionTestListDirty=!1}addMarker(e){this.markers[e.id]=e,this.markerListDirty=!0,this.numMarkers++}markerWorldPosUpdated(e){if(!this.markers[e.id])return;const t=this.markerIndices[e.id];this.positions[3*t+0]=e.worldPos[0],this.positions[3*t+1]=e.worldPos[1],this.positions[3*t+2]=e.worldPos[2],this.positionsDirty=!0}removeMarker(e){delete this.markers[e.id],this.markerListDirty=!0,this.numMarkers--}update(){this.markerListDirty&&(this._buildMarkerList(),this.markerListDirty=!1,this.positionsDirty=!0,this.occlusionTestListDirty=!0),this.positionsDirty&&(this._buildPositions(),this.positionsDirty=!1,this.aabbDirty=!0,this.vbosDirty=!0),this.aabbDirty&&(this._buildAABB(),this.aabbDirty=!1),this.vbosDirty&&(this._buildVBOs(),this.vbosDirty=!1),this.occlusionTestListDirty&&this._buildOcclusionTestList(),this._updateActiveSectionPlanes()}_buildMarkerList(){for(var e in this.numMarkers=0,this.markers)this.markers.hasOwnProperty(e)&&(this.markerList[this.numMarkers]=this.markers[e],this.markerIndices[e]=this.numMarkers,this.numMarkers++);this.markerList.length=this.numMarkers}_buildPositions(){let e=0;for(let t=0;t<this.numMarkers;t++)if(this.markerList[t]){const s=this.markerList[t].worldPos;this.positions[e++]=s[0],this.positions[e++]=s[1],this.positions[e++]=s[2],this.indices[t]=t}this.positions.length=3*this.numMarkers,this.indices.length=this.numMarkers}_buildAABB(){const e=this.aabb;p.collapseAABB3(e),p.expandAABB3Points3(e,this.positions);const t=this.origin;e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[0],e[4]+=t[1],e[5]+=t[2]}_buildVBOs(){if(this.positionsBuf){if(this.lenPositionsBuf===this.positions.length)return void this.positionsBuf.setData(this.positions);this.positionsBuf.destroy(),this.positionsBuf=null,this.indicesBuf.destroy(),this.indicesBuf=null}const e=this.scene.canvas.gl,t=3*this.numMarkers,s=this.numMarkers;this.positionsBuf=new we(e,e.ARRAY_BUFFER,new Float32Array(this.positions),t,3,e.STATIC_DRAW),this.indicesBuf=new we(e,e.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),s,1,e.STATIC_DRAW),this.lenPositionsBuf=this.positions.length}_buildOcclusionTestList(){const e=this.scene.canvas,t=this.scene.camera.perspective.near,s=e.boundary,i=s[2],r=s[3];let o=0;this.lenOcclusionTestList=0;for(let e=0;e<this.numMarkers;e++){const s=this.markerList[e];if(s.viewPos[2]>-t){s._setVisible(!1);continue}const n=s.canvasPos,a=n[0],h=n[1];a+10<0||h+10<0||a-10>i||h-10>r?s._setVisible(!1):!s.entity||s.entity.visible?s.occludable?(this.occlusionTestList[this.lenOcclusionTestList++]=s,this.pixels[o++]=a,this.pixels[o++]=h):s._setVisible(!0):s._setVisible(!1)}}_updateActiveSectionPlanes(){const e=this.scene._sectionPlanesState.sectionPlanes,t=e.length;if(t>0)for(let s=0;s<t;s++){const t=e[s];if(t.active){const e=p.planeAABB3Intersect(t.dir,t.dist,this.aabb);if(-1===e)return void(this.culledBySectionPlanes=!0);const i=0===e;this.sectionPlanesActive[s]=i}else this.sectionPlanesActive[s]=!1}this.culledBySectionPlanes=!1}destroy(){this.markers={},this.markerList.length=0,this.positionsBuf&&this.positionsBuf.destroy(),this.indicesBuf&&this.indicesBuf.destroy()}}const Ie=p.vec3([1,0,0]),Ce=p.vec3();class De{constructor(e,t){this._scene=e,this._renderBufferManager=t,this._occlusionLayers={},this._occlusionLayersList=[],this._occlusionLayersListDirty=!1,this._shaderSource=null,this._program=null,this._shaderSourceHash=null,this._shaderSourceDirty=!0,this._programDirty=!1,this._markersToOcclusionLayersMap={},this._onCameraViewMatrix=e.camera.on("viewMatrix",(()=>{this._occlusionTestListDirty=!0})),this._onCameraProjMatrix=e.camera.on("projMatrix",(()=>{this._occlusionTestListDirty=!0})),this._onCanvasBoundary=e.canvas.on("boundary",(()=>{this._occlusionTestListDirty=!0}))}addMarker(e){const t=e.origin.join();let s=this._occlusionLayers[t];s||(s=new Me(this._scene,e.origin),this._occlusionLayers[s.originHash]=s,this._occlusionLayersListDirty=!0),s.addMarker(e),this._markersToOcclusionLayersMap[e.id]=s,this._occlusionTestListDirty=!0}markerWorldPosUpdated(e){const t=this._markersToOcclusionLayersMap[e.id];if(!t)return void e.error("Marker has not been added to OcclusionTester");const s=e.origin.join();if(s!==t.originHash){1===t.numMarkers?(t.destroy(),delete this._occlusionLayers[t.originHash],this._occlusionLayersListDirty=!0):t.removeMarker(e);let i=this._occlusionLayers[s];i||(i=new Me(this._scene,e.origin),this._occlusionLayers[s]=t,this._occlusionLayersListDirty=!0),i.addMarker(e),this._markersToOcclusionLayersMap[e.id]=i}else t.markerWorldPosUpdated(e)}removeMarker(e){const t=e.origin.join();let s=this._occlusionLayers[t];s&&(1===s.numMarkers?(s.destroy(),delete this._occlusionLayers[s.originHash],this._occlusionLayersListDirty=!0):s.removeMarker(e),delete this._markersToOcclusionLayersMap[e.id])}get needOcclusionTest(){return this._occlusionTestListDirty}bindRenderBuf(){const e=[this._scene.canvas.canvas.id,this._scene._sectionPlanesState.getHash()].join(";");if(e!==this._shaderSourceHash&&(this._shaderSourceHash=e,this._shaderSourceDirty=!0),this._shaderSourceDirty&&(this._buildShaderSource(),this._shaderSourceDirty=!1,this._programDirty=!0),this._programDirty&&(this._buildProgram(),this._programDirty=!1,this._occlusionTestListDirty=!0),this._occlusionLayersListDirty&&(this._buildOcclusionLayersList(),this._occlusionLayersListDirty=!1),this._occlusionTestListDirty){for(let e=0,t=this._occlusionLayersList.length;e<t;e++){this._occlusionLayersList[e].occlusionTestListDirty=!0}this._occlusionTestListDirty=!1}this._readPixelBuf=this._renderBufferManager.getRenderBuffer("occlusionReadPix"),this._readPixelBuf.bind(),this._readPixelBuf.clear()}_buildOcclusionLayersList(){let e=0;for(let t in this._occlusionLayers)this._occlusionLayers.hasOwnProperty(t)&&(this._occlusionLayersList[e++]=this._occlusionLayers[t]);this._occlusionLayersList.length=e}_buildShaderSource(){this._shaderSource={vertex:this._buildVertexShaderSource(),fragment:this._buildFragmentShaderSource()}}_buildVertexShaderSource(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// OcclusionTester vertex shader"),s.push("in vec3 position;"),s.push("uniform mat4 modelMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),t&&s.push("out vec4 vWorldPosition;"),s.push("void main(void) {"),s.push("vec4 worldPosition = vec4(position, 1.0); "),s.push("   vec4 viewPosition = viewMatrix * worldPosition;"),t&&s.push("   vWorldPosition = worldPosition;"),s.push("   vec4 clipPos = projMatrix * viewPosition;"),s.push("   gl_PointSize = 20.0;"),e.logarithmicDepthBufferEnabled?s.push("vFragDepth = 1.0 + clipPos.w;"):s.push("clipPos.z += -0.001;"),s.push("   gl_Position = clipPos;"),s.push("}"),s}_buildFragmentShaderSource(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// OcclusionTester fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  float dist = 0.0;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("if (sectionPlaneActive"+r+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }")}return e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("   outColor = vec4(1.0, 0.0, 0.0, 1.0); "),i.push("}"),i}_buildProgram(){this._program&&this._program.destroy();const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}drawMarkers(){const e=this._scene,t=e.canvas.gl,s=this._program,i=e._sectionPlanesState,r=e.camera,o=e.camera.project;if(s.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,r._project._state.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}for(let e=0,s=this._occlusionLayersList.length;e<s;e++){const s=this._occlusionLayersList[e];if(s.update(),s.culledBySectionPlanes)continue;const o=s.origin;t.uniformMatrix4fv(this._uViewMatrix,!1,U(r.viewMatrix,o));const n=i.sectionPlanes.length;if(n>0){const e=i.sectionPlanes;for(let i=0;i<n;i++){const r=this._uSectionPlanes[i];if(r){const n=s.sectionPlanesActive[i];if(t.uniform1i(r.active,n?1:0),n){const s=e[i];t.uniform3fv(r.pos,X(s.dist,s.dir,o,Ce)),t.uniform3fv(r.dir,s.dir)}}}}this._aPosition.bindArrayBuffer(s.positionsBuf);const a=s.indicesBuf;a.bind(),t.drawElements(t.POINTS,a.numItems,a.itemType,0)}}doOcclusionTest(){{const e=this._scene.canvas.resolutionScale,t=255*Ie[0],s=255*Ie[1],i=255*Ie[2];for(let r=0,o=this._occlusionLayersList.length;r<o;r++){const o=this._occlusionLayersList[r];for(let r=0;r<o.lenOcclusionTestList;r++){const n=o.occlusionTestList[r],a=2*r,h=this._readPixelBuf.read(Math.round(o.pixels[a]*e),Math.round(o.pixels[a+1]*e)),l=h[0]===t&&h[1]===s&&h[2]===i;n._setVisible(l)}}}}unbindRenderBuf(){this._readPixelBuf.unbind()}destroy(){if(!this.destroyed){for(let e=0,t=this._occlusionLayersList.length;e<t;e++){this._occlusionLayersList[e].destroy()}this._program&&this._program.destroy(),this._scene.camera.off(this._onCameraViewMatrix),this._scene.camera.off(this._onCameraProjMatrix),this._scene.canvas.off(this._onCanvasBoundary),this.destroyed=!0}}}const Ae=p.vec2();class Ee{constructor(e){this._scene=e,this._numSamples=null,this._program=null,this._programError=!1,this._aPosition=null,this._aUV=null,this._uDepthTexture="uDepthTexture",this._uCameraNear=null,this._uCameraFar=null,this._uCameraProjectionMatrix=null,this._uCameraInverseProjectionMatrix=null,this._uScale=null,this._uIntensity=null,this._uBias=null,this._uKernelRadius=null,this._uMinResolution=null,this._uRandomSeed=null,this._uvBuf=null,this._positionsBuf=null,this._indicesBuf=null}render(e){if(this._build(),this._programError)return;this._getInverseProjectMat||(this._getInverseProjectMat=(()=>{let e=!0;this._scene.camera.on("projMatrix",(function(){e=!0}));const t=p.mat4();return()=>(e&&p.inverseMat4(i.camera.projMatrix,t),t)})());const t=this._scene.canvas.gl,s=this._program,i=this._scene,r=i.sao,o=t.drawingBufferWidth,n=t.drawingBufferHeight,a=i.camera.project._state,h=a.near,l=a.far,u=a.matrix,c=this._getInverseProjectMat(),d=Math.random(),m="perspective"===i.camera.projection;Ae[0]=o,Ae[1]=n,t.viewport(0,0,o,n),t.clearColor(0,0,0,1),t.disable(t.DEPTH_TEST),t.disable(t.BLEND),t.frontFace(t.CCW),t.clear(t.COLOR_BUFFER_BIT),s.bind(),t.uniform1f(this._uCameraNear,h),t.uniform1f(this._uCameraFar,l),t.uniformMatrix4fv(this._uCameraProjectionMatrix,!1,u),t.uniformMatrix4fv(this._uCameraInverseProjectionMatrix,!1,c),t.uniform1i(this._uPerspective,m),t.uniform1f(this._uScale,r.scale*(l/5)),t.uniform1f(this._uIntensity,r.intensity),t.uniform1f(this._uBias,r.bias),t.uniform1f(this._uKernelRadius,r.kernelRadius),t.uniform1f(this._uMinResolution,r.minResolution),t.uniform2fv(this._uViewport,Ae),t.uniform1f(this._uRandomSeed,d);const f=e.getDepthTexture();s.bindTexture(this._uDepthTexture,f,0),this._aUV.bindArrayBuffer(this._uvBuf),this._aPosition.bindArrayBuffer(this._positionsBuf),this._indicesBuf.bind(),t.drawElements(t.TRIANGLES,this._indicesBuf.numItems,this._indicesBuf.itemType,0)}_build(){let e=!1;const t=this._scene.sao;if(t.numSamples!==this._numSamples&&(this._numSamples=Math.floor(t.numSamples),e=!0),!e)return;const s=this._scene.canvas.gl;if(this._program&&(this._program.destroy(),this._program=null),this._program=new Te(s,{vertex:["#version 300 es\n                    precision highp float;\n                    precision highp int;\n                    \n                    in vec3 aPosition;\n                    in vec2 aUV;            \n                    \n                    out vec2 vUV;\n                    \n                    void main () {\n                        gl_Position = vec4(aPosition, 1.0);\n                        vUV = aUV;\n                    }"],fragment:[`#version 300 es      \n                precision highp float;\n                precision highp int;           \n                \n                #define NORMAL_TEXTURE 0\n                #define PI 3.14159265359\n                #define PI2 6.28318530718\n                #define EPSILON 1e-6\n                #define NUM_SAMPLES ${this._numSamples}\n                #define NUM_RINGS 4              \n            \n                in vec2        vUV;\n            \n                uniform sampler2D   uDepthTexture;\n               \n                uniform float       uCameraNear;\n                uniform float       uCameraFar;\n                uniform mat4        uProjectMatrix;\n                uniform mat4        uInverseProjectMatrix;\n                \n                uniform bool        uPerspective;\n\n                uniform float       uScale;\n                uniform float       uIntensity;\n                uniform float       uBias;\n                uniform float       uKernelRadius;\n                uniform float       uMinResolution;\n                uniform vec2        uViewport;\n                uniform float       uRandomSeed;\n\n                float pow2( const in float x ) { return x*x; }\n                \n                highp float rand( const in vec2 uv ) {\n                    const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n                    highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n                    return fract(sin(sn) * c);\n                }\n\n                vec3 packNormalToRGB( const in vec3 normal ) {\n                    return normalize( normal ) * 0.5 + 0.5;\n                }\n\n                vec3 unpackRGBToNormal( const in vec3 rgb ) {\n                    return 2.0 * rgb.xyz - 1.0;\n                }\n\n                const float packUpscale = 256. / 255.;\n                const float unpackDownScale = 255. / 256.; \n\n                const vec3 packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\n                const vec4 unPackFactors = unpackDownScale / vec4( packFactors, 1. );   \n\n                const float shiftRights = 1. / 256.;\n\n                vec4 packFloatToRGBA( const in float v ) {\n                    vec4 r = vec4( fract( v * packFactors ), v );\n                    r.yzw -= r.xyz * shiftRights; \n                    return r * packUpscale;\n                }\n\n                float unpackRGBAToFloat( const in vec4 v ) {                   \n                    return dot( floor( v * 255.0 + 0.5 ) / 255.0, unPackFactors );\n                }\n                \n                float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n                    return ( near * far ) / ( ( far - near ) * invClipZ - far );\n                }\n\n                float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n                    return linearClipZ * ( near - far ) - near;\n                }\n                \n                float getDepth( const in vec2 screenPosition ) {\n                    return vec4(texture(uDepthTexture, screenPosition)).r;\n                }\n\n                float getViewZ( const in float depth ) {\n                     if (uPerspective) {\n                         return perspectiveDepthToViewZ( depth, uCameraNear, uCameraFar );\n                     } else {\n                        return orthographicDepthToViewZ( depth, uCameraNear, uCameraFar );\n                     }\n                }\n\n                vec3 getViewPos( const in vec2 screenPos, const in float depth, const in float viewZ ) {\n                \tfloat clipW = uProjectMatrix[2][3] * viewZ + uProjectMatrix[3][3];\n                \tvec4 clipPosition = vec4( ( vec3( screenPos, depth ) - 0.5 ) * 2.0, 1.0 );\n                \tclipPosition *= clipW; \n                \treturn ( uInverseProjectMatrix * clipPosition ).xyz;\n                }\n\n                vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPos ) {               \n                    return normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );\n                }\n\n                float scaleDividedByCameraFar;\n                float minResolutionMultipliedByCameraFar;\n\n                float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {\n                \tvec3 viewDelta = sampleViewPosition - centerViewPosition;\n                \tfloat viewDistance = length( viewDelta );\n                \tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;\n                \treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - uBias) / (1.0 + pow2( scaledScreenDistance ) );\n                }\n\n                const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );\n                const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );\n\n                float getAmbientOcclusion( const in vec3 centerViewPosition ) {\n            \n                \tscaleDividedByCameraFar = uScale / uCameraFar;\n                \tminResolutionMultipliedByCameraFar = uMinResolution * uCameraFar;\n                \tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUV );\n\n                \tfloat angle = rand( vUV + uRandomSeed ) * PI2;\n                \tvec2 radius = vec2( uKernelRadius * INV_NUM_SAMPLES ) / uViewport;\n                \tvec2 radiusStep = radius;\n\n                \tfloat occlusionSum = 0.0;\n                \tfloat weightSum = 0.0;\n\n                \tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {\n                \t\tvec2 sampleUv = vUV + vec2( cos( angle ), sin( angle ) ) * radius;\n                \t\tradius += radiusStep;\n                \t\tangle += ANGLE_STEP;\n\n                \t\tfloat sampleDepth = getDepth( sampleUv );\n                \t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {\n                \t\t\tcontinue;\n                \t\t}\n\n                \t\tfloat sampleViewZ = getViewZ( sampleDepth );\n                \t\tvec3 sampleViewPosition = getViewPos( sampleUv, sampleDepth, sampleViewZ );\n                \t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );\n                \t\tweightSum += 1.0;\n                \t}\n\n                \tif( weightSum == 0.0 ) discard;\n\n                \treturn occlusionSum * ( uIntensity / weightSum );\n                }\n\n                out vec4 outColor;\n   \n                void main() {\n                \n                \tfloat centerDepth = getDepth( vUV );\n                \t\n                \tif( centerDepth >= ( 1.0 - EPSILON ) ) {\n                \t\tdiscard;\n                \t}\n\n                \tfloat centerViewZ = getViewZ( centerDepth );\n                \tvec3 viewPosition = getViewPos( vUV, centerDepth, centerViewZ );\n\n                \tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );\n                \n                \toutColor = packFloatToRGBA(  1.0- ambientOcclusion );\n                }`]}),this._program.errors)return console.error(this._program.errors.join("\n")),void(this._programError=!0);const i=new Float32Array([1,1,0,1,0,0,1,0]),r=new Float32Array([1,1,0,-1,1,0,-1,-1,0,1,-1,0]),o=new Uint32Array([0,1,2,0,2,3]);this._positionsBuf=new we(s,s.ARRAY_BUFFER,r,r.length,3,s.STATIC_DRAW),this._uvBuf=new we(s,s.ARRAY_BUFFER,i,i.length,2,s.STATIC_DRAW),this._indicesBuf=new we(s,s.ELEMENT_ARRAY_BUFFER,o,o.length,1,s.STATIC_DRAW),this._program.bind(),this._uCameraNear=this._program.getLocation("uCameraNear"),this._uCameraFar=this._program.getLocation("uCameraFar"),this._uCameraProjectionMatrix=this._program.getLocation("uProjectMatrix"),this._uCameraInverseProjectionMatrix=this._program.getLocation("uInverseProjectMatrix"),this._uPerspective=this._program.getLocation("uPerspective"),this._uScale=this._program.getLocation("uScale"),this._uIntensity=this._program.getLocation("uIntensity"),this._uBias=this._program.getLocation("uBias"),this._uKernelRadius=this._program.getLocation("uKernelRadius"),this._uMinResolution=this._program.getLocation("uMinResolution"),this._uViewport=this._program.getLocation("uViewport"),this._uRandomSeed=this._program.getLocation("uRandomSeed"),this._aPosition=this._program.getAttribute("aPosition"),this._aUV=this._program.getAttribute("aUV"),this._dirty=!1}destroy(){this._program&&(this._program.destroy(),this._program=null)}}const Fe=new Float32Array(Ne(17,[0,1])),Re=new Float32Array(Ne(17,[1,0])),Se=new Float32Array(function(e,t){const s=[];for(let i=0;i<=e;i++)s.push(Le(i,t));return s}(17,4)),Oe=new Float32Array(2);class Be{constructor(e){this._scene=e,this._program=null,this._programError=!1,this._aPosition=null,this._aUV=null,this._uDepthTexture="uDepthTexture",this._uOcclusionTexture="uOcclusionTexture",this._uViewport=null,this._uCameraNear=null,this._uCameraFar=null,this._uCameraProjectionMatrix=null,this._uCameraInverseProjectionMatrix=null,this._uvBuf=null,this._positionsBuf=null,this._indicesBuf=null,this.init()}init(){const e=this._scene.canvas.gl;if(this._program=new Te(e,{vertex:["#version 300 es\n                precision highp float;\n                precision highp int;\n                    \n                in vec3 aPosition;\n                in vec2 aUV;\n                uniform vec2 uViewport;\n                out vec2 vUV;\n                out vec2 vInvSize;\n                void main () {\n                    vUV = aUV;\n                    vInvSize = 1.0 / uViewport;\n                    gl_Position = vec4(aPosition, 1.0);\n                }"],fragment:["#version 300 es\n                precision highp float;\n                precision highp int;\n                    \n                #define PI 3.14159265359\n                #define PI2 6.28318530718\n                #define EPSILON 1e-6\n\n                #define KERNEL_RADIUS 16\n\n                in vec2        vUV;\n                in vec2        vInvSize;\n            \n                uniform sampler2D   uDepthTexture;\n                uniform sampler2D   uOcclusionTexture;              \n               \n                uniform float       uCameraNear;\n                uniform float       uCameraFar;               \n                uniform float       uDepthCutoff;\n\n                uniform vec2        uSampleOffsets[ KERNEL_RADIUS + 1 ];\n                uniform float       uSampleWeights[ KERNEL_RADIUS + 1 ];\n\n                const float         unpackDownscale = 255. / 256.; \n\n                const vec3          packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\n                const vec4          unpackFactors = unpackDownscale / vec4( packFactors, 1. );   \n\n                const float packUpscale = 256. / 255.;\n       \n                const float shiftRights = 1. / 256.;\n                \n                float unpackRGBAToFloat( const in vec4 v ) {\n                    return dot( floor( v * 255.0 + 0.5 ) / 255.0, unpackFactors );\n                }               \n\n                vec4 packFloatToRGBA( const in float v ) {\n                    vec4 r = vec4( fract( v * packFactors ), v );\n                    r.yzw -= r.xyz * shiftRights; \n                    return r * packUpscale;\n                }\n\n                float viewZToOrthographicDepth( const in float viewZ) {\n                    return ( viewZ + uCameraNear ) / ( uCameraNear - uCameraFar );\n                }\n              \n                float orthographicDepthToViewZ( const in float linearClipZ) {\n                    return linearClipZ * ( uCameraNear - uCameraFar ) - uCameraNear;\n                }\n\n                float viewZToPerspectiveDepth( const in float viewZ) {\n                    return (( uCameraNear + viewZ ) * uCameraFar ) / (( uCameraFar - uCameraNear ) * viewZ );\n                }\n                \n                float perspectiveDepthToViewZ( const in float invClipZ) {\n                    return ( uCameraNear * uCameraFar ) / ( ( uCameraFar - uCameraNear ) * invClipZ - uCameraFar );\n                }\n\n                float getDepth( const in vec2 screenPosition ) {\n                    return vec4(texture(uDepthTexture, screenPosition)).r;\n                }\n\n                float getViewZ( const in float depth ) {\n                     return perspectiveDepthToViewZ( depth );\n                }\n\n                out vec4 outColor;\n        \n                void main() {\n                \n                    float depth = getDepth( vUV );\n                    if( depth >= ( 1.0 - EPSILON ) ) {\n                        discard;\n                    }\n\n                    float centerViewZ = -getViewZ( depth );\n                    bool rBreak = false;\n                    bool lBreak = false;\n\n                    float weightSum = uSampleWeights[0];\n                    float occlusionSum = unpackRGBAToFloat(texture( uOcclusionTexture, vUV )) * weightSum;\n\n                    for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {\n\n                        float sampleWeight = uSampleWeights[i];\n                        vec2 sampleUVOffset = uSampleOffsets[i] * vInvSize;\n\n                        vec2 sampleUV = vUV + sampleUVOffset;\n                        float viewZ = -getViewZ( getDepth( sampleUV ) );\n\n                        if( abs( viewZ - centerViewZ ) > uDepthCutoff ) {\n                            rBreak = true;\n                        }\n\n                        if( ! rBreak ) {\n                            occlusionSum += unpackRGBAToFloat(texture( uOcclusionTexture, sampleUV )) * sampleWeight;\n                            weightSum += sampleWeight;\n                        }\n\n                        sampleUV = vUV - sampleUVOffset;\n                        viewZ = -getViewZ( getDepth( sampleUV ) );\n\n                        if( abs( viewZ - centerViewZ ) > uDepthCutoff ) {\n                            lBreak = true;\n                        }\n\n                        if( ! lBreak ) {\n                            occlusionSum += unpackRGBAToFloat(texture( uOcclusionTexture, sampleUV )) * sampleWeight;\n                            weightSum += sampleWeight;\n                        }\n                    }\n\n                    outColor = packFloatToRGBA(occlusionSum / weightSum);\n                }"]}),this._program.errors)return console.error(this._program.errors.join("\n")),void(this._programError=!0);const t=new Float32Array([1,1,0,1,0,0,1,0]),s=new Float32Array([1,1,0,-1,1,0,-1,-1,0,1,-1,0]),i=new Uint32Array([0,1,2,0,2,3]);this._positionsBuf=new we(e,e.ARRAY_BUFFER,s,s.length,3,e.STATIC_DRAW),this._uvBuf=new we(e,e.ARRAY_BUFFER,t,t.length,2,e.STATIC_DRAW),this._indicesBuf=new we(e,e.ELEMENT_ARRAY_BUFFER,i,i.length,1,e.STATIC_DRAW),this._program.bind(),this._uViewport=this._program.getLocation("uViewport"),this._uCameraNear=this._program.getLocation("uCameraNear"),this._uCameraFar=this._program.getLocation("uCameraFar"),this._uDepthCutoff=this._program.getLocation("uDepthCutoff"),this._uSampleOffsets=e.getUniformLocation(this._program.handle,"uSampleOffsets"),this._uSampleWeights=e.getUniformLocation(this._program.handle,"uSampleWeights"),this._aPosition=this._program.getAttribute("aPosition"),this._aUV=this._program.getAttribute("aUV")}render(e,t,s){if(this._programError)return;this._getInverseProjectMat||(this._getInverseProjectMat=(()=>{let e=!0;this._scene.camera.on("projMatrix",(function(){e=!0}));const t=p.mat4();return()=>(e&&p.inverseMat4(o.camera.projMatrix,t),t)})());const i=this._scene.canvas.gl,r=this._program,o=this._scene,n=i.drawingBufferWidth,a=i.drawingBufferHeight,h=o.camera.project._state,l=h.near,u=h.far;i.viewport(0,0,n,a),i.clearColor(0,0,0,1),i.enable(i.DEPTH_TEST),i.disable(i.BLEND),i.frontFace(i.CCW),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),r.bind(),Oe[0]=n,Oe[1]=a,i.uniform2fv(this._uViewport,Oe),i.uniform1f(this._uCameraNear,l),i.uniform1f(this._uCameraFar,u),i.uniform1f(this._uDepthCutoff,.01),0===s?i.uniform2fv(this._uSampleOffsets,Re):i.uniform2fv(this._uSampleOffsets,Fe),i.uniform1fv(this._uSampleWeights,Se);const c=e.getDepthTexture(),d=t.getTexture();r.bindTexture(this._uDepthTexture,c,0),r.bindTexture(this._uOcclusionTexture,d,1),this._aUV.bindArrayBuffer(this._uvBuf),this._aPosition.bindArrayBuffer(this._positionsBuf),this._indicesBuf.bind(),i.drawElements(i.TRIANGLES,this._indicesBuf.numItems,this._indicesBuf.itemType,0)}destroy(){this._program.destroy()}}function Le(e,t){return Math.exp(-e*e/(t*t*2))/(Math.sqrt(2*Math.PI)*t)}function Ne(e,t){const s=[];for(let i=0;i<=e;i++)s.push(t[0]*i),s.push(t[1]*i);return s}const ke=function(){const e=document.createElement("canvas"),t=String.fromCharCode;if(!e.getContext)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};const s=!!e.getContext("2d").getImageData,i=!!e.toDataURL,r=!!window.btoa,o=function(e){let s="";const i=e.width,r=e.height;s+="BM";let o=i*r*4+54;s+=t(o%256),o=Math.floor(o/256),s+=t(o%256),o=Math.floor(o/256),s+=t(o%256),o=Math.floor(o/256),s+=t(o%256),s+=t(0,0,0,0,54,0,0,0),s+=t(40,0,0,0);let n=i;s+=t(n%256),n=Math.floor(n/256),s+=t(n%256),n=Math.floor(n/256),s+=t(n%256),n=Math.floor(n/256),s+=t(n%256);let a=r;s+=t(a%256),a=Math.floor(a/256),s+=t(a%256),a=Math.floor(a/256),s+=t(a%256),a=Math.floor(a/256),s+=t(a%256),s+=t(1,0,32,0),s+=t(0,0,0,0);let h=i*r*4;s+=t(h%256),h=Math.floor(h/256),s+=t(h%256),h=Math.floor(h/256),s+=t(h%256),h=Math.floor(h/256),s+=t(h%256),s+=t(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const l=e.data;let u,c,p,d,m="",f=r;do{for(p=i*(f-1)*4,d="",u=0;u<i;u++)c=4*u,d+=t(l[p+c+2],l[p+c+1],l[p+c],l[p+c+3]);m+=d}while(--f);return function(e){let s,i,r="";if("string"==typeof e)r=e;else for(i=e,s=0;s<i.length;s++)r+=t(i[s]);return btoa(r)}(s+m)},n=function(e){window.open(e)||(document.location.href=e)},a=function(e,t){return"data:"+t+";base64,"+e},h=function(e){const t=document.createElement("img");return t.src=e,t},l=function(e,t,s,i){if(t&&s){const r=document.createElement("canvas");r.width=t,r.height=s,r.style.width=t+"px",r.style.height=s+"px";const o=r.getContext("2d");return i?(o.save(),o.scale(1,-1),o.imageSmoothingEnabled=!0,o.drawImage(e,0,0,e.width,e.height,0,0,t,-s),o.restore()):(o.imageSmoothingEnabled=!0,o.drawImage(e,0,0,e.width,e.height,0,0,t,s)),r}return e};return{saveAsPNG:function(e,t,s,r,o){if(!i)return!1;const a=l(e,s,r,o).toDataURL("image/png");return t?h(a):(n(a),!0)},saveAsJPEG:function(e,t,s,r,o){if(!i)return!1;const a="image/jpeg",u=l(e,s,r,o).toDataURL(a);return 5==u.indexOf(a)&&(t?h(u):(n(u),!0))},saveAsBMP:function(e,t,u,c,p){if(!(i&&s&&r))return!1;const d="image/bmp",m=function(e){const t=parseInt(e.width),s=parseInt(e.height);return e.getContext("2d").getImageData(0,0,t,s)}(l(e,u,c,p)),f=o(m);return t?h(a(f,d)):(n(a(f,d)),!0)}}}();class je{constructor(e,t,s){s=s||{},this.gl=t,this.allocated=!1,this.canvas=e,this.buffer=null,this.bound=!1,this.size=s.size,this._hasDepthTexture=!!s.depthTexture}setSize(e){this.size=e}webglContextRestored(e){this.gl=e,this.buffer=null,this.allocated=!1,this.bound=!1}bind(){if(this._touch(),this.bound)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.buffer.framebuf),this.bound=!0}_touch(){let e,t;const s=this.gl;if(this.size?(e=this.size[0],t=this.size[1]):(e=s.drawingBufferWidth,t=s.drawingBufferHeight),this.buffer){if(this.buffer.width===e&&this.buffer.height===t)return;s.deleteTexture(this.buffer.texture),s.deleteFramebuffer(this.buffer.framebuf),s.deleteRenderbuffer(this.buffer.renderbuf)}const i=s.createTexture();let r;s.bindTexture(s.TEXTURE_2D,i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,null),this._hasDepthTexture&&(r=s.createTexture(),s.bindTexture(s.TEXTURE_2D,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texImage2D(s.TEXTURE_2D,0,s.DEPTH_COMPONENT32F,e,t,0,s.DEPTH_COMPONENT,s.FLOAT,null));const o=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,o),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT32F,e,t);const n=s.createFramebuffer();if(s.bindFramebuffer(s.FRAMEBUFFER,n),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,i,0),this._hasDepthTexture?s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,r,0):s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,o),s.bindTexture(s.TEXTURE_2D,null),s.bindRenderbuffer(s.RENDERBUFFER,null),s.bindFramebuffer(s.FRAMEBUFFER,null),s.bindFramebuffer(s.FRAMEBUFFER,n),!s.isFramebuffer(n))throw"Invalid framebuffer";s.bindFramebuffer(s.FRAMEBUFFER,null);const a=s.checkFramebufferStatus(s.FRAMEBUFFER);switch(a){case s.FRAMEBUFFER_COMPLETE:break;case s.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case s.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case s.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case s.FRAMEBUFFER_UNSUPPORTED:throw"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED";default:throw"Incomplete framebuffer: "+a}this.buffer={framebuf:n,renderbuf:o,texture:i,depthTexture:r,width:e,height:t},this.bound=!1}clear(){if(!this.bound)throw"Render buffer not bound";const e=this.gl;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}read(e,t){const s=e,i=this.gl.drawingBufferHeight-t,r=new Uint8Array(4),o=this.gl;return o.readPixels(s,i,1,1,o.RGBA,o.UNSIGNED_BYTE,r),r}readImage(e){const t=this.gl,s=this._getImageDataCache(),i=s.pixelData,r=s.canvas,o=s.imageData,n=s.context;t.readPixels(0,0,this.buffer.width,this.buffer.height,t.RGBA,t.UNSIGNED_BYTE,i),o.data.set(i),n.putImageData(o,0,0);const a=e.width||r.width,h=e.height||r.height,l=e.format||"jpeg",u=!0;let c;switch(l){case"jpeg":c=ke.saveAsJPEG(r,!0,a,h,u);break;case"png":c=ke.saveAsPNG(r,!0,a,h,u);break;case"bmp":c=ke.saveAsBMP(r,!0,a,h,u);break;default:console.error("Unsupported image format: '"+l+"' - supported types are 'jpeg', 'bmp' and 'png' - defaulting to 'jpeg'"),c=ke.saveAsJPEG(r,!0,a,h,u)}return c.src}_getImageDataCache(){const e=this.buffer.width,t=this.buffer.height;let s=this._imageDataCache;if(s&&(s.width===e&&s.height===t||(this._imageDataCache=null,s=null)),!s){const i=document.createElement("canvas");i.width=e,i.height=t;const r=i.getContext("2d"),o=r.createImageData(e,t);s={pixelData:new Uint8Array(e*t*4),canvas:i,context:r,imageData:o,width:e,height:t},this._imageDataCache=s}return s}unbind(){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),this.bound=!1}getTexture(){const e=this;return this._texture||(this._texture={renderBuffer:this,bind:function(t){return!(!e.buffer||!e.buffer.texture)&&(e.gl.activeTexture(e.gl["TEXTURE"+t]),e.gl.bindTexture(e.gl.TEXTURE_2D,e.buffer.texture),!0)},unbind:function(t){e.buffer&&e.buffer.texture&&(e.gl.activeTexture(e.gl["TEXTURE"+t]),e.gl.bindTexture(e.gl.TEXTURE_2D,null))}})}hasDepthTexture(){return this._hasDepthTexture}getDepthTexture(){if(!this._hasDepthTexture)return null;const e=this;return this._depthTexture||(this._dethTexture={renderBuffer:this,bind:function(t){return!(!e.buffer||!e.buffer.depthTexture)&&(e.gl.activeTexture(e.gl["TEXTURE"+t]),e.gl.bindTexture(e.gl.TEXTURE_2D,e.buffer.depthTexture),!0)},unbind:function(t){e.buffer&&e.buffer.depthTexture&&(e.gl.activeTexture(e.gl["TEXTURE"+t]),e.gl.bindTexture(e.gl.TEXTURE_2D,null))}})}destroy(){if(this.allocated){const e=this.gl;e.deleteTexture(this.buffer.texture),e.deleteTexture(this.buffer.depthTexture),e.deleteFramebuffer(this.buffer.framebuf),e.deleteRenderbuffer(this.buffer.renderbuf),this.allocated=!1,this.buffer=null,this.bound=!1}this._imageDataCache=null,this._texture=null,this._depthTexture=null}}class Ge{constructor(e){this.scene=e,this._renderBuffersBasic={},this._renderBuffersScaled={}}getRenderBuffer(e,t){const s=1===this.scene.canvas.resolutionScale?this._renderBuffersBasic:this._renderBuffersScaled;let i=s[e];return i||(i=new je(this.scene.canvas.canvas,this.scene.canvas.gl,t),s[e]=i),i}destroy(){for(let e in this._renderBuffersBasic)this._renderBuffersBasic[e].destroy();for(let e in this._renderBuffersScaled)this._renderBuffersScaled[e].destroy()}}function He(e,t){if(void 0===e._cachedExtensions&&(e._cachedExtensions={}),void 0!==e._cachedExtensions[t])return e._cachedExtensions[t];let s;switch(t){case"WEBGL_depth_texture":s=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=e.getExtension(t)}return e._cachedExtensions[t]=s,s}var Ve=function(){const e=[],t=[],s=[],i=[],r=[];let o=0;const n=new Uint16Array(3),a=new Uint16Array(3),h=new Uint16Array(3),l=p.vec3(),u=p.vec3(),c=p.vec3(),d=p.vec3(),m=p.vec3(),f=p.vec3(),g=p.vec3();return function(_,y,v,b){!function(r,o){const n={};let a,h,l,u;const c=Math.pow(10,4);let p,d,m=0;for(p=0,d=r.length;p<d;p+=3)a=r[p],h=r[p+1],l=r[p+2],u=Math.round(a*c)+"_"+Math.round(h*c)+"_"+Math.round(l*c),void 0===n[u]&&(n[u]=m/3,e[m++]=a,e[m++]=h,e[m++]=l),t[p/3]=n[u];for(p=0,d=o.length;p<d;p++)i[p]=t[o[p]],s[i[p]]=o[p]}(_,y),function(t,s){o=0;for(let _=0,y=t;_<y;_+=3){const t=3*i[_],y=3*i[_+1],v=3*i[_+2];s?(n[0]=e[t],n[1]=e[t+1],n[2]=e[t+2],a[0]=e[y],a[1]=e[y+1],a[2]=e[y+2],h[0]=e[v],h[1]=e[v+1],h[2]=e[v+2],p.decompressPosition(n,s,l),p.decompressPosition(a,s,u),p.decompressPosition(h,s,c)):(l[0]=e[t],l[1]=e[t+1],l[2]=e[t+2],u[0]=e[y],u[1]=e[y+1],u[2]=e[y+2],c[0]=e[v],c[1]=e[v+1],c[2]=e[v+2]),p.subVec3(c,u,d),p.subVec3(l,u,m),p.cross3Vec3(d,m,f),p.normalizeVec3(f,g);const b=r[o]||(r[o]={normal:p.vec3()});b.normal[0]=g[0],b.normal[1]=g[1],b.normal[2]=g[2],o++}}(y.length,v);const x=[],P=Math.cos(p.DEGTORAD*b),T={};let w,M,I,C,D,A,E,F,R,S,O,B=!1;for(let e=0,t=y.length;e<t;e+=3){const t=e/3;for(let s=0;s<3;s++)w=i[e+s],M=i[e+(s+1)%3],I=Math.min(w,M),C=Math.max(w,M),D=I+","+C,void 0===T[D]?T[D]={index1:I,index2:C,face1:t,face2:void 0}:T[D].face2=t}for(D in T)A=T[D],void 0!==A.face2&&(E=r[A.face1].normal,F=r[A.face2].normal,R=p.dotVec3(E,F),R>P)||(S=s[A.index1],O=s[A.index2],(!B&&S>65535||O>65535)&&(B=!0),x.push(S),x.push(O));return B?new Uint32Array(x):new Uint16Array(x)}}();class Ue{constructor(e,t,s,i,r=null,o=0){this.model=e,this.object=null,this.parent=null,this.id=t,this.pickId=this.model.scene._renderer.getPickID(this),this.aabb=p.AABB3(),this._layer=r,this._portionId=o,this._color=[s[0],s[1],s[2],i],this._colorize=[s[0],s[1],s[2],i],this._colorizing=!1,this._transparent=i<255,this.numTriangles=0,this.origin=null}_finalize(e){this._layer.initFlags(this._portionId,e,this._transparent)}_finalize2(){this._layer.flushInitFlags&&this._layer.flushInitFlags()}_setVisible(e){this._layer.setVisible(this._portionId,e,this._transparent)}_setColor(e){this._color[0]=e[0],this._color[1]=e[1],this._color[2]=e[2],this._colorizing||this._layer.setColor(this._portionId,this._color,!1)}_setColorize(e){e?(this._colorize[0]=e[0],this._colorize[1]=e[1],this._colorize[2]=e[2],this._layer.setColor(this._portionId,this._colorize,false),this._colorizing=!0):(this._layer.setColor(this._portionId,this._color,false),this._colorizing=!1)}_setOpacity(e,t){const s=e<255,i=this._transparent!==s;this._color[3]=e,this._colorize[3]=e,this._transparent=s,this._colorizing?this._layer.setColor(this._portionId,this._colorize):this._layer.setColor(this._portionId,this._color),i&&this._layer.setTransparent(this._portionId,t,s)}_setOffset(e){this._layer.setOffset(this._portionId,e)}_setHighlighted(e){this._layer.setHighlighted(this._portionId,e,this._transparent)}_setXRayed(e){this._layer.setXRayed(this._portionId,e,this._transparent)}_setSelected(e){this._layer.setSelected(this._portionId,e,this._transparent)}_setEdges(e){this._layer.setEdges(this._portionId,e,this._transparent)}_setClippable(e){this._layer.setClippable(this._portionId,e,this._transparent)}_setCollidable(e){this._layer.setCollidable(this._portionId,e)}_setPickable(e){this._layer.setPickable(this._portionId,e,this._transparent)}_setCulled(e){this._layer.setCulled(this._portionId,e,this._transparent)}canPickTriangle(){return!1}drawPickTriangles(e,t){}pickTriangleSurface(e){}precisionRayPickSurface(e,t,s,i){return!!this._layer.precisionRayPickSurface&&this._layer.precisionRayPickSurface(this._portionId,e,t,s,i)}canPickWorldPos(){return!0}drawPickDepths(e){this.model.drawPickDepths(e)}drawPickNormals(e){this.model.drawPickNormals(e)}delegatePickedEntity(){return this.parent}_destroy(){this.model.scene._renderer.putPickID(this.pickId)}}const ze=1,We=4,Xe=8,Ye=16,Ke=32,Je=256,Ze=512,Qe=1024,qe=2048,$e=new Float32Array([0,0,0]),et=new Uint16Array([0,0,0]);class tt{constructor(e,t,s,i,r,o){this._isObject=t,this.scene=e.scene,this.model=e,this.meshes=i,this._numTriangles=0;for(var n=0,a=this.meshes.length;n<a;n++){const e=this.meshes[n];e.parent=this,this._numTriangles+=e.numTriangles}this.id=s,this.originalSystemId=p.unglobalizeObjectId(e.id,s),this._flags=r,this._aabb=o,this._offsetAABB=p.AABB3(o),this._offset=p.vec3(),this._colorizeUpdated=!1,this._opacityUpdated=!1,this._culled=!1,this._culledVFC=!1,this._culledLOD=!1,this._isObject&&e.scene._registerObject(this)}get isEntity(){return!0}get isModel(){return!1}get isObject(){return this._isObject}get aabb(){return this._offsetAABB}get numTriangles(){return this._numTriangles}get visible(){return this._getFlag(ze)}set visible(e){if(!!(this._flags&ze)!==e){this._flags=e?this._flags|ze:this._flags&~ze;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setVisible(this._flags);this._isObject&&this.model.scene._objectVisibilityUpdated(this),this.model.glRedraw()}}get highlighted(){return this._getFlag(Ze)}set highlighted(e){if(!!(this._flags&Ze)!==e){this._flags=e?this._flags|Ze:this._flags&~Ze;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setHighlighted(this._flags);this._isObject&&this.model.scene._objectHighlightedUpdated(this),this.model.glRedraw()}}get xrayed(){return this._getFlag(Je)}set xrayed(e){if(!!(this._flags&Je)!==e){this._flags=e?this._flags|Je:this._flags&~Je;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setXRayed(this._flags);this._isObject&&this.model.scene._objectXRayedUpdated(this),this.model.glRedraw()}}get selected(){return this._getFlag(Qe)}set selected(e){if(!!(this._flags&Qe)!==e){this._flags=e?this._flags|Qe:this._flags&~Qe;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setSelected(this._flags);this._isObject&&this.model.scene._objectSelectedUpdated(this),this.model.glRedraw()}}get edges(){return this._getFlag(qe)}set edges(e){if(!!(this._flags&qe)!==e){this._flags=e?this._flags|qe:this._flags&~qe;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setEdges(this._flags);this.model.glRedraw()}}get culledVFC(){return!!this._culledVFC}set culledVFC(e){this._culledVFC=e,this.internalSetCulled()}get culledLOD(){return!!this._culledLOD}set culledLOD(e){this._culledLOD=e,this.internalSetCulled()}get culled(){return!!this._culled}set culled(e){this._culled=e,this.internalSetCulled()}internalSetCulled(){let e=!!this._culled||!!this._culledLOD||!!this._culledVFC;if(!!(this._flags&We)!==e){this._flags=e?this._flags|We:this._flags&~We;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setCulled(this._flags);this.model.glRedraw()}}get clippable(){return this._getFlag(Ye)}set clippable(e){if(!!(this._flags&Ye)!==e){this._flags=e?this._flags|Ye:this._flags&~Ye;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setClippable(this._flags);this.model.glRedraw()}}get collidable(){return this._getFlag(Ke)}set collidable(e){if(!!(this._flags&Ke)!==e){this._flags=e?this._flags|Ke:this._flags&~Ke;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setCollidable(this._flags)}}get pickable(){return this._getFlag(Xe)}set pickable(e){if(!!(this._flags&Xe)!==e){this._flags=e?this._flags|Xe:this._flags&~Xe;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setPickable(this._flags)}}get colorize(){if(0===this.meshes.length)return null;const e=this.meshes[0]._colorize;return $e[0]=e[0]/255,$e[1]=e[1]/255,$e[2]=e[2]/255,$e}set colorize(e){if(e){et[0]=Math.floor(255*e[0]),et[1]=Math.floor(255*e[1]),et[2]=Math.floor(255*e[2]);for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setColorize(et)}else for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setColorize(null);if(this._isObject){const t=!!e;this.scene._objectColorizeUpdated(this,t),this._colorizeUpdated=t}this.model.glRedraw()}get opacity(){return this.meshes.length>0?this.meshes[0]._colorize[3]/255:1}set opacity(e){if(0===this.meshes.length)return;const t=null!=e,s=this.meshes[0]._colorize[3];let i=255;if(t){if(e<0?e=0:e>1&&(e=1),i=Math.floor(255*e),s===i)return}else if(i=255,s===i)return;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setOpacity(i,this._flags);this._isObject&&(this.scene._objectOpacityUpdated(this,t),this._opacityUpdated=t),this.model.glRedraw()}get offset(){return this._offset}set offset(e){e?(this._offset[0]=e[0],this._offset[1]=e[1],this._offset[2]=e[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setOffset(this._offset);this._offsetAABB[0]=this._aabb[0]+this._offset[0],this._offsetAABB[1]=this._aabb[1]+this._offset[1],this._offsetAABB[2]=this._aabb[2]+this._offset[2],this._offsetAABB[3]=this._aabb[3]+this._offset[0],this._offsetAABB[4]=this._aabb[4]+this._offset[1],this._offsetAABB[5]=this._aabb[5]+this._offset[2],this.scene._aabbDirty=!0,this.scene._objectOffsetUpdated(this,e),this.model._aabbDirty=!0,this.model.glRedraw()}get castsShadow(){return!1}set castsShadow(e){}get receivesShadow(){return!1}set receivesShadow(e){}get saoEnabled(){return this.model.saoEnabled}_getFlag(e){return!!(this._flags&e)}_finalize(){const e=this.model.scene;this._isObject&&(this.visible&&e._objectVisibilityUpdated(this),this.highlighted&&e._objectHighlightedUpdated(this),this.xrayed&&e._objectXRayedUpdated(this),this.selected&&e._objectSelectedUpdated(this));for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._finalize(this._flags)}_finalize2(){for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._finalize2()}_destroy(){const e=this.model.scene;this._isObject&&(e._deregisterObject(this),this.visible&&e._objectVisibilityUpdated(this,!1),this.xrayed&&e._objectXRayedUpdated(this),this.selected&&e._objectSelectedUpdated(this),this.highlighted&&e._objectHighlightedUpdated(this),this._opacityUpdated&&this.scene._objectColorizeUpdated(this,!1),this._opacityUpdated&&this.scene._objectOpacityUpdated(this,!1),this.scene._objectOffsetUpdated(this,!1));for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._destroy();e._aabbDirty=!0}}const st=0,it=1,rt=2,ot=3,nt=4,at=5,ht=6,lt=7,ut=8,ct=9,pt=10,dt=11,mt=new e({});class ft{constructor(e){this.id=mt.addItem({});for(const t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}destroy(){mt.removeItem(this.id)}}const gt=function(){const e=p.mat4(),t=p.mat4();return function(s,i){i=i||p.mat4();const r=s[0],o=s[1],n=s[2],a=s[3]-r,h=s[4]-o,l=s[5]-n,u=65535;return p.identityMat4(e),p.translationMat4v(s,e),p.identityMat4(t),p.scalingMat4v([a/u,h/u,l/u],t),p.mulMat4(e,t,i),i}}();var _t=function(){const e=p.mat4(),t=p.mat4();return function(s,i,r){const o=new Uint16Array(s.length),n=new Float32Array([r[0]!==i[0]?65535/(r[0]-i[0]):0,r[1]!==i[1]?65535/(r[1]-i[1]):0,r[2]!==i[2]?65535/(r[2]-i[2]):0]);let a;for(a=0;a<s.length;a+=3)o[a+0]=Math.max(0,Math.min(65535,Math.floor((s[a+0]-i[0])*n[0]))),o[a+1]=Math.max(0,Math.min(65535,Math.floor((s[a+1]-i[1])*n[1]))),o[a+2]=Math.max(0,Math.min(65535,Math.floor((s[a+2]-i[2])*n[2])));p.identityMat4(e),p.translationMat4v(i,e),p.identityMat4(t),p.scalingMat4v([(r[0]-i[0])/65535,(r[1]-i[1])/65535,(r[2]-i[2])/65535],t);return{quantized:o,decodeMatrix:p.mulMat4(e,t,p.identityMat4())}}}();var yt=function(){const e=p.mat3(),t=p.mat3();return function(s,i,r){const o=new Uint16Array(s.length),n=new Float32Array([65535/(r[0]-i[0]),65535/(r[1]-i[1])]);let a;for(a=0;a<s.length;a+=2)o[a+0]=Math.max(0,Math.min(65535,Math.floor((s[a+0]-i[0])*n[0]))),o[a+1]=Math.max(0,Math.min(65535,Math.floor((s[a+1]-i[1])*n[1])));p.identityMat3(e),p.translationMat3v(i,e),p.identityMat3(t),p.scalingMat3v([(r[0]-i[0])/65535,(r[1]-i[1])/65535],t);return{quantized:o,decodeMatrix:p.mulMat3(e,t,p.identityMat3())}}}();function vt(e,t,s,i){let r=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),o=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){let e=(1-Math.abs(o))*(r>=0?1:-1),t=(1-Math.abs(r))*(o>=0?1:-1);r=e,o=t}return new Int8Array([Math[s](127.5*r+(r<0?-1:0)),Math[i](127.5*o+(o<0?-1:0))])}function bt(e){let t=e[0],s=e[1];t/=t<0?127:128,s/=s<0?127:128;const i=1-Math.abs(t)-Math.abs(s);i<0&&(t=(1-Math.abs(s))*(t>=0?1:-1),s=(1-Math.abs(t))*(s>=0?1:-1));const r=Math.sqrt(t*t+s*s+i*i);return[t/r,s/r,i/r]}function xt(e,t,s){return e[t]*s[0]+e[t+1]*s[1]+e[t+2]*s[2]}const Pt={getPositionsBounds:function(e){const t=new Float32Array(3),s=new Float32Array(3);let i,r;for(i=0;i<3;i++)t[i]=Number.MAX_VALUE,s[i]=-Number.MAX_VALUE;for(i=0;i<e.length;i+=3)for(r=0;r<3;r++)t[r]=Math.min(t[r],e[i+r]),s[r]=Math.max(s[r],e[i+r]);return{min:t,max:s}},createPositionsDecodeMatrix:gt,compressPositions:_t,compressPosition:function(e,t,s){const i=new Float32Array([t[3]!==t[0]?65535/(t[3]-t[0]):0,t[4]!==t[1]?65535/(t[4]-t[1]):0,t[5]!==t[2]?65535/(t[5]-t[2]):0]);s[0]=Math.max(0,Math.min(65535,Math.floor((e[0]-t[0])*i[0]))),s[1]=Math.max(0,Math.min(65535,Math.floor((e[1]-t[1])*i[1]))),s[2]=Math.max(0,Math.min(65535,Math.floor((e[2]-t[2])*i[2])))},decompressPositions:function(e,t,s=new Float32Array(e.length)){for(let i=0,r=e.length;i<r;i+=3)s[i+0]=e[i+0]*t[0]+t[12],s[i+1]=e[i+1]*t[5]+t[13],s[i+2]=e[i+2]*t[10]+t[14];return s},decompressPosition:function(e,t,s){return s[0]=e[0]*t[0]+t[12],s[1]=e[1]*t[5]+t[13],s[2]=e[2]*t[10]+t[14],s},decompressAABB:function(e,t,s=e){return s[0]=e[0]*t[0]+t[12],s[1]=e[1]*t[5]+t[13],s[2]=e[2]*t[10]+t[14],s[3]=e[3]*t[0]+t[12],s[4]=e[4]*t[5]+t[13],s[5]=e[5]*t[10]+t[14],s},getUVBounds:function(e){const t=new Float32Array(2),s=new Float32Array(2);let i,r;for(i=0;i<2;i++)t[i]=Number.MAX_VALUE,s[i]=-Number.MAX_VALUE;for(i=0;i<e.length;i+=2)for(r=0;r<2;r++)t[r]=Math.min(t[r],e[i+r]),s[r]=Math.max(s[r],e[i+r]);return{min:t,max:s}},compressUVs:yt,decompressUVs:function(e,t,s=new Float32Array(e.length)){for(let i=0,r=e.length;i<r;i+=3)s[i+0]=e[i+0]*t[0]+t[6],s[i+1]=e[i+1]*t[4]+t[7];return s},decompressUV:function(e,t,s){s[0]=e[0]*t[0]+t[6],s[1]=e[1]*t[4]+t[7]},compressNormals:function(e){const t=new Int8Array(e.length);let s,i,r,o,n;for(let a=0;a<e.length;a+=3)r=s=vt(e,a,"floor","floor"),i=bt(s),o=n=xt(e,a,i),s=vt(e,a,"ceil","floor"),i=bt(s),o=xt(e,a,i),o>n&&(r=s,n=o),s=vt(e,a,"floor","ceil"),i=bt(s),o=xt(e,a,i),o>n&&(r=s,n=o),s=vt(e,a,"ceil","ceil"),i=bt(s),o=xt(e,a,i),o>n&&(r=s,n=o),t[a]=r[0],t[a+1]=r[1];return t},decompressNormals:function(e,t){for(let s=0,i=0,r=e.length;s<r;s+=2){let r=e[s+0],o=e[s+1];r=(2*r+1)/255,o=(2*o+1)/255;const n=1-Math.abs(r)-Math.abs(o);n<0&&(r=(1-Math.abs(o))*(r>=0?1:-1),o=(1-Math.abs(r))*(o>=0?1:-1));const a=Math.sqrt(r*r+o*o+n*n);t[i+0]=r/a,t[i+1]=o/a,t[i+2]=n/a,i+=3}return t},decompressNormal:function(e,t){let s=e[0],i=e[1];s=(2*s+1)/255,i=(2*i+1)/255;const r=1-Math.abs(s)-Math.abs(i);r<0&&(s=(1-Math.abs(i))*(s>=0?1:-1),i=(1-Math.abs(s))*(i>=0?1:-1));const o=Math.sqrt(s*s+i*i+r*r);return t[0]=s/o,t[1]=i/o,t[2]=r/o,t}};class Tt extends A{get type(){return"Perspective"}constructor(e,t={}){super(e,t),this.camera=e,this._state=new ft({matrix:p.mat4(),inverseMatrix:p.mat4(),transposedMatrix:p.mat4(),near:.1,far:2e3}),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this._fov=60,this._canvasResized=this.scene.canvas.on("boundary",this._needUpdate,this),this.fov=t.fov,this.fovAxis=t.fovAxis,this.near=t.near,this.far=t.far}_update(){const e=this.scene.viewport.boundary,t=e[2]/e[3],s=this._fovAxis;let i=this._fov;("x"===s||"min"===s&&t<1||"max"===s&&t>1)&&(i/=t),i=Math.min(i,120),p.perspectiveMat4(i*(Math.PI/180),t,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}set fov(e){(e=null!=e?e:60)!==this._fov&&(this._fov=e,this._needUpdate(0),this.fire("fov",this._fov))}get fov(){return this._fov}set fovAxis(e){e=e||"min",this._fovAxis!==e&&("x"!==e&&"y"!==e&&"min"!==e&&(this.error("Unsupported value for 'fovAxis': "+e+" - defaulting to 'min'"),e="min"),this._fovAxis=e,this._needUpdate(0),this.fire("fovAxis",this._fovAxis))}get fovAxis(){return this._fovAxis}set near(e){const t=null!=e?e:.1;this._state.near!==t&&(this._state.near=t,this._needUpdate(0),this.fire("near",this._state.near))}get near(){return this._state.near}set far(e){const t=null!=e?e:2e3;this._state.far!==t&&(this._state.far=t,this._needUpdate(0),this.fire("far",this._state.far))}get far(){return this._state.far}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(p.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(p.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(e,t,s,i,r){const o=this.scene.canvas.canvas,n=o.offsetWidth/2,a=o.offsetHeight/2;return s[0]=(e[0]-n)/n,s[1]=(e[1]-a)/a,s[2]=t,s[3]=1,p.mulMat4v4(this.inverseMatrix,s,i),p.mulVec3Scalar(i,1/i[3]),i[3]=1,i[1]*=-1,p.mulMat4v4(this.camera.inverseViewMatrix,i,r),r}destroy(){super.destroy(),this._state.destroy(),this.scene.canvas.off(this._canvasResized)}}class wt extends A{get type(){return"Ortho"}constructor(e,t={}){super(e,t),this.camera=e,this._state=new ft({matrix:p.mat4(),inverseMatrix:p.mat4(),transposedMatrix:p.mat4(),near:.1,far:2e3}),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.scale=t.scale,this.near=t.near,this.far=t.far,this._onCanvasBoundary=this.scene.canvas.on("boundary",this._needUpdate,this)}_update(){const e=this.scene,t=.5*this._scale,s=e.viewport.boundary,i=s[2],r=s[3],o=i/r;let n,a,h,l;i>r?(n=-t,a=t,h=t/o,l=-t/o):(n=-t*o,a=t*o,h=t,l=-t),p.orthoMat4c(n,a,l,h,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}set scale(e){null==e&&(e=1),e<=0&&(e=.01),this._scale=e,this._needUpdate(0),this.fire("scale",this._scale)}get scale(){return this._scale}set near(e){const t=null!=e?e:.1;this._state.near!==t&&(this._state.near=t,this._needUpdate(0),this.fire("near",this._state.near))}get near(){return this._state.near}set far(e){const t=null!=e?e:2e3;this._state.far!==t&&(this._state.far=t,this._needUpdate(0),this.fire("far",this._state.far))}get far(){return this._state.far}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(p.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(p.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(e,t,s,i,r){const o=this.scene.canvas.canvas,n=o.offsetWidth/2,a=o.offsetHeight/2;return s[0]=(e[0]-n)/n,s[1]=(e[1]-a)/a,s[2]=t,s[3]=1,p.mulMat4v4(this.inverseMatrix,s,i),p.mulVec3Scalar(i,1/i[3]),i[3]=1,i[1]*=-1,p.mulMat4v4(this.camera.inverseViewMatrix,i,r),r}destroy(){super.destroy(),this._state.destroy(),this.scene.canvas.off(this._onCanvasBoundary)}}class Mt extends A{get type(){return"Frustum"}constructor(e,t={}){super(e,t),this.camera=e,this._state=new ft({matrix:p.mat4(),inverseMatrix:p.mat4(),transposedMatrix:p.mat4(),near:.1,far:1e4}),this._left=-1,this._right=1,this._bottom=-1,this._top=1,this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.left=t.left,this.right=t.right,this.bottom=t.bottom,this.top=t.top,this.near=t.near,this.far=t.far}_update(){p.frustumMat4(this._left,this._right,this._bottom,this._top,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}set left(e){this._left=null!=e?e:-1,this._needUpdate(0),this.fire("left",this._left)}get left(){return this._left}set right(e){this._right=null!=e?e:1,this._needUpdate(0),this.fire("right",this._right)}get right(){return this._right}set top(e){this._top=null!=e?e:1,this._needUpdate(0),this.fire("top",this._top)}get top(){return this._top}set bottom(e){this._bottom=null!=e?e:-1,this._needUpdate(0),this.fire("bottom",this._bottom)}get bottom(){return this._bottom}set near(e){this._state.near=null!=e?e:.1,this._needUpdate(0),this.fire("near",this._state.near)}get near(){return this._state.near}set far(e){this._state.far=null!=e?e:1e4,this._needUpdate(0),this.fire("far",this._state.far)}get far(){return this._state.far}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(p.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(p.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(e,t,s,i,r){const o=this.scene.canvas.canvas,n=o.offsetWidth/2,a=o.offsetHeight/2;return s[0]=(e[0]-n)/n,s[1]=(e[1]-a)/a,s[2]=t,s[3]=1,p.mulMat4v4(this.inverseMatrix,s,i),p.mulVec3Scalar(i,1/i[3]),i[3]=1,i[1]*=-1,p.mulMat4v4(this.camera.inverseViewMatrix,i,r),r}destroy(){super.destroy(),this._state.destroy(),super.destroy()}}class It extends A{get type(){return"CustomProjection"}constructor(e,t={}){super(e,t),this.camera=e,this._state=new ft({matrix:p.mat4(),inverseMatrix:p.mat4(),transposedMatrix:p.mat4()}),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!1,this.matrix=t.matrix}set matrix(e){this._state.matrix.set(e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}get matrix(){return this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(p.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(p.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(e,t,s,i,r){const o=this.scene.canvas.canvas,n=o.offsetWidth/2,a=o.offsetHeight/2;return s[0]=(e[0]-n)/n,s[1]=(e[1]-a)/a,s[2]=t,s[3]=1,p.mulMat4v4(this.inverseMatrix,s,i),p.mulVec3Scalar(i,1/i[3]),i[3]=1,i[1]*=-1,p.mulMat4v4(this.camera.inverseViewMatrix,i,r),r}destroy(){super.destroy(),this._state.destroy()}}const Ct=p.vec3(),Dt=p.vec3(),At=p.vec3(),Et=p.vec3(),Ft=p.vec3(),Rt=p.vec3(),St=p.mat4(),Ot=p.mat4(),Bt=p.vec3(),Lt=p.vec3(),Nt=p.vec3(),kt=p.vec3();class jt extends A{get type(){return"Camera"}constructor(e,t={}){super(e,t),this._state=new ft({deviceMatrix:p.mat4(),hasDeviceMatrix:!1,matrix:p.mat4(),normalMatrix:p.mat4(),inverseMatrix:p.mat4()}),this._perspective=new Tt(this),this._ortho=new wt(this),this._frustum=new Mt(this),this._customProjection=new It(this),this._project=this._perspective,this._eye=p.vec3([0,0,10]),this._look=p.vec3([0,0,0]),this._up=p.vec3([0,1,0]),this._worldUp=p.vec3([0,1,0]),this._worldRight=p.vec3([1,0,0]),this._worldForward=p.vec3([0,0,-1]),this.deviceMatrix=t.deviceMatrix,this.eye=t.eye,this.look=t.look,this.up=t.up,this.worldAxis=t.worldAxis,this.gimbalLock=t.gimbalLock,this.constrainPitch=t.constrainPitch,this.projection=t.projection,this._perspective.on("matrix",(()=>{"perspective"===this._projectionType&&this.fire("projMatrix",this._perspective.matrix)})),this._ortho.on("matrix",(()=>{"ortho"===this._projectionType&&this.fire("projMatrix",this._ortho.matrix)})),this._frustum.on("matrix",(()=>{"frustum"===this._projectionType&&this.fire("projMatrix",this._frustum.matrix)})),this._customProjection.on("matrix",(()=>{"customProjection"===this._projectionType&&this.fire("projMatrix",this._customProjection.matrix)}))}_update(){const e=this._state;let t;"ortho"===this.projection?(p.subVec3(this._eye,this._look,Bt),p.normalizeVec3(Bt,Lt),p.mulVec3Scalar(Lt,1e3,Nt),p.addVec3(this._look,Nt,kt),t=kt):t=this._eye,e.hasDeviceMatrix?(p.lookAtMat4v(t,this._look,this._up,Ot),p.mulMat4(e.deviceMatrix,Ot,e.matrix)):p.lookAtMat4v(t,this._look,this._up,e.matrix),p.inverseMat4(this._state.matrix,this._state.inverseMatrix),p.transposeMat4(this._state.inverseMatrix,this._state.normalMatrix),this.glRedraw(),this.fire("matrix",this._state.matrix),this.fire("viewMatrix",this._state.matrix)}orbitYaw(e){let t=p.subVec3(this._eye,this._look,Ct);p.rotationMat4v(.0174532925*e,this._gimbalLock?this._worldUp:this._up,St),t=p.transformPoint3(St,t,Dt),this.eye=p.addVec3(this._look,t,At),this.up=p.transformPoint3(St,this._up,Et)}orbitPitch(e){if(this._constrainPitch&&(e=p.dotVec3(this._up,this._worldUp)/p.DEGTORAD)<1)return;let t=p.subVec3(this._eye,this._look,Ct);const s=p.cross3Vec3(p.normalizeVec3(t,Dt),p.normalizeVec3(this._up,At));p.rotationMat4v(.0174532925*e,s,St),t=p.transformPoint3(St,t,Et),this.up=p.transformPoint3(St,this._up,Ft),this.eye=p.addVec3(t,this._look,Rt)}yaw(e){let t=p.subVec3(this._look,this._eye,Ct);p.rotationMat4v(.0174532925*e,this._gimbalLock?this._worldUp:this._up,St),t=p.transformPoint3(St,t,Dt),this.look=p.addVec3(t,this._eye,At),this._gimbalLock&&(this.up=p.transformPoint3(St,this._up,Et))}pitch(e){if(this._constrainPitch&&(e=p.dotVec3(this._up,this._worldUp)/p.DEGTORAD)<1)return;let t=p.subVec3(this._look,this._eye,Ct);const s=p.cross3Vec3(p.normalizeVec3(t,Dt),p.normalizeVec3(this._up,At));p.rotationMat4v(.0174532925*e,s,St),this.up=p.transformPoint3(St,this._up,Rt),t=p.transformPoint3(St,t,Et),this.look=p.addVec3(t,this._eye,Ft)}pan(e){const t=p.subVec3(this._eye,this._look,Ct),s=[0,0,0];let i;if(0!==e[0]){const r=p.cross3Vec3(p.normalizeVec3(t,[]),p.normalizeVec3(this._up,Dt));i=p.mulVec3Scalar(r,e[0]),s[0]+=i[0],s[1]+=i[1],s[2]+=i[2]}0!==e[1]&&(i=p.mulVec3Scalar(p.normalizeVec3(this._up,At),e[1]),s[0]+=i[0],s[1]+=i[1],s[2]+=i[2]),0!==e[2]&&(i=p.mulVec3Scalar(p.normalizeVec3(t,Et),e[2]),s[0]+=i[0],s[1]+=i[1],s[2]+=i[2]),this.eye=p.addVec3(this._eye,s,Ft),this.look=p.addVec3(this._look,s,Rt)}zoom(e){const t=p.subVec3(this._eye,this._look,Ct),s=Math.abs(p.lenVec3(t,Dt)),i=Math.abs(s+e);if(i<.5)return;const r=p.normalizeVec3(t,At);this.eye=p.addVec3(this._look,p.mulVec3Scalar(r,i),Et)}set eye(e){this._eye.set(e||[0,0,10]),this._needUpdate(0),this.fire("eye",this._eye)}get eye(){return this._eye}set look(e){this._look.set(e||[0,0,0]),this._needUpdate(0),this.fire("look",this._look)}get look(){return this._look}set up(e){this._up.set(e||[0,1,0]),this._needUpdate(0),this.fire("up",this._up)}get up(){return this._up}set deviceMatrix(e){this._state.deviceMatrix.set(e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._state.hasDeviceMatrix=!!e,this._needUpdate(0),this.fire("deviceMatrix",this._state.deviceMatrix)}get deviceMatrix(){return this._state.deviceMatrix}set worldAxis(e){e=e||[1,0,0,0,1,0,0,0,1],this._worldAxis?this._worldAxis.set(e):this._worldAxis=p.vec3(e),this._worldRight[0]=this._worldAxis[0],this._worldRight[1]=this._worldAxis[1],this._worldRight[2]=this._worldAxis[2],this._worldUp[0]=this._worldAxis[3],this._worldUp[1]=this._worldAxis[4],this._worldUp[2]=this._worldAxis[5],this._worldForward[0]=this._worldAxis[6],this._worldForward[1]=this._worldAxis[7],this._worldForward[2]=this._worldAxis[8],this.fire("worldAxis",this._worldAxis)}get worldAxis(){return this._worldAxis}get worldUp(){return this._worldUp}get xUp(){return this._worldUp[0]>this._worldUp[1]&&this._worldUp[0]>this._worldUp[2]}get yUp(){return this._worldUp[1]>this._worldUp[0]&&this._worldUp[1]>this._worldUp[2]}get zUp(){return this._worldUp[2]>this._worldUp[0]&&this._worldUp[2]>this._worldUp[1]}get worldRight(){return this._worldRight}get worldForward(){return this._worldForward}set gimbalLock(e){this._gimbalLock=!1!==e,this.fire("gimbalLock",this._gimbalLock)}get gimbalLock(){return this._gimbalLock}set constrainPitch(e){this._constrainPitch=!!e,this.fire("constrainPitch",this._constrainPitch)}get eyeLookDist(){return p.lenVec3(p.subVec3(this._look,this._eye,Ct))}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get viewMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get normalMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.normalMatrix}get viewNormalMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.normalMatrix}get inverseViewMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.inverseMatrix}get projMatrix(){return this[this.projection].matrix}get perspective(){return this._perspective}get ortho(){return this._ortho}get frustum(){return this._frustum}get customProjection(){return this._customProjection}set projection(e){e=e||"perspective",this._projectionType!==e&&("perspective"===e?this._project=this._perspective:"ortho"===e?this._project=this._ortho:"frustum"===e?this._project=this._frustum:"customProjection"===e?this._project=this._customProjection:(this.error("Unsupported value for 'projection': "+e+" defaulting to 'perspective'"),this._project=this._perspective,e="perspective"),this._project._update(),this._projectionType=e,this.glRedraw(),this._update(),this.fire("dirty"),this.fire("projection",this._projectionType),this.fire("projMatrix",this._project.matrix))}get projection(){return this._projectionType}get project(){return this._project}destroy(){super.destroy(),this._state.destroy()}}const Gt=p.vec4(),Ht=p.vec3();class Vt{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,s){const i=this._scene,r=i.camera,o=t.model,n=i.canvas.gl,a=t._state,h=a.textureState,l=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e,a)),h.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets);let u=r.eye;e.pickViewMatrix&&(h.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),u=e.pickOrigin||u);const c=[u[0]-l[0],u[1]-l[1],u[2]-l[2]];n.uniform3fv(this._uCameraEyeRtc,c),n.uniform1i(this._uRenderPass,s);const p=i._sectionPlanesState.sectionPlanes.length;if(p>0){const e=i._sectionPlanesState.sectionPlanes,s=t.layerIndex*p,r=o.renderFlags;for(let t=0;t<p;t++){const i=this._uSectionPlanes[t];if(i){const o=r.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,o?1:0),o){const s=e[t];if(l){const e=X(s.dist,s.dir,l,Ht);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}a.numIndices8Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,8),n.drawArrays(n.TRIANGLES,0,a.numIndices8Bits)),a.numIndices16Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,16),n.drawArrays(n.TRIANGLES,0,a.numIndices16Bits)),a.numIndices32Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,32),n.drawArrays(n.TRIANGLES,0,a.numIndices32Bits)),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._lightsState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=i.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=i.getLocation("lightDir"+e),this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e)}this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdNormals="uTexturePerPolygonIdNormals",this._uTexturePerPolygonIdIndices="uTexturePerPolygonIdIndices",this._uTexturePerPolygonIdPortionIds="uTexturePerPolygonIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets",this._uCameraEyeRtc=i.getLocation("uCameraEyeRtc")}_bindProgram(e){const t=this._scene,s=t.canvas.gl,i=this._program,r=t._lightsState.lights,o=t.camera.project;i.bind(),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(let e=0,t=r.length;e<t;e++){const t=r[e];this._uLightColor[e]&&s.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(s.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&s.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&s.uniform3fv(this._uLightDir[e],t.dir)}if(this._withSAO){const i=t.sao;if(i.possible){const t=s.drawingBufferWidth,r=s.drawingBufferHeight;Gt[0]=t,Gt[1]=r,Gt[2]=i.blendCutoff,Gt[3]=i.blendFactor,s.uniform4fv(this._uSAOParams,Gt),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,10)}}if(t.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState,s=e._lightsState,i=t.sectionPlanes.length>0;let r;const o=[];o.push("#version 300 es"),o.push("// Triangles dataTexture draw vertex shader"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("precision highp usampler2D;"),o.push("precision highp isampler2D;"),o.push("precision highp sampler2D;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("precision mediump usampler2D;"),o.push("precision mediump isampler2D;"),o.push("precision mediump sampler2D;"),o.push("#endif"),o.push("uniform int renderPass;"),e.entityOffsetsEnabled&&o.push("in vec3 offset;"),o.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),o.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),o.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),o.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),o.push("uniform highp usampler2D uTexturePerPolygonIdIndices;"),o.push("uniform mediump usampler2D uTexturePerPolygonIdPortionIds;"),o.push("uniform highp sampler2D uTextureCameraMatrices;"),o.push("uniform highp sampler2D uTextureModelMatrices;"),o.push("uniform vec3 uCameraEyeRtc;"),o.push("vec3 positions[3];"),e.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),o.push("out float vFragDepth;"),o.push("out float isPerspective;")),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("uniform vec4 lightAmbient;");for(let e=0,t=s.lights.length;e<t;e++)r=s.lights[e],"ambient"!==r.type&&(o.push("uniform vec4 lightColor"+e+";"),"dir"===r.type&&o.push("uniform vec3 lightDir"+e+";"),"point"===r.type&&o.push("uniform vec3 lightPos"+e+";"),"spot"===r.type&&(o.push("uniform vec3 lightPos"+e+";"),o.push("uniform vec3 lightDir"+e+";")));i&&(o.push("out vec4 vWorldPosition;"),o.push("flat out uint vFlags2;")),o.push("out vec4 vColor;"),o.push("void main(void) {"),o.push("int polygonIndex = gl_VertexID / 3;"),o.push("int h_packed_object_id_index = (polygonIndex >> 3) & 4095;"),o.push("int v_packed_object_id_index = (polygonIndex >> 3) >> 12;"),o.push("int objectIndex = int(texelFetch(uTexturePerPolygonIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),o.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),o.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),o.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),o.push("if (int(flags.x) != renderPass) {"),o.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),o.push("   return;"),o.push("} else {"),o.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),o.push("mat4 viewNormalMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 1), 0));"),o.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),o.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),o.push("mat4 worldNormalMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 1), 0), texelFetch (uTextureModelMatrices, ivec2(1, 1), 0), texelFetch (uTextureModelMatrices, ivec2(2, 1), 0), texelFetch (uTextureModelMatrices, ivec2(3, 1), 0));"),o.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),o.push("ivec4 packedIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0));"),o.push("int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;"),o.push("int h_index = (polygonIndex - indexBaseOffset) & 4095;"),o.push("int v_index = (polygonIndex - indexBaseOffset) >> 12;"),o.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdIndices, ivec2(h_index, v_index), 0));"),o.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),o.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),o.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),o.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),o.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),o.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),o.push("uint solid = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0).r;"),o.push("positions[0] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.r, indexPositionV.r), 0));"),o.push("positions[1] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.g, indexPositionV.g), 0));"),o.push("positions[2] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.b, indexPositionV.b), 0));"),o.push("uvec4 color = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0);"),o.push("if (color.a == 0u) {"),o.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),o.push("   return;"),o.push("};"),o.push("vec3 normal = normalize(cross(positions[2] - positions[0], positions[1] - positions[0]));"),o.push("vec3 position;"),o.push("position = positions[gl_VertexID % 3];"),o.push("vec3 viewNormal = -normalize((transpose(inverse(viewMatrix*positionsDecodeMatrix)) * vec4(normal,1)).xyz);"),o.push("if (solid != 1u) {"),o.push("if (isPerspectiveMatrix(projMatrix)) {"),o.push("vec3 uCameraEyeRtcInQuantizedSpace = (inverse(worldMatrix * positionsDecodeMatrix) * vec4(uCameraEyeRtc, 1)).xyz;"),o.push("if (dot(position.xyz - uCameraEyeRtcInQuantizedSpace, normal) < 0.0) {"),o.push("position = positions[2 - (gl_VertexID % 3)];"),o.push("viewNormal = -viewNormal;"),o.push("}"),o.push("} else {"),o.push("if (viewNormal.z < 0.0) {"),o.push("position = positions[2 - (gl_VertexID % 3)];"),o.push("viewNormal = -viewNormal;"),o.push("}"),o.push("}"),o.push("}"),o.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),o.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),o.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),o.push("vec4 viewPosition = viewMatrix * worldPosition; "),o.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),o.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),o.push("float lambertian = 1.0;");for(let e=0,t=s.lights.length;e<t;e++)if(r=s.lights[e],"ambient"!==r.type){if("dir"===r.type)"view"===r.space?o.push("viewLightDir = normalize(lightDir"+e+");"):o.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===r.type)"view"===r.space?o.push("viewLightDir = -normalize(lightPos"+e+" - viewPosition.xyz);"):o.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==r.type)continue;"view"===r.space?o.push("viewLightDir = normalize(lightDir"+e+");"):o.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}o.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),o.push("reflectedColor += lambertian * (lightColor"+e+".rgb * lightColor"+e+".a);")}return o.push("vec3 rgb = vec3(color.rgb) / 255.0;"),o.push("vColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),o.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(o.push("vFragDepth = 1.0 + clipPos.w;"),o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i&&(o.push("vWorldPosition = worldPosition;"),o.push("vFlags2 = flags2.r;")),o.push("gl_Position = clipPos;"),o.push("}"),o.push("}"),o}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Triangles dataTexture draw fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),this._withSAO&&(i.push("uniform sampler2D uOcclusionTexture;"),i.push("uniform vec4      uSAOParams;"),i.push("const float       packUpscale = 256. / 255.;"),i.push("const float       unpackDownScale = 255. / 256.;"),i.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),i.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),i.push("float unpackRGBToFloat( const in vec4 v ) {"),i.push("    return dot( v, unPackFactors );"),i.push("}")),s){i.push("in vec4 vWorldPosition;"),i.push("flat in uint vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = vFlags2 > 0u;"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { "),i.push("      discard;"),i.push("  }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),this._withSAO?(i.push("   float viewportWidth     = uSAOParams[0];"),i.push("   float viewportHeight    = uSAOParams[1];"),i.push("   float blendCutoff       = uSAOParams[2];"),i.push("   float blendFactor       = uSAOParams[3];"),i.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),i.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),i.push("   outColor            = vec4(vColor.rgb * ambient, 1.0);")):i.push("   outColor            = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Ut=new Float32Array([1,1,1]);p.vec4();const zt=p.vec3();class Wt{constructor(e,t){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=this._scene,r=i.camera,o=t.model,n=i.canvas.gl,a=t._state,h=a.textureState,l=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e,a)),h.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets);let u=r.eye;e.pickViewMatrix&&(h.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),u=e.pickOrigin||u);const c=[u[0]-l[0],u[1]-l[1],u[2]-l[2]];if(n.uniform3fv(this._uCameraEyeRtc,c),n.uniform1i(this._uRenderPass,s),s===at){const e=i.xrayMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===ot){const e=i.highlightMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===nt){const e=i.selectedMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else n.uniform4fv(this._uColor,Ut);const p=i._sectionPlanesState.sectionPlanes.length;if(p>0){const e=i._sectionPlanesState.sectionPlanes,s=t.layerIndex*p,r=o.renderFlags;for(let t=0;t<p;t++){const i=this._uSectionPlanes[t];if(i){const o=r.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,o?1:0),o){const s=e[t];if(l){const e=X(s.dist,s.dir,l,zt);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}a.numIndices8Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,8),n.drawArrays(n.TRIANGLES,0,a.numIndices8Bits)),a.numIndices16Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,16),n.drawArrays(n.TRIANGLES,0,a.numIndices16Bits)),a.numIndices32Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,32),n.drawArrays(n.TRIANGLES,0,a.numIndices32Bits)),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uColor=s.getLocation("color"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdNormals="uTexturePerPolygonIdNormals",this._uTexturePerPolygonIdIndices="uTexturePerPolygonIdIndices",this._uTexturePerPolygonIdPortionIds="uTexturePerPolygonIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets",this._uCameraEyeRtc=s.getLocation("uCameraEyeRtc")}_bindProgram(e){const t=this._scene,s=t.canvas.gl,i=t.camera.project;if(this._program.bind(),t.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles dataTexture silhouette vertex shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("precision highp usampler2D;"),s.push("precision highp isampler2D;"),s.push("precision highp sampler2D;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("precision mediump usampler2D;"),s.push("precision mediump isampler2D;"),s.push("precision mediump sampler2D;"),s.push("#endif"),s.push("uniform int renderPass;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),s.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),s.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),s.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),s.push("uniform highp usampler2D uTexturePerPolygonIdIndices;"),s.push("uniform mediump usampler2D uTexturePerPolygonIdPortionIds;"),s.push("uniform highp sampler2D uTextureCameraMatrices;"),s.push("uniform highp sampler2D uTextureModelMatrices;"),s.push("uniform vec3 uCameraEyeRtc;"),s.push("vec3 positions[3];"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("out float isPerspective;")),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;"),t&&(s.push("out vec4 vWorldPosition;"),s.push("flat out uint vFlags2;")),s.push("void main(void) {"),s.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),s.push("mat4 viewNormalMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 1), 0));"),s.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),s.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),s.push("mat4 worldNormalMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 1), 0), texelFetch (uTextureModelMatrices, ivec2(1, 1), 0), texelFetch (uTextureModelMatrices, ivec2(2, 1), 0), texelFetch (uTextureModelMatrices, ivec2(3, 1), 0));"),s.push("int polygonIndex = gl_VertexID / 3;"),s.push("int h_packed_object_id_index = (polygonIndex >> 3) & 4095;"),s.push("int v_packed_object_id_index = (polygonIndex >> 3) >> 12;"),s.push("int objectIndex = int(texelFetch(uTexturePerPolygonIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),s.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),s.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),s.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),s.push("if (int(flags.y) != renderPass) {"),s.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),s.push("   return;"),s.push("} else {"),s.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),s.push("ivec4 packedIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0));"),s.push("int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;"),s.push("int h_index = (polygonIndex - indexBaseOffset) & 4095;"),s.push("int v_index = (polygonIndex - indexBaseOffset) >> 12;"),s.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdIndices, ivec2(h_index, v_index), 0));"),s.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),s.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),s.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),s.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),s.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),s.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),s.push("uint solid = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0).r;"),s.push("positions[0] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.r, indexPositionV.r), 0));"),s.push("positions[1] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.g, indexPositionV.g), 0));"),s.push("positions[2] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.b, indexPositionV.b), 0));"),s.push("vec3 normal = normalize(cross(positions[2] - positions[0], positions[1] - positions[0]));"),s.push("vec3 position;"),s.push("position = positions[gl_VertexID % 3];"),s.push("vec3 viewNormal = -normalize((transpose(inverse(viewMatrix*positionsDecodeMatrix)) * vec4(normal,1)).xyz);"),s.push("if (solid != 1u) {"),s.push("if (isPerspectiveMatrix(projMatrix)) {"),s.push("vec3 uCameraEyeRtcInQuantizedSpace = (inverse(worldMatrix * positionsDecodeMatrix) * vec4(uCameraEyeRtc, 1)).xyz;"),s.push("if (dot(position.xyz - uCameraEyeRtcInQuantizedSpace, normal) < 0.0) {"),s.push("position = positions[2 - (gl_VertexID % 3)];"),s.push("viewNormal = -viewNormal;"),s.push("}"),s.push("} else {"),s.push("if (viewNormal.z < 0.0) {"),s.push("position = positions[2 - (gl_VertexID % 3)];"),s.push("viewNormal = -viewNormal;"),s.push("}"),s.push("}"),s.push("}"),s.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),s.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),s.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),s.push("vec4 viewPosition = viewMatrix * worldPosition; "),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2.r;")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Triangles dataTexture draw fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("flat in uint vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("uniform vec4 color;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = vFlags2 > 0u;"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { "),i.push("      discard;"),i.push("  }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    outColor = color;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Xt=p.vec3(),Yt=new Float32Array([0,0,0,1]);class Kt{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.textureState,l=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),h.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets),e.pickViewMatrix&&h.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),n.uniform1i(this._uRenderPass,s),s===pt){const e=r.xrayMaterial._state,t=e.edgeColor,s=e.edgeAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===ut){const e=r.highlightMaterial._state,t=e.edgeColor,s=e.edgeAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===ct){const e=r.selectedMaterial._state,t=e.edgeColor,s=e.edgeAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else n.uniform4fv(this._uColor,Yt);n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,o=i.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,Xt);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}a.numEdgeIndices8Bits>0&&(h.bindEdgeIndicesTextures(this._program,this._uTexturePerEdgeIdPortionIds,this._uTexturePerPolygonIdEdgeIndices,8),n.drawArrays(n.LINES,0,a.numEdgeIndices8Bits)),a.numEdgeIndices16Bits>0&&(h.bindEdgeIndicesTextures(this._program,this._uTexturePerEdgeIdPortionIds,this._uTexturePerPolygonIdEdgeIndices,16),n.drawArrays(n.LINES,0,a.numEdgeIndices16Bits)),a.numEdgeIndices32Bits>0&&(h.bindEdgeIndicesTextures(this._program,this._uTexturePerEdgeIdPortionIds,this._uTexturePerPolygonIdEdgeIndices,32),n.drawArrays(n.LINES,0,a.numEdgeIndices32Bits)),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uColor=s.getLocation("color"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdEdgeIndices="uTexturePerPolygonIdEdgeIndices",this._uTexturePerEdgeIdPortionIds="uTexturePerEdgeIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets"}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=this._program,i=e.camera.project;if(s.bind(),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Batched geometry edges drawing vertex shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("precision highp usampler2D;"),s.push("precision highp isampler2D;"),s.push("precision highp sampler2D;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("precision mediump usampler2D;"),s.push("precision mediump isampler2D;"),s.push("precision mediump sampler2D;"),s.push("#endif"),s.push("uniform int renderPass;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),s.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),s.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),s.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),s.push("uniform highp usampler2D uTexturePerPolygonIdEdgeIndices;"),s.push("uniform mediump usampler2D uTexturePerEdgeIdPortionIds;"),s.push("uniform highp sampler2D uTextureCameraMatrices;"),s.push("uniform highp sampler2D uTextureModelMatrices;"),s.push("uniform vec4 color;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("flat out uint vFlags2;")),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),s.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),s.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),s.push("int edgeIndex = gl_VertexID / 2;"),s.push("int h_packed_object_id_index = (edgeIndex >> 3) & 4095;"),s.push("int v_packed_object_id_index = (edgeIndex >> 3) >> 12;"),s.push("int objectIndex = int(texelFetch(uTexturePerEdgeIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),s.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),s.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),s.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),s.push("if (int(flags.z) != renderPass) {"),s.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),s.push("   return;"),s.push("} else {"),s.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),s.push("ivec4 packedEdgeIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0));"),s.push("int edgeIndexBaseOffset = (packedEdgeIndexBaseOffset.r << 24) + (packedEdgeIndexBaseOffset.g << 16) + (packedEdgeIndexBaseOffset.b << 8) + packedEdgeIndexBaseOffset.a;"),s.push("int h_index = (edgeIndex - edgeIndexBaseOffset) & 4095;"),s.push("int v_index = (edgeIndex - edgeIndexBaseOffset) >> 12;"),s.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdEdgeIndices, ivec2(h_index, v_index), 0));"),s.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),s.push("int indexPositionH = uniqueVertexIndexes[gl_VertexID % 2] & 4095;"),s.push("int indexPositionV = uniqueVertexIndexes[gl_VertexID % 2] >> 12;"),s.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),s.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),s.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),s.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),s.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),s.push("vec3 position = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH, indexPositionV), 0));"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),s.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),s.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("  vWorldPosition = worldPosition;"),s.push("  vFlags2 = flags2.r;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("vColor = vec4(color.r, color.g, color.b, color.a);"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Batched geometry edges drawing fragment shader"),e.logarithmicDepthBufferEnabled&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("flat in uint vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = vFlags2 > 0u;"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("   outColor            = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Jt=p.vec3();class Zt{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene;r.camera;const o=r.canvas.gl,n=t._state,a=n.textureState,h=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),a.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets),e.pickViewMatrix&&a.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),o.uniform1i(this._uRenderPass,s);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*l,n=i.renderFlags;for(let t=0;t<l;t++){const i=this._uSectionPlanes[t];if(i){const r=n.sectionPlanesActivePerLayer[s+t];if(o.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,Jt);o.uniform3fv(i.pos,e)}else o.uniform3fv(i.pos,s.pos);o.uniform3fv(i.dir,s.dir)}}}}n.numEdgeIndices8Bits>0&&(a.bindEdgeIndicesTextures(this._program,this._uTexturePerEdgeIdPortionIds,this._uTexturePerPolygonIdEdgeIndices,8),o.drawArrays(o.LINES,0,n.numEdgeIndices8Bits)),n.numEdgeIndices16Bits>0&&(a.bindEdgeIndicesTextures(this._program,this._uTexturePerEdgeIdPortionIds,this._uTexturePerPolygonIdEdgeIndices,16),o.drawArrays(o.LINES,0,n.numEdgeIndices16Bits)),n.numEdgeIndices32Bits>0&&(a.bindEdgeIndicesTextures(this._program,this._uTexturePerEdgeIdPortionIds,this._uTexturePerPolygonIdEdgeIndices,32),o.drawArrays(o.LINES,0,n.numEdgeIndices32Bits)),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdEdgeIndices="uTexturePerPolygonIdEdgeIndices",this._uTexturePerEdgeIdPortionIds="uTexturePerEdgeIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets"}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=this._program,i=e.camera.project;if(s.bind(),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Batched geometry edges drawing vertex shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("precision highp usampler2D;"),s.push("precision highp isampler2D;"),s.push("precision highp sampler2D;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("precision mediump usampler2D;"),s.push("precision mediump isampler2D;"),s.push("precision mediump sampler2D;"),s.push("#endif"),s.push("uniform int renderPass;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),s.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),s.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),s.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),s.push("uniform highp usampler2D uTexturePerPolygonIdEdgeIndices;"),s.push("uniform mediump usampler2D uTexturePerEdgeIdPortionIds;"),s.push("uniform highp sampler2D uTextureCameraMatrices;"),s.push("uniform highp sampler2D uTextureModelMatrices;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("flat out uint vFlags2;")),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),s.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),s.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),s.push("int edgeIndex = gl_VertexID / 2;"),s.push("int h_packed_object_id_index = (edgeIndex >> 3) & 4095;"),s.push("int v_packed_object_id_index = (edgeIndex >> 3) >> 12;"),s.push("int objectIndex = int(texelFetch(uTexturePerEdgeIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),s.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),s.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),s.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),s.push("if (int(flags.z) != renderPass) {"),s.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),s.push("   return;"),s.push("} else {"),s.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),s.push("ivec4 packedEdgeIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0));"),s.push("int edgeIndexBaseOffset = (packedEdgeIndexBaseOffset.r << 24) + (packedEdgeIndexBaseOffset.g << 16) + (packedEdgeIndexBaseOffset.b << 8) + packedEdgeIndexBaseOffset.a;"),s.push("int h_index = (edgeIndex - edgeIndexBaseOffset) & 4095;"),s.push("int v_index = (edgeIndex - edgeIndexBaseOffset) >> 12;"),s.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdEdgeIndices, ivec2(h_index, v_index), 0));"),s.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),s.push("int indexPositionH = uniqueVertexIndexes[gl_VertexID % 2] & 4095;"),s.push("int indexPositionV = uniqueVertexIndexes[gl_VertexID % 2] >> 12;"),s.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),s.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),s.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),s.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),s.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),s.push("vec3 position = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH, indexPositionV), 0));"),s.push("uvec4 color = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0);"),s.push("if (color.a == 0u) {"),s.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),s.push("   return;"),s.push("};"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),s.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),s.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("  vWorldPosition = worldPosition;"),s.push("  vFlags2 = flags2.r;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("vec4 rgb = vec4(color.rgba);"),s.push("vColor = vec4(float(rgb.r*0.5) / 255.0, float(rgb.g*0.5) / 255.0, float(rgb.b*0.5) / 255.0, float(rgb.a) / 255.0);"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Batched geometry edges drawing fragment shader"),e.logarithmicDepthBufferEnabled&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("flat in uint vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = vFlags2 > 0u;"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("   outColor            = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Qt=p.vec3();class qt{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.textureState,l=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),h.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets);let u=o.eye;e.pickViewMatrix&&(h.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),u=e.pickOrigin||u);const c=[u[0]-l[0],u[1]-l[1],u[2]-l[2]];if(n.uniform3fv(this._uCameraEyeRtc,c),n.uniform1i(this._uRenderPass,s),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,e)}const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*p,o=i.renderFlags;for(let t=0;t<p;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,Qt);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}a.numIndices8Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,8),n.drawArrays(n.TRIANGLES,0,a.numIndices8Bits)),a.numIndices16Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,16),n.drawArrays(n.TRIANGLES,0,a.numIndices16Bits)),a.numIndices32Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,32),n.drawArrays(n.TRIANGLES,0,a.numIndices32Bits)),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=s.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdNormals="uTexturePerPolygonIdNormals",this._uTexturePerPolygonIdIndices="uTexturePerPolygonIdIndices",this._uTexturePerPolygonIdPortionIds="uTexturePerPolygonIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets",this._uCameraEyeRtc=s.getLocation("uCameraEyeRtc")}_bindProgram(e){const t=this._scene.canvas.gl;this._program.bind(),t.uniform1i(this._uPickInvisible,e.pickInvisible)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Batched geometry picking vertex shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("precision highp usampler2D;"),s.push("precision highp isampler2D;"),s.push("precision highp sampler2D;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("precision mediump usampler2D;"),s.push("precision mediump isampler2D;"),s.push("precision mediump sampler2D;"),s.push("#endif"),s.push("uniform int renderPass;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("uniform bool pickInvisible;"),s.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),s.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),s.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),s.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),s.push("uniform highp usampler2D uTexturePerPolygonIdIndices;"),s.push("uniform mediump usampler2D uTexturePerPolygonIdPortionIds;"),s.push("uniform highp sampler2D uTextureCameraMatrices;"),s.push("uniform highp sampler2D uTextureModelMatrices;"),s.push("uniform vec3 uCameraEyeRtc;"),s.push("vec3 positions[3];"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("out float isPerspective;")),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),t&&(s.push("smooth out vec4 vWorldPosition;"),s.push("flat out uvec4 vFlags2;")),s.push("out vec4 vPickColor;"),s.push("void main(void) {"),s.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),s.push("mat4 viewNormalMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 1), 0));"),s.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),s.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),s.push("mat4 worldNormalMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 1), 0), texelFetch (uTextureModelMatrices, ivec2(1, 1), 0), texelFetch (uTextureModelMatrices, ivec2(2, 1), 0), texelFetch (uTextureModelMatrices, ivec2(3, 1), 0));"),s.push("int polygonIndex = gl_VertexID / 3;"),s.push("int h_packed_object_id_index = (polygonIndex >> 3) & 4095;"),s.push("int v_packed_object_id_index = (polygonIndex >> 3) >> 12;"),s.push("int objectIndex = int(texelFetch(uTexturePerPolygonIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),s.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),s.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),s.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),s.push("   return;"),s.push("} else {"),s.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),s.push("ivec4 packedIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0));"),s.push("int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;"),s.push("int h_index = (polygonIndex - indexBaseOffset) & 4095;"),s.push("int v_index = (polygonIndex - indexBaseOffset) >> 12;"),s.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdIndices, ivec2(h_index, v_index), 0));"),s.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),s.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),s.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),s.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),s.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),s.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),s.push("uint solid = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0).r;"),s.push("positions[0] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.r, indexPositionV.r), 0));"),s.push("positions[1] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.g, indexPositionV.g), 0));"),s.push("positions[2] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.b, indexPositionV.b), 0));"),s.push("uvec4 color = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0);"),s.push("if (color.a == 0u) {"),s.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),s.push("   return;"),s.push("};"),s.push("vPickColor = vec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0)) / 255.0;"),s.push("vec3 normal = normalize(cross(positions[2] - positions[0], positions[1] - positions[0]));"),s.push("vec3 position;"),s.push("position = positions[gl_VertexID % 3];"),s.push("if (solid != 1u) {"),s.push("if (isPerspectiveMatrix(projMatrix)) {"),s.push("vec3 uCameraEyeRtcInQuantizedSpace = (inverse(worldMatrix * positionsDecodeMatrix) * vec4(uCameraEyeRtc, 1)).xyz;"),s.push("if (dot(position.xyz - uCameraEyeRtcInQuantizedSpace, normal) < 0.0) {"),s.push("position = positions[2 - (gl_VertexID % 3)];"),s.push("}"),s.push("} else {"),s.push("vec3 viewNormal = -normalize((transpose(inverse(viewMatrix*positionsDecodeMatrix)) * vec4(normal,1)).xyz);"),s.push("if (viewNormal.z < 0.0) {"),s.push("position = positions[2 - (gl_VertexID % 3)];"),s.push("}"),s.push("}"),s.push("}"),s.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),s.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),s.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),s.push("vec4 viewPosition = viewMatrix * worldPosition; "),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Batched geometry picking fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("flat in uvec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("uniform bool sectionPlaneActive"+r+";"),i.push("uniform vec3 sectionPlanePos"+r+";"),i.push("uniform vec3 sectionPlaneDir"+r+";")}if(i.push("in vec4 vPickColor;"),i.push("out vec4 outPickColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("   outPickColor = vPickColor; "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const $t=p.vec3();class es{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.textureState,l=t._state.origin;this._program||this._allocate(),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),h.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets);let u=o.eye;e.pickViewMatrix&&(h.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),u=e.pickOrigin||u);const c=[u[0]-l[0],u[1]-l[1],u[2]-l[2]];if(n.uniform3fv(this._uCameraEyeRtc,c),n.uniform1i(this._uRenderPass,s),n.uniform1i(this._uPickInvisible,e.pickInvisible),n.uniform1f(this._uPickZNear,e.pickZNear),n.uniform1f(this._uPickZFar,e.pickZFar),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(e.pickZFar+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,t)}const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*p,o=i.renderFlags;for(let t=0;t<p;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,$t);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}a.numIndices8Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,8),n.drawArrays(n.TRIANGLES,0,a.numIndices8Bits)),a.numIndices16Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,16),n.drawArrays(n.TRIANGLES,0,a.numIndices16Bits)),a.numIndices32Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,32),n.drawArrays(n.TRIANGLES,0,a.numIndices32Bits)),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPackedVertexId=s.getAttribute("packedVertexId"),this._uPickZNear=s.getLocation("pickZNear"),this._uPickZFar=s.getLocation("pickZFar"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdNormals="uTexturePerPolygonIdNormals",this._uTexturePerPolygonIdIndices="uTexturePerPolygonIdIndices",this._uTexturePerPolygonIdPortionIds="uTexturePerPolygonIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets",this._uCameraEyeRtc=s.getLocation("uCameraEyeRtc")}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles dataTexture pick depth vertex shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("precision highp usampler2D;"),s.push("precision highp isampler2D;"),s.push("precision highp sampler2D;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("precision mediump usampler2D;"),s.push("precision mediump isampler2D;"),s.push("precision mediump sampler2D;"),s.push("#endif"),s.push("uniform int renderPass;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("uniform bool pickInvisible;"),s.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),s.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),s.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),s.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),s.push("uniform highp usampler2D uTexturePerPolygonIdIndices;"),s.push("uniform mediump usampler2D uTexturePerPolygonIdPortionIds;"),s.push("uniform highp sampler2D uTextureCameraMatrices;"),s.push("uniform highp sampler2D uTextureModelMatrices;"),s.push("uniform vec3 uCameraEyeRtc;"),s.push("vec3 positions[3];"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("out float isPerspective;")),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),t&&(s.push("out vec4 vWorldPosition;"),s.push("flat out uint vFlags2;")),s.push("out vec4 vViewPosition;"),s.push("void main(void) {"),s.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),s.push("mat4 viewNormalMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 1), 0));"),s.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),s.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),s.push("mat4 worldNormalMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 1), 0), texelFetch (uTextureModelMatrices, ivec2(1, 1), 0), texelFetch (uTextureModelMatrices, ivec2(2, 1), 0), texelFetch (uTextureModelMatrices, ivec2(3, 1), 0));"),s.push("int polygonIndex = gl_VertexID / 3;"),s.push("int h_packed_object_id_index = (polygonIndex >> 3) & 4095;"),s.push("int v_packed_object_id_index = (polygonIndex >> 3) >> 12;"),s.push("int objectIndex = int(texelFetch(uTexturePerPolygonIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),s.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),s.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),s.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),s.push("   return;"),s.push("} else {"),s.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),s.push("ivec4 packedIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0));"),s.push("int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;"),s.push("int h_index = (polygonIndex - indexBaseOffset) & 4095;"),s.push("int v_index = (polygonIndex - indexBaseOffset) >> 12;"),s.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdIndices, ivec2(h_index, v_index), 0));"),s.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),s.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),s.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),s.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),s.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),s.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),s.push("uint solid = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0).r;"),s.push("positions[0] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.r, indexPositionV.r), 0));"),s.push("positions[1] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.g, indexPositionV.g), 0));"),s.push("positions[2] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.b, indexPositionV.b), 0));"),s.push("uvec4 color = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0);"),s.push("if (color.a == 0u) {"),s.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),s.push("   return;"),s.push("};"),s.push("vec3 normal = normalize(cross(positions[2] - positions[0], positions[1] - positions[0]));"),s.push("vec3 position;"),s.push("position = positions[gl_VertexID % 3];"),s.push("if (solid != 1u) {"),s.push("if (isPerspectiveMatrix(projMatrix)) {"),s.push("vec3 uCameraEyeRtcInQuantizedSpace = (inverse(worldMatrix * positionsDecodeMatrix) * vec4(uCameraEyeRtc, 1)).xyz;"),s.push("if (dot(position.xyz - uCameraEyeRtcInQuantizedSpace, normal) < 0.0) {"),s.push("position = positions[2 - (gl_VertexID % 3)];"),s.push("}"),s.push("} else {"),s.push("vec3 viewNormal = -normalize((transpose(inverse(viewMatrix*positionsDecodeMatrix)) * vec4(normal,1)).xyz);"),s.push("if (viewNormal.z < 0.0) {"),s.push("position = positions[2 - (gl_VertexID % 3)];"),s.push("}"),s.push("}"),s.push("}"),s.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),s.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),s.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),s.push("vec4 viewPosition = viewMatrix * worldPosition; "),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2.r;")),s.push("vViewPosition = viewPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Triangles dataTexture pick depth fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),i.push("uniform float pickZNear;"),i.push("uniform float pickZFar;"),s){i.push("in vec4 vWorldPosition;"),i.push("flat in uint vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("uniform bool sectionPlaneActive"+r+";"),i.push("uniform vec3 sectionPlanePos"+r+";"),i.push("uniform vec3 sectionPlaneDir"+r+";")}if(i.push("in vec4 vViewPosition;"),i.push("vec4 packDepth(const in float depth) {"),i.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),i.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),i.push("  vec4 res = fract(depth * bitShift);"),i.push("  res -= res.xxyz * bitMask;"),i.push("  return res;"),i.push("}"),i.push("out vec4 outPackedDepth;"),i.push("void main(void) {"),s){i.push("  bool clippable = vFlags2 > 0u;"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),i.push("    outPackedDepth = packDepth(zNormalizedDepth); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const ts=p.vec3();class ss{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.textureState,l=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),h.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets);let u=o.eye;e.pickViewMatrix&&(h.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),u=e.pickOrigin||u);const c=[u[0]-l[0],u[1]-l[1],u[2]-l[2]];if(n.uniform3fv(this._uCameraEyeRtc,c),n.uniform1i(this._uRenderPass,s),n.uniform3fv(this._uCameraEyeRtc,c),n.uniform1i(this._uPickInvisible,e.pickInvisible),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,e)}const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*p,o=i.renderFlags;for(let t=0;t<p;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,ts);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}a.numIndices8Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,8),n.drawArrays(n.TRIANGLES,0,a.numIndices8Bits)),a.numIndices16Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,16),n.drawArrays(n.TRIANGLES,0,a.numIndices16Bits)),a.numIndices32Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,32),n.drawArrays(n.TRIANGLES,0,a.numIndices32Bits)),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdNormals="uTexturePerPolygonIdNormals",this._uTexturePerPolygonIdIndices="uTexturePerPolygonIdIndices",this._uTexturePerPolygonIdPortionIds="uTexturePerPolygonIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets",this._uCameraEyeRtc=s.getLocation("uCameraEyeRtc")}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles dataTexture pick normals vertex shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("precision highp usampler2D;"),s.push("precision highp isampler2D;"),s.push("precision highp sampler2D;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("precision mediump usampler2D;"),s.push("precision mediump isampler2D;"),s.push("precision mediump sampler2D;"),s.push("#endif"),s.push("uniform int renderPass;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("uniform bool pickInvisible;"),s.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),s.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),s.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),s.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),s.push("uniform highp usampler2D uTexturePerPolygonIdIndices;"),s.push("uniform mediump usampler2D uTexturePerPolygonIdPortionIds;"),s.push("uniform highp sampler2D uTextureCameraMatrices;"),s.push("uniform highp sampler2D uTextureModelMatrices;"),s.push("uniform vec3 uCameraEyeRtc;"),s.push("vec3 positions[3];"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("out float isPerspective;")),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),t&&(s.push("out vec4 vWorldPosition;"),s.push("flat out uint vFlags2;")),s.push("out vec3 vWorldNormal;"),s.push("void main(void) {"),s.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),s.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),s.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),s.push("int polygonIndex = gl_VertexID / 3;"),s.push("int h_packed_object_id_index = (polygonIndex >> 3) & 4095;"),s.push("int v_packed_object_id_index = (polygonIndex >> 3) >> 12;"),s.push("int objectIndex = int(texelFetch(uTexturePerPolygonIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),s.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),s.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),s.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),s.push("   return;"),s.push("} else {"),s.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),s.push("ivec4 packedIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0));"),s.push("int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;"),s.push("int h_index = (polygonIndex - indexBaseOffset) & 4095;"),s.push("int v_index = (polygonIndex - indexBaseOffset) >> 12;"),s.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdIndices, ivec2(h_index, v_index), 0));"),s.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),s.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),s.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),s.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),s.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),s.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),s.push("uint solid = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0).r;"),s.push("positions[0] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.r, indexPositionV.r), 0));"),s.push("positions[1] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.g, indexPositionV.g), 0));"),s.push("positions[2] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.b, indexPositionV.b), 0));"),s.push("vec3 normal = normalize(cross(positions[2] - positions[0], positions[1] - positions[0]));"),s.push("vec3 position;"),s.push("position = positions[gl_VertexID % 3];"),s.push("if (solid != 1u) {"),s.push("if (isPerspectiveMatrix(projMatrix)) {"),s.push("vec3 uCameraEyeRtcInQuantizedSpace = (inverse(worldMatrix * positionsDecodeMatrix) * vec4(uCameraEyeRtc, 1)).xyz;"),s.push("if (dot(position.xyz - uCameraEyeRtcInQuantizedSpace, normal) < 0.0) {"),s.push("position = positions[2 - (gl_VertexID % 3)];"),s.push("normal = -normal;"),s.push("}"),s.push("} else {"),s.push("vec3 viewNormal = -normalize((transpose(inverse(viewMatrix*positionsDecodeMatrix)) * vec4(normal,1)).xyz);"),s.push("if (viewNormal.z < 0.0) {"),s.push("position = positions[2 - (gl_VertexID % 3)];"),s.push("normal = -normal;"),s.push("}"),s.push("}"),s.push("}"),s.push("normal = -normal;"),s.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),s.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),s.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),s.push("vec4 viewPosition = viewMatrix * worldPosition; "),s.push("vWorldNormal = normal.xyz;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2.w;")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Triangles dataTexture pick normals fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("flat in uint vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("uniform bool sectionPlaneActive"+r+";"),i.push("uniform vec3 sectionPlanePos"+r+";"),i.push("uniform vec3 sectionPlaneDir"+r+";")}if(i.push("in vec3 vWorldNormal;"),i.push("out vec4 outNormal;"),i.push("void main(void) {"),s){i.push("  bool clippable = vFlags2 > 0u;"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    outNormal = vec4((vWorldNormal * 0.5) + 0.5, 1.0);"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}p.vec3();class is{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Triangles dataTexture occlusion vertex shader"),e.logarithmicDepthBufferEnabled&&ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),e.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),t&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(ce.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("// Triangles dataTexture occlusion fragment shader"),e.logarithmicDepthBufferEnabled&&ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("      if (sectionPlaneActive"+e+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("   gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}p.vec4();const rs=p.vec3();class os{constructor(e){this._scene=e,this._allocate(),this._hash=this._getHash()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=this._scene,r=i.camera,o=t.model,n=i.canvas.gl,a=t._state,h=a.textureState,l=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e,a)),h.bindCommonTextures(this._program,this._uTexturePerObjectIdPositionsDecodeMatrix,this._uTexturePerVertexIdCoordinates,this._uTexturePerObjectIdColorsAndFlags,this._uTextureCameraMatrices,this._uTextureModelMatrices,this._uTexturePerObjectIdOffsets);let u=r.eye;e.pickViewMatrix&&(h.bindPickCameraTexture(this._program,this._uTextureCameraMatrices),u=e.pickOrigin||u);const c=[u[0]-l[0],u[1]-l[1],u[2]-l[2]];n.uniform3fv(this._uCameraEyeRtc,c),n.uniform1i(this._uRenderPass,s);const p=i._sectionPlanesState.sectionPlanes.length;if(p>0){const e=i._sectionPlanesState.sectionPlanes,s=t.layerIndex*p,r=o.renderFlags;for(let t=0;t<p;t++){const i=this._uSectionPlanes[t];if(i){const o=r.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,o?1:0),o){const s=e[t];if(l){const e=X(s.dist,s.dir,l,rs);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}a.numIndices8Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,8),n.drawArrays(n.TRIANGLES,0,a.numIndices8Bits)),a.numIndices16Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,16),n.drawArrays(n.TRIANGLES,0,a.numIndices16Bits)),a.numIndices32Bits>0&&(h.bindTriangleIndicesTextures(this._program,this._uTexturePerPolygonIdPortionIds,this._uTexturePerPolygonIdIndices,32),n.drawArrays(n.TRIANGLES,0,a.numIndices32Bits)),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdNormals="uTexturePerPolygonIdNormals",this._uTexturePerPolygonIdIndices="uTexturePerPolygonIdIndices",this._uTexturePerPolygonIdPortionIds="uTexturePerPolygonIdPortionIds",this._uTextureCameraMatrices="uTextureCameraMatrices",this._uTextureModelMatrices="uTextureModelMatrices",this._uTexturePerObjectIdOffsets="uTexturePerObjectIdOffsets",this._uCameraEyeRtc=s.getLocation("uCameraEyeRtc")}_bindProgram(e){const t=this._scene,s=t.canvas.gl,i=this._program,r=t.camera.project;if(i.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),t.logarithmicDepthBufferEnabled){const e=2/(Math.log(r.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState;e._lightsState;const s=t.sectionPlanes.length>0,i=[];return i.push("#version 300 es"),i.push("// Triangles dataTexture draw vertex shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("precision highp usampler2D;"),i.push("precision highp isampler2D;"),i.push("precision highp sampler2D;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("precision mediump usampler2D;"),i.push("precision mediump isampler2D;"),i.push("precision mediump sampler2D;"),i.push("#endif"),i.push("uniform int renderPass;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("uniform highp sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),i.push("uniform lowp usampler2D uTexturePerObjectIdColorsAndFlags;"),i.push("uniform highp sampler2D uTexturePerObjectIdOffsets;"),i.push("uniform mediump usampler2D uTexturePerVertexIdCoordinates;"),i.push("uniform highp usampler2D uTexturePerPolygonIdIndices;"),i.push("uniform mediump usampler2D uTexturePerPolygonIdPortionIds;"),i.push("uniform highp sampler2D uTextureCameraMatrices;"),i.push("uniform highp sampler2D uTextureModelMatrices;"),i.push("uniform vec3 uCameraEyeRtc;"),i.push("vec3 positions[3];"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;"),i.push("out float isPerspective;")),i.push("bool isPerspectiveMatrix(mat4 m) {"),i.push("    return (m[2][3] == - 1.0);"),i.push("}"),i.push("out highp vec2 vHighPrecisionZW;"),s&&(i.push("out vec4 vWorldPosition;"),i.push("flat out uint vFlags2;")),i.push("void main(void) {"),i.push("int polygonIndex = gl_VertexID / 3;"),i.push("int h_packed_object_id_index = (polygonIndex >> 3) & 4095;"),i.push("int v_packed_object_id_index = (polygonIndex >> 3) >> 12;"),i.push("int objectIndex = int(texelFetch(uTexturePerPolygonIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).r);"),i.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),i.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),i.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),i.push("   return;"),i.push("} else {"),i.push("mat4 viewMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 0), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 0), 0));"),i.push("mat4 viewNormalMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 1), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 1), 0));"),i.push("mat4 projMatrix = mat4 (texelFetch (uTextureCameraMatrices, ivec2(0, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(1, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(2, 2), 0), texelFetch (uTextureCameraMatrices, ivec2(3, 2), 0));"),i.push("mat4 worldMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 0), 0), texelFetch (uTextureModelMatrices, ivec2(1, 0), 0), texelFetch (uTextureModelMatrices, ivec2(2, 0), 0), texelFetch (uTextureModelMatrices, ivec2(3, 0), 0));"),i.push("mat4 worldNormalMatrix = mat4 (texelFetch (uTextureModelMatrices, ivec2(0, 1), 0), texelFetch (uTextureModelMatrices, ivec2(1, 1), 0), texelFetch (uTextureModelMatrices, ivec2(2, 1), 0), texelFetch (uTextureModelMatrices, ivec2(3, 1), 0));"),i.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),i.push("ivec4 packedIndexBaseOffset = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0));"),i.push("int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;"),i.push("int h_index = (polygonIndex - indexBaseOffset) & 4095;"),i.push("int v_index = (polygonIndex - indexBaseOffset) >> 12;"),i.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdIndices, ivec2(h_index, v_index), 0));"),i.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),i.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),i.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),i.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),i.push("mat4 entityMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+5, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+6, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0));"),i.push("positionsDecodeMatrix = entityMatrix * positionsDecodeMatrix;"),i.push("uint solid = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+7, objectIndexCoords.y), 0).r;"),i.push("positions[0] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.r, indexPositionV.r), 0));"),i.push("positions[1] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.g, indexPositionV.g), 0));"),i.push("positions[2] = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.b, indexPositionV.b), 0));"),i.push("uvec4 color = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0);"),i.push("if (color.a == 0u) {"),i.push("   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);"),i.push("   return;"),i.push("};"),i.push("vec3 normal = normalize(cross(positions[2] - positions[0], positions[1] - positions[0]));"),i.push("vec3 position;"),i.push("position = positions[gl_VertexID % 3];"),i.push("vec3 viewNormal = -normalize((transpose(inverse(viewMatrix*positionsDecodeMatrix)) * vec4(normal,1)).xyz);"),i.push("if (solid != 1u) {"),i.push("if (isPerspectiveMatrix(projMatrix)) {"),i.push("vec3 uCameraEyeRtcInQuantizedSpace = (inverse(worldMatrix * positionsDecodeMatrix) * vec4(uCameraEyeRtc, 1)).xyz;"),i.push("if (dot(position.xyz - uCameraEyeRtcInQuantizedSpace, normal) < 0.0) {"),i.push("position = positions[2 - (gl_VertexID % 3)];"),i.push("viewNormal = -viewNormal;"),i.push("}"),i.push("} else {"),i.push("if (viewNormal.z < 0.0) {"),i.push("position = positions[2 - (gl_VertexID % 3)];"),i.push("viewNormal = -viewNormal;"),i.push("}"),i.push("}"),i.push("}"),i.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),i.push("vec4 offset = vec4(texelFetch (uTexturePerObjectIdOffsets, objectIndexCoords, 0).rgb, 0.0);"),i.push("worldPosition.xyz = worldPosition.xyz + offset.xyz;"),i.push("vec4 viewPosition = viewMatrix * worldPosition; "),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2.r;")),i.push("gl_Position = clipPos;"),i.push("vHighPrecisionZW = gl_Position.zw;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Triangles dataTexture draw fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),i.push("in highp vec2 vHighPrecisionZW;"),i.push("out vec4 outColor;"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("flat in uint vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("void main(void) {"),s){i.push("  bool clippable = vFlags2 > 0u;"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { "),i.push("      discard;"),i.push("  }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;"),i.push("    outColor = vec4(vec3(1.0 - fragCoordZ), 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const ns=p.vec3();class as{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(t)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,i.worldNormalMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*l,o=i.renderFlags;for(let t=0;t<l;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,ns);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aNormal.bindArrayBuffer(a.normalsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2&&(this._aFlags2=s.getAttribute("flags2")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Batched geometry normals vertex shader"),e.logarithmicDepthBufferEnabled&&ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),e.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec3 normal;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 worldNormalMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 viewNormalMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),s.push("vec3 octDecode(vec2 oct) {"),s.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),s.push("    if (v.z < 0.0) {"),s.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),s.push("    }"),s.push("    return normalize(v);"),s.push("}"),t&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec3 vViewNormal;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition   = viewMatrix * worldPosition; "),s.push("      vec4 worldNormal    = worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),s.push("      vec3 viewNormal     = normalize((viewNormalMatrix * worldNormal).xyz);"),t&&(s.push("      vWorldPosition  = worldPosition;"),s.push("      vFlags2         = flags2;")),s.push("      vViewNormal = viewNormal;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(ce.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("// Batched geometry normals fragment shader"),e.logarithmicDepthBufferEnabled&&ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("varying vec3 vViewNormal;"),i.push("vec3 packNormalToRGB( const in vec3 normal ) {"),i.push("    return normalize( normal ) * 0.5 + 0.5;"),i.push("}"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    gl_FragColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}p.vec3();class hs{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t){}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uShadowViewMatrix=i.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=i.getLocation("shadowProjMatrix"),e.logarithmicDepthBufferEnabled&&(this._uZFar=i.getLocation("zFar")),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2")}_bindProgram(e){const t=this._scene.canvas.gl;this._program.bind(),t.uniformMatrix4fv(this._uShadowViewMatrix,!1,e.shadowViewMatrix),t.uniformMatrix4fv(this._uShadowProjMatrix,!1,e.shadowProjMatrix),this._lastLightId=null}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Batched geometry shadow vertex shader"),s.push("attribute vec3 position;"),e.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform mat4 shadowViewMatrix;"),s.push("uniform mat4 shadowProjMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vViewPosition;"),s.push("void main(void) {"),s.push("  bool visible        = (float(flags.x) > 0.0);"),s.push("  bool transparent    = ((float(color.a) / 255.0) < 1.0);"),s.push("  if (!visible || transparent) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = shadowViewMatrix * worldPosition; "),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("      vViewPosition = viewPosition;"),s.push("      gl_Position = shadowProjMatrix * viewPosition;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene._sectionPlanesState,t=e.sectionPlanes.length>0,s=[];if(s.push("// Batched geometry shadow fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),t){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)s.push("uniform bool sectionPlaneActive"+t+";"),s.push("uniform vec3 sectionPlanePos"+t+";"),s.push("uniform vec3 sectionPlaneDir"+t+";")}if(s.push("varying vec4 vViewPosition;"),s.push("vec4 encodeFloat( const in float v ) {"),s.push("  const vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);"),s.push("  const vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);"),s.push("  vec4 comp = fract(v * bitShift);"),s.push("  comp -= comp.xxyz * bitMask;"),s.push("  return comp;"),s.push("}"),s.push("void main(void) {"),t){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(var i=0;i<e.sectionPlanes.length;i++)s.push("      if (sectionPlaneActive"+i+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+i+".xyz, vWorldPosition.xyz - sectionPlanePos"+i+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return s.push("    gl_FragColor = encodeFloat( gl_FragCoord.z); "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const ls=p.vec4(),us=p.vec3(),cs={linear:"linearToLinear",sRGB:"sRGBToLinear",gamma:"gammaToLinear"};class ps{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e.gammaOutput,e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,s){const i=this._scene,r=i.camera,o=t.model,n=i.canvas.gl,a=t._state,h=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(r.viewMatrix,h):r.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,o.worldNormalMatrix);const l=i._sectionPlanesState.sectionPlanes.length;if(l>0){const e=i._sectionPlanesState.sectionPlanes,s=t.layerIndex*l,r=o.renderFlags;for(let t=0;t<l;t++){const i=this._uSectionPlanes[t];if(i){const o=r.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,o?1:0),o){const s=e[t];if(h){const e=X(s.dist,s.dir,h,us);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(a.normalsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),this._aMetallicRoughness&&this._aMetallicRoughness.bindArrayBuffer(a.metallicRoughnessBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._lightsState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uGammaFactor=i.getLocation("gammaFactor"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=i.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=i.getLocation("lightDir"+e),this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e)}s.reflectionMaps.length>0&&(this._uReflectionMap="reflectionMap"),s.lightMaps.length>0&&(this._uLightMap="lightMap"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aNormal=i.getAttribute("normal"),this._aColor=i.getAttribute("color"),this._aMetallicRoughness=i.getAttribute("metallicRoughness"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(e){const t=ce.MAX_TEXTURE_UNITS,s=this._scene,i=s.canvas.gl,r=this._program,o=s._lightsState,n=o.lights,a=s.camera.project;r.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,a.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,s._lightsState.getAmbientColorAndIntensity());for(let e=0,t=n.length;e<t;e++){const t=n[e];this._uLightColor[e]&&i.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(i.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&i.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&i.uniform3fv(this._uLightDir[e],t.dir)}if(o.reflectionMaps.length>0&&o.reflectionMaps[0].texture&&this._uReflectionMap&&(r.bindTexture(this._uReflectionMap,o.reflectionMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++),o.lightMaps.length>0&&o.lightMaps[0].texture&&this._uLightMap&&(r.bindTexture(this._uLightMap,o.lightMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++),this._withSAO){const r=s.sao;if(r.possible){const s=i.drawingBufferWidth,o=i.drawingBufferHeight;ls[0]=s,ls[1]=o,ls[2]=r.blendCutoff,ls[3]=r.blendFactor,i.uniform4fv(this._uSAOParams,ls),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++}}if(s.logarithmicDepthBufferEnabled){const e=2/(Math.log(a.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,e)}this._uGammaFactor&&i.uniform1f(this._uGammaFactor,s.gammaFactor)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState,s=e._lightsState,i=t.sectionPlanes.length>0,r=t.clippingCaps,o=[];return o.push("// Triangles dataTexture quality draw vertex shader"),e.logarithmicDepthBufferEnabled&&ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("uniform int renderPass;"),o.push("attribute vec3 position;"),o.push("attribute vec3 normal;"),o.push("attribute vec4 color;"),o.push("attribute vec2 metallicRoughness;"),o.push("attribute vec4 flags;"),o.push("attribute vec4 flags2;"),e.entityOffsetsEnabled&&o.push("attribute vec3 offset;"),o.push("uniform mat4 worldMatrix;"),o.push("uniform mat4 worldNormalMatrix;"),o.push("uniform mat4 viewMatrix;"),o.push("uniform mat4 projMatrix;"),o.push("uniform mat4 viewNormalMatrix;"),o.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("varying float vFragDepth;"),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("varying float isPerspective;")),o.push("vec3 octDecode(vec2 oct) {"),o.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),o.push("    if (v.z < 0.0) {"),o.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),o.push("    }"),o.push("    return normalize(v);"),o.push("}"),o.push("varying vec4 vViewPosition;"),o.push("varying vec3 vViewNormal;"),o.push("varying vec4 vColor;"),o.push("varying vec2 vMetallicRoughness;"),s.lightMaps.length>0&&o.push("varying vec3 vWorldNormal;"),i&&(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),r&&o.push("varying vec4 vClipPosition;")),o.push("void main(void) {"),o.push("if (int(flags.x) != renderPass) {"),o.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),o.push("} else {"),o.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&o.push("worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition  = viewMatrix * worldPosition; "),o.push("vec4 worldNormal =  worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),o.push("vec3 viewNormal = normalize((viewNormalMatrix * worldNormal).xyz);"),o.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"),ce.SUPPORTED_EXTENSIONS.EXT_frag_depth?o.push("vFragDepth = 1.0 + clipPos.w;"):(o.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),o.push("clipPos.z *= clipPos.w;"))),i&&(o.push("vWorldPosition = worldPosition;"),o.push("vFlags2 = flags2;"),r&&o.push("vClipPosition = clipPos;")),o.push("vViewPosition = viewPosition;"),o.push("vViewNormal = viewNormal;"),o.push("vColor = color;"),o.push("vMetallicRoughness = metallicRoughness;"),s.lightMaps.length>0&&o.push("vWorldNormal = worldNormal.xyz;"),o.push("gl_Position = clipPos;"),o.push("}"),o.push("}"),o}_buildFragmentShader(){const e=this._scene,t=e.gammaOutput,s=e._sectionPlanesState,i=e._lightsState,r=s.sectionPlanes.length>0,o=s.clippingCaps,n=[];n.push("// Triangles dataTexture quality draw fragment shader"),e.logarithmicDepthBufferEnabled&&ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("#extension GL_EXT_frag_depth : enable"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),e.logarithmicDepthBufferEnabled&&ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(n.push("varying float isPerspective;"),n.push("uniform float logDepthBufFC;"),n.push("varying float vFragDepth;")),n.push("varying vec4 vViewPosition;"),n.push("varying vec3 vViewNormal;"),n.push("varying vec4 vColor;"),n.push("varying vec2 vMetallicRoughness;"),i.lightMaps.length>0&&n.push("varying vec3 vWorldNormal;"),n.push("uniform mat4 viewMatrix;"),i.reflectionMaps.length>0&&n.push("uniform samplerCube reflectionMap;"),i.lightMaps.length>0&&n.push("uniform samplerCube lightMap;"),n.push("uniform vec4 lightAmbient;");for(let e=0,t=i.lights.length;e<t;e++){const t=i.lights[e];"ambient"!==t.type&&(n.push("uniform vec4 lightColor"+e+";"),"dir"===t.type&&n.push("uniform vec3 lightDir"+e+";"),"point"===t.type&&n.push("uniform vec3 lightPos"+e+";"),"spot"===t.type&&(n.push("uniform vec3 lightPos"+e+";"),n.push("uniform vec3 lightDir"+e+";")))}if(this._withSAO&&(n.push("uniform sampler2D uOcclusionTexture;"),n.push("uniform vec4      uSAOParams;"),n.push("const float       packUpscale = 256. / 255.;"),n.push("const float       unpackDownScale = 255. / 256.;"),n.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),n.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),n.push("float unpackRGBAToDepth( const in vec4 v ) {"),n.push("    return dot( v, unPackFactors );"),n.push("}")),n.push("uniform float gammaFactor;"),n.push("vec4 linearToLinear( in vec4 value ) {"),n.push("  return value;"),n.push("}"),n.push("vec4 sRGBToLinear( in vec4 value ) {"),n.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),n.push("}"),n.push("vec4 gammaToLinear( in vec4 value) {"),n.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),n.push("}"),t&&(n.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),n.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),n.push("}")),r){n.push("varying vec4 vWorldPosition;"),n.push("varying vec4 vFlags2;"),o&&n.push("varying vec4 vClipPosition;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)n.push("uniform bool sectionPlaneActive"+e+";"),n.push("uniform vec3 sectionPlanePos"+e+";"),n.push("uniform vec3 sectionPlaneDir"+e+";")}if(n.push("#define PI 3.14159265359"),n.push("#define RECIPROCAL_PI 0.31830988618"),n.push("#define RECIPROCAL_PI2 0.15915494"),n.push("#define EPSILON 1e-6"),n.push("#define saturate(a) clamp( a, 0.0, 1.0 )"),n.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),n.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),n.push("}"),n.push("struct IncidentLight {"),n.push("   vec3 color;"),n.push("   vec3 direction;"),n.push("};"),n.push("struct ReflectedLight {"),n.push("   vec3 diffuse;"),n.push("   vec3 specular;"),n.push("};"),n.push("struct Geometry {"),n.push("   vec3 position;"),n.push("   vec3 viewNormal;"),n.push("   vec3 worldNormal;"),n.push("   vec3 viewEyeDir;"),n.push("};"),n.push("struct Material {"),n.push("   vec3    diffuseColor;"),n.push("   float   specularRoughness;"),n.push("   vec3    specularColor;"),n.push("   float   shine;"),n.push("};"),n.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),n.push("   float r = ggxRoughness + 0.0001;"),n.push("   return (2.0 / (r * r) - 2.0);"),n.push("}"),n.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {"),n.push("   float maxMIPLevelScalar = float( maxMIPLevel );"),n.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );"),n.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );"),n.push("}"),i.reflectionMaps.length>0&&(n.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),n.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),n.push("   vec3 envMapColor = "+cs[i.reflectionMaps[0].encoding]+"(textureCube(reflectionMap, reflectVec, mipLevel)).rgb;"),n.push("  return envMapColor;"),n.push("}")),n.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),n.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),n.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),n.push("}"),n.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),n.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),n.push("   return 1.0 / ( gl * gv );"),n.push("}"),n.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),n.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),n.push("   return 0.5 / max( gv + gl, EPSILON );"),n.push("}"),n.push("float D_GGX(const in float alpha, const in float dotNH) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),n.push("   return RECIPROCAL_PI * a2 / ( denom * denom);"),n.push("}"),n.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),n.push("   float alpha = ( roughness * roughness );"),n.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),n.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),n.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),n.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),n.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),n.push("   vec3  F = F_Schlick( specularColor, dotLH );"),n.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),n.push("   float D = D_GGX( alpha, dotNH );"),n.push("   return F * (G * D);"),n.push("}"),n.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),n.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),n.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),n.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),n.push("   vec4 r = roughness * c0 + c1;"),n.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),n.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),n.push("   return specularColor * AB.x + AB.y;"),n.push("}"),(i.lightMaps.length>0||i.reflectionMaps.length>0)&&(n.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),i.lightMaps.length>0&&(n.push("   vec3 irradiance = "+cs[i.lightMaps[0].encoding]+"(textureCube(lightMap, geometry.worldNormal)).rgb;"),n.push("   irradiance *= PI;"),n.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),n.push("   reflectedLight.diffuse +=  irradiance * diffuseBRDFContrib;")),i.reflectionMaps.length>0&&(n.push("   vec3 reflectVec             = reflect(geometry.viewEyeDir, geometry.viewNormal);"),n.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),n.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),n.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),n.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),n.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),n.push("}")),n.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),n.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),n.push("   vec3 irradiance = dotNL * incidentLight.color * PI;"),n.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),n.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),n.push("}"),n.push("void main(void) {"),r){n.push("  bool clippable = (float(vFlags2.x) > 0.0);"),n.push("  if (clippable) {"),n.push("  float dist = 0.0;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)n.push("if (sectionPlaneActive"+e+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),n.push("}");o?(n.push("  if (dist > (0.002 * vClipPosition.w)) {"),n.push("      discard;"),n.push("  }"),n.push("  if (dist > 0.0) { "),n.push("      gl_FragColor=vec4(1.0, 0.0, 0.0, 1.0);"),e.logarithmicDepthBufferEnabled&&ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("  gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("  return;"),n.push("}")):(n.push("  if (dist > 0.0) { "),n.push("      discard;"),n.push("  }")),n.push("}")}n.push("IncidentLight  light;"),n.push("Material       material;"),n.push("Geometry       geometry;"),n.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),n.push("vec3 rgb = (vec3(float(vColor.r) / 255.0, float(vColor.g) / 255.0, float(vColor.b) / 255.0));"),n.push("float alpha = float(vColor.a) / 255.0;"),n.push("vec3  diffuseColor = rgb;"),n.push("float specularF0 = 1.0;"),n.push("float metallic = float(vMetallicRoughness.r) / 255.0;"),n.push("float roughness = float(vMetallicRoughness.g) / 255.0;"),n.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),n.push("material.diffuseColor      = diffuseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),n.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),n.push("material.specularColor     = mix(vec3(dielectricSpecular), diffuseColor, metallic);"),n.push("geometry.position      = vViewPosition.xyz;"),n.push("geometry.viewNormal    = -normalize(vViewNormal);"),n.push("geometry.viewEyeDir    = normalize(vViewPosition.xyz);"),i.lightMaps.length>0&&n.push("geometry.worldNormal   = normalize(vWorldNormal);"),(i.lightMaps.length>0||i.reflectionMaps.length>0)&&n.push("computePBRLightMapping(geometry, material, reflectedLight);");for(let e=0,t=i.lights.length;e<t;e++){const t=i.lights[e];if("ambient"!==t.type){if("dir"===t.type)"view"===t.space?n.push("light.direction =  normalize(lightDir"+e+");"):n.push("light.direction =  normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===t.type)"view"===t.space?n.push("light.direction =  normalize(lightPos"+e+" - vViewPosition.xyz);"):n.push("light.direction =  normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==t.type)continue;"view"===t.space?n.push("light.direction =  normalize(lightDir"+e+");"):n.push("light.direction =  normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}n.push("light.color =  lightColor"+e+".rgb * lightColor"+e+".a;"),n.push("computePBRLighting(light, geometry, material, reflectedLight);")}}return n.push("vec3 outgoingLight = (lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedLight.diffuse) + (reflectedLight.specular);"),n.push("vec4 fragColor;"),this._withSAO?(n.push("   float viewportWidth     = uSAOParams[0];"),n.push("   float viewportHeight    = uSAOParams[1];"),n.push("   float blendCutoff       = uSAOParams[2];"),n.push("   float blendFactor       = uSAOParams[3];"),n.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),n.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBAToDepth(texture2D(uOcclusionTexture, uv))) * blendFactor;"),n.push("   fragColor               = vec4(outgoingLight.rgb * ambient, alpha);")):n.push("   fragColor            = vec4(outgoingLight.rgb, alpha);"),t&&n.push("fragColor = linearToGamma(fragColor, gammaFactor);"),n.push("gl_FragColor = fragColor;"),e.logarithmicDepthBufferEnabled&&ce.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("}"),n}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const ds=p.vec3();class ms{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),this._program.bindTexture(this._uTexturePerObjectIdPositionsDecodeMatrix,{bind:function(e){return n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,a.texturePerObjectIdPositionsDecodeMatrix),!0},unbind:function(e){n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,null)}},1),this._program.bindTexture(this._uTexturePerVertexIdCoordinates,{bind:function(e){return n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,a.texturePerVertexIdCoordinates),!0},unbind:function(e){n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,null)}},2),this._program.bindTexture(this._uTexturePerObjectIdColorsAndFlags,{bind:function(e){return n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,a.texturePerObjectIdColorsAndFlags),!0},unbind:function(e){n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,null)}},3),n.uniform1i(this._uRenderPass,s),n.uniform1i(this._uPickInvisible,e.pickInvisible),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const l=e.pickViewMatrix||o.viewMatrix,u=h?U(l,h):l;if(n.uniformMatrix4fv(this._uViewMatrix,!1,u),n.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,e)}const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*c,o=i.renderFlags;for(let t=0;t<c;t++){const i=this._uSectionPlanes[t],r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,ds);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}a.numIndices8Bits>0&&(this._program.bindTexture(this._uTexturePerPolygonIdPortionIds,{bind:function(e){return n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,a.texturePerPolygonIdPortionIds8Bits),!0},unbind:function(e){n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,null)}},4),this._program.bindTexture(this._uTexturePerPolygonIdIndices,{bind:function(e){return n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,a.texturePerPolygonIdIndices8Bits),!0},unbind:function(e){n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,null)}},5),n.drawArrays(n.TRIANGLES,0,a.numIndices8Bits)),a.numIndices16Bits>0&&(this._program.bindTexture(this._uTexturePerPolygonIdPortionIds,{bind:function(e){return n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,a.texturePerPolygonIdPortionIds16Bits),!0},unbind:function(e){n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,null)}},4),this._program.bindTexture(this._uTexturePerPolygonIdIndices,{bind:function(e){return n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,a.texturePerPolygonIdIndices16Bits),!0},unbind:function(e){n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,null)}},5),n.drawArrays(n.TRIANGLES,0,a.numIndices16Bits)),a.numIndices32Bits>0&&(this._program.bindTexture(this._uTexturePerPolygonIdPortionIds,{bind:function(e){return n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,a.texturePerPolygonIdPortionIds32Bits),!0},unbind:function(e){n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,null)}},4),this._program.bindTexture(this._uTexturePerPolygonIdIndices,{bind:function(e){return n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,a.texturePerPolygonIdIndices32Bits),!0},unbind:function(e){n.activeTexture(n["TEXTURE"+e]),n.bindTexture(n.TEXTURE_2D,null)}},5),n.drawArrays(n.TRIANGLES,0,a.numIndices32Bits)),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPackedVertexId=s.getAttribute("packedVertexId"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC")),this._uTexturePerObjectIdPositionsDecodeMatrix="uTexturePerObjectIdPositionsDecodeMatrix",this._uTexturePerObjectIdColorsAndFlags="uTexturePerObjectIdColorsAndFlags",this._uTexturePerVertexIdCoordinates="uTexturePerVertexIdCoordinates",this._uTexturePerPolygonIdNormals="uTexturePerPolygonIdNormals",this._uTexturePerPolygonIdIndices="uTexturePerPolygonIdIndices",this._uTexturePerPolygonIdPortionIds="uTexturePerPolygonIdPortionIds"}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles dataTexture pick flat normals vertex shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("precision highp usampler2D;"),s.push("precision highp isampler2D;"),s.push("precision highp sampler2D;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("precision mediump usampler2D;"),s.push("precision mediump isampler2D;"),s.push("precision mediump sampler2D;"),s.push("#endif"),s.push("uniform int renderPass;"),s.push("in uvec3 packedVertexId;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform sampler2D uTexturePerObjectIdPositionsDecodeMatrix;"),s.push("uniform usampler2D uTexturePerObjectIdColorsAndFlags;"),s.push("uniform usampler2D uTexturePerVertexIdCoordinates;"),s.push("uniform usampler2D uTexturePerPolygonIdIndices;"),s.push("uniform isampler2D uTexturePerPolygonIdNormals;"),s.push("uniform usampler2D uTexturePerPolygonIdPortionIds;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),s.push("out vec4 vWorldPosition;"),t&&s.push("out int vFlags2;"),s.push("void main(void) {"),s.push("int polygonIndex = gl_VertexID / 3;"),s.push("int h_normal_index = polygonIndex & 4095;"),s.push("int v_normal_index = polygonIndex >> 12;"),s.push("int h_packed_object_id_index = ((polygonIndex >> 3) / 2) & 4095;"),s.push("int v_packed_object_id_index = ((polygonIndex >> 3) / 2) >> 12;"),s.push("ivec3 packedObjectId = ivec3(texelFetch(uTexturePerPolygonIdPortionIds, ivec2(h_packed_object_id_index, v_packed_object_id_index), 0).rgb);"),s.push("int objectIndex;"),s.push("if (((polygonIndex >> 3) % 2) == 0) {"),s.push("  objectIndex = (packedObjectId.r << 4) + (packedObjectId.g >> 4);"),s.push("} else {"),s.push("  objectIndex = ((packedObjectId.g & 15) << 8) + packedObjectId.b;"),s.push("}"),s.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),s.push("ivec4 packedVertexBase = ivec4(texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+4, objectIndexCoords.y), 0));"),s.push("int h_index = polygonIndex & 4095;"),s.push("int v_index = polygonIndex >> 12;"),s.push("ivec3 vertexIndices = ivec3(texelFetch(uTexturePerPolygonIdIndices, ivec2(h_index, v_index), 0));"),s.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),s.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),s.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),s.push("mat4 positionsDecodeMatrix = mat4 (texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+0, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+1, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0), texelFetch (uTexturePerObjectIdPositionsDecodeMatrix, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0));"),s.push("uvec4 flags = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+2, objectIndexCoords.y), 0);"),s.push("uvec4 flags2 = texelFetch (uTexturePerObjectIdColorsAndFlags, ivec2(objectIndexCoords.x*8+3, objectIndexCoords.y), 0);"),s.push("vec3 position1 = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.r, indexPositionV.r), 0));"),s.push("vec3 position2 = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.g, indexPositionV.g), 0));"),s.push("vec3 position3 = vec3(texelFetch(uTexturePerVertexIdCoordinates, ivec2(indexPositionH.b, indexPositionV.b), 0));"),s.push("vec3 normal = normalize(cross(position3 - position1, position2 - position1));"),s.push("int vertexNumber = gl_VertexID % 3;"),s.push("vec3 position;"),s.push("if (vertexNumber == 0) position = position1;"),s.push("else if (vertexNumber == 1) position = position2;"),s.push("else position = position3;"),s.push("if (int(flags.w) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("      vWorldPosition = worldPosition;"),t&&s.push("      vFlags2 = flags2.r;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Triangles dataTexture pick flat normals fragment shader"),i.push("#extension GL_OES_standard_derivatives : enable"),e.logarithmicDepthBufferEnabled&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),i.push("in vec4 vWorldPosition;"),s){i.push("in int vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("uniform bool sectionPlaneActive"+r+";"),i.push("uniform vec3 sectionPlanePos"+r+";"),i.push("uniform vec3 sectionPlaneDir"+r+";")}if(i.push("out vec4 outNormal;"),i.push("void main(void) {"),s){i.push("  bool clippable = vFlags2 > 0;"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("  vec3 xTangent = dFdx( vWorldPosition.xyz );"),i.push("  vec3 yTangent = dFdy( vWorldPosition.xyz );"),i.push("  vec3 worldNormal = normalize( cross( xTangent, yTangent ) );"),i.push("  outNormal = vec4((worldNormal * 0.5) + 0.5, 1.0);"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class fs{constructor(e){this._scene=e}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._colorRendererWithSAO&&!this._colorRendererWithSAO.getValid()&&(this._colorRendererWithSAO.destroy(),this._colorRendererWithSAO=null),this._flatColorRenderer&&!this._flatColorRenderer.getValid()&&(this._flatColorRenderer.destroy(),this._flatColorRenderer=null),this._flatColorRendererWithSAO&&!this._flatColorRendererWithSAO.getValid()&&(this._flatColorRendererWithSAO.destroy(),this._flatColorRendererWithSAO=null),this._colorQualityRenderer&&!this._colorQualityRenderer.getValid()&&(this._colorQualityRenderer.destroy(),this._colorQualityRenderer=null),this._colorQualityRendererWithSAO&&!this._colorQualityRendererWithSAO.getValid()&&(this._colorQualityRendererWithSAO.destroy(),this._colorQualityRendererWithSAO=null),this._depthRenderer&&!this._depthRenderer.getValid()&&(this._depthRenderer.destroy(),this._depthRenderer=null),this._normalsRenderer&&!this._normalsRenderer.getValid()&&(this._normalsRenderer.destroy(),this._normalsRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._edgesRenderer&&!this._edgesRenderer.getValid()&&(this._edgesRenderer.destroy(),this._edgesRenderer=null),this._edgesColorRenderer&&!this._edgesColorRenderer.getValid()&&(this._edgesColorRenderer.destroy(),this._edgesColorRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._pickNormalsRenderer&&!1===this._pickNormalsRenderer.getValid()&&(this._pickNormalsRenderer.destroy(),this._pickNormalsRenderer=null),this._pickNormalsFlatRenderer&&!1===this._pickNormalsFlatRenderer.getValid()&&(this._pickNormalsFlatRenderer.destroy(),this._pickNormalsFlatRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null),this._shadowRenderer&&!this._shadowRenderer.getValid()&&(this._shadowRenderer.destroy(),this._shadowRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new Vt(this._scene,!1)),this._colorRenderer}get colorRendererWithSAO(){return this._colorRendererWithSAO||(this._colorRendererWithSAO=new Vt(this._scene,!0)),this._colorRendererWithSAO}get colorQualityRenderer(){return this._colorQualityRenderer||(this._colorQualityRenderer=new ps(this._scene,!1)),this._colorQualityRenderer}get colorQualityRendererWithSAO(){return this._colorQualityRendererWithSAO||(this._colorQualityRendererWithSAO=new ps(this._scene,!0)),this._colorQualityRendererWithSAO}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new Wt(this._scene)),this._silhouetteRenderer}get depthRenderer(){return this._depthRenderer||(this._depthRenderer=new os(this._scene)),this._depthRenderer}get normalsRenderer(){return this._normalsRenderer||(this._normalsRenderer=new as(this._scene)),this._normalsRenderer}get edgesRenderer(){return this._edgesRenderer||(this._edgesRenderer=new Kt(this._scene)),this._edgesRenderer}get edgesColorRenderer(){return this._edgesColorRenderer||(this._edgesColorRenderer=new Zt(this._scene)),this._edgesColorRenderer}get pickMeshRenderer(){return this._pickMeshRenderer||(this._pickMeshRenderer=new qt(this._scene)),this._pickMeshRenderer}get pickNormalsRenderer(){return this._pickNormalsRenderer||(this._pickNormalsRenderer=new ss(this._scene)),this._pickNormalsRenderer}get pickNormalsFlatRenderer(){return this._pickNormalsFlatRenderer||(this._pickNormalsFlatRenderer=new ms(this._scene)),this._pickNormalsFlatRenderer}get pickDepthRenderer(){return this._pickDepthRenderer||(this._pickDepthRenderer=new es(this._scene)),this._pickDepthRenderer}get occlusionRenderer(){return this._occlusionRenderer||(this._occlusionRenderer=new is(this._scene)),this._occlusionRenderer}get shadowRenderer(){return this._shadowRenderer||(this._shadowRenderer=new hs(this._scene)),this._shadowRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._colorRendererWithSAO&&this._colorRendererWithSAO.destroy(),this._flatColorRenderer&&this._flatColorRenderer.destroy(),this._flatColorRendererWithSAO&&this._flatColorRendererWithSAO.destroy(),this._colorQualityRenderer&&this._colorQualityRenderer.destroy(),this._colorQualityRendererWithSAO&&this._colorQualityRendererWithSAO.destroy(),this._depthRenderer&&this._depthRenderer.destroy(),this._normalsRenderer&&this._normalsRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._edgesRenderer&&this._edgesRenderer.destroy(),this._edgesColorRenderer&&this._edgesColorRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._pickNormalsRenderer&&this._pickNormalsRenderer.destroy(),this._pickNormalsFlatRenderer&&this._pickNormalsFlatRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy(),this._shadowRenderer&&this._shadowRenderer.destroy()}}const gs={};ce.SUPPORTED_EXTENSIONS.OES_element_index_uint;class _s{constructor(){this.positions=[],this.metallicRoughness=[],this.indices8Bits=[],this.indices16Bits=[],this.indices32Bits=[],this.edgeIndices8Bits=[],this.edgeIndices16Bits=[],this.edgeIndices32Bits=[],this.perObjectColors=[],this.perObjectPickColors=[],this.perObjectSolid=[],this.perObjectOffsets=[],this.perObjectPositionsDecodeMatrices=[],this.perObjectInstancePositioningMatrices=[],this.perObjectVertexBases=[],this.perObjectIndexBaseOffsets=[],this.perObjectEdgeIndexBaseOffsets=[],this.perTriangleNumberPortionId8Bits=[],this.perTriangleNumberPortionId16Bits=[],this.perTriangleNumberPortionId32Bits=[],this.perEdgeNumberPortionId8Bits=[],this.perEdgeNumberPortionId16Bits=[],this.perEdgeNumberPortionId32Bits=[]}}
/**
 * @author https://github.com/tmarti, with support from https://tribia.com/
 * @license MIT
 * 
 * This file takes a geometry given by { positions, indices }, and returns
 * equivalent { positions, indices } arrays but which only contain unique
 * positions.
 * 
 * The time is O(N logN) with the number of positions due to a pre-sorting
 * step, but is much more GC-friendly and actually faster than the classic O(N)
 * approach based in keeping a hash-based LUT to identify unique positions.
 */let ys=null;function vs(e,t){let s;for(let i=0;i<3;i++)if(0!=(s=ys[3*e+i]-ys[3*t+i]))return s;return 0}let bs=null;function xs(e){let t=e.positions,s=e.indices,i=e.edgeIndices;!function(e){if(!(null!==bs&&bs.length>=e)){bs=new Uint32Array(e);for(let t=0;t<e;t++)bs[t]=t}}(t.length/3);let r=bs.slice(0,t.length/3),o=bs.slice(0,t.length/3);ys=t,r.sort(vs);let n=0;o[r[0]]=0;for(let e=1,t=r.length;e<t;e++)0!=vs(r[e],r[e-1])&&n++,o[r[e]]=n;const a=new Uint16Array(3*(n+1));n=0,a[3*n+0]=t[3*r[0]+0],a[3*n+1]=t[3*r[0]+1],a[3*n+2]=t[3*r[0]+2];for(let e=1,s=r.length;e<s;e++)0!=vs(r[e],r[e-1])&&(n++,a[3*n+0]=t[3*r[e]+0],a[3*n+1]=t[3*r[e]+1],a[3*n+2]=t[3*r[e]+2]),o[r[e]]=n;ys=null;let h=new Uint32Array(s.length);for(let e=0,t=s.length;e<t;e++)h[e]=o[s[e]];let l=new Uint32Array(i.length);for(let e=0,t=i.length;e<t;e++)l[e]=o[i[e]];return[a,h,l]}
/**
 * @author https://github.com/tmarti, with support from https://tribia.com/
 * @license MIT
 **/let Ps=null;function Ts(e,t){let s,i,r,o,n,a,h=3*e,l=3*t;const u=Math.min(s=Ps[h],i=Ps[h+1],r=Ps[h+2]),c=Math.min(o=Ps[l],n=Ps[l+1],a=Ps[l+2]);if(u!=c)return u-c;const p=Math.max(s,i,r),d=Math.max(o,n,a);return p!=d?p-d:0}let ws=null;function Ms(e,t){let s=ws[2*e]-ws[2*t];return 0!=s?s:ws[2*e+1]-ws[2*t+1]}function Is(e,t,s=!1){const i=e.positions||[],r=function(e,t){let s=new Int32Array(e.length/3);for(let e=0,t=s.length;e<t;e++)s[e]=e;Ps=new Int32Array(e.length);for(let s=0,i=e.length;s<i;s++)Ps[s]=e[s]>>t;s.sort(Ts);const i=new Int32Array(e.length);for(let t=0,r=s.length;t<r;t++)i[3*t+0]=e[3*s[t]+0],i[3*t+1]=e[3*s[t]+1],i[3*t+2]=e[3*s[t]+2];return i}(e.indices||[],t),o=function(e){if(0==(e||[]).length)return[];let t=new Int32Array(e.length/2);for(let e=0,s=t.length;e<s;e++)t[e]=e;for(let t=0,s=e.length;t<s;t+=2)if(e[t]>e[t+1]){let s=e[t];e[t]=e[t+1],e[t+1]=s}ws=new Int32Array(e),t.sort(Ms);const s=new Int32Array(e.length);for(let i=0,r=t.length;i<r;i++)s[2*i+0]=e[2*t[i]+0],s[2*i+1]=e[2*t[i]+1];return s}(e.edgeIndices||[]);function n(e,t){if(e>t){let s=e;e=t,t=s}function s(s,i){return s!=e?e-s:i!=t?t-i:0}for(var i=0,r=(o.length>>1)-1;i<=r;){var n=r+i>>1,a=s(o[2*n],o[2*n+1]);if(a>0)i=n+1;else{if(!(a<0))return n;r=n-1}}return-i-1}const a=new Int32Array(o.length/2);a.fill(0);const h=i.length/3;if(h>8*(1<<t))return[e];const l=new Int32Array(h);l.fill(-1);const u=[];function c(){l.fill(-1);let e={positions:[],indices:[],edgeIndices:[],maxNumPositions:(1<<t)-t,numPositions:0,bucketNumber:u.length};return u.push(e),e}let p=c();for(let t=0,s=r.length;t<s;t+=3){let s=0;const h=r[t],u=r[t+1],d=r[t+2];if(-1==l[h]&&s++,-1==l[u]&&s++,-1==l[d]&&s++,s+p.numPositions>p.maxNumPositions&&(p=c()),p.bucketNumber>8)return[e];let m;-1==l[h]&&(l[h]=p.numPositions++,p.positions.push(i[3*h]),p.positions.push(i[3*h+1]),p.positions.push(i[3*h+2])),-1==l[u]&&(l[u]=p.numPositions++,p.positions.push(i[3*u]),p.positions.push(i[3*u+1]),p.positions.push(i[3*u+2])),-1==l[d]&&(l[d]=p.numPositions++,p.positions.push(i[3*d]),p.positions.push(i[3*d+1]),p.positions.push(i[3*d+2])),p.indices.push(l[h]),p.indices.push(l[u]),p.indices.push(l[d]),(m=n(h,u))>=0&&0==a[m]&&(a[m]=1,p.edgeIndices.push(l[o[2*m]]),p.edgeIndices.push(l[o[2*m+1]])),(m=n(h,d))>=0&&0==a[m]&&(a[m]=1,p.edgeIndices.push(l[o[2*m]]),p.edgeIndices.push(l[o[2*m+1]])),(m=n(u,d))>=0&&0==a[m]&&(a[m]=1,p.edgeIndices.push(l[o[2*m]]),p.edgeIndices.push(l[o[2*m+1]]))}const d=t/8*2,m=t/8,f=2*i.length+(r.length+o.length)*d;let g=0,_=-i.length/3;return u.forEach((e=>{g+=2*e.positions.length+(e.indices.length+e.edgeIndices.length)*m,_+=e.positions.length/3})),g>f?[e]:(s&&function(e,t){const s={},i={};let r=0;e.forEach((e=>{let t=e.indices,o=e.edgeIndices,n=e.positions;for(var a=0,h=t.length;a<h;a+=3){var l=n[3*t[a]]+"_"+n[3*t[a]+1]+"_"+n[3*t[a]+2]+"/"+n[3*t[a+1]]+"_"+n[3*t[a+1]+1]+"_"+n[3*t[a+1]+2]+"/"+n[3*t[a+2]]+"_"+n[3*t[a+2]+1]+"_"+n[3*t[a+2]+2];s[l]=!0}r+=e.edgeIndices.length/2;for(a=0,h=o.length;a<h;a+=2){l=n[3*o[a]]+"_"+n[3*o[a]+1]+"_"+n[3*o[a]+2]+"/"+n[3*o[a+1]]+"_"+n[3*o[a+1]+1]+"_"+n[3*o[a+1]+2]+"/";i[l]=!0}}));{let e=t.indices;t.edgeIndices;let i=t.positions;for(var o=0,n=e.length;o<n;o+=3){var a=i[3*e[o]]+"_"+i[3*e[o]+1]+"_"+i[3*e[o]+2]+"/"+i[3*e[o+1]]+"_"+i[3*e[o+1]+1]+"_"+i[3*e[o+1]+2]+"/"+i[3*e[o+2]]+"_"+i[3*e[o+2]+1]+"_"+i[3*e[o+2]+2];if(!(a in s))throw console.log("Not found "+a),"Ohhhh!"}}}(u,e),u)}const Cs={sizeDataColorsAndFlags:0,sizeDataPositionDecodeMatrices:0,sizeDataTextureOffsets:0,sizeDataTexturePositions:0,sizeDataTextureIndices:0,sizeDataTextureEdgeIndices:0,sizeDataTexturePortionIds:0,numberOfGeometries:0,numberOfPortions:0,numberOfLayers:0,numberOfTextures:0,totalPolygons:0,totalPolygons8Bits:0,totalPolygons16Bits:0,totalPolygons32Bits:0,totalEdges:0,totalEdges8Bits:0,totalEdges16Bits:0,totalEdges32Bits:0,cannotCreatePortion:{because10BitsObjectId:0,becauseTextureSize:0},overheadSizeAlignementIndices:0,overheadSizeAlignementEdgeIndices:0};window.printDataTextureRamStats=function(){console.log(JSON.stringify(Cs,null,4));let e=0;Object.keys(Cs).forEach((t=>{t.startsWith("size")&&(e+=Cs[t])})),console.log(`Total size ${e} bytes (${(e/1e3/1e3).toFixed(2)} MB)`),console.log(`Avg bytes / triangle: ${(e/Cs.totalPolygons).toFixed(2)}`);let t={};Object.keys(Cs).forEach((s=>{s.startsWith("size")&&(t[s]=`${(Cs[s]/e*100).toFixed(2)} % of total`)})),console.log(JSON.stringify({percentualRamUsage:t},null,4))};class Ds{constructor(e,t,s,i,r=null){this._gl=e,this._texture=t,this._textureWidth=s,this._textureHeight=i,this._textureData=r}bindTexture(e,t,s){return e.bindTexture(t,this,s)}bind(e){return this._gl.activeTexture(this._gl["TEXTURE"+e]),this._gl.bindTexture(this._gl.TEXTURE_2D,this._texture),!0}unbind(e){}}class As{constructor(){this.texturePerObjectIdColorsAndFlags=null,this.texturePerObjectIdOffsets=null,this.texturePerObjectIdPositionsDecodeMatrix=null,this.texturePerVertexIdCoordinates=null,this.texturePerPolygonIdPortionIds8Bits=null,this.texturePerPolygonIdPortionIds16Bits=null,this.texturePerPolygonIdPortionIds32Bits=null,this.texturePerEdgeIdPortionIds8Bits=null,this.texturePerEdgeIdPortionIds16Bits=null,this.texturePerEdgeIdPortionIds32Bits=null,this.texturePerPolygonIdIndices8Bits=null,this.texturePerPolygonIdIndices16Bits=null,this.texturePerPolygonIdIndices32Bits=null,this.texturePerPolygonIdEdgeIndices8Bits=null,this.texturePerPolygonIdEdgeIndices16Bits=null,this.texturePerPolygonIdEdgeIndices32Bits=null,this.textureCameraMatrices=null,this.texturePickCameraMatrices=null,this.textureModelMatrices=null}finalize(){this.indicesPerBitnessTextures={8:this.texturePerPolygonIdIndices8Bits,16:this.texturePerPolygonIdIndices16Bits,32:this.texturePerPolygonIdIndices32Bits},this.indicesPortionIdsPerBitnessTextures={8:this.texturePerPolygonIdPortionIds8Bits,16:this.texturePerPolygonIdPortionIds16Bits,32:this.texturePerPolygonIdPortionIds32Bits},this.edgeIndicesPerBitnessTextures={8:this.texturePerPolygonIdEdgeIndices8Bits,16:this.texturePerPolygonIdEdgeIndices16Bits,32:this.texturePerPolygonIdEdgeIndices32Bits},this.edgeIndicesPortionIdsPerBitnessTextures={8:this.texturePerEdgeIdPortionIds8Bits,16:this.texturePerEdgeIdPortionIds16Bits,32:this.texturePerEdgeIdPortionIds32Bits}}bindCommonTextures(e,t,s,i,r,o,n){this.texturePerObjectIdPositionsDecodeMatrix.bindTexture(e,t,1),this.texturePerVertexIdCoordinates.bindTexture(e,s,2),this.texturePerObjectIdColorsAndFlags.bindTexture(e,i,3),this.textureCameraMatrices.bindTexture(e,r,4),this.textureModelMatrices.bindTexture(e,o,5),this.texturePerObjectIdOffsets.bindTexture(e,n,6)}bindPickCameraTexture(e,t){this.texturePickCameraMatrices.bindTexture(e,t,4)}bindTriangleIndicesTextures(e,t,s,i){this.indicesPortionIdsPerBitnessTextures[i].bindTexture(e,t,7),this.indicesPerBitnessTextures[i].bindTexture(e,s,8)}bindEdgeIndicesTextures(e,t,s,i){this.edgeIndicesPortionIdsPerBitnessTextures[i].bindTexture(e,t,7),this.edgeIndicesPerBitnessTextures[i].bindTexture(e,s,8)}}class Es{disableBindedTextureFiltering(e){e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}generateCameraDataTexture(e,t,s,i,r=!0){const o=e.createTexture();e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA32F,4,3),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null);const n=new Ds(e,o,4,3);let a=!0;if(n._updateViewMatrix=(s,r)=>{e.bindTexture(e.TEXTURE_2D,n._texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,4,1,e.RGBA,e.FLOAT,new Float32Array(i?U(s,i):s)),e.texSubImage2D(e.TEXTURE_2D,0,0,1,4,1,e.RGBA,e.FLOAT,new Float32Array(t.viewNormalMatrix)),e.texSubImage2D(e.TEXTURE_2D,0,0,2,4,1,e.RGBA,e.FLOAT,new Float32Array(r))},r){const e=()=>{a&&(a=!1,n._updateViewMatrix(t.viewMatrix,t.project.matrix))};t.on("matrix",(()=>a=!0)),s.on("rendering",e),e()}return n}generatePeformanceModelDataTexture(e,t){const s=e.createTexture();return e.bindTexture(e.TEXTURE_2D,s),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA32F,4,2),e.texSubImage2D(e.TEXTURE_2D,0,0,0,4,1,e.RGBA,e.FLOAT,new Float32Array(t.worldMatrix)),e.texSubImage2D(e.TEXTURE_2D,0,0,1,4,1,e.RGBA,e.FLOAT,new Float32Array(t.worldNormalMatrix)),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null),new Ds(e,s,4,2)}generateTextureForColorsAndFlags(e,t,s,i,r,o,n){const a=t.length;this.numPortions=a;const h=4096,l=Math.ceil(a/512);if(0==l)throw"texture height == 0";const u=new Uint8Array(16384*l);Cs.sizeDataColorsAndFlags+=u.byteLength,Cs.numberOfTextures++;for(let e=0;e<a;e++)u.set(t[e],32*e+0),u.set(s[e],32*e+4),u.set([0,0,0,0],32*e+8),u.set([0,0,0,0],32*e+12),u.set([i[e]>>24&255,i[e]>>16&255,i[e]>>8&255,255&i[e]],32*e+16),u.set([r[e]>>24&255,r[e]>>16&255,r[e]>>8&255,255&r[e]],32*e+20),u.set([o[e]>>24&255,o[e]>>16&255,o[e]>>8&255,255&o[e]],32*e+24),u.set([n[e]?1:0,0,0,0],32*e+28);const c=e.createTexture();return e.bindTexture(e.TEXTURE_2D,c),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8UI,h,l),e.texSubImage2D(e.TEXTURE_2D,0,0,0,h,l,e.RGBA_INTEGER,e.UNSIGNED_BYTE,u,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Ds(e,c,h,l,u)}generateTextureForObjectOffsets(e,t){const s=512,i=Math.ceil(t/s);if(0==i)throw"texture height == 0";var r=new Float32Array(1536*i).fill(0);Cs.sizeDataTextureOffsets+=r.byteLength,Cs.numberOfTextures++;const o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32F,s,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,s,i,e.RGB,e.FLOAT,r,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Ds(e,o,s,i,r)}generateTextureForPositionsDecodeMatrices(e,t,s){const i=t.length;if(0==i)throw"num decode+entity matrices == 0";const r=4096,o=Math.ceil(i/512);var n=new Float32Array(16384*o);Cs.sizeDataPositionDecodeMatrices+=n.byteLength,Cs.numberOfTextures++;for(var a=0;a<t.length;a++)n.set(t[a],32*a),n.set(s[a],32*a+16);const h=e.createTexture();return e.bindTexture(e.TEXTURE_2D,h),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA32F,r,o),e.texSubImage2D(e.TEXTURE_2D,0,0,0,r,o,e.RGBA,e.FLOAT,n,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Ds(e,h,r,o)}generateTextureFor8BitIndices(e,t){if(0==t.length)return{texture:null,textureHeight:0};const s=4096,i=Math.ceil(t.length/3/s);if(0==i)throw"texture height == 0";const r=new Uint8Array(s*i*3);Cs.sizeDataTextureIndices+=r.byteLength,Cs.numberOfTextures++,r.fill(0),r.set(t,0);const o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB8UI,s,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,s,i,e.RGB_INTEGER,e.UNSIGNED_BYTE,r,0),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null),new Ds(e,o,s,i)}generateTextureFor16BitIndices(e,t){if(0==t.length)return{texture:null,textureHeight:0};const s=4096,i=Math.ceil(t.length/3/s);if(0==i)throw"texture height == 0";const r=new Uint16Array(s*i*3);Cs.sizeDataTextureIndices+=r.byteLength,Cs.numberOfTextures++,r.fill(0),r.set(t,0);const o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,s,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,s,i,e.RGB_INTEGER,e.UNSIGNED_SHORT,r,0),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null),new Ds(e,o,s,i)}generateTextureFor32BitIndices(e,t){if(0==t.length)return{texture:null,textureHeight:0};const s=4096,i=Math.ceil(t.length/3/s);if(0==i)throw"texture height == 0";const r=new Uint32Array(s*i*3);Cs.sizeDataTextureIndices+=r.byteLength,Cs.numberOfTextures++,r.fill(0),r.set(t,0);const o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RGB32UI,s,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,s,i,e.RGB_INTEGER,e.UNSIGNED_INT,r,0),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null),new Ds(e,o,s,i)}generateTextureFor8BitsEdgeIndices(e,t){if(0==t.length)return{texture:null,textureHeight:0};const s=4096,i=Math.ceil(t.length/2/s);if(0==i)throw"texture height == 0";const r=new Uint8Array(s*i*2);Cs.sizeDataTextureEdgeIndices+=r.byteLength,Cs.numberOfTextures++,r.fill(0),r.set(t,0);const o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG8UI,s,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,s,i,e.RG_INTEGER,e.UNSIGNED_BYTE,r,0),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null),new Ds(e,o,s,i)}generateTextureFor16BitsEdgeIndices(e,t){if(0==t.length)return{texture:null,textureHeight:0};const s=4096,i=Math.ceil(t.length/2/s);if(0==i)throw"texture height == 0";const r=new Uint16Array(s*i*2);Cs.sizeDataTextureEdgeIndices+=r.byteLength,Cs.numberOfTextures++,r.fill(0),r.set(t,0);const o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG16UI,s,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,s,i,e.RG_INTEGER,e.UNSIGNED_SHORT,r,0),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null),new Ds(e,o,s,i)}generateTextureFor32BitsEdgeIndices(e,t){if(0==t.length)return{texture:null,textureHeight:0};const s=4096,i=Math.ceil(t.length/2/s);if(0==i)throw"texture height == 0";const r=new Uint32Array(s*i*2);Cs.sizeDataTextureEdgeIndices+=r.byteLength,Cs.numberOfTextures++,r.fill(0),r.set(t,0);const o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texStorage2D(e.TEXTURE_2D,1,e.RG32UI,s,i),e.texSubImage2D(e.TEXTURE_2D,0,0,0,s,i,e.RG_INTEGER,e.UNSIGNED_INT,r,0),this.disableBindedTextureFiltering(e),e.bindTexture(e.TEXTURE_2D,null),new Ds(e,o,s,i)}generateTextureForPositions(e,t){const s=t.length/3,i=4096,r=Math.ceil(s/i);if(0==r)throw"texture height == 0";const o=new Uint16Array(i*r*3);Cs.sizeDataTexturePositions+=o.byteLength,Cs.numberOfTextures++,o.fill(0),o.set(t,0);const n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.RGB16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RGB_INTEGER,e.UNSIGNED_SHORT,o,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Ds(e,n,i,r)}generateTextureForPackedPortionIds(e,t){if(0==t.length)return{texture:null,textureHeight:0};const s=t.length,i=4096,r=Math.ceil(s/i);if(0==r)throw"texture height == 0";const o=new Uint16Array(i*r);o.set(t,0),Cs.sizeDataTexturePortionIds+=o.byteLength,Cs.numberOfTextures++;const n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.texStorage2D(e.TEXTURE_2D,1,e.R16UI,i,r),e.texSubImage2D(e.TEXTURE_2D,0,0,0,i,r,e.RED_INTEGER,e.UNSIGNED_SHORT,o,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),new Ds(e,n,i,r)}}const Fs=p.identityMat4();p.mat4(),p.mat4();const Rs=p.vec4([0,0,0,1]),Ss=p.vec4([0,0,0,1]),Os=p.vec4([0,0,0,1]),Bs=p.OBB3(),Ls=new Uint8Array(4),Ns=new Float32Array(3),ks=p.vec3(),js=p.vec3(),Gs=p.vec3(),Hs=p.vec3(),Vs=p.vec3(),Us=p.vec3(),zs=p.vec3();let Ws=0;class Xs{constructor(e,t){this._layerNumber=Ws++,Cs.numberOfLayers++,this.sortId=`TrianglesDataTextureLayer-${this._layerNumber}`,this.layerIndex=t.layerIndex,this._dataTextureRenderers=function(e){const t=e.id;let s=gs[t];return s||(s=new fs(e),gs[t]=s,s._compile(),e.on("compile",(()=>{s._compile()})),e.on("destroyed",(()=>{delete gs[t],s._destroy()}))),s}(e.scene),this.model=e,this._buffer=new _s,this._dataTextureState=new As,this.dataTextureGenerator=new Es,this._state=new ft({metallicRoughnessBuf:null,positionsDecodeMatrix:p.mat4(),textureState:this._dataTextureState,numIndices8Bits:0,numIndices16Bits:0,numIndices32Bits:0,numEdgeIndices8Bits:0,numEdgeIndices16Bits:0,numEdgeIndices32Bits:0,numVertices:0}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numSelectedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._modelAABB=p.collapseAABB3(),this._portions=[],this._finalized=!1,this._subPortionIdMapping=[],this._instancedGeometrySubPortionData={},this.aabb=p.collapseAABB3(),this.numUpdatesInFrame=0}canCreatePortion(e,t=null){if(this._finalized)throw"Already finalized";const s=this._state,i=e.preparedBuckets.length;this._numPortions+i>65536&&Cs.cannotCreatePortion.because10BitsObjectId++;let r=this._numPortions+i<=65536;if(!(null!==t&&t+"#0"in this._instancedGeometrySubPortionData)){const t=Math.max(s.numIndices8Bits,s.numIndices16Bits,s.numIndices32Bits);let i=0,o=e.indices.length/3;e.preparedBuckets.forEach((e=>{i+=e.positions.length/3})),(s.numVertices+i>16777216||t+o>16777216)&&Cs.cannotCreatePortion.becauseTextureSize++,r&&=s.numVertices+i<=16777216&&t+o<=16777216}return r}createPortion(e,t=null){if(this._finalized)throw"Already finalized";const s=null!==t;let i=this._subPortionIdMapping.length;const r=[];this._subPortionIdMapping.push(r);const o=s?t.aabb:e.aabb;return e.preparedBuckets.forEach(((i,n)=>{let a;if(s){const t=e.id+"#"+n;t in this._instancedGeometrySubPortionData||(this._instancedGeometrySubPortionData[t]=this.createSubPortionGeometry(i)),a=this._instancedGeometrySubPortionData[t]}else a=this.createSubPortionGeometry(i);const h=p.collapseAABB3(),l=this.createSubPortionObject(s?t:e,a,i.positions,e.positionsDecodeMatrix,s?t.origin:e.origin,h,s,e.solid);p.expandAABB3(o,h),r.push(l)})),this.model.numPortions++,i}createSubPortionGeometry(e){const t=this._state;if(e.indices){const t=8*Math.ceil(e.indices.length/3/8)*3;Cs.overheadSizeAlignementIndices+=2*(t-e.indices.length);const s=new Uint32Array(t);s.fill(0),s.set(e.indices),e.indices=s}if(e.edgeIndices){const t=8*Math.ceil(e.edgeIndices.length/2/8)*2;Cs.overheadSizeAlignementEdgeIndices+=2*(t-e.edgeIndices.length);const s=new Uint32Array(t);s.fill(0),s.set(e.edgeIndices),e.edgeIndices=s}const s=e.positions,i=e.indices,r=e.edgeIndices,o=this._buffer,n=o.positions.length/3,a=s.length/3;for(let e=0,t=s.length;e<t;e++)o.positions.push(s[e]);let h,l,u=0;if(i){let e;u=i.length/3,e=a<=256?o.indices8Bits:a<=65536?o.indices16Bits:o.indices32Bits,h=e.length/3;for(let t=0,s=i.length;t<s;t++)e.push(i[t])}let c=0;if(r){let e;c=r.length/2,e=a<=256?o.edgeIndices8Bits:a<=65536?o.edgeIndices16Bits:o.edgeIndices32Bits,l=e.length/2;for(let t=0,s=r.length;t<s;t++)e.push(r[t])}return t.numVertices+=a,Cs.numberOfGeometries++,{vertexBase:n,numVertices:a,numTriangles:u,numEdges:c,indicesBase:h,edgeIndicesBase:l}}createSubPortionObject(e,t,s,i,r,o,n,a){const h=e.color;e.metallic,e.roughness;const l=e.colors,u=e.opacity,c=e.meshMatrix,d=e.worldMatrix,m=e.pickColor;this.model.scene;const f=this._buffer,g=this._state;if(f.perObjectPositionsDecodeMatrices.push(i),n?f.perObjectInstancePositioningMatrices.push(c):f.perObjectInstancePositioningMatrices.push(Fs),n){const e=p.collapseAABB3();p.expandAABB3Points3(e,s),Pt.decompressAABB(e,i);const t=p.AABB3ToOBB3(e);for(let e=0,s=t.length;e<s;e+=4)Rs[0]=t[e+0],Rs[1]=t[e+1],Rs[2]=t[e+2],p.transformPoint4(c,Rs,Ss),d?(p.transformPoint4(d,Ss,Os),p.expandAABB3Point3(o,Os)):p.expandAABB3Point3(o,Ss)}else if(i){const e=Pt.getPositionsBounds(s),t=Pt.decompressPosition(e.min,i,[]),r=Pt.decompressPosition(e.max,i,[]);o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=r[0],o[4]=r[1],o[5]=r[2],d&&(p.AABB3ToOBB3(o,Bs),p.transformOBB3(d,Bs),p.OBB3ToAABB3(Bs,o))}else if(c)for(let e=0,t=s.length;e<t;e+=3)Rs[0]=s[e+0],Rs[1]=s[e+1],Rs[2]=s[e+2],p.transformPoint4(c,Rs,Ss),s[e+0]=Ss[0],s[e+1]=Ss[1],s[e+2]=Ss[2],p.expandAABB3Point3(this._modelAABB,Ss),d?(p.transformPoint4(d,Ss,Os),p.expandAABB3Point3(o,Os)):p.expandAABB3Point3(o,Ss);else for(let e=0,t=s.length;e<t;e+=3)Rs[0]=s[e+0],Rs[1]=s[e+1],Rs[2]=s[e+2],p.expandAABB3Point3(this._modelAABB,Rs),d?(p.transformPoint4(d,Rs,Ss),p.expandAABB3Point3(o,Ss)):p.expandAABB3Point3(o,Rs);r&&(this._state.origin=r,o[0]+=r[0],o[1]+=r[1],o[2]+=r[2],o[3]+=r[0],o[4]+=r[1],o[5]+=r[2]),p.expandAABB3(this.aabb,o),f.perObjectSolid.push(a),l?f.perObjectColors.push([255*l[0],255*l[1],255*l[2],255]):h&&f.perObjectColors.push([h[0],h[1],h[2],u]),f.perObjectPickColors.push(m),f.perObjectVertexBases.push(t.vertexBase);{let e;e=t.numVertices<=256?g.numIndices8Bits:t.numVertices<=65536?g.numIndices16Bits:g.numIndices32Bits,f.perObjectIndexBaseOffsets.push(e/3-t.indicesBase)}{let e;e=t.numVertices<=256?g.numEdgeIndices8Bits:t.numVertices<=65536?g.numEdgeIndices16Bits:g.numEdgeIndices32Bits,f.perObjectEdgeIndexBaseOffsets.push(e/2-t.edgeIndicesBase)}const _=this._portions.length;if(t.numTriangles>0){let e,s=3*t.numTriangles;t.numVertices<=256?(e=f.perTriangleNumberPortionId8Bits,g.numIndices8Bits+=s,Cs.totalPolygons8Bits+=t.numTriangles):t.numVertices<=65536?(e=f.perTriangleNumberPortionId16Bits,g.numIndices16Bits+=s,Cs.totalPolygons16Bits+=t.numTriangles):(e=f.perTriangleNumberPortionId32Bits,g.numIndices32Bits+=s,Cs.totalPolygons32Bits+=t.numTriangles),Cs.totalPolygons+=t.numTriangles;for(let s=0;s<t.numTriangles;s+=8)e.push(_)}if(t.numEdges>0){let e,s=2*t.numEdges;t.numVertices<=256?(e=f.perEdgeNumberPortionId8Bits,g.numEdgeIndices8Bits+=s,Cs.totalEdges8Bits+=t.numEdges):t.numVertices<=65536?(e=f.perEdgeNumberPortionId16Bits,g.numEdgeIndices16Bits+=s,Cs.totalEdges16Bits+=t.numEdges):(e=f.perEdgeNumberPortionId32Bits,g.numEdgeIndices32Bits+=s,Cs.totalEdges32Bits+=t.numEdges),Cs.totalEdges+=t.numEdges;for(let s=0;s<t.numEdges;s+=8)e.push(_)}return f.perObjectOffsets.push([0,0,0]),this._portions.push({numVerts:t.numTriangles}),this._numPortions++,Cs.numberOfPortions++,_}finalize(){if(this._finalized)return void this.model.error("Already finalized");const e=this._state,t=this._dataTextureState,s=this.model.scene.canvas.gl,i=this._buffer;e.gl=s,t.texturePerObjectIdColorsAndFlags=this.dataTextureGenerator.generateTextureForColorsAndFlags(s,i.perObjectColors,i.perObjectPickColors,i.perObjectVertexBases,i.perObjectIndexBaseOffsets,i.perObjectEdgeIndexBaseOffsets,i.perObjectSolid),t.texturePerObjectIdOffsets=this.dataTextureGenerator.generateTextureForObjectOffsets(s,this._numPortions),t.texturePerObjectIdPositionsDecodeMatrix=this.dataTextureGenerator.generateTextureForPositionsDecodeMatrices(s,i.perObjectPositionsDecodeMatrices,i.perObjectInstancePositioningMatrices),t.texturePerVertexIdCoordinates=this.dataTextureGenerator.generateTextureForPositions(s,i.positions),t.texturePerPolygonIdPortionIds8Bits=this.dataTextureGenerator.generateTextureForPackedPortionIds(s,i.perTriangleNumberPortionId8Bits),t.texturePerPolygonIdPortionIds16Bits=this.dataTextureGenerator.generateTextureForPackedPortionIds(s,i.perTriangleNumberPortionId16Bits),t.texturePerPolygonIdPortionIds32Bits=this.dataTextureGenerator.generateTextureForPackedPortionIds(s,i.perTriangleNumberPortionId32Bits),i.perEdgeNumberPortionId8Bits.length>0&&(t.texturePerEdgeIdPortionIds8Bits=this.dataTextureGenerator.generateTextureForPackedPortionIds(s,i.perEdgeNumberPortionId8Bits)),i.perEdgeNumberPortionId16Bits.length>0&&(t.texturePerEdgeIdPortionIds16Bits=this.dataTextureGenerator.generateTextureForPackedPortionIds(s,i.perEdgeNumberPortionId16Bits)),i.perEdgeNumberPortionId32Bits.length>0&&(t.texturePerEdgeIdPortionIds32Bits=this.dataTextureGenerator.generateTextureForPackedPortionIds(s,i.perEdgeNumberPortionId32Bits)),i.indices8Bits.length>0&&(t.texturePerPolygonIdIndices8Bits=this.dataTextureGenerator.generateTextureFor8BitIndices(s,i.indices8Bits)),i.indices16Bits.length>0&&(t.texturePerPolygonIdIndices16Bits=this.dataTextureGenerator.generateTextureFor16BitIndices(s,i.indices16Bits)),i.indices32Bits.length>0&&(t.texturePerPolygonIdIndices32Bits=this.dataTextureGenerator.generateTextureFor32BitIndices(s,i.indices32Bits)),i.edgeIndices8Bits.length>0&&(t.texturePerPolygonIdEdgeIndices8Bits=this.dataTextureGenerator.generateTextureFor8BitsEdgeIndices(s,i.edgeIndices8Bits)),i.edgeIndices16Bits.length>0&&(t.texturePerPolygonIdEdgeIndices16Bits=this.dataTextureGenerator.generateTextureFor16BitsEdgeIndices(s,i.edgeIndices16Bits)),i.edgeIndices32Bits.length>0&&(t.texturePerPolygonIdEdgeIndices32Bits=this.dataTextureGenerator.generateTextureFor32BitsEdgeIndices(s,i.edgeIndices32Bits)),this.model._modelMatricesTexture||(this.model._modelMatricesTexture=this.dataTextureGenerator.generatePeformanceModelDataTexture(s,this.model)),t.textureModelMatrices=this.model._modelMatricesTexture,this.model.cameraTexture||(this.model.cameraTexture=this.dataTextureGenerator.generateCameraDataTexture(this.model.scene.canvas.gl,this.model.scene.camera,this.model.scene,this._state.origin.slice())),t.textureCameraMatrices=this.model.cameraTexture,this.model.pickCameraTexture||(this.model.pickCameraTexture=this.dataTextureGenerator.generateCameraDataTexture(this.model.scene.canvas.gl,this.model.scene.camera,this.model.scene,this._state.origin.slice(),!1)),t.texturePickCameraMatrices=this.model.pickCameraTexture,t.finalize(),this._buffer=null,this._instancedGeometrySubPortionData={},this._finalized=!0}attachToRenderingEvent(){const e=this;this.model.scene.on("rendering",(function(){e._deferredSetFlagsDirty&&e.commitDeferredFlags(),e.numUpdatesInFrame=0}))}isEmpty(){return 0==this._numPortions}initFlags(e,t,s){t&ze&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&Ze&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&Je&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&Qe&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&Ye&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&qe&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&Xe&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&We&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),s&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++);this._setFlags(e,t,s,true),this._setFlags2(e,t,true)}flushInitFlags(){this._setDeferredFlags(),this._setDeferredFlags2()}setVisible(e,t,s){if(!this._finalized)throw"Not finalized";t&ze?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,s)}setHighlighted(e,t,s){if(!this._finalized)throw"Not finalized";t&Ze?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,s)}setXRayed(e,t,s){if(!this._finalized)throw"Not finalized";t&Je?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,s)}setSelected(e,t,s){if(!this._finalized)throw"Not finalized";t&Qe?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,s)}setEdges(e,t,s){if(!this._finalized)throw"Not finalized";t&qe?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,s)}setClippable(e,t){if(!this._finalized)throw"Not finalized";t&Ye?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}beginDeferredFlags(){this._deferredSetFlagsActive=!0}commitDeferredFlags(){if(this._deferredSetFlagsActive=!1,!this._deferredSetFlagsDirty)return;this._deferredSetFlagsDirty=!1;const e=this.model.scene.canvas.gl,t=this._dataTextureState;e.bindTexture(e.TEXTURE_2D,t.texturePerObjectIdColorsAndFlags._texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.texturePerObjectIdColorsAndFlags._textureWidth,t.texturePerObjectIdColorsAndFlags._textureHeight,e.RGBA_INTEGER,e.UNSIGNED_BYTE,t.texturePerObjectIdColorsAndFlags._textureData),e.bindTexture(e.TEXTURE_2D,t.texturePerObjectIdOffsets._texture),e.texSubImage2D(e.TEXTURE_2D,0,0,0,t.texturePerObjectIdOffsets._textureWidth,t.texturePerObjectIdOffsets._textureHeight,e.RGB,e.FLOAT,t.texturePerObjectIdOffsets._textureData)}setCulled(e,t,s){if(!this._finalized)throw"Not finalized";t&We?(this._numCulledLayerPortions+=this._subPortionIdMapping[e].length,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions-=this._subPortionIdMapping[e].length,this.model.numCulledLayerPortions--),this._setFlags(e,t,s)}setCollidable(e,t){if(!this._finalized)throw"Not finalized"}setPickable(e,t,s){if(!this._finalized)throw"Not finalized";t&Xe?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(e,t,s)}setColor(e,t){const s=this._subPortionIdMapping[e];for(let e=0,i=s.length;e<i;e++)this._subPortionSetColor(s[e],t)}_subPortionSetColor(e,t){if(!this._finalized)throw"Not finalized";const s=this._dataTextureState,i=this.model.scene.canvas.gl;Ls[0]=t[0],Ls[1]=t[1],Ls[2]=t[2],Ls[3]=t[3],s.texturePerObjectIdColorsAndFlags._textureData.set(Ls,32*e),this._deferredSetFlagsActive?this._deferredSetFlagsDirty=!0:(++this.numUpdatesInFrame>=10&&this.beginDeferredFlags(),i.bindTexture(i.TEXTURE_2D,s.texturePerObjectIdColorsAndFlags._texture),i.texSubImage2D(i.TEXTURE_2D,0,e%512*8,Math.floor(e/512),1,1,i.RGBA_INTEGER,i.UNSIGNED_BYTE,Ls))}setTransparent(e,t,s){s?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,s)}_setFlags(e,t,s,i=!1){const r=this._subPortionIdMapping[e];for(let e=0,i=r.length;e<i;e++)this._subPortionSetFlags(r[e],t,s)}_subPortionSetFlags(e,t,s,i=!1){if(!this._finalized)throw"Not finalized";const r=!!(t&ze),o=!!(t&Je),n=!!(t&Ze),a=!!(t&Qe),h=!!(t&We);let l,u;l=!r||h||o?st:s?rt:it,u=!r||h?st:a?nt:n?ot:o?at:st;let c=0;c=!r||h?st:a?ct:n?ut:o?pt:!!(t&qe)?s?lt:ht:st;let p=r&&!h&&!!(t&Xe)?dt:st;const d=this._dataTextureState,m=this.model.scene.canvas.gl;Ls[0]=l,Ls[1]=u,Ls[2]=c,Ls[3]=p,d.texturePerObjectIdColorsAndFlags._textureData.set(Ls,32*e+8),this._deferredSetFlagsActive?this._deferredSetFlagsDirty=!0:(++this.numUpdatesInFrame>=10&&this.beginDeferredFlags(),m.bindTexture(m.TEXTURE_2D,d.texturePerObjectIdColorsAndFlags._texture),m.texSubImage2D(m.TEXTURE_2D,0,e%512*8+2,Math.floor(e/512),1,1,m.RGBA_INTEGER,m.UNSIGNED_BYTE,Ls))}_setDeferredFlags(){}_setFlags2(e,t,s=!1){const i=this._subPortionIdMapping[e];for(let e=0,s=i.length;e<s;e++)this._subPortionSetFlags2(i[e],t)}_subPortionSetFlags2(e,t,s=!1){if(!this._finalized)throw"Not finalized";const i=t&Ye?255:0,r=this._dataTextureState,o=this.model.scene.canvas.gl;Ls[0]=i,Ls[1]=0,Ls[2]=1,Ls[3]=2,r.texturePerObjectIdColorsAndFlags._textureData.set(Ls,32*e+12),this._deferredSetFlagsActive?this._deferredSetFlagsDirty=!0:(++this.numUpdatesInFrame>=10&&this.beginDeferredFlags(),o.bindTexture(o.TEXTURE_2D,r.texturePerObjectIdColorsAndFlags._texture),o.texSubImage2D(o.TEXTURE_2D,0,e%512*8+3,Math.floor(e/512),1,1,o.RGBA_INTEGER,o.UNSIGNED_BYTE,Ls))}_setDeferredFlags2(){}setOffset(e,t){const s=this._subPortionIdMapping[e];for(let e=0,i=s.length;e<i;e++)this._subPortionSetOffset(s[e],t)}_subPortionSetOffset(e,t){if(!this._finalized)throw"Not finalized";const s=this._dataTextureState,i=this.model.scene.canvas.gl;Ns[0]=t[0],Ns[1]=t[1],Ns[2]=t[2],s.texturePerObjectIdOffsets._textureData.set(Ns,3*e),this._deferredSetFlagsActive?this._deferredSetFlagsDirty=!0:(++this.numUpdatesInFrame>=10&&this.beginDeferredFlags(),i.bindTexture(i.TEXTURE_2D,s.texturePerObjectIdOffsets._texture),i.texSubImage2D(i.TEXTURE_2D,0,0,e,1,1,i.RGB,i.FLOAT,Ns))}drawColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),t.withSAO&&this.model.saoEnabled?t.pbrEnabled&&this.model.pbrEnabled?this._dataTextureRenderers.colorQualityRendererWithSAO&&this._dataTextureRenderers.colorQualityRendererWithSAO.drawLayer(t,this,it):this._dataTextureRenderers.colorRendererWithSAO&&this._dataTextureRenderers.colorRendererWithSAO.drawLayer(t,this,it):t.pbrEnabled&&this.model.pbrEnabled?this._dataTextureRenderers.colorQualityRenderer&&this._dataTextureRenderers.colorQualityRenderer.drawLayer(t,this,it):this._dataTextureRenderers.colorRenderer&&this._dataTextureRenderers.colorRenderer.drawLayer(t,this,it))}_updateBackfaceCull(e,t){const s=this.model.backfaces||e.sectioned;if(t.backfaces!==s){const e=t.gl;s?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),t.backfaces=s}}drawColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),t.pbrEnabled&&this.model.pbrEnabled?this._dataTextureRenderers.colorQualityRenderer&&this._dataTextureRenderers.colorQualityRenderer.drawLayer(t,this,rt):this._dataTextureRenderers.colorRenderer&&this._dataTextureRenderers.colorRenderer.drawLayer(t,this,rt))}drawDepth(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.depthRenderer&&this._dataTextureRenderers.depthRenderer.drawLayer(t,this,it))}drawNormals(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.normalsRenderer&&this._dataTextureRenderers.normalsRenderer.drawLayer(t,this,it))}drawSilhouetteXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.silhouetteRenderer&&this._dataTextureRenderers.silhouetteRenderer.drawLayer(t,this,at))}drawSilhouetteHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.silhouetteRenderer&&this._dataTextureRenderers.silhouetteRenderer.drawLayer(t,this,ot))}drawSilhouetteSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.silhouetteRenderer&&this._dataTextureRenderers.silhouetteRenderer.drawLayer(t,this,nt))}drawEdgesColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&this._dataTextureRenderers.edgesColorRenderer&&this._dataTextureRenderers.edgesColorRenderer.drawLayer(t,this,ht)}drawEdgesColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&0!==this._numTransparentLayerPortions&&this._dataTextureRenderers.edgesColorRenderer&&this._dataTextureRenderers.edgesColorRenderer.drawLayer(t,this,lt)}drawEdgesHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._dataTextureRenderers.edgesRenderer&&this._dataTextureRenderers.edgesRenderer.drawLayer(t,this,ut)}drawEdgesSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._dataTextureRenderers.edgesRenderer&&this._dataTextureRenderers.edgesRenderer.drawLayer(t,this,ct)}drawEdgesXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._dataTextureRenderers.edgesRenderer&&this._dataTextureRenderers.edgesRenderer.drawLayer(t,this,pt)}drawOcclusion(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.occlusionRenderer&&this._dataTextureRenderers.occlusionRenderer.drawLayer(t,this,it))}drawShadow(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.shadowRenderer&&this._dataTextureRenderers.shadowRenderer.drawLayer(t,this,it))}drawPickMesh(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.pickMeshRenderer&&this._dataTextureRenderers.pickMeshRenderer.drawLayer(t,this,dt))}drawPickDepths(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.pickDepthRenderer&&this._dataTextureRenderers.pickDepthRenderer.drawLayer(t,this,dt))}drawPickNormals(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._dataTextureRenderers.pickNormalsRenderer&&this._dataTextureRenderers.pickNormalsRenderer.drawLayer(t,this,dt))}precisionRayPickSurface(e,t,s,i,r){if(!this.model.scene.pickSurfacePrecisionEnabled)return!1;const o=this._state,n=this._portions[e];if(!n)return this.model.error("portion not found: "+e),!1;const a=n.quantizedPositions,h=n.indices,l=o.origin,u=n.offset,c=ks,d=js;c.set(l?p.subVec3(t,l,Gs):t),d.set(s),u&&p.subVec3(c,u),p.transformRay(this.model.worldNormalMatrix,c,d,c,d);const m=Hs,f=Vs,g=Us;let _=!1,y=0;const v=zs;for(let e=0,s=h.length;e<s;e+=3){const s=3*h[e],n=3*h[e+1],b=3*h[e+2];if(m[0]=a[s],m[1]=a[s+1],m[2]=a[s+2],f[0]=a[n],f[1]=a[n+1],f[2]=a[n+2],g[0]=a[b],g[1]=a[b+1],g[2]=a[b+2],p.decompressPosition(m,o.positionsDecodeMatrix),p.decompressPosition(f,o.positionsDecodeMatrix),p.decompressPosition(g,o.positionsDecodeMatrix),p.rayTriangleIntersect(c,d,m,f,g,v)){p.transformPoint3(this.model.worldMatrix,v,v),u&&p.addVec3(v,u),l&&p.addVec3(v,l);const e=Math.abs(p.lenVec3(p.subVec3(v,t,[])));(!_||e>y)&&(y=e,i.set(v),r&&p.triangleNormal(m,f,g,r),_=!0)}}return _&&r&&(p.transformVec3(this.model.worldNormalMatrix,r,r),p.normalizeVec3(r)),_}destroy(){const e=this._state;e.metallicRoughnessBuf&&(e.metallicRoughnessBuf.destroy(),e.metallicRoughnessBuf=null),e.destroy()}}class Ys{constructor(){this.visibleLayers=[],this.sectionPlanesActivePerLayer=[],this.reset()}reset(){this.culled=!1,this.sectioned=!1,this.numLayers=0,this.numVisibleLayers=0,this.colorOpaque=!1,this.colorTransparent=!1,this.edgesOpaque=!1,this.edgesTransparent=!1,this.xrayedSilhouetteOpaque=!1,this.xrayedEdgesOpaque=!1,this.xrayedSilhouetteTransparent=!1,this.xrayedEdgesTransparent=!1,this.highlightedSilhouetteOpaque=!1,this.highlightedEdgesOpaque=!1,this.highlightedSilhouetteTransparent=!1,this.highlightedEdgesTransparent=!1,this.selectedSilhouetteOpaque=!1,this.selectedEdgesOpaque=!1,this.selectedSilhouetteTransparent=!1,this.selectedEdgesTransparent=!1}}let Ks=!1;const Js=[];class Zs{constructor(e,t){this.triangleLODLevels=e,this.nodesInLOD={},this.triangleCountInLOD={},this.targetFps=t,this.lodLevelIndex=0,this.consecutiveFramesWithTargetFps=0,this.consecutiveFramesWithoutTargetFps=0}initializeLodState(e){if(0===e._nodeList.length)return;const t=e._nodeList;let s={},i={};for(let e=0,o=t.length;e<o;e++){const o=t[e];let n,a;for(n=0,a=this.triangleLODLevels.length;n<a&&!(o.numTriangles>=this.triangleLODLevels[n]);n++);var r=this.triangleLODLevels[n]||0;r in s||(s[r]=[]),s[r].push(o),r in i||(i[r]=0),i[r]+=o.numTriangles}this.nodesInLOD=s,this.triangleCountInLOD=i}}class Qs{constructor(e,t,s){this.model=e,this.lodState=new Zs(t,s),this.lodState.initializeLodState(e),function(e,t){if(!Ks){Ks=!0;const t=4;let s=new Array(t),i=0,r=-1,o=Date.now(),n=0;e.on("rendering",(function(){if(-1!==r)for(let e=0,t=Js.length;e<t;e++)Js[e].applyLodCulling(r)})),e.on("rendered",(function(){o=Date.now(),window.requestAnimationFrame((function(){i++;const e=Date.now();n=e-o,o=e,s[i%t]=n;let a=0;if(i>t){for(let e=0;e<t;e++)a+=s[e];r=t/a*1e3}}))}));{let t=0,s=t;e.camera.on("matrix",(function(){s=t})),e.on("tick",(function(){if(t-s>3)for(let e=0,t=Js.length;e<t;e++)Js[e].resetLodCulling();t++}))}}Js.push(t)}(this.model.scene,this)}_increaseLODLevelIndex(){const e=this.lodState;if(e.lodLevelIndex===e.triangleLODLevels.length)return!1;const t=e.nodesInLOD[e.triangleLODLevels[e.lodLevelIndex]]||[];for(let e=0,s=t.length;e<s;e++)t[e].culledLOD=!0;return e.lodLevelIndex++,!0}_decreaseLODLevelIndex(){const e=this.lodState;if(0===e.lodLevelIndex)return!1;const t=e.nodesInLOD[e.triangleLODLevels[e.lodLevelIndex-1]]||[];for(let e=0,s=t.length;e<s;e++)t[e].culledLOD=!1;return e.lodLevelIndex--,!0}applyLodCulling(e){let t=this.lodState;this.model;let s=!1;return e<t.targetFps?++t.consecutiveFramesWithoutTargetFps>0&&(t.consecutiveFramesWithoutTargetFps=0,s=this._increaseLODLevelIndex()):e>t.targetFps+4&&++t.consecutiveFramesWithTargetFps>1&&(t.consecutiveFramesWithTargetFps=0,s=this._decreaseLODLevelIndex()),s}resetLodCulling(){this.model;let e=!1,t=!1;do{e|=t=this._decreaseLODLevelIndex()}while(t);return e}}var qs={},$s={};!function(e){if("object"==typeof $s&&void 0!==qs)qs.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).RBush3D=e()}}((function(){return function e(t,s,i){function r(n,a){if(!s[n]){if(!t[n]){var h="function"==typeof require&&require;if(!a&&h)return h(n,!0);if(o)return o(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var u=s[n]={exports:{}};t[n][0].call(u.exports,(function(e){return r(t[n][1][e]||e)}),u,u.exports,e,t,s,i)}return s[n].exports}for(var o="function"==typeof require&&require,n=0;n<i.length;n++)r(i[n]);return r}({1:[function(e,t,s){Object.defineProperty(s,"__esModule",{value:!0});var i=e("quickselect"),r=[],o=function(e){return r.push(e)},n=function(e){e&&(o(e),u(e)||e.children.forEach(n))},a=function(e){var t=r.pop();return t?(t.children=e,t.height=1,t.leaf=!0,t.minX=1/0,t.minY=1/0,t.minZ=1/0,t.maxX=-1/0,t.maxY=-1/0,t.maxZ=-1/0):t={children:e,height:1,leaf:!0,minX:1/0,minY:1/0,minZ:1/0,maxX:-1/0,maxY:-1/0,maxZ:-1/0},t},h=[],l=function(e,t){var s=h.pop();return s?(s.dist=e,s.node=t):s={dist:e,node:t},s},u=function(e){return e.leaf},c=function(e,t){return e.leaf},p=function(e,t,s){if(!s)return t.indexOf(e);for(var i=0;i<t.length;i++)if(s(e,t[i]))return i;return-1},d=function(e){m(e,0,e.children.length,e)},m=function(e,t,s,i){var r=i;r?(r.minX=1/0,r.minY=1/0,r.minZ=1/0,r.maxX=-1/0,r.maxY=-1/0,r.maxZ=-1/0):r=a([]);for(var o=t,n=void 0;o<s;o++)n=e.children[o],f(r,n);return r},f=function(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.minZ=Math.min(e.minZ,t.minZ),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e.maxZ=Math.max(e.maxZ,t.maxZ),e},g=function(e){return(e.maxX-e.minX)*(e.maxY-e.minY)*(e.maxZ-e.minZ)},_=function(e){return e.maxX-e.minX+(e.maxY-e.minY)+(e.maxZ-e.minZ)},y=function(e,t){var s=Math.min(e.minX,t.minX),i=Math.min(e.minY,t.minY),r=Math.min(e.minZ,t.minZ);return(Math.max(e.maxX,t.maxX)-s)*(Math.max(e.maxY,t.maxY)-i)*(Math.max(e.maxZ,t.maxZ)-r)},v=function(e,t){var s=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),r=Math.max(e.minZ,t.minZ),o=Math.min(e.maxX,t.maxX),n=Math.min(e.maxY,t.maxY),a=Math.min(e.maxZ,t.maxZ);return Math.max(0,o-s)*Math.max(0,n-i)*Math.max(0,a-r)},b=function(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&e.minZ<=t.minZ&&t.maxX<=e.maxX&&t.maxY<=e.maxY&&t.maxZ<=e.maxZ};s.intersects=function(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.minZ<=e.maxZ&&t.maxX>=e.minX&&t.maxY>=e.minY&&t.maxZ>=e.minZ},s.boxRayIntersects=function(e,t,s,i,r,o,n){var a=(e.minX-t)*r,h=(e.maxX-t)*r,l=(e.minY-s)*o,u=(e.maxY-s)*o,c=(e.minZ-i)*n,p=(e.maxZ-i)*n,d=Math.min(c,p),m=Math.max(c,p),f=Math.min(l,u),g=Math.max(l,u),_=Math.min(a,h),y=Math.max(a,h),v=Math.max(0,_,f,d);return Math.min(y,g,m)>=v?v:1/0};var x=function(e,t,s,r,o){for(var n,a=[t,s];a.length;)(s=a.pop())-(t=a.pop())<=r||(n=t+Math.ceil((s-t)/r/2)*r,i(e,n,t,s,o),a.push(t,n,n,s))},P=function(e,t){return e.minX-t.minX},T=function(e,t){return e.minY-t.minY},w=function(e,t){return e.minZ-t.minZ},M=function(){function e(e){void 0===e&&(e=16),this.maxEntries=Math.max(e,8),this.minEntries=Math.max(4,Math.ceil(.4*this.maxEntries)),this.clear()}return e.alloc=function(){return this.pool.pop()||new this},e.free=function(e){e.clear(),this.pool.push(e)},e.prototype.searchCustom=function(e,t){var s=this.data,i=[];if(!e(s,c(s)))return i;for(var r=[];s;){for(var o=0,n=s.children.length;o<n;o++){var a=s.children[o];e(a,c(s))&&(c(s)?i.push(a):t(a)?this._all(a,i):r.push(a))}s=r.pop()}return i},e.prototype.analyzeTriangles=function(e){void 0===e&&(e=this.data);var t=0;if(u(e))for(var s=0,i=e.children.length;s<i;s++)t+=e.children[s].numTriangles;else for(s=0,i=e.children.length;s<i;s++)t+=this.analyzeTriangles(e.children[s]);return e.totalTriangles=t},e.prototype.groupNodesByNumTrianglesThreshold=function(e,t){void 0===t&&(this.analyzeTriangles(),t=this.data);for(var s=[],i=0,r=t.children.length;i<r;i++){var o=t.children[i];s.push({item:o,triangles:o.totalTriangles||o.numTriangles})}s.sort((function(e,t){return-(e.item.triangles-t.item.triangles)}));var n=[],a=[],h=0;for(i=0,r=s.length;i<r;i++){var l=s[i];if(h+l.triangles<e)a.push(l),h+=l.triangles;else if(a.length&&(n.push(a),a=[],h=0),h+l.triangles<e)i--;else if(c(t,l.item))n.push([l]);else{for(var u=this.groupNodesByNumTrianglesThreshold(e,l.item),p=[],d=0,m=0,f=u.length;m<f-1;m++)n.push(u[i]);if(u.length>1){for(m=0,f=(u=u[u.length-1]).length;m<f;m++)(d+=u[m].triangles)<e?p.push(u[m]):(0==d&&p.push(u[m]),n.push(p),d=0,p=[]);p.forEach((function(e){a.push(e),h+=e.triangles}))}}}return a.length&&n.push(a),n},e.prototype.search=function(e){var t=this.data,i=[];if(!s.intersects(e,t))return i;for(var r=[];t;){for(var o=0,n=t.children.length;o<n;o++){var a=t.children[o];s.intersects(e,a)&&(c(t)?i.push(a):b(e,a)?this._all(a,i):r.push(a))}t=r.pop()}return i},e.prototype.collides=function(e){var t=this.data;if(!s.intersects(e,t))return!1;for(var i=[];t;){for(var r=0,o=t.children.length;r<o;r++){var n=t.children[r];if(s.intersects(e,n)){if(c(t)||b(e,n))return!0;i.push(n)}}t=i.pop()}return!1},e.prototype.raycastInv=function(e,t,i,r,o,n,a){void 0===a&&(a=1/0);var u=this.data;if(r===1/0&&o===1/0&&n===1/0)return l(1/0,void 0);if(s.boxRayIntersects(u,e,t,i,r,o,n)===1/0)return l(1/0,void 0);for(var p,d=[l(0,u)],m=function(e,t){var s=d[e];d[e]=d[t],d[t]=s},f=function(){var e=d[0],t=d.length-1;d[0]=d[t],d.length=t;for(var s=0;;){var i=s<<1|1;if(i>=t)break;var r=i+1;if(r<t&&d[r].dist<d[i].dist&&(i=r),d[s].dist<d[i].dist)break;m(s,i),s=i}return function(e){h.push(e)}(e),e.node},g=function(e,t){var s=d.length;for(d.push(l(e,t));s>0;){var i=s-1>>1;if(d[i].dist<=d[s].dist)break;m(s,i),s=i}},_=a;d.length&&d[0].dist<_;)for(var y=0,v=(u=f()).children.length;y<v;y++){var b=u.children[y],x=s.boxRayIntersects(b,e,t,i,r,o,n);if(c(u)){if(x<_){if(0===x)return l(x,b);_=x,p=b}}else g(x,b)}return l(_<a?_:1/0,p)},e.prototype.raycast=function(e,t,s,i,r,o,n){return void 0===n&&(n=1/0),this.raycastInv(e,t,s,1/i,1/r,1/o,n)},e.prototype.all=function(){return this._all(this.data,[])},e.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this.minEntries){for(var t=0,s=e.length;t<s;t++)this.insert(e[t]);return this}var i=this.build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this.splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},e.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},e.prototype.clear=function(){return this.data&&n(this.data),this.data=a([]),this},e.prototype.remove=function(e,t){if(!e)return this;for(var s,i,r=this.data,o=0,n=!1,a=[],h=[];r||a.length;){if(r||(r=a.pop(),o=h.pop(),i=a[a.length-1],n=!0),u(r)&&-1!==(s=p(e,r.children,t)))return r.children.splice(s,1),a.push(r),this.condense(a),this;n||u(r)||!b(r,e)?i?(o++,r=i.children[o],n=!1):r=void 0:(a.push(r),h.push(o),o=0,i=r,r=r.children[0])}return this},e.prototype.toJSON=function(){return this.data},e.prototype.fromJSON=function(e){return n(this.data),this.data=e,this},e.prototype.build=function(e,t,s,i){var r,o=s-t+1,n=this.maxEntries;if(o<=n)return r=a(e.slice(t,s+1)),d(r),r;i||(i=Math.ceil(Math.log(o)/Math.log(n)),n=Math.ceil(o/Math.pow(n,i-1))),(r=a([])).leaf=!1,r.height=i;var h=Math.ceil(o/n),l=h*Math.ceil(Math.pow(n,2/3)),u=h*Math.ceil(Math.pow(n,1/3));x(e,t,s,u,P);for(var c=t;c<=s;c+=u){var p=Math.min(c+u-1,s);x(e,c,p,l,T);for(var m=c;m<=p;m+=l){var f=Math.min(m+l-1,p);x(e,m,f,h,w);for(var g=m;g<=f;g+=h){var _=Math.min(g+h-1,f);r.children.push(this.build(e,g,_,i-1))}}}return d(r),r},e.prototype._all=function(e,t){for(var s=[];e;)u(e)?t.push.apply(t,e.children):s.push.apply(s,e.children),e=s.pop();return t},e.prototype.chooseSubtree=function(e,t,s,i){for(var r,o,n;i.push(t),!u(t)&&i.length-1!==s;){r=o=1/0;for(var a=0,h=t.children.length;a<h;a++){var l=t.children[a],c=g(l),p=y(e,l)-c;p<o?(o=p,r=c<r?c:r,n=l):p===o&&c<r&&(r=c,n=l)}t=n||t.children[0]}return t},e.prototype.split=function(e,t){var s=e[t],i=s.children.length,r=this.minEntries;this.chooseSplitAxis(s,r,i);var o=this.chooseSplitIndex(s,r,i),n=a(s.children.splice(o,s.children.length-o));n.height=s.height,n.leaf=s.leaf,d(s),d(n),t?e[t-1].children.push(n):this.splitRoot(s,n)},e.prototype.splitRoot=function(e,t){this.data=a([e,t]),this.data.height=e.height+1,this.data.leaf=!1,d(this.data)},e.prototype.chooseSplitIndex=function(e,t,s){for(var i,r=1/0,o=1/0,n=t;n<=s-t;n++){var a=m(e,0,n),h=m(e,n,s),l=v(a,h),u=g(a)+g(h);l<r?(r=l,i=n,o=u<o?u:o):l===r&&u<o&&(o=u,i=n)}return i},e.prototype.chooseSplitAxis=function(e,t,s){var i=this.allDistMargin(e,t,s,P),r=this.allDistMargin(e,t,s,T),o=this.allDistMargin(e,t,s,w);i<r&&i<o?e.children.sort(P):r<i&&r<o&&e.children.sort(T)},e.prototype.allDistMargin=function(e,t,s,i){e.children.sort(i);for(var r=m(e,0,t),o=m(e,s-t,s),n=_(r)+_(o),a=t;a<s-t;a++){var h=e.children[a];f(r,h),n+=_(r)}for(a=s-t-1;a>=t;a--){h=e.children[a];f(o,h),n+=_(o)}return n},e.prototype.adjustParentBBoxes=function(e,t,s){for(var i=s;i>=0;i--)f(t[i],e)},e.prototype.condense=function(e){for(var t=e.length-1,s=void 0;t>=0;t--)0===e[t].children.length?t>0?((s=e[t-1].children).splice(s.indexOf(e[t]),1),o(e[t])):this.clear():d(e[t])},e.prototype._insert=function(e,t,s){var i=[],r=this.chooseSubtree(e,this.data,t,i);for(r.children.push(e),f(r,e);t>=0&&i[t].children.length>this.maxEntries;)this.split(i,t),t--;this.adjustParentBBoxes(e,i,t)},e.pool=[],e}();s.RBush3D=M},{quickselect:2}],2:[function(e,t,s){!function(e,i){"object"==typeof s&&void 0!==t?t.exports=i():e.quickselect=i()}(this,(function(){function e(s,i,r,o,n){for(;o>r;){if(o-r>600){var a=o-r+1,h=i-r+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(h-a/2<0?-1:1);e(s,i,Math.max(r,Math.floor(i-h*u/a+c)),Math.min(o,Math.floor(i+(a-h)*u/a+c)),n)}var p=s[i],d=r,m=o;for(t(s,r,i),n(s[o],p)>0&&t(s,r,o);d<m;){for(t(s,d,m),d++,m--;n(s[d],p)<0;)d++;for(;n(s[m],p)>0;)m--}0===n(s[r],p)?t(s,r,m):t(s,++m,o),m<=i&&(r=m+1),i<=m&&(o=m-1)}}function t(e,t,s){var i=e[t];e[t]=e[s],e[s]=i}function s(e,t){return e<t?-1:e>t?1:0}return function(t,i,r,o,n){e(t,i,r||0,o||t.length-1,n||s)}}))},{}]},{},[1])(1)}));var ei=qs.exports.RBush3D,ti=function(e){function t(e){var t=0;return e.meshes.forEach((function(e){t+=e.numTriangles})),t}function s(e,t){var s={pos:{x:0,y:0},left:0,right:e,top:0,bottom:t,dir:0};function i(){(0==s.dir&&s.pos.x+1>=s.right||1==s.dir&&s.pos.y+1>=s.bottom||2==s.dir&&s.pos.x-1<=s.left-1||3==s.dir&&s.pos.y-1<=s.top-1)&&(s.dir=(s.dir+1)%4,0==s.dir&&s.left++,1==s.dir&&s.top++,2==s.dir&&s.right--,3==s.dir&&s.bottom--),0==s.dir&&s.pos.x++,1==s.dir&&s.pos.y++,2==s.dir&&s.pos.x--,3==s.dir&&s.pos.y--}for(var r=[],o=e*t;r.length<o;i())r.push(s.pos.x+"_"+s.pos.y);return r}var i,r,o,n,a=0,h=(r=function(t,s){for(var i=s||function(e){return!0},r=(e.aabbTree.data.maxX-e.aabbTree.data.minX)/10,o=(e.aabbTree.data.maxZ-e.aabbTree.data.minZ)/10,n=[],a=e.aabbTree.data.minX,h=0;h<10;h++,a+=r)for(var l=e.aabbTree.data.minZ,u=0;u<10;u++,l+=o)n.push({minX:a,maxX:a+r,minY:-1e8,maxY:1e8,minZ:l,maxZ:l+o,indexX:h,indexZ:u});var c={cellsByEntity:{},entitiesByCell:{},cellsX:10,cellsZ:10};return(n||[]).forEach((function(t){e.aabbTree.search(t).filter((function(e){return i(e.entity)})).forEach((function(e){var s=e.entity.id;c.cellsByEntity[s]=c.cellsByEntity[s]||{cells:[],entity:e.entity},c.cellsByEntity[s].cells.push(t);var i=t.indexX+"_"+t.indexZ;c.entitiesByCell[i]=c.entitiesByCell[i]||{entities:[],cell:t},c.entitiesByCell[i].entities.push(e.entity)}))})),c}((i={cellSideInMeters:.05,entityFilterFunc:function(e){return!0},maxPolygonsPerCluster:9e4,minPercentOfClustredPolygons:.9}).cellSideInMeters,i.entityFilterFunc),o=function(e,s){var i={},r=0;Object.keys(s).forEach((function(e){var o=s[e].cells.length,n=t(s[e].entity);i[o]=(i[o]||0)+n,r+=n}));var o=Object.keys(i);o.sort((function(e,t){return e-t}));for(var n=0,a=0,h=0;h<o.length&&a<e;h++)n=o[h],a+=i[n]/r;return{maxCellsPerEntity:n,polygonStats:{percentClustered:a,numberClustered:Math.round(a*r),numberUnclustered:r-Math.round(a*r)}}}(i.minPercentOfClustredPolygons,r.cellsByEntity),n=function(e,i,r,o,n,a){var h={},l={accumEntities:[]},u=[];s(e,i).forEach((function(e){var s=function(e,t,s,i){return(s[e]||{entities:[]}).entities.filter((function(e){return i[e.id].cells.length<=t}))}(e,r,o,n).filter((function(e){return!(e.id in h)}));s.forEach((function(e){h[e.id]=!0})),s.sort((function(e,s){return t(e)-t(s)}));var i=l.accumEntities.concat(s),c=[],p=a,d=0;do{for(;d<i.length;d++){var m=i[d],f=t(m);f>p&&(u.push(c),c=[],p=a),c.push(m),p-=f}}while(d<i.length);l.accumEntities=c})),l.accumEntities.length&&u.push(l.accumEntities);var c=[];Object.keys(n).forEach((function(e){e in h||c.push(n[e].entity)}));var p=a,d=[];c.forEach((function(e){var s=t(e);s>p&&(u.push(d),d=[],p=a),d.push(e),p-=s})),d.length&&u.push(d);var m={};return u.forEach((function(e,t){e.forEach((function(e){m[e.id]=t}))})),{clusters:u,entityIdToClusterIdMapping:m}}(r.cellsX,r.cellsZ,o.maxCellsPerEntity,r.entitiesByCell,r.cellsByEntity,i.maxPolygonsPerCluster),{clusters:{total:n.clusters.length},clusteringResult:n});a+=h.clusters.total,console.log("Total clusters: "+a);var l=[];return h.clusteringResult.clusters.forEach((function(e){e.forEach((function(e){l.push(e.id)}))})),h.orderedEntityIds=l,h};
/**
 * @author https://github.com/tmarti, with support from https://tribia.com/
 * @license MIT
 */function si(e,t){t.length;const s=e.length,i=[],r=[];function o(e){for(let s=0,i=e.meshIds.length;s<i;s++)if(t[e.meshIds[s]].geometryId)return!0;return!1}for(let n=0;n<s;n++){const s=e[n];if(o(s)){r.push(n);continue}const a=p.collapseAABB3();let h=0;s.meshIds.forEach((e=>{const s=t[e],i=Pt.getPositionsBounds(s.positions),r=Pt.decompressPosition(i.min,s.positionsDecodeMatrix,[]),o=Pt.decompressPosition(i.max,s.positionsDecodeMatrix,[]);r[0]+=s.origin[0],r[1]+=s.origin[1],r[2]+=s.origin[2],o[0]+=s.origin[0],o[1]+=s.origin[1],o[2]+=s.origin[2],p.expandAABB3Point3(a,r),p.expandAABB3Point3(a,o),h+=Math.round(s.indices.length/3)})),i[n]={aabb:a,numTriangles:h,entityId:s.id}}let n,a=[],h={};if(Object.keys(i).length>0){n=
/**
 * @author https://github.com/tmarti, with support from https://tribia.com/
 * @license MIT
 */
function(e){const t=[];for(let s=0,i=e.length;s<i;s++){const i=e[s];i&&t.push({minX:i.aabb[0],minY:i.aabb[1],minZ:i.aabb[2],maxX:i.aabb[3],maxY:i.aabb[4],maxZ:i.aabb[5],entity:{id:s,xeokitId:i.entityId,meshes:[{numTriangles:i.numTriangles}]},numTriangles:i.numTriangles})}const s=new ei(4);return s.load(t),s}(i);let e=ti({aabbTree:n});a=e.orderedEntityIds,h=e.clusteringResult.entityIdToClusterIdMapping}return{orderedClusteredIndexes:a,entityIdToClusterIdMapping:h,instancedIndexes:r,rTreeBasedAabbTree:n}}let ii=p.vec3();const ri=180/Math.PI,oi=new Float32Array(262144);for(let e=-256;e<256;e++)for(let t=-256;t<256;t++){const s=(e+256<<9)+(t+256),i=Math.max(Math.abs(e),Math.abs(t));oi[s]=Math.atan2(e/i,t/i)}function ni(e,t){const s=256/Math.max(Math.abs(e),Math.abs(t)),i=Math.round(e*s)+255,r=Math.round(t*s)+255;return oi[(i<<9)+r]}class ai{constructor(){this._aabbTree=null,this._orderedMeshList=[],this._orderedEntityList=[],this._frustumProps={dirty:!0,wMultiply:1,hMultiply:1},this._cullFrame=0,this.finalized=!1}initializeVfcState(e,t){if(this.finalized)throw"Already finalized";const s=si(e,t);this._aabbTree=s.rTreeBasedAabbTree;for(let i=0,r=s.orderedClusteredIndexes.length;i<r;i++){const r=s.orderedClusteredIndexes[i],o=s.entityIdToClusterIdMapping[r],n=e[r],a=[];for(let e=0,s=n.meshIds.length;e<s;e++){const s=n.meshIds[e];t[s].id=this._orderedMeshList.length,a.push(this._orderedMeshList.length),this._orderedMeshList.push({clusterNumber:o,mesh:t[s]})}n.meshIds=a,this._orderedEntityList.push(n)}for(let i=0,r=s.instancedIndexes.length;i<r;i++){let r=e[s.instancedIndexes[i]];const o=[];for(let e=0,s=r.meshIds.length;e<s;e++){const s=r.meshIds[e];t[s].id=this._orderedMeshList.length,o.push(this._orderedMeshList.length),this._orderedMeshList.push({clusterNumber:99999,mesh:t[s]})}r.meshIds=o,this._orderedEntityList.push(r)}}finalize(e,t){if(this.finalized)throw"Already finalized";let s=-1;for(let i=0,r=this._orderedMeshList.length;i<r;i++){const{clusterNumber:r,mesh:o}=this._orderedMeshList[i];-1!=s&&s!=r&&t.call(e),e.createMesh(o),s=r}for(let t=0,s=this._orderedEntityList.length;t<s;t++)e.createEntity(this._orderedEntityList[t]);this._orderedMeshList=[],this._orderedEntityList=[],this.finalized=!0}applyViewFrustumCulling(e){if(!this.finalized)throw"Not finalized";if(!this._aabbTree)return;this._canvasElement||(this._canvasElement=e.scene.canvas.canvas),this._camera||(this._camera=e.scene.camera),this._ensureFrustumPropsUpdated(e),this._initializeCullingDataIfNeeded(e);const t=this._searchVisibleNodesWithFrustumCulling();this._cullFrame++,this._markVisibleFrameOfVisibleNodes(t,this._cullFrame),this._cullNonVisibleNodes(e,this._cullFrame)}_initializeCullingDataIfNeeded(e){if(this._internalNodesList)return;if(!this._aabbTree)return;const t=this._aabbTree.all();let s=0;t.forEach((e=>{s=Math.max(s,e.entity.id)}));const i=new Array(s+1);t.forEach((t=>{i[t.entity.id]=e._nodes[t.entity.xeokitId]})),this._internalNodesList=i,this._lastVisibleFrameOfNodes=new Array(i.length),this._lastVisibleFrameOfNodes.fill(0)}_searchVisibleNodesWithFrustumCulling(){return this._aabbTree.searchCustom(((e,t)=>this._aabbIntersectsCameraFrustum(e,t)),(e=>this._aabbContainedInCameraFrustum(e)))}_markVisibleFrameOfVisibleNodes(e,t){const s=this._lastVisibleFrameOfNodes;for(let i=0,r=e.length;i<r;i++)s[e[i].entity.id]=t}_cullNonVisibleNodes(e,t){const s=this._internalNodesList,i=this._lastVisibleFrameOfNodes;for(let e=0,r=s.length;e<r;e++)s[e]&&(s[e].culledVFC=i[e]!==t)}_getPointsForBBox(e){for(var t=[],s=0;s<8;s++)t.push([1&s?e.maxX:e.minX,2&s?e.maxY:e.minY,4&s?e.maxZ:e.minZ]);return t}_aabbIntersectsCameraFrustum(e,t){if(t)return!0;if("ortho"==this._camera.projection)return this._frustumProps.dirty=!1,!0;var s=this._aabbIntersectsCameraFrustum_internal(e);return!!((4096&s||!(1&s||2&s)||1&s)&&(8192&s||!(16&s||32&s)||16&s)&&(16384&s||!(256&s||512&s)||256&s))}_aabbContainedInCameraFrustum(e){if("ortho"==this._camera.projection)return this._frustumProps.dirty=!1,!0;var t=e._check;return 1&t&&16&t&&256&t}_ensureFrustumPropsUpdated(e){const t=Math.min(this._canvasElement.width,this._canvasElement.height);this._frustumProps.wMultiply=this._canvasElement.width/t,this._frustumProps.hMultiply=this._canvasElement.height/t;const s=this._canvasElement.width/this._canvasElement.height;let i=this._camera.perspective.fov;s<1&&(i/=s),i=Math.min(i,120),this._frustumProps.fov=i;const r=p.inverseMat4(e.worldMatrix,p.mat4()),o=p.transformVec3(this._camera.eye,r,[0,0,0]),n=p.transformVec3(this._camera.look,r,[0,0,0]);this._frustumProps.forward=p.normalizeVec3(p.subVec3(n,o,[0,0,0]),[0,0,0]),this._frustumProps.up=p.normalizeVec3(this._camera.up,[0,0,0]),this._frustumProps.right=p.normalizeVec3(p.cross3Vec3(this._frustumProps.forward,this._frustumProps.up,[0,0,0]),[0,0,0]),this._frustumProps.eye=o.slice(),this._frustumProps.CAM_FACTOR_1=this._frustumProps.fov/2*this._frustumProps.wMultiply/ri,this._frustumProps.CAM_FACTOR_2=this._frustumProps.fov/2*this._frustumProps.hMultiply/ri}_aabbIntersectsCameraFrustum_internal(e){var t=e._points||this._getPointsForBBox(e);e._points=t;var s=819;window._debug&&(window._debug=!1);for(var i=0,r=t.length;i<r;i++){var o=t[i],n=ii;n[0]=o[0]-this._frustumProps.eye[0],n[1]=o[1]-this._frustumProps.eye[1],n[2]=o[2]-this._frustumProps.eye[2];var a=p.dotVec3(n,this._frustumProps.forward);a<0?(s|=4,s&=-2):(s|=8,s&=-3);var h=ni(p.dotVec3(n,this._frustumProps.right),a);Math.abs(h)>this._frustumProps.CAM_FACTOR_1?(s|=h<0?64:128,s&=-17):s&=-33;var l=ni(p.dotVec3(n,this._frustumProps.up),a);Math.abs(l)>this._frustumProps.CAM_FACTOR_2?(s|=l<0?1024:2048,s&=-257):s&=-513}return 4&s&&8&s&&(s|=4096),64&s&&128&s&&(s|=8192),1024&s&&2048&s&&(s|=16384),e._check=s,s}}class hi{constructor(e){this.model=e,this.entities=[],this.meshes=[],this.finalized=!1}addEntity(e){if(this.finalized)throw"Already finalized";this.entities.push(e)}addMesh(e){if(this.finalized)throw"Already finalized";this.meshes.push(e)}finalize(e){if(this.finalized)throw"Already finalized";this.finalized=!0,this.vfcState=new ai,console.time("initializeVfcState"),this.vfcState.initializeVfcState(this.entities,this.meshes),console.timeEnd("initializeVfcState"),console.time("finalizeVfcState"),this.vfcState.finalize(this.model,e),console.timeEnd("finalizeVfcState");const t=this;this.model.scene.on("rendering",(()=>this.applyViewFrustumCulling.call(t)))}applyViewFrustumCulling(){if(!this.finalized)throw"Not finalized";this.vfcState.applyViewFrustumCulling(this.model)}}ce.SUPPORTED_EXTENSIONS.ANGLE_instanced_arrays;const li=p.vec3(),ui=p.mat4(),ci=p.vec3([1,1,1]),pi=p.vec3([0,0,0]),di=p.vec3([0,0,0]),mi=p.identityQuaternion();class fi extends A{constructor(e,t={}){if(super(e,t),!(this.scene.canvas.gl instanceof WebGL2RenderingContext))throw"Using a DataTextureSceneModel requires the usage of webgl2";this._enableVertexWelding=!t.disableVertexWelding,this._enableIndexRebucketing=!t.disableIndexRebucketing,this._targetLodFps=t.targetLodFps,t.enableViewFrustumCulling&&(this._vfcManager=new hi(this)),this._aabb=p.collapseAABB3(),this._aabbDirty=!1,this._layerList=[],this._nodeList=[],this._currentDataTextureLayer=null,this._instancingGeometries={},this._preparedInstancingGeometries={},this._meshes={},this._nodes={},this.renderFlags=new Ys,this.numGeometries=0,this.numPortions=0,this.numVisibleLayerPortions=0,this.numTransparentLayerPortions=0,this.numXRayedLayerPortions=0,this.numHighlightedLayerPortions=0,this.numSelectedLayerPortions=0,this.numEdgesLayerPortions=0,this.numPickableLayerPortions=0,this.numClippableLayerPortions=0,this.numCulledLayerPortions=0,this.numEntities=0,this._numTriangles=0,this._edgeThreshold=t.edgeThreshold||10,this.visible=t.visible,this.culled=t.culled,this.pickable=t.pickable,this.clippable=t.clippable,this.collidable=t.collidable,this.castsShadow=t.castsShadow,this.receivesShadow=t.receivesShadow,this.xrayed=t.xrayed,this.highlighted=t.highlighted,this.selected=t.selected,this.edges=t.edges,this.colorize=t.colorize,this.opacity=t.opacity,this.backfaces=t.backfaces,this._origin=p.vec3(t.origin||[0,0,0]),this._position=p.vec3(t.position||[0,0,0]),this._rotation=p.vec3(t.rotation||[0,0,0]),this._quaternion=p.vec4(t.quaternion||[0,0,0,1]),t.rotation&&p.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._scale=p.vec3(t.scale||[1,1,1]),this._worldMatrix=p.mat4(),p.composeMat4(this._position,this._quaternion,this._scale,this._worldMatrix),this._worldNormalMatrix=p.mat4(),p.inverseMat4(this._worldMatrix,this._worldNormalMatrix),p.transposeMat4(this._worldNormalMatrix),(t.matrix||t.position||t.rotation||t.scale||t.quaternion)&&(this._viewMatrix=p.mat4(),this._viewNormalMatrix=p.mat4(),this._viewMatrixDirty=!0,this._worldMatrixNonIdentity=!0),this._opacity=1,this._colorize=[1,1,1],this._saoEnabled=!1!==t.saoEnabled,this._pbrEnabled=!1,this._isModel=t.isModel,this._isModel&&this.scene._registerModel(this),this._onCameraViewMatrix=this.scene.camera.on("matrix",(()=>{this._viewMatrixDirty=!0}))}get isPerformanceModel(){return!0}get objects(){return this._nodes}get origin(){return this._origin}get position(){return this._position}get rotation(){return this._rotation}get quaternion(){return this._quaternion}get scale(){return this._scale}get matrix(){return this._worldMatrix}get worldMatrix(){return this._worldMatrix}get worldNormalMatrix(){return this._worldNormalMatrix}get viewMatrix(){return this._viewMatrix?(this._viewMatrixDirty&&(p.mulMat4(this.scene.camera.viewMatrix,this._worldMatrix,this._viewMatrix),p.inverseMat4(this._viewMatrix,this._viewNormalMatrix),p.transposeMat4(this._viewNormalMatrix),this._viewMatrixDirty=!1),this._viewMatrix):this.scene.camera.viewMatrix}get viewNormalMatrix(){return this._viewNormalMatrix?(this._viewMatrixDirty&&(p.mulMat4(this.scene.camera.viewMatrix,this._worldMatrix,this._viewMatrix),p.inverseMat4(this._viewMatrix,this._viewNormalMatrix),p.transposeMat4(this._viewNormalMatrix),this._viewMatrixDirty=!1),this._viewNormalMatrix):this.scene.camera.viewNormalMatrix}get backfaces(){return this._backfaces}set backfaces(e){e=!!e,this._backfaces=e,this.glRedraw()}get entityList(){return this._nodeList}get isEntity(){return!0}get isModel(){return this._isModel}get isObject(){return!1}get aabb(){return this._aabbDirty&&this._rebuildAABB(),this._aabb}get numTriangles(){return this._numTriangles}get numLines(){return 0}get numPoints(){return 0}get visible(){return this.numVisibleLayerPortions>0}set visible(e){e=!1!==e,this._visible=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].visible=e;this.glRedraw()}get xrayed(){return this.numXRayedLayerPortions>0}set xrayed(e){e=!!e,this._xrayed=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].xrayed=e;this.glRedraw()}get highlighted(){return this.numHighlightedLayerPortions>0}set highlighted(e){e=!!e,this._highlighted=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].highlighted=e;this.glRedraw()}get selected(){return this.numSelectedLayerPortions>0}set selected(e){e=!!e,this._selected=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].selected=e;this.glRedraw()}get edges(){return this.numEdgesLayerPortions>0}set edges(e){e=!!e,this._edges=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].edges=e;this.glRedraw()}get culled(){return this._culled}set culled(e){e=!!e,this._culled=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].culled=e;this.glRedraw()}get clippable(){return this._clippable}set clippable(e){e=!1!==e,this._clippable=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].clippable=e;this.glRedraw()}get collidable(){return this._collidable}set collidable(e){e=!1!==e,this._collidable=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].collidable=e}get pickable(){return this.numPickableLayerPortions>0}set pickable(e){e=!1!==e,this._pickable=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].pickable=e}get colorize(){return this._colorize}set colorize(e){this._colorize=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].colorize=e}get opacity(){return this._opacity}set opacity(e){this._opacity=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].opacity=e}get castsShadow(){return this._castsShadow}set castsShadow(e){(e=!1!==e)!==this._castsShadow&&(this._castsShadow=e,this.glRedraw())}get receivesShadow(){return this._receivesShadow}set receivesShadow(e){(e=!1!==e)!==this._receivesShadow&&(this._receivesShadow=e,this.glRedraw())}get saoEnabled(){return this._saoEnabled}get pbrEnabled(){return this._pbrEnabled}get isDrawable(){return!0}get isStateSortable(){return!1}get xrayMaterial(){return this.scene.xrayMaterial}get highlightMaterial(){return this.scene.highlightMaterial}get selectedMaterial(){return this.scene.selectedMaterial}get edgeMaterial(){return this.scene.edgeMaterial}getPickViewMatrix(e){return this._viewMatrix?this._viewMatrix:e}createGeometry(e){e.positionsCompressed&&!e.positions&&(e.positions=e.positionsCompressed);const t=e.id;if(null==t)return void this.error("Config missing: id");if(t in this._instancingGeometries)return void this.error("Geometry already created: "+t);const s=e.primitive;if(null==s)return void this.error("Config missing: primitive");const i=e.origin||e.rtcCenter,r=i?p.addVec3(this._origin,i,li):this._origin;switch(s){case"triangles":case"solid":case"surface":this._instancingGeometries[e.id]=y.apply({origin:r,layerIndex:0},e),this._numTriangles+=e.indices?Math.round(e.indices.length/3):0;break;case"lines":case"points":throw"Not supported at the moment"}this.numGeometries++}createMesh(e){if(e.positionsCompressed&&!e.positions&&(e.positions=e.positionsCompressed),this._vfcManager&&!this._vfcManager.finalized)return e.color&&(e.color=e.color.slice()),e.positionsDecodeMatrix&&(e.positionsDecodeMatrix=e.positionsDecodeMatrix.slice()),void this._vfcManager.addMesh(e);let t=e.id;if(null==t)return void this.error("Config missing: id");if(this._meshes[t])return void this.error("DataTextureSceneModel already has a Mesh with this ID: "+t);const s=e.geometryId,i=void 0!==s;let r=null;r=i?this._instancingGeometries[s]:e;let o=null;if(i&&s in this._preparedInstancingGeometries)o=this._preparedInstancingGeometries[s];else{let e=r.primitive||"triangles";"triangles"!==e&&"solid"!==e&&"surface"!==e&&(this.error(`Unsupported value for 'primitive': '${e}' - supported values are 'triangles', 'solid' and 'surface'. Defaulting to 'triangles'.`),e="triangles");let t=r.positions;if(!t)return this.error("Config missing: positions (no meshIds provided, so expecting geometry arrays instead)"),null;let n=r.indices,a=r.edgeIndices;if(!r.indices&&"triangles"===e)return this.error("Config missing for triangles primitive: indices (no meshIds provided, so expecting geometry arrays instead)"),null;a||(a=Ve(t,n,null,this._edgeThreshold)),r.edgeIndices=a,o=function(e,t,s){let i,r,o,n;t?[i,r,o]=xs({positions:e.positions,indices:e.indices,edgeIndices:e.edgeIndices}):(i=e.positions,r=e.indices,o=e.edgeIndices),n=s?Is({positions:i,indices:r,edgeIndices:o},i.length/3>65536?16:8):[{positions:i,indices:r,edgeIndices:o}];return e.preparedBuckets=n,e}(r,this._enableVertexWelding,this._enableIndexRebucketing),i&&(this._preparedInstancingGeometries[s]=o)}let n,a=this._currentDataTextureLayer;null===a||a.canCreatePortion(o,i?s:null)||(a.finalize(),delete this._currentDataTextureLayer,a=null),a||(a=new Xs(this,{layerIndex:0,origin:e.origin}),this._layerList.push(a),this._currentDataTextureLayer=a);const h=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):[255,255,255],l=void 0!==e.opacity&&null!==e.opacity?Math.floor(255*e.opacity):255,u=void 0!==e.metallic&&null!==e.metallic?Math.floor(255*e.metallic):0,c=void 0!==e.roughness&&null!==e.roughness?Math.floor(255*e.roughness):255,d=new Ue(this,t,h,l),m=d.pickId,f=new Uint8Array([255&m,m>>8&255,m>>16&255,m>>24&255]),g=p.collapseAABB3();if(o.solid="solid"==o.primitive,i){let t,i=this._worldMatrixNonIdentity?this._worldMatrix:null;if(e.matrix)t=e.matrix;else{const s=e.scale||ci,i=e.position||pi,r=e.rotation||di;p.eulerToQuaternion(r,"XYZ",mi),t=p.composeMat4(i,mi,s,ui)}n=a.createPortion(o,{origin:e.origin,geometryId:s,color:h,metallic:u,roughness:c,opacity:l,meshMatrix:t,worldMatrix:i,aabb:g,pickColor:f}),p.expandAABB3(this._aabb,g),this._numTriangles+=o.indices.length/3,d.numTriangles=o.indices.length/3,d.origin=o.origin}else{let t=null;if(!e.positionsDecodeMatrix){const e=p.vec3(),s=[];W(positions,s,e)&&(positions=s,t=p.addVec3(this._origin,e,e))}const s=e.origin||e.rtcCenter;t=s?t?p.addVec3(this._origin,s,li):s:this._origin;const i=this._worldMatrixNonIdentity?this._worldMatrix:null;let r;if(!e.positionsDecodeMatrix)if(e.matrix)r=e.matrix;else{const t=e.scale||ci,s=e.position||pi,i=e.rotation||di;p.eulerToQuaternion(i,"XYZ",mi),r=p.composeMat4(s,mi,t,ui)}switch(e.primitive||"triangles"){case"triangles":case"solid":case"surface":n=a.createPortion(y.apply({origin:t,color:h,metallic:u,roughness:c,colors:e.colors,colorsCompressed:e.colorsCompressed,opacity:l,meshMatrix:r,worldMatrix:i,aabb:g,pickColor:f},o));const s=Math.round(o.indices.length/3);this._numTriangles+=s,d.numTriangles=s;break;case"lines":case"points":throw"Not supported at the moment"}p.expandAABB3(this._aabb,g),this.numGeometries++,d.origin=t}d.parent=null,d._layer=a,d._portionId=n,d.aabb=g,this._meshes[t]=d}createEntity(e){if(this._vfcManager&&!this._vfcManager.finalized)return void this._vfcManager.addEntity(e);let t=e.id;void 0===t?t=p.createUUID():this.scene.components[t]&&(this.error("Scene already has a Component with this ID: "+t+" - will assign random ID"),t=p.createUUID());const s=e.meshIds;if(void 0===s)return void this.error("Config missing: meshIds");let i=[];for(let e=0,t=s.length;e<t;e++){const t=s[e],r=this._meshes[t];r?r.parent?this.error("Mesh with ID "+t+" already belongs to object with ID "+r.parent.id+" - ignoring this mesh"):i.push(r):this.error("Mesh with this ID not found: "+t+" - ignoring this mesh")}let r,o=0;if(this._visible&&!1!==e.visible&&(o|=ze),this._pickable&&!1!==e.pickable&&(o|=Xe),this._culled&&!1!==e.culled&&(o|=We),this._clippable&&!1!==e.clippable&&(o|=Ye),this._collidable&&!1!==e.collidable&&(o|=Ke),this._edges&&!1!==e.edges&&(o|=qe),this._xrayed&&!1!==e.xrayed&&(o|=Je),this._highlighted&&!1!==e.highlighted&&(o|=Ze),this._selected&&!1!==e.selected&&(o|=Qe),1===i.length)r=i[0].aabb;else{r=p.collapseAABB3();for(let e=0,t=i.length;e<t;e++)p.expandAABB3(r,i[e].aabb)}const n=new tt(this,e.isObject,t,i,o,r);return this._nodeList.push(n),this._nodes[t]=n,this.numEntities++,n}finalize(){if(!this.destroyed){this._vfcManager&&this._vfcManager.finalize((function(){this._currentDataTextureLayer&&(this._currentDataTextureLayer.finalize(),delete this._currentDataTextureLayer,this._currentDataTextureLayer=null)})),this._currentDataTextureLayer&&this._currentDataTextureLayer.finalize();for(let e=0,t=this._nodeList.length;e<t;e++){this._nodeList[e]._finalize()}for(let e=0,t=this._nodeList.length;e<t;e++){this._nodeList[e]._finalize2()}this._layerList.sort(((e,t)=>e.sortId<t.sortId?-1:e.sortId>t.sortId?1:0));for(let e=0,t=this._layerList.length;e<t;e++){this._layerList[e].layerIndex=e}this.glRedraw(),this.scene._aabbDirty=!0,this._instancingGeometries={},this._preparedInstancingGeometries={},this._targetLodFps&&(this.lodCullingManager=new Qs(this,[2e3,600,150,80,20],this._targetLodFps));for(let e=0,t=this._layerList.length;e<t;e++){this._layerList[e].attachToRenderingEvent()}}}_rebuildAABB(){p.collapseAABB3(this._aabb);for(let e=0,t=this._nodeList.length;e<t;e++){const t=this._nodeList[e];p.expandAABB3(this._aabb,t.aabb)}this._aabbDirty=!1}stateSortCompare(e,t){}rebuildRenderFlags(){this.renderFlags.reset(),this._updateRenderFlagsVisibleLayers(),this.renderFlags.numLayers>0&&0===this.renderFlags.numVisibleLayers?this.renderFlags.culled=!0:this._updateRenderFlags()}_updateRenderFlagsVisibleLayers(){const e=this.renderFlags;e.numLayers=this._layerList.length,e.numVisibleLayers=0;for(let t=0,s=this._layerList.length;t<s;t++){const s=this._layerList[t];this._getActiveSectionPlanesForLayer(s)&&(e.visibleLayers[e.numVisibleLayers++]=t)}}_getActiveSectionPlanesForLayer(e){const t=this.renderFlags,s=this.scene._sectionPlanesState.sectionPlanes,i=s.length,r=e.layerIndex*i;if(i>0)for(let e=0;e<i;e++){s[e].active?(t.sectionPlanesActivePerLayer[r+e]=!0,t.sectioned=!0):t.sectionPlanesActivePerLayer[r+e]=!1}return!0}_updateRenderFlags(){if(0===this.numVisibleLayerPortions)return;if(this.numCulledLayerPortions===this.numPortions)return;const e=this.renderFlags;if(e.colorOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.colorTransparent=!0),this.numXRayedLayerPortions>0){const t=this.scene.xrayMaterial._state;t.fill&&(t.fillAlpha<1?e.xrayedSilhouetteTransparent=!0:e.xrayedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.xrayedEdgesTransparent=!0:e.xrayedEdgesOpaque=!0)}if(this.numEdgesLayerPortions>0){this.scene.edgeMaterial._state.edges&&(e.edgesOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.edgesTransparent=!0))}if(this.numSelectedLayerPortions>0){const t=this.scene.selectedMaterial._state;t.fill&&(t.fillAlpha<1?e.selectedSilhouetteTransparent=!0:e.selectedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.selectedEdgesTransparent=!0:e.selectedEdgesOpaque=!0)}if(this.numHighlightedLayerPortions>0){const t=this.scene.highlightMaterial._state;t.fill&&(t.fillAlpha<1?e.highlightedSilhouetteTransparent=!0:e.highlightedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.highlightedEdgesTransparent=!0:e.highlightedEdgesOpaque=!0)}}drawColorOpaque(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawColorOpaque(t,e)}}drawColorTransparent(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawColorTransparent(t,e)}}drawDepth(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawDepth(t,e)}}drawNormals(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawNormals(t,e)}}drawSilhouetteXRayed(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawSilhouetteXRayed(t,e)}}drawSilhouetteHighlighted(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawSilhouetteHighlighted(t,e)}}drawSilhouetteSelected(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawSilhouetteSelected(t,e)}}drawEdgesColorOpaque(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawEdgesColorOpaque(t,e)}}drawEdgesColorTransparent(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawEdgesColorTransparent(t,e)}}drawEdgesXRayed(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawEdgesXRayed(t,e)}}drawEdgesHighlighted(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawEdgesHighlighted(t,e)}}drawEdgesSelected(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawEdgesSelected(t,e)}}drawOcclusion(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawOcclusion(t,e)}}drawShadow(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawShadow(t,e)}}drawPickMesh(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawPickMesh(t,e)}}drawPickDepths(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawPickDepths(t,e)}}drawPickNormals(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawPickNormals(t,e)}}destroy(){this.scene.camera.off(this._onCameraViewMatrix);for(let e=0,t=this._layerList.length;e<t;e++)this._layerList[e].destroy();for(let e=0,t=this._nodeList.length;e<t;e++)this._nodeList[e]._destroy();this.scene._aabbDirty=!0,this._isModel&&this.scene._deregisterModel(this),super.destroy()}}const gi=function(t,s){s=s||{};const i=new fe(t),r=t.canvas.canvas,o=t.canvas.gl,n=!!s.transparent,a=s.alphaDepthMask,h=new e({});let l={},u={},c=!0,d=!0,f=!0,g=!0,_=!0,y=!0,v=!0,b=!0;const x=new Ge(t);let P=!1;const T=new Ee(t),w=new Be(t);function M(){c&&(!function(){for(let e in l)if(l.hasOwnProperty(e)){const t=l[e],s=t.drawableMap,i=t.drawableListPreCull;let r=0;for(let e in s)s.hasOwnProperty(e)&&(i[r++]=s[e]);i.length=r}}(),c=!1,d=!0),d&&(!function(){for(let e in l)if(l.hasOwnProperty(e)){const t=l[e];t.isStateSortable&&t.drawableListPreCull.sort(t.stateSortCompare)}}(),d=!1,f=!0),f&&function(){for(let e in l)if(l.hasOwnProperty(e)){const t=l[e],s=t.drawableListPreCull,i=t.drawableList;let r=0;for(let e=0,t=s.length;e<t;e++){const t=s[e];t.rebuildRenderFlags(),t.renderFlags.culled||(i[r++]=t)}i.length=r}}()}function I(e){if(!e.castsShadow)return;const t=e.getShadowRenderBuf();if(t){t.bind(),i.reset(),i.backfaces=!0,i.frontface=!0,i.shadowViewMatrix=e.getShadowViewMatrix(),i.shadowProjMatrix=e.getShadowProjMatrix(),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(0,0,0,1),o.enable(o.DEPTH_TEST),o.disable(o.BLEND),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);for(let e in l)if(l.hasOwnProperty(e)){const t=l[e].drawableList;for(let e=0,s=t.length;e<s;e++){const s=t[e];!1!==s.visible&&s.castsShadow&&s.drawShadow&&(s.renderFlags.colorOpaque&&s.drawShadow(i))}}t.unbind()}}this._occlusionTester=null,this.capabilities={astcSupported:!!He(o,"WEBGL_compressed_texture_astc"),etc1Supported:!0,etc2Supported:!!He(o,"WEBGL_compressed_texture_etc"),dxtSupported:!!He(o,"WEBGL_compressed_texture_s3tc"),bptcSupported:!!He(o,"EXT_texture_compression_bptc"),pvrtcSupported:!(!He(o,"WEBGL_compressed_texture_pvrtc")&&!He(o,"WEBKIT_WEBGL_compressed_texture_pvrtc"))},this.setTransparentEnabled=function(e){g=e,f=!0},this.setEdgesEnabled=function(e){_=e,f=!0},this.setSAOEnabled=function(e){y=e,f=!0},this.setPBREnabled=function(e){v=e,f=!0},this.setColorTextureEnabled=function(e){b=e,f=!0},this.needStateSort=function(){d=!0},this.shadowsDirty=function(){},this.imageDirty=function(){f=!0},this.webglContextLost=function(){},this.webglContextRestored=function(e){T.init(),w.init(),f=!0},this.addDrawable=function(e,t){const s=t.type;if(!s)return void console.error("Renderer#addDrawable() : drawable with ID "+e+" has no 'type' - ignoring");let i=l[s];i||(i={type:t.type,count:0,isStateSortable:t.isStateSortable,stateSortCompare:t.stateSortCompare,drawableMap:{},drawableListPreCull:[],drawableList:[]},l[s]=i),i.count++,i.drawableMap[e]=t,u[e]=t,c=!0},this.removeDrawable=function(e){const t=u[e];if(!t)return void console.error("Renderer#removeDrawable() : drawable not found with ID "+e+" - ignoring");const s=t.type,i=l[s];--i.count<=0?delete l[s]:delete i.drawableMap[e],delete u[e],c=!0},this.getPickID=function(e){return h.addItem(e)},this.putPickID=function(e){h.removeItem(e)},this.clear=function(e){if(o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),n)o.clearColor(1,1,1,1);else{const e=t.canvas.backgroundColorFromAmbientLight?this.lights.getAmbientColorAndIntensity():t.canvas.backgroundColor;o.clearColor(e[0],e[1],e[2],1)}o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)},this.needsRender=function(){return f||c||d},this.render=function(e){(e=e||{}).force&&(f=!0),M(),f&&(!function(e){const s=t.sao;y&&s.possible&&function(e){const s=t.sao,r=x.getRenderBuffer("saoDepth",{depthTexture:!0});r.bind(),r.clear(),function(e){i.reset(),i.pass=e.pass,o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(0,0,0,0),o.enable(o.DEPTH_TEST),o.frontFace(o.CCW),o.enable(o.CULL_FACE),o.depthMask(!0),!1!==e.clear&&o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);for(let e in l)if(l.hasOwnProperty(e)){const t=l[e].drawableList;for(let e=0,s=t.length;e<s;e++){const s=t[e];!0!==s.culled&&!1!==s.visible&&s.drawDepth&&s.saoEnabled&&(s.renderFlags.colorOpaque&&s.drawDepth(i))}}}(e),r.unbind();const n=x.getRenderBuffer("saoOcclusion");if(n.bind(),n.clear(),T.render(r),n.unbind(),s.blur){const e=x.getRenderBuffer("saoOcclusion2");e.bind(),e.clear(),w.render(r,n,0),e.unbind(),n.bind(),n.clear(),w.render(r,e,1),n.unbind()}}(e);(function(){let e=t._lightsState.lights;for(let t=0,s=e.length;t<s;t++){const s=e[t];s.castsShadow&&I(s)}})(),function(e){const s=[],r=[],h=[],u=[],c=[],p=[],d=[],f=[],P=[],T=[],w=[],M=[],I=[],C=[],D=[],A=[];{const E=t._lightsState.getAmbientColorAndIntensity();if(i.reset(),i.pass=e.pass,i.withSAO=!1,i.pbrEnabled=v&&!!t.pbrEnabled,i.colorTextureEnabled=b&&!!t.colorTextureEnabled,o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),n)o.clearColor(0,0,0,0);else{const e=t.canvas.backgroundColorFromAmbientLight?E:t.canvas.backgroundColor;o.clearColor(e[0],e[1],e[2],1)}o.enable(o.DEPTH_TEST),o.frontFace(o.CCW),o.enable(o.CULL_FACE),o.depthMask(!0),o.lineWidth(1),i.lineWidth=1;const F=t.sao.possible;if(y&&F){const e=x.getRenderBuffer("saoOcclusion");i.occlusionTexture=e?e.getTexture():null}else i.occlusionTexture=null;let R,S,O;const B=Date.now();!1!==e.clear&&o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);let L=0,N=0,k=0,j=0,G=0,H=0,V=0,U=0,z=0,W=0,X=0,Y=0,K=0,J=0,Z=0,Q=0;for(let e in l)if(l.hasOwnProperty(e)){const t=l[e].drawableList;for(R=0,S=t.length;R<S;R++){if(O=t[R],!0===O.culled||!1===O.visible)continue;const e=O.renderFlags;e.colorOpaque&&(y&&F&&O.saoEnabled?s[L++]=O:O.drawColorOpaque(i)),g&&e.colorTransparent&&(h[k++]=O),e.xrayedSilhouetteTransparent&&(d[V++]=O),e.xrayedSilhouetteOpaque&&(c[G++]=O),e.highlightedSilhouetteTransparent&&(w[X++]=O),e.highlightedSilhouetteOpaque&&(P[z++]=O),e.selectedSilhouetteTransparent&&(D[Z++]=O),e.selectedSilhouetteOpaque&&(I[K++]=O),_&&(e.edgesOpaque&&(r[N++]=O),e.edgesTransparent&&(u[j++]=O)),e.selectedEdgesTransparent&&(A[Q++]=O),e.selectedEdgesOpaque&&(C[J++]=O),e.xrayedEdgesTransparent&&(f[U++]=O),e.xrayedEdgesOpaque&&(p[H++]=O),e.highlightedEdgesTransparent&&(M[Y++]=O),e.highlightedEdgesOpaque&&(T[W++]=O)}}if(L>0)for(i.withSAO=!0,R=0;R<L;R++)s[R].drawColorOpaque(i);if(N>0)for(R=0;R<N;R++)r[R].drawEdgesColorOpaque(i);if(G>0)for(R=0;R<G;R++)c[R].drawSilhouetteXRayed(i);if(H>0)for(R=0;R<H;R++)p[R].drawEdgesXRayed(i);if(V>0||U>0||k>0||j>0){if(o.enable(o.CULL_FACE),o.enable(o.BLEND),n?(o.blendEquation(o.FUNC_ADD),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA)):(o.blendEquation(o.FUNC_ADD),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA)),i.backfaces=!1,a||o.depthMask(!1),(k>0||j>0)&&o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),j>0)for(R=0;R<j;R++)O=u[R],O.drawEdgesColorTransparent(i);if(k>0)for(R=0;R<k;R++)O=h[R],O.drawColorTransparent(i);if(U>0)for(R=0;R<U;R++)f[R].drawEdgesXRayed(i);if(V>0)for(R=0;R<V;R++)d[R].drawSilhouetteXRayed(i);o.disable(o.BLEND),a||o.depthMask(!0)}if(z>0||W>0){if(i.lastProgramId=null,t.highlightMaterial.glowThrough&&o.clear(o.DEPTH_BUFFER_BIT),W>0)for(R=0;R<W;R++)T[R].drawEdgesHighlighted(i);if(z>0)for(R=0;R<z;R++)P[R].drawSilhouetteHighlighted(i)}if(X>0||Y>0||z>0){if(i.lastProgramId=null,t.selectedMaterial.glowThrough&&o.clear(o.DEPTH_BUFFER_BIT),o.enable(o.BLEND),n?(o.blendEquation(o.FUNC_ADD),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA)):o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.enable(o.CULL_FACE),Y>0)for(R=0;R<Y;R++)M[R].drawEdgesHighlighted(i);if(X>0)for(R=0;R<X;R++)w[R].drawSilhouetteHighlighted(i);o.disable(o.BLEND)}if(K>0||J>0){if(i.lastProgramId=null,t.selectedMaterial.glowThrough&&o.clear(o.DEPTH_BUFFER_BIT),J>0)for(R=0;R<J;R++)C[R].drawEdgesSelected(i);if(K>0)for(R=0;R<K;R++)I[R].drawSilhouetteSelected(i)}if(Z>0||Q>0){if(i.lastProgramId=null,t.selectedMaterial.glowThrough&&o.clear(o.DEPTH_BUFFER_BIT),o.enable(o.CULL_FACE),o.enable(o.BLEND),n?(o.blendEquation(o.FUNC_ADD),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA)):o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),Q>0)for(R=0;R<Q;R++)A[R].drawEdgesSelected(i);if(Z>0)for(R=0;R<Z;R++)D[R].drawSilhouetteSelected(i);o.disable(o.BLEND)}const q=Date.now(),$=m.frame;$.renderTime=(q-B)/1e3,$.drawElements=i.drawElements,$.drawArrays=i.drawArrays,$.useProgram=i.useProgram,$.bindTexture=i.bindTexture,$.bindArray=i.bindArray;const ee=ce.MAX_TEXTURE_IMAGE_UNITS;for(let e=0;e<ee;e++)o.activeTexture(o.TEXTURE0+e);o.bindTexture(o.TEXTURE_CUBE_MAP,null),o.bindTexture(o.TEXTURE_2D,null);const te=ce.MAX_VERTEX_ATTRIBS;for(let e=0;e<te;e++)o.disableVertexAttribArray(e)}}(e)}(e),m.frame.frameCount++,f=!1)},this.pick=function(){const e=p.vec3(),s=p.mat4(),n=p.mat4(),a=p.vec3(),u=p.vec3([0,1,0]),c=new ge,d=p.vec2(),m=p.vec3(),f=p.vec3(),g=p.vec3(),_=p.vec3(),y=p.vec3();return function(v,b=c){let P;b.reset(),M();let T=null,w=null;if(b.pickSurface=v.pickSurface,v.canvasPos)m[0]=v.canvasPos[0],m[1]=v.canvasPos[1],T=t.camera.viewMatrix,w=t.camera.projMatrix,b.canvasPos=v.canvasPos;else{const i=p.frustumMat4(-1,1,-1,1,.01,t.camera.project.far,s);v.matrix?(T=v.matrix,w=i):(f.set(v.origin||[0,0,0]),g.set(v.direction||[0,0,1]),P=p.addVec3(f,g,e),a[0]=Math.random(),a[1]=Math.random(),a[2]=Math.random(),p.normalizeVec3(a),p.cross3Vec3(g,a,u),T=p.lookAtMat4v(f,P,u,n),w=i,b.origin=f,b.direction=g),m[0]=.5*r.clientWidth,m[1]=.5*r.clientHeight}if(null!==T)for(let e in l)if(l.hasOwnProperty(e)){const t=l[e].drawableList;for(let e=0,s=t.length;e<s;e++){const s=t[e];s instanceof fi&&s.pickCameraTexture&&s.pickCameraTexture._updateViewMatrix(T,w)}}const I=x.getRenderBuffer("pick");I.bind();const D=function(e,s,r,n,a,u){i.reset(),i.backfaces=!0,i.frontface=!0,i.pickOrigin=u.origin,i.pickViewMatrix=r,i.pickProjMatrix=n,i.pickInvisible=!!a.pickInvisible,o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(0,0,0,0),o.enable(o.DEPTH_TEST),o.disable(o.CULL_FACE),o.disable(o.BLEND),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);const c=a.includeEntityIds,p=a.excludeEntityIds;for(let e in l)if(l.hasOwnProperty(e)){const t=l[e].drawableList;for(let e=0,s=t.length;e<s;e++){const s=t[e];!s.drawPickMesh||!0===s.culled||!0!==a.pickInvisible&&!1===s.visible||!1===s.pickable||(c&&!c[s.id]||p&&p[s.id]||s.drawPickMesh(i))}}const d=t.canvas.resolutionScale,m=e.read(Math.round(s[0]*d),Math.round(s[1]*d));let f=m[0]+256*m[1]+256*m[2]*256+256*m[3]*256*256;if(f<0)return;return h.items[f]}(I,m,T,w,v,b);if(!D)return I.unbind(),null;const A=D.delegatePickedEntity?D.delegatePickedEntity():D;return A?(v.pickSurface&&(v.pickSurfacePrecision&&t.pickSurfacePrecisionEnabled?(v.canvasPos&&p.canvasPosToWorldRay(t.canvas.canvas,T,w,m,f,g),D.precisionRayPickSurface(f,g,_,y)&&(b.worldPos=_,!1!==v.pickSurfaceNormal&&(b.worldNormal=y),b.pickSurfacePrecision=!0)):D.canPickTriangle&&D.canPickTriangle()?(!function(e,s,r,n,a,h){if(!s.drawPickTriangles)return;i.reset(),i.backfaces=!0,i.frontface=!0,i.pickOrigin=h.origin,i.pickViewMatrix=n,i.pickProjMatrix=a,o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(0,0,0,0),o.enable(o.DEPTH_TEST),o.disable(o.CULL_FACE),o.disable(o.BLEND),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),s.drawPickTriangles(i);const l=t.canvas.resolutionScale,u=e.read(Math.round(r[0]*l),Math.round(r[1]*l));let c=u[0]+256*u[1]+256*u[2]*256+256*u[3]*256*256;c*=3,h.primIndex=c}(I,D,m,T,w,b),D.pickTriangleSurface(T,w,b),b.pickSurfacePrecision=!1):D.canPickWorldPos&&D.canPickWorldPos()&&(d[0]=t.camera.project.near,d[1]=t.camera.project.far,C(I,D,m,T,w,d,b),!1!==v.pickSurfaceNormal&&function(e,s,r,n,a,h){i.reset(),i.backfaces=!0,i.frontface=!0,i.pickOrigin=h.origin,i.pickViewMatrix=n,i.pickProjMatrix=a,o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(0,0,0,0),o.enable(o.DEPTH_TEST),o.disable(o.CULL_FACE),o.disable(o.BLEND),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),s.drawPickNormals(i);const l=t.canvas.resolutionScale,u=e.read(Math.round(r[0]*l),Math.round(r[1]*l)),c=[u[0]/256-.5,u[1]/256-.5,u[2]/256-.5];p.normalizeVec3(c),h.worldNormal=c}(I,D,m,T,w,b),b.pickSurfacePrecision=!1)),I.unbind(),b.entity=A,b):(I.unbind(),null)}}();const C=function(){const e=p.vec4(),s=p.vec4(),n=p.vec4(),a=p.vec4(),h=p.vec4(),l=p.mat4(),u=p.mat4(),c=p.mat4();return function(d,m,f,g,_,y,v){i.reset(),i.backfaces=!0,i.frontface=!0,i.pickOrigin=v.origin,i.pickViewMatrix=g,i.pickProjMatrix=_,i.pickZNear=y[0],i.pickZFar=y[1],o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(0,0,0,0),o.enable(o.DEPTH_TEST),o.disable(o.CULL_FACE),o.disable(o.BLEND),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),m.drawPickDepths(i);const b=t.canvas.resolutionScale,x=function(e){const t=[e[0]/256,e[1]/256,e[2]/256,e[3]/256],s=[1/16777216,1/65536,1/256,1];return p.dotVec4(t,s)}(d.read(Math.round(f[0]*b),Math.round(f[1]*b))),P=(f[0]-r.clientWidth/2)/(r.clientWidth/2),T=-(f[1]-r.clientHeight/2)/(r.clientHeight/2),w=m.origin;let M;if(w){const e=U(g,w,l);M=p.mulMat4(_,e,u)}else M=p.mulMat4(_,g,u);const I=p.inverseMat4(M,c);e[0]=P,e[1]=T,e[2]=-1,e[3]=1;let C=p.transformVec4(I,e);C=p.mulVec4Scalar(C,1/C[3]),s[0]=P,s[1]=T,s[2]=1,s[3]=1;let D=p.transformVec4(I,s);D=p.mulVec4Scalar(D,1/D[3]);const A=p.subVec3(D,C,n),E=p.addVec3(C,p.mulVec4Scalar(A,x,a),h);w&&p.addVec3(E,w),v.worldPos=E}}();this.addMarker=function(e){this._occlusionTester=this._occlusionTester||new De(t,x),this._occlusionTester.addMarker(e),t.occlusionTestCountdown=0},this.markerWorldPosUpdated=function(e){this._occlusionTester.markerWorldPosUpdated(e)},this.removeMarker=function(e){this._occlusionTester.removeMarker(e)},this.doOcclusionTest=function(){if(this._occlusionTester&&this._occlusionTester.needOcclusionTest){M(),this._occlusionTester.bindRenderBuf(),i.reset(),i.backfaces=!0,i.frontface=!0,o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(0,0,0,0),o.enable(o.DEPTH_TEST),o.disable(o.CULL_FACE),o.disable(o.BLEND),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);for(let e in l)if(l.hasOwnProperty(e)){const t=l[e].drawableList;for(let e=0,s=t.length;e<s;e++){const s=t[e];s.drawOcclusion&&!0!==s.culled&&!1!==s.visible&&!1!==s.pickable&&s.drawOcclusion(i)}}this._occlusionTester.drawMarkers(i),this._occlusionTester.doOcclusionTest(),this._occlusionTester.unbindRenderBuf()}},this.readPixels=function(e,t,s,i){const r=x.getRenderBuffer("snapshot");let o,n,a,h;for(r.bind(),r.clear(),this.render({force:!0,opaqueOnly:i}),n=0;n<s;n++)a=2*n,h=4*n,o=r.read(e[a],e[a+1]),t[h]=o[0],t[h+1]=o[1],t[h+2]=o[2],t[h+3]=o[3];r.unbind(),f=!0},this.beginSnapshot=function(e={}){const t=x.getRenderBuffer("snapshot");e.width&&e.height&&t.setSize([e.width,e.height]),t.bind(),t.clear(),P=!0},this.renderSnapshot=function(){if(!P)return;x.getRenderBuffer("snapshot").clear(),this.render({force:!0,opaqueOnly:!1}),f=!0},this.readSnapshot=function(e){return x.getRenderBuffer("snapshot").readImage(e)},this.endSnapshot=function(){if(!P)return;x.getRenderBuffer("snapshot").unbind(),P=!1},this.destroy=function(){l={},u={},x.destroy(),T.destroy(),w.destroy(),this._occlusionTester&&this._occlusionTester.destroy()}};class _i extends A{constructor(e,t={}){super(e,t),this.KEY_BACKSPACE=8,this.KEY_TAB=9,this.KEY_ENTER=13,this.KEY_SHIFT=16,this.KEY_CTRL=17,this.KEY_ALT=18,this.KEY_PAUSE_BREAK=19,this.KEY_CAPS_LOCK=20,this.KEY_ESCAPE=27,this.KEY_PAGE_UP=33,this.KEY_PAGE_DOWN=34,this.KEY_END=35,this.KEY_HOME=36,this.KEY_LEFT_ARROW=37,this.KEY_UP_ARROW=38,this.KEY_RIGHT_ARROW=39,this.KEY_DOWN_ARROW=40,this.KEY_INSERT=45,this.KEY_DELETE=46,this.KEY_NUM_0=48,this.KEY_NUM_1=49,this.KEY_NUM_2=50,this.KEY_NUM_3=51,this.KEY_NUM_4=52,this.KEY_NUM_5=53,this.KEY_NUM_6=54,this.KEY_NUM_7=55,this.KEY_NUM_8=56,this.KEY_NUM_9=57,this.KEY_A=65,this.KEY_B=66,this.KEY_C=67,this.KEY_D=68,this.KEY_E=69,this.KEY_F=70,this.KEY_G=71,this.KEY_H=72,this.KEY_I=73,this.KEY_J=74,this.KEY_K=75,this.KEY_L=76,this.KEY_M=77,this.KEY_N=78,this.KEY_O=79,this.KEY_P=80,this.KEY_Q=81,this.KEY_R=82,this.KEY_S=83,this.KEY_T=84,this.KEY_U=85,this.KEY_V=86,this.KEY_W=87,this.KEY_X=88,this.KEY_Y=89,this.KEY_Z=90,this.KEY_LEFT_WINDOW=91,this.KEY_RIGHT_WINDOW=92,this.KEY_SELECT_KEY=93,this.KEY_NUMPAD_0=96,this.KEY_NUMPAD_1=97,this.KEY_NUMPAD_2=98,this.KEY_NUMPAD_3=99,this.KEY_NUMPAD_4=100,this.KEY_NUMPAD_5=101,this.KEY_NUMPAD_6=102,this.KEY_NUMPAD_7=103,this.KEY_NUMPAD_8=104,this.KEY_NUMPAD_9=105,this.KEY_MULTIPLY=106,this.KEY_ADD=107,this.KEY_SUBTRACT=109,this.KEY_DECIMAL_POINT=110,this.KEY_DIVIDE=111,this.KEY_F1=112,this.KEY_F2=113,this.KEY_F3=114,this.KEY_F4=115,this.KEY_F5=116,this.KEY_F6=117,this.KEY_F7=118,this.KEY_F8=119,this.KEY_F9=120,this.KEY_F10=121,this.KEY_F11=122,this.KEY_F12=123,this.KEY_NUM_LOCK=144,this.KEY_SCROLL_LOCK=145,this.KEY_SEMI_COLON=186,this.KEY_EQUAL_SIGN=187,this.KEY_COMMA=188,this.KEY_DASH=189,this.KEY_PERIOD=190,this.KEY_FORWARD_SLASH=191,this.KEY_GRAVE_ACCENT=192,this.KEY_OPEN_BRACKET=219,this.KEY_BACK_SLASH=220,this.KEY_CLOSE_BRACKET=221,this.KEY_SINGLE_QUOTE=222,this.KEY_SPACE=32,this.element=t.element,this.altDown=!1,this.ctrlDown=!1,this.mouseDownLeft=!1,this.mouseDownMiddle=!1,this.mouseDownRight=!1,this.keyDown=[],this.enabled=!0,this.keyboardEnabled=!0,this.mouseover=!1,this.mouseCanvasPos=p.vec2(),this._keyboardEventsElement=t.keyboardEventsElement||document,this._bindEvents()}_bindEvents(){if(!this._eventsBound){this._keyboardEventsElement.addEventListener("keydown",this._keyDownListener=e=>{this.enabled&&this.keyboardEnabled&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(e.keyCode===this.KEY_CTRL?this.ctrlDown=!0:e.keyCode===this.KEY_ALT?this.altDown=!0:e.keyCode===this.KEY_SHIFT&&(this.shiftDown=!0),this.keyDown[e.keyCode]=!0,this.fire("keydown",e.keyCode,!0))},!1),this._keyboardEventsElement.addEventListener("keyup",this._keyUpListener=e=>{this.enabled&&this.keyboardEnabled&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(e.keyCode===this.KEY_CTRL?this.ctrlDown=!1:e.keyCode===this.KEY_ALT?this.altDown=!1:e.keyCode===this.KEY_SHIFT&&(this.shiftDown=!1),this.keyDown[e.keyCode]=!1,this.fire("keyup",e.keyCode,!0))}),this.element.addEventListener("mouseenter",this._mouseEnterListener=e=>{this.enabled&&(this.mouseover=!0,this._getMouseCanvasPos(e),this.fire("mouseenter",this.mouseCanvasPos,!0))}),this.element.addEventListener("mouseleave",this._mouseLeaveListener=e=>{this.enabled&&(this.mouseover=!1,this._getMouseCanvasPos(e),this.fire("mouseleave",this.mouseCanvasPos,!0))}),this.element.addEventListener("mousedown",this._mouseDownListener=e=>{if(this.enabled){switch(e.which){case 1:this.mouseDownLeft=!0;break;case 2:this.mouseDownMiddle=!0;break;case 3:this.mouseDownRight=!0}this._getMouseCanvasPos(e),this.element.focus(),this.fire("mousedown",this.mouseCanvasPos,!0),this.mouseover&&e.preventDefault()}}),document.addEventListener("mouseup",this._mouseUpListener=e=>{if(this.enabled){switch(e.which){case 1:this.mouseDownLeft=!1;break;case 2:this.mouseDownMiddle=!1;break;case 3:this.mouseDownRight=!1}this.fire("mouseup",this.mouseCanvasPos,!0)}},!0),document.addEventListener("click",this._clickListener=e=>{if(this.enabled){switch(e.which){case 1:case 3:this.mouseDownLeft=!1,this.mouseDownRight=!1;break;case 2:this.mouseDownMiddle=!1}this._getMouseCanvasPos(e),this.fire("click",this.mouseCanvasPos,!0),this.mouseover&&e.preventDefault()}}),document.addEventListener("dblclick",this._dblClickListener=e=>{if(this.enabled){switch(e.which){case 1:case 3:this.mouseDownLeft=!1,this.mouseDownRight=!1;break;case 2:this.mouseDownMiddle=!1}this._getMouseCanvasPos(e),this.fire("dblclick",this.mouseCanvasPos,!0),this.mouseover&&e.preventDefault()}}),this.element.addEventListener("mousemove",this._mouseMoveListener=e=>{this.enabled&&(this._getMouseCanvasPos(e),this.fire("mousemove",this.mouseCanvasPos,!0),this.mouseover&&e.preventDefault())}),this.element.addEventListener("wheel",this._mouseWheelListener=(e,t)=>{if(!this.enabled)return;const s=Math.max(-1,Math.min(1,40*-e.deltaY));this.fire("mousewheel",s,!0)},{passive:!0});{let e,t;const s=2;this.on("mousedown",(s=>{e=s[0],t=s[1]})),this.on("mouseup",(i=>{e>=i[0]-s&&e<=i[0]+s&&t>=i[1]-s&&t<=i[1]+s&&this.fire("mouseclicked",i,!0)}))}this._eventsBound=!0}}_unbindEvents(){this._eventsBound&&(this._keyboardEventsElement.removeEventListener("keydown",this._keyDownListener),this._keyboardEventsElement.removeEventListener("keyup",this._keyUpListener),this.element.removeEventListener("mouseenter",this._mouseEnterListener),this.element.removeEventListener("mouseleave",this._mouseLeaveListener),this.element.removeEventListener("mousedown",this._mouseDownListener),document.removeEventListener("mouseup",this._mouseDownListener),document.removeEventListener("click",this._clickListener),document.removeEventListener("dblclick",this._dblClickListener),this.element.removeEventListener("mousemove",this._mouseMoveListener),this.element.removeEventListener("wheel",this._mouseWheelListener),window.OrientationChangeEvent&&window.removeEventListener("orientationchange",this._orientationchangedListener),window.DeviceMotionEvent&&window.removeEventListener("devicemotion",this._deviceMotionListener),window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",this._deviceOrientListener),this._eventsBound=!1)}_getMouseCanvasPos(e){if(e){let t=e.target,s=0,i=0;for(;t.offsetParent;)s+=t.offsetLeft,i+=t.offsetTop,t=t.offsetParent;this.mouseCanvasPos[0]=e.pageX-s,this.mouseCanvasPos[1]=e.pageY-i}else e=window.event,this.mouseCanvasPos[0]=e.x,this.mouseCanvasPos[1]=e.y}setEnabled(e){this.enabled!==e&&this.fire("enabled",this.enabled=e)}getEnabled(){return this.enabled}setKeyboardEnabled(e){this.keyboardEnabled=e}getKeyboardEnabled(){return this.keyboardEnabled}destroy(){super.destroy(),this._unbindEvents()}}class yi extends A{get type(){return"Viewport"}constructor(e,t={}){super(e,t),this._state=new ft({boundary:[0,0,100,100]}),this.boundary=t.boundary,this.autoBoundary=t.autoBoundary}set boundary(e){if(!this._autoBoundary){if(!e){const t=this.scene.canvas.boundary;e=[0,0,t[2],t[3]]}this._state.boundary=e,this.glRedraw(),this.fire("boundary",this._state.boundary)}}get boundary(){return this._state.boundary}set autoBoundary(e){(e=!!e)!==this._autoBoundary&&(this._autoBoundary=e,this._autoBoundary?this._onCanvasSize=this.scene.canvas.on("boundary",(function(e){const t=e[2],s=e[3];this._state.boundary=[0,0,t,s],this.glRedraw(),this.fire("boundary",this._state.boundary)}),this):this._onCanvasSize&&(this.scene.canvas.off(this._onCanvasSize),this._onCanvasSize=null),this.fire("autoBoundary",this._autoBoundary))}get autoBoundary(){return this._autoBoundary}_getState(){return this._state}destroy(){super.destroy(),this._state.destroy()}}class vi extends A{get type(){return"Light"}get isLight(){return!0}constructor(e,t={}){super(e,t)}}class bi extends vi{get type(){return"DirLight"}constructor(e,t={}){super(e,t),this._shadowRenderBuf=null,this._shadowViewMatrix=null,this._shadowProjMatrix=null,this._shadowViewMatrixDirty=!0,this._shadowProjMatrixDirty=!0;const s=this.scene.camera,i=this.scene.canvas;this._onCameraViewMatrix=s.on("viewMatrix",(()=>{this._shadowViewMatrixDirty=!0})),this._onCameraProjMatrix=s.on("projMatrix",(()=>{this._shadowProjMatrixDirty=!0})),this._onCanvasBoundary=i.on("boundary",(()=>{this._shadowProjMatrixDirty=!0})),this._state=new ft({type:"dir",dir:p.vec3([1,1,1]),color:p.vec3([.7,.7,.8]),intensity:1,space:t.space||"view",castsShadow:!1,getShadowViewMatrix:()=>{if(this._shadowViewMatrixDirty){this._shadowViewMatrix||(this._shadowViewMatrix=p.identityMat4());const e=this.scene.camera,t=this._state.dir,s=e.look,i=[s[0]-t[0],s[1]-t[1],s[2]-t[2]],r=[0,1,0];p.lookAtMat4v(i,s,r,this._shadowViewMatrix),this._shadowViewMatrixDirty=!1}return this._shadowViewMatrix},getShadowProjMatrix:()=>(this._shadowProjMatrixDirty&&(this._shadowProjMatrix||(this._shadowProjMatrix=p.identityMat4()),p.orthoMat4c(-40,40,-40,40,-40,80,this._shadowProjMatrix),this._shadowProjMatrixDirty=!1),this._shadowProjMatrix),getShadowRenderBuf:()=>(this._shadowRenderBuf||(this._shadowRenderBuf=new je(this.scene.canvas.canvas,this.scene.canvas.gl,{size:[1024,1024]})),this._shadowRenderBuf)}),this.dir=t.dir,this.color=t.color,this.intensity=t.intensity,this.castsShadow=t.castsShadow,this.scene._lightCreated(this)}set dir(e){this._state.dir.set(e||[1,1,1]),this._shadowViewMatrixDirty=!0,this.glRedraw()}get dir(){return this._state.dir}set color(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}get color(){return this._state.color}set intensity(e){e=void 0!==e?e:1,this._state.intensity=e,this.glRedraw()}get intensity(){return this._state.intensity}set castsShadow(e){e=!!e,this._state.castsShadow!==e&&(this._state.castsShadow=e,this._shadowViewMatrixDirty=!0,this.glRedraw())}get castsShadow(){return this._state.castsShadow}destroy(){const e=this.scene.camera,t=this.scene.canvas;e.off(this._onCameraViewMatrix),e.off(this._onCameraProjMatrix),t.off(this._onCanvasBoundary),super.destroy(),this._state.destroy(),this._shadowRenderBuf&&this._shadowRenderBuf.destroy(),this.scene._lightDestroyed(this),this.glRedraw()}}class xi extends vi{get type(){return"AmbientLight"}constructor(e,t={}){super(e,t),this._state={type:"ambient",color:p.vec3([.7,.7,.7]),intensity:1},this.color=t.color,this.intensity=t.intensity,this.scene._lightCreated(this)}set color(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}get color(){return this._state.color}set intensity(e){this._state.intensity=void 0!==e?e:1,this.glRedraw()}get intensity(){return this._state.intensity}destroy(){super.destroy(),this.scene._lightDestroyed(this)}}class Pi extends A{get type(){return"Geometry"}get isGeometry(){return!0}constructor(e,t={}){super(e,t),m.memory.meshes++}destroy(){super.destroy(),m.memory.meshes--}}const Ti=m.memory,wi=p.AABB3();class Mi extends Pi{get type(){return"ReadableGeometry"}get isReadableGeometry(){return!0}constructor(e,t={}){super(e,t),this._state=new ft({compressGeometry:!!t.compressGeometry,primitive:null,primitiveName:null,positions:null,normals:null,colors:null,uv:null,indices:null,positionsDecodeMatrix:null,uvDecodeMatrix:null,positionsBuf:null,normalsBuf:null,colorsbuf:null,uvBuf:null,indicesBuf:null,hash:""}),this._numTriangles=0,this._edgeThreshold=t.edgeThreshold||10,this._edgeIndicesBuf=null,this._pickTrianglePositionsBuf=null,this._pickTriangleColorsBuf=null,this._aabbDirty=!0,this._boundingSphere=!0,this._aabb=null,this._aabbDirty=!0,this._obb=null,this._obbDirty=!0;const s=this._state,i=this.scene.canvas.gl;switch(t.primitive=t.primitive||"triangles",t.primitive){case"points":s.primitive=i.POINTS,s.primitiveName=t.primitive;break;case"lines":s.primitive=i.LINES,s.primitiveName=t.primitive;break;case"line-loop":s.primitive=i.LINE_LOOP,s.primitiveName=t.primitive;break;case"line-strip":s.primitive=i.LINE_STRIP,s.primitiveName=t.primitive;break;case"triangles":s.primitive=i.TRIANGLES,s.primitiveName=t.primitive;break;case"triangle-strip":s.primitive=i.TRIANGLE_STRIP,s.primitiveName=t.primitive;break;case"triangle-fan":s.primitive=i.TRIANGLE_FAN,s.primitiveName=t.primitive;break;default:this.error("Unsupported value for 'primitive': '"+t.primitive+"' - supported values are 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'. Defaulting to 'triangles'."),s.primitive=i.TRIANGLES,s.primitiveName=t.primitive}if(t.positions)if(this._state.compressGeometry){const e=Pt.getPositionsBounds(t.positions),i=Pt.compressPositions(t.positions,e.min,e.max);s.positions=i.quantized,s.positionsDecodeMatrix=i.decodeMatrix}else s.positions=t.positions.constructor===Float32Array?t.positions:new Float32Array(t.positions);if(t.colors&&(s.colors=t.colors.constructor===Float32Array?t.colors:new Float32Array(t.colors)),t.uv)if(this._state.compressGeometry){const e=Pt.getUVBounds(t.uv),i=Pt.compressUVs(t.uv,e.min,e.max);s.uv=i.quantized,s.uvDecodeMatrix=i.decodeMatrix}else s.uv=t.uv.constructor===Float32Array?t.uv:new Float32Array(t.uv);t.normals&&(this._state.compressGeometry?s.normals=Pt.compressNormals(t.normals):s.normals=t.normals.constructor===Float32Array?t.normals:new Float32Array(t.normals)),t.indices&&(s.indices=t.indices.constructor===Uint32Array||t.indices.constructor===Uint16Array?t.indices:new Uint32Array(t.indices),"triangles"===this._state.primitiveName&&(this._numTriangles=t.indices.length/3)),this._buildHash(),Ti.meshes++,this._buildVBOs()}_buildVBOs(){const e=this._state,t=this.scene.canvas.gl;if(e.indices&&(e.indicesBuf=new we(t,t.ELEMENT_ARRAY_BUFFER,e.indices,e.indices.length,1,t.STATIC_DRAW),Ti.indices+=e.indicesBuf.numItems),e.positions&&(e.positionsBuf=new we(t,t.ARRAY_BUFFER,e.positions,e.positions.length,3,t.STATIC_DRAW),Ti.positions+=e.positionsBuf.numItems),e.normals){let s=e.compressGeometry;e.normalsBuf=new we(t,t.ARRAY_BUFFER,e.normals,e.normals.length,3,t.STATIC_DRAW,s),Ti.normals+=e.normalsBuf.numItems}e.colors&&(e.colorsBuf=new we(t,t.ARRAY_BUFFER,e.colors,e.colors.length,4,t.STATIC_DRAW),Ti.colors+=e.colorsBuf.numItems),e.uv&&(e.uvBuf=new we(t,t.ARRAY_BUFFER,e.uv,e.uv.length,2,t.STATIC_DRAW),Ti.uvs+=e.uvBuf.numItems)}_buildHash(){const e=this._state,t=["/g"];t.push("/"+e.primitive+";"),e.positions&&t.push("p"),e.colors&&t.push("c"),(e.normals||e.autoVertexNormals)&&t.push("n"),e.uv&&t.push("u"),e.compressGeometry&&t.push("cp"),t.push(";"),e.hash=t.join("")}_getEdgeIndices(){return this._edgeIndicesBuf||this._buildEdgeIndices(),this._edgeIndicesBuf}_getPickTrianglePositions(){return this._pickTrianglePositionsBuf||this._buildPickTriangleVBOs(),this._pickTrianglePositionsBuf}_getPickTriangleColors(){return this._pickTriangleColorsBuf||this._buildPickTriangleVBOs(),this._pickTriangleColorsBuf}_buildEdgeIndices(){const e=this._state;if(!e.positions||!e.indices)return;const t=this.scene.canvas.gl,s=Ve(e.positions,e.indices,e.positionsDecodeMatrix,this._edgeThreshold);this._edgeIndicesBuf=new we(t,t.ELEMENT_ARRAY_BUFFER,s,s.length,1,t.STATIC_DRAW),Ti.indices+=this._edgeIndicesBuf.numItems}_buildPickTriangleVBOs(){const e=this._state;if(!e.positions||!e.indices)return;const t=this.scene.canvas.gl,s=p.buildPickTriangles(e.positions,e.indices,e.compressGeometry),i=s.positions,r=s.colors;this._pickTrianglePositionsBuf=new we(t,t.ARRAY_BUFFER,i,i.length,3,t.STATIC_DRAW),this._pickTriangleColorsBuf=new we(t,t.ARRAY_BUFFER,r,r.length,4,t.STATIC_DRAW,!0),Ti.positions+=this._pickTrianglePositionsBuf.numItems,Ti.colors+=this._pickTriangleColorsBuf.numItems}_buildPickVertexVBOs(){}_webglContextLost(){this._sceneVertexBufs&&this._sceneVertexBufs.webglContextLost()}_webglContextRestored(){this._sceneVertexBufs&&this._sceneVertexBufs.webglContextRestored(),this._buildVBOs(),this._edgeIndicesBuf=null,this._pickVertexPositionsBuf=null,this._pickTrianglePositionsBuf=null,this._pickTriangleColorsBuf=null,this._pickVertexPositionsBuf=null,this._pickVertexColorsBuf=null}get primitive(){return this._state.primitiveName}get compressGeometry(){return this._state.compressGeometry}get positions(){return this._state.positions?this._state.compressGeometry?(this._decompressedPositions||(this._decompressedPositions=new Float32Array(this._state.positions.length),Pt.decompressPositions(this._state.positions,this._state.positionsDecodeMatrix,this._decompressedPositions)),this._decompressedPositions):this._state.positions:null}set positions(e){const t=this._state,s=t.positions;if(s)if(s.length===e.length){if(this._state.compressGeometry){const s=Pt.getPositionsBounds(e),i=Pt.compressPositions(e,s.min,s.max);e=i.quantized,t.positionsDecodeMatrix=i.decodeMatrix}s.set(e),t.positionsBuf&&t.positionsBuf.setData(s),this._setAABBDirty(),this.glRedraw()}else this.error("can't update geometry positions - new positions are wrong length");else this.error("can't update geometry positions - geometry has no positions")}get normals(){if(this._state.normals){if(!this._state.compressGeometry)return this._state.normals;if(!this._decompressedNormals){const e=this._state.normals.length,t=e+e/2;this._decompressedNormals=new Float32Array(t),Pt.decompressNormals(this._state.normals,this._decompressedNormals)}return this._decompressedNormals}}set normals(e){if(this._state.compressGeometry)return void this.error("can't update geometry normals - quantized geometry is immutable");const t=this._state,s=t.normals;s?s.length===e.length?(s.set(e),t.normalsBuf&&t.normalsBuf.setData(s),this.glRedraw()):this.error("can't update geometry normals - new normals are wrong length"):this.error("can't update geometry normals - geometry has no normals")}get uv(){return this._state.uv?this._state.compressGeometry?(this._decompressedUV||(this._decompressedUV=new Float32Array(this._state.uv.length),Pt.decompressUVs(this._state.uv,this._state.uvDecodeMatrix,this._decompressedUV)),this._decompressedUV):this._state.uv:null}set uv(e){if(this._state.compressGeometry)return void this.error("can't update geometry UVs - quantized geometry is immutable");const t=this._state,s=t.uv;s?s.length===e.length?(s.set(e),t.uvBuf&&t.uvBuf.setData(s),this.glRedraw()):this.error("can't update geometry UVs - new UVs are wrong length"):this.error("can't update geometry UVs - geometry has no UVs")}get colors(){return this._state.colors}set colors(e){if(this._state.compressGeometry)return void this.error("can't update geometry colors - quantized geometry is immutable");const t=this._state,s=t.colors;s?s.length===e.length?(s.set(e),t.colorsBuf&&t.colorsBuf.setData(s),this.glRedraw()):this.error("can't update geometry colors - new colors are wrong length"):this.error("can't update geometry colors - geometry has no colors")}get indices(){return this._state.indices}get aabb(){return this._aabbDirty&&(this._aabb||(this._aabb=p.AABB3()),p.positions3ToAABB3(this._state.positions,this._aabb,this._state.positionsDecodeMatrix),this._aabbDirty=!1),this._aabb}get obb(){return this._obbDirty&&(this._obb||(this._obb=p.OBB3()),p.positions3ToAABB3(this._state.positions,wi,this._state.positionsDecodeMatrix),p.AABB3ToOBB3(wi,this._obb),this._obbDirty=!1),this._obb}get numTriangles(){return this._numTriangles}_setAABBDirty(){this._aabbDirty||(this._aabbDirty=!0,this._aabbDirty=!0,this._obbDirty=!0)}_getState(){return this._state}destroy(){super.destroy();const e=this._state;e.indicesBuf&&e.indicesBuf.destroy(),e.positionsBuf&&e.positionsBuf.destroy(),e.normalsBuf&&e.normalsBuf.destroy(),e.uvBuf&&e.uvBuf.destroy(),e.colorsBuf&&e.colorsBuf.destroy(),this._edgeIndicesBuf&&this._edgeIndicesBuf.destroy(),this._pickTrianglePositionsBuf&&this._pickTrianglePositionsBuf.destroy(),this._pickTriangleColorsBuf&&this._pickTriangleColorsBuf.destroy(),this._pickVertexPositionsBuf&&this._pickVertexPositionsBuf.destroy(),this._pickVertexColorsBuf&&this._pickVertexColorsBuf.destroy(),e.destroy(),Ti.meshes--}}function Ii(e={}){let t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);let s=e.ySize||1;s<0&&(console.error("negative ySize not allowed - will invert"),s*=-1);let i=e.zSize||1;i<0&&(console.error("negative zSize not allowed - will invert"),i*=-1);const r=e.center,o=r?r[0]:0,n=r?r[1]:0,a=r?r[2]:0,h=-t+o,l=-s+n,u=-i+a,c=t+o,p=s+n,d=i+a;return y.apply(e,{positions:[c,p,d,h,p,d,h,l,d,c,l,d,c,p,d,c,l,d,c,l,u,c,p,u,c,p,d,c,p,u,h,p,u,h,p,d,h,p,d,h,p,u,h,l,u,h,l,d,h,l,u,c,l,u,c,l,d,h,l,d,c,l,u,h,l,u,h,p,u,c,p,u],normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],uv:[1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]})}class Ci extends A{get type(){return"Material"}constructor(e,t={}){super(e,t),m.memory.materials++}destroy(){super.destroy(),m.memory.materials--}}const Di={opaque:0,mask:1,blend:2},Ai=["opaque","mask","blend"];class Ei extends Ci{get type(){return"PhongMaterial"}constructor(e,t={}){super(e,t),this._state=new ft({type:"PhongMaterial",ambient:p.vec3([1,1,1]),diffuse:p.vec3([1,1,1]),specular:p.vec3([1,1,1]),emissive:p.vec3([0,0,0]),alpha:null,shininess:null,reflectivity:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),this.ambient=t.ambient,this.diffuse=t.diffuse,this.specular=t.specular,this.emissive=t.emissive,this.alpha=t.alpha,this.shininess=t.shininess,this.reflectivity=t.reflectivity,this.lineWidth=t.lineWidth,this.pointSize=t.pointSize,t.ambientMap&&(this._ambientMap=this._checkComponent("Texture",t.ambientMap)),t.diffuseMap&&(this._diffuseMap=this._checkComponent("Texture",t.diffuseMap)),t.specularMap&&(this._specularMap=this._checkComponent("Texture",t.specularMap)),t.emissiveMap&&(this._emissiveMap=this._checkComponent("Texture",t.emissiveMap)),t.alphaMap&&(this._alphaMap=this._checkComponent("Texture",t.alphaMap)),t.reflectivityMap&&(this._reflectivityMap=this._checkComponent("Texture",t.reflectivityMap)),t.normalMap&&(this._normalMap=this._checkComponent("Texture",t.normalMap)),t.occlusionMap&&(this._occlusionMap=this._checkComponent("Texture",t.occlusionMap)),t.diffuseFresnel&&(this._diffuseFresnel=this._checkComponent("Fresnel",t.diffuseFresnel)),t.specularFresnel&&(this._specularFresnel=this._checkComponent("Fresnel",t.specularFresnel)),t.emissiveFresnel&&(this._emissiveFresnel=this._checkComponent("Fresnel",t.emissiveFresnel)),t.alphaFresnel&&(this._alphaFresnel=this._checkComponent("Fresnel",t.alphaFresnel)),t.reflectivityFresnel&&(this._reflectivityFresnel=this._checkComponent("Fresnel",t.reflectivityFresnel)),this.alphaMode=t.alphaMode,this.alphaCutoff=t.alphaCutoff,this.backfaces=t.backfaces,this.frontface=t.frontface,this._makeHash()}_makeHash(){const e=this._state,t=["/p"];this._normalMap&&(t.push("/nm"),this._normalMap.hasMatrix&&t.push("/mat")),this._ambientMap&&(t.push("/am"),this._ambientMap.hasMatrix&&t.push("/mat"),t.push("/"+this._ambientMap.encoding)),this._diffuseMap&&(t.push("/dm"),this._diffuseMap.hasMatrix&&t.push("/mat"),t.push("/"+this._diffuseMap.encoding)),this._specularMap&&(t.push("/sm"),this._specularMap.hasMatrix&&t.push("/mat")),this._emissiveMap&&(t.push("/em"),this._emissiveMap.hasMatrix&&t.push("/mat"),t.push("/"+this._emissiveMap.encoding)),this._alphaMap&&(t.push("/opm"),this._alphaMap.hasMatrix&&t.push("/mat")),this._reflectivityMap&&(t.push("/rm"),this._reflectivityMap.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap.hasMatrix&&t.push("/mat")),this._diffuseFresnel&&t.push("/df"),this._specularFresnel&&t.push("/sf"),this._emissiveFresnel&&t.push("/ef"),this._alphaFresnel&&t.push("/of"),this._reflectivityFresnel&&t.push("/rf"),t.push(";"),e.hash=t.join("")}set ambient(e){let t=this._state.ambient;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.ambient=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}get ambient(){return this._state.ambient}set diffuse(e){let t=this._state.diffuse;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.diffuse=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get diffuse(){return this._state.diffuse}set specular(e){let t=this._state.specular;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.specular=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get specular(){return this._state.specular}set emissive(e){let t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}set alpha(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}get alpha(){return this._state.alpha}set shininess(e){this._state.shininess=void 0!==e?e:80,this.glRedraw()}get shininess(){return this._state.shininess}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(e){this._state.pointSize=e||1,this.glRedraw()}get pointSize(){return this._state.pointSize}set reflectivity(e){this._state.reflectivity=void 0!==e?e:1,this.glRedraw()}get reflectivity(){return this._state.reflectivity}get normalMap(){return this._normalMap}get ambientMap(){return this._ambientMap}get diffuseMap(){return this._diffuseMap}get specularMap(){return this._specularMap}get emissiveMap(){return this._emissiveMap}get alphaMap(){return this._alphaMap}get reflectivityMap(){return this._reflectivityMap}get occlusionMap(){return this._occlusionMap}get diffuseFresnel(){return this._diffuseFresnel}get specularFresnel(){return this._specularFresnel}get emissiveFresnel(){return this._emissiveFresnel}get alphaFresnel(){return this._alphaFresnel}get reflectivityFresnel(){return this._reflectivityFresnel}set alphaMode(e){let t=Di[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" - defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}get alphaMode(){return Ai[this._state.alphaMode]}set alphaCutoff(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}destroy(){super.destroy(),this._state.destroy()}}const Fi={default:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1},defaultWhiteBG:{fill:!0,fillColor:[1,1,1],fillAlpha:.6,edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultLightBG:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1},defaultDarkBG:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.5,.5,.5],edgeAlpha:.5,edgeWidth:1},phosphorous:{fill:!0,fillColor:[0,0,0],fillAlpha:.4,edges:!0,edgeColor:[.9,.9,.9],edgeAlpha:.5,edgeWidth:2},sunset:{fill:!0,fillColor:[.9,.9,.6],fillAlpha:.2,edges:!0,edgeColor:[.9,.9,.9],edgeAlpha:.5,edgeWidth:1},vectorscope:{fill:!0,fillColor:[0,0,0],fillAlpha:.7,edges:!0,edgeColor:[.2,1,.2],edgeAlpha:1,edgeWidth:2},battlezone:{fill:!0,fillColor:[0,0,0],fillAlpha:1,edges:!0,edgeColor:[.2,1,.2],edgeAlpha:1,edgeWidth:3},sepia:{fill:!0,fillColor:[.970588207244873,.7965892553329468,.6660899519920349],fillAlpha:.4,edges:!0,edgeColor:[.529411792755127,.4577854573726654,.4100345969200134],edgeAlpha:1,edgeWidth:1},yellowHighlight:{fill:!0,fillColor:[1,1,0],fillAlpha:.5,edges:!0,edgeColor:[.529411792755127,.4577854573726654,.4100345969200134],edgeAlpha:1,edgeWidth:1},greenSelected:{fill:!0,fillColor:[0,1,0],fillAlpha:.5,edges:!0,edgeColor:[.4577854573726654,.529411792755127,.4100345969200134],edgeAlpha:1,edgeWidth:1},gamegrid:{fill:!0,fillColor:[.2,.2,.7],fillAlpha:.9,edges:!0,edgeColor:[.4,.4,1.6],edgeAlpha:.8,edgeWidth:3}};class Ri extends Ci{get type(){return"EmphasisMaterial"}get presets(){return Fi}constructor(e,t={}){super(e,t),this._state=new ft({type:"EmphasisMaterial",fill:null,fillColor:null,fillAlpha:null,edges:null,edgeColor:null,edgeAlpha:null,edgeWidth:null,backfaces:!0,glowThrough:!0}),this._preset="default",t.preset?(this.preset=t.preset,void 0!==t.fill&&(this.fill=t.fill),t.fillColor&&(this.fillColor=t.fillColor),void 0!==t.fillAlpha&&(this.fillAlpha=t.fillAlpha),void 0!==t.edges&&(this.edges=t.edges),t.edgeColor&&(this.edgeColor=t.edgeColor),void 0!==t.edgeAlpha&&(this.edgeAlpha=t.edgeAlpha),void 0!==t.edgeWidth&&(this.edgeWidth=t.edgeWidth),void 0!==t.backfaces&&(this.backfaces=t.backfaces),void 0!==t.glowThrough&&(this.glowThrough=t.glowThrough)):(this.fill=t.fill,this.fillColor=t.fillColor,this.fillAlpha=t.fillAlpha,this.edges=t.edges,this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth,this.backfaces=t.backfaces,this.glowThrough=t.glowThrough)}set fill(e){e=!1!==e,this._state.fill!==e&&(this._state.fill=e,this.glRedraw())}get fill(){return this._state.fill}set fillColor(e){let t=this._state.fillColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.fillColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.4,t[1]=.4,t[2]=.4),this.glRedraw()}get fillColor(){return this._state.fillColor}set fillAlpha(e){e=null!=e?e:.2,this._state.fillAlpha!==e&&(this._state.fillAlpha=e,this.glRedraw())}get fillAlpha(){return this._state.fillAlpha}set edges(e){e=!1!==e,this._state.edges!==e&&(this._state.edges=e,this.glRedraw())}get edges(){return this._state.edges}set edgeColor(e){let t=this._state.edgeColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.edgeColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}get edgeColor(){return this._state.edgeColor}set edgeAlpha(e){e=null!=e?e:.5,this._state.edgeAlpha!==e&&(this._state.edgeAlpha=e,this.glRedraw())}get edgeAlpha(){return this._state.edgeAlpha}set edgeWidth(e){this._state.edgeWidth=e||1,this.glRedraw()}get edgeWidth(){return this._state.edgeWidth}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set glowThrough(e){e=!1!==e,this._state.glowThrough!==e&&(this._state.glowThrough=e,this.glRedraw())}get glowThrough(){return this._state.glowThrough}set preset(e){if(e=e||"default",this._preset===e)return;const t=Fi[e];t?(this.fill=t.fill,this.fillColor=t.fillColor,this.fillAlpha=t.fillAlpha,this.edges=t.edges,this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth,this.glowThrough=t.glowThrough,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(Fi).join(", "))}get preset(){return this._preset}destroy(){super.destroy(),this._state.destroy()}}const Si={default:{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1},defaultWhiteBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultLightBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultDarkBG:{edgeColor:[.5,.5,.5],edgeAlpha:1,edgeWidth:1}};class Oi extends Ci{get type(){return"EdgeMaterial"}get presets(){return Si}constructor(e,t={}){super(e,t),this._state=new ft({type:"EdgeMaterial",edges:null,edgeColor:null,edgeAlpha:null,edgeWidth:null}),this._preset="default",t.preset?(this.preset=t.preset,t.edgeColor&&(this.edgeColor=t.edgeColor),void 0!==t.edgeAlpha&&(this.edgeAlpha=t.edgeAlpha),void 0!==t.edgeWidth&&(this.edgeWidth=t.edgeWidth)):(this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth),this.edges=!1!==t.edges}set edges(e){e=!1!==e,this._state.edges!==e&&(this._state.edges=e,this.glRedraw())}get edges(){return this._state.edges}set edgeColor(e){let t=this._state.edgeColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.edgeColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}get edgeColor(){return this._state.edgeColor}set edgeAlpha(e){e=null!=e?e:1,this._state.edgeAlpha!==e&&(this._state.edgeAlpha=e,this.glRedraw())}get edgeAlpha(){return this._state.edgeAlpha}set edgeWidth(e){this._state.edgeWidth=e||1,this.glRedraw()}get edgeWidth(){return this._state.edgeWidth}set preset(e){if(e=e||"default",this._preset===e)return;const t=Si[e];t?(this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(Si).join(", "))}get preset(){return this._preset}destroy(){super.destroy(),this._state.destroy()}}const Bi={meters:{abbrev:"m"},metres:{abbrev:"m"},centimeters:{abbrev:"cm"},centimetres:{abbrev:"cm"},millimeters:{abbrev:"mm"},millimetres:{abbrev:"mm"},yards:{abbrev:"yd"},feet:{abbrev:"ft"},inches:{abbrev:"in"}};class Li extends A{constructor(e,t={}){super(e,t),this._units="meters",this._scale=1,this._origin=p.vec3([0,0,0]),this.units=t.units,this.scale=t.scale,this.origin=t.origin}get unitsInfo(){return Bi}set units(e){e||(e="meters");Bi[e]||(this.error("Unsupported value for 'units': "+e+" defaulting to 'meters'"),e="meters"),this._units=e,this.fire("units",this._units)}get units(){return this._units}set scale(e){(e=e||1)<=0?this.error("scale value should be larger than zero"):(this._scale=e,this.fire("scale",this._scale))}get scale(){return this._scale}set origin(e){if(!e)return this._origin[0]=0,this._origin[1]=0,void(this._origin[2]=0);this._origin[0]=e[0],this._origin[1]=e[1],this._origin[2]=e[2],this.fire("origin",this._origin)}get origin(){return this._origin}worldToRealPos(e,t=p.vec3(3)){t[0]=this._origin[0]+this._scale*e[0],t[1]=this._origin[1]+this._scale*e[1],t[2]=this._origin[2]+this._scale*e[2]}realToWorldPos(e,t=p.vec3(3)){return t[0]=(e[0]-this._origin[0])/this._scale,t[1]=(e[1]-this._origin[1])/this._scale,t[2]=(e[2]-this._origin[2])/this._scale,t}}class Ni extends A{constructor(e,t={}){super(e,t),this._supported=ce.SUPPORTED_EXTENSIONS.OES_standard_derivatives,this.enabled=t.enabled,this.kernelRadius=t.kernelRadius,this.intensity=t.intensity,this.bias=t.bias,this.scale=t.scale,this.minResolution=t.minResolution,this.numSamples=t.numSamples,this.blur=t.blur,this.blendCutoff=t.blendCutoff,this.blendFactor=t.blendFactor}get supported(){return this._supported}set enabled(e){e=!!e,this._enabled!==e&&(this._enabled=e,this.glRedraw())}get enabled(){return this._enabled}get possible(){if(!this._supported)return!1;if(!this._enabled)return!1;const e=this.scene.camera.projection;return"customProjection"!==e&&"frustum"!==e}get active(){return this._active}set kernelRadius(e){null==e&&(e=100),this._kernelRadius!==e&&(this._kernelRadius=e,this.glRedraw())}get kernelRadius(){return this._kernelRadius}set intensity(e){null==e&&(e=.15),this._intensity!==e&&(this._intensity=e,this.glRedraw())}get intensity(){return this._intensity}set bias(e){null==e&&(e=.5),this._bias!==e&&(this._bias=e,this.glRedraw())}get bias(){return this._bias}set scale(e){null==e&&(e=1),this._scale!==e&&(this._scale=e,this.glRedraw())}get scale(){return this._scale}set minResolution(e){null==e&&(e=0),this._minResolution!==e&&(this._minResolution=e,this.glRedraw())}get minResolution(){return this._minResolution}set numSamples(e){null==e&&(e=10),this._numSamples!==e&&(this._numSamples=e,this.glRedraw())}get numSamples(){return this._numSamples}set blur(e){e=!1!==e,this._blur!==e&&(this._blur=e,this.glRedraw())}get blur(){return this._blur}set blendCutoff(e){null==e&&(e=.3),this._blendCutoff!==e&&(this._blendCutoff=e,this.glRedraw())}get blendCutoff(){return this._blendCutoff}set blendFactor(e){null==e&&(e=1),this._blendFactor!==e&&(this._blendFactor=e,this.glRedraw())}get blendFactor(){return this._blendFactor}destroy(){super.destroy()}}const ki={default:{pointSize:4,roundPoints:!0,perspectivePoints:!0},square:{pointSize:4,roundPoints:!1,perspectivePoints:!0},round:{pointSize:4,roundPoints:!0,perspectivePoints:!0}};class ji extends Ci{get type(){return"PointsMaterial"}get presets(){return ki}constructor(e,t={}){super(e,t),this._state=new ft({type:"PointsMaterial",pointSize:null,roundPoints:null,perspectivePoints:null,minPerspectivePointSize:null,maxPerspectivePointSize:null,filterIntensity:null,minIntensity:null,maxIntensity:null}),t.preset?(this.preset=t.preset,void 0!==t.pointSize&&(this.pointSize=t.pointSize),void 0!==t.roundPoints&&(this.roundPoints=t.roundPoints),void 0!==t.perspectivePoints&&(this.perspectivePoints=t.perspectivePoints),void 0!==t.minPerspectivePointSize&&(this.minPerspectivePointSize=t.minPerspectivePointSize),void 0!==t.maxPerspectivePointSize&&(this.maxPerspectivePointSize=t.minPerspectivePointSize)):(this._preset="default",this.pointSize=t.pointSize,this.roundPoints=t.roundPoints,this.perspectivePoints=t.perspectivePoints,this.minPerspectivePointSize=t.minPerspectivePointSize,this.maxPerspectivePointSize=t.maxPerspectivePointSize),this.filterIntensity=t.filterIntensity,this.minIntensity=t.minIntensity,this.maxIntensity=t.maxIntensity}set pointSize(e){this._state.pointSize=e||2,this.glRedraw()}get pointSize(){return this._state.pointSize}set roundPoints(e){e=!1!==e,this._state.roundPoints!==e&&(this._state.roundPoints=e,this.scene._needRecompile=!0,this.glRedraw())}get roundPoints(){return this._state.roundPoints}set perspectivePoints(e){e=!1!==e,this._state.perspectivePoints!==e&&(this._state.perspectivePoints=e,this.scene._needRecompile=!0,this.glRedraw())}get perspectivePoints(){return this._state.perspectivePoints}set minPerspectivePointSize(e){this._state.minPerspectivePointSize=e||1,this.scene._needRecompile=!0,this.glRedraw()}get minPerspectivePointSize(){return this._state.minPerspectivePointSize}set maxPerspectivePointSize(e){this._state.maxPerspectivePointSize=e||6,this.scene._needRecompile=!0,this.glRedraw()}get maxPerspectivePointSize(){return this._state.maxPerspectivePointSize}set filterIntensity(e){e=!1!==e,this._state.filterIntensity!==e&&(this._state.filterIntensity=e,this.scene._needRecompile=!0,this.glRedraw())}get filterIntensity(){return this._state.filterIntensity}set minIntensity(e){this._state.minIntensity=null!=e?e:0,this.glRedraw()}get minIntensity(){return this._state.minIntensity}set maxIntensity(e){this._state.maxIntensity=null!=e?e:1,this.glRedraw()}get maxIntensity(){return this._state.maxIntensity}set preset(e){if(e=e||"default",this._preset===e)return;const t=ki[e];t?(this.pointSize=t.pointSize,this.roundPoints=t.roundPoints,this.perspectivePoints=t.perspectivePoints,this.minPerspectivePointSize=t.minPerspectivePointSize,this.maxPerspectivePointSize=t.maxPerspectivePointSize,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(ki).join(", "))}get preset(){return this._preset}get hash(){return[this.pointSize,this.roundPoints,this.perspectivePoints,this.minPerspectivePointSize,this.maxPerspectivePointSize,this.filterIntensity].join(";")}destroy(){super.destroy(),this._state.destroy()}}const Gi={default:{lineWidth:1},thick:{lineWidth:2},thicker:{lineWidth:4}};class Hi extends Ci{get type(){return"LinesMaterial"}get presets(){return Gi}constructor(e,t={}){super(e,t),this._state=new ft({type:"LinesMaterial",lineWidth:null}),t.preset?(this.preset=t.preset,void 0!==t.lineWidth&&(this.lineWidth=t.lineWidth)):(this._preset="default",this.lineWidth=t.lineWidth)}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set preset(e){if(e=e||"default",this._preset===e)return;const t=Gi[e];t?(this.lineWidth=t.lineWidth,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(Gi).join(", "))}get preset(){return this._preset}get hash(){return[""+this.lineWidth].join(";")}destroy(){super.destroy(),this._state.destroy()}}function Vi(e,t){const s={};let i,r;for(let o=0,n=t.length;o<n;o++)i=t[o],r=e.component[i],r?r.isEntity?s[i]=!0:e.warn("pick(): Component is not an Entity: "+i):e.warn("pick(): Component not found: "+i);return s}class Ui extends A{get type(){return"Scene"}constructor(e,t={}){super(null,t);const s=t.canvasElement||document.getElementById(t.canvasId);if(!(s instanceof HTMLCanvasElement))throw"Mandatory config expected: valid canvasId or canvasElement";const i=!!t.transparent,r=!!t.alphaDepthMask;this._aabbDirty=!0,this.viewer=e,this.occlusionTestCountdown=0,this.loading=0,this.startTime=(new Date).getTime(),this.models={},this.objects={},this._numObjects=0,this.visibleObjects={},this._numVisibleObjects=0,this.xrayedObjects={},this._numXRayedObjects=0,this.highlightedObjects={},this._numHighlightedObjects=0,this.selectedObjects={},this._numSelectedObjects=0,this.colorizedObjects={},this._numColorizedObjects=0,this.opacityObjects={},this._numOpacityObjects=0,this.offsetObjects={},this._numOffsetObjects=0,this._modelIds=null,this._objectIds=null,this._visibleObjectIds=null,this._xrayedObjectIds=null,this._highlightedObjectIds=null,this._selectedObjectIds=null,this._colorizedObjectIds=null,this._opacityObjectIds=null,this._offsetObjectIds=null,this._collidables={},this._compilables={},this._needRecompile=!1,this.types={},this.components={},this.sectionPlanes={},this.lights={},this.lightMaps={},this.reflectionMaps={},this.bitmaps={},this.lineSets={},this.realWorldOffset=t.realWorldOffset||new Float64Array([0,0,0]),this.canvas=new me(this,{dontClear:!0,canvas:s,spinnerElementId:t.spinnerElementId,transparent:i,webgl2:!1!==t.webgl2,contextAttr:t.contextAttr||{},backgroundColor:t.backgroundColor,backgroundColorFromAmbientLight:t.backgroundColorFromAmbientLight,premultipliedAlpha:t.premultipliedAlpha}),this.canvas.on("boundary",(()=>{this.glRedraw()})),this.canvas.on("webglContextFailed",(()=>{alert("xeokit failed to find WebGL!")})),this._renderer=new gi(this,{transparent:i,alphaDepthMask:r}),this._sectionPlanesState=new function(){this.sectionPlanes=[],this.clippingCaps=!1;let e=null;this.getHash=function(){if(e)return e;const t=this.sectionPlanes;if(0===t.length)return this.hash=";";const s=[];for(let e=0,i=t.length;e<i;e++)s.push("cp");return s.push(";"),e=s.join(""),e},this.addSectionPlane=function(t){this.sectionPlanes.push(t),e=null},this.removeSectionPlane=function(t){for(let s=0,i=this.sectionPlanes.length;s<i;s++)if(this.sectionPlanes[s].id===t.id)return this.sectionPlanes.splice(s,1),void(e=null)}},this._lightsState=new function(){const e=p.vec4([0,0,0,0]),t=p.vec4();this.lights=[],this.reflectionMaps=[],this.lightMaps=[];let s=null,i=null;this.getHash=function(){if(s)return s;const e=[],t=this.lights;let i;for(let s=0,r=t.length;s<r;s++)i=t[s],e.push("/"),e.push(i.type),e.push("world"===i.space?"w":"v"),i.castsShadow&&e.push("sh");return this.lightMaps.length>0&&e.push("/lm"),this.reflectionMaps.length>0&&e.push("/rm"),e.push(";"),s=e.join(""),s},this.addLight=function(e){this.lights.push(e),i=null,s=null},this.removeLight=function(e){for(let t=0,r=this.lights.length;t<r;t++){if(this.lights[t].id===e.id)return this.lights.splice(t,1),i&&i.id===e.id&&(i=null),void(s=null)}},this.addReflectionMap=function(e){this.reflectionMaps.push(e),s=null},this.removeReflectionMap=function(e){for(let t=0,i=this.reflectionMaps.length;t<i;t++)if(this.reflectionMaps[t].id===e.id)return this.reflectionMaps.splice(t,1),void(s=null)},this.addLightMap=function(e){this.lightMaps.push(e),s=null},this.removeLightMap=function(e){for(let t=0,i=this.lightMaps.length;t<i;t++)if(this.lightMaps[t].id===e.id)return this.lightMaps.splice(t,1),void(s=null)},this.getAmbientColorAndIntensity=function(){if(!i)for(let e=0,t=this.lights.length;e<t;e++){const t=this.lights[e];if("ambient"===t.type){i=t;break}}if(i){const e=i.color,s=i.intensity;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=s,t}return e}},this.input=new _i(this,{dontClear:!0,element:this.canvas.canvas,keyboardEventsElement:t.keyboardEventsElement}),this.metrics=new Li(this,{units:t.units,scale:t.scale,origin:t.origin}),this.sao=new Ni(this,{enabled:t.saoEnabled}),this.ticksPerRender=t.ticksPerRender,this.ticksPerOcclusionTest=t.ticksPerOcclusionTest,this.passes=t.passes,this.clearEachPass=t.clearEachPass,this.gammaInput=t.gammaInput,this.gammaOutput=t.gammaOutput,this.gammaFactor=t.gammaFactor,this._entityOffsetsEnabled=!!t.entityOffsetsEnabled,this._pickSurfacePrecisionEnabled=!!t.pickSurfacePrecisionEnabled,this._logarithmicDepthBufferEnabled=!!t.logarithmicDepthBufferEnabled,this._pbrEnabled=!!t.pbrEnabled,this._colorTextureEnabled=!1!==t.colorTextureEnabled,C._addScene(this),this._initDefaults(),this._viewport=new yi(this,{id:"default.viewport",autoBoundary:!0,dontClear:!0}),this._camera=new jt(this,{id:"default.camera",dontClear:!0}),new xi(this,{color:[1,1,1],intensity:.7}),new bi(this,{dir:[.8,-.5,-.5],color:[.67,.67,1],intensity:.7,space:"world"}),new bi(this,{dir:[-.8,-1,.5],color:[1,1,.9],intensity:.9,space:"world"}),this._camera.on("dirty",(()=>{this._renderer.imageDirty()}))}_initDefaults(){}_addComponent(e){if(e.id&&this.components[e.id]&&(this.error("Component "+y.inQuotes(e.id)+" already exists in Scene - ignoring ID, will randomly-generate instead"),e.id=null),!e.id)for(void 0===window.nextID&&(window.nextID=0),e.id="__"+window.nextID++;this.components[e.id];)e.id=p.createUUID();this.components[e.id]=e;const t=e.type;let s=this.types[e.type];s||(s=this.types[t]={}),s[e.id]=e,e.compile&&(this._compilables[e.id]=e),e.isDrawable&&(this._renderer.addDrawable(e.id,e),this._collidables[e.id]=e)}_removeComponent(e){var t=e.id,s=e.type;delete this.components[t];const i=this.types[s];i&&(delete i[t],y.isEmptyObject(i)&&delete this.types[s]),e.compile&&delete this._compilables[e.id],e.isDrawable&&(this._renderer.removeDrawable(e.id),delete this._collidables[e.id])}_sectionPlaneCreated(e){this.sectionPlanes[e.id]=e,this.scene._sectionPlanesState.addSectionPlane(e._state),this.scene.fire("sectionPlaneCreated",e,!0),this._needRecompile=!0}_bitmapCreated(e){this.bitmaps[e.id]=e,this.scene.fire("bitmapCreated",e,!0)}_lineSetCreated(e){this.lineSets[e.id]=e,this.scene.fire("lineSetCreated",e,!0)}_lightCreated(e){this.lights[e.id]=e,this.scene._lightsState.addLight(e._state),this._needRecompile=!0}_lightMapCreated(e){this.lightMaps[e.id]=e,this.scene._lightsState.addLightMap(e._state),this._needRecompile=!0}_reflectionMapCreated(e){this.reflectionMaps[e.id]=e,this.scene._lightsState.addReflectionMap(e._state),this._needRecompile=!0}_sectionPlaneDestroyed(e){delete this.sectionPlanes[e.id],this.scene._sectionPlanesState.removeSectionPlane(e._state),this.scene.fire("sectionPlaneDestroyed",e,!0),this._needRecompile=!0}_bitmapDestroyed(e){delete this.bitmaps[e.id],this.scene.fire("bitmapDestroyed",e,!0)}_lineSetDestroyed(e){delete this.lineSets[e.id],this.scene.fire("lineSetDestroyed",e,!0)}_lightDestroyed(e){delete this.lights[e.id],this.scene._lightsState.removeLight(e._state),this._needRecompile=!0}_lightMapDestroyed(e){delete this.lightMaps[e.id],this.scene._lightsState.removeLightMap(e._state),this._needRecompile=!0}_reflectionMapDestroyed(e){delete this.reflectionMaps[e.id],this.scene._lightsState.removeReflectionMap(e._state),this._needRecompile=!0}_registerModel(e){this.models[e.id]=e,this._modelIds=null}_deregisterModel(e){const t=e.id;delete this.models[t],this._modelIds=null,this.fire("modelUnloaded",t)}_registerObject(e){this.objects[e.id]=e,this._numObjects++,this._objectIds=null}_deregisterObject(e){delete this.objects[e.id],this._numObjects--,this._objectIds=null}_objectVisibilityUpdated(e,t=!0){e.visible?(this.visibleObjects[e.id]=e,this._numVisibleObjects++):(delete this.visibleObjects[e.id],this._numVisibleObjects--),this._visibleObjectIds=null,t&&this.fire("objectVisibility",e,!0)}_objectXRayedUpdated(e,t=!0){e.xrayed?(this.xrayedObjects[e.id]=e,this._numXRayedObjects++):(delete this.xrayedObjects[e.id],this._numXRayedObjects--),this._xrayedObjectIds=null,t&&this.fire("objectXRayed",e,!0)}_objectHighlightedUpdated(e,t=!0){e.highlighted?(this.highlightedObjects[e.id]=e,this._numHighlightedObjects++):(delete this.highlightedObjects[e.id],this._numHighlightedObjects--),this._highlightedObjectIds=null,t&&this.fire("objectHighlighted",e,!0)}_objectSelectedUpdated(e,t=!0){e.selected?(this.selectedObjects[e.id]=e,this._numSelectedObjects++):(delete this.selectedObjects[e.id],this._numSelectedObjects--),this._selectedObjectIds=null,t&&this.fire("objectSelected",e,!0)}_objectColorizeUpdated(e,t){t?(this.colorizedObjects[e.id]=e,this._numColorizedObjects++):(delete this.colorizedObjects[e.id],this._numColorizedObjects--),this._colorizedObjectIds=null}_objectOpacityUpdated(e,t){t?(this.opacityObjects[e.id]=e,this._numOpacityObjects++):(delete this.opacityObjects[e.id],this._numOpacityObjects--),this._opacityObjectIds=null}_objectOffsetUpdated(e,t){!t||0===t[0]&&0===t[1]&&0===t[2]?(this.offsetObjects[e.id]=e,this._numOffsetObjects++):(delete this.offsetObjects[e.id],this._numOffsetObjects--),this._offsetObjectIds=null}_webglContextLost(){this.canvas.spinner.processes++;for(const e in this.components)if(this.components.hasOwnProperty(e)){const t=this.components[e];t._webglContextLost&&t._webglContextLost()}this._renderer.webglContextLost()}_webglContextRestored(){const e=this.canvas.gl;for(const t in this.components)if(this.components.hasOwnProperty(t)){const s=this.components[t];s._webglContextRestored&&s._webglContextRestored(e)}this._renderer.webglContextRestored(e),this.canvas.spinner.processes--}get capabilities(){return this._renderer.capabilities}get entityOffsetsEnabled(){return this._entityOffsetsEnabled}get pickSurfacePrecisionEnabled(){return this._pickSurfacePrecisionEnabled}get logarithmicDepthBufferEnabled(){return this._logarithmicDepthBufferEnabled}set pbrEnabled(e){this._pbrEnabled=!!e,this.glRedraw()}get pbrEnabled(){return this._pbrEnabled}set colorTextureEnabled(e){this._colorTextureEnabled=!!e,this.glRedraw()}get colorTextureEnabled(){return this._colorTextureEnabled}doOcclusionTest(){this._needRecompile&&(this._recompile(),this._needRecompile=!1),this._renderer.doOcclusionTest()}render(e){e&&C.runTasks();const t={sceneId:null,pass:0};if(this._needRecompile&&(this._recompile(),this._renderer.imageDirty(),this._needRecompile=!1),!e&&!this._renderer.needsRender())return;t.sceneId=this.id;const s=this._passes,i=this._clearEachPass;let r,o;for(r=0;r<s;r++)t.pass=r,this.fire("rendering",t,!0),o=i||0===r,this._renderer.render({pass:r,clear:o,force:e}),this.fire("rendered",t,!0);this._saveAmbientColor()}_recompile(){for(const e in this._compilables)this._compilables.hasOwnProperty(e)&&this._compilables[e].compile();this._renderer.shadowsDirty(),this.fire("compile",this,!0)}_saveAmbientColor(){const e=this.canvas;if(e.transparent||e.backgroundImage||e.backgroundColor)this._lastAmbientColor=null;else{const t=this._lightsState.getAmbientColorAndIntensity();this._lastAmbientColor&&this._lastAmbientColor[0]===t[0]&&this._lastAmbientColor[1]===t[1]&&this._lastAmbientColor[2]===t[2]&&this._lastAmbientColor[3]===t[3]||(e.backgroundColor=t,this._lastAmbientColor||(this._lastAmbientColor=p.vec4([0,0,0,1])),this._lastAmbientColor.set(t))}}get modelIds(){return this._modelIds||(this._modelIds=Object.keys(this.models)),this._modelIds}get numObjects(){return this._numObjects}get objectIds(){return this._objectIds||(this._objectIds=Object.keys(this.objects)),this._objectIds}get numVisibleObjects(){return this._numVisibleObjects}get visibleObjectIds(){return this._visibleObjectIds||(this._visibleObjectIds=Object.keys(this.visibleObjects)),this._visibleObjectIds}get numXRayedObjects(){return this._numXRayedObjects}get xrayedObjectIds(){return this._xrayedObjectIds||(this._xrayedObjectIds=Object.keys(this.xrayedObjects)),this._xrayedObjectIds}get numHighlightedObjects(){return this._numHighlightedObjects}get highlightedObjectIds(){return this._highlightedObjectIds||(this._highlightedObjectIds=Object.keys(this.highlightedObjects)),this._highlightedObjectIds}get numSelectedObjects(){return this._numSelectedObjects}get selectedObjectIds(){return this._selectedObjectIds||(this._selectedObjectIds=Object.keys(this.selectedObjects)),this._selectedObjectIds}get numColorizedObjects(){return this._numColorizedObjects}get colorizedObjectIds(){return this._colorizedObjectIds||(this._colorizedObjectIds=Object.keys(this.colorizedObjects)),this._colorizedObjectIds}get opacityObjectIds(){return this._opacityObjectIds||(this._opacityObjectIds=Object.keys(this.opacityObjects)),this._opacityObjectIds}get offsetObjectIds(){return this._offsetObjectIds||(this._offsetObjectIds=Object.keys(this.offsetObjects)),this._offsetObjectIds}set ticksPerRender(e){null==e?e=1:(!y.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'ticksPerRender': '"+e+"' - should be an integer greater than zero."),e=1),e!==this._ticksPerRender&&(this._ticksPerRender=e)}get ticksPerRender(){return this._ticksPerRender}set ticksPerOcclusionTest(e){null==e?e=20:(!y.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'ticksPerOcclusionTest': '"+e+"' - should be an integer greater than zero."),e=20),e!==this._ticksPerOcclusionTest&&(this._ticksPerOcclusionTest=e)}get ticksPerOcclusionTest(){return this._ticksPerOcclusionTest}set passes(e){null==e?e=1:(!y.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'passes': '"+e+"' - should be an integer greater than zero."),e=1),e!==this._passes&&(this._passes=e,this.glRedraw())}get passes(){return this._passes}set clearEachPass(e){(e=!!e)!==this._clearEachPass&&(this._clearEachPass=e,this.glRedraw())}get clearEachPass(){return this._clearEachPass}set gammaInput(e){(e=!1!==e)!==this._renderer.gammaInput&&(this._renderer.gammaInput=e,this._needRecompile=!0,this.glRedraw())}get gammaInput(){return this._renderer.gammaInput}set gammaOutput(e){(e=!!e)!==this._renderer.gammaOutput&&(this._renderer.gammaOutput=e,this._needRecompile=!0,this.glRedraw())}get gammaOutput(){return this._renderer.gammaOutput}set gammaFactor(e){(e=null==e?2.2:e)!==this._renderer.gammaFactor&&(this._renderer.gammaFactor=e,this.glRedraw())}get gammaFactor(){return this._renderer.gammaFactor}get geometry(){return this.components["default.geometry"]||Ii(Mi)}get material(){return this.components["default.material"]||new Ei(this,{id:"default.material",emissive:[.4,.4,.4],dontClear:!0})}get xrayMaterial(){return this.components["default.xrayMaterial"]||new Ri(this,{id:"default.xrayMaterial",preset:"sepia",dontClear:!0})}get highlightMaterial(){return this.components["default.highlightMaterial"]||new Ri(this,{id:"default.highlightMaterial",preset:"yellowHighlight",dontClear:!0})}get selectedMaterial(){return this.components["default.selectedMaterial"]||new Ri(this,{id:"default.selectedMaterial",preset:"greenSelected",dontClear:!0})}get edgeMaterial(){return this.components["default.edgeMaterial"]||new Oi(this,{id:"default.edgeMaterial",preset:"default",edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1,dontClear:!0})}get pointsMaterial(){return this.components["default.pointsMaterial"]||new ji(this,{id:"default.pointsMaterial",preset:"default",dontClear:!0})}get linesMaterial(){return this.components["default.linesMaterial"]||new Hi(this,{id:"default.linesMaterial",preset:"default",dontClear:!0})}get viewport(){return this._viewport}get camera(){return this._camera}get center(){if(this._aabbDirty||!this._center){this._center&&this._center||(this._center=p.vec3());const e=this.aabb;this._center[0]=(e[0]+e[3])/2,this._center[1]=(e[1]+e[4])/2,this._center[2]=(e[2]+e[5])/2}return this._center}get aabb(){if(this._aabbDirty){this._aabb||(this._aabb=p.AABB3());let e,t=p.MAX_DOUBLE,s=p.MAX_DOUBLE,i=p.MAX_DOUBLE,r=p.MIN_DOUBLE,o=p.MIN_DOUBLE,n=p.MIN_DOUBLE;const a=this._collidables;let h,l=!1;for(const u in a)if(a.hasOwnProperty(u)){if(h=a[u],!1===h.collidable)continue;e=h.aabb,e[0]<t&&(t=e[0]),e[1]<s&&(s=e[1]),e[2]<i&&(i=e[2]),e[3]>r&&(r=e[3]),e[4]>o&&(o=e[4]),e[5]>n&&(n=e[5]),l=!0}l||(t=-100,s=-100,i=-100,r=100,o=100,n=100),this._aabb[0]=t,this._aabb[1]=s,this._aabb[2]=i,this._aabb[3]=r,this._aabb[4]=o,this._aabb[5]=n,this._aabbDirty=!1}return this._aabb}_setAABBDirty(){this._aabbDirty=!0,this.fire("boundary")}pick(e,t){if(0===this.canvas.boundary[2]||0===this.canvas.boundary[3])return this.error("Picking not allowed while canvas has zero width or height"),null;(e=e||{}).pickSurface=e.pickSurface||e.rayPick,e.canvasPos||e.matrix||e.origin&&e.direction||this.warn("picking without canvasPos, matrix, or ray origin and direction");const s=e.includeEntities||e.include;s&&(e.includeEntityIds=Vi(this,s));const i=e.excludeEntities||e.exclude;return i&&(e.excludeEntityIds=Vi(this,i)),this._needRecompile&&(this._recompile(),this._renderer.imageDirty(),this._needRecompile=!1),(t=this._renderer.pick(e,t))?(t.entity&&t.entity.fire&&t.entity.fire("picked",t),t):void 0}clear(){var e;for(const t in this.components)this.components.hasOwnProperty(t)&&((e=this.components[t])._dontClear||e.destroy())}clearLights(){const e=Object.keys(this.lights);for(let t=0,s=e.length;t<s;t++)this.lights[e[t]].destroy()}clearSectionPlanes(){const e=Object.keys(this.sectionPlanes);for(let t=0,s=e.length;t<s;t++)this.sectionPlanes[e[t]].destroy()}clearBitmaps(){const e=Object.keys(this.bitmaps);for(let t=0,s=e.length;t<s;t++)this.bitmaps[e[t]].destroy()}clearLines(){const e=Object.keys(this.lineSets);for(let t=0,s=e.length;t<s;t++)this.lineSets[e[t]].destroy()}getAABB(e){if(void 0===e)return this.aabb;if(y.isString(e)){const t=this.objects[e];if(t&&t.aabb)return t.aabb;e=[e]}if(0===e.length)return this.aabb;let t,s=p.MAX_DOUBLE,i=p.MAX_DOUBLE,r=p.MAX_DOUBLE,o=p.MIN_DOUBLE,n=p.MIN_DOUBLE,a=p.MIN_DOUBLE;if(this.withObjects(e,(e=>{if(e.collidable){const h=e.aabb;h[0]<s&&(s=h[0]),h[1]<i&&(i=h[1]),h[2]<r&&(r=h[2]),h[3]>o&&(o=h[3]),h[4]>n&&(n=h[4]),h[5]>a&&(a=h[5]),t=!0}})),t){const e=p.AABB3();return e[0]=s,e[1]=i,e[2]=r,e[3]=o,e[4]=n,e[5]=a,e}return this.aabb}setObjectsVisible(e,t){return this.withObjects(e,(e=>{const s=e.visible!==t;return e.visible=t,s}))}setObjectsCollidable(e,t){return this.withObjects(e,(e=>{const s=e.collidable!==t;return e.collidable=t,s}))}setObjectsCulled(e,t){return this.withObjects(e,(e=>{const s=e.culled!==t;return e.culled=t,s}))}setObjectsSelected(e,t){return this.withObjects(e,(e=>{const s=e.selected!==t;return e.selected=t,s}))}setObjectsHighlighted(e,t){return this.withObjects(e,(e=>{const s=e.highlighted!==t;return e.highlighted=t,s}))}setObjectsXRayed(e,t){return this.withObjects(e,(e=>{const s=e.xrayed!==t;return e.xrayed=t,s}))}setObjectsEdges(e,t){return this.withObjects(e,(e=>{const s=e.edges!==t;return e.edges=t,s}))}setObjectsColorized(e,t){return this.withObjects(e,(e=>{e.colorize=t}))}setObjectsOpacity(e,t){return this.withObjects(e,(e=>{const s=e.opacity!==t;return e.opacity=t,s}))}setObjectsPickable(e,t){return this.withObjects(e,(e=>{const s=e.pickable!==t;return e.pickable=t,s}))}setObjectsOffset(e,t){this.withObjects(e,(e=>{e.offset=t}))}withObjects(e,t){y.isString(e)&&(e=[e]);let s=!1;for(let i=0,r=e.length;i<r;i++){const r=e[i];let o=this.objects[r];if(o)s=t(o)||s;else{const e=this.modelIds;for(let i=0,n=e.length;i<n;i++){const n=e[i],a=p.globalizeObjectId(n,r);o=this.objects[a],o&&(s=t(o)||s)}}}return s}destroy(){super.destroy();for(const e in this.components)this.components.hasOwnProperty(e)&&this.components[e].destroy();this.canvas.gl=null,this.components=null,this.models=null,this.objects=null,this.visibleObjects=null,this.xrayedObjects=null,this.highlightedObjects=null,this.selectedObjects=null,this.colorizedObjects=null,this.opacityObjects=null,this.sectionPlanes=null,this.lights=null,this.lightMaps=null,this.reflectionMaps=null,this._objectIds=null,this._visibleObjectIds=null,this._xrayedObjectIds=null,this._highlightedObjectIds=null,this._selectedObjectIds=null,this._colorizedObjectIds=null,this.types=null,this.components=null,this.canvas=null,this._renderer=null,this.input=null,this._viewport=null,this._camera=null}}const zi=1e3,Wi=1001,Xi=1002,Yi=1003,Ki=1004,Ji=1004,Zi=1005,Qi=1005,qi=1006,$i=1007,er=1007,tr=1008,sr=1008,ir=1009,rr=1010,or=1011,nr=1012,ar=1013,hr=1014,lr=1015,ur=1016,cr=1017,pr=1018,dr=1020,mr=1021,fr=1022,gr=1023,_r=1024,yr=1025,vr=1026,br=1027,xr=1028,Pr=1029,Tr=1030,wr=1031,Mr=1033,Ir=33776,Cr=33777,Dr=33778,Ar=33779,Er=35840,Fr=35841,Rr=35842,Sr=35843,Or=36196,Br=37492,Lr=37496,Nr=37808,kr=37809,jr=37810,Gr=37811,Hr=37812,Vr=37813,Ur=37814,zr=37815,Wr=37816,Xr=37817,Yr=37818,Kr=37819,Jr=37820,Zr=37821,Qr=36492,qr=3e3,$r=3001,eo=1e4,to=10001,so=10002,io=10003,ro=function(e){"LambertMaterial"===e._material._state.type?(this.vertex=function(e){const t=e.scene,s=e.scene._sectionPlanesState,i=e.scene._lightsState,r=e._geometry._state,o=e._state.billboard,n=e._state.stationary,a=s.sectionPlanes.length>0,h=!!r.compressGeometry,l=[];l.push("#version 300 es"),l.push("// Lambertian drawing vertex shader"),l.push("in vec3 position;"),l.push("uniform mat4 modelMatrix;"),l.push("uniform mat4 viewMatrix;"),l.push("uniform mat4 projMatrix;"),l.push("uniform vec4 colorize;"),l.push("uniform vec3 offset;"),h&&l.push("uniform mat4 positionsDecodeMatrix;");t.logarithmicDepthBufferEnabled&&(l.push("uniform float logDepthBufFC;"),l.push("out float vFragDepth;"),l.push("bool isPerspectiveMatrix(mat4 m) {"),l.push("    return (m[2][3] == - 1.0);"),l.push("}"),l.push("out float isPerspective;"));a&&l.push("out vec4 vWorldPosition;");if(l.push("uniform vec4 lightAmbient;"),l.push("uniform vec4 materialColor;"),l.push("uniform vec3 materialEmissive;"),r.normalsBuf){l.push("in vec3 normal;"),l.push("uniform mat4 modelNormalMatrix;"),l.push("uniform mat4 viewNormalMatrix;");for(let e=0,t=i.lights.length;e<t;e++){const t=i.lights[e];"ambient"!==t.type&&(l.push("uniform vec4 lightColor"+e+";"),"dir"===t.type&&l.push("uniform vec3 lightDir"+e+";"),"point"===t.type&&l.push("uniform vec3 lightPos"+e+";"),"spot"===t.type&&(l.push("uniform vec3 lightPos"+e+";"),l.push("uniform vec3 lightDir"+e+";")))}h&&(l.push("vec3 octDecode(vec2 oct) {"),l.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),l.push("    if (v.z < 0.0) {"),l.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),l.push("    }"),l.push("    return normalize(v);"),l.push("}"))}l.push("out vec4 vColor;"),"points"===r.primitiveName&&l.push("uniform float pointSize;");"spherical"!==o&&"cylindrical"!==o||(l.push("void billboard(inout mat4 mat) {"),l.push("   mat[0][0] = 1.0;"),l.push("   mat[0][1] = 0.0;"),l.push("   mat[0][2] = 0.0;"),"spherical"===o&&(l.push("   mat[1][0] = 0.0;"),l.push("   mat[1][1] = 1.0;"),l.push("   mat[1][2] = 0.0;")),l.push("   mat[2][0] = 0.0;"),l.push("   mat[2][1] = 0.0;"),l.push("   mat[2][2] =1.0;"),l.push("}"));l.push("void main(void) {"),l.push("vec4 localPosition = vec4(position, 1.0); "),l.push("vec4 worldPosition;"),h&&l.push("localPosition = positionsDecodeMatrix * localPosition;");r.normalsBuf&&(h?l.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):l.push("vec4 localNormal = vec4(normal, 0.0); "),l.push("mat4 modelNormalMatrix2 = modelNormalMatrix;"),l.push("mat4 viewNormalMatrix2 = viewNormalMatrix;"));l.push("mat4 viewMatrix2 = viewMatrix;"),l.push("mat4 modelMatrix2 = modelMatrix;"),n&&l.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===o||"cylindrical"===o?(l.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),l.push("billboard(modelMatrix2);"),l.push("billboard(viewMatrix2);"),l.push("billboard(modelViewMatrix);"),r.normalsBuf&&(l.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),l.push("billboard(modelNormalMatrix2);"),l.push("billboard(viewNormalMatrix2);"),l.push("billboard(modelViewNormalMatrix);")),l.push("worldPosition = modelMatrix2 * localPosition;"),l.push("worldPosition.xyz = worldPosition.xyz + offset;"),l.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(l.push("worldPosition = modelMatrix2 * localPosition;"),l.push("worldPosition.xyz = worldPosition.xyz + offset;"),l.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));r.normalsBuf&&l.push("vec3 viewNormal = normalize((viewNormalMatrix2 * modelNormalMatrix2 * localNormal).xyz);");if(l.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),l.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),l.push("float lambertian = 1.0;"),r.normalsBuf)for(let e=0,t=i.lights.length;e<t;e++){const t=i.lights[e];if("ambient"!==t.type){if("dir"===t.type)"view"===t.space?l.push("viewLightDir = normalize(lightDir"+e+");"):l.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===t.type)"view"===t.space?l.push("viewLightDir = -normalize(lightPos"+e+" - viewPosition.xyz);"):l.push("viewLightDir = -normalize((viewMatrix2 * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==t.type)continue;"view"===t.space?l.push("viewLightDir = normalize(lightDir"+e+");"):l.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+e+", 0.0)).xyz);")}l.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),l.push("reflectedColor += lambertian * (lightColor"+e+".rgb * lightColor"+e+".a);")}}l.push("vColor = vec4((lightAmbient.rgb * lightAmbient.a * materialColor.rgb) + materialEmissive.rgb + (reflectedColor * materialColor.rgb), materialColor.a) * colorize;"),a&&l.push("vWorldPosition = worldPosition;");"points"===r.primitiveName&&l.push("gl_PointSize = pointSize;");l.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(l.push("vFragDepth = 1.0 + clipPos.w;"),l.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return l.push("gl_Position = clipPos;"),l.push("}"),l}(e),this.fragment=function(e){const t=e.scene,s=t._sectionPlanesState;e._material._state;const i=e._geometry._state,r=s.sectionPlanes.length>0,o=t.gammaOutput,n=[];n.push("#version 300 es"),n.push("// Lambertian drawing fragment shader"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),t.logarithmicDepthBufferEnabled&&(n.push("in float isPerspective;"),n.push("uniform float logDepthBufFC;"),n.push("in float vFragDepth;"));if(r){n.push("in vec4 vWorldPosition;"),n.push("uniform bool clippable;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)n.push("uniform bool sectionPlaneActive"+e+";"),n.push("uniform vec3 sectionPlanePos"+e+";"),n.push("uniform vec3 sectionPlaneDir"+e+";")}n.push("in vec4 vColor;"),o&&(n.push("uniform float gammaFactor;"),n.push("    vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),n.push("    return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),n.push("}"));if(n.push("out vec4 outColor;"),n.push("void main(void) {"),r){n.push("if (clippable) {"),n.push("  float dist = 0.0;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)n.push("if (sectionPlaneActive"+e+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),n.push("}");n.push("  if (dist > 0.0) { discard; }"),n.push("}")}"points"===i.primitiveName&&(n.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),n.push("float r = dot(cxy, cxy);"),n.push("if (r > 1.0) {"),n.push("   discard;"),n.push("}"));t.logarithmicDepthBufferEnabled&&n.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");o?n.push("outColor = linearToGamma(vColor, gammaFactor);"):n.push("outColor = vColor;");return n.push("}"),n}(e)):(this.vertex=function(e){const t=e.scene;e._material;const s=e._state,i=t._sectionPlanesState,r=e._geometry._state,o=t._lightsState;let n;const a=s.billboard,h=s.background,l=s.stationary,u=function(e){if(!e._geometry._state.uvBuf)return!1;const t=e._material;return!!(t._ambientMap||t._occlusionMap||t._baseColorMap||t._diffuseMap||t._alphaMap||t._specularMap||t._glossinessMap||t._specularGlossinessMap||t._emissiveMap||t._metallicMap||t._roughnessMap||t._metallicRoughnessMap||t._reflectivityMap||t._normalMap)}(e),c=ao(e),p=i.sectionPlanes.length>0,d=no(e),m=!!r.compressGeometry,f=[];f.push("#version 300 es"),f.push("// Drawing vertex shader"),f.push("in  vec3 position;"),m&&f.push("uniform mat4 positionsDecodeMatrix;");f.push("uniform  mat4 modelMatrix;"),f.push("uniform  mat4 viewMatrix;"),f.push("uniform  mat4 projMatrix;"),f.push("out  vec3 vViewPosition;"),f.push("uniform  vec3 offset;"),p&&f.push("out vec4 vWorldPosition;");t.logarithmicDepthBufferEnabled&&(f.push("uniform float logDepthBufFC;"),f.push("out float vFragDepth;"),f.push("bool isPerspectiveMatrix(mat4 m) {"),f.push("    return (m[2][3] == - 1.0);"),f.push("}"),f.push("out float isPerspective;"));o.lightMaps.length>0&&f.push("out    vec3 vWorldNormal;");if(c){f.push("in  vec3 normal;"),f.push("uniform    mat4 modelNormalMatrix;"),f.push("uniform    mat4 viewNormalMatrix;"),f.push("out    vec3 vViewNormal;");for(let e=0,t=o.lights.length;e<t;e++)n=o.lights[e],"ambient"!==n.type&&("dir"===n.type&&f.push("uniform vec3 lightDir"+e+";"),"point"===n.type&&f.push("uniform vec3 lightPos"+e+";"),"spot"===n.type&&(f.push("uniform vec3 lightPos"+e+";"),f.push("uniform vec3 lightDir"+e+";")),"dir"===n.type&&"view"===n.space||f.push("out vec4 vViewLightReverseDirAndDist"+e+";"));m&&(f.push("vec3 octDecode(vec2 oct) {"),f.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),f.push("    if (v.z < 0.0) {"),f.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),f.push("    }"),f.push("    return normalize(v);"),f.push("}"))}u&&(f.push("in vec2 uv;"),f.push("out vec2 vUV;"),m&&f.push("uniform mat3 uvDecodeMatrix;"));r.colors&&(f.push("in vec4 color;"),f.push("out vec4 vColor;"));"points"===r.primitiveName&&f.push("uniform float pointSize;");"spherical"!==a&&"cylindrical"!==a||(f.push("void billboard(inout mat4 mat) {"),f.push("   mat[0][0] = 1.0;"),f.push("   mat[0][1] = 0.0;"),f.push("   mat[0][2] = 0.0;"),"spherical"===a&&(f.push("   mat[1][0] = 0.0;"),f.push("   mat[1][1] = 1.0;"),f.push("   mat[1][2] = 0.0;")),f.push("   mat[2][0] = 0.0;"),f.push("   mat[2][1] = 0.0;"),f.push("   mat[2][2] =1.0;"),f.push("}"));if(d){f.push("const mat4 texUnitConverter = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);");for(let e=0,t=o.lights.length;e<t;e++)o.lights[e].castsShadow&&(f.push("uniform mat4 shadowViewMatrix"+e+";"),f.push("uniform mat4 shadowProjMatrix"+e+";"),f.push("out vec4 vShadowPosFromLight"+e+";"))}f.push("void main(void) {"),f.push("vec4 localPosition = vec4(position, 1.0); "),f.push("vec4 worldPosition;"),m&&f.push("localPosition = positionsDecodeMatrix * localPosition;");c&&(m?f.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):f.push("vec4 localNormal = vec4(normal, 0.0); "),f.push("mat4 modelNormalMatrix2    = modelNormalMatrix;"),f.push("mat4 viewNormalMatrix2     = viewNormalMatrix;"));f.push("mat4 viewMatrix2           = viewMatrix;"),f.push("mat4 modelMatrix2          = modelMatrix;"),l?f.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;"):h&&f.push("viewMatrix2[3] = vec4(0.0, 0.0, 0.0 ,1.0);");"spherical"===a||"cylindrical"===a?(f.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),f.push("billboard(modelMatrix2);"),f.push("billboard(viewMatrix2);"),f.push("billboard(modelViewMatrix);"),c&&(f.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),f.push("billboard(modelNormalMatrix2);"),f.push("billboard(viewNormalMatrix2);"),f.push("billboard(modelViewNormalMatrix);")),f.push("worldPosition = modelMatrix2 * localPosition;"),f.push("worldPosition.xyz = worldPosition.xyz + offset;"),f.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(f.push("worldPosition = modelMatrix2 * localPosition;"),f.push("worldPosition.xyz = worldPosition.xyz + offset;"),f.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));if(c){f.push("vec3 worldNormal = (modelNormalMatrix2 * localNormal).xyz; "),o.lightMaps.length>0&&f.push("vWorldNormal = worldNormal;"),f.push("vViewNormal = normalize((viewNormalMatrix2 * vec4(worldNormal, 1.0)).xyz);"),f.push("vec3 tmpVec3;"),f.push("float lightDist;");for(let e=0,t=o.lights.length;e<t;e++)n=o.lights[e],"ambient"!==n.type&&("dir"===n.type&&"world"===n.space&&(f.push("tmpVec3 = vec3(viewMatrix2 * vec4(lightDir"+e+", 0.0) ).xyz;"),f.push("vViewLightReverseDirAndDist"+e+" = vec4(-tmpVec3, 0.0);")),"point"===n.type&&("world"===n.space?(f.push("tmpVec3 = (viewMatrix2 * vec4(lightPos"+e+", 1.0)).xyz - viewPosition.xyz;"),f.push("lightDist = abs(length(tmpVec3));")):(f.push("tmpVec3 = lightPos"+e+".xyz - viewPosition.xyz;"),f.push("lightDist = abs(length(tmpVec3));")),f.push("vViewLightReverseDirAndDist"+e+" = vec4(tmpVec3, lightDist);")))}u&&(m?f.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"):f.push("vUV = uv;"));r.colors&&f.push("vColor = color;");"points"===r.primitiveName&&f.push("gl_PointSize = pointSize;");p&&f.push("vWorldPosition = worldPosition;");f.push("   vViewPosition = viewPosition.xyz;"),f.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(f.push("vFragDepth = 1.0 + clipPos.w;"),f.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));h&&f.push("clipPos.z = clipPos.w;");if(f.push("gl_Position = clipPos;"),d){f.push("const mat4 texUnitConverter = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);"),f.push("vec4 tempx; ");for(let e=0,t=o.lights.length;e<t;e++)o.lights[e].castsShadow&&f.push("vShadowPosFromLight"+e+" = texUnitConverter * shadowProjMatrix"+e+" * (shadowViewMatrix"+e+" * worldPosition); ")}return f.push("}"),f}(e),this.fragment=function(e){const t=e.scene;t.canvas.gl;const s=e._material,i=e._geometry._state,r=e.scene._sectionPlanesState,o=e.scene._lightsState,n=e._material._state,a=r.sectionPlanes.length>0,h=ao(e),l=i.uvBuf,u="PhongMaterial"===n.type,c="MetallicMaterial"===n.type,p="SpecularMaterial"===n.type,d=no(e);t.gammaInput;const m=t.gammaOutput,f=[];f.push("#version 300 es"),f.push("// Drawing fragment shader"),f.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),f.push("precision highp float;"),f.push("precision highp int;"),f.push("#else"),f.push("precision mediump float;"),f.push("precision mediump int;"),f.push("#endif"),t.logarithmicDepthBufferEnabled&&(f.push("in float isPerspective;"),f.push("uniform float logDepthBufFC;"),f.push("in float vFragDepth;"));d&&(f.push("float unpackDepth (vec4 color) {"),f.push("  const vec4 bitShift = vec4(1.0, 1.0/256.0, 1.0/(256.0 * 256.0), 1.0/(256.0*256.0*256.0));"),f.push("  return dot(color, bitShift);"),f.push("}"));f.push("uniform float gammaFactor;"),f.push("vec4 linearToLinear( in vec4 value ) {"),f.push("  return value;"),f.push("}"),f.push("vec4 sRGBToLinear( in vec4 value ) {"),f.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),f.push("}"),f.push("vec4 gammaToLinear( in vec4 value) {"),f.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),f.push("}"),m&&(f.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),f.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),f.push("}"));if(a){f.push("in vec4 vWorldPosition;"),f.push("uniform bool clippable;");for(var g=0;g<r.sectionPlanes.length;g++)f.push("uniform bool sectionPlaneActive"+g+";"),f.push("uniform vec3 sectionPlanePos"+g+";"),f.push("uniform vec3 sectionPlaneDir"+g+";")}h&&(o.lightMaps.length>0&&(f.push("uniform samplerCube lightMap;"),f.push("uniform mat4 viewNormalMatrix;")),o.reflectionMaps.length>0&&f.push("uniform samplerCube reflectionMap;"),(o.lightMaps.length>0||o.reflectionMaps.length>0)&&f.push("uniform mat4 viewMatrix;"),f.push("#define PI 3.14159265359"),f.push("#define RECIPROCAL_PI 0.31830988618"),f.push("#define RECIPROCAL_PI2 0.15915494"),f.push("#define EPSILON 1e-6"),f.push("#define saturate(a) clamp( a, 0.0, 1.0 )"),f.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),f.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),f.push("}"),f.push("struct IncidentLight {"),f.push("   vec3 color;"),f.push("   vec3 direction;"),f.push("};"),f.push("struct ReflectedLight {"),f.push("   vec3 diffuse;"),f.push("   vec3 specular;"),f.push("};"),f.push("struct Geometry {"),f.push("   vec3 position;"),f.push("   vec3 viewNormal;"),f.push("   vec3 worldNormal;"),f.push("   vec3 viewEyeDir;"),f.push("};"),f.push("struct Material {"),f.push("   vec3    diffuseColor;"),f.push("   float   specularRoughness;"),f.push("   vec3    specularColor;"),f.push("   float   shine;"),f.push("};"),u&&((o.lightMaps.length>0||o.reflectionMaps.length>0)&&(f.push("void computePhongLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),o.lightMaps.length>0&&(f.push("   vec3 irradiance = "+oo[o.lightMaps[0].encoding]+"(texture(lightMap, geometry.worldNormal)).rgb;"),f.push("   irradiance *= PI;"),f.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),f.push("   reflectedLight.diffuse += irradiance * diffuseBRDFContrib;")),o.reflectionMaps.length>0&&(f.push("   vec3 reflectVec             = reflect(-geometry.viewEyeDir, geometry.viewNormal);"),f.push("   vec3 radiance               = texture(reflectionMap, reflectVec).rgb * 0.2;"),f.push("   radiance *= PI;"),f.push("   reflectedLight.specular     += radiance;")),f.push("}")),f.push("void computePhongLighting(const in IncidentLight directLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),f.push("   float dotNL     = saturate(dot(geometry.viewNormal, directLight.direction));"),f.push("   vec3 irradiance = dotNL * directLight.color * PI;"),f.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),f.push("   reflectedLight.specular += directLight.color * material.specularColor * pow(max(dot(reflect(-directLight.direction, -geometry.viewNormal), geometry.viewEyeDir), 0.0), material.shine);"),f.push("}")),(c||p)&&(f.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),f.push("   float r = ggxRoughness + 0.0001;"),f.push("   return (2.0 / (r * r) - 2.0);"),f.push("}"),f.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {"),f.push("   float maxMIPLevelScalar = float( maxMIPLevel );"),f.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );"),f.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );"),f.push("}"),o.reflectionMaps.length>0&&(f.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),f.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),f.push("   vec3 envMapColor = "+oo[o.reflectionMaps[0].encoding]+"(texture(reflectionMap, reflectVec, mipLevel)).rgb;"),f.push("  return envMapColor;"),f.push("}")),f.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),f.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),f.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),f.push("}"),f.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),f.push("   float a2 = ( alpha * alpha );"),f.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),f.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),f.push("   return 1.0 / ( gl * gv );"),f.push("}"),f.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),f.push("   float a2 = ( alpha * alpha );"),f.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),f.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),f.push("   return 0.5 / max( gv + gl, EPSILON );"),f.push("}"),f.push("float D_GGX(const in float alpha, const in float dotNH) {"),f.push("   float a2 = ( alpha * alpha );"),f.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),f.push("   return RECIPROCAL_PI * a2 / ( denom * denom);"),f.push("}"),f.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),f.push("   float alpha = ( roughness * roughness );"),f.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),f.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),f.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),f.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),f.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),f.push("   vec3  F = F_Schlick( specularColor, dotLH );"),f.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),f.push("   float D = D_GGX( alpha, dotNH );"),f.push("   return F * (G * D);"),f.push("}"),f.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),f.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),f.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),f.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),f.push("   vec4 r = roughness * c0 + c1;"),f.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),f.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),f.push("   return specularColor * AB.x + AB.y;"),f.push("}"),(o.lightMaps.length>0||o.reflectionMaps.length>0)&&(f.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),o.lightMaps.length>0&&(f.push("   vec3 irradiance = sRGBToLinear(texture(lightMap, geometry.worldNormal)).rgb;"),f.push("   irradiance *= PI;"),f.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),f.push("   reflectedLight.diffuse += irradiance * diffuseBRDFContrib;")),o.reflectionMaps.length>0&&(f.push("   vec3 reflectVec             = reflect(-geometry.viewEyeDir, geometry.viewNormal);"),f.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),f.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),f.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),f.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),f.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),f.push("}")),f.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),f.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),f.push("   vec3 irradiance = dotNL * incidentLight.color * PI;"),f.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),f.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),f.push("}")));f.push("in vec3 vViewPosition;"),i.colors&&f.push("in vec4 vColor;");l&&(h&&s._normalMap||s._ambientMap||s._baseColorMap||s._diffuseMap||s._emissiveMap||s._metallicMap||s._roughnessMap||s._metallicRoughnessMap||s._specularMap||s._glossinessMap||s._specularGlossinessMap||s._occlusionMap||s._alphaMap)&&f.push("in vec2 vUV;");h&&(o.lightMaps.length>0&&f.push("in vec3 vWorldNormal;"),f.push("in vec3 vViewNormal;"));n.ambient&&f.push("uniform vec3 materialAmbient;");n.baseColor&&f.push("uniform vec3 materialBaseColor;");void 0!==n.alpha&&null!==n.alpha&&f.push("uniform vec4 materialAlphaModeCutoff;");n.emissive&&f.push("uniform vec3 materialEmissive;");n.diffuse&&f.push("uniform vec3 materialDiffuse;");void 0!==n.glossiness&&null!==n.glossiness&&f.push("uniform float materialGlossiness;");void 0!==n.shininess&&null!==n.shininess&&f.push("uniform float materialShininess;");n.specular&&f.push("uniform vec3 materialSpecular;");void 0!==n.metallic&&null!==n.metallic&&f.push("uniform float materialMetallic;");void 0!==n.roughness&&null!==n.roughness&&f.push("uniform float materialRoughness;");void 0!==n.specularF0&&null!==n.specularF0&&f.push("uniform float materialSpecularF0;");l&&s._ambientMap&&(f.push("uniform sampler2D ambientMap;"),s._ambientMap._state.matrix&&f.push("uniform mat4 ambientMapMatrix;"));l&&s._baseColorMap&&(f.push("uniform sampler2D baseColorMap;"),s._baseColorMap._state.matrix&&f.push("uniform mat4 baseColorMapMatrix;"));l&&s._diffuseMap&&(f.push("uniform sampler2D diffuseMap;"),s._diffuseMap._state.matrix&&f.push("uniform mat4 diffuseMapMatrix;"));l&&s._emissiveMap&&(f.push("uniform sampler2D emissiveMap;"),s._emissiveMap._state.matrix&&f.push("uniform mat4 emissiveMapMatrix;"));h&&l&&s._metallicMap&&(f.push("uniform sampler2D metallicMap;"),s._metallicMap._state.matrix&&f.push("uniform mat4 metallicMapMatrix;"));h&&l&&s._roughnessMap&&(f.push("uniform sampler2D roughnessMap;"),s._roughnessMap._state.matrix&&f.push("uniform mat4 roughnessMapMatrix;"));h&&l&&s._metallicRoughnessMap&&(f.push("uniform sampler2D metallicRoughnessMap;"),s._metallicRoughnessMap._state.matrix&&f.push("uniform mat4 metallicRoughnessMapMatrix;"));h&&s._normalMap&&(f.push("uniform sampler2D normalMap;"),s._normalMap._state.matrix&&f.push("uniform mat4 normalMapMatrix;"),f.push("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),f.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),f.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),f.push("      vec2 st0 = dFdx( uv.st );"),f.push("      vec2 st1 = dFdy( uv.st );"),f.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),f.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),f.push("      vec3 N = normalize( surf_norm );"),f.push("      vec3 mapN = texture( normalMap, uv ).xyz * 2.0 - 1.0;"),f.push("      mat3 tsn = mat3( S, T, N );"),f.push("      return normalize( tsn * mapN );"),f.push("}"));l&&s._occlusionMap&&(f.push("uniform sampler2D occlusionMap;"),s._occlusionMap._state.matrix&&f.push("uniform mat4 occlusionMapMatrix;"));l&&s._alphaMap&&(f.push("uniform sampler2D alphaMap;"),s._alphaMap._state.matrix&&f.push("uniform mat4 alphaMapMatrix;"));h&&l&&s._specularMap&&(f.push("uniform sampler2D specularMap;"),s._specularMap._state.matrix&&f.push("uniform mat4 specularMapMatrix;"));h&&l&&s._glossinessMap&&(f.push("uniform sampler2D glossinessMap;"),s._glossinessMap._state.matrix&&f.push("uniform mat4 glossinessMapMatrix;"));h&&l&&s._specularGlossinessMap&&(f.push("uniform sampler2D materialSpecularGlossinessMap;"),s._specularGlossinessMap._state.matrix&&f.push("uniform mat4 materialSpecularGlossinessMapMatrix;"));h&&(s._diffuseFresnel||s._specularFresnel||s._alphaFresnel||s._emissiveFresnel||s._reflectivityFresnel)&&(f.push("float fresnel(vec3 eyeDir, vec3 normal, float edgeBias, float centerBias, float power) {"),f.push("    float fr = abs(dot(eyeDir, normal));"),f.push("    float finalFr = clamp((fr - edgeBias) / (centerBias - edgeBias), 0.0, 1.0);"),f.push("    return pow(finalFr, power);"),f.push("}"),s._diffuseFresnel&&(f.push("uniform float  diffuseFresnelCenterBias;"),f.push("uniform float  diffuseFresnelEdgeBias;"),f.push("uniform float  diffuseFresnelPower;"),f.push("uniform vec3   diffuseFresnelCenterColor;"),f.push("uniform vec3   diffuseFresnelEdgeColor;")),s._specularFresnel&&(f.push("uniform float  specularFresnelCenterBias;"),f.push("uniform float  specularFresnelEdgeBias;"),f.push("uniform float  specularFresnelPower;"),f.push("uniform vec3   specularFresnelCenterColor;"),f.push("uniform vec3   specularFresnelEdgeColor;")),s._alphaFresnel&&(f.push("uniform float  alphaFresnelCenterBias;"),f.push("uniform float  alphaFresnelEdgeBias;"),f.push("uniform float  alphaFresnelPower;"),f.push("uniform vec3   alphaFresnelCenterColor;"),f.push("uniform vec3   alphaFresnelEdgeColor;")),s._reflectivityFresnel&&(f.push("uniform float  materialSpecularF0FresnelCenterBias;"),f.push("uniform float  materialSpecularF0FresnelEdgeBias;"),f.push("uniform float  materialSpecularF0FresnelPower;"),f.push("uniform vec3   materialSpecularF0FresnelCenterColor;"),f.push("uniform vec3   materialSpecularF0FresnelEdgeColor;")),s._emissiveFresnel&&(f.push("uniform float  emissiveFresnelCenterBias;"),f.push("uniform float  emissiveFresnelEdgeBias;"),f.push("uniform float  emissiveFresnelPower;"),f.push("uniform vec3   emissiveFresnelCenterColor;"),f.push("uniform vec3   emissiveFresnelEdgeColor;")));if(f.push("uniform vec4   lightAmbient;"),h)for(let e=0,t=o.lights.length;e<t;e++){const t=o.lights[e];"ambient"!==t.type&&(f.push("uniform vec4 lightColor"+e+";"),"point"===t.type&&f.push("uniform vec3 lightAttenuation"+e+";"),"dir"===t.type&&"view"===t.space&&f.push("uniform vec3 lightDir"+e+";"),"point"===t.type&&"view"===t.space?f.push("uniform vec3 lightPos"+e+";"):f.push("in vec4 vViewLightReverseDirAndDist"+e+";"))}if(d)for(let e=0,t=o.lights.length;e<t;e++)o.lights[e].castsShadow&&(f.push("in vec4 vShadowPosFromLight"+e+";"),f.push("uniform sampler2D shadowMap"+e+";"));if(f.push("uniform vec4 colorize;"),f.push("out vec4 outColor;"),f.push("void main(void) {"),a){f.push("if (clippable) {"),f.push("  float dist = 0.0;");for(g=0;g<r.sectionPlanes.length;g++)f.push("if (sectionPlaneActive"+g+") {"),f.push("   dist += clamp(dot(-sectionPlaneDir"+g+".xyz, vWorldPosition.xyz - sectionPlanePos"+g+".xyz), 0.0, 1000.0);"),f.push("}");f.push("  if (dist > 0.0) { discard; }"),f.push("}")}"points"===i.primitiveName&&(f.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),f.push("float r = dot(cxy, cxy);"),f.push("if (r > 1.0) {"),f.push("   discard;"),f.push("}"));f.push("float occlusion = 1.0;"),n.ambient?f.push("vec3 ambientColor = materialAmbient;"):f.push("vec3 ambientColor = vec3(1.0, 1.0, 1.0);");n.diffuse?f.push("vec3 diffuseColor = materialDiffuse;"):n.baseColor?f.push("vec3 diffuseColor = materialBaseColor;"):f.push("vec3 diffuseColor = vec3(1.0, 1.0, 1.0);");i.colors&&f.push("diffuseColor *= vColor.rgb;");n.emissive?f.push("vec3 emissiveColor = materialEmissive;"):f.push("vec3  emissiveColor = vec3(0.0, 0.0, 0.0);");n.specular?f.push("vec3 specular = materialSpecular;"):f.push("vec3 specular = vec3(1.0, 1.0, 1.0);");void 0!==n.alpha?f.push("float alpha = materialAlphaModeCutoff[0];"):f.push("float alpha = 1.0;");i.colors&&f.push("alpha *= vColor.a;");void 0!==n.glossiness?f.push("float glossiness = materialGlossiness;"):f.push("float glossiness = 1.0;");void 0!==n.metallic?f.push("float metallic = materialMetallic;"):f.push("float metallic = 1.0;");void 0!==n.roughness?f.push("float roughness = materialRoughness;"):f.push("float roughness = 1.0;");void 0!==n.specularF0?f.push("float specularF0 = materialSpecularF0;"):f.push("float specularF0 = 1.0;");l&&(h&&s._normalMap||s._ambientMap||s._baseColorMap||s._diffuseMap||s._occlusionMap||s._emissiveMap||s._metallicMap||s._roughnessMap||s._metallicRoughnessMap||s._specularMap||s._glossinessMap||s._specularGlossinessMap||s._alphaMap)&&(f.push("vec4 texturePos = vec4(vUV.s, vUV.t, 1.0, 1.0);"),f.push("vec2 textureCoord;"));l&&s._ambientMap&&(s._ambientMap._state.matrix?f.push("textureCoord = (ambientMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 ambientTexel = texture(ambientMap, textureCoord).rgb;"),f.push("ambientTexel = "+oo[s._ambientMap._state.encoding]+"(ambientTexel);"),f.push("ambientColor *= ambientTexel.rgb;"));l&&s._diffuseMap&&(s._diffuseMap._state.matrix?f.push("textureCoord = (diffuseMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 diffuseTexel = texture(diffuseMap, textureCoord);"),f.push("diffuseTexel = "+oo[s._diffuseMap._state.encoding]+"(diffuseTexel);"),f.push("diffuseColor *= diffuseTexel.rgb;"),f.push("alpha *= diffuseTexel.a;"));l&&s._baseColorMap&&(s._baseColorMap._state.matrix?f.push("textureCoord = (baseColorMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 baseColorTexel = texture(baseColorMap, textureCoord);"),f.push("baseColorTexel = "+oo[s._baseColorMap._state.encoding]+"(baseColorTexel);"),f.push("diffuseColor *= baseColorTexel.rgb;"),f.push("alpha *= baseColorTexel.a;"));l&&s._emissiveMap&&(s._emissiveMap._state.matrix?f.push("textureCoord = (emissiveMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 emissiveTexel = texture(emissiveMap, textureCoord);"),f.push("emissiveTexel = "+oo[s._emissiveMap._state.encoding]+"(emissiveTexel);"),f.push("emissiveColor = emissiveTexel.rgb;"));l&&s._alphaMap&&(s._alphaMap._state.matrix?f.push("textureCoord = (alphaMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("alpha *= texture(alphaMap, textureCoord).r;"));l&&s._occlusionMap&&(s._occlusionMap._state.matrix?f.push("textureCoord = (occlusionMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("occlusion *= texture(occlusionMap, textureCoord).r;"));if(h&&(o.lights.length>0||o.lightMaps.length>0||o.reflectionMaps.length>0)){l&&s._normalMap?(s._normalMap._state.matrix?f.push("textureCoord = (normalMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec3 viewNormal = perturbNormal2Arb( vViewPosition, normalize(vViewNormal), textureCoord );")):f.push("vec3 viewNormal = normalize(vViewNormal);"),l&&s._specularMap&&(s._specularMap._state.matrix?f.push("textureCoord = (specularMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("specular *= texture(specularMap, textureCoord).rgb;")),l&&s._glossinessMap&&(s._glossinessMap._state.matrix?f.push("textureCoord = (glossinessMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("glossiness *= texture(glossinessMap, textureCoord).r;")),l&&s._specularGlossinessMap&&(s._specularGlossinessMap._state.matrix?f.push("textureCoord = (materialSpecularGlossinessMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 specGlossRGB = texture(materialSpecularGlossinessMap, textureCoord).rgba;"),f.push("specular *= specGlossRGB.rgb;"),f.push("glossiness *= specGlossRGB.a;")),l&&s._metallicMap&&(s._metallicMap._state.matrix?f.push("textureCoord = (metallicMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("metallic *= texture(metallicMap, textureCoord).r;")),l&&s._roughnessMap&&(s._roughnessMap._state.matrix?f.push("textureCoord = (roughnessMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("roughness *= texture(roughnessMap, textureCoord).r;")),l&&s._metallicRoughnessMap&&(s._metallicRoughnessMap._state.matrix?f.push("textureCoord = (metallicRoughnessMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec3 metalRoughRGB = texture(metallicRoughnessMap, textureCoord).rgb;"),f.push("metallic *= metalRoughRGB.b;"),f.push("roughness *= metalRoughRGB.g;")),f.push("vec3 viewEyeDir = normalize(-vViewPosition);"),s._diffuseFresnel&&(f.push("float diffuseFresnel = fresnel(viewEyeDir, viewNormal, diffuseFresnelEdgeBias, diffuseFresnelCenterBias, diffuseFresnelPower);"),f.push("diffuseColor *= mix(diffuseFresnelEdgeColor, diffuseFresnelCenterColor, diffuseFresnel);")),s._specularFresnel&&(f.push("float specularFresnel = fresnel(viewEyeDir, viewNormal, specularFresnelEdgeBias, specularFresnelCenterBias, specularFresnelPower);"),f.push("specular *= mix(specularFresnelEdgeColor, specularFresnelCenterColor, specularFresnel);")),s._alphaFresnel&&(f.push("float alphaFresnel = fresnel(viewEyeDir, viewNormal, alphaFresnelEdgeBias, alphaFresnelCenterBias, alphaFresnelPower);"),f.push("alpha *= mix(alphaFresnelEdgeColor.r, alphaFresnelCenterColor.r, alphaFresnel);")),s._emissiveFresnel&&(f.push("float emissiveFresnel = fresnel(viewEyeDir, viewNormal, emissiveFresnelEdgeBias, emissiveFresnelCenterBias, emissiveFresnelPower);"),f.push("emissiveColor *= mix(emissiveFresnelEdgeColor, emissiveFresnelCenterColor, emissiveFresnel);")),f.push("if (materialAlphaModeCutoff[1] == 1.0 && alpha < materialAlphaModeCutoff[2]) {"),f.push("   discard;"),f.push("}"),f.push("IncidentLight  light;"),f.push("Material       material;"),f.push("Geometry       geometry;"),f.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),f.push("vec3           viewLightDir;"),u&&(f.push("material.diffuseColor      = diffuseColor;"),f.push("material.specularColor     = specular;"),f.push("material.shine             = materialShininess;")),p&&(f.push("float oneMinusSpecularStrength = 1.0 - max(max(specular.r, specular.g ),specular.b);"),f.push("material.diffuseColor      = diffuseColor * oneMinusSpecularStrength;"),f.push("material.specularRoughness = clamp( 1.0 - glossiness, 0.04, 1.0 );"),f.push("material.specularColor     = specular;")),c&&(f.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),f.push("material.diffuseColor      = diffuseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),f.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),f.push("material.specularColor     = mix(vec3(dielectricSpecular), diffuseColor, metallic);")),f.push("geometry.position      = vViewPosition;"),o.lightMaps.length>0&&f.push("geometry.worldNormal   = normalize(vWorldNormal);"),f.push("geometry.viewNormal    = viewNormal;"),f.push("geometry.viewEyeDir    = viewEyeDir;"),u&&(o.lightMaps.length>0||o.reflectionMaps.length>0)&&f.push("computePhongLightMapping(geometry, material, reflectedLight);"),(p||c)&&(o.lightMaps.length>0||o.reflectionMaps.length>0)&&f.push("computePBRLightMapping(geometry, material, reflectedLight);"),f.push("float shadow = 1.0;"),f.push("float shadowAcneRemover = 0.007;"),f.push("vec3 fragmentDepth;"),f.push("float texelSize = 1.0 / 1024.0;"),f.push("float amountInLight = 0.0;"),f.push("vec3 shadowCoord;"),f.push("vec4 rgbaDepth;"),f.push("float depth;");for(let e=0,t=o.lights.length;e<t;e++){const t=o.lights[e];"ambient"!==t.type&&("dir"===t.type&&"view"===t.space?f.push("viewLightDir = -normalize(lightDir"+e+");"):"point"===t.type&&"view"===t.space?f.push("viewLightDir = normalize(lightPos"+e+" - vViewPosition);"):f.push("viewLightDir = normalize(vViewLightReverseDirAndDist"+e+".xyz);"),d&&t.castsShadow?(f.push("shadow = 0.0;"),f.push("fragmentDepth = vShadowPosFromLight"+e+".xyz;"),f.push("fragmentDepth.z -= shadowAcneRemover;"),f.push("for (int x = -3; x <= 3; x++) {"),f.push("  for (int y = -3; y <= 3; y++) {"),f.push("      float texelDepth = unpackDepth(texture(shadowMap"+e+", fragmentDepth.xy + vec2(x, y) * texelSize));"),f.push("      if (fragmentDepth.z < texelDepth) {"),f.push("          shadow += 1.0;"),f.push("      }"),f.push("  }"),f.push("}"),f.push("shadow = shadow / 9.0;"),f.push("light.color =  lightColor"+e+".rgb * (lightColor"+e+".a * shadow);")):f.push("light.color =  lightColor"+e+".rgb * (lightColor"+e+".a );"),f.push("light.direction = viewLightDir;"),u&&f.push("computePhongLighting(light, geometry, material, reflectedLight);"),(p||c)&&f.push("computePBRLighting(light, geometry, material, reflectedLight);"))}u?f.push("vec3 outgoingLight = (lightAmbient.rgb * lightAmbient.a * diffuseColor) + ((occlusion * (( reflectedLight.diffuse + reflectedLight.specular)))) + emissiveColor;"):f.push("vec3 outgoingLight = (occlusion * (reflectedLight.diffuse)) + (occlusion * reflectedLight.specular) + emissiveColor;")}else f.push("ambientColor *= (lightAmbient.rgb * lightAmbient.a);"),f.push("vec3 outgoingLight = emissiveColor + ambientColor;");f.push("vec4 fragColor = vec4(outgoingLight, alpha) * colorize;"),m&&f.push("fragColor = linearToGamma(fragColor, gammaFactor);");f.push("outColor = fragColor;"),t.logarithmicDepthBufferEnabled&&f.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");return f.push("}"),f}(e))},oo={};function no(e){if(!e.receivesShadow)return!1;const t=e.scene._lightsState.lights;if(!t||0===t.length)return!1;for(let e=0,s=t.length;e<s;e++)if(t[e].castsShadow)return!0;return!1}function ao(e){const t=e._geometry._state.primitiveName;return!(!e._geometry._state.autoVertexNormals&&!e._geometry._state.normalsBuf||"triangles"!==t&&"triangle-strip"!==t&&"triangle-fan"!==t)}oo[3e3]="linearToLinear",oo[3001]="sRGBToLinear";const ho=p.vec3(),lo=new e({}),uo=function(e,t){this.id=lo.addItem({}),this._hash=e,this._scene=t.scene,this._useCount=0,this._shaderSource=new ro(t),this._allocate(t)},co={};uo.get=function(e){const t=e.scene,s=[t.canvas.canvas.id,(t.gammaInput?"gi;":";")+(t.gammaOutput?"go":""),t._lightsState.getHash(),t._sectionPlanesState.getHash(),e._geometry._state.hash,e._material._state.hash,e._state.drawHash].join(";");let i=co[s];if(!i){if(i=new uo(s,e),i.errors)return console.log(i.errors.join("\n")),null;co[s]=i,m.memory.programs++}return i._useCount++,i},uo.prototype.put=function(){0==--this._useCount&&(lo.removeItem(this.id),this._program&&this._program.destroy(),delete co[this._hash],m.memory.programs--)},uo.prototype.webglContextRestored=function(){this._program=null},uo.prototype.drawMesh=function(e,t){this._program||this._allocate(t);const s=ce.MAX_TEXTURE_UNITS,i=t.scene,r=t._material,o=i.canvas.gl,n=this._program,a=t._state,h=t._material._state,l=t._geometry._state,u=i.camera,c=t.origin,p=a.background;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,p&&o.depthFunc(o.LEQUAL),this._bindProgram(e)),o.uniformMatrix4fv(this._uViewMatrix,!1,c?e.getRTCViewMatrix(a.originHash,c):u.viewMatrix),o.uniformMatrix4fv(this._uViewNormalMatrix,!1,u.viewNormalMatrix),a.clippable){const e=i._sectionPlanesState.sectionPlanes.length;if(e>0){const s=i._sectionPlanesState.sectionPlanes,r=t.renderFlags;for(let t=0;t<e;t++){const e=this._uSectionPlanes[t];if(e){const i=r.sectionPlanesActivePerLayer[t];if(o.uniform1i(e.active,i?1:0),i){const i=s[t];o.uniform3fv(e.pos,c?X(i.dist,i.dir,c,ho):i.pos),o.uniform3fv(e.dir,i.dir)}}}}}if(h.id!==this._lastMaterialId){e.textureUnit=this._baseTextureUnit;const t=h.backfaces;e.backfaces!==t&&(t?o.disable(o.CULL_FACE):o.enable(o.CULL_FACE),e.backfaces=t);const i=h.frontface;switch(e.frontface!==i&&(i?o.frontFace(o.CCW):o.frontFace(o.CW),e.frontface=i),e.lineWidth!==h.lineWidth&&(o.lineWidth(h.lineWidth),e.lineWidth=h.lineWidth),this._uPointSize&&o.uniform1f(this._uPointSize,h.pointSize),h.type){case"LambertMaterial":this._uMaterialAmbient&&o.uniform3fv(this._uMaterialAmbient,h.ambient),this._uMaterialColor&&o.uniform4f(this._uMaterialColor,h.color[0],h.color[1],h.color[2],h.alpha),this._uMaterialEmissive&&o.uniform3fv(this._uMaterialEmissive,h.emissive);break;case"PhongMaterial":this._uMaterialShininess&&o.uniform1f(this._uMaterialShininess,h.shininess),this._uMaterialAmbient&&o.uniform3fv(this._uMaterialAmbient,h.ambient),this._uMaterialDiffuse&&o.uniform3fv(this._uMaterialDiffuse,h.diffuse),this._uMaterialSpecular&&o.uniform3fv(this._uMaterialSpecular,h.specular),this._uMaterialEmissive&&o.uniform3fv(this._uMaterialEmissive,h.emissive),this._uAlphaModeCutoff&&o.uniform4f(this._uAlphaModeCutoff,1*h.alpha,1===h.alphaMode?1:0,h.alphaCutoff,0),r._ambientMap&&r._ambientMap._state.texture&&this._uMaterialAmbientMap&&(n.bindTexture(this._uMaterialAmbientMap,r._ambientMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uMaterialAmbientMapMatrix&&o.uniformMatrix4fv(this._uMaterialAmbientMapMatrix,!1,r._ambientMap._state.matrix)),r._diffuseMap&&r._diffuseMap._state.texture&&this._uDiffuseMap&&(n.bindTexture(this._uDiffuseMap,r._diffuseMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uDiffuseMapMatrix&&o.uniformMatrix4fv(this._uDiffuseMapMatrix,!1,r._diffuseMap._state.matrix)),r._specularMap&&r._specularMap._state.texture&&this._uSpecularMap&&(n.bindTexture(this._uSpecularMap,r._specularMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uSpecularMapMatrix&&o.uniformMatrix4fv(this._uSpecularMapMatrix,!1,r._specularMap._state.matrix)),r._emissiveMap&&r._emissiveMap._state.texture&&this._uEmissiveMap&&(n.bindTexture(this._uEmissiveMap,r._emissiveMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uEmissiveMapMatrix&&o.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,r._emissiveMap._state.matrix)),r._alphaMap&&r._alphaMap._state.texture&&this._uAlphaMap&&(n.bindTexture(this._uAlphaMap,r._alphaMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uAlphaMapMatrix&&o.uniformMatrix4fv(this._uAlphaMapMatrix,!1,r._alphaMap._state.matrix)),r._reflectivityMap&&r._reflectivityMap._state.texture&&this._uReflectivityMap&&(n.bindTexture(this._uReflectivityMap,r._reflectivityMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,this._uReflectivityMapMatrix&&o.uniformMatrix4fv(this._uReflectivityMapMatrix,!1,r._reflectivityMap._state.matrix)),r._normalMap&&r._normalMap._state.texture&&this._uNormalMap&&(n.bindTexture(this._uNormalMap,r._normalMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uNormalMapMatrix&&o.uniformMatrix4fv(this._uNormalMapMatrix,!1,r._normalMap._state.matrix)),r._occlusionMap&&r._occlusionMap._state.texture&&this._uOcclusionMap&&(n.bindTexture(this._uOcclusionMap,r._occlusionMap._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uOcclusionMapMatrix&&o.uniformMatrix4fv(this._uOcclusionMapMatrix,!1,r._occlusionMap._state.matrix)),r._diffuseFresnel&&(this._uDiffuseFresnelEdgeBias&&o.uniform1f(this._uDiffuseFresnelEdgeBias,r._diffuseFresnel.edgeBias),this._uDiffuseFresnelCenterBias&&o.uniform1f(this._uDiffuseFresnelCenterBias,r._diffuseFresnel.centerBias),this._uDiffuseFresnelEdgeColor&&o.uniform3fv(this._uDiffuseFresnelEdgeColor,r._diffuseFresnel.edgeColor),this._uDiffuseFresnelCenterColor&&o.uniform3fv(this._uDiffuseFresnelCenterColor,r._diffuseFresnel.centerColor),this._uDiffuseFresnelPower&&o.uniform1f(this._uDiffuseFresnelPower,r._diffuseFresnel.power)),r._specularFresnel&&(this._uSpecularFresnelEdgeBias&&o.uniform1f(this._uSpecularFresnelEdgeBias,r._specularFresnel.edgeBias),this._uSpecularFresnelCenterBias&&o.uniform1f(this._uSpecularFresnelCenterBias,r._specularFresnel.centerBias),this._uSpecularFresnelEdgeColor&&o.uniform3fv(this._uSpecularFresnelEdgeColor,r._specularFresnel.edgeColor),this._uSpecularFresnelCenterColor&&o.uniform3fv(this._uSpecularFresnelCenterColor,r._specularFresnel.centerColor),this._uSpecularFresnelPower&&o.uniform1f(this._uSpecularFresnelPower,r._specularFresnel.power)),r._alphaFresnel&&(this._uAlphaFresnelEdgeBias&&o.uniform1f(this._uAlphaFresnelEdgeBias,r._alphaFresnel.edgeBias),this._uAlphaFresnelCenterBias&&o.uniform1f(this._uAlphaFresnelCenterBias,r._alphaFresnel.centerBias),this._uAlphaFresnelEdgeColor&&o.uniform3fv(this._uAlphaFresnelEdgeColor,r._alphaFresnel.edgeColor),this._uAlphaFresnelCenterColor&&o.uniform3fv(this._uAlphaFresnelCenterColor,r._alphaFresnel.centerColor),this._uAlphaFresnelPower&&o.uniform1f(this._uAlphaFresnelPower,r._alphaFresnel.power)),r._reflectivityFresnel&&(this._uReflectivityFresnelEdgeBias&&o.uniform1f(this._uReflectivityFresnelEdgeBias,r._reflectivityFresnel.edgeBias),this._uReflectivityFresnelCenterBias&&o.uniform1f(this._uReflectivityFresnelCenterBias,r._reflectivityFresnel.centerBias),this._uReflectivityFresnelEdgeColor&&o.uniform3fv(this._uReflectivityFresnelEdgeColor,r._reflectivityFresnel.edgeColor),this._uReflectivityFresnelCenterColor&&o.uniform3fv(this._uReflectivityFresnelCenterColor,r._reflectivityFresnel.centerColor),this._uReflectivityFresnelPower&&o.uniform1f(this._uReflectivityFresnelPower,r._reflectivityFresnel.power)),r._emissiveFresnel&&(this._uEmissiveFresnelEdgeBias&&o.uniform1f(this._uEmissiveFresnelEdgeBias,r._emissiveFresnel.edgeBias),this._uEmissiveFresnelCenterBias&&o.uniform1f(this._uEmissiveFresnelCenterBias,r._emissiveFresnel.centerBias),this._uEmissiveFresnelEdgeColor&&o.uniform3fv(this._uEmissiveFresnelEdgeColor,r._emissiveFresnel.edgeColor),this._uEmissiveFresnelCenterColor&&o.uniform3fv(this._uEmissiveFresnelCenterColor,r._emissiveFresnel.centerColor),this._uEmissiveFresnelPower&&o.uniform1f(this._uEmissiveFresnelPower,r._emissiveFresnel.power));break;case"MetallicMaterial":this._uBaseColor&&o.uniform3fv(this._uBaseColor,h.baseColor),this._uMaterialMetallic&&o.uniform1f(this._uMaterialMetallic,h.metallic),this._uMaterialRoughness&&o.uniform1f(this._uMaterialRoughness,h.roughness),this._uMaterialSpecularF0&&o.uniform1f(this._uMaterialSpecularF0,h.specularF0),this._uMaterialEmissive&&o.uniform3fv(this._uMaterialEmissive,h.emissive),this._uAlphaModeCutoff&&o.uniform4f(this._uAlphaModeCutoff,1*h.alpha,1===h.alphaMode?1:0,h.alphaCutoff,0);const t=r._baseColorMap;t&&t._state.texture&&this._uBaseColorMap&&(n.bindTexture(this._uBaseColorMap,t._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uBaseColorMapMatrix&&o.uniformMatrix4fv(this._uBaseColorMapMatrix,!1,t._state.matrix));const i=r._metallicMap;i&&i._state.texture&&this._uMetallicMap&&(n.bindTexture(this._uMetallicMap,i._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uMetallicMapMatrix&&o.uniformMatrix4fv(this._uMetallicMapMatrix,!1,i._state.matrix));const a=r._roughnessMap;a&&a._state.texture&&this._uRoughnessMap&&(n.bindTexture(this._uRoughnessMap,a._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uRoughnessMapMatrix&&o.uniformMatrix4fv(this._uRoughnessMapMatrix,!1,a._state.matrix));const l=r._metallicRoughnessMap;l&&l._state.texture&&this._uMetallicRoughnessMap&&(n.bindTexture(this._uMetallicRoughnessMap,l._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uMetallicRoughnessMapMatrix&&o.uniformMatrix4fv(this._uMetallicRoughnessMapMatrix,!1,l._state.matrix)),(d=r._emissiveMap)&&d._state.texture&&this._uEmissiveMap&&(n.bindTexture(this._uEmissiveMap,d._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uEmissiveMapMatrix&&o.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,d._state.matrix)),(m=r._occlusionMap)&&r._occlusionMap._state.texture&&this._uOcclusionMap&&(n.bindTexture(this._uOcclusionMap,m._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uOcclusionMapMatrix&&o.uniformMatrix4fv(this._uOcclusionMapMatrix,!1,m._state.matrix)),(f=r._alphaMap)&&f._state.texture&&this._uAlphaMap&&(n.bindTexture(this._uAlphaMap,f._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uAlphaMapMatrix&&o.uniformMatrix4fv(this._uAlphaMapMatrix,!1,f._state.matrix)),(g=r._normalMap)&&g._state.texture&&this._uNormalMap&&(n.bindTexture(this._uNormalMap,g._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uNormalMapMatrix&&o.uniformMatrix4fv(this._uNormalMapMatrix,!1,g._state.matrix));break;case"SpecularMaterial":this._uMaterialDiffuse&&o.uniform3fv(this._uMaterialDiffuse,h.diffuse),this._uMaterialSpecular&&o.uniform3fv(this._uMaterialSpecular,h.specular),this._uMaterialGlossiness&&o.uniform1f(this._uMaterialGlossiness,h.glossiness),this._uMaterialReflectivity&&o.uniform1f(this._uMaterialReflectivity,h.reflectivity),this._uMaterialEmissive&&o.uniform3fv(this._uMaterialEmissive,h.emissive),this._uAlphaModeCutoff&&o.uniform4f(this._uAlphaModeCutoff,1*h.alpha,1===h.alphaMode?1:0,h.alphaCutoff,0);const u=r._diffuseMap;u&&u._state.texture&&this._uDiffuseMap&&(n.bindTexture(this._uDiffuseMap,u._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uDiffuseMapMatrix&&o.uniformMatrix4fv(this._uDiffuseMapMatrix,!1,u._state.matrix));const c=r._specularMap;c&&c._state.texture&&this._uSpecularMap&&(n.bindTexture(this._uSpecularMap,c._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uSpecularMapMatrix&&o.uniformMatrix4fv(this._uSpecularMapMatrix,!1,c._state.matrix));const p=r._glossinessMap;p&&p._state.texture&&this._uGlossinessMap&&(n.bindTexture(this._uGlossinessMap,p._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uGlossinessMapMatrix&&o.uniformMatrix4fv(this._uGlossinessMapMatrix,!1,p._state.matrix));const _=r._specularGlossinessMap;var d,m,f,g;_&&_._state.texture&&this._uSpecularGlossinessMap&&(n.bindTexture(this._uSpecularGlossinessMap,_._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uSpecularGlossinessMapMatrix&&o.uniformMatrix4fv(this._uSpecularGlossinessMapMatrix,!1,_._state.matrix)),(d=r._emissiveMap)&&d._state.texture&&this._uEmissiveMap&&(n.bindTexture(this._uEmissiveMap,d._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uEmissiveMapMatrix&&o.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,d._state.matrix)),(m=r._occlusionMap)&&m._state.texture&&this._uOcclusionMap&&(n.bindTexture(this._uOcclusionMap,m._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uOcclusionMapMatrix&&o.uniformMatrix4fv(this._uOcclusionMapMatrix,!1,m._state.matrix)),(f=r._alphaMap)&&f._state.texture&&this._uAlphaMap&&(n.bindTexture(this._uAlphaMap,f._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uAlphaMapMatrix&&o.uniformMatrix4fv(this._uAlphaMapMatrix,!1,f._state.matrix)),(g=r._normalMap)&&g._state.texture&&this._uNormalMap&&(n.bindTexture(this._uNormalMap,g._state.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%s,e.bindTexture++,this._uNormalMapMatrix&&o.uniformMatrix4fv(this._uNormalMapMatrix,!1,g._state.matrix))}this._lastMaterialId=h.id}if(o.uniformMatrix4fv(this._uModelMatrix,o.FALSE,t.worldMatrix),this._uModelNormalMatrix&&o.uniformMatrix4fv(this._uModelNormalMatrix,o.FALSE,t.worldNormalMatrix),this._uClippable&&o.uniform1i(this._uClippable,a.clippable),this._uColorize){const e=a.colorize,t=this._lastColorize;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(o.uniform4fv(this._uColorize,e),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3])}o.uniform3fv(this._uOffset,a.offset),l.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._uUVDecodeMatrix&&o.uniformMatrix3fv(this._uUVDecodeMatrix,!1,l.uvDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(l.positionsBuf),e.bindArray++),this._aNormal&&(this._aNormal.bindArrayBuffer(l.normalsBuf),e.bindArray++),this._aUV&&(this._aUV.bindArrayBuffer(l.uvBuf),e.bindArray++),this._aColor&&(this._aColor.bindArrayBuffer(l.colorsBuf),e.bindArray++),this._aFlags&&(this._aFlags.bindArrayBuffer(l.flagsBuf),e.bindArray++),l.indicesBuf&&(l.indicesBuf.bind(),e.bindArray++),this._lastGeometryId=l.id),l.indicesBuf?(o.drawElements(l.primitive,l.indicesBuf.numItems,l.indicesBuf.itemType,0),e.drawElements++):l.positions&&(o.drawArrays(o.TRIANGLES,0,l.positions.numItems),e.drawArrays++),p&&o.depthFunc(o.LESS)},uo.prototype._allocate=function(e){const t=e.scene,s=t.canvas.gl,i=e._material,r=t._lightsState,o=t._sectionPlanesState,n=e._material._state;if(this._program=new Te(s,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const a=this._program;this._uPositionsDecodeMatrix=a.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=a.getLocation("uvDecodeMatrix"),this._uModelMatrix=a.getLocation("modelMatrix"),this._uModelNormalMatrix=a.getLocation("modelNormalMatrix"),this._uViewMatrix=a.getLocation("viewMatrix"),this._uViewNormalMatrix=a.getLocation("viewNormalMatrix"),this._uProjMatrix=a.getLocation("projMatrix"),this._uGammaFactor=a.getLocation("gammaFactor"),this._uLightAmbient=[],this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[],this._uShadowViewMatrix=[],this._uShadowProjMatrix=[],t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=a.getLocation("logDepthBufFC"));const h=r.lights;let l;for(var u=0,c=h.length;u<c;u++){switch(l=h[u],l.type){case"ambient":this._uLightAmbient[u]=a.getLocation("lightAmbient");break;case"dir":this._uLightColor[u]=a.getLocation("lightColor"+u),this._uLightPos[u]=null,this._uLightDir[u]=a.getLocation("lightDir"+u);break;case"point":this._uLightColor[u]=a.getLocation("lightColor"+u),this._uLightPos[u]=a.getLocation("lightPos"+u),this._uLightDir[u]=null,this._uLightAttenuation[u]=a.getLocation("lightAttenuation"+u);break;case"spot":this._uLightColor[u]=a.getLocation("lightColor"+u),this._uLightPos[u]=a.getLocation("lightPos"+u),this._uLightDir[u]=a.getLocation("lightDir"+u),this._uLightAttenuation[u]=a.getLocation("lightAttenuation"+u)}l.castsShadow&&(this._uShadowViewMatrix[u]=a.getLocation("shadowViewMatrix"+u),this._uShadowProjMatrix[u]=a.getLocation("shadowProjMatrix"+u))}r.lightMaps.length>0&&(this._uLightMap="lightMap"),r.reflectionMaps.length>0&&(this._uReflectionMap="reflectionMap"),this._uSectionPlanes=[];for(u=0,c=o.sectionPlanes.length;u<c;u++)this._uSectionPlanes.push({active:a.getLocation("sectionPlaneActive"+u),pos:a.getLocation("sectionPlanePos"+u),dir:a.getLocation("sectionPlaneDir"+u)});switch(this._uPointSize=a.getLocation("pointSize"),n.type){case"LambertMaterial":this._uMaterialColor=a.getLocation("materialColor"),this._uMaterialEmissive=a.getLocation("materialEmissive"),this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff");break;case"PhongMaterial":this._uMaterialAmbient=a.getLocation("materialAmbient"),this._uMaterialDiffuse=a.getLocation("materialDiffuse"),this._uMaterialSpecular=a.getLocation("materialSpecular"),this._uMaterialEmissive=a.getLocation("materialEmissive"),this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff"),this._uMaterialShininess=a.getLocation("materialShininess"),i._ambientMap&&(this._uMaterialAmbientMap="ambientMap",this._uMaterialAmbientMapMatrix=a.getLocation("ambientMapMatrix")),i._diffuseMap&&(this._uDiffuseMap="diffuseMap",this._uDiffuseMapMatrix=a.getLocation("diffuseMapMatrix")),i._specularMap&&(this._uSpecularMap="specularMap",this._uSpecularMapMatrix=a.getLocation("specularMapMatrix")),i._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=a.getLocation("emissiveMapMatrix")),i._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=a.getLocation("alphaMapMatrix")),i._reflectivityMap&&(this._uReflectivityMap="reflectivityMap",this._uReflectivityMapMatrix=a.getLocation("reflectivityMapMatrix")),i._normalMap&&(this._uNormalMap="normalMap",this._uNormalMapMatrix=a.getLocation("normalMapMatrix")),i._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=a.getLocation("occlusionMapMatrix")),i._diffuseFresnel&&(this._uDiffuseFresnelEdgeBias=a.getLocation("diffuseFresnelEdgeBias"),this._uDiffuseFresnelCenterBias=a.getLocation("diffuseFresnelCenterBias"),this._uDiffuseFresnelEdgeColor=a.getLocation("diffuseFresnelEdgeColor"),this._uDiffuseFresnelCenterColor=a.getLocation("diffuseFresnelCenterColor"),this._uDiffuseFresnelPower=a.getLocation("diffuseFresnelPower")),i._specularFresnel&&(this._uSpecularFresnelEdgeBias=a.getLocation("specularFresnelEdgeBias"),this._uSpecularFresnelCenterBias=a.getLocation("specularFresnelCenterBias"),this._uSpecularFresnelEdgeColor=a.getLocation("specularFresnelEdgeColor"),this._uSpecularFresnelCenterColor=a.getLocation("specularFresnelCenterColor"),this._uSpecularFresnelPower=a.getLocation("specularFresnelPower")),i._alphaFresnel&&(this._uAlphaFresnelEdgeBias=a.getLocation("alphaFresnelEdgeBias"),this._uAlphaFresnelCenterBias=a.getLocation("alphaFresnelCenterBias"),this._uAlphaFresnelEdgeColor=a.getLocation("alphaFresnelEdgeColor"),this._uAlphaFresnelCenterColor=a.getLocation("alphaFresnelCenterColor"),this._uAlphaFresnelPower=a.getLocation("alphaFresnelPower")),i._reflectivityFresnel&&(this._uReflectivityFresnelEdgeBias=a.getLocation("reflectivityFresnelEdgeBias"),this._uReflectivityFresnelCenterBias=a.getLocation("reflectivityFresnelCenterBias"),this._uReflectivityFresnelEdgeColor=a.getLocation("reflectivityFresnelEdgeColor"),this._uReflectivityFresnelCenterColor=a.getLocation("reflectivityFresnelCenterColor"),this._uReflectivityFresnelPower=a.getLocation("reflectivityFresnelPower")),i._emissiveFresnel&&(this._uEmissiveFresnelEdgeBias=a.getLocation("emissiveFresnelEdgeBias"),this._uEmissiveFresnelCenterBias=a.getLocation("emissiveFresnelCenterBias"),this._uEmissiveFresnelEdgeColor=a.getLocation("emissiveFresnelEdgeColor"),this._uEmissiveFresnelCenterColor=a.getLocation("emissiveFresnelCenterColor"),this._uEmissiveFresnelPower=a.getLocation("emissiveFresnelPower"));break;case"MetallicMaterial":this._uBaseColor=a.getLocation("materialBaseColor"),this._uMaterialMetallic=a.getLocation("materialMetallic"),this._uMaterialRoughness=a.getLocation("materialRoughness"),this._uMaterialSpecularF0=a.getLocation("materialSpecularF0"),this._uMaterialEmissive=a.getLocation("materialEmissive"),this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff"),i._baseColorMap&&(this._uBaseColorMap="baseColorMap",this._uBaseColorMapMatrix=a.getLocation("baseColorMapMatrix")),i._metallicMap&&(this._uMetallicMap="metallicMap",this._uMetallicMapMatrix=a.getLocation("metallicMapMatrix")),i._roughnessMap&&(this._uRoughnessMap="roughnessMap",this._uRoughnessMapMatrix=a.getLocation("roughnessMapMatrix")),i._metallicRoughnessMap&&(this._uMetallicRoughnessMap="metallicRoughnessMap",this._uMetallicRoughnessMapMatrix=a.getLocation("metallicRoughnessMapMatrix")),i._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=a.getLocation("emissiveMapMatrix")),i._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=a.getLocation("occlusionMapMatrix")),i._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=a.getLocation("alphaMapMatrix")),i._normalMap&&(this._uNormalMap="normalMap",this._uNormalMapMatrix=a.getLocation("normalMapMatrix"));break;case"SpecularMaterial":this._uMaterialDiffuse=a.getLocation("materialDiffuse"),this._uMaterialSpecular=a.getLocation("materialSpecular"),this._uMaterialGlossiness=a.getLocation("materialGlossiness"),this._uMaterialReflectivity=a.getLocation("reflectivityFresnel"),this._uMaterialEmissive=a.getLocation("materialEmissive"),this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff"),i._diffuseMap&&(this._uDiffuseMap="diffuseMap",this._uDiffuseMapMatrix=a.getLocation("diffuseMapMatrix")),i._specularMap&&(this._uSpecularMap="specularMap",this._uSpecularMapMatrix=a.getLocation("specularMapMatrix")),i._glossinessMap&&(this._uGlossinessMap="glossinessMap",this._uGlossinessMapMatrix=a.getLocation("glossinessMapMatrix")),i._specularGlossinessMap&&(this._uSpecularGlossinessMap="materialSpecularGlossinessMap",this._uSpecularGlossinessMapMatrix=a.getLocation("materialSpecularGlossinessMapMatrix")),i._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=a.getLocation("emissiveMapMatrix")),i._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=a.getLocation("occlusionMapMatrix")),i._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=a.getLocation("alphaMapMatrix")),i._normalMap&&(this._uNormalMap="normalMap",this._uNormalMapMatrix=a.getLocation("normalMapMatrix"))}this._aPosition=a.getAttribute("position"),this._aNormal=a.getAttribute("normal"),this._aUV=a.getAttribute("uv"),this._aColor=a.getAttribute("color"),this._aFlags=a.getAttribute("flags"),this._uClippable=a.getLocation("clippable"),this._uColorize=a.getLocation("colorize"),this._uOffset=a.getLocation("offset"),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,this._lastColorize=new Float32Array(4),this._baseTextureUnit=0},uo.prototype._bindProgram=function(e){const t=ce.MAX_TEXTURE_UNITS,s=this._scene,i=s.canvas.gl,r=s._lightsState,o=s.camera.project;let n;const a=this._program;if(a.bind(),e.useProgram++,e.textureUnit=0,this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,this._lastColorize[0]=-1,this._lastColorize[1]=-1,this._lastColorize[2]=-1,this._lastColorize[3]=-1,i.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),s.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,e)}for(var h=0,l=r.lights.length;h<l;h++)if(n=r.lights[h],this._uLightAmbient[h])i.uniform4f(this._uLightAmbient[h],n.color[0],n.color[1],n.color[2],n.intensity);else if(this._uLightColor[h]&&i.uniform4f(this._uLightColor[h],n.color[0],n.color[1],n.color[2],n.intensity),this._uLightPos[h]&&(i.uniform3fv(this._uLightPos[h],n.pos),this._uLightAttenuation[h]&&i.uniform1f(this._uLightAttenuation[h],n.attenuation)),this._uLightDir[h]&&i.uniform3fv(this._uLightDir[h],n.dir),n.castsShadow){this._uShadowViewMatrix[h]&&i.uniformMatrix4fv(this._uShadowViewMatrix[h],!1,n.getShadowViewMatrix()),this._uShadowProjMatrix[h]&&i.uniformMatrix4fv(this._uShadowProjMatrix[h],!1,n.getShadowProjMatrix());const s=n.getShadowRenderBuf();s&&(a.bindTexture("shadowMap"+h,s.getTexture(),e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++)}r.lightMaps.length>0&&r.lightMaps[0].texture&&this._uLightMap&&(a.bindTexture(this._uLightMap,r.lightMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++),r.reflectionMaps.length>0&&r.reflectionMaps[0].texture&&this._uReflectionMap&&(a.bindTexture(this._uReflectionMap,r.reflectionMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%t,e.bindTexture++),this._uGammaFactor&&i.uniform1f(this._uGammaFactor,s.gammaFactor),this._baseTextureUnit=e.textureUnit};class po{constructor(e){this.vertex=function(e){const t=e.scene,s=t._lightsState,i=function(e){const t=e._geometry._state.primitiveName;if((e._geometry._state.autoVertexNormals||e._geometry._state.normalsBuf)&&("triangles"===t||"triangle-strip"===t||"triangle-fan"===t))return!0;return!1}(e),r=t._sectionPlanesState.sectionPlanes.length>0,o=!!e._geometry._state.compressGeometry,n=e._state.billboard,a=e._state.stationary,h=[];h.push("#version 300 es"),h.push("// EmphasisFillShaderSource vertex shader"),h.push("in vec3 position;"),h.push("uniform mat4 modelMatrix;"),h.push("uniform mat4 viewMatrix;"),h.push("uniform mat4 projMatrix;"),h.push("uniform vec4 colorize;"),h.push("uniform vec3 offset;"),o&&h.push("uniform mat4 positionsDecodeMatrix;");t.logarithmicDepthBufferEnabled&&(h.push("uniform float logDepthBufFC;"),h.push("out float vFragDepth;"),h.push("bool isPerspectiveMatrix(mat4 m) {"),h.push("    return (m[2][3] == - 1.0);"),h.push("}"),h.push("out float isPerspective;"));r&&h.push("out vec4 vWorldPosition;");if(h.push("uniform vec4   lightAmbient;"),h.push("uniform vec4   fillColor;"),i){h.push("in vec3 normal;"),h.push("uniform mat4 modelNormalMatrix;"),h.push("uniform mat4 viewNormalMatrix;");for(let e=0,t=s.lights.length;e<t;e++){const t=s.lights[e];"ambient"!==t.type&&(h.push("uniform vec4 lightColor"+e+";"),"dir"===t.type&&h.push("uniform vec3 lightDir"+e+";"),"point"===t.type&&h.push("uniform vec3 lightPos"+e+";"),"spot"===t.type&&h.push("uniform vec3 lightPos"+e+";"))}o&&(h.push("vec3 octDecode(vec2 oct) {"),h.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),h.push("    if (v.z < 0.0) {"),h.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),h.push("    }"),h.push("    return normalize(v);"),h.push("}"))}h.push("out vec4 vColor;"),("spherical"===n||"cylindrical"===n)&&(h.push("void billboard(inout mat4 mat) {"),h.push("   mat[0][0] = 1.0;"),h.push("   mat[0][1] = 0.0;"),h.push("   mat[0][2] = 0.0;"),"spherical"===n&&(h.push("   mat[1][0] = 0.0;"),h.push("   mat[1][1] = 1.0;"),h.push("   mat[1][2] = 0.0;")),h.push("   mat[2][0] = 0.0;"),h.push("   mat[2][1] = 0.0;"),h.push("   mat[2][2] =1.0;"),h.push("}"));h.push("void main(void) {"),h.push("vec4 localPosition = vec4(position, 1.0); "),h.push("vec4 worldPosition;"),o&&h.push("localPosition = positionsDecodeMatrix * localPosition;");i&&(o?h.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):h.push("vec4 localNormal = vec4(normal, 0.0); "),h.push("mat4 modelNormalMatrix2 = modelNormalMatrix;"),h.push("mat4 viewNormalMatrix2 = viewNormalMatrix;"));h.push("mat4 viewMatrix2 = viewMatrix;"),h.push("mat4 modelMatrix2 = modelMatrix;"),a&&h.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===n||"cylindrical"===n?(h.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),h.push("billboard(modelMatrix2);"),h.push("billboard(viewMatrix2);"),h.push("billboard(modelViewMatrix);"),i&&(h.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),h.push("billboard(modelNormalMatrix2);"),h.push("billboard(viewNormalMatrix2);"),h.push("billboard(modelViewNormalMatrix);")),h.push("worldPosition = modelMatrix2 * localPosition;"),h.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(h.push("worldPosition = modelMatrix2 * localPosition;"),h.push("worldPosition.xyz = worldPosition.xyz + offset;"),h.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));i&&h.push("vec3 viewNormal = normalize((viewNormalMatrix2 * modelNormalMatrix2 * localNormal).xyz);");if(h.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),h.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),h.push("float lambertian = 1.0;"),i)for(let e=0,t=s.lights.length;e<t;e++){const t=s.lights[e];if("ambient"!==t.type){if("dir"===t.type)"view"===t.space?h.push("viewLightDir = normalize(lightDir"+e+");"):h.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+e+", 0.0)).xyz);");else{if("point"!==t.type)continue;"view"===t.space?h.push("viewLightDir = normalize(lightPos"+e+" - viewPosition.xyz);"):h.push("viewLightDir = normalize((viewMatrix2 * vec4(lightPos"+e+", 0.0)).xyz);")}h.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),h.push("reflectedColor += lambertian * (lightColor"+e+".rgb * lightColor"+e+".a);")}}h.push("vColor = vec4(reflectedColor * fillColor.rgb, fillColor.a);"),r&&h.push("vWorldPosition = worldPosition;");"points"===e._geometry._state.primitiveName&&h.push("gl_PointSize = pointSize;");h.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(h.push("vFragDepth = 1.0 + clipPos.w;"),h.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return h.push("gl_Position = clipPos;"),h.push("}"),h}(e),this.fragment=function(e){const t=e.scene,s=e.scene._sectionPlanesState,i=e.scene.gammaOutput,r=s.sectionPlanes.length>0,o=[];o.push("#version 300 es"),o.push("// Lambertian drawing fragment shader"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),t.logarithmicDepthBufferEnabled&&(o.push("in float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("in float vFragDepth;"));i&&(o.push("uniform float gammaFactor;"),o.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),o.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),o.push("}"));if(r){o.push("in vec4 vWorldPosition;"),o.push("uniform bool clippable;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)o.push("uniform bool sectionPlaneActive"+e+";"),o.push("uniform vec3 sectionPlanePos"+e+";"),o.push("uniform vec3 sectionPlaneDir"+e+";")}if(o.push("in vec4 vColor;"),o.push("out vec4 outColor;"),o.push("void main(void) {"),r){o.push("if (clippable) {"),o.push("  float dist = 0.0;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)o.push("if (sectionPlaneActive"+e+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { discard; }"),o.push("}")}"points"===e._geometry._state.primitiveName&&(o.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),o.push("float r = dot(cxy, cxy);"),o.push("if (r > 1.0) {"),o.push("   discard;"),o.push("}"));t.logarithmicDepthBufferEnabled&&o.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");i?o.push("outColor = linearToGamma(vColor, gammaFactor);"):o.push("outColor = vColor;");return o.push("}"),o}(e)}}const mo=new e({}),fo=p.vec3(),go=function(e,t){this.id=mo.addItem({}),this._hash=e,this._scene=t.scene,this._useCount=0,this._shaderSource=new po(t),this._allocate(t)},_o={};go.get=function(e){const t=[e.scene.id,e.scene.gammaOutput?"go":"",e.scene._sectionPlanesState.getHash(),e._geometry._state.normalsBuf?"n":"",e._geometry._state.compressGeometry?"cp":"",e._state.hash].join(";");let s=_o[t];return s||(s=new go(t,e),_o[t]=s,m.memory.programs++),s._useCount++,s},go.prototype.put=function(){0==--this._useCount&&(mo.removeItem(this.id),this._program&&this._program.destroy(),delete _o[this._hash],m.memory.programs--)},go.prototype.webglContextRestored=function(){this._program=null},go.prototype.drawMesh=function(e,t,s){this._program||this._allocate(t);const i=this._scene,r=i.camera,o=i.canvas.gl,n=0===s?t._xrayMaterial._state:1===s?t._highlightMaterial._state:t._selectedMaterial._state,a=t._state,h=t._geometry._state,l=t.origin;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniformMatrix4fv(this._uViewMatrix,!1,l?e.getRTCViewMatrix(a.originHash,l):r.viewMatrix),o.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.viewNormalMatrix),a.clippable){const e=i._sectionPlanesState.sectionPlanes.length;if(e>0){const s=i._sectionPlanesState.sectionPlanes,r=t.renderFlags;for(let t=0;t<e;t++){const e=this._uSectionPlanes[t];if(e){const i=r.sectionPlanesActivePerLayer[t];if(o.uniform1i(e.active,i?1:0),i){const i=s[t];o.uniform3fv(e.pos,l?X(i.dist,i.dir,l,fo):i.pos),o.uniform3fv(e.dir,i.dir)}}}}}if(n.id!==this._lastMaterialId){const t=n.fillColor,s=n.backfaces;e.backfaces!==s&&(s?o.disable(o.CULL_FACE):o.enable(o.CULL_FACE),e.backfaces=s),o.uniform4f(this._uFillColor,t[0],t[1],t[2],n.fillAlpha),this._lastMaterialId=n.id}o.uniformMatrix4fv(this._uModelMatrix,o.FALSE,t.worldMatrix),this._uModelNormalMatrix&&o.uniformMatrix4fv(this._uModelNormalMatrix,o.FALSE,t.worldNormalMatrix),this._uClippable&&o.uniform1i(this._uClippable,a.clippable),o.uniform3fv(this._uOffset,a.offset),h.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._uUVDecodeMatrix&&o.uniformMatrix3fv(this._uUVDecodeMatrix,!1,h.uvDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(h.positionsBuf),e.bindArray++),this._aNormal&&(this._aNormal.bindArrayBuffer(h.normalsBuf),e.bindArray++),h.indicesBuf?(h.indicesBuf.bind(),e.bindArray++):h.positionsBuf,this._lastGeometryId=h.id),h.indicesBuf?(o.drawElements(h.primitive,h.indicesBuf.numItems,h.indicesBuf.itemType,0),e.drawElements++):h.positionsBuf&&(o.drawArrays(o.TRIANGLES,0,h.positionsBuf.numItems),e.drawArrays++)},go.prototype._allocate=function(e){const t=e.scene,s=t._lightsState,i=t._sectionPlanesState,r=t.canvas.gl;if(this._program=new Te(r,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const o=this._program;this._uPositionsDecodeMatrix=o.getLocation("positionsDecodeMatrix"),this._uModelMatrix=o.getLocation("modelMatrix"),this._uModelNormalMatrix=o.getLocation("modelNormalMatrix"),this._uViewMatrix=o.getLocation("viewMatrix"),this._uViewNormalMatrix=o.getLocation("viewNormalMatrix"),this._uProjMatrix=o.getLocation("projMatrix"),this._uLightAmbient=[],this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];for(let e=0,t=s.lights.length;e<t;e++){switch(s.lights[e].type){case"ambient":this._uLightAmbient[e]=o.getLocation("lightAmbient");break;case"dir":this._uLightColor[e]=o.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=o.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=o.getLocation("lightColor"+e),this._uLightPos[e]=o.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=o.getLocation("lightAttenuation"+e)}}this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:o.getLocation("sectionPlaneActive"+e),pos:o.getLocation("sectionPlanePos"+e),dir:o.getLocation("sectionPlaneDir"+e)});this._uFillColor=o.getLocation("fillColor"),this._aPosition=o.getAttribute("position"),this._aNormal=o.getAttribute("normal"),this._uClippable=o.getLocation("clippable"),this._uGammaFactor=o.getLocation("gammaFactor"),this._uOffset=o.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=o.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null},go.prototype._bindProgram=function(e){const t=this._scene,s=t.canvas.gl,i=t._lightsState,r=t.camera,o=r.project;if(this._program.bind(),e.useProgram++,e.textureUnit=0,this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,this._lastIndicesBufId=null,s.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.normalMatrix),s.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),t.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}for(let e=0,t=i.lights.length;e<t;e++){const t=i.lights[e];this._uLightAmbient[e]?s.uniform4f(this._uLightAmbient[e],t.color[0],t.color[1],t.color[2],t.intensity):(this._uLightColor[e]&&s.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(s.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&s.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&s.uniform3fv(this._uLightDir[e],t.dir))}this._uGammaFactor&&s.uniform1f(this._uGammaFactor,t.gammaFactor)};class yo{constructor(e){this.vertex=function(e){const t=e.scene,s=t._sectionPlanesState.sectionPlanes.length>0,i=!!e._geometry._state.compressGeometry,r=e._state.billboard,o=e._state.stationary,n=[];n.push("#version 300 es"),n.push("// Edges drawing vertex shader"),n.push("in vec3 position;"),n.push("uniform mat4 modelMatrix;"),n.push("uniform mat4 viewMatrix;"),n.push("uniform mat4 projMatrix;"),n.push("uniform vec4 edgeColor;"),n.push("uniform vec3 offset;"),i&&n.push("uniform mat4 positionsDecodeMatrix;");t.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),n.push("out float vFragDepth;"),n.push("bool isPerspectiveMatrix(mat4 m) {"),n.push("    return (m[2][3] == - 1.0);"),n.push("}"),n.push("out float isPerspective;"));s&&n.push("out vec4 vWorldPosition;");n.push("out vec4 vColor;"),("spherical"===r||"cylindrical"===r)&&(n.push("void billboard(inout mat4 mat) {"),n.push("   mat[0][0] = 1.0;"),n.push("   mat[0][1] = 0.0;"),n.push("   mat[0][2] = 0.0;"),"spherical"===r&&(n.push("   mat[1][0] = 0.0;"),n.push("   mat[1][1] = 1.0;"),n.push("   mat[1][2] = 0.0;")),n.push("   mat[2][0] = 0.0;"),n.push("   mat[2][1] = 0.0;"),n.push("   mat[2][2] =1.0;"),n.push("}"));n.push("void main(void) {"),n.push("vec4 localPosition = vec4(position, 1.0); "),n.push("vec4 worldPosition;"),i&&n.push("localPosition = positionsDecodeMatrix * localPosition;");n.push("mat4 viewMatrix2 = viewMatrix;"),n.push("mat4 modelMatrix2 = modelMatrix;"),o&&n.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===r||"cylindrical"===r?(n.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),n.push("billboard(modelMatrix2);"),n.push("billboard(viewMatrix2);"),n.push("billboard(modelViewMatrix);"),n.push("worldPosition = modelMatrix2 * localPosition;"),n.push("worldPosition.xyz = worldPosition.xyz + offset;"),n.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(n.push("worldPosition = modelMatrix2 * localPosition;"),n.push("worldPosition.xyz = worldPosition.xyz + offset;"),n.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));n.push("vColor = edgeColor;"),s&&n.push("vWorldPosition = worldPosition;");n.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(n.push("vFragDepth = 1.0 + clipPos.w;"),n.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return n.push("gl_Position = clipPos;"),n.push("}"),n}(e),this.fragment=function(e){const t=e.scene,s=e.scene._sectionPlanesState,i=e.scene.gammaOutput,r=s.sectionPlanes.length>0,o=[];o.push("#version 300 es"),o.push("// Edges drawing fragment shader"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),t.logarithmicDepthBufferEnabled&&(o.push("in float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("in float vFragDepth;"));i&&(o.push("uniform float gammaFactor;"),o.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),o.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),o.push("}"));if(r){o.push("in vec4 vWorldPosition;"),o.push("uniform bool clippable;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)o.push("uniform bool sectionPlaneActive"+e+";"),o.push("uniform vec3 sectionPlanePos"+e+";"),o.push("uniform vec3 sectionPlaneDir"+e+";")}if(o.push("in vec4 vColor;"),o.push("out vec4 outColor;"),o.push("void main(void) {"),r){o.push("if (clippable) {"),o.push("  float dist = 0.0;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)o.push("if (sectionPlaneActive"+e+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { discard; }"),o.push("}")}t.logarithmicDepthBufferEnabled&&o.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");i?o.push("outColor = linearToGamma(vColor, gammaFactor);"):o.push("outColor = vColor;");return o.push("}"),o}(e)}}const vo=new e({}),bo=p.vec3(),xo=function(e,t){this.id=vo.addItem({}),this._hash=e,this._scene=t.scene,this._useCount=0,this._shaderSource=new yo(t),this._allocate(t)},Po={};xo.get=function(e){const t=[e.scene.id,e.scene.gammaOutput?"go":"",e.scene._sectionPlanesState.getHash(),e._geometry._state.compressGeometry?"cp":"",e._state.hash].join(";");let s=Po[t];return s||(s=new xo(t,e),Po[t]=s,m.memory.programs++),s._useCount++,s},xo.prototype.put=function(){0==--this._useCount&&(vo.removeItem(this.id),this._program&&this._program.destroy(),delete Po[this._hash],m.memory.programs--)},xo.prototype.webglContextRestored=function(){this._program=null},xo.prototype.drawMesh=function(e,t,s){this._program||this._allocate(t);const i=this._scene,r=i.camera,o=i.canvas.gl;let n;const a=t._state,h=t._geometry,l=h._state,u=t.origin;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),o.uniformMatrix4fv(this._uViewMatrix,!1,u?e.getRTCViewMatrix(a.originHash,u):r.viewMatrix),a.clippable){const e=i._sectionPlanesState.sectionPlanes.length;if(e>0){const s=i._sectionPlanesState.sectionPlanes,r=t.renderFlags;for(let t=0;t<e;t++){const e=this._uSectionPlanes[t];if(e){const i=r.sectionPlanesActivePerLayer[t];if(o.uniform1i(e.active,i?1:0),i){const i=s[t];o.uniform3fv(e.pos,u?X(i.dist,i.dir,u,bo):i.pos),o.uniform3fv(e.dir,i.dir)}}}}}switch(s){case 0:n=t._xrayMaterial._state;break;case 1:n=t._highlightMaterial._state;break;case 2:n=t._selectedMaterial._state;break;default:n=t._edgeMaterial._state}if(n.id!==this._lastMaterialId){const t=n.backfaces;if(e.backfaces!==t&&(t?o.disable(o.CULL_FACE):o.enable(o.CULL_FACE),e.backfaces=t),e.lineWidth!==n.edgeWidth&&(o.lineWidth(n.edgeWidth),e.lineWidth=n.edgeWidth),this._uEdgeColor){const e=n.edgeColor,t=n.edgeAlpha;o.uniform4f(this._uEdgeColor,e[0],e[1],e[2],t)}this._lastMaterialId=n.id}let c;o.uniformMatrix4fv(this._uModelMatrix,o.FALSE,t.worldMatrix),this._uClippable&&o.uniform1i(this._uClippable,a.clippable),o.uniform3fv(this._uOffset,a.offset),l.primitive===o.TRIANGLES?c=h._getEdgeIndices():l.primitive===o.LINES&&(c=l.indicesBuf),c&&(l.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(l.positionsBuf,l.compressGeometry?o.UNSIGNED_SHORT:o.FLOAT),e.bindArray++),c.bind(),e.bindArray++,this._lastGeometryId=l.id),o.drawElements(o.LINES,c.numItems,c.itemType,0),e.drawElements++)},xo.prototype._allocate=function(e){const t=e.scene,s=t.canvas.gl,i=t._sectionPlanesState;if(this._program=new Te(s,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const r=this._program;this._uPositionsDecodeMatrix=r.getLocation("positionsDecodeMatrix"),this._uModelMatrix=r.getLocation("modelMatrix"),this._uViewMatrix=r.getLocation("viewMatrix"),this._uProjMatrix=r.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=i.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:r.getLocation("sectionPlaneActive"+e),pos:r.getLocation("sectionPlanePos"+e),dir:r.getLocation("sectionPlaneDir"+e)});this._uEdgeColor=r.getLocation("edgeColor"),this._aPosition=r.getAttribute("position"),this._uClippable=r.getLocation("clippable"),this._uGammaFactor=r.getLocation("gammaFactor"),this._uOffset=r.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=r.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null},xo.prototype._bindProgram=function(e){const t=this._program,s=this._scene,i=s.canvas.gl,r=s.camera.project;if(t.bind(),e.useProgram++,this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,i.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),s.logarithmicDepthBufferEnabled){const e=2/(Math.log(r.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,e)}this._uGammaFactor&&i.uniform1f(this._uGammaFactor,s.gammaFactor)};class To{constructor(e){this.vertex=function(e){const t=e.scene,s=t._sectionPlanesState.sectionPlanes.length>0,i=!!e._geometry._state.compressGeometry,r=e._state.billboard,o=e._state.stationary,n=[];n.push("#version 300 es"),n.push("// Mesh picking vertex shader"),n.push("in vec3 position;"),n.push("uniform mat4 modelMatrix;"),n.push("uniform mat4 viewMatrix;"),n.push("uniform mat4 projMatrix;"),n.push("out vec4 vViewPosition;"),n.push("uniform vec3 offset;"),i&&n.push("uniform mat4 positionsDecodeMatrix;");s&&n.push("out vec4 vWorldPosition;");t.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),n.push("out float vFragDepth;"),n.push("bool isPerspectiveMatrix(mat4 m) {"),n.push("    return (m[2][3] == - 1.0);"),n.push("}"),n.push("out float isPerspective;"));"spherical"!==r&&"cylindrical"!==r||(n.push("void billboard(inout mat4 mat) {"),n.push("   mat[0][0] = 1.0;"),n.push("   mat[0][1] = 0.0;"),n.push("   mat[0][2] = 0.0;"),"spherical"===r&&(n.push("   mat[1][0] = 0.0;"),n.push("   mat[1][1] = 1.0;"),n.push("   mat[1][2] = 0.0;")),n.push("   mat[2][0] = 0.0;"),n.push("   mat[2][1] = 0.0;"),n.push("   mat[2][2] =1.0;"),n.push("}"));n.push("void main(void) {"),n.push("vec4 localPosition = vec4(position, 1.0); "),i&&n.push("localPosition = positionsDecodeMatrix * localPosition;");n.push("mat4 viewMatrix2 = viewMatrix;"),n.push("mat4 modelMatrix2 = modelMatrix;"),o&&n.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"!==r&&"cylindrical"!==r||(n.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),n.push("billboard(modelMatrix2);"),n.push("billboard(viewMatrix2);"));n.push("   vec4 worldPosition = modelMatrix2 * localPosition;"),n.push("   worldPosition.xyz = worldPosition.xyz + offset;"),n.push("   vec4 viewPosition = viewMatrix2 * worldPosition;"),s&&n.push("   vWorldPosition = worldPosition;");n.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(n.push("vFragDepth = 1.0 + clipPos.w;"),n.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return n.push("gl_Position = clipPos;"),n.push("}"),n}(e),this.fragment=function(e){const t=e.scene,s=t._sectionPlanesState,i=s.sectionPlanes.length>0,r=[];r.push("#version 300 es"),r.push("// Mesh picking fragment shader"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),t.logarithmicDepthBufferEnabled&&(r.push("in float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("in float vFragDepth;"));if(r.push("uniform vec4 pickColor;"),i){r.push("uniform bool clippable;"),r.push("in vec4 vWorldPosition;");for(var o=0;o<s.sectionPlanes.length;o++)r.push("uniform bool sectionPlaneActive"+o+";"),r.push("uniform vec3 sectionPlanePos"+o+";"),r.push("uniform vec3 sectionPlaneDir"+o+";")}if(r.push("out vec4 outColor;"),r.push("void main(void) {"),i){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(o=0;o<s.sectionPlanes.length;o++)r.push("if (sectionPlaneActive"+o+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}t.logarithmicDepthBufferEnabled&&r.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");return r.push("   outColor = pickColor; "),r.push("}"),r}(e)}}const wo=p.vec3(),Mo=function(e,t){this._hash=e,this._shaderSource=new To(t),this._scene=t.scene,this._useCount=0,this._allocate(t)},Io={};Mo.get=function(e){const t=[e.scene.canvas.canvas.id,e.scene._sectionPlanesState.getHash(),e._geometry._state.hash,e._state.hash].join(";");let s=Io[t];if(!s){if(s=new Mo(t,e),s.errors)return console.log(s.errors.join("\n")),null;Io[t]=s,m.memory.programs++}return s._useCount++,s},Mo.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete Io[this._hash],m.memory.programs--)},Mo.prototype.webglContextRestored=function(){this._program=null},Mo.prototype.drawMesh=function(e,t){this._program||this._allocate(t);const s=this._scene,i=s.canvas.gl,r=t._state,o=t._material._state,n=t._geometry._state,a=t.origin;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),i.uniformMatrix4fv(this._uViewMatrix,!1,a?e.getRTCPickViewMatrix(r.originHash,a):e.pickViewMatrix),r.clippable){const e=s._sectionPlanesState.sectionPlanes.length;if(e>0){const r=s._sectionPlanesState.sectionPlanes,o=t.renderFlags;for(let t=0;t<e;t++){const e=this._uSectionPlanes[t];if(e){const s=o.sectionPlanesActivePerLayer[t];if(i.uniform1i(e.active,s?1:0),s){const s=r[t];i.uniform3fv(e.pos,a?X(s.dist,s.dir,a,wo):s.pos),i.uniform3fv(e.dir,s.dir)}}}}}if(o.id!==this._lastMaterialId){const t=o.backfaces;e.backfaces!==t&&(t?i.disable(i.CULL_FACE):i.enable(i.CULL_FACE),e.backfaces=t);const s=o.frontface;e.frontface!==s&&(s?i.frontFace(i.CCW):i.frontFace(i.CW),e.frontface=s),this._lastMaterialId=o.id}i.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),i.uniformMatrix4fv(this._uModelMatrix,!1,t.worldMatrix),this._uClippable&&i.uniform1i(this._uClippable,t._state.clippable),i.uniform3fv(this._uOffset,t._state.offset),n.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&i.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,n.positionsDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(n.positionsBuf,n.compressGeometry?i.UNSIGNED_SHORT:i.FLOAT),e.bindArray++),n.indicesBuf&&(n.indicesBuf.bind(),e.bindArray++),this._lastGeometryId=n.id);var h=t._state.pickID;const l=h>>24&255,u=h>>16&255,c=h>>8&255,p=255&h;i.uniform4f(this._uPickColor,p/255,c/255,u/255,l/255),n.indicesBuf?(i.drawElements(n.primitive,n.indicesBuf.numItems,n.indicesBuf.itemType,0),e.drawElements++):n.positions&&i.drawArrays(i.TRIANGLES,0,n.positions.numItems)},Mo.prototype._allocate=function(e){const t=e.scene,s=t.canvas.gl;if(this._program=new Te(s,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uModelMatrix=i.getLocation("modelMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,s=t._sectionPlanesState.sectionPlanes.length;e<s;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._uClippable=i.getLocation("clippable"),this._uPickColor=i.getLocation("pickColor"),this._uOffset=i.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastGeometryId=null},Mo.prototype._bindProgram=function(e){const t=this._scene,s=t.canvas.gl,i=t.camera.project;if(this._program.bind(),e.useProgram++,t.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}this._lastMaterialId=null,this._lastGeometryId=null};class Co{constructor(e){this.vertex=function(e){const t=e.scene,s=t._sectionPlanesState.sectionPlanes.length>0,i=!!e._geometry._state.compressGeometry;e._state.billboard,e._state.stationary;const r=[];r.push("#version 300 es"),r.push("// Surface picking vertex shader"),r.push("in vec3 position;"),r.push("in vec4 color;"),r.push("uniform mat4 modelMatrix;"),r.push("uniform mat4 viewMatrix;"),r.push("uniform mat4 projMatrix;"),r.push("uniform vec3 offset;"),s&&(r.push("uniform bool clippable;"),r.push("out vec4 vWorldPosition;"));t.logarithmicDepthBufferEnabled&&(r.push("uniform float logDepthBufFC;"),r.push("out float vFragDepth;"),r.push("bool isPerspectiveMatrix(mat4 m) {"),r.push("    return (m[2][3] == - 1.0);"),r.push("}"),r.push("out float isPerspective;"));r.push("out vec4 vColor;"),i&&r.push("uniform mat4 positionsDecodeMatrix;");r.push("void main(void) {"),r.push("vec4 localPosition = vec4(position, 1.0); "),i&&r.push("localPosition = positionsDecodeMatrix * localPosition;");r.push("   vec4 worldPosition = modelMatrix * localPosition; "),r.push("   worldPosition.xyz = worldPosition.xyz + offset;"),r.push("   vec4 viewPosition = viewMatrix * worldPosition;"),s&&r.push("   vWorldPosition = worldPosition;");r.push("   vColor = color;"),r.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(r.push("vFragDepth = 1.0 + clipPos.w;"),r.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return r.push("gl_Position = clipPos;"),r.push("}"),r}(e),this.fragment=function(e){const t=e.scene,s=t._sectionPlanesState,i=s.sectionPlanes.length>0,r=[];r.push("#version 300 es"),r.push("// Surface picking fragment shader"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),r.push("in vec4 vColor;"),t.logarithmicDepthBufferEnabled&&(r.push("in float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("in float vFragDepth;"));if(i){r.push("uniform bool clippable;"),r.push("in vec4 vWorldPosition;");for(let e=0;e<s.sectionPlanes.length;e++)r.push("uniform bool sectionPlaneActive"+e+";"),r.push("uniform vec3 sectionPlanePos"+e+";"),r.push("uniform vec3 sectionPlaneDir"+e+";")}if(r.push("out vec4 outColor;"),r.push("void main(void) {"),i){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(let e=0;e<s.sectionPlanes.length;e++)r.push("if (sectionPlaneActive"+e+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}t.logarithmicDepthBufferEnabled&&r.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");return r.push("   outColor = vColor;"),r.push("}"),r}(e)}}const Do=p.vec3(),Ao=function(e,t){this._hash=e,this._scene=t.scene,this._useCount=0,this._shaderSource=new Co(t),this._allocate(t)},Eo={};Ao.get=function(e){const t=[e.scene.canvas.canvas.id,e.scene._sectionPlanesState.getHash(),e._geometry._state.compressGeometry?"cp":"",e._state.hash].join(";");let s=Eo[t];if(!s){if(s=new Ao(t,e),s.errors)return console.log(s.errors.join("\n")),null;Eo[t]=s,m.memory.programs++}return s._useCount++,s},Ao.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete Eo[this._hash],m.memory.programs--)},Ao.prototype.webglContextRestored=function(){this._program=null},Ao.prototype.drawMesh=function(e,t){this._program||this._allocate(t);const s=this._scene,i=s.canvas.gl,r=t._state,o=t._material._state,n=t._geometry,a=t._geometry._state,h=t.origin,l=o.backfaces,u=o.frontface,c=s.camera.project,p=n._getPickTrianglePositions(),d=n._getPickTriangleColors();if(this._program.bind(),e.useProgram++,s.logarithmicDepthBufferEnabled){const e=2/(Math.log(c.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,e)}if(i.uniformMatrix4fv(this._uViewMatrix,!1,h?e.getRTCPickViewMatrix(r.originHash,h):e.pickViewMatrix),r.clippable){const e=s._sectionPlanesState.sectionPlanes.length;if(e>0){const r=s._sectionPlanesState.sectionPlanes,o=t.renderFlags;for(let t=0;t<e;t++){const e=this._uSectionPlanes[t];if(e){const s=o.sectionPlanesActivePerLayer[t];if(i.uniform1i(e.active,s?1:0),s){const s=r[t];i.uniform3fv(e.pos,h?X(s.dist,s.dir,h,Do):s.pos),i.uniform3fv(e.dir,s.dir)}}}}}i.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),s.logarithmicDepthBufferEnabled&&i.uniform1f(this._uZFar,s.camera.project.far),e.backfaces!==l&&(l?i.disable(i.CULL_FACE):i.enable(i.CULL_FACE),e.backfaces=l),e.frontface!==u&&(u?i.frontFace(i.CCW):i.frontFace(i.CW),e.frontface=u),i.uniformMatrix4fv(this._uModelMatrix,!1,t.worldMatrix),this._uClippable&&i.uniform1i(this._uClippable,t._state.clippable),i.uniform3fv(this._uOffset,t._state.offset),this._uPositionsDecodeMatrix?(i.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,a.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(p,a.compressGeometry?i.UNSIGNED_SHORT:i.FLOAT)):this._aPosition.bindArrayBuffer(p),d.bind(),i.enableVertexAttribArray(this._aColor.location),i.vertexAttribPointer(this._aColor.location,d.itemSize,d.itemType,!0,0,0),i.drawArrays(a.primitive,0,p.numItems/3)},Ao.prototype._allocate=function(e){const t=e.scene,s=t.canvas.gl;if(this._program=new Te(s,this._shaderSource),this._useCount=0,this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uModelMatrix=i.getLocation("modelMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,s=t._sectionPlanesState.sectionPlanes.length;e<s;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aColor=i.getAttribute("color"),this._uClippable=i.getLocation("clippable"),this._uOffset=i.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))};class Fo{constructor(e){this.vertex=function(e){const t=e.scene,s=t._sectionPlanesState.sectionPlanes.length>0,i=!!e._geometry._state.compressGeometry,r=e._state.billboard,o=e._state.stationary,n=[];n.push("#version 300 es"),n.push("// Mesh occlusion vertex shader"),n.push("in vec3 position;"),n.push("uniform mat4 modelMatrix;"),n.push("uniform mat4 viewMatrix;"),n.push("uniform mat4 projMatrix;"),n.push("uniform vec3 offset;"),i&&n.push("uniform mat4 positionsDecodeMatrix;");s&&n.push("out vec4 vWorldPosition;");t.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),n.push("out float vFragDepth;"),n.push("bool isPerspectiveMatrix(mat4 m) {"),n.push("    return (m[2][3] == - 1.0);"),n.push("}"),n.push("out float isPerspective;"));"spherical"!==r&&"cylindrical"!==r||(n.push("void billboard(inout mat4 mat) {"),n.push("   mat[0][0] = 1.0;"),n.push("   mat[0][1] = 0.0;"),n.push("   mat[0][2] = 0.0;"),"spherical"===r&&(n.push("   mat[1][0] = 0.0;"),n.push("   mat[1][1] = 1.0;"),n.push("   mat[1][2] = 0.0;")),n.push("   mat[2][0] = 0.0;"),n.push("   mat[2][1] = 0.0;"),n.push("   mat[2][2] =1.0;"),n.push("}"));n.push("void main(void) {"),n.push("vec4 localPosition = vec4(position, 1.0); "),n.push("vec4 worldPosition;"),i&&n.push("localPosition = positionsDecodeMatrix * localPosition;");n.push("mat4 viewMatrix2 = viewMatrix;"),n.push("mat4 modelMatrix2 = modelMatrix;"),o&&n.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===r||"cylindrical"===r?(n.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),n.push("billboard(modelMatrix2);"),n.push("billboard(viewMatrix2);"),n.push("billboard(modelViewMatrix);"),n.push("worldPosition = modelMatrix2 * localPosition;"),n.push("worldPosition.xyz = worldPosition.xyz + offset;"),n.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(n.push("worldPosition = modelMatrix2 * localPosition;"),n.push("worldPosition.xyz = worldPosition.xyz + offset;"),n.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));s&&n.push("   vWorldPosition = worldPosition;");n.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(n.push("vFragDepth = 1.0 + clipPos.w;"),n.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return n.push("gl_Position = clipPos;"),n.push("}"),n}(e),this.fragment=function(e){const t=e.scene,s=t._sectionPlanesState,i=s.sectionPlanes.length>0,r=[];r.push("#version 300 es"),r.push("// Mesh occlusion fragment shader"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),t.logarithmicDepthBufferEnabled&&(r.push("in float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("in float vFragDepth;"));if(i){r.push("uniform bool clippable;"),r.push("in vec4 vWorldPosition;");for(var o=0;o<s.sectionPlanes.length;o++)r.push("uniform bool sectionPlaneActive"+o+";"),r.push("uniform vec3 sectionPlanePos"+o+";"),r.push("uniform vec3 sectionPlaneDir"+o+";")}if(r.push("out vec4 outColor;"),r.push("void main(void) {"),i){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(o=0;o<s.sectionPlanes.length;o++)r.push("if (sectionPlaneActive"+o+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}r.push("   outColor = vec4(0.0, 0.0, 1.0, 1.0); "),t.logarithmicDepthBufferEnabled&&r.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");return r.push("}"),r}(e)}}const Ro=p.vec3(),So=function(e,t){this._hash=e,this._shaderSource=new Fo(t),this._scene=t.scene,this._useCount=0,this._allocate(t)},Oo={};So.get=function(e){const t=[e.scene.canvas.canvas.id,e.scene._sectionPlanesState.getHash(),e._geometry._state.hash,e._state.occlusionHash].join(";");let s=Oo[t];if(!s){if(s=new So(t,e),s.errors)return console.log(s.errors.join("\n")),null;Oo[t]=s,m.memory.programs++}return s._useCount++,s},So.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete Oo[this._hash],m.memory.programs--)},So.prototype.webglContextRestored=function(){this._program=null},So.prototype.drawMesh=function(e,t){this._program||this._allocate(t);const s=this._scene,i=s.canvas.gl,r=t._material._state,o=t._state,n=t._geometry._state,a=t.origin;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),r.id!==this._lastMaterialId){const t=r.backfaces;e.backfaces!==t&&(t?i.disable(i.CULL_FACE):i.enable(i.CULL_FACE),e.backfaces=t);const s=r.frontface;e.frontface!==s&&(s?i.frontFace(i.CCW):i.frontFace(i.CW),e.frontface=s),this._lastMaterialId=r.id}const h=s.camera;if(i.uniformMatrix4fv(this._uViewMatrix,!1,a?e.getRTCViewMatrix(o.originHash,a):h.viewMatrix),o.clippable){const e=s._sectionPlanesState.sectionPlanes.length;if(e>0){const r=s._sectionPlanesState.sectionPlanes,o=t.renderFlags;for(let t=0;t<e;t++){const e=this._uSectionPlanes[t];if(e){const s=o.sectionPlanesActivePerLayer[t];if(i.uniform1i(e.active,s?1:0),s){const s=r[t];i.uniform3fv(e.pos,a?X(s.dist,s.dir,a,Ro):s.pos),i.uniform3fv(e.dir,s.dir)}}}}}i.uniformMatrix4fv(this._uProjMatrix,!1,h._project._state.matrix),i.uniformMatrix4fv(this._uModelMatrix,i.FALSE,t.worldMatrix),this._uClippable&&i.uniform1i(this._uClippable,t._state.clippable),i.uniform3fv(this._uOffset,t._state.offset),n.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&i.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,n.positionsDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(n.positionsBuf,n.compressGeometry?i.UNSIGNED_SHORT:i.FLOAT),e.bindArray++),n.indicesBuf&&(n.indicesBuf.bind(),e.bindArray++),this._lastGeometryId=n.id),n.indicesBuf?(i.drawElements(n.primitive,n.indicesBuf.numItems,n.indicesBuf.itemType,0),e.drawElements++):n.positions&&i.drawArrays(i.TRIANGLES,0,n.positions.numItems)},So.prototype._allocate=function(e){const t=e.scene,s=t.canvas.gl;if(this._program=new Te(s,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uModelMatrix=i.getLocation("modelMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,s=t._sectionPlanesState.sectionPlanes.length;e<s;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._uClippable=i.getLocation("clippable"),this._uOffset=i.getLocation("offset"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null},So.prototype._bindProgram=function(e){const t=this._scene,s=t.camera.project,i=t.canvas.gl;if(this._program.bind(),e.useProgram++,i.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,e)}this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null};class Bo{constructor(e){this.vertex=function(e){const t=e.scene._sectionPlanesState.sectionPlanes.length>0,s=!!e._geometry._state.compressGeometry,i=[];i.push("// Mesh shadow vertex shader"),i.push("in vec3 position;"),i.push("uniform mat4 modelMatrix;"),i.push("uniform mat4 shadowViewMatrix;"),i.push("uniform mat4 shadowProjMatrix;"),i.push("uniform vec3 offset;"),s&&i.push("uniform mat4 positionsDecodeMatrix;");t&&i.push("out vec4 vWorldPosition;");i.push("void main(void) {"),i.push("vec4 localPosition = vec4(position, 1.0); "),i.push("vec4 worldPosition;"),s&&i.push("localPosition = positionsDecodeMatrix * localPosition;");i.push("worldPosition = modelMatrix * localPosition;"),i.push("worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = shadowViewMatrix * worldPosition; "),t&&i.push("vWorldPosition = worldPosition;");return i.push("   gl_Position = shadowProjMatrix * viewPosition;"),i.push("}"),i}(e),this.fragment=function(e){const t=e.scene;t.canvas.gl;const s=t._sectionPlanesState,i=s.sectionPlanes.length>0,r=[];if(r.push("// Mesh shadow fragment shader"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),i){r.push("uniform bool clippable;"),r.push("in vec4 vWorldPosition;");for(var o=0;o<s.sectionPlanes.length;o++)r.push("uniform bool sectionPlaneActive"+o+";"),r.push("uniform vec3 sectionPlanePos"+o+";"),r.push("uniform vec3 sectionPlaneDir"+o+";")}if(r.push("vec4 encodeFloat( const in float depth ) {"),r.push("  const vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);"),r.push("  const vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);"),r.push("  vec4 comp = fract(depth * bitShift);"),r.push("  comp -= comp.xxyz * bitMask;"),r.push("  return comp;"),r.push("}"),r.push("out vec4 outColor;"),r.push("void main(void) {"),i){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(o=0;o<s.sectionPlanes.length;o++)r.push("if (sectionPlaneActive"+o+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}return r.push("outColor = encodeFloat(gl_FragCoord.z);"),r.push("}"),r}(e)}}const Lo=function(e,t){this._hash=e,this._shaderSource=new Bo(t),this._scene=t.scene,this._useCount=0,this._allocate(t)},No={};Lo.get=function(e){const t=e.scene,s=[t.canvas.canvas.id,t._sectionPlanesState.getHash(),e._geometry._state.hash,e._state.hash].join(";");let i=No[s];if(!i){if(i=new Lo(s,e),i.errors)return console.log(i.errors.join("\n")),null;No[s]=i,m.memory.programs++}return i._useCount++,i},Lo.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete No[this._hash],m.memory.programs--)},Lo.prototype.webglContextRestored=function(){this._program=null},Lo.prototype.drawMesh=function(e,t){this._program||this._allocate(t);const s=this._scene.canvas.gl,i=t._material._state,r=t._geometry._state;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),i.id!==this._lastMaterialId){const t=i.backfaces;e.backfaces!==t&&(t?s.disable(s.CULL_FACE):s.enable(s.CULL_FACE),e.backfaces=t);const r=i.frontface;e.frontface!==r&&(r?s.frontFace(s.CCW):s.frontFace(s.CW),e.frontface=r),e.lineWidth!==i.lineWidth&&(s.lineWidth(i.lineWidth),e.lineWidth=i.lineWidth),this._uPointSize&&s.uniform1i(this._uPointSize,i.pointSize),this._lastMaterialId=i.id}if(s.uniformMatrix4fv(this._uModelMatrix,s.FALSE,t.worldMatrix),r.combineGeometry){const i=t.vertexBufs;i.id!==this._lastVertexBufsId&&(i.positionsBuf&&this._aPosition&&(this._aPosition.bindArrayBuffer(i.positionsBuf,i.compressGeometry?s.UNSIGNED_SHORT:s.FLOAT),e.bindArray++),this._lastVertexBufsId=i.id)}this._uClippable&&s.uniform1i(this._uClippable,t._state.clippable),s.uniform3fv(this._uOffset,t._state.offset),r.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&s.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,r.positionsDecodeMatrix),r.combineGeometry?r.indicesBufCombined&&(r.indicesBufCombined.bind(),e.bindArray++):(this._aPosition&&(this._aPosition.bindArrayBuffer(r.positionsBuf,r.compressGeometry?s.UNSIGNED_SHORT:s.FLOAT),e.bindArray++),r.indicesBuf&&(r.indicesBuf.bind(),e.bindArray++)),this._lastGeometryId=r.id),r.combineGeometry?r.indicesBufCombined&&(s.drawElements(r.primitive,r.indicesBufCombined.numItems,r.indicesBufCombined.itemType,0),e.drawElements++):r.indicesBuf?(s.drawElements(r.primitive,r.indicesBuf.numItems,r.indicesBuf.itemType,0),e.drawElements++):r.positions&&(s.drawArrays(s.TRIANGLES,0,r.positions.numItems),e.drawArrays++)},Lo.prototype._allocate=function(e){const t=e.scene,s=t.canvas.gl;if(this._program=new Te(s,this._shaderSource),this._scene=t,this._useCount=0,this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uModelMatrix=i.getLocation("modelMatrix"),this._uShadowViewMatrix=i.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=i.getLocation("shadowProjMatrix"),this._uSectionPlanes={};for(let e=0,s=t._sectionPlanesState.sectionPlanes.length;e<s;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._uClippable=i.getLocation("clippable"),this._uOffset=i.getLocation("offset"),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null},Lo.prototype._bindProgram=function(e){this._program||this._allocate(mesh);const t=this._scene,s=t.canvas.gl,i=t._sectionPlanesState;if(this._program.bind(),e.useProgram++,s.uniformMatrix4fv(this._uShadowViewMatrix,!1,e.shadowViewMatrix),s.uniformMatrix4fv(this._uShadowProjMatrix,!1,e.shadowProjMatrix),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,i.sectionPlanes.length>0){let e,t,r,o,n;for(let a=0,h=this._uSectionPlanes.length;a<h;a++)e=this._uSectionPlanes[a],t=e.active,r=i.sectionPlanes[a],t&&s.uniform1i(t,r.active),o=e.pos,o&&s.uniform3fv(e.pos,r.pos),n=e.dir,n&&s.uniform3fv(e.dir,r.dir)}};const ko=p.OBB3(),jo=p.vec4(),Go=p.vec4(),Ho=p.vec4(),Vo=p.vec3([1,0,0]),Uo=p.vec3([0,1,0]),zo=p.vec3([0,0,1]),Wo=p.vec3(3),Xo=p.vec3(3),Yo=p.identityMat4();class Ko extends A{constructor(e,t={}){super(e,t),this.originalSystemId=t.originalSystemId||this.id,this.renderFlags=new Ys,this._state=new ft({visible:!0,culled:!1,pickable:null,clippable:null,collidable:null,occluder:!1!==t.occluder,castsShadow:null,receivesShadow:null,xrayed:!1,highlighted:!1,selected:!1,edges:!1,stationary:!!t.stationary,background:!!t.background,billboard:this._checkBillboard(t.billboard),layer:null,colorize:null,pickID:this.scene._renderer.getPickID(this),drawHash:"",pickHash:"",offset:p.vec3(),origin:null,originHash:null}),this._drawRenderer=null,this._shadowRenderer=null,this._emphasisFillRenderer=null,this._emphasisEdgesRenderer=null,this._pickMeshRenderer=null,this._pickTriangleRenderer=null,this._occlusionRenderer=null,this._geometry=t.geometry?this._checkComponent2(["ReadableGeometry","VBOGeometry"],t.geometry):this.scene.geometry,this._material=t.material?this._checkComponent2(["PhongMaterial","MetallicMaterial","SpecularMaterial","LambertMaterial"],t.material):this.scene.material,this._xrayMaterial=t.xrayMaterial?this._checkComponent("EmphasisMaterial",t.xrayMaterial):this.scene.xrayMaterial,this._highlightMaterial=t.highlightMaterial?this._checkComponent("EmphasisMaterial",t.highlightMaterial):this.scene.highlightMaterial,this._selectedMaterial=t.selectedMaterial?this._checkComponent("EmphasisMaterial",t.selectedMaterial):this.scene.selectedMaterial,this._edgeMaterial=t.edgeMaterial?this._checkComponent("EdgeMaterial",t.edgeMaterial):this.scene.edgeMaterial,this._parentNode=null,this._aabb=null,this._aabbDirty=!0,this._numTriangles=this._geometry?this._geometry.numTriangles:0,this.scene._aabbDirty=!0,this._scale=p.vec3(),this._quaternion=p.identityQuaternion(),this._rotation=p.vec3(),this._position=p.vec3(),this._worldMatrix=p.identityMat4(),this._worldNormalMatrix=p.identityMat4(),this._localMatrixDirty=!0,this._worldMatrixDirty=!0,this._worldNormalMatrixDirty=!0;const s=t.origin||t.rtcCenter;if(s&&(this._state.origin=p.vec3(s),this._state.originHash=s.join()),t.matrix?this.matrix=t.matrix:(this.scale=t.scale,this.position=t.position,t.quaternion||(this.rotation=t.rotation)),this._isObject=t.isObject,this._isObject&&this.scene._registerObject(this),this._isModel=t.isModel,this._isModel&&this.scene._registerModel(this),this.visible=t.visible,this.culled=t.culled,this.pickable=t.pickable,this.clippable=t.clippable,this.collidable=t.collidable,this.castsShadow=t.castsShadow,this.receivesShadow=t.receivesShadow,this.xrayed=t.xrayed,this.highlighted=t.highlighted,this.selected=t.selected,this.edges=t.edges,this.layer=t.layer,this.colorize=t.colorize,this.opacity=t.opacity,this.offset=t.offset,t.parentId){const e=this.scene.components[t.parentId];e?e.isNode?e.addChild(this):this.error("Parent is not a Node: '"+t.parentId+"'"):this.error("Parent not found: '"+t.parentId+"'"),this._parentNode=e}else t.parent&&(t.parent.isNode||this.error("Parent is not a Node"),t.parent.addChild(this),this._parentNode=t.parent);this.compile()}get type(){return"Mesh"}get isMesh(){return!0}get parent(){return this._parentNode}get geometry(){return this._geometry}get material(){return this._material}get position(){return this._position}set position(e){this._position.set(e||[0,0,0]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get rotation(){return this._rotation}set rotation(e){this._rotation.set(e||[0,0,0]),p.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get quaternion(){return this._quaternion}set quaternion(e){this._quaternion.set(e||[0,0,0,1]),p.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get scale(){return this._scale}set scale(e){this._scale.set(e||[1,1,1]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get matrix(){return this._localMatrixDirty&&(this.__localMatrix||(this.__localMatrix=p.identityMat4()),p.composeMat4(this._position,this._quaternion,this._scale,this.__localMatrix),this._localMatrixDirty=!1),this.__localMatrix}set matrix(e){this.__localMatrix||(this.__localMatrix=p.identityMat4()),this.__localMatrix.set(e||Yo),p.decomposeMat4(this.__localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._setWorldMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get worldMatrix(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}get worldNormalMatrix(){return this._worldNormalMatrixDirty&&this._buildWorldNormalMatrix(),this._worldNormalMatrix}get isEntity(){return!0}get isModel(){return this._isModel}get isObject(){return this._isObject}get aabb(){return this._aabbDirty&&this._updateAABB(),this._aabb}get origin(){return this._state.origin}set origin(e){e?(this._state.origin||(this._state.origin=p.vec3()),this._state.origin.set(e),this._state.originHash=e.join(),this._setAABBDirty(),this.scene._aabbDirty=!0):this._state.origin&&(this._state.origin=null,this._state.originHash=null,this._setAABBDirty(),this.scene._aabbDirty=!0)}get rtcCenter(){return this.origin}set rtcCenter(e){this.origin=e}get numTriangles(){return this._numTriangles}get visible(){return this._state.visible}set visible(e){e=!1!==e,this._state.visible=e,this._isObject&&this.scene._objectVisibilityUpdated(this),this.glRedraw()}get xrayed(){return this._state.xrayed}set xrayed(e){e=!!e,this._state.xrayed!==e&&(this._state.xrayed=e,this._isObject&&this.scene._objectXRayedUpdated(this),this.glRedraw())}get highlighted(){return this._state.highlighted}set highlighted(e){(e=!!e)!==this._state.highlighted&&(this._state.highlighted=e,this._isObject&&this.scene._objectHighlightedUpdated(this),this.glRedraw())}get selected(){return this._state.selected}set selected(e){(e=!!e)!==this._state.selected&&(this._state.selected=e,this._isObject&&this.scene._objectSelectedUpdated(this),this.glRedraw())}get edges(){return this._state.edges}set edges(e){(e=!!e)!==this._state.edges&&(this._state.edges=e,this.glRedraw())}get culled(){return this._state.culled}set culled(e){this._state.culled=!!e,this.glRedraw()}get clippable(){return this._state.clippable}set clippable(e){e=!1!==e,this._state.clippable!==e&&(this._state.clippable=e,this.glRedraw())}get collidable(){return this._state.collidable}set collidable(e){(e=!1!==e)!==this._state.collidable&&(this._state.collidable=e,this._setAABBDirty(),this.scene._aabbDirty=!0)}get pickable(){return this._state.pickable}set pickable(e){e=!1!==e,this._state.pickable!==e&&(this._state.pickable=e)}get castsShadow(){return this._state.castsShadow}set castsShadow(e){(e=!1!==e)!==this._state.castsShadow&&(this._state.castsShadow=e,this.glRedraw())}get receivesShadow(){return this._state.receivesShadow}set receivesShadow(e){(e=!1!==e)!==this._state.receivesShadow&&(this._state.receivesShadow=e,this._state.hash=e?"/mod/rs;":"/mod;",this.fire("dirty",this))}get saoEnabled(){return!1}get colorize(){return this._state.colorize}set colorize(e){let t=this._state.colorize;t||(t=this._state.colorize=new Float32Array(4),t[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1);const s=!!e;this.scene._objectColorizeUpdated(this,s),this.glRedraw()}get opacity(){return this._state.colorize[3]}set opacity(e){let t=this._state.colorize;t||(t=this._state.colorize=new Float32Array(4),t[0]=1,t[1]=1,t[2]=1);const s=null!=e;t[3]=s?e:1,this.scene._objectOpacityUpdated(this,s),this.glRedraw()}get transparent(){return 2===this._material.alphaMode||this._state.colorize[3]<1}get layer(){return this._state.layer}set layer(e){e=e||0,(e=Math.round(e))!==this._state.layer&&(this._state.layer=e,this._renderer.needStateSort())}get stationary(){return this._state.stationary}get billboard(){return this._state.billboard}get offset(){return this._state.offset}set offset(e){this._state.offset.set(e||[0,0,0]),this._setAABBDirty(),this.glRedraw()}get isDrawable(){return!0}get isStateSortable(){return!0}get xrayMaterial(){return this._xrayMaterial}get highlightMaterial(){return this._highlightMaterial}get selectedMaterial(){return this._selectedMaterial}get edgeMaterial(){return this._edgeMaterial}_checkBillboard(e){return"spherical"!==(e=e||"none")&&"cylindrical"!==e&&"none"!==e&&(this.error("Unsupported value for 'billboard': "+e+" - accepted values are 'spherical', 'cylindrical' and 'none' - defaulting to 'none'."),e="none"),e}compile(){const e=this._makeDrawHash();this._state.drawHash!==e&&(this._state.drawHash=e,this._putDrawRenderers(),this._drawRenderer=uo.get(this),this._emphasisFillRenderer=go.get(this),this._emphasisEdgesRenderer=xo.get(this));const t=this._makePickHash();if(this._state.pickHash!==t&&(this._state.pickHash=t,this._putPickRenderers(),this._pickMeshRenderer=Mo.get(this)),this._state.occluder){const e=this._makeOcclusionHash();this._state.occlusionHash!==e&&(this._state.occlusionHash=e,this._putOcclusionRenderer(),this._occlusionRenderer=So.get(this))}}_setLocalMatrixDirty(){this._localMatrixDirty=!0,this._setWorldMatrixDirty()}_setWorldMatrixDirty(){this._worldMatrixDirty=!0,this._worldNormalMatrixDirty=!0}_buildWorldMatrix(){const e=this.matrix;if(this._parentNode)p.mulMat4(this._parentNode.worldMatrix,e,this._worldMatrix);else for(let t=0,s=e.length;t<s;t++)this._worldMatrix[t]=e[t];this._worldMatrixDirty=!1}_buildWorldNormalMatrix(){this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldNormalMatrix||(this._worldNormalMatrix=p.mat4()),p.transposeMat4(this._worldMatrix,this._worldNormalMatrix),p.inverseMat4(this._worldNormalMatrix),this._worldNormalMatrixDirty=!1}_setAABBDirty(){if(this.collidable)for(let e=this;e;e=e._parentNode)e._aabbDirty=!0}_updateAABB(){this.scene._aabbDirty=!0,this._aabb||(this._aabb=p.AABB3()),this._buildAABB(this.worldMatrix,this._aabb),this._aabbDirty=!1}_webglContextRestored(){this._drawRenderer&&this._drawRenderer.webglContextRestored(),this._shadowRenderer&&this._shadowRenderer.webglContextRestored(),this._emphasisFillRenderer&&this._emphasisFillRenderer.webglContextRestored(),this._emphasisEdgesRenderer&&this._emphasisEdgesRenderer.webglContextRestored(),this._pickMeshRenderer&&this._pickMeshRenderer.webglContextRestored(),this._pickTriangleRenderer&&this._pickMeshRenderer.webglContextRestored(),this._occlusionRenderer&&this._occlusionRenderer.webglContextRestored()}_makeDrawHash(){const e=this.scene,t=[e.canvas.canvas.id,(e.gammaInput?"gi;":";")+(e.gammaOutput?"go":""),e._lightsState.getHash(),e._sectionPlanesState.getHash()],s=this._state;return s.stationary&&t.push("/s"),"none"===s.billboard?t.push("/n"):"spherical"===s.billboard?t.push("/s"):"cylindrical"===s.billboard&&t.push("/c"),s.receivesShadow&&t.push("/rs"),t.push(";"),t.join("")}_makePickHash(){const e=this.scene,t=[e.canvas.canvas.id,e._sectionPlanesState.getHash()],s=this._state;return s.stationary&&t.push("/s"),"none"===s.billboard?t.push("/n"):"spherical"===s.billboard?t.push("/s"):"cylindrical"===s.billboard&&t.push("/c"),t.push(";"),t.join("")}_makeOcclusionHash(){const e=this.scene,t=[e.canvas.canvas.id,e._sectionPlanesState.getHash()],s=this._state;return s.stationary&&t.push("/s"),"none"===s.billboard?t.push("/n"):"spherical"===s.billboard?t.push("/s"):"cylindrical"===s.billboard&&t.push("/c"),t.push(";"),t.join("")}_buildAABB(e,t){p.transformOBB3(e,this._geometry.obb,ko),p.OBB3ToAABB3(ko,t);const s=this._state.offset;if(t[0]+=s[0],t[1]+=s[1],t[2]+=s[2],t[3]+=s[0],t[4]+=s[1],t[5]+=s[2],this._state.origin){const e=this._state.origin;t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t[3]+=e[0],t[4]+=e[1],t[5]+=e[2]}}rotate(e,t){return jo[0]=e[0],jo[1]=e[1],jo[2]=e[2],jo[3]=t*p.DEGTORAD,p.angleAxisToQuaternion(jo,Go),p.mulQuaternions(this.quaternion,Go,Ho),this.quaternion=Ho,this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}rotateOnWorldAxis(e,t){return jo[0]=e[0],jo[1]=e[1],jo[2]=e[2],jo[3]=t*p.DEGTORAD,p.angleAxisToQuaternion(jo,Go),p.mulQuaternions(Go,this.quaternion,Go),this}rotateX(e){return this.rotate(Vo,e)}rotateY(e){return this.rotate(Uo,e)}rotateZ(e){return this.rotate(zo,e)}translate(e,t){return p.vec3ApplyQuaternion(this.quaternion,e,Wo),p.mulVec3Scalar(Wo,t,Xo),p.addVec3(this.position,Xo,this.position),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}translateX(e){return this.translate(Vo,e)}translateY(e){return this.translate(Uo,e)}translateZ(e){return this.translate(zo,e)}_putDrawRenderers(){this._drawRenderer&&(this._drawRenderer.put(),this._drawRenderer=null),this._shadowRenderer&&(this._shadowRenderer.put(),this._shadowRenderer=null),this._emphasisFillRenderer&&(this._emphasisFillRenderer.put(),this._emphasisFillRenderer=null),this._emphasisEdgesRenderer&&(this._emphasisEdgesRenderer.put(),this._emphasisEdgesRenderer=null)}_putPickRenderers(){this._pickMeshRenderer&&(this._pickMeshRenderer.put(),this._pickMeshRenderer=null),this._pickTriangleRenderer&&(this._pickTriangleRenderer.put(),this._pickTriangleRenderer=null)}_putOcclusionRenderer(){this._occlusionRenderer&&(this._occlusionRenderer.put(),this._occlusionRenderer=null)}stateSortCompare(e,t){return e._state.layer-t._state.layer||e._drawRenderer.id-t._drawRenderer.id||e._material._state.id-t._material._state.id||e._geometry._state.id-t._geometry._state.id}rebuildRenderFlags(){this.renderFlags.reset(),this._getActiveSectionPlanes()?(this.renderFlags.numLayers=1,this.renderFlags.numVisibleLayers=1,this.renderFlags.visibleLayers[0]=0,this._updateRenderFlags()):this.renderFlags.culled=!0}_updateRenderFlags(){const e=this.renderFlags,t=this._state;if(t.xrayed){const t=this._xrayMaterial._state;t.fill&&(t.fillAlpha<1?e.xrayedSilhouetteTransparent=!0:e.xrayedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.xrayedEdgesTransparent=!0:e.xrayedEdgesOpaque=!0)}else{if(this._material._state.alpha<1||t.colorize[3]<1?e.colorTransparent=!0:e.colorOpaque=!0,t.edges){this._edgeMaterial._state.alpha<1?e.edgesTransparent=!0:e.edgesOpaque=!0}if(t.selected){const t=this._selectedMaterial._state;t.fill&&(t.fillAlpha<1?e.selectedSilhouetteTransparent=!0:e.selectedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.selectedEdgesTransparent=!0:e.selectedEdgesOpaque=!0)}else if(t.highlighted){const t=this._highlightMaterial._state;t.fill&&(t.fillAlpha<1?e.highlightedSilhouetteTransparent=!0:e.highlightedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.highlightedEdgesTransparent=!0:e.highlightedEdgesOpaque=!0)}}}_getActiveSectionPlanes(){if(this._state.clippable){const e=this.scene._sectionPlanesState.sectionPlanes,t=e.length;if(t>0)for(let s=0;s<t;s++){const t=e[s],i=this.renderFlags;if(t.active)if(this._state.origin){const e=p.planeAABB3Intersect(t.dir,t.dist,this.aabb);if(-1===e)return!1;const r=0===e;i.sectionPlanesActivePerLayer[s]=r}else i.sectionPlanesActivePerLayer[s]=!0;else i.sectionPlanesActivePerLayer[s]=!1}}return!0}drawColorOpaque(e){(this._drawRenderer||(this._drawRenderer=uo.get(this)))&&this._drawRenderer.drawMesh(e,this)}drawColorTransparent(e){(this._drawRenderer||(this._drawRenderer=uo.get(this)))&&this._drawRenderer.drawMesh(e,this)}drawSilhouetteXRayed(e){(this._emphasisFillRenderer||(this._emphasisFillRenderer=go.get(this)))&&this._emphasisFillRenderer.drawMesh(e,this,0)}drawSilhouetteHighlighted(e){(this._emphasisFillRenderer||(this._emphasisFillRenderer=go.get(this)))&&this._emphasisFillRenderer.drawMesh(e,this,1)}drawSilhouetteSelected(e){(this._emphasisFillRenderer||(this._emphasisFillRenderer=go.get(this)))&&this._emphasisFillRenderer.drawMesh(e,this,2)}drawEdgesColorOpaque(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=xo.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,3)}drawEdgesColorTransparent(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=xo.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,3)}drawEdgesXRayed(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=xo.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,0)}drawEdgesHighlighted(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=xo.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,1)}drawEdgesSelected(e){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=xo.get(this)))&&this._emphasisEdgesRenderer.drawMesh(e,this,2)}drawOcclusion(e){(this._state.occluder&&this._occlusionRenderer||(this._occlusionRenderer=So.get(this)))&&this._occlusionRenderer.drawMesh(e,this)}drawShadow(e){(this._shadowRenderer||(this._shadowRenderer=Lo.get(this)))&&this._shadowRenderer.drawMesh(e,this)}drawPickMesh(e){(this._pickMeshRenderer||(this._pickMeshRenderer=Mo.get(this)))&&this._pickMeshRenderer.drawMesh(e,this)}canPickTriangle(){return this._geometry.isReadableGeometry}drawPickTriangles(e){(this._pickTriangleRenderer||(this._pickTriangleRenderer=Ao.get(this)))&&this._pickTriangleRenderer.drawMesh(e,this)}pickTriangleSurface(e,t,s){Jo(this,e,t,s)}drawPickVertices(e){}delegatePickedEntity(){return this}destroy(){super.destroy(),this._putDrawRenderers(),this._putPickRenderers(),this._putOcclusionRenderer(),this.scene._renderer.putPickID(this._state.pickID),this._isObject&&(this.scene._deregisterObject(this),this._visible&&this.scene._objectVisibilityUpdated(this,!1),this._xrayed&&this.scene._objectXRayedUpdated(this,!1),this._selected&&this.scene._objectSelectedUpdated(this,!1),this._highlighted&&this.scene._objectHighlightedUpdated(this,!1),this.scene._objectColorizeUpdated(this,!1),this.scene._objectOpacityUpdated(this,!1),this.scene._objectOffsetUpdated(this,!1)),this._isModel&&this.scene._deregisterModel(this),this.glRedraw()}}const Jo=function(){const e=p.vec3(),t=p.vec3(),s=p.vec3(),i=p.vec3(),r=p.vec3(),o=p.vec3(),n=p.vec4(),a=p.vec3(),h=p.vec3(),l=p.vec3(),u=p.vec3(),c=p.vec3(),d=p.vec3(),m=p.vec3(),f=p.vec3(),g=p.vec3(),_=p.vec4(),y=p.vec4(),v=p.vec4(),b=p.vec3(),x=p.vec3(),P=p.vec3(),T=p.vec3(),w=p.vec3(),M=p.vec3(),I=p.vec3(),C=p.vec3(),D=p.vec3(),A=p.vec3(),E=p.vec3();return function(F,R,S,O){var B=O.primIndex;if(null!=B&&B>-1){const j=F.geometry._state,G=F.scene,H=G.camera,V=G.canvas;if("triangles"===j.primitiveName){O.primitive="triangle";const G=B,U=j.indices,z=j.positions;let W,X,Y,K;if(U){var L=U[G+0],N=U[G+1],k=U[G+2];o[0]=L,o[1]=N,o[2]=k,O.indices=o,W=3*L,X=3*N,Y=3*k}else W=3*G,X=W+3,Y=X+3;if(s[0]=z[W+0],s[1]=z[W+1],s[2]=z[W+2],i[0]=z[X+0],i[1]=z[X+1],i[2]=z[X+2],r[0]=z[Y+0],r[1]=z[Y+1],r[2]=z[Y+2],j.compressGeometry){const e=j.positionsDecodeMatrix;e&&(Pt.decompressPosition(s,e,s),Pt.decompressPosition(i,e,i),Pt.decompressPosition(r,e,r))}O.canvasPos?(K=O.canvasPos,p.canvasPosToLocalRay(V.canvas,R,S,F.worldMatrix,K,e,t)):O.origin&&O.direction&&p.worldRayToLocalRay(F.worldMatrix,O.origin,O.direction,e,t),p.normalizeVec3(t),p.rayPlaneIntersect(e,t,s,i,r,n),O.localPos=n,O.position=n,_[0]=n[0],_[1]=n[1],_[2]=n[2],_[3]=1,p.transformVec4(F.worldMatrix,_,y),a[0]=y[0],a[1]=y[1],a[2]=y[2],O.worldPos=a,p.transformVec4(H.matrix,y,v),h[0]=v[0],h[1]=v[1],h[2]=v[2],O.viewPos=h,p.cartesianToBarycentric(n,s,i,r,l),O.bary=l;const J=j.normals;if(J){if(j.compressGeometry){const e=3*L,t=3*N,s=3*k;Pt.decompressNormal(J.subarray(e,e+2),u),Pt.decompressNormal(J.subarray(t,t+2),c),Pt.decompressNormal(J.subarray(s,s+2),d)}else u[0]=J[W],u[1]=J[W+1],u[2]=J[W+2],c[0]=J[X],c[1]=J[X+1],c[2]=J[X+2],d[0]=J[Y],d[1]=J[Y+1],d[2]=J[Y+2];const e=p.addVec3(p.addVec3(p.mulVec3Scalar(u,l[0],b),p.mulVec3Scalar(c,l[1],x),P),p.mulVec3Scalar(d,l[2],T),w);O.worldNormal=p.normalizeVec3(p.transformVec3(F.worldNormalMatrix,e,M))}const Z=j.uv;if(Z){if(m[0]=Z[2*L],m[1]=Z[2*L+1],f[0]=Z[2*N],f[1]=Z[2*N+1],g[0]=Z[2*k],g[1]=Z[2*k+1],j.compressGeometry){const e=j.uvDecodeMatrix;e&&(Pt.decompressUV(m,e,m),Pt.decompressUV(f,e,f),Pt.decompressUV(g,e,g))}O.uv=p.addVec3(p.addVec3(p.mulVec2Scalar(m,l[0],I),p.mulVec2Scalar(f,l[1],C),D),p.mulVec2Scalar(g,l[2],A),E)}}}}}();function Zo(e={}){let t=e.radiusTop||1;t<0&&(console.error("negative radiusTop not allowed - will invert"),t*=-1);let s=e.radiusBottom||1;s<0&&(console.error("negative radiusBottom not allowed - will invert"),s*=-1);let i=e.height||1;i<0&&(console.error("negative height not allowed - will invert"),i*=-1);let r=e.radialSegments||32;r<0&&(console.error("negative radialSegments not allowed - will invert"),r*=-1),r<3&&(r=3);let o=e.heightSegments||1;o<0&&(console.error("negative heightSegments not allowed - will invert"),o*=-1),o<1&&(o=1);const n=!!e.openEnded;let a=e.center;const h=a?a[0]:0,l=a?a[1]:0,u=a?a[2]:0,c=i/2,p=i/o,d=2*Math.PI/r,m=1/r,f=(t-s)/o,g=[],_=[],v=[],b=[];let x,P,T,w,M,I,C,D,A,E,F;const R=(90-180*Math.atan(i/(s-t))/Math.PI)/90;for(x=0;x<=o;x++)for(M=t-x*f,I=c-x*p,P=0;P<=r;P++)T=Math.sin(P*d),w=Math.cos(P*d),_.push(M*T),_.push(R),_.push(M*w),v.push(P*m),v.push(1*x/o),g.push(M*T+h),g.push(I+l),g.push(M*w+u);for(x=0;x<o;x++)for(P=0;P<=r;P++)C=x*(r+1)+P,D=C+r,b.push(C),b.push(D),b.push(D+1),b.push(C),b.push(D+1),b.push(C+1);if(!n&&t>0){for(A=g.length/3,_.push(0),_.push(1),_.push(0),v.push(.5),v.push(.5),g.push(0+h),g.push(c+l),g.push(0+u),P=0;P<=r;P++)T=Math.sin(P*d),w=Math.cos(P*d),E=.5*Math.sin(P*d)+.5,F=.5*Math.cos(P*d)+.5,_.push(t*T),_.push(1),_.push(t*w),v.push(E),v.push(F),g.push(t*T+h),g.push(c+l),g.push(t*w+u);for(P=0;P<r;P++)a=A,C=A+1+P,b.push(C),b.push(C+1),b.push(a)}if(!n&&s>0){for(A=g.length/3,_.push(0),_.push(-1),_.push(0),v.push(.5),v.push(.5),g.push(0+h),g.push(0-c+l),g.push(0+u),P=0;P<=r;P++)T=Math.sin(P*d),w=Math.cos(P*d),E=.5*Math.sin(P*d)+.5,F=.5*Math.cos(P*d)+.5,_.push(s*T),_.push(-1),_.push(s*w),v.push(E),v.push(F),g.push(s*T+h),g.push(0-c+l),g.push(s*w+u);for(P=0;P<r;P++)a=A,C=A+1+P,b.push(a),b.push(C+1),b.push(C)}return y.apply(e,{positions:g,normals:_,uv:v,indices:b})}function Qo(e={}){const t=e.lod||1,s=e.center?e.center[0]:0,i=e.center?e.center[1]:0,r=e.center?e.center[2]:0;let o=e.radius||1;o<0&&(console.error("negative radius not allowed - will invert"),o*=-1);let n=e.heightSegments||18;n<0&&(console.error("negative heightSegments not allowed - will invert"),n*=-1),n=Math.floor(t*n),n<18&&(n=18);let a=e.widthSegments||18;a<0&&(console.error("negative widthSegments not allowed - will invert"),a*=-1),a=Math.floor(t*a),a<18&&(a=18);const h=[],l=[],u=[],c=[];let p,d,m,f,g,_,v,b,x,P,T,w,M,I,C;for(p=0;p<=n;p++)for(m=p*Math.PI/n,f=Math.sin(m),g=Math.cos(m),d=0;d<=a;d++)_=2*d*Math.PI/a,v=Math.sin(_),b=Math.cos(_),x=b*f,P=g,T=v*f,w=1-d/a,M=p/n,l.push(x),l.push(P),l.push(T),u.push(w),u.push(M),h.push(s+o*x),h.push(i+o*P),h.push(r+o*T);for(p=0;p<n;p++)for(d=0;d<a;d++)I=p*(a+1)+d,C=I+a+1,c.push(I+1),c.push(C+1),c.push(C),c.push(I+1),c.push(C),c.push(I);return y.apply(e,{positions:h,normals:l,uv:u,indices:c})}const qo={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},";":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}};function $o(e={}){var t=e.origin||[0,0,0],s=t[0],i=t[1],r=t[2],o=e.size||1,n=[],a=[],h=e.text;y.isNumeric(h)&&(h=""+h);for(var l,u,c,p,d,m,f,g,_,v=(h||"").split("\n"),b=0,x=0,P=.04,T=0;T<v.length;T++){l=0,c=(u=v[T]).length;for(var w=0;w<c;w++)if(p=qo[u.charAt(w)]){d=1,m=-1,f=-1,g=p.points.length;for(var M=0;M<g;M++)-1!==(_=p.points[M])[0]||-1!==_[1]?(n.push(l+_[0]*o*P+s),n.push(x+_[1]*o*P+i),n.push(0+r),-1===m?m=b:(-1===f||(m=f),f=b),b++,d?d=!1:(a.push(m),a.push(f))):d=1;l+=p.width*P*o}x-=35*P*o}return y.apply(e,{primitive:"lines",positions:n,indices:a})}class en extends n{constructor(e,t){super("AxisGizmo",e,t=t||{});const s=e.scene.camera;t.canvasId||t.canvasElement||this.error("Config expected: either 'canvasId' or 'canvasElement'");try{this._axisGizmoScene=new Ui(e,{canvasId:t.canvasId,canvasElement:t.canvasElement,transparent:!0})}catch(e){return void this.error(e)}const i=this._axisGizmoScene;i.clearLights(),new xi(i,{color:[.45,.45,.5],intensity:.9}),new bi(i,{dir:[-.5,.5,-.6],color:[.8,.8,.7],intensity:1,space:"view"}),new bi(i,{dir:[.5,-.5,-.6],color:[.8,.8,.8],intensity:1,space:"view"});const r=i.camera;s.on("matrix",(function(){const e=s.eye,t=s.look,i=s.up,o=p.mulVec3Scalar(p.normalizeVec3(p.subVec3(e,t,[])),22);r.look=[0,0,0],r.eye=o,r.up=i}));const o=new Mi(i,Zo({radiusTop:.01,radiusBottom:.6,height:1.7,radialSegments:20,heightSegments:1,openEnded:!1})),n=new Mi(i,Zo({radiusTop:.2,radiusBottom:.2,height:4.5,radialSegments:20,heightSegments:1,openEnded:!1})),a=new Ei(i,{diffuse:[1,.3,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),h=new Ei(i,{emissive:[1,.3,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),l=new Ei(i,{diffuse:[.3,1,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),u=new Ei(i,{emissive:[.3,1,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),c=new Ei(i,{diffuse:[.3,.3,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),d=new Ei(i,{emissive:[.3,.3,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),m=new Ei(i,{diffuse:[.5,.5,.5],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2});this._meshes=[new Ko(i,{geometry:new Mi(i,Qo({radius:9,heightSegments:60,widthSegments:60})),material:new Ei(i,{diffuse:[0,0,0],emissive:[.1,.1,.1],ambient:[.1,.1,.2],specular:[0,0,0],alpha:.4,alphaMode:"blend",frontface:"cw"}),pickable:!1,collidable:!1,visible:!1!==t.visible}),new Ko(i,{geometry:new Mi(i,Qo({radius:1})),material:m,pickable:!1,collidable:!1,visible:!1!==t.visible}),new Ko(i,{geometry:o,material:a,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[5,0,0],rotation:[0,0,-90]}),new Ko(i,{geometry:n,material:a,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[2,0,0],rotation:[0,0,90]}),new Ko(i,{geometry:new Mi(i,$o({text:"X",size:1.5})),material:h,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[7,0,0],billboard:"spherical"}),new Ko(i,{geometry:o,material:l,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,5,0]}),new Ko(i,{geometry:n,material:l,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,2,0]}),new Ko(i,{geometry:new Mi(i,$o({text:"Y",size:1.5})),material:u,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,7,0],billboard:"spherical"}),new Ko(i,{geometry:o,material:c,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,0,5],rotation:[90,0,0]}),new Ko(i,{geometry:n,material:c,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,0,2],rotation:[90,0,0]}),new Ko(i,{geometry:new Mi(i,$o({text:"Z",size:1.5})),material:d,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,0,7],billboard:"spherical"})]}setVisible(e){for(let t=0;t<this._meshes.length;t++)this._meshes[t].visible=e}destroy(){this._axisGizmoCanvas=null,this._axisGizmoScene.destroy(),this._axisGizmoScene=null,super.destroy()}}class tn extends A{get type(){return"SectionPlane"}constructor(e,t={}){super(e,t),this._state=new ft({active:!0,pos:p.vec3(),dir:p.vec3(),dist:0}),this.active=t.active,this.pos=t.pos,this.dir=t.dir,this.scene._sectionPlaneCreated(this)}set active(e){this._state.active=!1!==e,this.glRedraw(),this.fire("active",this._state.active)}get active(){return this._state.active}set pos(e){this._state.pos.set(e||[0,0,0]),this._state.dist=-p.dotVec3(this._state.pos,this._state.dir),this.fire("pos",this._state.pos)}get pos(){return this._state.pos}set dir(e){this._state.dir.set(e||[0,0,-1]),this._state.dist=-p.dotVec3(this._state.pos,this._state.dir),this.glRedraw(),this.fire("dir",this._state.dir)}get dir(){return this._state.dir}get dist(){return this._state.dist}flipDir(){const e=this._state.dir;e[0]*=-1,e[1]*=-1,e[2]*=-1,this._state.dist=-p.dotVec3(this._state.pos,this._state.dir),this.fire("dir",this._state.dir),this.glRedraw()}destroy(){this._state.destroy(),this.scene._sectionPlaneDestroyed(this),super.destroy()}}const sn=p.vec4(4),rn=p.vec4(),on=p.vec4(),nn=p.vec3([1,0,0]),an=p.vec3([0,1,0]),hn=p.vec3([0,0,1]),ln=p.vec3(3),un=p.vec3(3),cn=p.identityMat4();class pn extends A{constructor(e,t={}){if(super(e,t),this._parentNode=null,this._children=[],this._aabb=null,this._aabbDirty=!0,this.scene._aabbDirty=!0,this._numTriangles=0,this._scale=p.vec3(),this._quaternion=p.identityQuaternion(),this._rotation=p.vec3(),this._position=p.vec3(),this._offset=p.vec3(),this._localMatrix=p.identityMat4(),this._worldMatrix=p.identityMat4(),this._localMatrixDirty=!0,this._worldMatrixDirty=!0,t.matrix?this.matrix=t.matrix:(this.scale=t.scale,this.position=t.position,t.quaternion||(this.rotation=t.rotation)),this._isModel=t.isModel,this._isModel&&this.scene._registerModel(this),this._isObject=t.isObject,this._isObject&&this.scene._registerObject(this),this.origin=t.origin,this.visible=t.visible,this.culled=t.culled,this.pickable=t.pickable,this.clippable=t.clippable,this.collidable=t.collidable,this.castsShadow=t.castsShadow,this.receivesShadow=t.receivesShadow,this.xrayed=t.xrayed,this.highlighted=t.highlighted,this.selected=t.selected,this.edges=t.edges,this.colorize=t.colorize,this.opacity=t.opacity,this.offset=t.offset,t.children){const e=t.children;for(let s=0,i=e.length;s<i;s++)this.addChild(e[s],t.inheritStates)}if(t.parentId){const e=this.scene.components[t.parentId];e?e.isNode?e.addChild(this):this.error("Parent is not a Node: '"+t.parentId+"'"):this.error("Parent not found: '"+t.parentId+"'")}else t.parent&&(t.parent.isNode||this.error("Parent is not a Node"),t.parent.addChild(this))}get isEntity(){return!0}get isModel(){return this._isModel}get isObject(){return this._isObject}get aabb(){return this._aabbDirty&&this._updateAABB(),this._aabb}set origin(e){e?(this._origin||(this._origin=p.vec3()),this._origin.set(e)):this._origin&&(this._origin=null);for(let t=0,s=this._children.length;t<s;t++)this._children[t].origin=e;this.glRedraw()}get origin(){return this._origin}set rtcCenter(e){this.origin=e}get rtcCenter(){return this.origin}get numTriangles(){return this._numTriangles}set visible(e){e=!1!==e,this._visible=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].visible=e;this._isObject&&this.scene._objectVisibilityUpdated(this,e)}get visible(){return this._visible}set xrayed(e){e=!!e,this._xrayed=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].xrayed=e;this._isObject&&this.scene._objectXRayedUpdated(this,e)}get xrayed(){return this._xrayed}set highlighted(e){e=!!e,this._highlighted=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].highlighted=e;this._isObject&&this.scene._objectHighlightedUpdated(this,e)}get highlighted(){return this._highlighted}set selected(e){e=!!e,this._selected=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].selected=e;this._isObject&&this.scene._objectSelectedUpdated(this,e)}get selected(){return this._selected}set edges(e){e=!!e,this._edges=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].edges=e}get edges(){return this._edges}set culled(e){e=!!e,this._culled=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].culled=e}get culled(){return this._culled}set clippable(e){e=!1!==e,this._clippable=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].clippable=e}get clippable(){return this._clippable}set collidable(e){e=!1!==e,this._collidable=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].collidable=e}get collidable(){return this._collidable}set pickable(e){e=!1!==e,this._pickable=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].pickable=e}get pickable(){return this._pickable}set colorize(e){let t=this._colorize;t||(t=this._colorize=new Float32Array(4),t[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1);for(let e=0,s=this._children.length;e<s;e++)this._children[e].colorize=t;if(this._isObject){const t=!!e;this.scene._objectColorizeUpdated(this,t)}}get colorize(){return this._colorize.slice(0,3)}set opacity(e){let t=this._colorize;t||(t=this._colorize=new Float32Array(4),t[0]=1,t[1]=1,t[2]=1),t[3]=null!=e?e:1;for(let t=0,s=this._children.length;t<s;t++)this._children[t].opacity=e;if(this._isObject){const t=null!=e;this.scene._objectOpacityUpdated(this,t)}}get opacity(){return this._colorize[3]}set castsShadow(e){e=!!e,this._castsShadow=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].castsShadow=e}get castsShadow(){return this._castsShadow}set receivesShadow(e){e=!!e,this._receivesShadow=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].receivesShadow=e}get receivesShadow(){return this._receivesShadow}get saoEnabled(){return!1}set offset(e){e?(this._offset[0]=e[0],this._offset[1]=e[1],this._offset[2]=e[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(let e=0,t=this._children.length;e<t;e++)this._children[e].offset=this._offset;this._isObject&&this.scene._objectOffsetUpdated(this,e)}get offset(){return this._offset}get isNode(){return!0}_setLocalMatrixDirty(){this._localMatrixDirty=!0,this._setWorldMatrixDirty()}_setWorldMatrixDirty(){this._worldMatrixDirty=!0;for(let e=0,t=this._children.length;e<t;e++)this._children[e]._setWorldMatrixDirty()}_buildWorldMatrix(){const e=this.matrix;if(this._parentNode)p.mulMat4(this._parentNode.worldMatrix,e,this._worldMatrix);else for(let t=0,s=e.length;t<s;t++)this._worldMatrix[t]=e[t];this._worldMatrixDirty=!1}_setSubtreeAABBsDirty(e){if(e._aabbDirty=!0,e._children)for(let t=0,s=e._children.length;t<s;t++)this._setSubtreeAABBsDirty(e._children[t])}_setAABBDirty(){if(this._setSubtreeAABBsDirty(this),this.collidable)for(let e=this;e;e=e._parentNode)e._aabbDirty=!0}_updateAABB(){if(this.scene._aabbDirty=!0,this._aabb||(this._aabb=p.AABB3()),this._buildAABB)this._buildAABB(this.worldMatrix,this._aabb);else{let e;p.collapseAABB3(this._aabb);for(let t=0,s=this._children.length;t<s;t++)e=this._children[t],e.collidable&&p.expandAABB3(this._aabb,e.aabb)}this._aabbDirty=!1}addChild(e,t){if(y.isNumeric(e)||y.isString(e)){const t=e;if(!(e=this.scene.component[t]))return void this.warn("Component not found: "+y.inQuotes(t));if(!e.isNode&&!e.isMesh)return void this.error("Not a Node or Mesh: "+t)}else{if(!e.isNode&&!e.isMesh)return void this.error("Not a Node or Mesh: "+e.id);if(e._parentNode){if(e._parentNode.id===this.id)return void this.warn("Already a child: "+e.id);e._parentNode.removeChild(e)}}if(e.id,e.scene.id===this.scene.id)return this._children.push(e),e._parentNode=this,t&&(e.visible=this.visible,e.culled=this.culled,e.xrayed=this.xrayed,e.highlited=this.highlighted,e.selected=this.selected,e.edges=this.edges,e.clippable=this.clippable,e.pickable=this.pickable,e.collidable=this.collidable,e.castsShadow=this.castsShadow,e.receivesShadow=this.receivesShadow,e.colorize=this.colorize,e.opacity=this.opacity,e.offset=this.offset),e._setWorldMatrixDirty(),e._setAABBDirty(),this._numTriangles+=e.numTriangles,e;this.error("Child not in same Scene: "+e.id)}removeChild(e){for(let t=0,s=this._children.length;t<s;t++)if(this._children[t].id===e.id)return e._parentNode=null,this._children=this._children.splice(t,1),e._setWorldMatrixDirty(),e._setAABBDirty(),this._setAABBDirty(),void(this._numTriangles-=e.numTriangles)}removeChildren(){let e;for(let t=0,s=this._children.length;t<s;t++)e=this._children[t],e._parentNode=null,e._setWorldMatrixDirty(),e._setAABBDirty(),this._numTriangles-=e.numTriangles;this._children=[],this._setAABBDirty()}get numChildren(){return this._children.length}get children(){return this._children}set parent(e){if(y.isNumeric(e)||y.isString(e)){const t=e;if(!(e=this.scene.components[t]))return void this.warn("Node not found: "+y.inQuotes(t));if(!e.isNode)return void this.error("Not a Node: "+e.id)}e.scene.id===this.scene.id?this._parentNode&&this._parentNode.id===e.id?this.warn("Already a child of Node: "+e.id):e.addChild(this):this.error("Node not in same Scene: "+e.id)}get parent(){return this._parentNode}set position(e){this._position.set(e||[0,0,0]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get position(){return this._position}set rotation(e){this._rotation.set(e||[0,0,0]),p.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get rotation(){return this._rotation}set quaternion(e){this._quaternion.set(e||[0,0,0,1]),p.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get quaternion(){return this._quaternion}set scale(e){this._scale.set(e||[1,1,1]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get scale(){return this._scale}set matrix(e){this._localMatrix||(this._localMatrix=p.identityMat4()),this._localMatrix.set(e||cn),p.decomposeMat4(this._localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._setWorldMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get matrix(){return this._localMatrixDirty&&(this._localMatrix||(this._localMatrix=p.identityMat4()),p.composeMat4(this._position,this._quaternion,this._scale,this._localMatrix),this._localMatrixDirty=!1),this._localMatrix}get worldMatrix(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}rotate(e,t){return sn[0]=e[0],sn[1]=e[1],sn[2]=e[2],sn[3]=t*p.DEGTORAD,p.angleAxisToQuaternion(sn,rn),p.mulQuaternions(this.quaternion,rn,on),this.quaternion=on,this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}rotateOnWorldAxis(e,t){return sn[0]=e[0],sn[1]=e[1],sn[2]=e[2],sn[3]=t*p.DEGTORAD,p.angleAxisToQuaternion(sn,rn),p.mulQuaternions(rn,this.quaternion,rn),this}rotateX(e){return this.rotate(nn,e)}rotateY(e){return this.rotate(an,e)}rotateZ(e){return this.rotate(hn,e)}translate(e,t){return p.vec3ApplyQuaternion(this.quaternion,e,ln),p.mulVec3Scalar(ln,t,un),p.addVec3(this.position,un,this.position),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}translateX(e){return this.translate(nn,e)}translateY(e){return this.translate(an,e)}translateZ(e){return this.translate(hn,e)}get type(){return"Node"}destroy(){if(super.destroy(),this._parentNode&&this._parentNode.removeChild(this),this._isObject&&(this.scene._deregisterObject(this),this._visible&&this.scene._objectVisibilityUpdated(this,!1),this._xrayed&&this.scene._objectXRayedUpdated(this,!1),this._selected&&this.scene._objectSelectedUpdated(this,!1),this._highlighted&&this.scene._objectHighlightedUpdated(this,!1),this.scene._objectColorizeUpdated(this,!1),this.scene._objectOpacityUpdated(this,!1),this.scene._objectOffsetUpdated(this,!1)),this._isModel&&this.scene._deregisterModel(this),this._children.length){const e=this._children.splice();let t;for(let s=0,i=e.length;s<i;s++)t=e[s],t.destroy()}this._children=[],this._setAABBDirty(),this.scene._aabbDirty=!0}}class dn extends Ci{get type(){return"LambertMaterial"}constructor(e,t={}){super(e,t),this._state=new ft({type:"LambertMaterial",ambient:p.vec3([1,1,1]),color:p.vec3([1,1,1]),emissive:p.vec3([0,0,0]),alpha:null,alphaMode:0,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:"/lam;"}),this.ambient=t.ambient,this.color=t.color,this.emissive=t.emissive,this.alpha=t.alpha,this.lineWidth=t.lineWidth,this.pointSize=t.pointSize,this.backfaces=t.backfaces,this.frontface=t.frontface}set ambient(e){let t=this._state.ambient;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.ambient=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}get ambient(){return this._state.ambient}set color(e){let t=this._state.color;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.color=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get color(){return this._state.color}set emissive(e){let t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}set alpha(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this._state.alphaMode=e<1?2:0,this.glRedraw())}get alpha(){return this._state.alpha}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(e){this._state.pointSize=e||1,this.glRedraw()}get pointSize(){return this._state.pointSize}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}_getState(){return this._state}destroy(){super.destroy(),this._state.destroy()}}const mn={opaque:0,mask:1,blend:2},fn=["opaque","mask","blend"];class gn extends Ci{get type(){return"MetallicMaterial"}constructor(e,t={}){super(e,t),this._state=new ft({type:"MetallicMaterial",baseColor:p.vec4([1,1,1]),emissive:p.vec4([0,0,0]),metallic:null,roughness:null,specularF0:null,alpha:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),this.baseColor=t.baseColor,this.metallic=t.metallic,this.roughness=t.roughness,this.specularF0=t.specularF0,this.emissive=t.emissive,this.alpha=t.alpha,t.baseColorMap&&(this._baseColorMap=this._checkComponent("Texture",t.baseColorMap)),t.metallicMap&&(this._metallicMap=this._checkComponent("Texture",t.metallicMap)),t.roughnessMap&&(this._roughnessMap=this._checkComponent("Texture",t.roughnessMap)),t.metallicRoughnessMap&&(this._metallicRoughnessMap=this._checkComponent("Texture",t.metallicRoughnessMap)),t.emissiveMap&&(this._emissiveMap=this._checkComponent("Texture",t.emissiveMap)),t.occlusionMap&&(this._occlusionMap=this._checkComponent("Texture",t.occlusionMap)),t.alphaMap&&(this._alphaMap=this._checkComponent("Texture",t.alphaMap)),t.normalMap&&(this._normalMap=this._checkComponent("Texture",t.normalMap)),this.alphaMode=t.alphaMode,this.alphaCutoff=t.alphaCutoff,this.backfaces=t.backfaces,this.frontface=t.frontface,this.lineWidth=t.lineWidth,this.pointSize=t.pointSize,this._makeHash()}_makeHash(){const e=this._state,t=["/met"];this._baseColorMap&&(t.push("/bm"),this._baseColorMap._state.hasMatrix&&t.push("/mat"),t.push("/"+this._baseColorMap._state.encoding)),this._metallicMap&&(t.push("/mm"),this._metallicMap._state.hasMatrix&&t.push("/mat")),this._roughnessMap&&(t.push("/rm"),this._roughnessMap._state.hasMatrix&&t.push("/mat")),this._metallicRoughnessMap&&(t.push("/mrm"),this._metallicRoughnessMap._state.hasMatrix&&t.push("/mat")),this._emissiveMap&&(t.push("/em"),this._emissiveMap._state.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap._state.hasMatrix&&t.push("/mat")),this._alphaMap&&(t.push("/am"),this._alphaMap._state.hasMatrix&&t.push("/mat")),this._normalMap&&(t.push("/nm"),this._normalMap._state.hasMatrix&&t.push("/mat")),t.push(";"),e.hash=t.join("")}set baseColor(e){let t=this._state.baseColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.baseColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get baseColor(){return this._state.baseColor}get baseColorMap(){return this._baseColorMap}set metallic(e){e=null!=e?e:1,this._state.metallic!==e&&(this._state.metallic=e,this.glRedraw())}get metallic(){return this._state.metallic}get metallicMap(){return this._attached.metallicMap}set roughness(e){e=null!=e?e:1,this._state.roughness!==e&&(this._state.roughness=e,this.glRedraw())}get roughness(){return this._state.roughness}get roughnessMap(){return this._attached.roughnessMap}get metallicRoughnessMap(){return this._attached.metallicRoughnessMap}set specularF0(e){e=null!=e?e:0,this._state.specularF0!==e&&(this._state.specularF0=e,this.glRedraw())}get specularF0(){return this._state.specularF0}set emissive(e){let t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}get emissiveMap(){return this._attached.emissiveMap}get occlusionMap(){return this._attached.occlusionMap}set alpha(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}get alpha(){return this._state.alpha}get alphaMap(){return this._attached.alphaMap}get normalMap(){return this._attached.normalMap}set alphaMode(e){let t=mn[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}get alphaMode(){return fn[this._state.alphaMode]}set alphaCutoff(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(e){this._state.pointSize=e||1,this.glRedraw()}get pointSize(){return this._state.pointSize}destroy(){super.destroy(),this._state.destroy()}}const _n={opaque:0,mask:1,blend:2},yn=["opaque","mask","blend"];class vn extends Ci{get type(){return"SpecularMaterial"}constructor(e,t={}){super(e,t),this._state=new ft({type:"SpecularMaterial",diffuse:p.vec3([1,1,1]),emissive:p.vec3([0,0,0]),specular:p.vec3([1,1,1]),glossiness:null,specularF0:null,alpha:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),this.diffuse=t.diffuse,this.specular=t.specular,this.glossiness=t.glossiness,this.specularF0=t.specularF0,this.emissive=t.emissive,this.alpha=t.alpha,t.diffuseMap&&(this._diffuseMap=this._checkComponent("Texture",t.diffuseMap)),t.emissiveMap&&(this._emissiveMap=this._checkComponent("Texture",t.emissiveMap)),t.specularMap&&(this._specularMap=this._checkComponent("Texture",t.specularMap)),t.glossinessMap&&(this._glossinessMap=this._checkComponent("Texture",t.glossinessMap)),t.specularGlossinessMap&&(this._specularGlossinessMap=this._checkComponent("Texture",t.specularGlossinessMap)),t.occlusionMap&&(this._occlusionMap=this._checkComponent("Texture",t.occlusionMap)),t.alphaMap&&(this._alphaMap=this._checkComponent("Texture",t.alphaMap)),t.normalMap&&(this._normalMap=this._checkComponent("Texture",t.normalMap)),this.alphaMode=t.alphaMode,this.alphaCutoff=t.alphaCutoff,this.backfaces=t.backfaces,this.frontface=t.frontface,this.lineWidth=t.lineWidth,this.pointSize=t.pointSize,this._makeHash()}_makeHash(){const e=this._state,t=["/spe"];this._diffuseMap&&(t.push("/dm"),this._diffuseMap.hasMatrix&&t.push("/mat"),t.push("/"+this._diffuseMap.encoding)),this._emissiveMap&&(t.push("/em"),this._emissiveMap.hasMatrix&&t.push("/mat")),this._glossinessMap&&(t.push("/gm"),this._glossinessMap.hasMatrix&&t.push("/mat")),this._specularMap&&(t.push("/sm"),this._specularMap.hasMatrix&&t.push("/mat")),this._specularGlossinessMap&&(t.push("/sgm"),this._specularGlossinessMap.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap.hasMatrix&&t.push("/mat")),this._normalMap&&(t.push("/nm"),this._normalMap.hasMatrix&&t.push("/mat")),this._alphaMap&&(t.push("/opm"),this._alphaMap.hasMatrix&&t.push("/mat")),t.push(";"),e.hash=t.join("")}set diffuse(e){let t=this._state.diffuse;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.diffuse=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get diffuse(){return this._state.diffuse}get diffuseMap(){return this._diffuseMap}set specular(e){let t=this._state.specular;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.specular=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get specular(){return this._state.specular}get specularMap(){return this._specularMap}get specularGlossinessMap(){return this._specularGlossinessMap}set glossiness(e){e=null!=e?e:1,this._state.glossiness!==e&&(this._state.glossiness=e,this.glRedraw())}get glossiness(){return this._state.glossiness}get glossinessMap(){return this._glossinessMap}set specularF0(e){e=null!=e?e:0,this._state.specularF0!==e&&(this._state.specularF0=e,this.glRedraw())}get specularF0(){return this._state.specularF0}set emissive(e){let t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}get emissiveMap(){return this._emissiveMap}set alpha(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}get alpha(){return this._state.alpha}get alphaMap(){return this._alphaMap}get normalMap(){return this._normalMap}get occlusionMap(){return this._occlusionMap}set alphaMode(e){let t=_n[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}get alphaMode(){return yn[this._state.alphaMode]}set alphaCutoff(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(e){this._state.pointSize=e||1,this.glRedraw()}get pointSize(){return this._state.pointSize}destroy(){super.destroy(),this._state.destroy()}}function bn(e,t,s=null){let i;const r=t;if(1009===r)return e.UNSIGNED_BYTE;if(1017===r)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===r)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===r)return e.BYTE;if(1011===r)return e.SHORT;if(1012===r)return e.UNSIGNED_SHORT;if(1013===r)return e.INT;if(1014===r)return e.UNSIGNED_INT;if(1015===r)return e.FLOAT;if(1016===r)return e.HALF_FLOAT;if(1021===r)return e.ALPHA;if(1023===r)return e.RGBA;if(1024===r)return e.LUMINANCE;if(1025===r)return e.LUMINANCE_ALPHA;if(1026===r)return e.DEPTH_COMPONENT;if(1027===r)return e.DEPTH_STENCIL;if(1028===r)return e.RED;if(1022===r)return e.RGBA;if(1029===r)return e.RED_INTEGER;if(1030===r)return e.RG;if(1031===r)return e.RG_INTEGER;if(1033===r)return e.RGBA_INTEGER;if(33776===r||33777===r||33778===r||33779===r)if(3001===s){const t=He(e,"WEBGL_compressed_texture_s3tc_srgb");if(null===t)return null;if(33776===r)return t.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===r)return t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===r)return t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===r)return t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=He(e,"WEBGL_compressed_texture_s3tc"),null===i)return null;if(33776===r)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===r)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===r)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===r)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===r||35841===r||35842===r||35843===r){const t=He(e,"WEBGL_compressed_texture_pvrtc");if(null===t)return null;if(35840===r)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===r)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===r)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===r)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===r){const t=He(e,"WEBGL_compressed_texture_etc1");return null!==t?t.COMPRESSED_RGB_ETC1_WEBGL:null}if(37492===r||37496===r){const t=He(e,"WEBGL_compressed_texture_etc");if(null===t)return null;if(37492===r)return 3001===s?t.COMPRESSED_SRGB8_ETC2:t.COMPRESSED_RGB8_ETC2;if(37496===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:t.COMPRESSED_RGBA8_ETC2_EAC}if(37808===r||37809===r||37810===r||37811===r||37812===r||37813===r||37814===r||37815===r||37816===r||37817===r||37818===r||37819===r||37820===r||37821===r){const t=He(e,"WEBGL_compressed_texture_astc");if(null===t)return null;if(37808===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:t.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:t.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:t.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:t.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:t.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:t.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:t.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:t.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:t.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:t.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:t.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:t.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:t.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:t.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===r){const t=He(e,"EXT_texture_compression_bptc");if(null===t)return null;if(36492===r)return 3001===s?t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:t.COMPRESSED_RGBA_BPTC_UNORM_EXT}return 1020===r?e.UNSIGNED_INT_24_8:1e3===r?e.REPEAT:1001===r?e.CLAMP_TO_EDGE:1004===r||1005===r?e.NEAREST_MIPMAP_LINEAR:1007===r?e.LINEAR_MIPMAP_NEAREST:1008===r?e.LINEAR_MIPMAP_LINEAR:1003===r?e.NEAREST:1006===r?e.LINEAR:null}const xn=new Uint8Array([0,0,0,1]);class Pn{constructor({gl:e,target:t,format:s,type:i,wrapS:r,wrapT:o,wrapR:n,encoding:a,preloadColor:h,premultiplyAlpha:l,flipY:u}){this.gl=e,this.target=t||e.TEXTURE_2D,this.format=s||1023,this.type=i||1009,this.internalFormat=null,this.premultiplyAlpha=!!l,this.flipY=!!u,this.unpackAlignment=4,this.wrapS=r||1e3,this.wrapT=o||1e3,this.wrapR=n||1e3,this.encoding=a||3001,this.texture=e.createTexture(),h&&this.setPreloadColor(h),this.allocated=!0}setPreloadColor(e){e?(xn[0]=Math.floor(255*e[0]),xn[1]=Math.floor(255*e[1]),xn[2]=Math.floor(255*e[2]),xn[3]=Math.floor(255*(void 0!==e[3]?e[3]:1))):(xn[0]=0,xn[1]=0,xn[2]=0,xn[3]=255);const t=this.gl;if(t.bindTexture(this.target,this.texture),this.target===t.TEXTURE_CUBE_MAP){const e=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z];for(let s=0,i=e.length;s<i;s++)t.texImage2D(e[s],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,xn)}else t.texImage2D(this.target,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,xn);t.bindTexture(this.target,null)}setTarget(e){this.target=e||this.gl.TEXTURE_2D}setImage(e,t={}){const s=this.gl;void 0!==t.format&&(this.format=t.format),void 0!==t.internalFormat&&(this.internalFormat=t.internalFormat),void 0!==t.encoding&&(this.encoding=t.encoding),void 0!==t.type&&(this.type=t.type),void 0!==t.flipY&&(this.flipY=t.flipY),void 0!==t.premultiplyAlpha&&(this.premultiplyAlpha=t.premultiplyAlpha),void 0!==t.unpackAlignment&&(this.unpackAlignment=t.unpackAlignment),void 0!==t.minFilter&&(this.minFilter=t.minFilter),void 0!==t.magFilter&&(this.magFilter=t.magFilter),void 0!==t.wrapS&&(this.wrapS=t.wrapS),void 0!==t.wrapT&&(this.wrapT=t.wrapT),void 0!==t.wrapR&&(this.wrapR=t.wrapR);let i=!1;s.bindTexture(this.target,this.texture);const r=s.getParameter(s.UNPACK_FLIP_Y_WEBGL);s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,this.flipY);const o=s.getParameter(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL);s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);const n=s.getParameter(s.UNPACK_ALIGNMENT);s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment);const a=s.getParameter(s.UNPACK_COLORSPACE_CONVERSION_WEBGL);s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE);const h=bn(s,this.minFilter);s.texParameteri(this.target,s.TEXTURE_MIN_FILTER,h),h!==s.NEAREST_MIPMAP_NEAREST&&h!==s.LINEAR_MIPMAP_NEAREST&&h!==s.NEAREST_MIPMAP_LINEAR&&h!==s.LINEAR_MIPMAP_LINEAR||(i=!0);const l=bn(s,this.magFilter);l&&s.texParameteri(this.target,s.TEXTURE_MAG_FILTER,l);const u=bn(s,this.wrapS);u&&s.texParameteri(this.target,s.TEXTURE_WRAP_S,u);const c=bn(s,this.wrapT);c&&s.texParameteri(this.target,s.TEXTURE_WRAP_T,c);const p=bn(s,this.format,this.encoding),d=bn(s,this.type),m=Tn(s,this.internalFormat,p,d,this.encoding,!1);if(this.target===s.TEXTURE_CUBE_MAP){if(y.isArray(e)){const t=e,i=[s.TEXTURE_CUBE_MAP_POSITIVE_X,s.TEXTURE_CUBE_MAP_NEGATIVE_X,s.TEXTURE_CUBE_MAP_POSITIVE_Y,s.TEXTURE_CUBE_MAP_NEGATIVE_Y,s.TEXTURE_CUBE_MAP_POSITIVE_Z,s.TEXTURE_CUBE_MAP_NEGATIVE_Z];for(let e=0,r=i.length;e<r;e++)s.texImage2D(i[e],0,m,p,d,t[e])}}else s.texImage2D(s.TEXTURE_2D,0,m,p,d,e);i&&s.generateMipmap(this.target),s.bindTexture(this.target,null),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,r),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),s.pixelStorei(s.UNPACK_ALIGNMENT,n),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,a)}setCompressedData({mipmaps:e,props:t={}}){const s=this.gl,i=e.length;void 0!==t.format&&(this.format=t.format),void 0!==t.internalFormat&&(this.internalFormat=t.internalFormat),void 0!==t.encoding&&(this.encoding=t.encoding),void 0!==t.type&&(this.type=t.type),void 0!==t.flipY&&(this.flipY=t.flipY),void 0!==t.premultiplyAlpha&&(this.premultiplyAlpha=t.premultiplyAlpha),void 0!==t.unpackAlignment&&(this.unpackAlignment=t.unpackAlignment),void 0!==t.minFilter&&(this.minFilter=t.minFilter),void 0!==t.magFilter&&(this.magFilter=t.magFilter),void 0!==t.wrapS&&(this.wrapS=t.wrapS),void 0!==t.wrapT&&(this.wrapT=t.wrapT),void 0!==t.wrapR&&(this.wrapR=t.wrapR),s.activeTexture(s.TEXTURE0+0),s.bindTexture(this.target,this.texture);let r=e.length>1;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,this.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE);const o=bn(s,this.wrapS);o&&s.texParameteri(this.target,s.TEXTURE_WRAP_S,o);const n=bn(s,this.wrapT);if(n&&s.texParameteri(this.target,s.TEXTURE_WRAP_T,n),this.type===s.TEXTURE_3D||this.type===s.TEXTURE_2D_ARRAY){const e=bn(s,this.wrapR);e&&s.texParameteri(this.target,s.TEXTURE_WRAP_R,e),s.texParameteri(this.type,s.TEXTURE_WRAP_R,e)}r?(s.texParameteri(this.target,s.TEXTURE_MIN_FILTER,wn(s,this.minFilter)),s.texParameteri(this.target,s.TEXTURE_MAG_FILTER,wn(s,this.magFilter))):(s.texParameteri(this.target,s.TEXTURE_MIN_FILTER,bn(s,this.minFilter)),s.texParameteri(this.target,s.TEXTURE_MAG_FILTER,bn(s,this.magFilter)));const a=bn(s,this.format,this.encoding),h=bn(s,this.type),l=Tn(s,this.internalFormat,a,h,this.encoding,!1);s.texStorage2D(s.TEXTURE_2D,i,l,e[0].width,e[0].height);for(let t=0,i=e.length;t<i;t++){const i=e[t];1023!==this.format?null!==a?s.compressedTexSubImage2D(s.TEXTURE_2D,t,0,0,i.width,i.height,a,i.data):console.warn("Attempt to load unsupported compressed texture format in .setCompressedData()"):s.texSubImage2D(s.TEXTURE_2D,t,0,0,i.width,i.height,a,h,i.data)}s.bindTexture(this.target,null)}setProps(e){const t=this.gl;t.bindTexture(this.target,this.texture),this._uploadProps(e),t.bindTexture(this.target,null)}_uploadProps(e){const t=this.gl;if(void 0!==e.format&&(this.format=e.format),void 0!==e.internalFormat&&(this.internalFormat=e.internalFormat),void 0!==e.encoding&&(this.encoding=e.encoding),void 0!==e.type&&(this.type=e.type),void 0!==e.minFilter){const s=bn(t,e.minFilter);s&&(this.minFilter=e.minFilter,t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,s),s!==t.NEAREST_MIPMAP_NEAREST&&s!==t.LINEAR_MIPMAP_NEAREST&&s!==t.NEAREST_MIPMAP_LINEAR&&s!==t.LINEAR_MIPMAP_LINEAR||t.generateMipmap(this.target))}if(void 0!==e.magFilter){const s=bn(t,e.magFilter);s&&(this.magFilter=e.magFilter,t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,s))}if(void 0!==e.wrapS){const s=bn(t,e.wrapS);s&&(this.wrapS=e.wrapS,t.texParameteri(this.target,t.TEXTURE_WRAP_S,s))}if(void 0!==e.wrapT){const s=bn(t,e.wrapT);s&&(this.wrapT=e.wrapT,t.texParameteri(this.target,t.TEXTURE_WRAP_T,s))}}bind(e){if(this.allocated){if(this.texture){const t=this.gl;return t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,this.texture),!0}return!1}}unbind(e){if(this.allocated&&this.texture){const t=this.gl;t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,null)}}destroy(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}}function Tn(e,t,s,i,r,o=!1){if(null!==t){if(void 0!==e[t])return e[t];console.warn("Attempt to use non-existing WebGL internal format '"+t+"'")}let n=s;return s===e.RED&&(i===e.FLOAT&&(n=e.R32F),i===e.HALF_FLOAT&&(n=e.R16F),i===e.UNSIGNED_BYTE&&(n=e.R8)),s===e.RG&&(i===e.FLOAT&&(n=e.RG32F),i===e.HALF_FLOAT&&(n=e.RG16F),i===e.UNSIGNED_BYTE&&(n=e.RG8)),s===e.RGBA&&(i===e.FLOAT&&(n=e.RGBA32F),i===e.HALF_FLOAT&&(n=e.RGBA16F),i===e.UNSIGNED_BYTE&&(n=3001===r&&!1===o?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(n=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(n=e.RGB5_A1)),n!==e.R16F&&n!==e.R32F&&n!==e.RG16F&&n!==e.RG32F&&n!==e.RGBA16F&&n!==e.RGBA32F||He(e,"EXT_color_buffer_float"),n}function wn(e,t){return 1003===t||1004===t||1005===t?e.NEAREST:e.LINEAR}function Mn(e){if(!In(e.width)||!In(e.height)){const t=document.createElement("canvas");t.width=Cn(e.width),t.height=Cn(e.height);t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}return e}function In(e){return 0==(e&e-1)}function Cn(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}class Dn extends A{get type(){return"Texture"}constructor(e,t={}){super(e,t),this._state=new ft({texture:new Pn({gl:this.scene.canvas.gl}),matrix:p.identityMat4(),hasMatrix:t.translate&&(0!==t.translate[0]||0!==t.translate[1])||!!t.rotate||t.scale&&(0!==t.scale[0]||0!==t.scale[1]),minFilter:this._checkMinFilter(t.minFilter),magFilter:this._checkMagFilter(t.magFilter),wrapS:this._checkWrapS(t.wrapS),wrapT:this._checkWrapT(t.wrapT),flipY:this._checkFlipY(t.flipY),encoding:this._checkEncoding(t.encoding)}),this._src=null,this._image=null,this._translate=p.vec2([0,0]),this._scale=p.vec2([1,1]),this._rotate=p.vec2([0,0]),this._matrixDirty=!1,this.translate=t.translate,this.scale=t.scale,this.rotate=t.rotate,t.src?this.src=t.src:t.image&&(this.image=t.image),m.memory.textures++}_checkMinFilter(e){return 1006!==(e=e||1008)&&1007!==e&&1008!==e&&1005!==e&&1004!==e&&(this.error("Unsupported value for 'minFilter' - supported values are LinearFilter, LinearMipMapNearestFilter, NearestMipMapNearestFilter, NearestMipMapLinearFilter and LinearMipMapLinearFilter. Defaulting to LinearMipMapLinearFilter."),e=1008),e}_checkMagFilter(e){return 1006!==(e=e||1006)&&1003!==e&&(this.error("Unsupported value for 'magFilter' - supported values are LinearFilter and NearestFilter. Defaulting to LinearFilter."),e=1006),e}_checkWrapS(e){return 1001!==(e=e||1e3)&&1002!==e&&1e3!==e&&(this.error("Unsupported value for 'wrapS' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),e=1e3),e}_checkWrapT(e){return 1001!==(e=e||1e3)&&1002!==e&&1e3!==e&&(this.error("Unsupported value for 'wrapT' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),e=1e3),e}_checkFlipY(e){return!!e}_checkEncoding(e){return 3e3!==(e=e||3e3)&&3001!==e&&(this.error("Unsupported value for 'encoding' - supported values are LinearEncoding and sRGBEncoding. Defaulting to LinearEncoding."),e=3e3),e}_webglContextRestored(){this._state.texture=new Pn({gl:this.scene.canvas.gl}),this._image?this.image=this._image:this._src&&(this.src=this._src)}_update(){const e=this._state;if(this._matrixDirty){let t,s;0===this._translate[0]&&0===this._translate[1]||(t=p.translationMat4v([this._translate[0],this._translate[1],0],this._state.matrix)),1===this._scale[0]&&1===this._scale[1]||(s=p.scalingMat4v([this._scale[0],this._scale[1],1]),t=t?p.mulMat4(t,s):s),0!==this._rotate&&(s=p.rotationMat4v(.0174532925*this._rotate,[0,0,1]),t=t?p.mulMat4(t,s):s),t&&(e.matrix=t),this._matrixDirty=!1}this.glRedraw()}set image(e){this._image=Mn(e),this._image.crossOrigin="Anonymous",this._state.texture.setImage(this._image,this._state),this._src=null,this.glRedraw()}get image(){return this._image}set src(e){this.scene.loading++,this.scene.canvas.spinner.processes++;const t=this;let s=new Image;s.onload=function(){s=Mn(s),t._state.texture.setImage(s,t._state),t.scene.loading--,t.glRedraw(),t.scene.canvas.spinner.processes--},s.src=e,this._src=e,this._image=null}get src(){return this._src}set translate(e){this._translate.set(e||[0,0]),this._matrixDirty=!0,this._needUpdate()}get translate(){return this._translate}set scale(e){this._scale.set(e||[1,1]),this._matrixDirty=!0,this._needUpdate()}get scale(){return this._scale}set rotate(e){e=e||0,this._rotate!==e&&(this._rotate=e,this._matrixDirty=!0,this._needUpdate())}get rotate(){return this._rotate}get minFilter(){return this._state.minFilter}get magFilter(){return this._state.magFilter}get wrapS(){return this._state.wrapS}get wrapT(){return this._state.wrapT}get flipY(){return this._state.flipY}get encoding(){return this._state.encoding}destroy(){super.destroy(),this._state.texture&&this._state.texture.destroy(),this._state.destroy(),m.memory.textures--}}class An extends A{get type(){return"Fresnel"}constructor(e,t={}){super(e,t),this._state=new ft({edgeColor:p.vec3([0,0,0]),centerColor:p.vec3([1,1,1]),edgeBias:0,centerBias:1,power:1}),this.edgeColor=t.edgeColor,this.centerColor=t.centerColor,this.edgeBias=t.edgeBias,this.centerBias=t.centerBias,this.power=t.power}set edgeColor(e){this._state.edgeColor.set(e||[0,0,0]),this.glRedraw()}get edgeColor(){return this._state.edgeColor}set centerColor(e){this._state.centerColor.set(e||[1,1,1]),this.glRedraw()}get centerColor(){return this._state.centerColor}set edgeBias(e){this._state.edgeBias=e||0,this.glRedraw()}get edgeBias(){return this._state.edgeBias}set centerBias(e){this._state.centerBias=null!=e?e:1,this.glRedraw()}get centerBias(){return this._state.centerBias}set power(e){this._state.power=null!=e?e:1,this.glRedraw()}get power(){return this._state.power}destroy(){super.destroy(),this._state.destroy()}}const En=m.memory,Fn=p.AABB3();class Rn extends Pi{get type(){return"VBOGeometry"}get isVBOGeometry(){return!0}constructor(e,t={}){super(e,t),this._state=new ft({compressGeometry:!0,primitive:null,primitiveName:null,positionsDecodeMatrix:null,uvDecodeMatrix:null,positionsBuf:null,normalsBuf:null,colorsbuf:null,uvBuf:null,indicesBuf:null,hash:""}),this._numTriangles=0,this._edgeThreshold=t.edgeThreshold||10,this._aabb=null,this._obb=p.OBB3();const s=this._state,i=this.scene.canvas.gl;switch(t.primitive=t.primitive||"triangles",t.primitive){case"points":s.primitive=i.POINTS,s.primitiveName=t.primitive;break;case"lines":s.primitive=i.LINES,s.primitiveName=t.primitive;break;case"line-loop":s.primitive=i.LINE_LOOP,s.primitiveName=t.primitive;break;case"line-strip":s.primitive=i.LINE_STRIP,s.primitiveName=t.primitive;break;case"triangles":s.primitive=i.TRIANGLES,s.primitiveName=t.primitive;break;case"triangle-strip":s.primitive=i.TRIANGLE_STRIP,s.primitiveName=t.primitive;break;case"triangle-fan":s.primitive=i.TRIANGLE_FAN,s.primitiveName=t.primitive;break;default:this.error("Unsupported value for 'primitive': '"+t.primitive+"' - supported values are 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'. Defaulting to 'triangles'."),s.primitive=i.TRIANGLES,s.primitiveName=t.primitive}if(t.positions)if(t.indices){var r;if(t.positionsDecodeMatrix);else{const e=Pt.getPositionsBounds(t.positions),o=Pt.compressPositions(t.positions,e.min,e.max);r=o.quantized,s.positionsDecodeMatrix=o.decodeMatrix,s.positionsBuf=new we(i,i.ARRAY_BUFFER,r,r.length,3,i.STATIC_DRAW),En.positions+=s.positionsBuf.numItems,p.positions3ToAABB3(t.positions,this._aabb),p.positions3ToAABB3(r,Fn,s.positionsDecodeMatrix),p.AABB3ToOBB3(Fn,this._obb)}if(t.colors){const e=t.colors.constructor===Float32Array?t.colors:new Float32Array(t.colors);s.colorsBuf=new we(i,i.ARRAY_BUFFER,e,e.length,4,i.STATIC_DRAW),En.colors+=s.colorsBuf.numItems}if(t.uv){const e=Pt.getUVBounds(t.uv),r=Pt.compressUVs(t.uv,e.min,e.max),o=r.quantized;s.uvDecodeMatrix=r.decodeMatrix,s.uvBuf=new we(i,i.ARRAY_BUFFER,o,o.length,2,i.STATIC_DRAW),En.uvs+=s.uvBuf.numItems}if(t.normals){const e=Pt.compressNormals(t.normals);let r=s.compressGeometry;s.normalsBuf=new we(i,i.ARRAY_BUFFER,e,e.length,3,i.STATIC_DRAW,r),En.normals+=s.normalsBuf.numItems}{const e=t.indices.constructor===Uint32Array||t.indices.constructor===Uint16Array?t.indices:new Uint32Array(t.indices);s.indicesBuf=new we(i,i.ELEMENT_ARRAY_BUFFER,e,e.length,1,i.STATIC_DRAW),En.indices+=s.indicesBuf.numItems;const o=Ve(r,e,s.positionsDecodeMatrix,this._edgeThreshold);this._edgeIndicesBuf=new we(i,i.ELEMENT_ARRAY_BUFFER,o,o.length,1,i.STATIC_DRAW),"triangles"===this._state.primitiveName&&(this._numTriangles=t.indices.length/3)}this._buildHash(),En.meshes++}else this.error("Config expected: indices");else this.error("Config expected: positions")}_buildHash(){const e=this._state,t=["/g"];t.push("/"+e.primitive+";"),e.positionsBuf&&t.push("p"),e.colorsBuf&&t.push("c"),(e.normalsBuf||e.autoVertexNormals)&&t.push("n"),e.uvBuf&&t.push("u"),t.push("cp"),t.push(";"),e.hash=t.join("")}_getEdgeIndices(){return this._edgeIndicesBuf}get primitive(){return this._state.primitiveName}get aabb(){return this._aabb}get obb(){return this._obb}get numTriangles(){return this._numTriangles}_getState(){return this._state}destroy(){super.destroy();const e=this._state;e.indicesBuf&&e.indicesBuf.destroy(),e.positionsBuf&&e.positionsBuf.destroy(),e.normalsBuf&&e.normalsBuf.destroy(),e.uvBuf&&e.uvBuf.destroy(),e.colorsBuf&&e.colorsBuf.destroy(),this._edgeIndicesBuf&&this._edgeIndicesBuf.destroy(),e.destroy(),En.meshes--}}var Sn={};function On(e,t={}){return new Promise((function(s,i){t.src||(console.error("load3DSGeometry: Parameter expected: src"),i());var r=e.canvas.spinner;r.processes++,y.loadArraybuffer(t.src,(function(e){e.byteLength||(console.error("load3DSGeometry: no data loaded"),r.processes--,i());var o=Sn.parse.from3DS(e).edit.objects[0].mesh,n=o.vertices,a=o.uvt,h=o.indices;r.processes--,s(y.apply(t,{primitive:"triangles",positions:n,normals:null,uv:a,indices:h}))}),(function(e){console.error("load3DSGeometry: "+e),r.processes--,i()}))}))}function Bn(e,t={}){return new Promise((function(s,i){t.src||(console.error("loadOBJGeometry: Parameter expected: src"),i());var r=e.canvas.spinner;r.processes++,y.loadArraybuffer(t.src,(function(e){e.byteLength||(console.error("loadOBJGeometry: no data loaded"),r.processes--,i());for(var o=Sn.parse.fromOBJ(e),n=Sn.edit.unwrap(o.i_verts,o.c_verts,3),a=Sn.edit.unwrap(o.i_norms,o.c_norms,3),h=Sn.edit.unwrap(o.i_uvt,o.c_uvt,2),l=new Int32Array(o.i_verts.length),u=0;u<o.i_verts.length;u++)l[u]=u;r.processes--,s(y.apply(t,{primitive:"triangles",positions:n,normals:a.length>0?a:null,autoNormals:0===a.length,uv:h,indices:l}))}),(function(e){console.error("loadOBJGeometry: "+e),r.processes--,i()}))}))}function Ln(e={}){let t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);let s=e.ySize||1;s<0&&(console.error("negative ySize not allowed - will invert"),s*=-1);let i=e.zSize||1;i<0&&(console.error("negative zSize not allowed - will invert"),i*=-1);const r=e.center,o=r?r[0]:0,n=r?r[1]:0,a=r?r[2]:0,h=-t+o,l=-s+n,u=-i+a,c=t+o,p=s+n,d=i+a;return y.apply(e,{primitive:"lines",positions:[h,l,u,h,l,d,h,p,u,h,p,d,c,l,u,c,l,d,c,p,u,c,p,d],indices:[0,1,1,3,3,2,2,0,4,5,5,7,7,6,6,4,0,4,1,5,2,6,3,7]})}function Nn(e={}){let t=e.size||1;t<0&&(console.error("negative size not allowed - will invert"),t*=-1);let s=e.divisions||1;s<0&&(console.error("negative divisions not allowed - will invert"),s*=-1),s<1&&(s=1),t=t||10,s=s||10;const i=t/s,r=t/2,o=[],n=[];let a=0;for(let e=0,t=-r;e<=s;e++,t+=i)o.push(-r),o.push(0),o.push(t),o.push(r),o.push(0),o.push(t),o.push(t),o.push(0),o.push(-r),o.push(t),o.push(0),o.push(r),n.push(a++),n.push(a++),n.push(a++),n.push(a++);return y.apply(e,{primitive:"lines",positions:o,indices:n})}function kn(e={}){let t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);let s=e.zSize||1;s<0&&(console.error("negative zSize not allowed - will invert"),s*=-1);let i=e.xSegments||1;i<0&&(console.error("negative xSegments not allowed - will invert"),i*=-1),i<1&&(i=1);let r=e.xSegments||1;r<0&&(console.error("negative zSegments not allowed - will invert"),r*=-1),r<1&&(r=1);const o=e.center,n=o?o[0]:0,a=o?o[1]:0,h=o?o[2]:0,l=t/2,u=s/2,c=Math.floor(i)||1,p=Math.floor(r)||1,d=c+1,m=p+1,f=t/c,g=s/p,_=new Float32Array(d*m*3),v=new Float32Array(d*m*3),b=new Float32Array(d*m*2);let x,P,T,w,M,I,C,D=0,A=0;for(x=0;x<m;x++){const e=x*g-u;for(P=0;P<d;P++)T=P*f-l,_[D]=T+n,_[D+1]=a,_[D+2]=-e+h,v[D+2]=-1,b[A]=P/c,b[A+1]=(p-x)/p,D+=3,A+=2}D=0;const E=new(_.length/3>65535?Uint32Array:Uint16Array)(c*p*6);for(x=0;x<p;x++)for(P=0;P<c;P++)w=P+d*x,M=P+d*(x+1),I=P+1+d*(x+1),C=P+1+d*x,E[D]=C,E[D+1]=M,E[D+2]=w,E[D+3]=C,E[D+4]=I,E[D+5]=M,D+=6;return y.apply(e,{positions:_,normals:v,uv:b,indices:E})}function jn(e={}){let t=e.radius||1;t<0&&(console.error("negative radius not allowed - will invert"),t*=-1),t*=.5;let s=e.tube||.3;s<0&&(console.error("negative tube not allowed - will invert"),s*=-1);let i=e.radialSegments||32;i<0&&(console.error("negative radialSegments not allowed - will invert"),i*=-1),i<4&&(i=4);let r=e.tubeSegments||24;r<0&&(console.error("negative tubeSegments not allowed - will invert"),r*=-1),r<4&&(r=4);let o=e.arc||2*Math.PI;o<0&&(console.warn("negative arc not allowed - will invert"),o*=-1),o>360&&(o=360);const n=e.center;let a=n?n[0]:0,h=n?n[1]:0;const l=n?n[2]:0,u=[],c=[],d=[],m=[];let f,g,_,v,b,x,P,T,w,M,I,C;for(T=0;T<=r;T++)for(P=0;P<=i;P++)f=P/i*o,g=.785398+T/r*Math.PI*2,a=t*Math.cos(f),h=t*Math.sin(f),_=(t+s*Math.cos(g))*Math.cos(f),v=(t+s*Math.cos(g))*Math.sin(f),b=s*Math.sin(g),u.push(_+a),u.push(v+h),u.push(b+l),d.push(1-P/i),d.push(T/r),x=p.normalizeVec3(p.subVec3([_,v,b],[a,h,l],[]),[]),c.push(x[0]),c.push(x[1]),c.push(x[2]);for(T=1;T<=r;T++)for(P=1;P<=i;P++)w=(i+1)*T+P-1,M=(i+1)*(T-1)+P-1,I=(i+1)*(T-1)+P,C=(i+1)*T+P,m.push(w),m.push(M),m.push(I),m.push(I),m.push(C),m.push(w);return y.apply(e,{positions:u,normals:c,uv:d,indices:m})}Sn.load=function(e,t){var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(e){t(e.target.response)},s.send()},Sn.save=function(e,t){var s="data:application/octet-stream;base64,"+btoa(Sn.parse._buffToStr(e));window.location.href=s},Sn.clone=function(e){return JSON.parse(JSON.stringify(e))},Sn.bin={},Sn.bin.f=new Float32Array(1),Sn.bin.fb=new Uint8Array(Sn.bin.f.buffer),Sn.bin.rf=function(e,t){for(var s=Sn.bin.f,i=Sn.bin.fb,r=0;r<4;r++)i[r]=e[t+r];return s[0]},Sn.bin.rsl=function(e,t){return e[t]|e[t+1]<<8},Sn.bin.ril=function(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24},Sn.bin.rASCII0=function(e,t){for(var s="";0!=e[t];)s+=String.fromCharCode(e[t++]);return s},Sn.bin.wf=function(e,t,s){new Float32Array(e.buffer,t,1)[0]=s},Sn.bin.wsl=function(e,t,s){e[t]=s,e[t+1]=s>>8},Sn.bin.wil=function(e,t,s){e[t]=s,e[t+1]=s>>8,e[t+2]=s>>16,e[t+3]},Sn.parse={},Sn.parse._buffToStr=function(e){for(var t=new Uint8Array(e),s="",i=0;i<t.length;i++)s=s.concat(String.fromCharCode(t[i]));return s},Sn.parse._strToBuff=function(e){for(var t=new ArrayBuffer(e.length),s=new Uint8Array(t),i=0;i<e.length;i++)s[i]=e.charCodeAt(i);return t},Sn.parse._readLine=function(e,t){for(var s="";10!=e[t];)s+=String.fromCharCode(e[t++]);return s},Sn.parse.fromJSON=function(e){return JSON.parse(Sn.parse._buffToStr(e))},Sn.parse.toJSON=function(e){var t=JSON.stringify(e);return Sn.parse._strToBuff(t)},Sn.parse.fromOBJ=function(e){for(var t={groups:{},c_verts:[],c_uvt:[],c_norms:[],i_verts:[],i_uvt:[],i_norms:[]},s={from:0,to:0},i=0,r=new Uint8Array(e);i<r.length;){var o=Sn.parse._readLine(r,i);i+=o.length+1;var n=(o=(o=o.replace(/ +(?= )/g,"")).replace(/(^\s+|\s+$)/g,"")).split(" ");if("g"==n[0]&&(s.to=t.i_verts.length,null==t.groups[n[1]]&&(t.groups[n[1]]={from:t.i_verts.length,to:0}),s=t.groups[n[1]]),"v"==n[0]){var a=parseFloat(n[1]),h=parseFloat(n[2]),l=parseFloat(n[3]);t.c_verts.push(a,h,l)}if("vt"==n[0]){a=parseFloat(n[1]),h=1-parseFloat(n[2]);t.c_uvt.push(a,h)}if("vn"==n[0]){a=parseFloat(n[1]),h=parseFloat(n[2]),l=parseFloat(n[3]);t.c_norms.push(a,h,l)}if("f"==n[0]){var u=n[1].split("/"),c=n[2].split("/"),p=n[3].split("/"),d=parseInt(u[0])-1,m=parseInt(c[0])-1,f=parseInt(p[0])-1,g=parseInt(u[1])-1,_=parseInt(c[1])-1,y=parseInt(p[1])-1,v=parseInt(u[2])-1,b=parseInt(c[2])-1,x=parseInt(p[2])-1,P=t.c_verts.length/3,T=t.c_uvt.length/2,w=t.c_norms.length/3;if(d<0&&(d=P+d+1),m<0&&(m=P+m+1),f<0&&(f=P+f+1),g<0&&(g=T+g+1),_<0&&(_=T+_+1),y<0&&(y=T+y+1),v<0&&(v=w+v+1),b<0&&(b=w+b+1),x<0&&(x=w+x+1),t.i_verts.push(d,m,f),t.i_uvt.push(g,_,y),t.i_norms.push(v,b,x),5==n.length){var M=n[4].split("/"),I=parseInt(M[0])-1,C=parseInt(M[1])-1,D=parseInt(M[2])-1;I<0&&(I=P+I+1),C<0&&(C=T+C+1),D<0&&(D=w+D+1),t.i_verts.push(d,f,I),t.i_uvt.push(g,y,C),t.i_norms.push(v,x,D)}}}return s.to=t.i_verts.length,t},Sn.parse.fromMD2=function(e){e=new Uint8Array(e);var t={},s={};s.ident=Sn.bin.ril(e,0),s.version=Sn.bin.ril(e,4),s.skinwidth=Sn.bin.ril(e,8),s.skinheight=Sn.bin.ril(e,12),s.framesize=Sn.bin.ril(e,16),s.num_skins=Sn.bin.ril(e,20),s.num_vertices=Sn.bin.ril(e,24),s.num_st=Sn.bin.ril(e,28),s.num_tris=Sn.bin.ril(e,32),s.num_glcmds=Sn.bin.ril(e,36),s.num_frames=Sn.bin.ril(e,40),s.offset_skins=Sn.bin.ril(e,44),s.offset_st=Sn.bin.ril(e,48),s.offset_tris=Sn.bin.ril(e,52),s.offset_frames=Sn.bin.ril(e,56),s.offset_glcmds=Sn.bin.ril(e,60),s.offset_end=Sn.bin.ril(e,64);var i=s.offset_st;t.c_uvt=[];for(var r=0;r<s.num_st;r++){var o=Sn.bin.rsl(e,i)/s.skinwidth,n=Sn.bin.rsl(e,i+2)/s.skinheight;t.c_uvt.push(o,n),i+=4}i=s.offset_tris;var a=[],h=[];t.i_verts=a,t.i_uvt=h;for(r=0;r<s.num_tris;r++)a.push(Sn.bin.rsl(e,i),Sn.bin.rsl(e,i+2),Sn.bin.rsl(e,i+4)),h.push(Sn.bin.rsl(e,i+6),Sn.bin.rsl(e,i+8),Sn.bin.rsl(e,i+10)),i+=12;i=s.offset_skins;t.skins=[];for(r=0;r<s.num_skins;r++)t.skins.push(Sn.bin.rASCII0(e,i)),i+=64;i=s.offset_frames;t.frames=[];var l=Sn.parse.fromMD2._normals;for(r=0;r<s.num_frames;r++){var u={},c=Sn.bin.rf(e,i),p=Sn.bin.rf(e,i+4),d=Sn.bin.rf(e,i+8);i+=12;var m=Sn.bin.rf(e,i),f=Sn.bin.rf(e,i+4),g=Sn.bin.rf(e,i+8);i+=12,u.name=Sn.bin.rASCII0(e,i),i+=16,u.verts=[],u.norms=[];for(var _=0;_<s.num_vertices;_++)u.verts.push(e[i]*c+m,e[i+1]*p+f,e[i+2]*d+g),u.norms.push(l[3*e[i+3]],l[3*e[i+3]+1],l[3*e[i+3]+2]),i+=4;t.frames.push(u)}return t},Sn.parse.fromMD2._normals=[-.525731,0,.850651,-.442863,.238856,.864188,-.295242,0,.955423,-.309017,.5,.809017,-.16246,.262866,.951056,0,0,1,0,.850651,.525731,-.147621,.716567,.681718,.147621,.716567,.681718,0,.525731,.850651,.309017,.5,.809017,.525731,0,.850651,.295242,0,.955423,.442863,.238856,.864188,.16246,.262866,.951056,-.681718,.147621,.716567,-.809017,.309017,.5,-.587785,.425325,.688191,-.850651,.525731,0,-.864188,.442863,.238856,-.716567,.681718,.147621,-.688191,.587785,.425325,-.5,.809017,.309017,-.238856,.864188,.442863,-.425325,.688191,.587785,-.716567,.681718,-.147621,-.5,.809017,-.309017,-.525731,.850651,0,0,.850651,-.525731,-.238856,.864188,-.442863,0,.955423,-.295242,-.262866,.951056,-.16246,0,1,0,0,.955423,.295242,-.262866,.951056,.16246,.238856,.864188,.442863,.262866,.951056,.16246,.5,.809017,.309017,.238856,.864188,-.442863,.262866,.951056,-.16246,.5,.809017,-.309017,.850651,.525731,0,.716567,.681718,.147621,.716567,.681718,-.147621,.525731,.850651,0,.425325,.688191,.587785,.864188,.442863,.238856,.688191,.587785,.425325,.809017,.309017,.5,.681718,.147621,.716567,.587785,.425325,.688191,.955423,.295242,0,1,0,0,.951056,.16246,.262866,.850651,-.525731,0,.955423,-.295242,0,.864188,-.442863,.238856,.951056,-.16246,.262866,.809017,-.309017,.5,.681718,-.147621,.716567,.850651,0,.525731,.864188,.442863,-.238856,.809017,.309017,-.5,.951056,.16246,-.262866,.525731,0,-.850651,.681718,.147621,-.716567,.681718,-.147621,-.716567,.850651,0,-.525731,.809017,-.309017,-.5,.864188,-.442863,-.238856,.951056,-.16246,-.262866,.147621,.716567,-.681718,.309017,.5,-.809017,.425325,.688191,-.587785,.442863,.238856,-.864188,.587785,.425325,-.688191,.688191,.587785,-.425325,-.147621,.716567,-.681718,-.309017,.5,-.809017,0,.525731,-.850651,-.525731,0,-.850651,-.442863,.238856,-.864188,-.295242,0,-.955423,-.16246,.262866,-.951056,0,0,-1,.295242,0,-.955423,.16246,.262866,-.951056,-.442863,-.238856,-.864188,-.309017,-.5,-.809017,-.16246,-.262866,-.951056,0,-.850651,-.525731,-.147621,-.716567,-.681718,.147621,-.716567,-.681718,0,-.525731,-.850651,.309017,-.5,-.809017,.442863,-.238856,-.864188,.16246,-.262866,-.951056,.238856,-.864188,-.442863,.5,-.809017,-.309017,.425325,-.688191,-.587785,.716567,-.681718,-.147621,.688191,-.587785,-.425325,.587785,-.425325,-.688191,0,-.955423,-.295242,0,-1,0,.262866,-.951056,-.16246,0,-.850651,.525731,0,-.955423,.295242,.238856,-.864188,.442863,.262866,-.951056,.16246,.5,-.809017,.309017,.716567,-.681718,.147621,.525731,-.850651,0,-.238856,-.864188,-.442863,-.5,-.809017,-.309017,-.262866,-.951056,-.16246,-.850651,-.525731,0,-.716567,-.681718,-.147621,-.716567,-.681718,.147621,-.525731,-.850651,0,-.5,-.809017,.309017,-.238856,-.864188,.442863,-.262866,-.951056,.16246,-.864188,-.442863,.238856,-.809017,-.309017,.5,-.688191,-.587785,.425325,-.681718,-.147621,.716567,-.442863,-.238856,.864188,-.587785,-.425325,.688191,-.309017,-.5,.809017,-.147621,-.716567,.681718,-.425325,-.688191,.587785,-.16246,-.262866,.951056,.442863,-.238856,.864188,.16246,-.262866,.951056,.309017,-.5,.809017,.147621,-.716567,.681718,0,-.525731,.850651,.425325,-.688191,.587785,.587785,-.425325,.688191,.688191,-.587785,.425325,-.955423,.295242,0,-.951056,.16246,.262866,-1,0,0,-.850651,0,.525731,-.955423,-.295242,0,-.951056,-.16246,.262866,-.864188,.442863,-.238856,-.951056,.16246,-.262866,-.809017,.309017,-.5,-.864188,-.442863,-.238856,-.951056,-.16246,-.262866,-.809017,-.309017,-.5,-.681718,.147621,-.716567,-.681718,-.147621,-.716567,-.850651,0,-.525731,-.688191,.587785,-.425325,-.587785,.425325,-.688191,-.425325,.688191,-.587785,-.425325,-.688191,-.587785,-.587785,-.425325,-.688191,-.688191,-.587785,-.425325],Sn.parse.fromCollada=function(e){var t=Sn.parse._buffToStr(e),s=(new DOMParser).parseFromString(t,"text/xml"),i={},r=(s=s.childNodes[0]).getElementsByTagName("asset")[0],o=s.getElementsByTagName("library_geometries")[0],n=s.getElementsByTagName("library_images")[0],a=s.getElementsByTagName("library_materials")[0],h=s.getElementsByTagName("library_effects")[0];return r&&(i.asset=Sn.parse.fromCollada._asset(r)),o&&(i.geometries=Sn.parse.fromCollada._libGeometries(o)),n&&(i.images=Sn.parse.fromCollada._libImages(n)),a&&(i.materials=Sn.parse.fromCollada._libMaterials(a)),h&&(i.effects=Sn.parse.fromCollada._libEffects(h)),i},Sn.parse.fromCollada._asset=function(e){return{created:e.getElementsByTagName("created")[0].textContent,modified:e.getElementsByTagName("modified")[0].textContent,up_axis:e.getElementsByTagName("up_axis")[0].textContent}},Sn.parse.fromCollada._libGeometries=function(e){e=e.getElementsByTagName("geometry");for(var t=[],s=0;s<e.length;s++){var i=e[s],r=Sn.parse.fromCollada._getMesh(i.getElementsByTagName("mesh")[0]);t.push(r)}return t},Sn.parse.fromCollada._getMesh=function(e){for(var t={},s=e.getElementsByTagName("source"),i=t.sources={},r=0;r<s.length;r++){for(var o=s[r].getElementsByTagName("float_array")[0].textContent.split(" "),n=o.length-(""==o[o.length-1]?1:0),a=new Array(n),h=0;h<n;h++)a[h]=parseFloat(o[h]);i[s[r].getAttribute("id")]=a}t.triangles=[];var l=e.getElementsByTagName("triangles");if(null==l)return t;for(r=0;r<l.length;r++){var u={},c=l[r];u.material=c.getAttribute("material");var p=c.getElementsByTagName("input"),d=[];for(h=0;h<p.length;h++){var m=p[h];a=[];d[parseInt(m.getAttribute("offset"))]=a;var f=m.getAttribute("semantic");u["s_"+f]="VERTEX"==f?e.getElementsByTagName("vertices")[0].getElementsByTagName("input")[0].getAttribute("source").substring(1):m.getAttribute("source").substring(1),u["i_"+f]=a,i[u["s_"+f]]}var g=c.getElementsByTagName("p")[0].textContent.split(" "),_=3*Math.floor(g.length/3);for(h=0;h<_;h++)d[h%p.length].push(parseInt(g[h]));t.triangles.push(u)}return t},Sn.parse.fromCollada._libImages=function(e){e=e.getElementsByTagName("image");for(var t={},s=0;s<e.length;s++)t[e[s].getAttribute("id")]=e[s].getElementsByTagName("init_from")[0].textContent;return t},Sn.parse.fromCollada._libMaterials=function(e){e=e.getElementsByTagName("material");for(var t={},s=0;s<e.length;s++)t[e[s].getAttribute("name")]=e[s].getElementsByTagName("instance_effect")[0].getAttribute("url").substring(1);return t},Sn.parse.fromCollada._libEffects=function(e){e=e.getElementsByTagName("effect");for(var t={},s=0;s<e.length;s++){for(var i={},r=e[s].getElementsByTagName("newparam"),o=0;o<r.length;o++){var n=r[o].getElementsByTagName("surface")[0];n&&(i.surface=n.getElementsByTagName("init_from")[0].textContent)}t[e[s].getAttribute("id")]=i}return t},Sn.parse.from3DS=function(e){e=new Uint8Array(e);var t={};if(19789!=Sn.bin.rsl(e,0))return null;for(var s=Sn.bin.ril(e,2),i=6;i<s;){var r=Sn.bin.rsl(e,i),o=Sn.bin.ril(e,i+2);15677==r&&(t.edit=Sn.parse.from3DS._edit3ds(e,i,o)),45056==r&&(t.keyf=Sn.parse.from3DS._keyf3ds(e,i,o)),i+=o}return t},Sn.parse.from3DS._edit3ds=function(e,t,s){for(var i={},r=t+6;r<t+s;){var o=Sn.bin.rsl(e,r),n=Sn.bin.ril(e,r+2);16384==o&&(null==i.objects&&(i.objects=[]),i.objects.push(Sn.parse.from3DS._edit_object(e,r,n))),r+=n}return i},Sn.parse.from3DS._keyf3ds=function(e,t,s){for(var i={},r=t+6;r<t+s;){var o=Sn.bin.rsl(e,r),n=Sn.bin.ril(e,r+2);45058==o&&(null==i.desc&&(i.desc=[]),i.desc.push(Sn.parse.from3DS._keyf_objdes(e,r,n))),r+=n}return i},Sn.parse.from3DS._keyf_objdes=function(e,t,s){for(var i={},r=t+6;r<t+s;){var o=Sn.bin.rsl(e,r),n=Sn.bin.ril(e,r+2);45072==o&&(i.hierarchy=Sn.parse.from3DS._keyf_objhierarch(e,r,n)),45073==o&&(i.dummy_name=Sn.bin.rASCII0(e,r+6)),r+=n}return i},Sn.parse.from3DS._keyf_objhierarch=function(e,t,s){var i={},r=t+6;return i.name=Sn.bin.rASCII0(e,r),r+=i.name.length+1,i.hierarchy=Sn.bin.rsl(e,r+4),i},Sn.parse.from3DS._edit_object=function(e,t,s){var i={},r=t+6;for(i.name=Sn.bin.rASCII0(e,r),r+=i.name.length+1;r<t+s;){var o=Sn.bin.rsl(e,r),n=Sn.bin.ril(e,r+2);16640==o&&(i.mesh=Sn.parse.from3DS._obj_trimesh(e,r,n)),r+=n}return i},Sn.parse.from3DS._obj_trimesh=function(e,t,s){for(var i={},r=t+6;r<t+s;){var o=Sn.bin.rsl(e,r),n=Sn.bin.ril(e,r+2);16656==o&&(i.vertices=Sn.parse.from3DS._tri_vertexl(e,r,n)),16672==o&&(i.indices=Sn.parse.from3DS._tri_facel1(e,r,n)),16704==o&&(i.uvt=Sn.parse.from3DS._tri_mappingcoors(e,r,n)),16736==o&&(i.local=Sn.parse.from3DS._tri_local(e,r,n)),r+=n}return i},Sn.parse.from3DS._tri_vertexl=function(e,t,s){var i=[],r=t+6,o=Sn.bin.rsl(e,r);r+=2;for(var n=0;n<o;n++)i.push(Sn.bin.rf(e,r)),i.push(Sn.bin.rf(e,r+4)),i.push(Sn.bin.rf(e,r+8)),r+=12;return i},Sn.parse.from3DS._tri_facel1=function(e,t,s){var i=[],r=t+6,o=Sn.bin.rsl(e,r);r+=2;for(var n=0;n<o;n++)i.push(Sn.bin.rsl(e,r)),i.push(Sn.bin.rsl(e,r+2)),i.push(Sn.bin.rsl(e,r+4)),r+=8;return i},Sn.parse.from3DS._tri_mappingcoors=function(e,t,s){var i=[],r=t+6,o=Sn.bin.rsl(e,r);r+=2;for(var n=0;n<o;n++)i.push(Sn.bin.rf(e,r)),i.push(1-Sn.bin.rf(e,r+4)),r+=8;return i},Sn.parse.from3DS._tri_local=function(e,t,s){var i={},r=t+6;return i.X=[Sn.bin.rf(e,r),Sn.bin.rf(e,r+4),Sn.bin.rf(e,r+8)],r+=12,i.Y=[Sn.bin.rf(e,r),Sn.bin.rf(e,r+4),Sn.bin.rf(e,r+8)],r+=12,i.Z=[Sn.bin.rf(e,r),Sn.bin.rf(e,r+4),Sn.bin.rf(e,r+8)],r+=12,i.C=[Sn.bin.rf(e,r),Sn.bin.rf(e,r+4),Sn.bin.rf(e,r+8)],r+=12,i},Sn.parse.fromBIV=function(e){e=new Uint8Array(e);var t={},s={};return s.id=Sn.bin.ril(e,0),s.verS=Sn.bin.ril(e,4),s.texS=Sn.bin.ril(e,8),s.indS=Sn.bin.ril(e,12),s.verO=Sn.bin.ril(e,16),s.verL=Sn.bin.ril(e,20),s.texO=Sn.bin.ril(e,24),s.texL=Sn.bin.ril(e,28),s.indO=Sn.bin.ril(e,32),s.indL=Sn.bin.ril(e,36),0!=s.verO&&(t.vertices=Sn.parse.fromBIV._readFloats(e,s.verO,s.verL)),0!=s.texO&&(t.uvt=Sn.parse.fromBIV._readFloats(e,s.texO,s.texL)),0!=s.indO&&(t.indices=Sn.parse.fromBIV._readInts(e,s.indO,s.indL,s.indS)),t},Sn.parse.toBIV=function(e){for(var t=0,s=0;s<e.indices.length;s++)t=Math.max(t,e.indices[s]);var i=32;t<=65535&&(i=16);var r=40;e.vertices&&(r+=4*e.vertices.length),e.uvt&&(r+=4*e.uvt.length),e.indices&&(r+=e.indices.length*i/8);var o=new Uint8Array(r);Sn.bin.wil(o,0,1769365870),Sn.bin.wil(o,4,32),Sn.bin.wil(o,8,32),Sn.bin.wil(o,12,i);var n=40;return e.vertices&&(Sn.bin.wil(o,16,n),Sn.bin.wil(o,20,4*e.vertices.length),Sn.parse.fromBIV._writeFloats(o,n,e.vertices),n+=4*e.vertices.length),e.uvt&&(Sn.bin.wil(o,24,n),Sn.bin.wil(o,28,4*e.uvt.length),Sn.parse.fromBIV._writeFloats(o,n,e.uvt),n+=4*e.uvt.length),e.indices&&(Sn.bin.wil(o,32,n),Sn.bin.wil(o,36,4*e.indices.length),Sn.parse.fromBIV._writeInts(o,n,e.indices,i)),o.buffer},Sn.parse.fromBIV._readFloats=function(e,t,s){for(var i=[],r=0;r<s/4;r++)i.push(Sn.bin.rf(e,t+4*r));return i},Sn.parse.fromBIV._writeFloats=function(e,t,s){for(var i=0;i<s.length;i++)Sn.bin.wf(e,t+4*i,s[i])},Sn.parse.fromBIV._readInts=function(e,t,s,i){for(var r=[],o=0;o<s/4;o++)16==i&&r.push(Sn.bin.rsl(e,t+2*o)),32==i&&r.push(Sn.bin.ril(e,t+4*o));return r},Sn.parse.fromBIV._writeInts=function(e,t,s,i){for(var r=0;r<s.length;r++)16==i&&Sn.bin.wsl(e,t+2*r,s[r]),32==i&&Sn.bin.wil(e,t+4*r,s[r])},Sn.gen={},Sn.gen.Plane=function(e,t,s,i){s||(s=1),i||(i=1);for(var r={verts:[],inds:[],uvt:[]},o=e+1,n=t+1,a=0;a<n;a++)for(var h=0;h<o;h++){var l=h*(2/e)-1,u=a*(2/t)-1;r.verts.push(l,u,0),r.uvt.push(s*h/e,i*a/t),a<t&&h<e&&r.inds.push(a*o+h,a*o+h+1,(a+1)*o+h,a*o+h+1,(a+1)*o+h,(a+1)*o+h+1)}return r},Sn.gen.Cube=function(){return{verts:[-1,1,-1,1,1,-1,-1,-1,-1,1,-1,-1,-1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1],inds:[0,1,2,1,2,3,4,5,6,5,6,7,8,9,10,9,10,11,12,13,14,13,14,15,16,17,18,17,18,19,20,21,22,21,22,23],uvt:[1/4,1/4,.5,1/4,1/4,.5,.5,.5,1,1/4,3/4,1/4,1,.5,3/4,.5,0,1/4,1/4,1/4,0,.5,1/4,.5,3/4,1/4,.5,1/4,3/4,.5,.5,.5,1/4,1/4,.5,1/4,1/4,0,.5,0,1/4,.5,.5,.5,1/4,3/4,.5,3/4]}},Sn.gen.Sphere=function(e,t){for(var s={verts:[],inds:[],uvt:[]},i=e+1,r=t+1,o=0;o<r;o++)for(var n=0;n<i;n++){var a=-Math.PI/2+o*Math.PI/t,h=2*n*Math.PI/e,l=Math.cos(a)*Math.cos(h),u=Math.sin(a),c=Math.cos(a)*Math.sin(h);s.verts.push(l,u,c),s.uvt.push(n/e,o/t),o<t&&n<e&&s.inds.push(i*o+n,i*o+n+1,i*(o+1)+n,i*o+n+1,i*(o+1)+n,i*(o+1)+n+1)}return s},Sn.mat={},Sn.mat.scale=function(e,t,s){return[e,0,0,0,0,t,0,0,0,0,s,0,0,0,0,1]},Sn.mat.translate=function(e,t,s){return[1,0,0,0,0,1,0,0,0,0,1,0,e,t,s,1]},Sn.mat.rotateDeg=function(e,t,s){var i=Math.PI/180;return Sn.mat.rotate(e*i,t*i,s*i)},Sn.mat.rotate=function(e,t,s){var i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r=e,o=t,n=s,a=Math.cos(r),h=Math.cos(o),l=Math.cos(n),u=Math.sin(r),c=Math.sin(o),p=Math.sin(n);return i[0]=h*l,i[1]=-h*p,i[2]=c,i[4]=a*p+u*c*l,i[5]=a*l-u*c*p,i[6]=-u*h,i[8]=u*p-a*c*l,i[9]=u*l+a*c*p,i[10]=a*h,i},Sn.edit={},Sn.edit.interpolate=function(e,t,s,i){for(var r=0;r<e.length;r++)s[r]=e[r]+i*(t[r]-e[r])},Sn.edit.transform=function(e,t){for(var s=0;s<e.length;s+=3){var i=e[s],r=e[s+1],o=e[s+2];e[s+0]=t[0]*i+t[4]*r+t[8]*o+t[12],e[s+1]=t[1]*i+t[5]*r+t[9]*o+t[13],e[s+2]=t[2]*i+t[6]*r+t[10]*o+t[14]}},Sn.edit.unwrap=function(e,t,s){for(var i=new Array(Math.floor(e.length/3)*s),r=0;r<e.length;r++)for(var o=0;o<s;o++)i[r*s+o]=t[e[r]*s+o];return i},Sn.edit.remap=function(e,t,s,i){for(var r=new Array(s.length),o=0;o<e.length;o++)for(var n=0;n<i;n++)r[t[o]*i+n]=s[e[o]*i+n];return r},Sn.utils={},Sn.utils.getAABB=function(e){var t,s,i,r,o,n;r=o=n=-(t=s=i=999999999);for(var a=0;a<e.length;a+=3){var h=e[a+0],l=e[a+1],u=e[a+2];h<t&&(t=h),h>r&&(r=h),l<s&&(s=l),l>o&&(o=l),u<i&&(i=u),l>n&&(n=u)}return{min:{x:t,y:s,z:i},max:{x:r,y:o,z:n}}};class Gn extends A{constructor(e,t={}){super(e,t),this._type=t.type||(t.src?t.src.split(".").pop():null)||"jpg",this._pos=p.vec3(t.pos||[0,0,0]),this._up=p.vec3(t.up||[0,1,0]),this._normal=p.vec3(t.normal||[0,0,1]),this._height=t.height||1,this._origin=p.vec3(),this._rtcPos=p.vec3(),this._imageSize=p.vec2(),this._texture=new Dn(this),this._image=new Image,"jpg"!==this._type&&"png"!==this._type&&(this.error('Unsupported type - defaulting to "jpg"'),this._type="jpg"),this._node=new pn(this,{matrix:p.inverseMat4(p.lookAtMat4v(this._pos,p.subVec3(this._pos,this._normal,p.mat4()),this._up,p.mat4())),children:[this._bitmapMesh=new Ko(this,{scale:[1,1,1],rotation:[-90,0,0],collidable:t.collidable,pickable:t.pickable,opacity:t.opacity,clippable:t.clippable,geometry:new Mi(this,kn({center:[0,0,0],xSize:1,zSize:1,xSegments:2,zSegments:2})),material:new Ei(this,{diffuse:[0,0,0],ambient:[0,0,0],specular:[0,0,0],diffuseMap:this._texture,emissiveMap:this._texture,backfaces:!0})})]}),t.image?this.image=t.image:t.src?this.src=t.src:t.imageData&&(this.imageData=t.imageData),this.scene._bitmapCreated(this)}set visible(e){this._bitmapMesh.visible=e}get visible(){return this._bitmapMesh.visible}set image(e){this._image=e,this._image&&(this._texture.image=this._image,this._imageSize[0]=this._image.width,this._imageSize[1]=this._image.height,this._updateBitmapMeshScale())}get image(){return this._image}set src(e){if(e){this._image.onload=()=>{this._texture.image=this._image,this._imageSize[0]=this._image.width,this._imageSize[1]=this._image.height,this._updateBitmapMeshScale()},this._image.src=e;switch(e.split(".").pop()){case"jpeg":case"jpg":this._type="jpg";break;case"png":this._type="png"}}}get src(){return this._image.src}set imageData(e){this._image.onload=()=>{this._texture.image=image,this._imageSize[0]=image.width,this._imageSize[1]=image.height,this._updateBitmapMeshScale()},this._image.src=e}get imageData(){const e=document.createElement("canvas"),t=e.getContext("2d");return e.width=this._image.width,e.height=this._image.height,t.drawImage(this._image,0,0),e.toDataURL("jpg"===this._type?"image/jpeg":"image/png")}set type(e){"png"===(e=e||"jpg")&&"jpg"===e||(this.error("Unsupported value for `type` - supported types are `jpg` and `png` - defaulting to `jpg`"),e="jpg"),this._type=e}get type(){return this._type}get pos(){return this._pos}get normal(){return this._normal}get up(){return this._up}set height(e){this._height=null==e?1:e,this._image&&this._updateBitmapMeshScale()}get height(){return this._height}set collidable(e){this._bitmapMesh.collidable=!1!==e}get collidable(){return this._bitmapMesh.collidable}set clippable(e){this._bitmapMesh.clippable=!1!==e}get clippable(){return this._bitmapMesh.clippable}set pickable(e){this._bitmapMesh.pickable=!1!==e}get pickable(){return this._bitmapMesh.pickable}set opacity(e){this._bitmapMesh.opacity=e}get opacity(){return this._bitmapMesh.opacity}destroy(){super.destroy(),this.scene._bitmapDestroyed(this)}_updateBitmapMeshScale(){const e=this._imageSize[1]/this._imageSize[0];this._bitmapMesh.scale=[this._height*e,1,this._height]}}class Hn extends A{constructor(e,t={}){if(super(e,t),this._positions=t.positions||[],this._origin=p.vec3(t.origin||[0,0,0]),t.indices)this._indices=t.indices;else{this._indices=[];for(let e=0,t=this._positions.length/3-1;e<t;e+=2)this._indices.push(e),this._indices.push(e+1)}this._mesh=new Ko(this,{visible:t.visible,clippable:t.clippable,collidable:t.collidable,geometry:new Rn(this,{primitive:"lines",positions:this._positions,indices:this._indices,origin:t.origin}),material:new Ei(this,{diffuse:t.color||[0,0,0],emissive:t.color||[0,0,0]})}),this.scene._lineSetCreated(this)}set visible(e){this._mesh.visible=e}get visible(){return this._mesh.visible}get positions(){return this._positions}get indices(){return this._indices}destroy(){super.destroy(),this.scene._lineSetDestroyed(this)}}const Vn=p.vec3(),Un=p.vec3(),zn=p.vec3(),Wn=p.vec3();class Xn extends n{constructor(e,t={}){super("BCFViewpoints",e,t),this.originatingSystem=t.originatingSystem||"xeokit.io",this.authoringTool=t.authoringTool||"xeokit.io"}getViewpoint(e={}){const t=this.viewer.scene,s=t.camera,i=t.realWorldOffset,r=!0===e.reverseClippingPlanes;let o={},n=p.normalizeVec3(p.subVec3(s.look,s.eye,p.vec3())),a=s.eye,h=s.up;s.yUp&&(n=Jn(n),a=Jn(a),h=Jn(h));const l=Yn(p.addVec3(a,i));"ortho"===s.projection?o.orthogonal_camera={camera_view_point:l,camera_direction:Yn(n),camera_up_vector:Yn(h),view_to_world_scale:s.ortho.scale}:o.perspective_camera={camera_view_point:l,camera_direction:Yn(n),camera_up_vector:Yn(h),field_of_view:s.perspective.fov};const u=t.sectionPlanes;for(let e in u)if(u.hasOwnProperty(e)){let t=u[e];if(!t.active)continue;let n,a=t.pos;n=r?p.negateVec3(t.dir,p.vec3()):t.dir,s.yUp&&(a=Jn(a),n=Jn(n)),p.addVec3(a,i),a=Yn(a),n=Yn(n),o.clipping_planes||(o.clipping_planes=[]),o.clipping_planes.push({location:a,direction:n})}const c=t.lineSets;for(let e in c)if(c.hasOwnProperty(e)){const t=c[e];o.lines||(o.lines=[]);const s=t.positions,i=t.indices;for(let e=0,t=i.length/2;e<t;e++){const t=i[2*e],r=i[2*e+1];o.lines.push({start_point:{x:s[3*t+0],y:s[3*t+1],z:s[3*t+2]},end_point:{x:s[3*r+0],y:s[3*r+1],z:s[3*r+2]}})}}const d=t.bitmaps;for(let e in d)if(d.hasOwnProperty(e)){let t=d[e],r=t.pos,n=t.normal,a=t.up;s.yUp&&(r=Jn(r),n=Jn(n),a=Jn(a)),p.addVec3(r,i),o.bitmaps||(o.bitmaps=[]),o.bitmaps.push({bitmap_type:t.type,bitmap_data:t.imageData,location:Yn(r),normal:Yn(n),up:Yn(a),height:t.height})}o.components={visibility:{view_setup_hints:{spaces_visible:!!e.spacesVisible,space_boundaries_visible:!!e.spaceBoundariesVisible,openings_visible:!!e.openingsVisible}}};const m=new Set(t.opacityObjectIds),f=new Set(t.xrayedObjectIds),g=new Set(t.colorizedObjectIds),_=Object.values(t.objects).filter((e=>m.has(e.id)||g.has(e.id)||f.has(e.id))).reduce(((e,s)=>{let i,r=function(e){let t="";return t+=Math.round(255*e[0]).toString(16).padStart(2,"0"),t+=Math.round(255*e[1]).toString(16).padStart(2,"0"),t+=Math.round(255*e[2]).toString(16).padStart(2,"0"),t}(s.colorize);s.xrayed?(i=0===t.xrayMaterial.fillAlpha&&0!==t.xrayMaterial.edgeAlpha?.1:t.xrayMaterial.fillAlpha,i=Math.round(255*i).toString(16).padStart(2,"0"),r=i+r):m.has(s.id)&&(i=Math.round(255*s.opacity).toString(16).padStart(2,"0"),r=i+r),e[r]||(e[r]=[]);const o=s.id,n=s.originalSystemId,a={ifc_guid:n,originating_system:this.originatingSystem};return n!==o&&(a.authoring_tool_id=o),e[r].push(a),e}),{}),y=Object.entries(_).map((([e,t])=>({color:e,components:t})));o.components.coloring=y;const v=t.objectIds,b=t.visibleObjects,x=t.visibleObjectIds,P=v.filter((e=>!b[e])),T=t.selectedObjectIds;return e.defaultInvisible||x.length<P.length?(o.components.visibility.exceptions=this._createBCFComponents(x),o.components.visibility.default_visibility=!1):(o.components.visibility.exceptions=this._createBCFComponents(P),o.components.visibility.default_visibility=!0),o.components.selection=this._createBCFComponents(T),!1!==e.snapshot&&(o.snapshot={snapshot_type:"png",snapshot_data:this.viewer.getSnapshot({format:"png"})}),o}_createBCFComponents(e){const t=this.viewer.scene,s=[];for(let i=0,r=e.length;i<r;i++){const r=e[i],o=t.objects[r];if(o){const e={ifc_guid:o.originalSystemId,originating_system:this.originatingSystem};o.originalSystemId!==r&&(e.authoring_tool_id=r),s.push(e)}}return s}setViewpoint(e,t={}){if(!e)return;const s=this.viewer,i=s.scene,r=i.camera,o=!1!==t.rayCast,n=!1!==t.immediate,a=!1!==t.reset,h=i.realWorldOffset,l=!0===t.reverseClippingPlanes;if(i.clearSectionPlanes(),e.clipping_planes&&e.clipping_planes.forEach((function(e){let t=Kn(e.location,Vn),s=Kn(e.direction,Vn);l&&p.negateVec3(s),p.subVec3(t,h),r.yUp&&(t=Zn(t),s=Zn(s)),new tn(i,{pos:t,dir:s})})),i.clearLines(),e.lines){const t=[],s=[];let r=0;e.lines.forEach((e=>{e.start_point&&e.end_point&&(t.push(e.start_point.x),t.push(e.start_point.y),t.push(e.start_point.z),t.push(e.end_point.x),t.push(e.end_point.y),t.push(e.end_point.z),s.push(r++),s.push(r++))})),new Hn(i,{positions:t,indices:s,clippable:!1,collidable:!0})}if(i.clearBitmaps(),e.bitmaps&&e.bitmaps.forEach((function(e){const t=e.bitmap_type||"jpg",s=e.bitmap_data;let o=Kn(e.location,Un),n=Kn(e.normal,zn),a=Kn(e.up,Wn),h=e.height||1;t&&s&&o&&n&&a&&(r.yUp&&(o=Zn(o),n=Zn(n),a=Zn(a)),new Gn(i,{src:s,type:t,pos:o,normal:n,up:a,clippable:!1,collidable:!0,height:h}))})),a&&(i.setObjectsXRayed(i.xrayedObjectIds,!1),i.setObjectsHighlighted(i.highlightedObjectIds,!1),i.setObjectsSelected(i.selectedObjectIds,!1)),e.components){if(e.components.visibility){e.components.visibility.default_visibility?(i.setObjectsVisible(i.objectIds,!0),e.components.visibility.exceptions&&e.components.visibility.exceptions.forEach((e=>this._withBCFComponent(t,e,(e=>e.visible=!1))))):(i.setObjectsVisible(i.objectIds,!1),e.components.visibility.exceptions&&e.components.visibility.exceptions.forEach((e=>this._withBCFComponent(t,e,(e=>e.visible=!0)))));const r=e.components.visibility.view_setup_hints;r&&(!1===r.spaces_visible&&i.setObjectsVisible(s.metaScene.getObjectIDsByType("IfcSpace"),!1),!1===r.openings_visible&&i.setObjectsVisible(s.metaScene.getObjectIDsByType("IfcOpening"),!1),r.space_boundaries_visible)}e.components.selection&&(i.setObjectsSelected(i.selectedObjectIds,!1),e.components.selection.forEach((e=>this._withBCFComponent(t,e,(e=>e.selected=!0))))),e.components.coloring&&e.components.coloring.forEach((e=>{let s=e.color,i=0,r=!1;8===s.length&&(i=parseInt(s.substring(0,2),16)/256,i<=1&&i>=.95&&(i=1),s=s.substring(2),r=!0);const o=[parseInt(s.substring(0,2),16)/256,parseInt(s.substring(2,4),16)/256,parseInt(s.substring(4,6),16)/256];e.components.map((e=>this._withBCFComponent(t,e,(e=>{e.colorize=o,r&&(e.opacity=i)}))))}))}if(e.perspective_camera||e.orthogonal_camera){let a,l,u,c;if(e.perspective_camera?(a=Kn(e.perspective_camera.camera_view_point,Vn),l=Kn(e.perspective_camera.camera_direction,Vn),u=Kn(e.perspective_camera.camera_up_vector,Vn),r.perspective.fov=e.perspective_camera.field_of_view,c="perspective"):(a=Kn(e.orthogonal_camera.camera_view_point,Vn),l=Kn(e.orthogonal_camera.camera_direction,Vn),u=Kn(e.orthogonal_camera.camera_up_vector,Vn),r.ortho.scale=e.orthogonal_camera.view_to_world_scale,c="ortho"),p.subVec3(a,h),r.yUp&&(a=Zn(a),l=Zn(l),u=Zn(u)),o){const e=i.pick({pickSurface:!0,origin:a,direction:l});l=e?e.worldPos:p.addVec3(a,l,Vn)}else l=p.addVec3(a,l,Vn);n?(r.eye=a,r.look=l,r.up=u,r.projection=c):s.cameraFlight.flyTo({eye:a,look:l,up:u,duration:t.duration,projection:c})}}_withBCFComponent(e,t,s){const i=this.viewer,r=i.scene;if(t.authoring_tool_id&&t.originating_system===this.originatingSystem){const o=t.authoring_tool_id,n=r.objects[o];if(n)return void s(n);if(e.updateCompositeObjects){if(i.metaScene.metaObjects[o])return void r.withObjects(i.metaScene.getObjectIDsInSubtree(o),s)}}if(t.ifc_guid){const o=t.ifc_guid,n=r.objects[o];if(n)return void s(n);if(e.updateCompositeObjects){if(i.metaScene.metaObjects[o])return void r.withObjects(i.metaScene.getObjectIDsInSubtree(o),s)}Object.keys(r.models).forEach((t=>{const n=p.globalizeObjectId(t,o),a=r.objects[n];if(a)s(a);else if(e.updateCompositeObjects){i.metaScene.metaObjects[n]&&r.withObjects(i.metaScene.getObjectIDsInSubtree(n),s)}}))}}destroy(){super.destroy()}}function Yn(e){return{x:e[0],y:e[1],z:e[2]}}function Kn(e,t){return(t=new Float64Array(3))[0]=e.x,t[1]=e.y,t[2]=e.z,t}function Jn(e){return new Float64Array([e[0],-e[2],e[1]])}function Zn(e){return new Float64Array([e[0],e[2],-e[1]])}var Qn=p.vec3();const qn=(e,t,s,i)=>{var r=e-s,o=t-i;return Math.sqrt(r*r+o*o)};class $n extends A{constructor(e,t={}){if(super(e.viewer.scene,t),this.plugin=e,this._container=t.container,!this._container)throw"config missing: container";this._eventSubs={};var s=this.plugin.viewer.scene;this._originMarker=new J(s,t.origin),this._targetMarker=new J(s,t.target),this._originWorld=p.vec3(),this._targetWorld=p.vec3(),this._wp=new Float64Array(24),this._vp=new Float64Array(24),this._pp=new Float64Array(24),this._cp=new Float64Array(8),this._xAxisLabelCulled=!1,this._yAxisLabelCulled=!1,this._zAxisLabelCulled=!1,this._color=t.color||this.plugin.defaultColor;const i=t.onMouseOver?e=>{t.onMouseOver(e,this)}:null,r=t.onMouseLeave?e=>{t.onMouseLeave(e,this)}:null,o=t.onContextMenu?e=>{t.onContextMenu(e,this)}:null,n=e=>{this.plugin.viewer.scene.canvas.canvas.dispatchEvent(new WheelEvent("wheel",e))};this._originDot=new Q(this._container,{fillColor:this._color,zIndex:void 0!==e.zIndex?e.zIndex+2:void 0,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._targetDot=new Q(this._container,{fillColor:this._color,zIndex:void 0!==e.zIndex?e.zIndex+2:void 0,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._lengthWire=new Z(this._container,{color:this._color,thickness:2,thicknessClickable:6,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._xAxisWire=new Z(this._container,{color:"#FF0000",thickness:1,thicknessClickable:6,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._yAxisWire=new Z(this._container,{color:"green",thickness:1,thicknessClickable:6,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._zAxisWire=new Z(this._container,{color:"blue",thickness:1,thicknessClickable:6,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._lengthLabel=new q(this._container,{fillColor:this._color,prefix:"",text:"",zIndex:void 0!==e.zIndex?e.zIndex+4:void 0,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._xAxisLabel=new q(this._container,{fillColor:"red",prefix:"X",text:"",zIndex:void 0!==e.zIndex?e.zIndex+3:void 0,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._yAxisLabel=new q(this._container,{fillColor:"green",prefix:"Y",text:"",zIndex:void 0!==e.zIndex?e.zIndex+3:void 0,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._zAxisLabel=new q(this._container,{fillColor:"blue",prefix:"Z",text:"",zIndex:void 0!==e.zIndex?e.zIndex+3:void 0,onMouseOver:i,onMouseLeave:r,onMouseWheel:n,onContextMenu:o}),this._wpDirty=!1,this._vpDirty=!1,this._cpDirty=!1,this._visible=!1,this._originVisible=!1,this._targetVisible=!1,this._wireVisible=!1,this._axisVisible=!1,this._xAxisVisible=!1,this._yAxisVisible=!1,this._zAxisVisible=!1,this._axisEnabled=!0,this._labelsVisible=!1,this._clickable=!1,this._originMarker.on("worldPos",(e=>{this._originWorld.set(e||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._targetMarker.on("worldPos",(e=>{this._targetWorld.set(e||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._onViewMatrix=s.camera.on("viewMatrix",(()=>{this._vpDirty=!0,this._needUpdate(0)})),this._onProjMatrix=s.camera.on("projMatrix",(()=>{this._cpDirty=!0,this._needUpdate()})),this._onCanvasBoundary=s.canvas.on("boundary",(()=>{this._cpDirty=!0,this._needUpdate(0)})),this._onMetricsUnits=s.metrics.on("units",(()=>{this._cpDirty=!0,this._needUpdate()})),this._onMetricsScale=s.metrics.on("scale",(()=>{this._cpDirty=!0,this._needUpdate()})),this._onMetricsOrigin=s.metrics.on("origin",(()=>{this._cpDirty=!0,this._needUpdate()})),this.approximate=t.approximate,this.visible=t.visible,this.originVisible=t.originVisible,this.targetVisible=t.targetVisible,this.wireVisible=t.wireVisible,this.axisVisible=t.axisVisible,this.xAxisVisible=t.xAxisVisible,this.yAxisVisible=t.yAxisVisible,this.zAxisVisible=t.zAxisVisible,this.labelsVisible=t.labelsVisible}_update(){if(!this._visible)return;const e=this.plugin.viewer.scene;this._wpDirty&&(this._wp[0]=this._originWorld[0],this._wp[1]=this._originWorld[1],this._wp[2]=this._originWorld[2],this._wp[3]=1,this._wp[4]=this._targetWorld[0],this._wp[5]=this._originWorld[1],this._wp[6]=this._originWorld[2],this._wp[7]=1,this._wp[8]=this._targetWorld[0],this._wp[9]=this._targetWorld[1],this._wp[10]=this._originWorld[2],this._wp[11]=1,this._wp[12]=this._targetWorld[0],this._wp[13]=this._targetWorld[1],this._wp[14]=this._targetWorld[2],this._wp[15]=1,this._wpDirty=!1,this._vpDirty=!0),this._vpDirty&&(p.transformPositions4(e.camera.viewMatrix,this._wp,this._vp),this._vp[3]=1,this._vp[7]=1,this._vp[11]=1,this._vp[15]=1,this._vpDirty=!1,this._cpDirty=!0);const t=this._originMarker.viewPos[2],s=this._targetMarker.viewPos[2];if(t>-.3||s>-.3)return this._xAxisLabel.setCulled(!0),this._yAxisLabel.setCulled(!0),this._zAxisLabel.setCulled(!0),this._lengthLabel.setCulled(!0),this._xAxisWire.setVisible(!1),this._yAxisWire.setVisible(!1),this._zAxisWire.setVisible(!1),this._lengthWire.setVisible(!1),this._originDot.setVisible(!1),void this._targetDot.setVisible(!1);if(this._cpDirty){p.transformPositions4(e.camera.project.matrix,this._vp,this._pp);var i=this._pp,r=this._cp,o=e.canvas.canvas.getBoundingClientRect();const t=this._container.getBoundingClientRect();var n=o.top-t.top,a=o.left-t.left,h=e.canvas.boundary,l=h[2],u=h[3],c=0;const s=this.plugin.viewer.scene.metrics,f=s.scale,g=s.units,_=s.unitsInfo[g].abbrev;for(var d=0,m=i.length;d<m;d+=4)r[c]=a+Math.floor((1+i[d+0]/i[d+3])*l/2),r[c+1]=n+Math.floor((1-i[d+1]/i[d+3])*u/2),c+=2;if(this._originDot.setPos(r[0],r[1]),this._targetDot.setPos(r[6],r[7]),this._lengthWire.setStartAndEnd(r[0],r[1],r[6],r[7]),this._xAxisWire.setStartAndEnd(r[0],r[1],r[2],r[3]),this._yAxisWire.setStartAndEnd(r[2],r[3],r[4],r[5]),this._zAxisWire.setStartAndEnd(r[4],r[5],r[6],r[7]),this.labelsVisible){this._lengthLabel.setPosOnWire(r[0],r[1],r[6],r[7]),this._xAxisLabel.setPosOnWire(r[0],r[1],r[2],r[3]),this._yAxisLabel.setPosOnWire(r[2],r[3],r[4],r[5]),this._zAxisLabel.setPosOnWire(r[4],r[5],r[6],r[7]);const e=this._approximate?" ~ ":" = ";this._length=Math.abs(p.lenVec3(p.subVec3(this._targetWorld,this._originWorld,Qn))),this._lengthLabel.setText(e+(this._length*f).toFixed(2)+_);const t=Math.abs(qn(r[0],r[1],r[2],r[3])),s=Math.abs(qn(r[2],r[3],r[4],r[5])),i=Math.abs(qn(r[4],r[5],r[6],r[7])),o=this.plugin.labelMinAxisLength;this._xAxisLabelCulled=t<o,this._yAxisLabelCulled=s<o,this._zAxisLabelCulled=i<o,this._xAxisLabelCulled?this._xAxisLabel.setCulled(!0):(this._xAxisLabel.setText(e+Math.abs((this._targetWorld[0]-this._originWorld[0])*f).toFixed(2)+_),this._xAxisLabel.setCulled(!this.axisVisible)),this._yAxisLabelCulled?this._yAxisLabel.setCulled(!0):(this._yAxisLabel.setText(e+Math.abs((this._targetWorld[1]-this._originWorld[1])*f).toFixed(2)+_),this._yAxisLabel.setCulled(!this.axisVisible)),this._zAxisLabelCulled?this._zAxisLabel.setCulled(!0):(this._zAxisLabel.setText(e+Math.abs((this._targetWorld[2]-this._originWorld[2])*f).toFixed(2)+_),this._zAxisLabel.setCulled(!this.axisVisible))}else this._lengthLabel.setCulled(!0),this._xAxisLabel.setCulled(!0),this._yAxisLabel.setCulled(!0),this._zAxisLabel.setCulled(!0);this._originDot.setVisible(this._visible&&this._originVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._xAxisWire.setVisible(this.axisVisible&&this.xAxisVisible),this._yAxisWire.setVisible(this.axisVisible&&this.yAxisVisible),this._zAxisWire.setVisible(this.axisVisible&&this.zAxisVisible),this._lengthWire.setVisible(this.wireVisible),this._lengthLabel.setCulled(!this.wireVisible),this._cpDirty=!1}}set approximate(e){e=!1!==e,this._approximate!==e&&(this._approximate=e,this._cpDirty=!0,this._needUpdate(0))}get approximate(){return this._approximate}get origin(){return this._originMarker}get target(){return this._targetMarker}get length(){this._update();const e=this.plugin.viewer.scene.metrics.scale;return this._length*e}get color(){return this._color}set color(e){this._color=e,this._originDot.setFillColor(e),this._targetDot.setFillColor(e),this._lengthWire.setColor(e),this._lengthLabel.setFillColor(e)}set visible(e){e=void 0!==e?Boolean(e):this.plugin.defaultVisible,this._visible=e,this._originDot.setVisible(this._visible&&this._originVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._lengthWire.setVisible(this._visible&&this._wireVisible),this._lengthLabel.setVisible(this._visible&&this._wireVisible);const t=this._visible&&this._axisVisible&&this._xAxisVisible,s=this._visible&&this._axisVisible&&this._yAxisVisible,i=this._visible&&this._axisVisible&&this._zAxisVisible;this._xAxisWire.setVisible(t),this._yAxisWire.setVisible(s),this._zAxisWire.setVisible(i),this._xAxisLabel.setVisible(t&&!this._xAxisLabelCulled),this._yAxisLabel.setVisible(s&&!this._yAxisLabelCulled),this._zAxisLabel.setVisible(i&&!this._zAxisLabelCulled),this._cpDirty=!0,this._needUpdate()}get visible(){return this._visible}set originVisible(e){e=void 0!==e?Boolean(e):this.plugin.defaultOriginVisible,this._originVisible=e,this._originDot.setVisible(this._visible&&this._originVisible)}get originVisible(){return this._originVisible}set targetVisible(e){e=void 0!==e?Boolean(e):this.plugin.defaultTargetVisible,this._targetVisible=e,this._targetDot.setVisible(this._visible&&this._targetVisible)}get targetVisible(){return this._targetVisible}set axisEnabled(e){e=void 0!==e?Boolean(e):this.plugin.defaultAxisVisible,this._axisEnabled=e;var t=this._visible&&this._axisVisible&&this._axisEnabled;this._xAxisWire.setVisible(t&&this._xAxisVisible),this._yAxisWire.setVisible(t&&this._yAxisVisible),this._zAxisWire.setVisible(t&&this._zAxisVisible),this._xAxisLabel.setVisible(t&&!this._xAxisLabelCulled&&this._xAxisVisible),this._yAxisLabel.setVisible(t&&!this._yAxisLabelCulled&&this._xAxisVisible),this._zAxisLabel.setVisible(t&&!this._zAxisLabelCulled&&this._xAxisVisible),this._cpDirty=!0,this._needUpdate()}get axisEnabled(){return this._axisEnabled}set axisVisible(e){e=void 0!==e?Boolean(e):this.plugin.defaultAxisVisible,this._axisVisible=e;var t=this._visible&&this._axisVisible&&this._axisEnabled;this._xAxisWire.setVisible(t&&this._xAxisVisible),this._yAxisWire.setVisible(t&&this._yAxisVisible),this._zAxisWire.setVisible(t&&this._zAxisVisible),this._xAxisLabel.setVisible(t&&!this._xAxisLabelCulled&&this._xAxisVisible),this._yAxisLabel.setVisible(t&&!this._yAxisLabelCulled&&this._yAxisVisible),this._zAxisLabel.setVisible(t&&!this._zAxisLabelCulled&&this._zAxisVisible),this._cpDirty=!0,this._needUpdate()}get axisVisible(){return this._axisVisible}set xAxisVisible(e){e=void 0!==e?Boolean(e):this.plugin.defaultAxisVisible,this._xAxisVisible=e;const t=this._visible&&this._axisVisible&&this._xAxisVisible&&this._axisEnabled;this._xAxisWire.setVisible(t),this._xAxisLabel.setVisible(t&&!this._xAxisLabelCulled),this._cpDirty=!0,this._needUpdate()}get xAxisVisible(){return this._xAxisVisible}set yAxisVisible(e){e=void 0!==e?Boolean(e):this.plugin.defaultAxisVisible,this._yAxisVisible=e;const t=this._visible&&this._axisVisible&&this._yAxisVisible&&this._axisEnabled;this._yAxisWire.setVisible(t),this._yAxisLabel.setVisible(t&&!this._yAxisLabelCulled),this._cpDirty=!0,this._needUpdate()}get yAxisVisible(){return this._yAxisVisible}set zAxisVisible(e){e=void 0!==e?Boolean(e):this.plugin.defaultAxisVisible,this._zAxisVisible=e;const t=this._visible&&this._axisVisible&&this._zAxisVisible&&this._axisEnabled;this._zAxisWire.setVisible(t),this._zAxisLabel.setVisible(t&&!this._zAxisLabelCulled),this._cpDirty=!0,this._needUpdate()}get zAxisVisible(){return this._zAxisVisible}set wireVisible(e){e=void 0!==e?Boolean(e):this.plugin.defaultWireVisible,this._wireVisible=e;var t=this._visible&&this._wireVisible;this._lengthLabel.setVisible(t),this._lengthWire.setVisible(t)}get wireVisible(){return this._wireVisible}set labelsVisible(e){e=void 0!==e?Boolean(e):this.plugin.defaultLabelsVisible,this._labelsVisible=e;var t=this._visible&&this._labelsVisible;this._xAxisLabel.setVisible(t&&!this._xAxisLabelCulled&&this._clickable&&this._axisEnabled),this._yAxisLabel.setVisible(t&&!this._yAxisLabelCulled&&this._clickable&&this._axisEnabled),this._zAxisLabel.setVisible(t&&!this._zAxisLabelCulled&&this._clickable&&this._axisEnabled),this._lengthLabel.setVisible(t),this._cpDirty=!0,this._needUpdate()}get labelsVisible(){return this._labelsVisible}setHighlighted(e){this._originDot.setHighlighted(e),this._targetDot.setHighlighted(e),this._xAxisWire.setHighlighted(e),this._yAxisWire.setHighlighted(e),this._zAxisWire.setHighlighted(e),this._xAxisLabel.setHighlighted(e),this._yAxisLabel.setHighlighted(e),this._zAxisLabel.setHighlighted(e),this._lengthWire.setHighlighted(e),this._lengthLabel.setHighlighted(e)}set clickable(e){e=!!e,this._clickable=e,this._originDot.setClickable(this._clickable),this._targetDot.setClickable(this._clickable),this._xAxisWire.setClickable(this._clickable),this._yAxisWire.setClickable(this._clickable),this._zAxisWire.setClickable(this._clickable),this._lengthWire.setClickable(this._clickable),this._xAxisLabel.setClickable(this._clickable),this._yAxisLabel.setClickable(this._clickable),this._zAxisLabel.setClickable(this._clickable),this._lengthLabel.setClickable(this._clickable)}get clickable(){return this._clickable}destroy(){const e=this.plugin.viewer.scene,t=e.metrics;this._onViewMatrix&&e.camera.off(this._onViewMatrix),this._onProjMatrix&&e.camera.off(this._onProjMatrix),this._onCanvasBoundary&&e.canvas.off(this._onCanvasBoundary),this._onMetricsUnits&&t.off(this._onMetricsUnits),this._onMetricsScale&&t.off(this._onMetricsScale),this._onMetricsOrigin&&t.off(this._onMetricsOrigin),this._originDot.destroy(),this._targetDot.destroy(),this._xAxisWire.destroy(),this._yAxisWire.destroy(),this._zAxisWire.destroy(),this._lengthLabel.destroy(),this._xAxisLabel.destroy(),this._yAxisLabel.destroy(),this._zAxisLabel.destroy(),this._lengthWire.destroy(),super.destroy()}}class ea{constructor(e={}){this._eventSubIDMap=null,this._eventSubEvents=null,this._eventSubs=null,this._events=null,this._locale="en",this._messages={},this._locales=[],this._locale="en",this.messages=e.messages,this.locale=e.locale}set messages(e){this._messages=e||{},this._locales=Object.keys(this._messages),this.fire("updated",this)}loadMessages(e={}){for(let t in e)this._messages[t]=e[t];this.messages=this._messages}clearMessages(){this.messages={}}get locales(){return this._locales}set locale(e){e=e||"de",this._locale!==e&&(this._locale=e,this.fire("updated",e))}get locale(){return this._locale}translate(e,t){const s=this._messages[this._locale];if(!s)return null;const i=ta(e,s);return i?t?sa(i,t):i:null}translatePlurals(e,t,s){const i=this._messages[this._locale];if(!i)return null;let r=ta(e,i);return r=0===(t=parseInt(""+t,10))?r.zero:t>1?r.other:r.one,r?(r=sa(r,[t]),s&&(r=sa(r,s)),r):null}fire(e,t,s){this._events||(this._events={}),this._eventSubs||(this._eventSubs={}),!0!==s&&(this._events[e]=t||!0);const i=this._eventSubs[e];if(i)for(const e in i)if(i.hasOwnProperty(e)){i[e].callback(t)}}on(t,s){this._events||(this._events={}),this._eventSubIDMap||(this._eventSubIDMap=new e),this._eventSubEvents||(this._eventSubEvents={}),this._eventSubs||(this._eventSubs={});let i=this._eventSubs[t];i||(i={},this._eventSubs[t]=i);const r=this._eventSubIDMap.addItem();i[r]={callback:s},this._eventSubEvents[r]=t;const o=this._events[t];return void 0!==o&&s(o),r}off(e){if(null==e)return;if(!this._eventSubEvents)return;const t=this._eventSubEvents[e];if(t){delete this._eventSubEvents[e];const s=this._eventSubs[t];s&&delete s[e],this._eventSubIDMap.removeItem(e)}}}function ta(e,t){if(t[e])return t[e];const s=e.split(".");let i=t;for(let e=0,t=s.length;i&&e<t;e++){i=i[s[e]]}return i}function sa(e,t=[]){return e.replace(/\{\{|\}\}|\{(\d+)\}/g,(function(e,s){return"{{"===e?"{":"}}"===e?"}":t[s]}))}class ia extends A{constructor(e,t={}){super(e,t),this.t=t.t}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get tangent(){return this.getTangent(this._t)}get length(){var e=this._getLengths();return e[e.length-1]}getTangent(e){var t=1e-4;void 0===e&&(e=this._t);var s=e-t,i=e+t;s<0&&(s=0),i>1&&(i=1);var r=this.getPoint(s),o=this.getPoint(i),n=p.subVec3(o,r,[]);return p.normalizeVec3(n,[])}getPointAt(e){var t=this.getUToTMapping(e);return this.getPoint(t)}getPoints(e){e||(e=5);var t,s=[];for(t=0;t<=e;t++)s.push(this.getPoint(t/e));return s}_getLengths(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,s,i=[],r=this.getPoint(0),o=0;for(i.push(0),s=1;s<=e;s++)t=this.getPoint(s/e),o+=p.lenVec3(p.subVec3(t,r,[])),i.push(o),r=t;return this.cacheArcLengths=i,i}_updateArcLengths(){this.needsUpdate=!0,this._getLengths()}getUToTMapping(e,t){var s,i=this._getLengths(),r=0,o=i.length;s=t||e*i[o-1];for(var n,a=0,h=o-1;a<=h;)if((n=i[r=Math.floor(a+(h-a)/2)]-s)<0)a=r+1;else{if(!(n>0)){h=r;break}h=r-1}if(i[r=h]===s)return r/(o-1);var l=i[r];return(r+(s-l)/(i[r+1]-l))/(o-1)}}class ra extends ia{constructor(e,t={}){super(e,t),this.points=t.points,this.t=t.t}set points(e){this._points=e||[]}get points(){return this._points}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get point(){return this.getPoint(this._t)}getPoint(e){var t=this.points;if(!(t.length<3)){var s=(t.length-1)*e,i=Math.floor(s),r=s-i,o=t[0===i?i:i-1],n=t[i],a=t[i>t.length-2?t.length-1:i+1],h=t[i>t.length-3?t.length-1:i+2],l=p.vec3();return l[0]=p.catmullRomInterpolate(o[0],n[0],a[0],h[0],r),l[1]=p.catmullRomInterpolate(o[1],n[1],a[1],h[1],r),l[2]=p.catmullRomInterpolate(o[2],n[2],a[2],h[2],r),l}this.error("Can't sample point from SplineCurve - not enough points on curve - returning [0,0,0].")}getJSON(){return{points:points,t:this._t}}}const oa=p.vec3();class na extends A{get type(){return"CameraPath"}constructor(e,t={}){super(e,t),this._frames=[],this._eyeCurve=new ra(this),this._lookCurve=new ra(this),this._upCurve=new ra(this),t.frames&&(this.addFrames(t.frames),this.smoothFrameTimes(1))}get frames(){return this._frames}get eyeCurve(){return this._eyeCurve}get lookCurve(){return this._lookCurve}get upCurve(){return this._upCurve}saveFrame(e){const t=this.scene.camera;this.addFrame(e,t.eye,t.look,t.up)}addFrame(e,t,s,i){const r={t:e,eye:t.slice(0),look:s.slice(0),up:i.slice(0)};this._frames.push(r),this._eyeCurve.points.push(r.eye),this._lookCurve.points.push(r.look),this._upCurve.points.push(r.up)}addFrames(e){let t;for(let s=0,i=e.length;s<i;s++)t=e[s],this.addFrame(t.t||0,t.eye,t.look,t.up)}loadFrame(e){const t=this.scene.camera;e=(e/=this._frames[this._frames.length-1].t-this._frames[0].t)<0?0:e>1?1:e,t.eye=this._eyeCurve.getPoint(e,oa),t.look=this._lookCurve.getPoint(e,oa),t.up=this._upCurve.getPoint(e,oa)}sampleFrame(e,t,s,i){e=e<0?0:e>1?1:e,this._eyeCurve.getPoint(e,t),this._lookCurve.getPoint(e,s),this._upCurve.getPoint(e,i)}smoothFrameTimes(e){if(0===this._frames.length)return;const t=p.vec3();var s=0;this._frames[0].t=0;const i=[];for(let e=1,o=this._frames.length;e<o;e++){var r=p.lenVec3(p.subVec3(this._frames[e].eye,this._frames[e-1].eye,t));i[e]=r,s+=r}for(let t=1,r=this._frames.length;t<r;t++){const r=i[t]/s*e;this._frames[t].t=this._frames[t-1].t+r}}clearFrames(){this._frames=[],this._eyeCurve.points=[],this._lookCurve.points=[],this._upCurve.points=[]}}const aa=p.vec3(),ha=p.vec3(),la=p.vec3(),ua=p.vec3(),ca=p.vec3();class pa extends A{get type(){return"CameraFlightAnimation"}constructor(e,t={}){super(e,t),this._look1=p.vec3(),this._eye1=p.vec3(),this._up1=p.vec3(),this._look2=p.vec3(),this._eye2=p.vec3(),this._up2=p.vec3(),this._orthoScale1=1,this._orthoScale2=1,this._flying=!1,this._flyEyeLookUp=!1,this._flyingEye=!1,this._flyingLook=!1,this._callback=null,this._callbackScope=null,this._time1=null,this._time2=null,this.easing=!1!==t.easing,this.duration=t.duration,this.fit=t.fit,this.fitFOV=t.fitFOV,this.trail=t.trail}flyTo(e,t,s){e=e||this.scene,this._flying&&this.stop(),this._flying=!1,this._flyingEye=!1,this._flyingLook=!1,this._flyingEyeLookUp=!1,this._callback=t,this._callbackScope=s;const i=this.scene.camera,r=!!e.projection&&e.projection!==i.projection;let o,n,a,h,l;if(this._eye1[0]=i.eye[0],this._eye1[1]=i.eye[1],this._eye1[2]=i.eye[2],this._look1[0]=i.look[0],this._look1[1]=i.look[1],this._look1[2]=i.look[2],this._up1[0]=i.up[0],this._up1[1]=i.up[1],this._up1[2]=i.up[2],this._orthoScale1=i.ortho.scale,this._orthoScale2=e.orthoScale||this._orthoScale1,e.aabb)o=e.aabb;else if(6===e.length)o=e;else if(e.eye&&e.look||e.up)n=e.eye,a=e.look,h=e.up;else if(e.eye)n=e.eye;else if(e.look)a=e.look;else{let i=e;if((y.isNumeric(i)||y.isString(i))&&(l=i,i=this.scene.components[l],!i))return this.error("Component not found: "+y.inQuotes(l)),void(t&&(s?t.call(s):t()));r||(o=i.aabb||this.scene.aabb)}const u=e.poi;if(o){if(o[3]<o[0]||o[4]<o[1]||o[5]<o[2])return;if(o[3]===o[0]&&o[4]===o[1]&&o[5]===o[2])return;o=o.slice();const t=p.getAABB3Center(o);this._look2=u||t;const s=p.subVec3(this._eye1,this._look1,aa),i=p.normalizeVec3(s),r=u?p.getAABB3DiagPoint(o,u):p.getAABB3Diag(o),n=e.fitFOV||this._fitFOV,a=Math.abs(r/Math.tan(n*p.DEGTORAD));this._orthoScale2=1.1*r,this._eye2[0]=this._look2[0]+i[0]*a,this._eye2[1]=this._look2[1]+i[1]*a,this._eye2[2]=this._look2[2]+i[2]*a,this._up2[0]=this._up1[0],this._up2[1]=this._up1[1],this._up2[2]=this._up1[2],this._flyingEyeLookUp=!0}else(n||a||h)&&(this._flyingEyeLookUp=!!n&&!!a&&!!h,this._flyingEye=!!n&&!a,this._flyingLook=!!a&&!n,n&&(this._eye2[0]=n[0],this._eye2[1]=n[1],this._eye2[2]=n[2]),a&&(this._look2[0]=a[0],this._look2[1]=a[1],this._look2[2]=a[2]),h&&(this._up2[0]=h[0],this._up2[1]=h[1],this._up2[2]=h[2]));r?("ortho"===e.projection&&"ortho"!==i.projection&&(this._projection2="ortho",this._projMatrix1=i.projMatrix.slice(),this._projMatrix2=i.ortho.matrix.slice(),i.projection="customProjection"),"perspective"===e.projection&&"perspective"!==i.projection&&(this._projection2="perspective",this._projMatrix1=i.projMatrix.slice(),this._projMatrix2=i.perspective.matrix.slice(),i.projection="customProjection")):this._projection2=null,this.fire("started",e,!0),this._time1=Date.now(),this._time2=this._time1+(e.duration?1e3*e.duration:this._duration),this._flying=!0,C.scheduleTask(this._update,this)}jumpTo(e){this._jumpTo(e)}_jumpTo(e){this._flying&&this.stop();const t=this.scene.camera;var s,i,r,o,n;if(e.aabb)s=e.aabb;else if(6===e.length)s=e;else if(e.eye||e.look||e.up)r=e.eye,o=e.look,n=e.up;else{let t=e;if((y.isNumeric(t)||y.isString(t))&&(i=t,t=this.scene.components[i],!t))return void this.error("Component not found: "+y.inQuotes(i));s=t.aabb||this.scene.aabb}const a=e.poi;if(s){if(s[3]<=s[0]||s[4]<=s[1]||s[5]<=s[2])return;var h=a?p.getAABB3DiagPoint(s,a):p.getAABB3Diag(s);let i;o=a||p.getAABB3Center(s,o),this._trail?p.subVec3(t.look,o,ca):p.subVec3(t.eye,t.look,ca),p.normalizeVec3(ca);i=(void 0!==e.fit?e.fit:this._fit)?Math.abs(h/Math.tan((e.fitFOV||this._fitFOV)*p.DEGTORAD)):p.lenVec3(p.subVec3(t.eye,t.look,aa)),p.mulVec3Scalar(ca,i),t.eye=p.addVec3(o,ca,aa),t.look=o,this.scene.camera.ortho.scale=1.1*h}else(r||o||n)&&(r&&(t.eye=r),o&&(t.look=o),n&&(t.up=n));e.projection&&(t.projection=e.projection)}_update(){if(!this._flying)return;let e=(Date.now()-this._time1)/(this._time2-this._time1);const t=e>=1;e>1&&(e=1);const s=this.easing?pa._ease(e,0,1,1):e,i=this.scene.camera;if(this._flyingEye||this._flyingLook?this._flyingEye?(p.subVec3(i.eye,i.look,ca),i.eye=p.lerpVec3(s,0,1,this._eye1,this._eye2,la),i.look=p.subVec3(la,ca,ha)):this._flyingLook&&(i.look=p.lerpVec3(s,0,1,this._look1,this._look2,ha),i.up=p.lerpVec3(s,0,1,this._up1,this._up2,ua)):this._flyingEyeLookUp&&(i.eye=p.lerpVec3(s,0,1,this._eye1,this._eye2,la),i.look=p.lerpVec3(s,0,1,this._look1,this._look2,ha),i.up=p.lerpVec3(s,0,1,this._up1,this._up2,ua)),this._projection2){const t="ortho"===this._projection2?pa._easeOutExpo(e,0,1,1):pa._easeInCubic(e,0,1,1);i.customProjection.matrix=p.lerpMat4(t,0,1,this._projMatrix1,this._projMatrix2)}else i.ortho.scale=this._orthoScale1+e*(this._orthoScale2-this._orthoScale1);if(t)return i.ortho.scale=this._orthoScale2,void this.stop();C.scheduleTask(this._update,this)}static _ease(e,t,s,i){return-s*(e/=i)*(e-2)+t}static _easeInCubic(e,t,s,i){return s*(e/=i)*e*e+t}static _easeOutExpo(e,t,s,i){return s*(1-Math.pow(2,-10*e/i))+t}stop(){if(!this._flying)return;this._flying=!1,this._time1=null,this._time2=null,this._projection2&&(this.scene.camera.projection=this._projection2);const e=this._callback;e&&(this._callback=null,this._callbackScope?e.call(this._callbackScope):e()),this.fire("stopped",!0,!0)}cancel(){this._flying&&(this._flying=!1,this._time1=null,this._time2=null,this._callback&&(this._callback=null),this.fire("canceled",!0,!0))}set duration(e){this._duration=e?1e3*e:500,this.stop()}get duration(){return this._duration/1e3}set fit(e){this._fit=!1!==e}get fit(){return this._fit}set fitFOV(e){this._fitFOV=e||45}get fitFOV(){return this._fitFOV}set trail(e){this._trail=!!e}get trail(){return this._trail}destroy(){this.stop(),super.destroy()}}class da extends A{get type(){return"CameraPathAnimation"}constructor(e,t={}){super(e,t),this._cameraFlightAnimation=new pa(this),this._t=0,this.state=da.SCRUBBING,this._playingFromT=0,this._playingToT=0,this._playingRate=t.playingRate||1,this._playingDir=1,this._lastTime=null,this.cameraPath=t.cameraPath,this._tick=this.scene.on("tick",this._updateT,this)}_updateT(){const e=this._cameraPath;if(!e)return;let t,s;const i=performance.now(),r=this._lastTime?.001*(i-this._lastTime):0;if(this._lastTime=i,0!==r)switch(this.state){case da.SCRUBBING:return;case da.PLAYING:if(this._t+=this._playingRate*r,t=this._cameraPath.frames.length,0===t||this._playingDir<0&&this._t<=0||this._playingDir>0&&this._t>=this._cameraPath.frames[t-1].t)return this.state=da.SCRUBBING,this._t=this._cameraPath.frames[t-1].t,void this.fire("stopped");e.loadFrame(this._t);break;case da.PLAYING_TO:s=this._t+this._playingRate*r*this._playingDir,(this._playingDir<0&&s<=this._playingToT||this._playingDir>0&&s>=this._playingToT)&&(s=this._playingToT,this.state=da.SCRUBBING,this.fire("stopped")),this._t=s,e.loadFrame(this._t)}}_ease(e,t,s,i){return-s*(e/=i)*(e-2)+t}set cameraPath(e){this._cameraPath=e}get cameraPath(){return this._cameraPath}set rate(e){this._playingRate=e}get rate(){return this._playingRate}play(){this._cameraPath&&(this._lastTime=null,this.state=da.PLAYING)}playToT(e){this._cameraPath&&(this._playingFromT=this._t,this._playingToT=e,this._playingDir=this._playingToT-this._playingFromT<0?-1:1,this._lastTime=null,this.state=da.PLAYING_TO)}playToFrame(e){const t=this._cameraPath;if(!t)return;const s=t.frames[e];s?this.playToT(s.t):this.error("playToFrame - frame index out of range: "+e)}flyToFrame(e,t){const s=this._cameraPath;if(!s)return;const i=s.frames[e];i?(this.state=da.SCRUBBING,this._cameraFlightAnimation.flyTo(i,t)):this.error("flyToFrame - frame index out of range: "+e)}scrubToT(e){const t=this._cameraPath;if(!t)return;this.scene.camera&&(this._t=e,t.loadFrame(this._t),this.state=da.SCRUBBING)}scrubToFrame(e){const t=this._cameraPath;if(!t)return;if(!this.scene.camera)return;t.frames[e]?(t.loadFrame(this._t),this.state=da.SCRUBBING):this.error("playToFrame - frame index out of range: "+e)}stop(){this.state=da.SCRUBBING,this.fire("stopped")}destroy(){super.destroy(),this.scene.off(this._tick)}}da.STOPPED=0,da.SCRUBBING=1,da.PLAYING=2,da.PLAYING_TO=3;const ma=p.vec3(),fa=p.vec3();p.vec3();const ga=p.vec3([0,-1,0]),_a=p.vec4([0,0,0,1]);class ya extends A{constructor(e,t={}){super(e,t),this._src=null,this._image=null,this._pos=p.vec3(),this._origin=p.vec3(),this._rtcPos=p.vec3(),this._dir=p.vec3(),this._size=1,this._imageSize=p.vec2(),this._texture=new Dn(this),this._plane=new Ko(this,{geometry:new Mi(this,kn({center:[0,0,0],xSize:1,zSize:1,xSegments:10,zSegments:10})),material:new Ei(this,{diffuse:[0,0,0],ambient:[0,0,0],specular:[0,0,0],diffuseMap:this._texture,emissiveMap:this._texture,backfaces:!0}),clippable:t.clippable}),this._grid=new Ko(this,{geometry:new Mi(this,Nn({size:1,divisions:10})),material:new Ei(this,{diffuse:[0,0,0],ambient:[0,0,0],emissive:[.2,.8,.2]}),position:[0,.001,0],clippable:t.clippable}),this._node=new pn(this,{rotation:[0,0,0],position:[0,0,0],scale:[1,1,1],clippable:!1,children:[this._plane,this._grid]}),this._gridVisible=!1,this.visible=!0,this.gridVisible=t.gridVisible,this.position=t.position,this.rotation=t.rotation,this.dir=t.dir,this.size=t.size,this.collidable=t.collidable,this.clippable=t.clippable,this.pickable=t.pickable,this.opacity=t.opacity,t.image?this.image=t.image:this.src=t.src}set visible(e){this._plane.visible=e,this._grid.visible=this._gridVisible&&e}get visible(){return this._plane.visible}set gridVisible(e){e=!1!==e,this._gridVisible=e,this._grid.visible=this._gridVisible&&this.visible}get gridVisible(){return this._gridVisible}set image(e){this._image=e,this._image&&(this._imageSize[0]=e.width,this._imageSize[1]=e.height,this._updatePlaneSizeFromImage(),this._src=null,this._texture.image=this._image)}get image(){return this._image}set src(e){if(this._src=e,this._src){this._image=null;const e=new Image;e.onload=()=>{this._texture.image=e,this._imageSize[0]=e.width,this._imageSize[1]=e.height,this._updatePlaneSizeFromImage()},e.src=this._src}}get src(){return this._src}set position(e){this._pos.set(e||[0,0,0]),z(this._pos,this._origin,this._rtcPos),this._node.origin=this._origin,this._node.position=this._rtcPos}get position(){return this._pos}set rotation(e){this._node.rotation=e}get rotation(){return this._node.rotation}set size(e){this._size=null==e?1:e,this._image&&this._updatePlaneSizeFromImage()}get size(){return this._size}set dir(e){if(this._dir.set(e||[0,0,-1]),e){const t=this.scene.center,s=[-this._dir[0],-this._dir[1],-this._dir[2]];p.subVec3(t,this.position,ma);const i=-p.dotVec3(s,ma);p.normalizeVec3(s),p.mulVec3Scalar(s,i,fa),p.vec3PairToQuaternion(ga,e,_a),this._node.quaternion=_a}}get dir(){return this._dir}set collidable(e){this._node.collidable=!1!==e}get collidable(){return this._node.collidable}set clippable(e){this._node.clippable=!1!==e}get clippable(){return this._node.clippable}set pickable(e){this._node.pickable=!1!==e}get pickable(){return this._node.pickable}set opacity(e){this._node.opacity=e}get opacity(){return this._node.opacity}destroy(){super.destroy()}_updatePlaneSizeFromImage(){const e=this._size,t=this._imageSize[0],s=this._imageSize[1];if(t>s){const i=s/t;this._node.scale=[e,1,e*i]}else{const i=t/s;this._node.scale=[e*i,1,e]}}}class va extends vi{get type(){return"PointLight"}constructor(e,t={}){super(e,t);const s=this;this._shadowRenderBuf=null,this._shadowViewMatrix=null,this._shadowProjMatrix=null,this._shadowViewMatrixDirty=!0,this._shadowProjMatrixDirty=!0;const i=this.scene.camera,r=this.scene.canvas;this._onCameraViewMatrix=i.on("viewMatrix",(()=>{this._shadowViewMatrixDirty=!0})),this._onCameraProjMatrix=i.on("projMatrix",(()=>{this._shadowProjMatrixDirty=!0})),this._onCanvasBoundary=r.on("boundary",(()=>{this._shadowProjMatrixDirty=!0})),this._state=new ft({type:"point",pos:p.vec3([1,1,1]),color:p.vec3([.7,.7,.8]),intensity:1,attenuation:[0,0,0],space:t.space||"view",castsShadow:!1,getShadowViewMatrix:()=>{if(s._shadowViewMatrixDirty){s._shadowViewMatrix||(s._shadowViewMatrix=p.identityMat4());const e=s._state.pos,t=i.look,r=i.up;p.lookAtMat4v(e,t,r,s._shadowViewMatrix),s._shadowViewMatrixDirty=!1}return s._shadowViewMatrix},getShadowProjMatrix:()=>{if(s._shadowProjMatrixDirty){s._shadowProjMatrix||(s._shadowProjMatrix=p.identityMat4());const e=s.scene.canvas.canvas;p.perspectiveMat4(Math.PI/180*70,e.clientWidth/e.clientHeight,.1,500,s._shadowProjMatrix),s._shadowProjMatrixDirty=!1}return s._shadowProjMatrix},getShadowRenderBuf:()=>(s._shadowRenderBuf||(s._shadowRenderBuf=new je(s.scene.canvas.canvas,s.scene.canvas.gl,{size:[1024,1024]})),s._shadowRenderBuf)}),this.pos=t.pos,this.color=t.color,this.intensity=t.intensity,this.constantAttenuation=t.constantAttenuation,this.linearAttenuation=t.linearAttenuation,this.quadraticAttenuation=t.quadraticAttenuation,this.castsShadow=t.castsShadow,this.scene._lightCreated(this)}set pos(e){this._state.pos.set(e||[1,1,1]),this._shadowViewMatrixDirty=!0,this.glRedraw()}get pos(){return this._state.pos}set color(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}get color(){return this._state.color}set intensity(e){e=void 0!==e?e:1,this._state.intensity=e,this.glRedraw()}get intensity(){return this._state.intensity}set constantAttenuation(e){this._state.attenuation[0]=e||0,this.glRedraw()}get constantAttenuation(){return this._state.attenuation[0]}set linearAttenuation(e){this._state.attenuation[1]=e||0,this.glRedraw()}get linearAttenuation(){return this._state.attenuation[1]}set quadraticAttenuation(e){this._state.attenuation[2]=e||0,this.glRedraw()}get quadraticAttenuation(){return this._state.attenuation[2]}set castsShadow(e){e=!!e,this._state.castsShadow!==e&&(this._state.castsShadow=e,this._shadowViewMatrixDirty=!0,this.glRedraw())}get castsShadow(){return this._state.castsShadow}destroy(){const e=this.scene.camera,t=this.scene.canvas;e.off(this._onCameraViewMatrix),e.off(this._onCameraProjMatrix),t.off(this._onCanvasBoundary),super.destroy(),this._state.destroy(),this._shadowRenderBuf&&this._shadowRenderBuf.destroy(),this.scene._lightDestroyed(this),this.glRedraw()}}function ba(e){if(!xa(e.width)||!xa(e.height)){const t=document.createElement("canvas");t.width=Pa(e.width),t.height=Pa(e.height);t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}return e}function xa(e){return 0==(e&e-1)}function Pa(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}class Ta extends A{get type(){return"CubeTexture"}constructor(e,t={}){super(e,t);const s=this.scene.canvas.gl;this._state=new ft({texture:new Pn({gl:s,target:s.TEXTURE_CUBE_MAP}),flipY:this._checkFlipY(t.minFilter),encoding:this._checkEncoding(t.encoding),minFilter:1008,magFilter:1006,wrapS:1001,wrapT:1001,mipmaps:!0}),this._src=t.src,this._images=[],this._loadSrc(t.src),m.memory.textures++}_checkFlipY(e){return!!e}_checkEncoding(e){return 3e3!==(e=e||3e3)&&3001!==e&&(this.error("Unsupported value for 'encoding' - supported values are LinearEncoding and sRGBEncoding. Defaulting to LinearEncoding."),e=3e3),e}_webglContextRestored(){this.scene.canvas.gl,this._state.texture=null,this._src&&this._loadSrc(this._src)}_loadSrc(e){const t=this,s=this.scene.canvas.gl;this._images=[];let i=!1,r=0;for(let o=0;o<e.length;o++){const n=new Image;n.onload=function(){let e=n;const a=o;return function(){if(!i&&(e=ba(e),t._images[a]=e,r++,6===r)){let e=t._state.texture;e||(e=new Pn({gl:s,target:s.TEXTURE_CUBE_MAP}),t._state.texture=e),e.setImage(t._images,t._state),t.fire("loaded",t._src,!1),t.glRedraw()}}}(),n.onerror=function(){i=!0},n.src=e[o]}}destroy(){super.destroy(),this._state.texture&&this._state.texture.destroy(),m.memory.textures--,this._state.destroy()}}class wa extends Ta{get type(){return"ReflectionMap"}constructor(e,t={}){super(e,t),this.scene._lightsState.addReflectionMap(this._state),this.scene._reflectionMapCreated(this)}destroy(){super.destroy(),this.scene._reflectionMapDestroyed(this)}}class Ma extends Ta{get type(){return"LightMap"}constructor(e,t={}){super(e,t),this.scene._lightMapCreated(this)}destroy(){super.destroy(),this.scene._lightMapDestroyed(this)}}class Ia extends J{constructor(e,t={}){super(e,{entity:t.entity,occludable:t.occludable,worldPos:t.worldPos}),this._occluded=!1,this._visible=!0,this._src=null,this._image=null,this._pos=p.vec3(),this._origin=p.vec3(),this._rtcPos=p.vec3(),this._dir=p.vec3(),this._size=1,this._imageSize=p.vec2(),this._texture=new Dn(this,{src:t.src}),this._geometry=new Mi(this,{primitive:"triangles",positions:[3,3,0,-3,3,0,-3,-3,0,3,-3,0],normals:[-1,0,0,-1,0,0,-1,0,0,-1,0,0],uv:[1,-1,0,-1,0,0,1,0],indices:[0,1,2,0,2,3]}),this._mesh=new Ko(this,{geometry:this._geometry,material:new Ei(this,{ambient:[.9,.3,.9],shininess:30,diffuseMap:this._texture,backfaces:!0}),scale:[1,1,1],position:t.worldPos,rotation:[90,0,0],billboard:"spherical",occluder:!1}),this.visible=!0,this.collidable=t.collidable,this.clippable=t.clippable,this.pickable=t.pickable,this.opacity=t.opacity,this.size=t.size,t.image?this.image=t.image:this.src=t.src}_setVisible(e){this._occluded=!e,this._mesh.visible=this._visible&&!this._occluded,super._setVisible(e)}set visible(e){this._visible=null==e||e,this._mesh.visible=this._visible&&!this._occluded}get visible(){return this._visible}set image(e){this._image=e,this._image&&(this._imageSize[0]=this._image.width,this._imageSize[1]=this._image.height,this._updatePlaneSizeFromImage(),this._src=null,this._texture.image=this._image)}get image(){return this._image}set src(e){if(this._src=e,this._src){this._image=null;const e=new Image;e.onload=()=>{this._texture.image=e,this._imageSize[0]=e.width,this._imageSize[1]=e.height,this._updatePlaneSizeFromImage()},e.src=this._src}}get src(){return this._src}set size(e){this._size=null==e?1:e,this._image&&this._updatePlaneSizeFromImage()}get size(){return this._size}set collidable(e){this._mesh.collidable=!1!==e}get collidable(){return this._mesh.collidable}set clippable(e){this._mesh.clippable=!1!==e}get clippable(){return this._mesh.clippable}set pickable(e){this._mesh.pickable=!1!==e}get pickable(){return this._mesh.pickable}set opacity(e){this._mesh.opacity=e}get opacity(){return this._mesh.opacity}_updatePlaneSizeFromImage(){const e=.5*this._size,t=this._imageSize[0],s=this._imageSize[1],i=s/t;this._geometry.positions=t>s?[e,e*i,0,-e,e*i,0,-e,-e*i,0,e,-e*i,0]:[e/i,e,0,-e/i,e,0,-e/i,-e,0,e/i,-e,0]}}const Ca=p.vec3(),Da=p.vec3(),Aa=p.mat4();class Ea{constructor(){this.normal=p.vec3(),this.offset=0,this.testVertex=p.vec3()}set(e,t,s,i){const r=1/Math.sqrt(e*e+t*t+s*s);this.normal[0]=e*r,this.normal[1]=t*r,this.normal[2]=s*r,this.offset=i*r,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0}}class Fa{constructor(){this.planes=[new Ea,new Ea,new Ea,new Ea,new Ea,new Ea]}}function Ra(e,t,s){const i=p.mulMat4(s,t,Aa),r=i[0],o=i[1],n=i[2],a=i[3],h=i[4],l=i[5],u=i[6],c=i[7],d=i[8],m=i[9],f=i[10],g=i[11],_=i[12],y=i[13],v=i[14],b=i[15];e.planes[0].set(a-r,c-h,g-d,b-_),e.planes[1].set(a+r,c+h,g+d,b+_),e.planes[2].set(a-o,c-l,g-m,b-y),e.planes[3].set(a+o,c+l,g+m,b+y),e.planes[4].set(a-n,c-u,g-f,b-v),e.planes[5].set(a+n,c+u,g+f,b+v)}function Sa(e,t){let s=Fa.INSIDE;const i=Ca,r=Da;i[0]=t[0],i[1]=t[1],i[2]=t[2],r[0]=t[3],r[1]=t[4],r[2]=t[5];const o=[i,r];for(let t=0;t<6;++t){const i=e.planes[t];if(i.normal[0]*o[i.testVertex[0]][0]+i.normal[1]*o[i.testVertex[1]][1]+i.normal[2]*o[i.testVertex[2]][2]+i.offset<0)return Fa.OUTSIDE;i.normal[0]*o[1-i.testVertex[0]][0]+i.normal[1]*o[1-i.testVertex[1]][1]+i.normal[2]*o[1-i.testVertex[2]][2]+i.offset<0&&(s=Fa.INTERSECT)}return s}Fa.INSIDE=0,Fa.INTERSECT=1,Fa.OUTSIDE=2;class Oa{constructor(e){this._eye=p.vec3(),this._look=p.vec3(),this._up=p.vec3(),this._projection={},e&&this.saveCamera(e)}saveCamera(e){const t=e.camera,s=t.project;switch(this._eye.set(t.eye),this._look.set(t.look),this._up.set(t.up),t.projection){case"perspective":this._projection={projection:"perspective",fov:s.fov,fovAxis:s.fovAxis,near:s.near,far:s.far};break;case"ortho":this._projection={projection:"ortho",scale:s.scale,near:s.near,far:s.far};break;case"frustum":this._projection={projection:"frustum",left:s.left,right:s.right,top:s.top,bottom:s.bottom,near:s.near,far:s.far};break;case"custom":this._projection={projection:"custom",matrix:s.matrix.slice()}}}restoreCamera(e,t){const s=e.camera,i=this._projection;function r(){switch(i.type){case"perspective":s.perspective.fov=i.fov,s.perspective.fovAxis=i.fovAxis,s.perspective.near=i.near,s.perspective.far=i.far;break;case"ortho":s.ortho.scale=i.scale,s.ortho.near=i.near,s.ortho.far=i.far;break;case"frustum":s.frustum.left=i.left,s.frustum.right=i.right,s.frustum.top=i.top,s.frustum.bottom=i.bottom,s.frustum.near=i.near,s.frustum.far=i.far;break;case"custom":s.customProjection.matrix=i.matrix}}t?e.viewer.cameraFlight.flyTo({eye:this._eye,look:this._look,up:this._up,orthoScale:i.scale,projection:i.projection},(()=>{r(),t()})):(s.eye=this._eye,s.look=this._look,s.up=this._up,r(),s.projection=i.projection)}}const Ba=p.vec3();class La{constructor(e){if(this.objectsVisible=[],this.objectsEdges=[],this.objectsXrayed=[],this.objectsHighlighted=[],this.objectsSelected=[],this.objectsClippable=[],this.objectsPickable=[],this.objectsColorize=[],this.objectsOpacity=[],this.numObjects=0,e){const t=e.metaScene.scene;this.saveObjects(t,e)}}saveObjects(e,t,s){const i=t.rootMetaObject;if(!i)return;const r=i.getObjectIDsInSubtree();this.numObjects=0,this._mask=s?y.apply(s,{}):null;const o=e.objects,n=!s||s.visible,a=!s||s.edges,h=!s||s.xrayed,l=!s||s.highlighted,u=!s||s.selected,c=!s||s.clippable,p=!s||s.pickable,d=!s||s.colorize,m=!s||s.opacity;for(var f=0,g=r.length;f<g;f++){const e=o[r[f]];if(e){if(n&&(this.objectsVisible[f]=e.visible),a&&(this.objectsEdges[f]=e.edges),h&&(this.objectsXrayed[f]=e.xrayed),l&&(this.objectsHighlighted[f]=e.highlighted),u&&(this.objectsSelected[f]=e.selected),c&&(this.objectsClippable[f]=e.clippable),p&&(this.objectsPickable[f]=e.pickable),d){const t=e.colorize;this.objectsColorize[3*f+0]=t[0],this.objectsColorize[3*f+1]=t[1],this.objectsColorize[3*f+2]=t[2]}m&&(this.objectsOpacity[f]=e.opacity),this.numObjects++}}}restoreObjects(e,t){const s=t.rootMetaObject;if(!s)return;const i=s.getObjectIDsInSubtree(),r=this._mask,o=!r||r.visible,n=!r||r.edges,a=!r||r.xrayed,h=!r||r.highlighted,l=!r||r.selected,u=!r||r.clippable,c=!r||r.pickable,p=!r||r.colorize,d=!r||r.opacity,m=e.objects;for(var f=0,g=i.length;f<g;f++){const e=m[i[f]];e&&(o&&(e.visible=this.objectsVisible[f]),n&&(e.edges=this.objectsEdges[f]),a&&(e.xrayed=this.objectsXrayed[f]),h&&(e.highlighted=this.objectsHighlighted[f]),l&&(e.selected=this.objectsSelected[f]),u&&(e.clippable=this.objectsClippable[f]),c&&(e.pickable=this.objectsPickable[f]),p&&(Ba[0]=this.objectsColorize[3*f+0],Ba[1]=this.objectsColorize[3*f+1],Ba[2]=this.objectsColorize[3*f+2],e.colorize=Ba),d&&(e.opacity=this.objectsOpacity[f]))}}}const Na=p.vec3();class ka{constructor(){this.objectsVisible=[],this.objectsEdges=[],this.objectsXrayed=[],this.objectsHighlighted=[],this.objectsSelected=[],this.objectsClippable=[],this.objectsPickable=[],this.objectsColorize=[],this.objectsHasColorize=[],this.objectsOpacity=[],this.numObjects=0}saveObjects(e,t){this.numObjects=0,this._mask=t?y.apply(t,{}):null;const s=e.objects,i=!t||t.visible,r=!t||t.edges,o=!t||t.xrayed,n=!t||t.highlighted,a=!t||t.selected,h=!t||t.clippable,l=!t||t.pickable,u=!t||t.colorize,c=!t||t.opacity;for(let e in s)if(s.hasOwnProperty(e)){const t=s[e],p=this.numObjects;if(i&&(this.objectsVisible[p]=t.visible),r&&(this.objectsEdges[p]=t.edges),o&&(this.objectsXrayed[p]=t.xrayed),n&&(this.objectsHighlighted[p]=t.highlighted),a&&(this.objectsSelected[p]=t.selected),h&&(this.objectsClippable[p]=t.clippable),l&&(this.objectsPickable[p]=t.pickable),u){const e=t.colorize;e?(this.objectsColorize[3*p+0]=e[0],this.objectsColorize[3*p+1]=e[1],this.objectsColorize[3*p+2]=e[2],this.objectsHasColorize[p]=!0):this.objectsHasColorize[p]=!1}c&&(this.objectsOpacity[p]=t.opacity),this.numObjects++}}restoreObjects(e){const t=this._mask,s=!t||t.visible,i=!t||t.edges,r=!t||t.xrayed,o=!t||t.highlighted,n=!t||t.selected,a=!t||t.clippable,h=!t||t.pickable,l=!t||t.colorize,u=!t||t.opacity;var c=0;const p=e.objects;for(let e in p)if(p.hasOwnProperty(e)){const t=p[e];s&&(t.visible=this.objectsVisible[c]),i&&(t.edges=this.objectsEdges[c]),r&&(t.xrayed=this.objectsXrayed[c]),o&&(t.highlighted=this.objectsHighlighted[c]),n&&(t.selected=this.objectsSelected[c]),a&&(t.clippable=this.objectsClippable[c]),h&&(t.pickable=this.objectsPickable[c]),l&&(this.objectsHasColorize[c]?(Na[0]=this.objectsColorize[3*c+0],Na[1]=this.objectsColorize[3*c+1],Na[2]=this.objectsColorize[3*c+2],t.colorize=Na):t.colorize=null),u&&(t.opacity=this.objectsOpacity[c]),c++}}}class ja extends ia{constructor(e,t={}){super(e,t),this.v0=t.v0,this.v1=t.v1,this.v2=t.v2,this.v3=t.v3,this.t=t.t}set v0(e){this._v0=e||p.vec3([0,0,0])}get v0(){return this._v0}set v1(e){this._v1=e||p.vec3([0,0,0])}get v1(){return this._v1}set v2(e){this._v2=e||p.vec3([0,0,0])}get v2(){return this._v2}set v3(e){this.fire("v3",this._v3=e||p.vec3([0,0,0]))}get v3(){return this._v3}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get point(){return this.getPoint(this._t)}getPoint(e){var t=p.vec3();return t[0]=p.b3(e,this._v0[0],this._v1[0],this._v2[0],this._v3[0]),t[1]=p.b3(e,this._v0[1],this._v1[1],this._v2[1],this._v3[1]),t[2]=p.b3(e,this._v0[2],this._v1[2],this._v2[2],this._v3[2]),t}getJSON(){return{v0:this._v0,v1:this._v1,v2:this._v2,v3:this._v3,t:this._t}}}class Ga extends ia{constructor(e,t={}){super(e,t),this._cachedLengths=[],this._dirty=!0,this._curves=[],this._t=0,this._dirtySubs=[],this._destroyedSubs=[],this.curves=t.curves||[],this.t=t.t}addCurve(e){this._curves.push(e),this._dirty=!0}set curves(e){var t,s,i;for(e=e||[],s=0,i=this._curves.length;s<i;s++)(t=this._curves[s]).off(this._dirtySubs[s]),t.off(this._destroyedSubs[s]);this._curves=[],this._dirtySubs=[],this._destroyedSubs=[];var r=this;function o(){r._dirty=!0}function n(){var e=this.id;for(s=0,i=r._curves.length;s<i;s++)if(r._curves[s].id===e)return r._curves=r._curves.slice(s,s+1),r._dirtySubs=r._dirtySubs.slice(s,s+1),r._destroyedSubs=r._destroyedSubs.slice(s,s+1),void(r._dirty=!0)}for(s=0,i=e.length;s<i;s++){if(t=e[s],y.isNumeric(t)||y.isString(t)){var a=t;if(!(t=this.scene.components[a])){this.error("Component not found: "+_inQuotes(a));continue}}var h=t.type;"xeokit.SplineCurve"===h||"xeokit.Path"===h||"xeokit.CubicBezierCurve"===h||"xeokit.QuadraticBezierCurve"===h?(this._curves.push(t),this._dirtySubs.push(t.on("dirty",o)),this._destroyedSubs.push(t.once("destroyed",n))):this.error("Component "+_inQuotes(t.id)+" is not a xeokit.SplineCurve, xeokit.Path or xeokit.QuadraticBezierCurve")}this._dirty=!0}get curves(){return this._curves}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get point(){return this.getPoint(this._t)}get length(){var e=this._getCurveLengths();return e[e.length-1]}getPoint(e){for(var t,s=e*this.length,i=this._getCurveLengths(),r=0;r<i.length;){if(i[r]>=s){var o=1-(i[r]-s)/(t=this._curves[r]).length;return t.getPointAt(o)}r++}return null}_getCurveLengths(){if(!this._dirty)return this._cachedLengths;var e,t=[],s=0,i=this._curves.length;for(e=0;e<i;e++)s+=this._curves[e].length,t.push(s);return this._cachedLengths=t,this._dirty=!1,t}_getJSON(){for(var e=[],t=0,s=this._curves.length;t<s;t++)e.push(this._curves[t].id);return{curves:e,t:this._t}}destroy(){var e,t,s;for(super.destroy(),e=0,t=this._curves.length;e<t;e++)(s=this._curves[e]).off(this._dirtySubs[e]),s.off(this._destroyedSubs[e])}}class Ha extends ia{constructor(e,t={}){super(e,t),this.v0=t.v0,this.v1=t.v1,this.v2=t.v2,this.t=t.t}set v0(e){this._v0=e||p.vec3([0,0,0])}get v0(){return this._v0}set v1(e){this._v1=e||p.vec3([0,0,0])}get v1(){return this._v1}set v2(e){this._v2=e||p.vec3([0,0,0])}get v2(){return this._v2}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get point(){return this.getPoint(this._t)}getPoint(e){var t=p.vec3();return t[0]=p.b2(e,this._v0[0],this._v1[0],this._v2[0]),t[1]=p.b2(e,this._v0[1],this._v1[1],this._v2[1]),t[2]=p.b2(e,this._v0[2],this._v1[2],this._v2[2]),t}getJSON(){return{v0:this._v0,v1:this._v1,v2:this._v2,t:this._t}}}class Va{get objects(){}get origin(){}get position(){}get rotation(){}get quaternion(){}get scale(){}get matrix(){}get worldMatrix(){}get worldNormalMatrix(){}get viewMatrix(){}get viewNormalMatrix(){}get backfaces(){}set backfaces(e){}get entityList(){}get isEntity(){}get isModel(){}get isObject(){}get aabb(){}get numTriangles(){}get numLines(){}get numPoints(){}get visible(){}set visible(e){}get xrayed(){}set xrayed(e){}get highlighted(){}set highlighted(e){}get selected(){}set selected(e){}get edges(){}set edges(e){}get culled(){}set culled(e){}get clippable(){}set clippable(e){}get collidable(){}set collidable(e){}get pickable(){}set pickable(e){}get colorize(){}set colorize(e){}get opacity(){}set opacity(e){}get castsShadow(){}set castsShadow(e){}get receivesShadow(){}set receivesShadow(e){}get saoEnabled(){}get pbrEnabled(){}get colorTextureEnabled(){}get isDrawable(){}get isStateSortable(){}get xrayMaterial(){}get highlightMaterial(){}get selectedMaterial(){}get edgeMaterial(){}getPickViewMatrix(e){}createGeometry(e){}createTexture(e){}createTextureSet(e){}createMesh(e){}createEntity(e){}finalize(){}stateSortCompare(e,t){}drawColorOpaque(e){}drawColorTransparent(e){}drawDepth(e){}drawNormals(e){}drawSilhouetteXRayed(e){}drawSilhouetteHighlighted(e){}drawSilhouetteSelected(e){}drawEdgesColorOpaque(e){}drawEdgesColorTransparent(e){}drawEdgesXRayed(e){}drawEdgesHighlighted(e){}drawEdgesSelected(e){}drawOcclusion(e){}drawShadow(e){}drawPickMesh(e){}drawPickDepths(e){}drawPickNormals(e){}destroy(){}}class Ua{constructor(e,t,s,i,r=null,o=0){this.model=e,this.object=null,this.parent=null,this.id=t,this.pickId=this.model.scene._renderer.getPickID(this),this.aabb=p.AABB3(),this._layer=r,this._portionId=o,this._color=[s[0],s[1],s[2],i],this._colorize=[s[0],s[1],s[2],i],this._colorizing=!1,this._transparent=i<255,this.numTriangles=0,this.origin=null}_finalize(e){this._layer.initFlags(this._portionId,e,this._transparent)}_finalize2(){this._layer.flushInitFlags&&this._layer.flushInitFlags()}_setVisible(e){this._layer.setVisible(this._portionId,e,this._transparent)}_setColor(e){this._color[0]=e[0],this._color[1]=e[1],this._color[2]=e[2],this._colorizing||this._layer.setColor(this._portionId,this._color,!1)}_setColorize(e){e?(this._colorize[0]=e[0],this._colorize[1]=e[1],this._colorize[2]=e[2],this._layer.setColor(this._portionId,this._colorize,false),this._colorizing=!0):(this._layer.setColor(this._portionId,this._color,false),this._colorizing=!1)}_setOpacity(e,t){const s=e<255,i=this._transparent!==s;this._color[3]=e,this._colorize[3]=e,this._transparent=s,this._colorizing?this._layer.setColor(this._portionId,this._colorize):this._layer.setColor(this._portionId,this._color),i&&this._layer.setTransparent(this._portionId,t,s)}_setOffset(e){this._layer.setOffset(this._portionId,e)}_setHighlighted(e){this._layer.setHighlighted(this._portionId,e,this._transparent)}_setXRayed(e){this._layer.setXRayed(this._portionId,e,this._transparent)}_setSelected(e){this._layer.setSelected(this._portionId,e,this._transparent)}_setEdges(e){this._layer.setEdges(this._portionId,e,this._transparent)}_setClippable(e){this._layer.setClippable(this._portionId,e,this._transparent)}_setCollidable(e){this._layer.setCollidable(this._portionId,e)}_setPickable(e){this._layer.setPickable(this._portionId,e,this._transparent)}_setCulled(e){this._layer.setCulled(this._portionId,e,this._transparent)}canPickTriangle(){return!1}drawPickTriangles(e,t){}pickTriangleSurface(e){}precisionRayPickSurface(e,t,s,i){return!!this._layer.precisionRayPickSurface&&this._layer.precisionRayPickSurface(this._portionId,e,t,s,i)}canPickWorldPos(){return!0}drawPickDepths(e){this.model.drawPickDepths(e)}drawPickNormals(e){this.model.drawPickNormals(e)}delegatePickedEntity(){return this.parent}_destroy(){this.model.scene._renderer.putPickID(this.pickId)}}const za=new class{constructor(){this._uint8Arrays={},this._float32Arrays={}}_clear(){this._uint8Arrays={},this._float32Arrays={}}getUInt8Array(e){let t=this._uint8Arrays[e];return t||(t=new Uint8Array(e),this._uint8Arrays[e]=t),t}getFloat32Array(e){let t=this._float32Arrays[e];return t||(t=new Float32Array(e),this._float32Arrays[e]=t),t}};let Wa=0;const Xa=0,Ya=1,Ka=2,Ja=3,Za=4,Qa=5,qa=6,$a=7,eh=8,th=9,sh=10,ih=11,rh=p.vec4(),oh=p.vec3();class nh{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,s){const i=this._scene,r=i.camera,o=t.model,n=i.canvas.gl,a=t._state,h=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(r.viewMatrix,h):r.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,o.worldNormalMatrix);const l=i._sectionPlanesState.sectionPlanes.length;if(l>0){const e=i._sectionPlanesState.sectionPlanes,s=t.layerIndex*l,r=o.renderFlags;for(let t=0;t<l;t++){const i=this._uSectionPlanes[t];if(i){const o=r.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,o?1:0),o){const s=e[t];if(h){const e=X(s.dist,s.dir,h,oh);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(a.normalsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._lightsState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=i.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=i.getLocation("lightDir"+e),this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e)}this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aNormal=i.getAttribute("normal"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,s=t.canvas.gl,i=this._program,r=t._lightsState.lights,o=t.camera.project;i.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(let e=0,t=r.length;e<t;e++){const t=r[e];this._uLightColor[e]&&s.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(s.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&s.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&s.uniform3fv(this._uLightDir[e],t.dir)}if(this._withSAO){const i=t.sao;if(i.possible){const t=s.drawingBufferWidth,r=s.drawingBufferHeight;rh[0]=t,rh[1]=r,rh[2]=i.blendCutoff,rh[3]=i.blendFactor,s.uniform4fv(this._uSAOParams,rh),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}if(t.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState,s=e._lightsState,i=t.sectionPlanes.length>0;let r;const o=[];o.push("#version 300 es"),o.push("// Triangles batching draw vertex shader"),o.push("uniform int renderPass;"),o.push("in vec3 position;"),o.push("in vec3 normal;"),o.push("in vec4 color;"),o.push("in vec4 flags;"),o.push("in vec4 flags2;"),e.entityOffsetsEnabled&&o.push("in vec3 offset;"),o.push("uniform mat4 worldMatrix;"),o.push("uniform mat4 worldNormalMatrix;"),o.push("uniform mat4 viewMatrix;"),o.push("uniform mat4 projMatrix;"),o.push("uniform mat4 viewNormalMatrix;"),o.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),o.push("out float vFragDepth;"),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("out float isPerspective;")),o.push("uniform vec4 lightAmbient;");for(let e=0,t=s.lights.length;e<t;e++)r=s.lights[e],"ambient"!==r.type&&(o.push("uniform vec4 lightColor"+e+";"),"dir"===r.type&&o.push("uniform vec3 lightDir"+e+";"),"point"===r.type&&o.push("uniform vec3 lightPos"+e+";"),"spot"===r.type&&(o.push("uniform vec3 lightPos"+e+";"),o.push("uniform vec3 lightDir"+e+";")));o.push("vec3 octDecode(vec2 oct) {"),o.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),o.push("    if (v.z < 0.0) {"),o.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),o.push("    }"),o.push("    return normalize(v);"),o.push("}"),i&&(o.push("out vec4 vWorldPosition;"),o.push("out vec4 vFlags2;")),o.push("out vec4 vColor;"),o.push("void main(void) {"),o.push("if (int(flags.x) != renderPass) {"),o.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),o.push("} else {"),o.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&o.push("worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition  = viewMatrix * worldPosition; "),o.push("vec4 worldNormal =  worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),o.push("vec3 viewNormal = normalize((viewNormalMatrix * worldNormal).xyz);"),o.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),o.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),o.push("float lambertian = 1.0;");for(let e=0,t=s.lights.length;e<t;e++)if(r=s.lights[e],"ambient"!==r.type){if("dir"===r.type)"view"===r.space?o.push("viewLightDir = normalize(lightDir"+e+");"):o.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===r.type)"view"===r.space?o.push("viewLightDir = -normalize(lightPos"+e+" - viewPosition.xyz);"):o.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==r.type)continue;"view"===r.space?o.push("viewLightDir = normalize(lightDir"+e+");"):o.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}o.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),o.push("reflectedColor += lambertian * (lightColor"+e+".rgb * lightColor"+e+".a);")}return o.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),o.push("vColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),o.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(o.push("vFragDepth = 1.0 + clipPos.w;"),o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i&&(o.push("vWorldPosition = worldPosition;"),o.push("vFlags2 = flags2;")),o.push("gl_Position = clipPos;"),o.push("}"),o.push("}"),o}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Triangles batching draw fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),this._withSAO&&(i.push("uniform sampler2D uOcclusionTexture;"),i.push("uniform vec4      uSAOParams;"),i.push("const float       packUpscale = 256. / 255.;"),i.push("const float       unpackDownScale = 255. / 256.;"),i.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),i.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),i.push("float unpackRGBToFloat( const in vec4 v ) {"),i.push("    return dot( v, unPackFactors );"),i.push("}")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { "),i.push("      discard;"),i.push("  }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),this._withSAO?(i.push("   float viewportWidth     = uSAOParams[0];"),i.push("   float viewportHeight    = uSAOParams[1];"),i.push("   float blendCutoff       = uSAOParams[2];"),i.push("   float blendFactor       = uSAOParams[3];"),i.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),i.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),i.push("   outColor            = vec4(vColor.rgb * ambient, 1.0);")):i.push("   outColor            = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const ah=p.vec4(),hh=p.vec3();class lh{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,s){const i=this._scene,r=i.camera,o=t.model,n=i.canvas.gl,a=t._state,h=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(r.viewMatrix,h):r.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix);const l=i._sectionPlanesState.sectionPlanes.length;if(l>0){const e=i._sectionPlanesState.sectionPlanes,s=t.layerIndex*l,r=o.renderFlags;for(let t=0;t<l;t++){const i=this._uSectionPlanes[t],o=r.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,o?1:0),o){const s=e[t];if(h){const e=X(s.dist,s.dir,h,hh);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._lightsState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=i.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=i.getLocation("lightDir"+e),this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e)}this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,s=t.canvas.gl,i=this._program,r=t._lightsState.lights,o=t.camera.project;i.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(let e=0,t=r.length;e<t;e++){const t=r[e];this._uLightColor[e]&&s.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(s.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&s.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&s.uniform3fv(this._uLightDir[e],t.dir)}if(this._withSAO){const i=t.sao;if(i.possible){const t=s.drawingBufferWidth,r=s.drawingBufferHeight;ah[0]=t,ah[1]=r,ah[2]=i.blendCutoff,ah[3]=i.blendFactor,s.uniform4fv(this._uSAOParams,ah),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}if(t.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles batching flat-shading draw vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),s.push("in vec4 color;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vViewPosition;"),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("vViewPosition = viewPosition;"),s.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._lightsState,s=e._sectionPlanesState,i=s.sectionPlanes.length>0,r=[];if(r.push("#version 300 es"),r.push("// Triangles batching flat-shading draw fragment shader"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),e.logarithmicDepthBufferEnabled&&(r.push("in float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("in float vFragDepth;")),this._withSAO&&(r.push("uniform sampler2D uOcclusionTexture;"),r.push("uniform vec4      uSAOParams;"),r.push("const float       packUpscale = 256. / 255.;"),r.push("const float       unpackDownScale = 255. / 256.;"),r.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),r.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),r.push("float unpackRGBToFloat( const in vec4 v ) {"),r.push("    return dot( v, unPackFactors );"),r.push("}")),i){r.push("in vec4 vWorldPosition;"),r.push("in vec4 vFlags2;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)r.push("uniform bool sectionPlaneActive"+e+";"),r.push("uniform vec3 sectionPlanePos"+e+";"),r.push("uniform vec3 sectionPlaneDir"+e+";")}r.push("uniform mat4 viewMatrix;"),r.push("uniform vec4 lightAmbient;");for(let e=0,s=t.lights.length;e<s;e++){const s=t.lights[e];"ambient"!==s.type&&(r.push("uniform vec4 lightColor"+e+";"),"dir"===s.type&&r.push("uniform vec3 lightDir"+e+";"),"point"===s.type&&r.push("uniform vec3 lightPos"+e+";"),"spot"===s.type&&(r.push("uniform vec3 lightPos"+e+";"),r.push("uniform vec3 lightDir"+e+";")))}if(r.push("in vec4 vViewPosition;"),r.push("in vec4 vColor;"),r.push("out vec4 outColor;"),r.push("void main(void) {"),i){r.push("  bool clippable = (float(vFlags2.x) > 0.0);"),r.push("  if (clippable) {"),r.push("  float dist = 0.0;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)r.push("if (sectionPlaneActive"+e+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { "),r.push("      discard;"),r.push("  }"),r.push("}")}r.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),r.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),r.push("float lambertian = 1.0;"),r.push("vec3 xTangent = dFdx( vViewPosition.xyz );"),r.push("vec3 yTangent = dFdy( vViewPosition.xyz );"),r.push("vec3 viewNormal = normalize( cross( xTangent, yTangent ) );");for(let e=0,s=t.lights.length;e<s;e++){const s=t.lights[e];if("ambient"!==s.type){if("dir"===s.type)"view"===s.space?r.push("viewLightDir = normalize(lightDir"+e+");"):r.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===s.type)"view"===s.space?r.push("viewLightDir = -normalize(lightPos"+e+" - viewPosition.xyz);"):r.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==s.type)continue;"view"===s.space?r.push("viewLightDir = normalize(lightDir"+e+");"):r.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}r.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),r.push("reflectedColor += lambertian * (lightColor"+e+".rgb * lightColor"+e+".a);")}}return r.push("vec4 fragColor =  vec4((lightAmbient.rgb * lightAmbient.a * vColor.rgb) + (reflectedColor * vColor.rgb), vColor.a);"),this._withSAO?(r.push("   float viewportWidth     = uSAOParams[0];"),r.push("   float viewportHeight    = uSAOParams[1];"),r.push("   float blendCutoff       = uSAOParams[2];"),r.push("   float blendFactor       = uSAOParams[3];"),r.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),r.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),r.push("   outColor            = vec4(fragColor.rgb * ambient, 1.0);")):r.push("   outColor            = fragColor;"),e.logarithmicDepthBufferEnabled&&r.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),r.push("}"),r}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const uh=new Float32Array([1,1,1]),ch=p.vec3();class ph{constructor(e,t){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===Qa){const e=r.xrayMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uSilhouetteColor,t[0],t[1],t[2],s)}else if(s===Ja){const e=r.highlightMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uSilhouetteColor,t[0],t[1],t[2],s)}else if(s===Za){const e=r.selectedMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uSilhouetteColor,t[0],t[1],t[2],s)}else n.uniform4fv(this._uSilhouetteColor,uh);const l=h?U(o.viewMatrix,h):o.viewMatrix;n.uniformMatrix4fv(this._uViewMatrix,!1,l),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,o=i.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,ch);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSilhouetteColor=s.getLocation("silhouetteColor"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aColor=s.getAttribute("color"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles batching silhouette vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 color;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform vec4 silhouetteColor;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.y) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vColor = vec4(silhouetteColor.r, silhouetteColor.g, silhouetteColor.b, min(silhouetteColor.a, float(color.a) / 255.0));"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState;let s,i;const r=t.sectionPlanes.length>0,o=[];if(o.push("#version 300 es"),o.push("// Triangles batching silhouette fragment shader"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),e.logarithmicDepthBufferEnabled&&(o.push("in float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("in float vFragDepth;")),r)for(o.push("in vec4 vWorldPosition;"),o.push("in vec4 vFlags2;"),s=0,i=t.sectionPlanes.length;s<i;s++)o.push("uniform bool sectionPlaneActive"+s+";"),o.push("uniform vec3 sectionPlanePos"+s+";"),o.push("uniform vec3 sectionPlaneDir"+s+";");if(o.push("in vec4 vColor;"),o.push("out vec4 outColor;"),o.push("void main(void) {"),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),s=0,i=t.sectionPlanes.length;s<i;s++)o.push("if (sectionPlaneActive"+s+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+s+".xyz, vWorldPosition.xyz - sectionPlanePos"+s+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { discard; }"),o.push("}")}return e.logarithmicDepthBufferEnabled&&o.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("outColor = vColor;"),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const dh=p.vec3(),mh=new Float32Array([0,0,0,1]);class fh{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===sh){const e=r.xrayMaterial._state,t=e.edgeColor,s=e.edgeAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===eh){const e=r.highlightMaterial._state,t=e.edgeColor,s=e.edgeAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===th){const e=r.selectedMaterial._state,t=e.edgeColor,s=e.edgeAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else n.uniform4fv(this._uColor,mh);n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*l,o=i.renderFlags;for(let t=0;t<l;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,dh);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.edgeIndicesBuf.bind(),n.drawElements(n.LINES,a.edgeIndicesBuf.numItems,a.edgeIndicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uColor=s.getLocation("color"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=this._program,i=e.camera.project;if(s.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Batched geometry edges drawing vertex shader"),s.push("uniform int renderPass;"),s.push("uniform vec4 color;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.z) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("  vWorldPosition = worldPosition;"),s.push("  vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("vColor = vec4(color.r, color.g, color.b, color.a);"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Batched geometry edges drawing fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("outColor = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const gh=p.vec3();class _h{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*l,o=i.renderFlags;for(let t=0;t<l;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,gh);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.edgeIndicesBuf.bind(),n.drawElements(n.LINES,a.edgeIndicesBuf.numItems,a.edgeIndicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aColor=s.getAttribute("color"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=this._program,i=e.camera.project;if(s.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Batched geometry edges drawing vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),s.push("in vec4 color;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.z) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("  vWorldPosition = worldPosition;"),s.push("  vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("vColor = vec4(float(color.r*0.5) / 255.0, float(color.g*0.5) / 255.0, float(color.b*0.5) / 255.0, float(color.a) / 255.0);"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Batched geometry edges drawing fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("outColor = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const yh=p.vec3();class vh{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const l=e.pickViewMatrix||o.viewMatrix,u=h?U(l,h):l;if(n.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),n.uniformMatrix4fv(this._uViewMatrix,!1,u),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,e)}const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*c,o=i.renderFlags;for(let t=0;t<c;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,yh);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aPickColor&&this._aPickColor.bindArrayBuffer(a.pickColorsBuf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aPickColor=s.getAttribute("pickColor"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene.canvas.gl;this._program.bind(),t.uniform1i(this._uPickInvisible,e.pickInvisible)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Batched geometry picking vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 pickColor;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vPickColor;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("      vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Batched geometry picking fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("uniform bool sectionPlaneActive"+r+";"),i.push("uniform vec3 sectionPlanePos"+r+";"),i.push("uniform vec3 sectionPlaneDir"+r+";")}if(i.push("in vec4 vPickColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("   outColor = vPickColor; "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const bh=p.vec3();class xh{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin;this._program||this._allocate(),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniform1i(this._uPickInvisible,e.pickInvisible);const l=e.pickViewMatrix||o.viewMatrix,u=h?U(l,h):l;if(n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uViewMatrix,!1,u),n.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),n.uniform1f(this._uPickZNear,e.pickZNear),n.uniform1f(this._uPickZFar,e.pickZFar),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(e.pickZFar+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,t)}const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*c,o=i.renderFlags;for(let t=0;t<c;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,bh);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uPickZNear=s.getLocation("pickZNear"),this._uPickZFar=s.getLocation("pickZFar"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles batching pick depth vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vViewPosition;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vViewPosition = viewPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Triangles batching pick depth fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),i.push("uniform float pickZNear;"),i.push("uniform float pickZFar;"),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("uniform bool sectionPlaneActive"+r+";"),i.push("uniform vec3 sectionPlanePos"+r+";"),i.push("uniform vec3 sectionPlaneDir"+r+";")}if(i.push("in vec4 vViewPosition;"),i.push("vec4 packDepth(const in float depth) {"),i.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),i.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),i.push("  vec4 res = fract(depth * bitShift);"),i.push("  res -= res.xxyz * bitMask;"),i.push("  return res;"),i.push("}"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),i.push("    outColor = packDepth(zNormalizedDepth); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Ph=p.vec3();class Th{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniform1i(this._uPickInvisible,e.pickInvisible),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const l=e.pickViewMatrix||o.viewMatrix,u=h?U(l,h):l;if(n.uniformMatrix4fv(this._uViewMatrix,!1,u),n.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,e)}const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*c,o=i.renderFlags;for(let t=0;t<c;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,Ph);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(a.normalsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles batching pick normals vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec3 normal;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),s.push("vec3 octDecode(vec2 oct) {"),s.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),s.push("    if (v.z < 0.0) {"),s.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),s.push("    }"),s.push("    return normalize(v);"),s.push("}"),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec3 vWorldNormal;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("      vec3 worldNormal =  octDecode(normal.xy); "),s.push("      vWorldNormal = worldNormal;"),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Triangles batching pick normals fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("uniform bool sectionPlaneActive"+r+";"),i.push("uniform vec3 sectionPlanePos"+r+";"),i.push("uniform vec3 sectionPlaneDir"+r+";")}if(i.push("in vec3 vWorldNormal;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    outColor = vec4((vWorldNormal * 0.5) + 0.5, 1.0);"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const wh=p.vec3();class Mh{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.canvas.gl,n=t._state,a=r.camera,h=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,s),o.uniformMatrix4fv(this._uViewMatrix,!1,h?U(a.viewMatrix,h):a.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*l,n=i.renderFlags;for(let t=0;t<l;t++){const i=this._uSectionPlanes[t];if(i){const r=n.sectionPlanesActivePerLayer[s+t];if(o.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,wh);o.uniform3fv(i.pos,e)}else o.uniform3fv(i.pos,s.pos);o.uniform3fv(i.dir,s.dir)}}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aColor&&this._aColor.bindArrayBuffer(n.colorsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),n.indicesBuf.bind(),o.drawElements(o.TRIANGLES,n.indicesBuf.numItems,n.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles batching occlusion vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 color;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Triangles batching occlusion fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("      if (sectionPlaneActive"+e+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("   outColor = vec4(0.0, 0.0, 1.0, 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Ih=p.vec3();class Ch{constructor(e){this._scene=e,this._allocate(),this._hash=this._getHash()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*l,o=i.renderFlags;for(let t=0;t<l;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,Ih);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles batching depth vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec2 vHighPrecisionZW;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("vHighPrecisionZW = gl_Position.zw;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Triangles batching depth fragment shader"),i.push("precision highp float;"),i.push("precision highp int;"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("const float   packUpScale = 256. / 255.;"),i.push("const float   unpackDownscale = 255. / 256.;"),i.push("const vec3    packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),i.push("const vec4    unpackFactors = unpackDownscale / vec4( packFactors, 1. );"),i.push("const float   shiftRight8 = 1.0 / 256.;"),i.push("vec4 packDepthToRGBA( const in float v ) {"),i.push("    vec4 r = vec4( fract( v * packFactors ), v );"),i.push("    r.yzw -= r.xyz * shiftRight8;"),i.push("    return r * packUpScale;"),i.push("}"),i.push("in vec2 vHighPrecisionZW;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;"),i.push("    outColor = vec4(vec3(1.0 - fragCoordZ), 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null,m.memory.programs--}}const Dh=p.vec3();class Ah{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(t)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,i.worldNormalMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*l,o=i.renderFlags;for(let t=0;t<l;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,Dh);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aNormal.bindArrayBuffer(a.normalsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2&&(this._aFlags2=s.getAttribute("flags2")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Batched geometry normals vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec3 normal;"),s.push("in vec4 color;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 worldNormalMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 viewNormalMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),s.push("vec3 octDecode(vec2 oct) {"),s.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),s.push("    if (v.z < 0.0) {"),s.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),s.push("    }"),s.push("    return normalize(v);"),s.push("}"),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec3 vViewNormal;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition   = viewMatrix * worldPosition; "),s.push("      vec4 worldNormal    = worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),s.push("      vec3 viewNormal     = normalize((viewNormalMatrix * worldNormal).xyz);"),t&&(s.push("      vWorldPosition  = worldPosition;"),s.push("      vFlags2         = flags2;")),s.push("      vViewNormal = viewNormal;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Batched geometry normals fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec3 vViewNormal;"),i.push("vec3 packNormalToRGB( const in vec3 normal ) {"),i.push("    return normalize( normal ) * 0.5 + 0.5;"),i.push("}"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    outColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Eh=p.vec3();class Fh{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t){const s=this._scene,i=s.canvas.gl,r=t._state;this._program||this._allocate(),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),i.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),s.logarithmicDepthBufferEnabled&&i.uniform1f(this._uZFar,s.camera.project.far),this._aPosition.bindArrayBuffer(r.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(r.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(r.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(r.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(r.offsetsBuf),r.indicesBuf.bind();const o=s._sectionPlanesState.sectionPlanes.length;if(o>0){const e=s._sectionPlanesState.sectionPlanes,r=t.layerIndex*o,n=model.renderFlags,a=t._state.origin;for(let t=0;t<o;t++){const s=this._uSectionPlanes[t];if(s){const o=n.sectionPlanesActivePerLayer[r+t];if(i.uniform1i(s.active,o?1:0),o){const r=e[t];if(a){const e=X(r.dist,r.dir,a,Eh);i.uniform3fv(s.pos,e)}else i.uniform3fv(s.pos,r.pos);i.uniform3fv(s.dir,r.dir)}}}}i.drawElements(i.TRIANGLES,r.indicesBuf.numItems,r.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uShadowViewMatrix=i.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=i.getLocation("shadowProjMatrix"),e.logarithmicDepthBufferEnabled&&(this._uZFar=i.getLocation("zFar")),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2")}_bindProgram(e){const t=this._scene.canvas.gl;this._program.bind(),t.uniformMatrix4fv(this._uShadowViewMatrix,!1,e.shadowViewMatrix),t.uniformMatrix4fv(this._uShadowProjMatrix,!1,e.shadowProjMatrix),this._lastLightId=null}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Batched geometry shadow vertex shader"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 color;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("uniform mat4 shadowViewMatrix;"),s.push("uniform mat4 shadowProjMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vViewPosition;"),s.push("out vec4 outColor;"),s.push("void main(void) {"),s.push("  bool visible        = (float(flags.x) > 0.0);"),s.push("  bool transparent    = ((float(color.a) / 255.0) < 1.0);"),s.push("  if (!visible || transparent) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = shadowViewMatrix * worldPosition; "),t&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("      vViewPosition = viewPosition;"),s.push("      gl_Position = shadowProjMatrix * viewPosition;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene._sectionPlanesState,t=e.sectionPlanes.length>0,s=[];if(s.push("#version 300 es"),s.push("// Batched geometry shadow fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),t){s.push("in vec4 vWorldPosition;"),s.push("in vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)s.push("uniform bool sectionPlaneActive"+t+";"),s.push("uniform vec3 sectionPlanePos"+t+";"),s.push("uniform vec3 sectionPlaneDir"+t+";")}if(s.push("in vec4 vViewPosition;"),s.push("vec4 encodeFloat( const in float v ) {"),s.push("  const vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);"),s.push("  const vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);"),s.push("  vec4 comp = fract(v * bitShift);"),s.push("  comp -= comp.xxyz * bitMask;"),s.push("  return comp;"),s.push("}"),s.push("out vec4 outColor;"),s.push("void main(void) {"),t){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(var i=0;i<e.sectionPlanes.length;i++)s.push("      if (sectionPlaneActive"+i+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+i+".xyz, vWorldPosition.xyz - sectionPlanePos"+i+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return s.push("    outColor = encodeFloat( gl_FragCoord.z); "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Rh=p.vec4(),Sh=p.vec3();class Oh{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e.gammaOutput,e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,s){const i=ce.MAX_TEXTURE_IMAGE_UNITS,r=this._scene,o=r.camera,n=t.model,a=r.canvas.gl,h=t._state,l=t._state.origin,u=h.textureSet,c=r._lightsState;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,s),a.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),a.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,n.worldMatrix),a.uniformMatrix4fv(this._uWorldNormalMatrix,!1,n.worldNormalMatrix);const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*p,i=n.renderFlags;for(let t=0;t<p;t++){const r=this._uSectionPlanes[t];if(r){const o=i.sectionPlanesActivePerLayer[s+t];if(a.uniform1i(r.active,o?1:0),o){const s=e[t];if(l){const e=X(s.dist,s.dir,l,Sh);a.uniform3fv(r.pos,e)}else a.uniform3fv(r.pos,s.pos);a.uniform3fv(r.dir,s.dir)}}}}if(a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._uUVDecodeMatrix&&a.uniformMatrix3fv(this._uUVDecodeMatrix,!1,h.uvDecodeMatrix),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(h.normalsBuf),this._aUV&&this._aUV.bindArrayBuffer(h.uvBuf),this._aColor&&this._aColor.bindArrayBuffer(h.colorsBuf),this._aMetallicRoughness&&this._aMetallicRoughness.bindArrayBuffer(h.metallicRoughnessBuf),this._aFlags&&this._aFlags.bindArrayBuffer(h.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(h.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(h.offsetsBuf),c.reflectionMaps.length>0&&c.reflectionMaps[0].texture&&this._uReflectionMap&&(this._program.bindTexture(this._uReflectionMap,c.reflectionMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++),c.lightMaps.length>0&&c.lightMaps[0].texture&&this._uLightMap&&(this._program.bindTexture(this._uLightMap,c.lightMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++),this._withSAO){const t=r.sao;if(t.possible){const s=a.drawingBufferWidth,r=a.drawingBufferHeight;Rh[0]=s,Rh[1]=r,Rh[2]=t.blendCutoff,Rh[3]=t.blendFactor,a.uniform4fv(this._uSAOParams,Rh),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++}}this._program.bindTexture(this._uBaseColorMap,u.colorTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,this._program.bindTexture(this._uMetallicRoughMap,u.metallicRoughnessTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,this._program.bindTexture(this._uEmissiveMap,u.emissiveTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,this._program.bindTexture(this._uNormalMap,u.normalsTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,this._program.bindTexture(this._uAOMap,u.occlusionTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,h.indicesBuf.bind(),a.drawElements(a.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._lightsState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=i.getLocation("uvDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uGammaFactor=i.getLocation("gammaFactor"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=i.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=i.getLocation("lightDir"+e),this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e)}s.reflectionMaps.length>0&&(this._uReflectionMap="reflectionMap"),s.lightMaps.length>0&&(this._uLightMap="lightMap"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aNormal=i.getAttribute("normal"),this._aUV=i.getAttribute("uv"),this._aColor=i.getAttribute("color"),this._aMetallicRoughness=i.getAttribute("metallicRoughness"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._uBaseColorMap="uBaseColorMap",this._uMetallicRoughMap="uMetallicRoughMap",this._uEmissiveMap="uEmissiveMap",this._uNormalMap="uNormalMap",this._uAOMap="uAOMap",this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,s=t.canvas.gl,i=this._program,r=t._lightsState.lights,o=t.camera.project;i.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(let e=0,t=r.length;e<t;e++){const t=r[e];this._uLightColor[e]&&s.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(s.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&s.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&s.uniform3fv(this._uLightDir[e],t.dir)}if(t.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}this._uGammaFactor&&s.uniform1f(this._uGammaFactor,t.gammaFactor)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState,s=e._lightsState,i=t.sectionPlanes.length>0,r=t.clippingCaps,o=[];return o.push("#version 300 es"),o.push("// Triangles batching quality draw vertex shader"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("precision highp usampler2D;"),o.push("precision highp isampler2D;"),o.push("precision highp sampler2D;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("precision mediump usampler2D;"),o.push("precision mediump isampler2D;"),o.push("precision mediump sampler2D;"),o.push("#endif"),o.push("uniform int renderPass;"),o.push("in vec3 position;"),o.push("in vec3 normal;"),o.push("in vec4 color;"),o.push("in vec2 uv;"),o.push("in vec2 metallicRoughness;"),o.push("in vec4 flags;"),o.push("in vec4 flags2;"),e.entityOffsetsEnabled&&o.push("in vec3 offset;"),o.push("uniform mat4 worldMatrix;"),o.push("uniform mat4 worldNormalMatrix;"),o.push("uniform mat4 viewMatrix;"),o.push("uniform mat4 projMatrix;"),o.push("uniform mat4 viewNormalMatrix;"),o.push("uniform mat4 positionsDecodeMatrix;"),o.push("uniform mat3 uvDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),o.push("out float vFragDepth;"),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("out float isPerspective;")),o.push("vec3 octDecode(vec2 oct) {"),o.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),o.push("    if (v.z < 0.0) {"),o.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),o.push("    }"),o.push("    return normalize(v);"),o.push("}"),o.push("out vec4 vViewPosition;"),o.push("out vec3 vViewNormal;"),o.push("out vec4 vColor;"),o.push("out vec2 vUV;"),o.push("out vec2 vMetallicRoughness;"),s.lightMaps.length>0&&o.push("out vec3 vWorldNormal;"),i&&(o.push("out vec4 vWorldPosition;"),o.push("out vec4 vFlags2;"),r&&o.push("out vec4 vClipPosition;")),o.push("void main(void) {"),o.push("if (int(flags.x) != renderPass) {"),o.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),o.push("} else {"),o.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&o.push("worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition  = viewMatrix * worldPosition; "),o.push("vec4 worldNormal =  worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),o.push("vec3 viewNormal = normalize((viewNormalMatrix * worldNormal).xyz);"),o.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"),o.push("vFragDepth = 1.0 + clipPos.w;")),i&&(o.push("vWorldPosition = worldPosition;"),o.push("vFlags2 = flags2;"),r&&o.push("vClipPosition = clipPos;")),o.push("vViewPosition = viewPosition;"),o.push("vViewNormal = viewNormal;"),o.push("vColor = color;"),o.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"),o.push("vMetallicRoughness = metallicRoughness;"),s.lightMaps.length>0&&o.push("vWorldNormal = worldNormal.xyz;"),o.push("gl_Position = clipPos;"),o.push("}"),o.push("}"),o}_buildFragmentShader(){const e=this._scene,t=e.gammaOutput,s=e._sectionPlanesState,i=e._lightsState,r=s.sectionPlanes.length>0,o=s.clippingCaps,n=[];n.push("#version 300 es"),n.push("// Triangles batching quality draw fragment shader"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),e.logarithmicDepthBufferEnabled&&(n.push("in float isPerspective;"),n.push("uniform float logDepthBufFC;"),n.push("in float vFragDepth;")),n.push("uniform sampler2D uBaseColorMap;"),n.push("uniform sampler2D uMetallicRoughMap;"),n.push("uniform sampler2D uEmissiveMap;"),n.push("uniform sampler2D uNormalMap;"),n.push("uniform sampler2D uAOMap;"),n.push("in vec4 vViewPosition;"),n.push("in vec3 vViewNormal;"),n.push("in vec4 vColor;"),n.push("in vec2 vUV;"),n.push("in vec2 vMetallicRoughness;"),i.lightMaps.length>0&&n.push("in vec3 vWorldNormal;"),n.push("uniform mat4 viewMatrix;"),i.reflectionMaps.length>0&&n.push("uniform samplerCube reflectionMap;"),i.lightMaps.length>0&&n.push("uniform samplerCube lightMap;"),n.push("uniform vec4 lightAmbient;");for(let e=0,t=i.lights.length;e<t;e++){const t=i.lights[e];"ambient"!==t.type&&(n.push("uniform vec4 lightColor"+e+";"),"dir"===t.type&&n.push("uniform vec3 lightDir"+e+";"),"point"===t.type&&n.push("uniform vec3 lightPos"+e+";"),"spot"===t.type&&(n.push("uniform vec3 lightPos"+e+";"),n.push("uniform vec3 lightDir"+e+";")))}if(this._withSAO&&(n.push("uniform sampler2D uOcclusionTexture;"),n.push("uniform vec4      uSAOParams;"),n.push("const float       packUpscale = 256. / 255.;"),n.push("const float       unpackDownScale = 255. / 256.;"),n.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),n.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),n.push("float unpackRGBToFloat( const in vec4 v ) {"),n.push("    return dot( v, unPackFactors );"),n.push("}")),n.push("uniform float gammaFactor;"),n.push("vec4 linearToLinear( in vec4 value ) {"),n.push("  return value;"),n.push("}"),n.push("vec4 sRGBToLinear( in vec4 value ) {"),n.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),n.push("}"),n.push("vec4 gammaToLinear( in vec4 value) {"),n.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),n.push("}"),t&&(n.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),n.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),n.push("}")),r){n.push("in vec4 vWorldPosition;"),n.push("in vec4 vFlags2;"),o&&n.push("in vec4 vClipPosition;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)n.push("uniform bool sectionPlaneActive"+e+";"),n.push("uniform vec3 sectionPlanePos"+e+";"),n.push("uniform vec3 sectionPlaneDir"+e+";")}if(n.push("#define PI 3.14159265359"),n.push("#define RECIPROCAL_PI 0.31830988618"),n.push("#define RECIPROCAL_PI2 0.15915494"),n.push("#define EPSILON 1e-6"),n.push("#define saturate(a) clamp( a, 0.0, 1.0 )"),n.push("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),n.push("       vec3 texel = texture( uNormalMap, uv ).xyz;"),n.push("       if (texel.x == 0.0 && texel.y == 0.0 && texel.z == 0.0) {"),n.push("              return surf_norm;"),n.push("       }"),n.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),n.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),n.push("      vec2 st0 = dFdx( uv.st );"),n.push("      vec2 st1 = dFdy( uv.st );"),n.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),n.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),n.push("      vec3 N = normalize( surf_norm );"),n.push("      vec3 mapN = texel.xyz * 2.0 - 1.0;"),n.push("      mat3 tsn = mat3( S, T, N );"),n.push("      return normalize( tsn * mapN );"),n.push("}"),n.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),n.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),n.push("}"),n.push("struct IncidentLight {"),n.push("   vec3 color;"),n.push("   vec3 direction;"),n.push("};"),n.push("struct ReflectedLight {"),n.push("   vec3 diffuse;"),n.push("   vec3 specular;"),n.push("};"),n.push("struct Geometry {"),n.push("   vec3 position;"),n.push("   vec3 viewNormal;"),n.push("   vec3 worldNormal;"),n.push("   vec3 viewEyeDir;"),n.push("};"),n.push("struct Material {"),n.push("   vec3  diffuseColor;"),n.push("   float specularRoughness;"),n.push("   vec3  specularColor;"),n.push("   float shine;"),n.push("};"),n.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),n.push("   float r = ggxRoughness + 0.0001;"),n.push("   return (2.0 / (r * r) - 2.0);"),n.push("}"),n.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {"),n.push("   float maxMIPLevelScalar = float( maxMIPLevel );"),n.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );"),n.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );"),n.push("}"),i.reflectionMaps.length>0&&(n.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),n.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),n.push("   vec3 envMapColor = sRGBToLinear(texture(reflectionMap, reflectVec, mipLevel)).rgb;"),n.push("  return envMapColor;"),n.push("}")),n.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),n.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),n.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),n.push("}"),n.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),n.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),n.push("   return 1.0 / ( gl * gv );"),n.push("}"),n.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),n.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),n.push("   return 0.5 / max( gv + gl, EPSILON );"),n.push("}"),n.push("float D_GGX(const in float alpha, const in float dotNH) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),n.push("   return RECIPROCAL_PI * a2 / ( denom * denom);"),n.push("}"),n.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),n.push("   float alpha = ( roughness * roughness );"),n.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),n.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),n.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),n.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),n.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),n.push("   vec3  F = F_Schlick( specularColor, dotLH );"),n.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),n.push("   float D = D_GGX( alpha, dotNH );"),n.push("   return F * (G * D);"),n.push("}"),n.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),n.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),n.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),n.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),n.push("   vec4 r = roughness * c0 + c1;"),n.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),n.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),n.push("   return specularColor * AB.x + AB.y;"),n.push("}"),(i.lightMaps.length>0||i.reflectionMaps.length>0)&&(n.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),i.lightMaps.length>0&&(n.push("   vec3 irradiance = sRGBToLinear(texture(lightMap, geometry.worldNormal)).rgb;"),n.push("   irradiance *= PI;"),n.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),n.push("   reflectedLight.diffuse +=  irradiance * diffuseBRDFContrib;")),i.reflectionMaps.length>0&&(n.push("   vec3 reflectVec             = reflect(geometry.viewEyeDir, geometry.viewNormal);"),n.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),n.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),n.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),n.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),n.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),n.push("}")),n.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),n.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),n.push("   vec3 irradiance = dotNL * incidentLight.color * PI;"),n.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),n.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),n.push("}"),n.push("out vec4 outColor;"),n.push("void main(void) {"),r){n.push("  bool clippable = (float(vFlags2.x) > 0.0);"),n.push("  if (clippable) {"),n.push("  float dist = 0.0;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)n.push("if (sectionPlaneActive"+e+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),n.push("}");o?(n.push("  if (dist > (0.002 * vClipPosition.w)) {"),n.push("      discard;"),n.push("  }"),n.push("  if (dist > 0.0) { "),n.push("      outColor=vec4(1.0, 0.0, 0.0, 1.0);"),e.logarithmicDepthBufferEnabled&&n.push("  gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("  return;"),n.push("}")):(n.push("  if (dist > 0.0) { "),n.push("      discard;"),n.push("  }")),n.push("}")}n.push("IncidentLight  light;"),n.push("Material       material;"),n.push("Geometry       geometry;"),n.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),n.push("vec3 rgb = (vec3(float(vColor.r) / 255.0, float(vColor.g) / 255.0, float(vColor.b) / 255.0));"),n.push("float opacity = float(vColor.a) / 255.0;"),n.push("vec3  baseColor = rgb;"),n.push("float specularF0 = 1.0;"),n.push("float metallic = float(vMetallicRoughness.r) / 255.0;"),n.push("float roughness = float(vMetallicRoughness.g) / 255.0;"),n.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),n.push("vec4 baseColorTexel = sRGBToLinear(texture(uBaseColorMap, vUV));"),n.push("baseColor *= baseColorTexel.rgb;"),n.push("vec3 metalRoughTexel = texture(uMetallicRoughMap, vUV).rgb;"),n.push("metallic *= metalRoughTexel.b;"),n.push("roughness *= metalRoughTexel.g;"),n.push("vec3 viewNormal = perturbNormal2Arb(vViewPosition.xyz, normalize(vViewNormal), vUV );"),n.push("material.diffuseColor      = baseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),n.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),n.push("material.specularColor     = mix(vec3(dielectricSpecular), baseColor, metallic);"),n.push("geometry.position      = vViewPosition.xyz;"),n.push("geometry.viewNormal    = -normalize(viewNormal);"),n.push("geometry.viewEyeDir    = normalize(vViewPosition.xyz);"),i.lightMaps.length>0&&n.push("geometry.worldNormal   = normalize(vWorldNormal);"),(i.lightMaps.length>0||i.reflectionMaps.length>0)&&n.push("computePBRLightMapping(geometry, material, reflectedLight);");for(let e=0,t=i.lights.length;e<t;e++){const t=i.lights[e];if("ambient"!==t.type){if("dir"===t.type)"view"===t.space?n.push("light.direction =  normalize(lightDir"+e+");"):n.push("light.direction =  normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===t.type)"view"===t.space?n.push("light.direction =  normalize(lightPos"+e+" - vViewPosition.xyz);"):n.push("light.direction =  normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==t.type)continue;"view"===t.space?n.push("light.direction =  normalize(lightDir"+e+");"):n.push("light.direction =  normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}n.push("light.color =  lightColor"+e+".rgb * lightColor"+e+".a;"),n.push("computePBRLighting(light, geometry, material, reflectedLight);")}}return n.push("vec3 emissiveColor = sRGBToLinear(texture(uEmissiveMap, vUV)).rgb;"),n.push("float aoFactor = texture(uAOMap, vUV).r;"),n.push("vec3 outgoingLight = (lightAmbient.rgb * lightAmbient.a * baseColor * opacity * rgb) + (reflectedLight.diffuse) + (reflectedLight.specular) + emissiveColor;"),n.push("vec4 fragColor;"),this._withSAO?(n.push("   float viewportWidth     = uSAOParams[0];"),n.push("   float viewportHeight    = uSAOParams[1];"),n.push("   float blendCutoff       = uSAOParams[2];"),n.push("   float blendFactor       = uSAOParams[3];"),n.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),n.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),n.push("   fragColor               = vec4(outgoingLight.rgb * ambient * aoFactor, opacity);")):n.push("   fragColor            = vec4(outgoingLight.rgb * aoFactor, opacity);"),t&&n.push("fragColor = linearToGamma(fragColor, gammaFactor);"),n.push("outColor = fragColor;"),e.logarithmicDepthBufferEnabled&&n.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("}"),n}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Bh=p.vec3();class Lh{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniform1i(this._uPickInvisible,e.pickInvisible),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const l=e.pickViewMatrix||o.viewMatrix,u=h?U(l,h):l;if(n.uniformMatrix4fv(this._uViewMatrix,!1,u),n.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,e)}const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*c,o=i.renderFlags;for(let t=0;t<c;t++){const i=this._uSectionPlanes[t],r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,Bh);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles batching pick flat normals vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),s.push("out vec4 vWorldPosition;"),t&&s.push("out vec4 vFlags2;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("      vWorldPosition = worldPosition;"),t&&s.push("      vFlags2 = flags2;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Triangles batching pick flat normals fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),i.push("in vec4 vWorldPosition;"),s){i.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("uniform bool sectionPlaneActive"+r+";"),i.push("uniform vec3 sectionPlanePos"+r+";"),i.push("uniform vec3 sectionPlaneDir"+r+";")}if(i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("  vec3 xTangent = dFdx( vWorldPosition.xyz );"),i.push("  vec3 yTangent = dFdy( vWorldPosition.xyz );"),i.push("  vec3 worldNormal = normalize( cross( xTangent, yTangent ) );"),i.push("  outColor = vec4((worldNormal * 0.5) + 0.5, 1.0);"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Nh=p.vec4(),kh=p.vec3();class jh{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e.gammaOutput,e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,s){const i=ce.MAX_TEXTURE_IMAGE_UNITS,r=this._scene,o=r.camera,n=t.model,a=r.canvas.gl,h=t._state,l=t._state.origin,u=h.textureSet;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,s),a.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,n.worldMatrix);const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*c,i=n.renderFlags;for(let t=0;t<c;t++){const r=this._uSectionPlanes[t];if(r){const o=i.sectionPlanesActivePerLayer[s+t];if(a.uniform1i(r.active,o?1:0),o){const s=e[t];if(l){const e=X(s.dist,s.dir,l,kh);a.uniform3fv(r.pos,e)}else a.uniform3fv(r.pos,s.pos);a.uniform3fv(r.dir,s.dir)}}}}if(a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._uUVDecodeMatrix&&a.uniformMatrix3fv(this._uUVDecodeMatrix,!1,h.uvDecodeMatrix),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aUV&&this._aUV.bindArrayBuffer(h.uvBuf),this._aColor&&this._aColor.bindArrayBuffer(h.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(h.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(h.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(h.offsetsBuf),u&&u.colorTexture&&(this._program.bindTexture(this._uColorMap,u.colorTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i),this._withSAO){const t=r.sao;if(t.possible){const s=a.drawingBufferWidth,r=a.drawingBufferHeight;Nh[0]=s,Nh[1]=r,Nh[2]=t.blendCutoff,Nh[3]=t.blendFactor,a.uniform4fv(this._uSAOParams,Nh),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++}}h.indicesBuf.bind(),a.drawElements(a.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._lightsState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=i.getLocation("uvDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uGammaFactor=i.getLocation("gammaFactor"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=i.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=i.getLocation("lightDir"+e),this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e)}this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aUV=i.getAttribute("uv"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._uColorMap="uColorMap",this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,s=t.canvas.gl,i=this._program,r=t._lightsState.lights,o=t.camera.project;i.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(let e=0,t=r.length;e<t;e++){const t=r[e];this._uLightColor[e]&&s.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(s.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&s.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&s.uniform3fv(this._uLightDir[e],t.dir)}if(t.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}this._uGammaFactor&&s.uniform1f(this._uGammaFactor,t.gammaFactor)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles batching color texture vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),s.push("in vec4 color;"),s.push("in vec2 uv;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform mat3 uvDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vViewPosition;"),s.push("out vec4 vColor;"),s.push("out vec2 vUV;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("vViewPosition = viewPosition;"),s.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),s.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e.gammaOutput,s=e._lightsState,i=e._sectionPlanesState,r=i.sectionPlanes.length>0,o=[];if(o.push("#version 300 es"),o.push("// Triangles batching color texture fragment shader"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),e.logarithmicDepthBufferEnabled&&(o.push("in float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("in float vFragDepth;")),o.push("uniform sampler2D uColorMap;"),this._withSAO&&(o.push("uniform sampler2D uOcclusionTexture;"),o.push("uniform vec4      uSAOParams;"),o.push("const float       packUpscale = 256. / 255.;"),o.push("const float       unpackDownScale = 255. / 256.;"),o.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),o.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),o.push("float unpackRGBToFloat( const in vec4 v ) {"),o.push("    return dot( v, unPackFactors );"),o.push("}")),o.push("uniform float gammaFactor;"),o.push("vec4 linearToLinear( in vec4 value ) {"),o.push("  return value;"),o.push("}"),o.push("vec4 sRGBToLinear( in vec4 value ) {"),o.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),o.push("}"),o.push("vec4 gammaToLinear( in vec4 value) {"),o.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),o.push("}"),t&&(o.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),o.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),o.push("}")),r){o.push("in vec4 vWorldPosition;"),o.push("in vec4 vFlags2;");for(let e=0,t=i.sectionPlanes.length;e<t;e++)o.push("uniform bool sectionPlaneActive"+e+";"),o.push("uniform vec3 sectionPlanePos"+e+";"),o.push("uniform vec3 sectionPlaneDir"+e+";")}o.push("uniform mat4 viewMatrix;"),o.push("uniform vec4 lightAmbient;");for(let e=0,t=s.lights.length;e<t;e++){const t=s.lights[e];"ambient"!==t.type&&(o.push("uniform vec4 lightColor"+e+";"),"dir"===t.type&&o.push("uniform vec3 lightDir"+e+";"),"point"===t.type&&o.push("uniform vec3 lightPos"+e+";"),"spot"===t.type&&(o.push("uniform vec3 lightPos"+e+";"),o.push("uniform vec3 lightDir"+e+";")))}if(o.push("in vec4 vViewPosition;"),o.push("in vec4 vColor;"),o.push("in vec2 vUV;"),o.push("out vec4 outColor;"),o.push("void main(void) {"),r){o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;");for(let e=0,t=i.sectionPlanes.length;e<t;e++)o.push("if (sectionPlaneActive"+e+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { "),o.push("      discard;"),o.push("  }"),o.push("}")}o.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),o.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),o.push("float lambertian = 1.0;"),o.push("vec3 xTangent = dFdx( vViewPosition.xyz );"),o.push("vec3 yTangent = dFdy( vViewPosition.xyz );"),o.push("vec3 viewNormal = normalize( cross( xTangent, yTangent ) );");for(let e=0,t=s.lights.length;e<t;e++){const t=s.lights[e];if("ambient"!==t.type){if("dir"===t.type)"view"===t.space?o.push("viewLightDir = normalize(lightDir"+e+");"):o.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===t.type)"view"===t.space?o.push("viewLightDir = -normalize(lightPos"+e+" - viewPosition.xyz);"):o.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==t.type)continue;"view"===t.space?o.push("viewLightDir = normalize(lightDir"+e+");"):o.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}o.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),o.push("reflectedColor += lambertian * (lightColor"+e+".rgb * lightColor"+e+".a);")}}return o.push("vec4 color =  vec4((lightAmbient.rgb * lightAmbient.a * vColor.rgb) + (reflectedColor * vColor.rgb), vColor.a);"),t?o.push("vec4 colorTexel = color * sRGBToLinear(texture(uColorMap, vUV));"):o.push("vec4 colorTexel = color * texture(uColorMap, vUV);"),o.push("float opacity = color.a;"),this._withSAO?(o.push("   float viewportWidth     = uSAOParams[0];"),o.push("   float viewportHeight    = uSAOParams[1];"),o.push("   float blendCutoff       = uSAOParams[2];"),o.push("   float blendFactor       = uSAOParams[3];"),o.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),o.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),o.push("   outColor                = vec4(colorTexel.rgb * ambient, opacity);")):o.push("   outColor                = vec4(colorTexel.rgb, opacity);"),t&&o.push("outColor = linearToGamma(outColor, gammaFactor);"),e.logarithmicDepthBufferEnabled&&o.push("gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class Gh{constructor(e){this._scene=e}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._colorRendererWithSAO&&!this._colorRendererWithSAO.getValid()&&(this._colorRendererWithSAO.destroy(),this._colorRendererWithSAO=null),this._flatColorRenderer&&!this._flatColorRenderer.getValid()&&(this._flatColorRenderer.destroy(),this._flatColorRenderer=null),this._flatColorRendererWithSAO&&!this._flatColorRendererWithSAO.getValid()&&(this._flatColorRendererWithSAO.destroy(),this._flatColorRendererWithSAO=null),this._colorTextureRenderer&&!this._colorTextureRenderer.getValid()&&(this._colorTextureRenderer.destroy(),this._colorTextureRenderer=null),this._colorTextureRendererWithSAO&&!this._colorTextureRendererWithSAO.getValid()&&(this._colorTextureRendererWithSAO.destroy(),this._colorTextureRendererWithSAO=null),this._pbrRenderer&&!this._pbrRenderer.getValid()&&(this._pbrRenderer.destroy(),this._pbrRenderer=null),this._pbrRendererWithSAO&&!this._pbrRendererWithSAO.getValid()&&(this._pbrRendererWithSAO.destroy(),this._pbrRendererWithSAO=null),this._depthRenderer&&!this._depthRenderer.getValid()&&(this._depthRenderer.destroy(),this._depthRenderer=null),this._normalsRenderer&&!this._normalsRenderer.getValid()&&(this._normalsRenderer.destroy(),this._normalsRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._edgesRenderer&&!this._edgesRenderer.getValid()&&(this._edgesRenderer.destroy(),this._edgesRenderer=null),this._edgesColorRenderer&&!this._edgesColorRenderer.getValid()&&(this._edgesColorRenderer.destroy(),this._edgesColorRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._pickNormalsRenderer&&!1===this._pickNormalsRenderer.getValid()&&(this._pickNormalsRenderer.destroy(),this._pickNormalsRenderer=null),this._pickNormalsFlatRenderer&&!1===this._pickNormalsFlatRenderer.getValid()&&(this._pickNormalsFlatRenderer.destroy(),this._pickNormalsFlatRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null),this._shadowRenderer&&!this._shadowRenderer.getValid()&&(this._shadowRenderer.destroy(),this._shadowRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new nh(this._scene,!1)),this._colorRenderer}get colorRendererWithSAO(){return this._colorRendererWithSAO||(this._colorRendererWithSAO=new nh(this._scene,!0)),this._colorRendererWithSAO}get flatColorRenderer(){return this._flatColorRenderer||(this._flatColorRenderer=new lh(this._scene,!1)),this._flatColorRenderer}get flatColorRendererWithSAO(){return this._flatColorRendererWithSAO||(this._flatColorRendererWithSAO=new lh(this._scene,!0)),this._flatColorRendererWithSAO}get colorTextureRenderer(){return this._colorTextureRenderer||(this._colorTextureRenderer=new jh(this._scene,!1)),this._colorTextureRenderer}get colorTextureRendererWithSAO(){return this._colorTextureRendererWithSAO||(this._colorTextureRendererWithSAO=new jh(this._scene,!0)),this._colorTextureRendererWithSAO}get pbrRenderer(){return this._pbrRenderer||(this._pbrRenderer=new Oh(this._scene,!1)),this._pbrRenderer}get pbrRendererWithSAO(){return this._pbrRendererWithSAO||(this._pbrRendererWithSAO=new Oh(this._scene,!0)),this._pbrRendererWithSAO}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new ph(this._scene)),this._silhouetteRenderer}get depthRenderer(){return this._depthRenderer||(this._depthRenderer=new Ch(this._scene)),this._depthRenderer}get normalsRenderer(){return this._normalsRenderer||(this._normalsRenderer=new Ah(this._scene)),this._normalsRenderer}get edgesRenderer(){return this._edgesRenderer||(this._edgesRenderer=new fh(this._scene)),this._edgesRenderer}get edgesColorRenderer(){return this._edgesColorRenderer||(this._edgesColorRenderer=new _h(this._scene)),this._edgesColorRenderer}get pickMeshRenderer(){return this._pickMeshRenderer||(this._pickMeshRenderer=new vh(this._scene)),this._pickMeshRenderer}get pickNormalsRenderer(){return this._pickNormalsRenderer||(this._pickNormalsRenderer=new Th(this._scene)),this._pickNormalsRenderer}get pickNormalsFlatRenderer(){return this._pickNormalsFlatRenderer||(this._pickNormalsFlatRenderer=new Lh(this._scene)),this._pickNormalsFlatRenderer}get pickDepthRenderer(){return this._pickDepthRenderer||(this._pickDepthRenderer=new xh(this._scene)),this._pickDepthRenderer}get occlusionRenderer(){return this._occlusionRenderer||(this._occlusionRenderer=new Mh(this._scene)),this._occlusionRenderer}get shadowRenderer(){return this._shadowRenderer||(this._shadowRenderer=new Fh(this._scene)),this._shadowRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._colorRendererWithSAO&&this._colorRendererWithSAO.destroy(),this._flatColorRenderer&&this._flatColorRenderer.destroy(),this._flatColorRendererWithSAO&&this._flatColorRendererWithSAO.destroy(),this._colorTextureRenderer&&this._colorTextureRenderer.destroy(),this._colorTextureRendererWithSAO&&this._colorTextureRendererWithSAO.destroy(),this._pbrRenderer&&this._pbrRenderer.destroy(),this._pbrRendererWithSAO&&this._pbrRendererWithSAO.destroy(),this._depthRenderer&&this._depthRenderer.destroy(),this._normalsRenderer&&this._normalsRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._edgesRenderer&&this._edgesRenderer.destroy(),this._edgesColorRenderer&&this._edgesColorRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._pickNormalsRenderer&&this._pickNormalsRenderer.destroy(),this._pickNormalsFlatRenderer&&this._pickNormalsFlatRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy(),this._shadowRenderer&&this._shadowRenderer.destroy()}}const Hh={};class Vh{constructor(e=5e6){e>5e6&&(e=5e6),this.maxVerts=e,this.maxIndices=3*e,this.positions=[],this.colors=[],this.uv=[],this.metallicRoughness=[],this.normals=[],this.pickColors=[],this.flags=[],this.flags2=[],this.offsets=[],this.indices=[],this.edgeIndices=[]}}const Uh=p.mat4(),zh=p.mat4();function Wh(e,t,s){const i=e.length,r=new Uint16Array(i),o=t[0],n=t[1],a=t[2],h=t[3]-o,l=t[4]-n,u=t[5]-a,c=65525,d=c/h,m=c/l,f=c/u,g=e=>e>=0?e:0;for(let t=0;t<i;t+=3)r[t+0]=Math.floor(g(e[t+0]-o)*d),r[t+1]=Math.floor(g(e[t+1]-n)*m),r[t+2]=Math.floor(g(e[t+2]-a)*f);return p.identityMat4(Uh),p.translationMat4v(t,Uh),p.identityMat4(zh),p.scalingMat4v([h/c,l/c,u/c],zh),p.mulMat4(Uh,zh,s),r}function Xh(e,t,s){let i=e[0]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2])),r=e[1]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2]));if(e[2]<0){let e=i,t=r;e=(1-Math.abs(r))*(i>=0?1:-1),t=(1-Math.abs(i))*(r>=0?1:-1),i=e,r=t}return new Int8Array([Math[t](127.5*i+(i<0?-1:0)),Math[s](127.5*r+(r<0?-1:0))])}function Yh(e,t,s,i){let r=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),o=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){let e=(1-Math.abs(o))*(r>=0?1:-1),t=(1-Math.abs(r))*(o>=0?1:-1);r=e,o=t}return new Int8Array([Math[s](127.5*r+(r<0?-1:0)),Math[i](127.5*o+(o<0?-1:0))])}function Kh(e){let t=e[0],s=e[1];t/=t<0?127:128,s/=s<0?127:128;const i=1-Math.abs(t)-Math.abs(s);i<0&&(t=(1-Math.abs(s))*(t>=0?1:-1),s=(1-Math.abs(t))*(s>=0?1:-1));const r=Math.sqrt(t*t+s*s+i*i);return[t/r,s/r,i/r]}function Jh(e,t,s){return e[t]*s[0]+e[t+1]*s[1]+e[t+2]*s[2]}const Zh=p.mat4(),Qh=p.mat4(),qh=p.vec4([0,0,0,1]),$h=p.vec4([0,0,0,1]),el=p.vec4([0,0,0,1]),tl=p.OBB3(),sl=p.vec3(),il=p.vec3(),rl=p.vec3(),ol=p.vec3(),nl=p.vec3(),al=p.vec3(),hl=p.vec3();class ll{constructor(e){this.model=e.model,this.sortId="TrianglesBatchingLayer"+(e.solid?"-solid":"-surface")+(e.autoNormals?"-autonormals":"-normals")+(e.textureSet&&e.textureSet.colorTexture?"-colorTexture":"")+(e.textureSet&&e.textureSet.metallicRoughnessTexture?"-metallicRoughnessTexture":""),this.layerIndex=e.layerIndex,this._batchingRenderers=function(e){const t=e.id;let s=Hh[t];return s||(s=new Gh(e),Hh[t]=s,s._compile(),e.on("compile",(()=>{s._compile()})),e.on("destroyed",(()=>{delete Hh[t],s._destroy()}))),s}(e.model.scene),this._buffer=new Vh(e.maxGeometryBatchSize),this._scratchMemory=e.scratchMemory,this._state=new ft({origin:p.vec3(),positionsBuf:null,offsetsBuf:null,normalsBuf:null,colorsBuf:null,uvBuf:null,metallicRoughnessBuf:null,flagsBuf:null,flags2Buf:null,indicesBuf:null,edgeIndicesBuf:null,positionsDecodeMatrix:p.mat4(),uvDecodeMatrix:null,textureSet:e.textureSet,pbrSupported:!1}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numSelectedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._modelAABB=p.collapseAABB3(),this._portions=[],this._numVerts=0,this._finalized=!1,e.positionsDecodeMatrix?(this._state.positionsDecodeMatrix.set(e.positionsDecodeMatrix),this._preCompressedPositionsExpected=!0):this._preCompressedPositionsExpected=!1,e.uvDecodeMatrix?(this._state.uvDecodeMatrix=p.mat3(e.uvDecodeMatrix),this._preCompressedNormalsExpected=!0):this._preCompressedNormalsExpected=!1,e.origin&&this._state.origin.set(e.origin),this.aabb=p.collapseAABB3(),this.solid=!!e.solid}canCreatePortion(e,t){if(this._finalized)throw"Already finalized";return this._buffer.positions.length+e<3*this._buffer.maxVerts&&this._buffer.indices.length+t<this._buffer.maxIndices}createPortion(e){if(this._finalized)throw"Already finalized";const t=e.positions,s=e.positionsCompressed,i=e.normals,r=e.normalsCompressed,o=e.uv,n=e.uvCompressed,a=e.colors,h=e.colorsCompressed,l=e.indices,u=e.edgeIndices,c=e.color,d=e.metallic,m=e.roughness,f=e.opacity,g=e.meshMatrix,_=e.worldMatrix,y=e.worldAABB,v=e.pickColor,b=this.model.scene,x=this._buffer,P=x.positions.length/3;let T;if(this._preCompressedPositionsExpected){if(!s)throw"positionsCompressed expected";T=s.length/3;for(let e=0,t=s.length;e<t;e++)x.positions.push(s[e]);const e=Pt.getPositionsBounds(s),t=Pt.decompressPosition(e.min,this._state.positionsDecodeMatrix,[]),i=Pt.decompressPosition(e.max,this._state.positionsDecodeMatrix,[]);y[0]=t[0],y[1]=t[1],y[2]=t[2],y[3]=i[0],y[4]=i[1],y[5]=i[2],_&&(p.AABB3ToOBB3(y,tl),p.transformOBB3(_,tl),p.OBB3ToAABB3(tl,y))}else{if(!t)throw"positions expected";T=t.length/3;const e=t.length,s=x.positions.length;for(let e=0,s=t.length;e<s;e++)x.positions.push(t[e]);if(g)for(let t=s,i=s+e;t<i;t+=3)qh[0]=x.positions[t+0],qh[1]=x.positions[t+1],qh[2]=x.positions[t+2],p.transformPoint4(g,qh,$h),x.positions[t+0]=$h[0],x.positions[t+1]=$h[1],x.positions[t+2]=$h[2],p.expandAABB3Point3(this._modelAABB,$h),_?(p.transformPoint4(_,$h,el),p.expandAABB3Point3(y,el)):p.expandAABB3Point3(y,$h);else for(let t=s,i=s+e;t<i;t+=3)qh[0]=x.positions[t+0],qh[1]=x.positions[t+1],qh[2]=x.positions[t+2],p.expandAABB3Point3(this._modelAABB,qh),_?(p.transformPoint4(_,qh,$h),p.expandAABB3Point3(y,$h)):p.expandAABB3Point3(y,qh)}if(this._state.origin){const e=this._state.origin;y[0]+=e[0],y[1]+=e[1],y[2]+=e[2],y[3]+=e[0],y[4]+=e[1],y[5]+=e[2]}if(p.expandAABB3(this.aabb,y),r&&r.length>0)for(let e=0,t=r.length;e<t;e++)x.normals.push(r[e]);else if(i&&i.length>0){const e=Zh;g?p.inverseMat4(p.transposeMat4(g,Qh),e):p.identityMat4(e,e),function(e,t,s,i,r){function o(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}let n,a,h,l,u,c,d=new Float32Array([0,0,0,0]),m=new Float32Array([0,0,0,0]);for(c=0;c<s;c+=3)d[0]=t[c],d[1]=t[c+1],d[2]=t[c+2],p.transformVec3(e,d,m),p.normalizeVec3(m,m),h=n=Xh(m,"floor","floor"),a=Kh(n),l=u=o(m,a),n=Xh(m,"ceil","floor"),a=Kh(n),l=o(m,a),l>u&&(h=n,u=l),n=Xh(m,"floor","ceil"),a=Kh(n),l=o(m,a),l>u&&(h=n,u=l),n=Xh(m,"ceil","ceil"),a=Kh(n),l=o(m,a),l>u&&(h=n,u=l),i[r+c+0]=h[0],i[r+c+1]=h[1],i[r+c+2]=0}(e,i,i.length,x.normals,x.normals.length)}if(a)for(let e=0,t=a.length;e<t;e+=3)x.colors.push(255*a[e]),x.colors.push(255*a[e+1]),x.colors.push(255*a[e+2]),x.colors.push(255);else if(h)for(let e=0,t=a.length;e<t;e+=3)x.colors.push(a[e]),x.colors.push(a[e+1]),x.colors.push(a[e+2]),x.colors.push(255);else if(c){const e=c[0],t=c[1],s=c[2],i=f;for(let r=0;r<T;r++)x.colors.push(e),x.colors.push(t),x.colors.push(s),x.colors.push(i)}const w=null!=d?d:0,M=null!=m?m:255;for(let e=0;e<T;e++)x.metallicRoughness.push(w),x.metallicRoughness.push(M);if(o&&o.length>0)for(let e=0,t=o.length;e<t;e++)x.uv.push(o[e]);else if(n&&n.length>0)for(let e=0,t=n.length;e<t;e++)x.uv.push(n[e]);if(l)for(let e=0,t=l.length;e<t;e++)x.indices.push(P+l[e]);if(u)for(let e=0,t=u.length;e<t;e++)x.edgeIndices.push(P+u[e]);{const e=x.pickColors.length;for(let t=e,s=e+4*T;t<s;t+=4)x.pickColors.push(v[0]),x.pickColors.push(v[1]),x.pickColors.push(v[2]),x.pickColors.push(v[3])}if(b.entityOffsetsEnabled)for(let e=0;e<T;e++)x.offsets.push(0),x.offsets.push(0),x.offsets.push(0);const I=this._portions.length,C={vertsBaseIndex:P,numVerts:T};return b.pickSurfacePrecisionEnabled&&(l&&(C.indices=l),b.entityOffsetsEnabled&&(C.offset=new Float32Array(3))),this._portions.push(C),this._numPortions++,this.model.numPortions++,this._numVerts+=C.numVerts,I}finalize(){if(this._finalized)return void this.model.error("Already finalized");const e=this._state,t=this.model.scene.canvas.gl,s=this._buffer;if(s.positions.length>0){const i=this._preCompressedPositionsExpected?new Uint16Array(s.positions):Wh(s.positions,this._modelAABB,e.positionsDecodeMatrix);if(e.positionsBuf=new we(t,t.ARRAY_BUFFER,i,i.length,3,t.STATIC_DRAW),this.model.scene.pickSurfacePrecisionEnabled)for(let e=0,t=this._portions.length;e<t;e++){const t=this._portions[e],s=3*t.vertsBaseIndex,r=s+3*t.numVerts;t.quantizedPositions=i.slice(s,r)}}if(s.normals.length>0){const i=new Int8Array(s.normals);let r=!0;e.normalsBuf=new we(t,t.ARRAY_BUFFER,i,s.normals.length,3,t.STATIC_DRAW,r)}if(s.colors.length>0){const i=new Uint8Array(s.colors);let r=!1;e.colorsBuf=new we(t,t.ARRAY_BUFFER,i,s.colors.length,4,t.DYNAMIC_DRAW,r)}if(s.uv.length>0)if(e.uvDecodeMatrix){let i=!1;e.uvBuf=new we(t,t.ARRAY_BUFFER,s.uv,s.uv.length,2,t.STATIC_DRAW,i)}else{const i=Pt.getUVBounds(s.uv),r=Pt.compressUVs(s.uv,i.min,i.max),o=r.quantized;let n=!1;e.uvDecodeMatrix=p.mat3(r.decodeMatrix),e.uvBuf=new we(t,t.ARRAY_BUFFER,o,o.length,2,t.STATIC_DRAW,n)}if(s.metallicRoughness.length>0){const i=new Uint8Array(s.metallicRoughness);let r=!1;e.metallicRoughnessBuf=new we(t,t.ARRAY_BUFFER,i,s.metallicRoughness.length,2,t.STATIC_DRAW,r)}if(s.positions.length>0){const i=s.positions.length/3*4,r=new Uint8Array(i),o=new Uint8Array(i);let n=!1,a=!0;e.flagsBuf=new we(t,t.ARRAY_BUFFER,r,r.length,4,t.DYNAMIC_DRAW,n),e.flags2Buf=new we(t,t.ARRAY_BUFFER,o,o.length,4,t.DYNAMIC_DRAW,a)}if(s.pickColors.length>0){const i=new Uint8Array(s.pickColors);let r=!1;e.pickColorsBuf=new we(t,t.ARRAY_BUFFER,i,s.pickColors.length,4,t.STATIC_DRAW,r)}if(this.model.scene.entityOffsetsEnabled&&s.offsets.length>0){const i=new Float32Array(s.offsets);e.offsetsBuf=new we(t,t.ARRAY_BUFFER,i,s.offsets.length,3,t.DYNAMIC_DRAW)}if(s.indices.length>0){const i=new Uint32Array(s.indices);e.indicesBuf=new we(t,t.ELEMENT_ARRAY_BUFFER,i,s.indices.length,1,t.STATIC_DRAW)}if(s.edgeIndices.length>0){const i=new Uint32Array(s.edgeIndices);e.edgeIndicesBuf=new we(t,t.ELEMENT_ARRAY_BUFFER,i,s.edgeIndices.length,1,t.STATIC_DRAW)}this._state.pbrSupported=!!(e.metallicRoughnessBuf&&e.uvBuf&&e.normalsBuf&&e.textureSet&&e.textureSet.colorTexture&&e.textureSet.metallicRoughnessTexture),this._state.colorTextureSupported=!!e.uvBuf&&!!e.textureSet&&!!e.textureSet.colorTexture,this._buffer=null,this._finalized=!0}isEmpty(){return!this._state.indicesBuf}initFlags(e,t,s){t&E&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&L&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&B&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&N&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&S&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&k&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&R&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&F&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),s&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++);this._setFlags(e,t,s,true),this._setFlags2(e,t,true)}flushInitFlags(){this._setDeferredFlags(),this._setDeferredFlags2()}setVisible(e,t,s){if(!this._finalized)throw"Not finalized";t&E?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,s)}setHighlighted(e,t,s){if(!this._finalized)throw"Not finalized";t&L?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,s)}setXRayed(e,t,s){if(!this._finalized)throw"Not finalized";t&B?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,s)}setSelected(e,t,s){if(!this._finalized)throw"Not finalized";t&N?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,s)}setEdges(e,t,s){if(!this._finalized)throw"Not finalized";t&k?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,s)}setClippable(e,t){if(!this._finalized)throw"Not finalized";t&S?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}setCulled(e,t,s){if(!this._finalized)throw"Not finalized";t&F?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,s)}setCollidable(e,t){if(!this._finalized)throw"Not finalized"}setPickable(e,t,s){if(!this._finalized)throw"Not finalized";t&R?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(e,t,s)}setColor(e,t){if(!this._finalized)throw"Not finalized";const s=e,i=this._portions[s],r=4*i.vertsBaseIndex,o=4*i.numVerts,n=this._scratchMemory.getUInt8Array(o),a=t[0],h=t[1],l=t[2],u=t[3];for(let e=0;e<o;e+=4)n[e+0]=a,n[e+1]=h,n[e+2]=l,n[e+3]=u;this._state.colorsBuf&&this._state.colorsBuf.setData(n,r,o)}setTransparent(e,t,s){s?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,s)}_setFlags(e,t,s,i=!1){if(!this._finalized)throw"Not finalized";const r=e,o=this._portions[r],n=4*o.vertsBaseIndex,a=4*o.numVerts,h=!!(t&E),l=!!(t&B),u=!!(t&L),c=!!(t&N),p=!!(t&k),d=!!(t&R),m=!!(t&F);let f,g;f=!h||m||l||u&&!this.model.scene.highlightMaterial.glowThrough||c&&!this.model.scene.selectedMaterial.glowThrough?Xa:s?Ka:Ya,g=!h||m?Xa:c?Za:u?Ja:l?Qa:Xa;let _=0;_=!h||m?Xa:c?th:u?eh:l?sh:p?s?$a:qa:Xa;let y=h&&!m&&d?ih:Xa;if(i){this._deferredFlagValues||(this._deferredFlagValues=new Uint8Array(4*this._numVerts));for(let e=n,t=n+a;e<t;e+=4)this._deferredFlagValues[e+0]=f,this._deferredFlagValues[e+1]=g,this._deferredFlagValues[e+2]=_,this._deferredFlagValues[e+3]=y}else if(this._state.flagsBuf){const e=this._scratchMemory.getUInt8Array(a);for(let t=0;t<a;t+=4)e[t+0]=f,e[t+1]=g,e[t+2]=_,e[t+3]=y;this._state.flagsBuf.setData(e,n,a)}}_setDeferredFlags(){this._deferredFlagValues&&(this._state.flagsBuf.setData(this._deferredFlagValues),this._deferredFlagValues=null)}_setFlags2(e,t,s=!1){if(!this._finalized)throw"Not finalized";const i=e,r=this._portions[i],o=4*r.vertsBaseIndex,n=4*r.numVerts,a=t&S?255:0;if(s){this._setDeferredFlag2Values||(this._setDeferredFlag2Values=new Uint8Array(4*this._numVerts));for(let e=o,t=o+n;e<t;e+=4)this._setDeferredFlag2Values[e]=a}else if(this._state.flags2Buf){const e=this._scratchMemory.getUInt8Array(n);for(let t=0;t<n;t+=4)e[t+0]=a;this._state.flags2Buf.setData(e,o,n)}}_setDeferredFlags2(){this._setDeferredFlag2Values&&(this._state.flags2Buf.setData(this._setDeferredFlag2Values),this._setDeferredFlag2Values=null)}setOffset(e,t){if(!this._finalized)throw"Not finalized";if(!this.model.scene.entityOffsetsEnabled)return void this.model.error("Entity#offset not enabled for this Viewer");const s=e,i=this._portions[s],r=3*i.vertsBaseIndex,o=3*i.numVerts,n=this._scratchMemory.getFloat32Array(o),a=t[0],h=t[1],l=t[2];for(let e=0;e<o;e+=3)n[e+0]=a,n[e+1]=h,n[e+2]=l;this._state.offsetsBuf&&this._state.offsetsBuf.setData(n,r,o),this.model.scene.pickSurfacePrecisionEnabled&&(i.offset[0]=t[0],i.offset[1]=t[1],i.offset[2]=t[2])}drawColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),t.withSAO&&this.model.saoEnabled?t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._batchingRenderers.pbrRendererWithSAO&&this._batchingRenderers.pbrRendererWithSAO.drawLayer(t,this,Ya):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._batchingRenderers.colorTextureRendererWithSAO&&this._batchingRenderers.colorTextureRendererWithSAO.drawLayer(t,this,Ya):this._state.normalsBuf?this._batchingRenderers.colorRendererWithSAO&&this._batchingRenderers.colorRendererWithSAO.drawLayer(t,this,Ya):this._batchingRenderers.flatColorRendererWithSAO&&this._batchingRenderers.flatColorRendererWithSAO.drawLayer(t,this,Ya):t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._batchingRenderers.pbrRenderer&&this._batchingRenderers.pbrRenderer.drawLayer(t,this,Ya):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._batchingRenderers.colorTextureRenderer&&this._batchingRenderers.colorTextureRenderer.drawLayer(t,this,Ya):this._state.normalsBuf?this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(t,this,Ya):this._batchingRenderers.flatColorRenderer&&this._batchingRenderers.flatColorRenderer.drawLayer(t,this,Ya))}_updateBackfaceCull(e,t){const s=this.model.backfaces||!this.solid||e.sectioned;if(t.backfaces!==s){const e=t.gl;s?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),t.backfaces=s}}drawColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._batchingRenderers.pbrRenderer&&this._batchingRenderers.pbrRenderer.drawLayer(t,this,Ka):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._batchingRenderers.colorTextureRenderer&&this._batchingRenderers.colorTextureRenderer.drawLayer(t,this,Ka):this._state.normalsBuf?this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(t,this,Ka):this._batchingRenderers.flatColorRenderer&&this._batchingRenderers.flatColorRenderer.drawLayer(t,this,Ka))}drawDepth(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.depthRenderer&&this._batchingRenderers.depthRenderer.drawLayer(t,this,Ya))}drawNormals(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.normalsRenderer&&this._batchingRenderers.normalsRenderer.drawLayer(t,this,Ya))}drawSilhouetteXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,Qa))}drawSilhouetteHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,Ja))}drawSilhouetteSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,Za))}drawEdgesColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&this._batchingRenderers.edgesColorRenderer&&this._batchingRenderers.edgesColorRenderer.drawLayer(t,this,qa)}drawEdgesColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&0!==this._numTransparentLayerPortions&&this._batchingRenderers.edgesColorRenderer&&this._batchingRenderers.edgesColorRenderer.drawLayer(t,this,$a)}drawEdgesHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._batchingRenderers.edgesRenderer&&this._batchingRenderers.edgesRenderer.drawLayer(t,this,eh)}drawEdgesSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._batchingRenderers.edgesRenderer&&this._batchingRenderers.edgesRenderer.drawLayer(t,this,th)}drawEdgesXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._batchingRenderers.edgesRenderer&&this._batchingRenderers.edgesRenderer.drawLayer(t,this,sh)}drawOcclusion(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.occlusionRenderer&&this._batchingRenderers.occlusionRenderer.drawLayer(t,this,Ya))}drawShadow(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.shadowRenderer&&this._batchingRenderers.shadowRenderer.drawLayer(t,this,Ya))}drawPickMesh(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.pickMeshRenderer&&this._batchingRenderers.pickMeshRenderer.drawLayer(t,this,ih))}drawPickDepths(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.pickDepthRenderer&&this._batchingRenderers.pickDepthRenderer.drawLayer(t,this,ih))}drawPickNormals(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._batchingRenderers.pickNormalsFlatRenderer&&this._batchingRenderers.pickNormalsFlatRenderer.drawLayer(t,this,ih))}precisionRayPickSurface(e,t,s,i,r){if(!this.model.scene.pickSurfacePrecisionEnabled)return!1;const o=this._state,n=this._portions[e];if(!n)return this.model.error("portion not found: "+e),!1;const a=n.quantizedPositions,h=n.indices,l=o.origin,u=n.offset,c=sl,d=il;c.set(l?p.subVec3(t,l,rl):t),d.set(s),u&&p.subVec3(c,u),p.transformRay(this.model.worldNormalMatrix,c,d,c,d);const m=ol,f=nl,g=al;let _=!1,y=0;const v=hl;for(let e=0,s=h.length;e<s;e+=3){const s=3*h[e],n=3*h[e+1],b=3*h[e+2];if(m[0]=a[s],m[1]=a[s+1],m[2]=a[s+2],f[0]=a[n],f[1]=a[n+1],f[2]=a[n+2],g[0]=a[b],g[1]=a[b+1],g[2]=a[b+2],p.decompressPosition(m,o.positionsDecodeMatrix),p.decompressPosition(f,o.positionsDecodeMatrix),p.decompressPosition(g,o.positionsDecodeMatrix),p.rayTriangleIntersect(c,d,m,f,g,v)){p.transformPoint3(this.model.worldMatrix,v,v),u&&p.addVec3(v,u),l&&p.addVec3(v,l);const e=Math.abs(p.lenVec3(p.subVec3(v,t,[])));(!_||e>y)&&(y=e,i.set(v),r&&p.triangleNormal(m,f,g,r),_=!0)}}return _&&r&&(p.transformVec3(this.model.worldNormalMatrix,r,r),p.normalizeVec3(r)),_}destroy(){const e=this._state;e.positionsBuf&&(e.positionsBuf.destroy(),e.positionsBuf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.normalsBuf&&(e.normalsBuf.destroy(),e.normalsBuf=null),e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.metallicRoughnessBuf&&(e.metallicRoughnessBuf.destroy(),e.metallicRoughnessBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.pickColorsBuf&&(e.pickColorsBuf.destroy(),e.pickColorsBuf=null),e.indicesBuf&&(e.indicesBuf.destroy(),e.indicessBuf=null),e.edgeIndicesBuf&&(e.edgeIndicesBuf.destroy(),e.edgeIndicessBuf=null),e.destroy()}}const ul=p.vec4(),cl=p.vec3();class pl{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.geometry,l=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,i.worldNormalMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,o=i.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,cl);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aModelNormalMatrixCol0.bindArrayBuffer(a.modelNormalMatrixCol0Buf),this._aModelNormalMatrixCol1.bindArrayBuffer(a.modelNormalMatrixCol1Buf),this._aModelNormalMatrixCol2.bindArrayBuffer(a.modelNormalMatrixCol2Buf),n.vertexAttribDivisor(this._aModelNormalMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelNormalMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelNormalMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aNormal.bindArrayBuffer(h.normalsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),n.vertexAttribDivisor(this._aColor.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),h.indicesBuf.bind(),n.drawElementsInstanced(n.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,a.numInstances),e.drawElements++,n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aModelNormalMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelNormalMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelNormalMatrixCol2.location,0),n.vertexAttribDivisor(this._aColor.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._lightsState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=i.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=i.getLocation("lightDir"+e),this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e)}this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aNormal=i.getAttribute("normal"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aOffset=i.getAttribute("offset"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._aModelNormalMatrixCol0=i.getAttribute("modelNormalMatrixCol0"),this._aModelNormalMatrixCol1=i.getAttribute("modelNormalMatrixCol1"),this._aModelNormalMatrixCol2=i.getAttribute("modelNormalMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,s=t.canvas.gl,i=t._lightsState.lights,r=t.camera.project;this._program.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(let e=0,t=i.length;e<t;e++){const t=i[e];this._uLightColor[e]&&s.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(s.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&s.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&s.uniform3fv(this._uLightDir[e],t.dir)}if(this._withSAO){const i=t.sao;if(i.possible){const t=s.drawingBufferWidth,r=s.drawingBufferHeight;ul[0]=t,ul[1]=r,ul[2]=i.blendCutoff,ul[3]=i.blendFactor,s.uniform4fv(this._uSAOParams,ul),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}if(t.logarithmicDepthBufferEnabled){const e=2/(Math.log(r.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState,s=e._lightsState,i=t.sectionPlanes.length>0;let r,o,n;const a=[];for(a.push("#version 300 es"),a.push("// Instancing geometry drawing vertex shader"),a.push("uniform int renderPass;"),a.push("in vec3 position;"),a.push("in vec2 normal;"),a.push("in vec4 color;"),a.push("in vec4 flags;"),a.push("in vec4 flags2;"),e.entityOffsetsEnabled&&a.push("in vec3 offset;"),a.push("in vec4 modelMatrixCol0;"),a.push("in vec4 modelMatrixCol1;"),a.push("in vec4 modelMatrixCol2;"),a.push("in vec4 modelNormalMatrixCol0;"),a.push("in vec4 modelNormalMatrixCol1;"),a.push("in vec4 modelNormalMatrixCol2;"),a.push("uniform mat4 worldMatrix;"),a.push("uniform mat4 worldNormalMatrix;"),a.push("uniform mat4 viewMatrix;"),a.push("uniform mat4 viewNormalMatrix;"),a.push("uniform mat4 projMatrix;"),a.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(a.push("uniform float logDepthBufFC;"),a.push("out float vFragDepth;"),a.push("bool isPerspectiveMatrix(mat4 m) {"),a.push("    return (m[2][3] == - 1.0);"),a.push("}"),a.push("out float isPerspective;")),a.push("uniform vec4 lightAmbient;"),r=0,o=s.lights.length;r<o;r++)n=s.lights[r],"ambient"!==n.type&&(a.push("uniform vec4 lightColor"+r+";"),"dir"===n.type&&a.push("uniform vec3 lightDir"+r+";"),"point"===n.type&&a.push("uniform vec3 lightPos"+r+";"),"spot"===n.type&&(a.push("uniform vec3 lightPos"+r+";"),a.push("uniform vec3 lightDir"+r+";")));for(a.push("vec3 octDecode(vec2 oct) {"),a.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),a.push("    if (v.z < 0.0) {"),a.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),a.push("    }"),a.push("    return normalize(v);"),a.push("}"),i&&(a.push("out vec4 vWorldPosition;"),a.push("out vec4 vFlags2;")),a.push("out vec4 vColor;"),a.push("void main(void) {"),a.push("if (int(flags.x) != renderPass) {"),a.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),a.push("} else {"),a.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),a.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&a.push("      worldPosition.xyz = worldPosition.xyz + offset;"),a.push("vec4 viewPosition  = viewMatrix * worldPosition; "),a.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),a.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),a.push("vec3 viewNormal = normalize(vec4(viewNormalMatrix * worldNormal).xyz);"),a.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),a.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),a.push("float lambertian = 1.0;"),r=0,o=s.lights.length;r<o;r++)if(n=s.lights[r],"ambient"!==n.type){if("dir"===n.type)"view"===n.space?a.push("viewLightDir = normalize(lightDir"+r+");"):a.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+r+", 0.0)).xyz);");else if("point"===n.type)"view"===n.space?a.push("viewLightDir = -normalize(lightPos"+r+" - viewPosition.xyz);"):a.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+r+", 0.0)).xyz);");else{if("spot"!==n.type)continue;"view"===n.space?a.push("viewLightDir = normalize(lightDir"+r+");"):a.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+r+", 0.0)).xyz);")}a.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),a.push("reflectedColor += lambertian * (lightColor"+r+".rgb * lightColor"+r+".a);")}return a.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),a.push("vColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),a.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(a.push("vFragDepth = 1.0 + clipPos.w;"),a.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i&&(a.push("vWorldPosition = worldPosition;"),a.push("vFlags2 = flags2;")),a.push("gl_Position = clipPos;"),a.push("}"),a.push("}"),a}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Instancing geometry drawing fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),this._withSAO&&(i.push("uniform sampler2D uOcclusionTexture;"),i.push("uniform vec4      uSAOParams;"),i.push("const float       packUpscale = 256. / 255.;"),i.push("const float       unpackDownScale = 255. / 256.;"),i.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),i.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),i.push("float unpackRGBToFloat( const in vec4 v ) {"),i.push("    return dot( v, unPackFactors );"),i.push("}")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { "),i.push("      discard;"),i.push("  }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),this._withSAO?(i.push("   float viewportWidth     = uSAOParams[0];"),i.push("   float viewportHeight    = uSAOParams[1];"),i.push("   float blendCutoff       = uSAOParams[2];"),i.push("   float blendFactor       = uSAOParams[3];"),i.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),i.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),i.push("   outColor                = vec4(vColor.rgb * ambient, 1.0);")):i.push("    outColor           = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const dl=p.vec4(),ml=p.vec3();class fl{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.geometry,l=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,o=i.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t],r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,ml);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),n.vertexAttribDivisor(this._aColor.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),h.indicesBuf.bind(),n.drawElementsInstanced(n.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aColor.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._lightsState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=i.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=i.getLocation("lightDir"+e),this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e)}this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aOffset=i.getAttribute("offset"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,s=t.canvas.gl,i=t._lightsState.lights,r=t.camera.project;this._program.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(let e=0,t=i.length;e<t;e++){const t=i[e];this._uLightColor[e]&&s.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(s.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&s.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&s.uniform3fv(this._uLightDir[e],t.dir)}if(this._withSAO){const i=t.sao;if(i.possible){const t=s.drawingBufferWidth,r=s.drawingBufferHeight;dl[0]=t,dl[1]=r,dl[2]=i.blendCutoff,dl[3]=i.blendFactor,s.uniform4fv(this._uSAOParams,dl),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}if(t.logarithmicDepthBufferEnabled){const e=2/(Math.log(r.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Instancing geometry flat-shading drawing vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),s.push("in vec4 color;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vViewPosition;"),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("vViewPosition = viewPosition;"),s.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=e._lightsState;let i,r;const o=t.sectionPlanes.length>0,n=[];if(n.push("#version 300 es"),n.push("// Instancing geometry flat-shading drawing fragment shader"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),e.logarithmicDepthBufferEnabled&&(n.push("in float isPerspective;"),n.push("uniform float logDepthBufFC;"),n.push("in float vFragDepth;")),this._withSAO&&(n.push("uniform sampler2D uOcclusionTexture;"),n.push("uniform vec4      uSAOParams;"),n.push("const float       packUpscale = 256. / 255.;"),n.push("const float       unpackDownScale = 255. / 256.;"),n.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),n.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),n.push("float unpackRGBToFloat( const in vec4 v ) {"),n.push("    return dot( v, unPackFactors );"),n.push("}")),o){n.push("in vec4 vWorldPosition;"),n.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)n.push("uniform bool sectionPlaneActive"+e+";"),n.push("uniform vec3 sectionPlanePos"+e+";"),n.push("uniform vec3 sectionPlaneDir"+e+";")}for(n.push("uniform mat4 viewMatrix;"),n.push("uniform vec4 lightAmbient;"),i=0,r=s.lights.length;i<r;i++){const e=s.lights[i];"ambient"!==e.type&&(n.push("uniform vec4 lightColor"+i+";"),"dir"===e.type&&n.push("uniform vec3 lightDir"+i+";"),"point"===e.type&&n.push("uniform vec3 lightPos"+i+";"),"spot"===e.type&&(n.push("uniform vec3 lightPos"+i+";"),n.push("uniform vec3 lightDir"+i+";")))}if(n.push("in vec4 vViewPosition;"),n.push("in vec4 vColor;"),n.push("out vec4 outColor;"),n.push("void main(void) {"),o){n.push("  bool clippable = (float(vFlags2.x) > 0.0);"),n.push("  if (clippable) {"),n.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)n.push("if (sectionPlaneActive"+e+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),n.push("}");n.push("  if (dist > 0.0) { "),n.push("      discard;"),n.push("  }"),n.push("}")}for(n.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),n.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),n.push("float lambertian = 1.0;"),n.push("vec3 xTangent = dFdx( vViewPosition.xyz );"),n.push("vec3 yTangent = dFdy( vViewPosition.xyz );"),n.push("vec3 viewNormal = normalize( cross( xTangent, yTangent ) );"),i=0,r=s.lights.length;i<r;i++){const e=s.lights[i];if("ambient"!==e.type){if("dir"===e.type)"view"===e.space?n.push("viewLightDir = normalize(lightDir"+i+");"):n.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+i+", 0.0)).xyz);");else if("point"===e.type)"view"===e.space?n.push("viewLightDir = -normalize(lightPos"+i+" - viewPosition.xyz);"):n.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+i+", 0.0)).xyz);");else{if("spot"!==e.type)continue;"view"===e.space?n.push("viewLightDir = normalize(lightDir"+i+");"):n.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+i+", 0.0)).xyz);")}n.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),n.push("reflectedColor += lambertian * (lightColor"+i+".rgb * lightColor"+i+".a);")}}return n.push("vec4 fragColor = vec4((lightAmbient.rgb * lightAmbient.a * vColor.rgb) + (reflectedColor * vColor.rgb), vColor.a);"),this._withSAO?(n.push("   float viewportWidth     = uSAOParams[0];"),n.push("   float viewportHeight    = uSAOParams[1];"),n.push("   float blendCutoff       = uSAOParams[2];"),n.push("   float blendFactor       = uSAOParams[3];"),n.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),n.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),n.push("   outColor            = vec4(fragColor.rgb * ambient, 1.0);")):n.push("    outColor           = fragColor;"),e.logarithmicDepthBufferEnabled&&n.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("}"),n}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const gl=p.vec3();class _l{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.geometry,l=t._state.origin;if(!this._program&&(this._allocate(t.model.scene),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===Qa){const e=r.xrayMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uSilhouetteColor,t[0],t[1],t[2],s)}else if(s===Ja){const e=r.highlightMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uSilhouetteColor,t[0],t[1],t[2],s)}else if(s===Za){const e=r.selectedMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uSilhouetteColor,t[0],t[1],t[2],s)}else n.uniform4fv(this._uSilhouetteColor,p.vec3([1,1,1]));n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,o=i.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,gl);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf,n.UNSIGNED_BYTE,!0),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,n.UNSIGNED_BYTE,!0),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),this._aColor&&(this._aColor.bindArrayBuffer(a.colorsBuf),n.vertexAttribDivisor(this._aColor.location,1)),h.indicesBuf.bind(),n.drawElementsInstanced(n.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0),this._aColor&&n.vertexAttribDivisor(this._aColor.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSilhouetteColor=i.getLocation("silhouetteColor"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aColor=i.getAttribute("color"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Instancing silhouette vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 color;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform vec4 silhouetteColor;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.y) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vColor = vec4(silhouetteColor.r, silhouetteColor.g, silhouetteColor.b, min(silhouetteColor.a, float(color.a) / 255.0));"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Instancing fill fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("outColor = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const yl=p.vec3(),vl=new Float32Array([0,0,0,1]);class bl{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.geometry,l=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===sh){const e=r.xrayMaterial._state,t=e.edgeColor,s=e.edgeAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===eh){const e=r.highlightMaterial._state,t=e.edgeColor,s=e.edgeAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===th){const e=r.selectedMaterial._state,t=e.edgeColor,s=e.edgeAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else n.uniform4fv(this._uColor,vl);n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,o=i.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,yl);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aFlags&&(this._aFlags.bindArrayBuffer(a.flagsBuf,n.UNSIGNED_BYTE,!0),n.vertexAttribDivisor(this._aFlags.location,1)),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,n.UNSIGNED_BYTE,!0),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),h.edgeIndicesBuf.bind(),n.drawElementsInstanced(n.LINES,h.edgeIndicesBuf.numItems,h.edgeIndicesBuf.itemType,0,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0),this._aFlags&&n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uColor=i.getLocation("color"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles instancing edges vertex shader"),s.push("uniform int renderPass;"),s.push("uniform vec4 color;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.z) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("vColor = vec4(color.r, color.g, color.b, color.a);"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Batched geometry edges drawing fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("outColor = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const xl=p.vec3();class Pl{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.geometry,l=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,o=i.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,xl);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),n.vertexAttribDivisor(this._aColor.location,1),this._aFlags&&(this._aFlags.bindArrayBuffer(a.flagsBuf,n.UNSIGNED_BYTE,!0),n.vertexAttribDivisor(this._aFlags.location,1)),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,n.UNSIGNED_BYTE,!0),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),h.edgeIndicesBuf.bind(),n.drawElementsInstanced(n.LINES,h.edgeIndicesBuf.numItems,h.edgeIndicesBuf.itemType,0,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aColor.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0),this._aFlags&&n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aColor=i.getAttribute("color"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Triangles instancing edges vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),s.push("in vec4 color;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.z) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("vColor = vec4(float(color.r*0.5) / 255.0, float(color.g*0.5) / 255.0, float(color.b*0.5) / 255.0, float(color.a) / 255.0);"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Batched geometry edges drawing fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("outColor = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Tl=p.vec3();class wl{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.geometry,l=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,s);const u=e.pickViewMatrix||o.viewMatrix,c=l?U(u,l):u;if(n.uniformMatrix4fv(this._uViewMatrix,!1,c),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,e)}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPickColor.bindArrayBuffer(a.pickColorsBuf),n.vertexAttribDivisor(this._aPickColor.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),h.indicesBuf.bind();const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*p,o=i.renderFlags;for(let t=0;t<p;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,Tl);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.drawElementsInstanced(n.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aPickColor.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._uRenderPass=i.getLocation("renderPass"),this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aPickColor=i.getAttribute("pickColor"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene.canvas.gl;this._program.bind(),t.uniform1i(this._uPickInvisible,e.pickInvisible)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Instancing geometry picking vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 pickColor;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vPickColor;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("  vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),t&&(s.push("  vWorldPosition = worldPosition;"),s.push("  vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Batched geometry picking fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vPickColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("outColor = vPickColor; "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Ml=p.vec3();class Il{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.canvas.gl,n=t._state,a=n.geometry,h=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram());const l=r.camera;o.uniform1i(this._uRenderPass,s),o.uniform1i(this._uPickInvisible,e.pickInvisible);const u=e.pickViewMatrix||l.viewMatrix,c=h?U(u,h):u;if(o.uniformMatrix4fv(this._uViewMatrix,!1,c),o.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),o.uniform1f(this._uPickZNear,e.pickZNear),o.uniform1f(this._uPickZFar,e.pickZFar),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(e.pickZFar+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,t)}const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*p,n=i.renderFlags;for(let t=0;t<p;t++){const i=this._uSectionPlanes[t];if(i){const r=n.sectionPlanesActivePerLayer[s+t];if(o.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,Ml);o.uniform3fv(i.pos,e)}else o.uniform3fv(i.pos,s.pos);o.uniform3fv(i.dir,s.dir)}}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,a.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),a.indicesBuf.bind(),o.drawElementsInstanced(o.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,n.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uPickZNear=s.getLocation("pickZNear"),this._uPickZFar=s.getLocation("pickZFar"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Instancing geometry depth vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vViewPosition;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("  vWorldPosition = worldPosition;"),s.push("  vFlags2 = flags2;")),s.push("  vViewPosition = viewPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Batched geometry depth fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),i.push("uniform float pickZNear;"),i.push("uniform float pickZFar;"),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vViewPosition;"),i.push("vec4 packDepth(const in float depth) {"),i.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),i.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),i.push("  vec4 res = fract(depth * bitShift);"),i.push("  res -= res.xxyz * bitMask;"),i.push("  return res;"),i.push("}"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),i.push("    outColor = packDepth(zNormalizedDepth); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Cl=p.vec3();class Dl{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.geometry,l=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniform1i(this._uPickInvisible,e.pickInvisible);const u=e.pickViewMatrix||o.viewMatrix,c=l?U(u,l):u;if(n.uniformMatrix4fv(this._uViewMatrix,!1,c),n.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,i.worldNormalMatrix),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,e)}const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*p,o=i.renderFlags;for(let t=0;t<p;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,Cl);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aModelNormalMatrixCol0.bindArrayBuffer(a.modelNormalMatrixCol0Buf),this._aModelNormalMatrixCol1.bindArrayBuffer(a.modelNormalMatrixCol1Buf),this._aModelNormalMatrixCol2.bindArrayBuffer(a.modelNormalMatrixCol2Buf),n.vertexAttribDivisor(this._aModelNormalMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelNormalMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelNormalMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aNormal.bindArrayBuffer(h.normalsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),h.indicesBuf.bind(),n.drawElementsInstanced(n.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aModelNormalMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelNormalMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelNormalMatrixCol2.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aNormal=i.getAttribute("normal"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._aModelNormalMatrixCol0=i.getAttribute("modelNormalMatrixCol0"),this._aModelNormalMatrixCol1=i.getAttribute("modelNormalMatrixCol1"),this._aModelNormalMatrixCol2=i.getAttribute("modelNormalMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Instancing geometry normals vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec2 normal;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("in vec4 modelNormalMatrixCol0;"),s.push("in vec4 modelNormalMatrixCol1;"),s.push("in vec4 modelNormalMatrixCol2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),s.push("vec3 octDecode(vec2 oct) {"),s.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),s.push("    if (v.z < 0.0) {"),s.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),s.push("    }"),s.push("    return normalize(v);"),s.push("}"),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec3 vWorldNormal;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("  vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),s.push("  vec3 worldNormal = vec3(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2));"),s.push("  vWorldNormal = worldNormal;"),t&&s.push("  vWorldPosition = worldPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Batched geometry normals fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec3 vWorldNormal;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("if (sectionPlaneActive"+r+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    outColor = vec4((vWorldNormal * 0.5) + 0.5, 1.0);"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Al=p.vec3();class El{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.geometry,l=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,o=i.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,Al);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aColor&&(this._aColor.bindArrayBuffer(a.colorsBuf),n.vertexAttribDivisor(this._aColor.location,1)),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(a.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),h.indicesBuf.bind(),n.drawElementsInstanced(n.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),this._aColor&&n.vertexAttribDivisor(this._aColor.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Instancing occlusion vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 color;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("in float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&s.push("  vWorldPosition = worldPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Instancing occlusion fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return i.push("   outColor = vec4(0.0, 0.0, 1.0, 1.0); "),e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Fl=p.vec3();class Rl{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.geometry,l=t._state.origin;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,o=i.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,Fl);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(a.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),h.indicesBuf.bind(),n.drawElementsInstanced(n.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Instancing geometry depth drawing vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec2 vHighPrecisionZW;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("vHighPrecisionZW = gl_Position.zw;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState;let s,i;const r=t.sectionPlanes.length>0,o=[];if(o.push("#version 300 es"),o.push("// Instancing geometry depth drawing fragment shader"),o.push("precision highp float;"),o.push("precision highp int;"),e.logarithmicDepthBufferEnabled&&(o.push("in float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("in float vFragDepth;")),r)for(o.push("in vec4 vWorldPosition;"),o.push("in vec4 vFlags2;"),s=0,i=t.sectionPlanes.length;s<i;s++)o.push("uniform bool sectionPlaneActive"+s+";"),o.push("uniform vec3 sectionPlanePos"+s+";"),o.push("uniform vec3 sectionPlaneDir"+s+";");if(o.push("in vec2 vHighPrecisionZW;"),o.push("out vec4 outColor;"),o.push("void main(void) {"),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),s=0,i=t.sectionPlanes.length;s<i;s++)o.push("if (sectionPlaneActive"+s+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+s+".xyz, vWorldPosition.xyz - sectionPlanePos"+s+".xyz), 0.0, 1000.0);"),o.push("}");o.push("if (dist > 0.0) { discard; }"),o.push("}")}return e.logarithmicDepthBufferEnabled&&o.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;"),o.push("    outColor = vec4(vec3(1.0 - fragCoordZ), 1.0); "),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Sl=p.vec3();class Ol{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.geometry,l=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,i.worldNormalMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,o=i.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,Sl);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aNormal.bindArrayBuffer(h.normalsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),this._aColor.bindArrayBuffer(a.colorsBuf),n.vertexAttribDivisor(this._aColor.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),h.indicesBuf.bind(),n.drawElementsInstanced(n.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aColor.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aNormal=i.getAttribute("normal"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2&&(this._aFlags2=i.getAttribute("flags2")),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Instancing geometry normals drawing vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec3 normal;"),s.push("in vec4 color;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 worldNormalMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 viewNormalMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),s.push("vec3 octDecode(vec2 oct) {"),s.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),s.push("    if (v.z < 0.0) {"),s.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),s.push("    }"),s.push("    return normalize(v);"),s.push("}"),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec3 vViewNormal;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("  vec4 worldNormal    = worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),s.push("  vec3 viewNormal     = normalize((viewNormalMatrix * worldNormal).xyz);"),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("  vViewNormal = viewNormal;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Instancing geometry depth drawing fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec3 vViewNormal;"),i.push("vec3 packNormalToRGB( const in vec3 normal ) {"),i.push("    return normalize( normal ) * 0.5 + 0.5;"),i.push("}"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    outColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Bl=p.vec3();class Ll{constructor(e){this._scene=e,this._hash=this._getHash(),this._lastLightId=null,this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t){const s=t.model,i=s.scene,r=i.canvas.gl,o=t._state,n=o.geometry;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e,t)),r.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,n.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(o.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(o.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(o.modelMatrixCol2Buf),r.vertexAttribDivisor(this._aModelMatrixCol0.location,1),r.vertexAttribDivisor(this._aModelMatrixCol1.location,1),r.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(o.offsetsBuf),r.vertexAttribDivisor(this._aOffset.location,1)),this._aColor.bindArrayBuffer(o.colorsBuf),r.vertexAttribDivisor(this._aColor.location,1),this._aFlags.bindArrayBuffer(o.flagsBuf),r.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(o.flags2Buf),r.vertexAttribDivisor(this._aFlags2.location,1));const a=i._sectionPlanesState.sectionPlanes.length;if(a>0){const e=i._sectionPlanesState.sectionPlanes,o=t.layerIndex*a,n=s.renderFlags,h=t._state.origin;for(let t=0;t<a;t++){const s=this._uSectionPlanes[t];if(s){const i=n.sectionPlanesActivePerLayer[o+t];if(r.uniform1i(s.active,i?1:0),i){const i=e[t];if(h){const e=X(i.dist,i.dir,h,Bl);r.uniform3fv(s.pos,e)}else r.uniform3fv(s.pos,i.pos);r.uniform3fv(s.dir,i.dir)}}}}n.indicesBuf.bind(),r.drawElementsInstanced(r.TRIANGLES,n.indicesBuf.numItems,n.indicesBuf.itemType,0,o.numInstances),r.vertexAttribDivisor(this._aModelMatrixCol0.location,0),r.vertexAttribDivisor(this._aModelMatrixCol1.location,0),r.vertexAttribDivisor(this._aModelMatrixCol2.location,0),r.vertexAttribDivisor(this._aColor.location,0),r.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&r.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&r.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uShadowViewMatrix=i.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=i.getLocation("shadowProjMatrix"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2")}_bindProgram(e,t){const s=this._scene.canvas.gl;this._program.bind(),s.uniformMatrix4fv(this._uShadowViewMatrix,!1,e.shadowViewMatrix),s.uniformMatrix4fv(this._uShadowProjMatrix,!1,e.shadowProjMatrix),this._lastLightId=null}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Instancing geometry shadow drawing vertex shader"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 color;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 shadowViewMatrix;"),s.push("uniform mat4 shadowProjMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("void main(void) {"),s.push("bool visible      = (float(flags.x) > 0.0);"),s.push("bool transparent  = ((float(color.a) / 255.0) < 1.0);"),s.push("if (!visible || transparent) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = shadowViewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("  gl_Position = shadowProjMatrix * viewPosition;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Instancing geometry depth drawing fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec3 vViewNormal;"),i.push("vec3 packNormalToRGB( const in vec3 normal ) {"),i.push("    return normalize( normal ) * 0.5 + 0.5;"),i.push("}"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    outColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Nl=p.vec4(),kl=p.vec3(),jl={3e3:"linearToLinear",3001:"sRGBToLinear"};class Gl{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e.gammaOutput,e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,s){const i=ce.MAX_TEXTURE_IMAGE_UNITS,r=t.model,o=this._scene,n=o.camera,a=o.canvas.gl,h=t._state,l=h.origin,u=h.textureSet,c=h.geometry,p=o._lightsState;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,s),a.uniformMatrix4fv(this._uViewMatrix,!1,l?U(n.viewMatrix,l):n.viewMatrix),a.uniformMatrix4fv(this._uViewNormalMatrix,!1,n.viewNormalMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,r.worldMatrix),a.uniformMatrix4fv(this._uWorldNormalMatrix,!1,r.worldNormalMatrix);const d=o._sectionPlanesState.sectionPlanes.length;if(d>0){const e=o._sectionPlanesState.sectionPlanes,s=t.layerIndex*d,i=r.renderFlags;for(let t=0;t<d;t++){const r=this._uSectionPlanes[t];if(r){const o=i.sectionPlanesActivePerLayer[s+t];if(a.uniform1i(r.active,o?1:0),o){const s=e[t];if(l){const e=X(s.dist,s.dir,l,kl);a.uniform3fv(r.pos,e)}else a.uniform3fv(r.pos,s.pos);a.uniform3fv(r.dir,s.dir)}}}}if(a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,c.positionsDecodeMatrix),this._uUVDecodeMatrix&&a.uniformMatrix3fv(this._uUVDecodeMatrix,!1,c.uvDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(h.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(h.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(h.modelMatrixCol2Buf),a.vertexAttribDivisor(this._aModelMatrixCol0.location,1),a.vertexAttribDivisor(this._aModelMatrixCol1.location,1),a.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aModelNormalMatrixCol0.bindArrayBuffer(h.modelNormalMatrixCol0Buf),this._aModelNormalMatrixCol1.bindArrayBuffer(h.modelNormalMatrixCol1Buf),this._aModelNormalMatrixCol2.bindArrayBuffer(h.modelNormalMatrixCol2Buf),a.vertexAttribDivisor(this._aModelNormalMatrixCol0.location,1),a.vertexAttribDivisor(this._aModelNormalMatrixCol1.location,1),a.vertexAttribDivisor(this._aModelNormalMatrixCol2.location,1),this._aPosition.bindArrayBuffer(c.positionsBuf),this._aNormal.bindArrayBuffer(c.normalsBuf),this._aUV&&this._aUV.bindArrayBuffer(c.uvBuf),this._aColor.bindArrayBuffer(h.colorsBuf),a.vertexAttribDivisor(this._aColor.location,1),this._aMetallicRoughness.bindArrayBuffer(h.metallicRoughnessBuf),a.vertexAttribDivisor(this._aMetallicRoughness.location,1),this._aFlags.bindArrayBuffer(h.flagsBuf),a.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(h.flags2Buf),a.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(h.offsetsBuf),a.vertexAttribDivisor(this._aOffset.location,1)),p.reflectionMaps.length>0&&p.reflectionMaps[0].texture&&this._uReflectionMap&&(this._program.bindTexture(this._uReflectionMap,p.reflectionMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++),p.lightMaps.length>0&&p.lightMaps[0].texture&&this._uLightMap&&(this._program.bindTexture(this._uLightMap,p.lightMaps[0].texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++),this._withSAO){const t=o.sao;if(t.possible){const s=a.drawingBufferWidth,r=a.drawingBufferHeight;Nl[0]=s,Nl[1]=r,Nl[2]=t.blendCutoff,Nl[3]=t.blendFactor,a.uniform4fv(this._uSAOParams,Nl),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,e.bindTexture++}}u&&(this._program.bindTexture(this._uBaseColorMap,u.colorTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,this._program.bindTexture(this._uMetallicRoughMap,u.metallicRoughnessTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,this._program.bindTexture(this._uEmissiveMap,u.emissiveTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i,this._program.bindTexture(this._uNormalMap,u.normalsTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i),c.indicesBuf.bind(),a.drawElementsInstanced(a.TRIANGLES,c.indicesBuf.numItems,c.indicesBuf.itemType,0,h.numInstances),e.drawElements++,a.vertexAttribDivisor(this._aModelMatrixCol0.location,0),a.vertexAttribDivisor(this._aModelMatrixCol1.location,0),a.vertexAttribDivisor(this._aModelMatrixCol2.location,0),a.vertexAttribDivisor(this._aModelNormalMatrixCol0.location,0),a.vertexAttribDivisor(this._aModelNormalMatrixCol1.location,0),a.vertexAttribDivisor(this._aModelNormalMatrixCol2.location,0),a.vertexAttribDivisor(this._aColor.location,0),a.vertexAttribDivisor(this._aMetallicRoughness.location,0),a.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&a.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&a.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._lightsState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=i.getLocation("uvDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uGammaFactor=i.getLocation("gammaFactor"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(var n=0,a=r.length;n<a;n++)switch(o=r[n],o.type){case"dir":this._uLightColor[n]=i.getLocation("lightColor"+n),this._uLightPos[n]=null,this._uLightDir[n]=i.getLocation("lightDir"+n);break;case"point":this._uLightColor[n]=i.getLocation("lightColor"+n),this._uLightPos[n]=i.getLocation("lightPos"+n),this._uLightDir[n]=null,this._uLightAttenuation[n]=i.getLocation("lightAttenuation"+n);break;case"spot":this._uLightColor[n]=i.getLocation("lightColor"+n),this._uLightPos[n]=i.getLocation("lightPos"+n),this._uLightDir[n]=i.getLocation("lightDir"+n),this._uLightAttenuation[n]=i.getLocation("lightAttenuation"+n)}s.reflectionMaps.length>0&&(this._uReflectionMap="reflectionMap"),s.lightMaps.length>0&&(this._uLightMap="lightMap"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aNormal=i.getAttribute("normal"),this._aUV=i.getAttribute("uv"),this._aColor=i.getAttribute("color"),this._aMetallicRoughness=i.getAttribute("metallicRoughness"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aOffset=i.getAttribute("offset"),this._uBaseColorMap="uBaseColorMap",this._uMetallicRoughMap="uMetallicRoughMap",this._uEmissiveMap="uEmissiveMap",this._uNormalMap="uNormalMap",this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._aModelNormalMatrixCol0=i.getAttribute("modelNormalMatrixCol0"),this._aModelNormalMatrixCol1=i.getAttribute("modelNormalMatrixCol1"),this._aModelNormalMatrixCol2=i.getAttribute("modelNormalMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,s=t.canvas.gl,i=t._lightsState.lights,r=t.camera.project;this._program.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(let e=0,t=i.length;e<t;e++){const t=i[e];this._uLightColor[e]&&s.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(s.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&s.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&s.uniform3fv(this._uLightDir[e],t.dir)}if(t.logarithmicDepthBufferEnabled){const e=2/(Math.log(r.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}this._uGammaFactor&&s.uniform1f(this._uGammaFactor,t.gammaFactor)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState,s=e._lightsState,i=t.sectionPlanes.length>0,r=t.clippingCaps,o=[];return o.push("#version 300 es"),o.push("// Instancing geometry quality drawing vertex shader"),o.push("uniform int renderPass;"),o.push("in vec3 position;"),o.push("in vec3 normal;"),o.push("in vec4 color;"),o.push("in vec2 uv;"),o.push("in vec2 metallicRoughness;"),o.push("in vec4 flags;"),o.push("in vec4 flags2;"),e.entityOffsetsEnabled&&o.push("in vec3 offset;"),o.push("in vec4 modelMatrixCol0;"),o.push("in vec4 modelMatrixCol1;"),o.push("in vec4 modelMatrixCol2;"),o.push("in vec4 modelNormalMatrixCol0;"),o.push("in vec4 modelNormalMatrixCol1;"),o.push("in vec4 modelNormalMatrixCol2;"),o.push("uniform mat4 worldMatrix;"),o.push("uniform mat4 worldNormalMatrix;"),o.push("uniform mat4 viewMatrix;"),o.push("uniform mat4 viewNormalMatrix;"),o.push("uniform mat4 projMatrix;"),o.push("uniform mat4 positionsDecodeMatrix;"),o.push("uniform mat3 uvDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),o.push("out float vFragDepth;"),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("out float isPerspective;")),o.push("vec3 octDecode(vec2 oct) {"),o.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),o.push("    if (v.z < 0.0) {"),o.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),o.push("    }"),o.push("    return normalize(v);"),o.push("}"),o.push("out vec4 vViewPosition;"),o.push("out vec3 vViewNormal;"),o.push("out vec4 vColor;"),o.push("out vec2 vUV;"),o.push("out vec2 vMetallicRoughness;"),s.lightMaps.length>0&&o.push("out vec3 vWorldNormal;"),i&&(o.push("out vec4 vWorldPosition;"),o.push("out vec4 vFlags2;"),r&&o.push("out vec4 vClipPosition;")),o.push("void main(void) {"),o.push("if (int(flags.x) != renderPass) {"),o.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),o.push("} else {"),o.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),o.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&o.push("      worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition  = viewMatrix * worldPosition; "),o.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),o.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 1.0);"),o.push("vec3 viewNormal = vec4(viewNormalMatrix * worldNormal).xyz;"),o.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(o.push("vFragDepth = 1.0 + clipPos.w;"),o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i&&(o.push("vWorldPosition = worldPosition;"),o.push("vFlags2 = flags2;"),r&&o.push("vClipPosition = clipPos;")),o.push("vViewPosition = viewPosition;"),o.push("vViewNormal = viewNormal;"),o.push("vColor = color;"),o.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"),o.push("vMetallicRoughness = metallicRoughness;"),s.lightMaps.length>0&&o.push("vWorldNormal = worldNormal.xyz;"),o.push("gl_Position = clipPos;"),o.push("}"),o.push("}"),o}_buildFragmentShader(){const e=this._scene,t=e.gammaOutput,s=e._sectionPlanesState,i=e._lightsState,r=s.sectionPlanes.length>0,o=s.clippingCaps,n=[];n.push("#version 300 es"),n.push("// Instancing geometry quality drawing fragment shader"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),e.logarithmicDepthBufferEnabled&&(n.push("in float isPerspective;"),n.push("uniform float logDepthBufFC;"),n.push("in float vFragDepth;")),n.push("uniform sampler2D uBaseColorMap;"),n.push("uniform sampler2D uMetallicRoughMap;"),n.push("uniform sampler2D uEmissiveMap;"),n.push("uniform sampler2D uNormalMap;"),this._withSAO&&(n.push("uniform sampler2D uOcclusionTexture;"),n.push("uniform vec4      uSAOParams;"),n.push("const float       packUpscale = 256. / 255.;"),n.push("const float       unpackDownScale = 255. / 256.;"),n.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),n.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),n.push("float unpackRGBToFloat( const in vec4 v ) {"),n.push("    return dot( v, unPackFactors );"),n.push("}")),i.reflectionMaps.length>0&&n.push("uniform samplerCube reflectionMap;"),i.lightMaps.length>0&&n.push("uniform samplerCube lightMap;"),n.push("uniform vec4 lightAmbient;");for(let e=0,t=i.lights.length;e<t;e++){const t=i.lights[e];"ambient"!==t.type&&(n.push("uniform vec4 lightColor"+e+";"),"dir"===t.type&&n.push("uniform vec3 lightDir"+e+";"),"point"===t.type&&n.push("uniform vec3 lightPos"+e+";"),"spot"===t.type&&(n.push("uniform vec3 lightPos"+e+";"),n.push("uniform vec3 lightDir"+e+";")))}if(n.push("uniform float gammaFactor;"),n.push("vec4 linearToLinear( in vec4 value ) {"),n.push("  return value;"),n.push("}"),n.push("vec4 sRGBToLinear( in vec4 value ) {"),n.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),n.push("}"),n.push("vec4 gammaToLinear( in vec4 value) {"),n.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),n.push("}"),t&&(n.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),n.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),n.push("}")),r){n.push("in vec4 vWorldPosition;"),n.push("in vec4 vFlags2;"),o&&n.push("in vec4 vClipPosition;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)n.push("uniform bool sectionPlaneActive"+e+";"),n.push("uniform vec3 sectionPlanePos"+e+";"),n.push("uniform vec3 sectionPlaneDir"+e+";")}if(n.push("in vec4 vViewPosition;"),n.push("in vec3 vViewNormal;"),n.push("in vec4 vColor;"),n.push("in vec2 vUV;"),n.push("in vec2 vMetallicRoughness;"),i.lightMaps.length>0&&n.push("in vec3 vWorldNormal;"),n.push("uniform mat4 viewMatrix;"),n.push("#define PI 3.14159265359"),n.push("#define RECIPROCAL_PI 0.31830988618"),n.push("#define RECIPROCAL_PI2 0.15915494"),n.push("#define EPSILON 1e-6"),n.push("#define saturate(a) clamp( a, 0.0, 1.0 )"),n.push("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),n.push("       vec3 texel = texture( uNormalMap, uv ).xyz;"),n.push("       if (texel.r == 0.0 && texel.g == 0.0 && texel.b == 0.0) {"),n.push("              return normalize(surf_norm );"),n.push("       }"),n.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),n.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),n.push("      vec2 st0 = dFdx( uv.st );"),n.push("      vec2 st1 = dFdy( uv.st );"),n.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),n.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),n.push("      vec3 N = normalize( surf_norm );"),n.push("      vec3 mapN = texel.xyz * 2.0 - 1.0;"),n.push("      mat3 tsn = mat3( S, T, N );"),n.push("      return normalize( tsn * mapN );"),n.push("}"),n.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),n.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),n.push("}"),n.push("struct IncidentLight {"),n.push("   vec3 color;"),n.push("   vec3 direction;"),n.push("};"),n.push("struct ReflectedLight {"),n.push("   vec3 diffuse;"),n.push("   vec3 specular;"),n.push("};"),n.push("struct Geometry {"),n.push("   vec3 position;"),n.push("   vec3 viewNormal;"),n.push("   vec3 worldNormal;"),n.push("   vec3 viewEyeDir;"),n.push("};"),n.push("struct Material {"),n.push("   vec3    diffuseColor;"),n.push("   float   specularRoughness;"),n.push("   vec3    specularColor;"),n.push("   float   shine;"),n.push("};"),n.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),n.push("   float r = ggxRoughness + 0.0001;"),n.push("   return (2.0 / (r * r) - 2.0);"),n.push("}"),n.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {"),n.push("   float maxMIPLevelScalar = float( maxMIPLevel );"),n.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );"),n.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );"),n.push("}"),i.reflectionMaps.length>0&&(n.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),n.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),n.push("   vec3 envMapColor = "+jl[i.reflectionMaps[0].encoding]+"(texture(reflectionMap, reflectVec, mipLevel)).rgb;"),n.push("  return envMapColor;"),n.push("}")),n.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),n.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),n.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),n.push("}"),n.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),n.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),n.push("   return 1.0 / ( gl * gv );"),n.push("}"),n.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),n.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),n.push("   return 0.5 / max( gv + gl, EPSILON );"),n.push("}"),n.push("float D_GGX(const in float alpha, const in float dotNH) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),n.push("   return RECIPROCAL_PI * a2 / ( denom * denom);"),n.push("}"),n.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),n.push("   float alpha = ( roughness * roughness );"),n.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),n.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),n.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),n.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),n.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),n.push("   vec3  F = F_Schlick( specularColor, dotLH );"),n.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),n.push("   float D = D_GGX( alpha, dotNH );"),n.push("   return F * (G * D);"),n.push("}"),n.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),n.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),n.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),n.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),n.push("   vec4 r = roughness * c0 + c1;"),n.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),n.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),n.push("   return specularColor * AB.x + AB.y;"),n.push("}"),(i.lightMaps.length>0||i.reflectionMaps.length>0)&&(n.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),i.lightMaps.length>0&&(n.push("   vec3 irradiance = "+jl[i.lightMaps[0].encoding]+"(texture(lightMap, geometry.worldNormal)).rgb;"),n.push("   irradiance *= PI;"),n.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),n.push("   reflectedLight.diffuse += irradiance * diffuseBRDFContrib;")),i.reflectionMaps.length>0&&(n.push("   vec3 reflectVec             = reflect(geometry.viewEyeDir, geometry.viewNormal);"),n.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),n.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),n.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),n.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),n.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),n.push("}")),n.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),n.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),n.push("   vec3 irradiance = dotNL * incidentLight.color * PI;"),n.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),n.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),n.push("}"),n.push("out vec4 outColor;"),n.push("void main(void) {"),r){n.push("  bool clippable = (float(vFlags2.x) > 0.0);"),n.push("  if (clippable) {"),n.push("  float dist = 0.0;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)n.push("if (sectionPlaneActive"+e+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),n.push("}");o?(n.push("  if (dist > (0.002 * vClipPosition.w)) {"),n.push("      discard;"),n.push("  }"),n.push("  if (dist > 0.0) { "),n.push("      outColor=vec4(1.0, 0.0, 0.0, 1.0);"),e.logarithmicDepthBufferEnabled&&n.push("  gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("  return;"),n.push("}")):(n.push("  if (dist > 0.0) { "),n.push("      discard;"),n.push("  }")),n.push("}")}n.push("IncidentLight  light;"),n.push("Material       material;"),n.push("Geometry       geometry;"),n.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),n.push("vec3 rgb = (vec3(float(vColor.r) / 255.0, float(vColor.g) / 255.0, float(vColor.b) / 255.0));"),n.push("float opacity = float(vColor.a) / 255.0;"),n.push("vec3  baseColor = rgb;"),n.push("float specularF0 = 1.0;"),n.push("float metallic = float(vMetallicRoughness.r) / 255.0;"),n.push("float roughness = float(vMetallicRoughness.g) / 255.0;"),n.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),n.push("vec4 baseColorTexel = sRGBToLinear(texture(uBaseColorMap, vUV));"),n.push("baseColor *= baseColorTexel.rgb;"),n.push("vec3 metalRoughTexel = texture(uMetallicRoughMap, vUV).rgb;"),n.push("metallic *= metalRoughTexel.b;"),n.push("roughness *= metalRoughTexel.g;"),n.push("vec3 viewNormal = perturbNormal2Arb( vViewPosition.xyz, normalize(vViewNormal), vUV );"),n.push("material.diffuseColor      = baseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),n.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),n.push("material.specularColor     = mix(vec3(dielectricSpecular), baseColor, metallic);"),n.push("geometry.position      = vViewPosition.xyz;"),n.push("geometry.viewNormal    = -normalize(viewNormal);"),n.push("geometry.viewEyeDir    = normalize(vViewPosition.xyz);"),i.lightMaps.length>0&&n.push("geometry.worldNormal   = normalize(vWorldNormal);"),(i.lightMaps.length>0||i.reflectionMaps.length>0)&&n.push("computePBRLightMapping(geometry, material, reflectedLight);");for(let e=0,t=i.lights.length;e<t;e++){const t=i.lights[e];if("ambient"!==t.type){if("dir"===t.type)"view"===t.space?n.push("light.direction = normalize(lightDir"+e+");"):n.push("light.direction = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);");else if("point"===t.type)"view"===t.space?n.push("light.direction = normalize(lightPos"+e+" - vViewPosition.xyz);"):n.push("light.direction = normalize((viewMatrix * vec4(lightPos"+e+", 0.0)).xyz);");else{if("spot"!==t.type)continue;"view"===t.space?n.push("light.direction = normalize(lightDir"+e+");"):n.push("light.direction = normalize((viewMatrix * vec4(lightDir"+e+", 0.0)).xyz);")}n.push("light.color =  lightColor"+e+".rgb * lightColor"+e+".a;"),n.push("computePBRLighting(light, geometry, material, reflectedLight);")}}return n.push("vec3 emissiveColor = sRGBToLinear(texture(uEmissiveMap, vUV)).rgb;"),n.push("vec3 outgoingLight = (lightAmbient.rgb * lightAmbient.a * baseColor * opacity * rgb) + (reflectedLight.diffuse) + (reflectedLight.specular) + emissiveColor;"),n.push("vec4 fragColor;"),this._withSAO?(n.push("   float viewportWidth     = uSAOParams[0];"),n.push("   float viewportHeight    = uSAOParams[1];"),n.push("   float blendCutoff       = uSAOParams[2];"),n.push("   float blendFactor       = uSAOParams[3];"),n.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),n.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),n.push("   fragColor            = vec4(outgoingLight.rgb * ambient, opacity);")):n.push("   fragColor            = vec4(outgoingLight.rgb, opacity);"),t&&n.push("fragColor = linearToGamma(fragColor, gammaFactor);"),n.push("outColor = fragColor;"),e.logarithmicDepthBufferEnabled&&n.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("}"),n}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Hl=p.vec3();class Vl{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=a.geometry,l=t._state.origin;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniform1i(this._uPickInvisible,e.pickInvisible);const u=e.pickViewMatrix||o.viewMatrix,c=l?U(u,l):u;if(n.uniformMatrix4fv(this._uViewMatrix,!1,c),n.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,e)}const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*p,o=i.renderFlags;for(let t=0;t<p;t++){const i=this._uSectionPlanes[t],r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(l){const e=X(s.dist,s.dir,l,Hl);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(h.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),h.indicesBuf.bind(),n.drawElementsInstanced(n.TRIANGLES,h.indicesBuf.numItems,h.indicesBuf.itemType,0,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Instancing geometry normals vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&s.push("out vec4 vFlags2;"),s.push("out vec4 vWorldPosition;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("  vWorldPosition = worldPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Batched geometry normals fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("in float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),i.push("in vec4 vWorldPosition;"),s){i.push("in vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec3 vWorldNormal;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("if (sectionPlaneActive"+r+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("  vec3 xTangent = dFdx( vWorldPosition.xyz );"),i.push("  vec3 yTangent = dFdy( vWorldPosition.xyz );"),i.push("  vec3 worldNormal = normalize( cross( xTangent, yTangent ) );"),i.push("  outColor = vec4((worldNormal * 0.5) + 0.5, 1.0);"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Ul=p.vec4(),zl=p.vec3();class Wl{constructor(e,t){this._scene=e,this._withSAO=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const e=this._scene;return[e.gammaOutput,e._lightsState.getHash(),e._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(e,t,s){const i=ce.MAX_TEXTURE_IMAGE_UNITS,r=t.model,o=r.scene,n=o.camera,a=o.canvas.gl,h=t._state,l=h.geometry,u=t._state.origin,c=h.textureSet;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),a.uniform1i(this._uRenderPass,s),a.uniformMatrix4fv(this._uViewMatrix,!1,u?U(n.viewMatrix,u):n.viewMatrix),a.uniformMatrix4fv(this._uWorldMatrix,!1,r.worldMatrix);const p=o._sectionPlanesState.sectionPlanes.length;if(p>0){const e=o._sectionPlanesState.sectionPlanes,s=t.layerIndex*p,i=r.renderFlags;for(let t=0;t<p;t++){const r=this._uSectionPlanes[t];if(r){const o=i.sectionPlanesActivePerLayer[s+t];if(a.uniform1i(r.active,o?1:0),o){const s=e[t];if(u){const e=X(s.dist,s.dir,u,zl);a.uniform3fv(r.pos,e)}else a.uniform3fv(r.pos,s.pos);a.uniform3fv(r.dir,s.dir)}}}}if(a.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._uUVDecodeMatrix&&a.uniformMatrix3fv(this._uUVDecodeMatrix,!1,l.uvDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(h.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(h.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(h.modelMatrixCol2Buf),a.vertexAttribDivisor(this._aModelMatrixCol0.location,1),a.vertexAttribDivisor(this._aModelMatrixCol1.location,1),a.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(l.positionsBuf),this._aUV.bindArrayBuffer(l.uvBuf),this._aColor.bindArrayBuffer(h.colorsBuf),a.vertexAttribDivisor(this._aColor.location,1),this._aFlags.bindArrayBuffer(h.flagsBuf),a.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(h.flags2Buf),a.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(h.offsetsBuf),a.vertexAttribDivisor(this._aOffset.location,1)),l.indicesBuf.bind(),a.drawElementsInstanced(a.TRIANGLES,l.indicesBuf.numItems,l.indicesBuf.itemType,0,h.numInstances),e.drawElements++,a.vertexAttribDivisor(this._aModelMatrixCol0.location,0),a.vertexAttribDivisor(this._aModelMatrixCol1.location,0),a.vertexAttribDivisor(this._aModelMatrixCol2.location,0),a.vertexAttribDivisor(this._aColor.location,0),a.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&a.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&a.vertexAttribDivisor(this._aOffset.location,0),c&&c.colorTexture&&(this._program.bindTexture(this._uColorMap,c.colorTexture.texture,e.textureUnit),e.textureUnit=(e.textureUnit+1)%i),this._withSAO){const t=o.sao;if(t.possible){const s=a.drawingBufferWidth,i=a.drawingBufferHeight;Ul[0]=s,Ul[1]=i,Ul[2]=t.blendCutoff,Ul[3]=t.blendFactor,a.uniform4fv(this._uSAOParams,Ul),this._program.bindTexture(this._uOcclusionTexture,e.occlusionTexture,0)}}}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._lightsState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=i.getLocation("uvDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uGammaFactor=i.getLocation("gammaFactor"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(let e=0,t=r.length;e<t;e++)switch(o=r[e],o.type){case"dir":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=null,this._uLightDir[e]=i.getLocation("lightDir"+e);break;case"point":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=null,this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e);break;case"spot":this._uLightColor[e]=i.getLocation("lightColor"+e),this._uLightPos[e]=i.getLocation("lightPos"+e),this._uLightDir[e]=i.getLocation("lightDir"+e),this._uLightAttenuation[e]=i.getLocation("lightAttenuation"+e)}this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aColor=i.getAttribute("color"),this._aUV=i.getAttribute("uv"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aOffset=i.getAttribute("offset"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uColorMap="uColorMap",this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,s=t.canvas.gl,i=t._lightsState.lights,r=t.camera.project;this._program.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,t._lightsState.getAmbientColorAndIntensity());for(let e=0,t=i.length;e<t;e++){const t=i[e];this._uLightColor[e]&&s.uniform4f(this._uLightColor[e],t.color[0],t.color[1],t.color[2],t.intensity),this._uLightPos[e]&&(s.uniform3fv(this._uLightPos[e],t.pos),this._uLightAttenuation[e]&&s.uniform1f(this._uLightAttenuation[e],t.attenuation)),this._uLightDir[e]&&s.uniform3fv(this._uLightDir[e],t.dir)}if(t.logarithmicDepthBufferEnabled){const e=2/(Math.log(r.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}this._uGammaFactor&&s.uniform1f(this._uGammaFactor,t.gammaFactor)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Instancing geometry drawing vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),s.push("in vec4 color;"),s.push("in vec2 uv;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform mat3 uvDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("out float isPerspective;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vViewPosition;"),s.push("out vec4 vColor;"),s.push("out vec2 vUV;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("vViewPosition = viewPosition;"),s.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),s.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e.gammaOutput,s=e._sectionPlanesState,i=e._lightsState;let r,o;const n=s.sectionPlanes.length>0,a=[];if(a.push("#version 300 es"),a.push("// Instancing geometry drawing fragment shader"),a.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),a.push("precision highp float;"),a.push("precision highp int;"),a.push("#else"),a.push("precision mediump float;"),a.push("precision mediump int;"),a.push("#endif"),e.logarithmicDepthBufferEnabled&&(a.push("in float isPerspective;"),a.push("uniform float logDepthBufFC;"),a.push("in float vFragDepth;")),a.push("uniform sampler2D uColorMap;"),this._withSAO&&(a.push("uniform sampler2D uOcclusionTexture;"),a.push("uniform vec4      uSAOParams;"),a.push("const float       packUpscale = 256. / 255.;"),a.push("const float       unpackDownScale = 255. / 256.;"),a.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),a.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),a.push("float unpackRGBToFloat( const in vec4 v ) {"),a.push("    return dot( v, unPackFactors );"),a.push("}")),a.push("uniform float gammaFactor;"),a.push("vec4 linearToLinear( in vec4 value ) {"),a.push("  return value;"),a.push("}"),a.push("vec4 sRGBToLinear( in vec4 value ) {"),a.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),a.push("}"),a.push("vec4 gammaToLinear( in vec4 value) {"),a.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),a.push("}"),t&&(a.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),a.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),a.push("}")),n){a.push("in vec4 vWorldPosition;"),a.push("in vec4 vFlags2;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)a.push("uniform bool sectionPlaneActive"+e+";"),a.push("uniform vec3 sectionPlanePos"+e+";"),a.push("uniform vec3 sectionPlaneDir"+e+";")}for(a.push("uniform mat4 viewMatrix;"),a.push("uniform vec4 lightAmbient;"),r=0,o=i.lights.length;r<o;r++){const e=i.lights[r];"ambient"!==e.type&&(a.push("uniform vec4 lightColor"+r+";"),"dir"===e.type&&a.push("uniform vec3 lightDir"+r+";"),"point"===e.type&&a.push("uniform vec3 lightPos"+r+";"),"spot"===e.type&&(a.push("uniform vec3 lightPos"+r+";"),a.push("uniform vec3 lightDir"+r+";")))}if(a.push("in vec4 vViewPosition;"),a.push("in vec4 vColor;"),a.push("in vec2 vUV;"),a.push("out vec4 outColor;"),a.push("void main(void) {"),n){a.push("  bool clippable = (float(vFlags2.x) > 0.0);"),a.push("  if (clippable) {"),a.push("  float dist = 0.0;");for(let e=0,t=s.sectionPlanes.length;e<t;e++)a.push("if (sectionPlaneActive"+e+") {"),a.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),a.push("}");a.push("  if (dist > 0.0) { "),a.push("      discard;"),a.push("  }"),a.push("}")}for(a.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),a.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),a.push("float lambertian = 1.0;"),a.push("vec3 xTangent = dFdx( vViewPosition.xyz );"),a.push("vec3 yTangent = dFdy( vViewPosition.xyz );"),a.push("vec3 viewNormal = normalize( cross( xTangent, yTangent ) );"),r=0,o=i.lights.length;r<o;r++){const e=i.lights[r];if("ambient"!==e.type){if("dir"===e.type)"view"===e.space?a.push("viewLightDir = normalize(lightDir"+r+");"):a.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+r+", 0.0)).xyz);");else if("point"===e.type)"view"===e.space?a.push("viewLightDir = -normalize(lightPos"+r+" - viewPosition.xyz);"):a.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+r+", 0.0)).xyz);");else{if("spot"!==e.type)continue;"view"===e.space?a.push("viewLightDir = normalize(lightDir"+r+");"):a.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+r+", 0.0)).xyz);")}a.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),a.push("reflectedColor += lambertian * (lightColor"+r+".rgb * lightColor"+r+".a);")}}return a.push("vec4 color =  vec4((lightAmbient.rgb * lightAmbient.a * vColor.rgb) + (reflectedColor * vColor.rgb), vColor.a);"),t?a.push("vec4 colorTexel = color * sRGBToLinear(texture(uColorMap, vUV));"):a.push("vec4 colorTexel = color * texture(uColorMap, vUV);"),a.push("float opacity = color.a;"),this._withSAO?(a.push("   float viewportWidth     = uSAOParams[0];"),a.push("   float viewportHeight    = uSAOParams[1];"),a.push("   float blendCutoff       = uSAOParams[2];"),a.push("   float blendFactor       = uSAOParams[3];"),a.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),a.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture(uOcclusionTexture, uv))) * blendFactor;"),a.push("   outColor                = vec4(vColor.rgb * colorTexel.rgb * ambient, opacity);")):a.push("   outColor                = vec4(vColor.rgb * colorTexel.rgb, opacity);"),t&&a.push("outColor = linearToGamma(outColor, gammaFactor);"),e.logarithmicDepthBufferEnabled&&a.push("    gl_FragDepth = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),a.push("}"),a}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class Xl{constructor(e){this._scene=e}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._colorRendererWithSAO&&!this._colorRendererWithSAO.getValid()&&(this._colorRendererWithSAO.destroy(),this._colorRendererWithSAO=null),this._flatColorRenderer&&!this._flatColorRenderer.getValid()&&(this._flatColorRenderer.destroy(),this._flatColorRenderer=null),this._flatColorRendererWithSAO&&!this._flatColorRendererWithSAO.getValid()&&(this._flatColorRendererWithSAO.destroy(),this._flatColorRendererWithSAO=null),this._pbrRenderer&&!this._pbrRenderer.getValid()&&(this._pbrRenderer.destroy(),this._pbrRenderer=null),this._pbrRendererWithSAO&&!this._pbrRendererWithSAO.getValid()&&(this._pbrRendererWithSAO.destroy(),this._pbrRendererWithSAO=null),this._colorTextureRenderer&&!this._colorTextureRenderer.getValid()&&(this._colorTextureRenderer.destroy(),this._colorTextureRenderer=null),this._colorTextureRendererWithSAO&&!this._colorTextureRendererWithSAO.getValid()&&(this._colorTextureRendererWithSAO.destroy(),this._colorTextureRendererWithSAO=null),this._depthRenderer&&!this._depthRenderer.getValid()&&(this._depthRenderer.destroy(),this._depthRenderer=null),this._normalsRenderer&&!this._normalsRenderer.getValid()&&(this._normalsRenderer.destroy(),this._normalsRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._edgesRenderer&&!this._edgesRenderer.getValid()&&(this._edgesRenderer.destroy(),this._edgesRenderer=null),this._edgesColorRenderer&&!this._edgesColorRenderer.getValid()&&(this._edgesColorRenderer.destroy(),this._edgesColorRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._pickNormalsRenderer&&!1===this._pickNormalsRenderer.getValid()&&(this._pickNormalsRenderer.destroy(),this._pickNormalsRenderer=null),this._pickNormalsFlatRenderer&&!this._pickNormalsFlatRenderer.getValid()&&(this._pickNormalsFlatRenderer.destroy(),this._pickNormalsFlatRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null),this._shadowRenderer&&!this._shadowRenderer.getValid()&&(this._shadowRenderer.destroy(),this._shadowRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new pl(this._scene,!1)),this._colorRenderer}get colorRendererWithSAO(){return this._colorRendererWithSAO||(this._colorRendererWithSAO=new pl(this._scene,!0)),this._colorRendererWithSAO}get flatColorRenderer(){return this._flatColorRenderer||(this._flatColorRenderer=new fl(this._scene,!1)),this._flatColorRenderer}get flatColorRendererWithSAO(){return this._flatColorRendererWithSAO||(this._flatColorRendererWithSAO=new fl(this._scene,!0)),this._flatColorRendererWithSAO}get pbrRenderer(){return this._pbrRenderer||(this._pbrRenderer=new Gl(this._scene,!1)),this._pbrRenderer}get pbrRendererWithSAO(){return this._pbrRendererWithSAO||(this._pbrRendererWithSAO=new Gl(this._scene,!0)),this._pbrRendererWithSAO}get colorTextureRenderer(){return this._colorTextureRenderer||(this._colorTextureRenderer=new Wl(this._scene,!1)),this._colorTextureRenderer}get colorTextureRendererWithSAO(){return this._colorTextureRendererWithSAO||(this._colorTextureRendererWithSAO=new Wl(this._scene,!0)),this._colorTextureRendererWithSAO}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new _l(this._scene)),this._silhouetteRenderer}get depthRenderer(){return this._depthRenderer||(this._depthRenderer=new Rl(this._scene)),this._depthRenderer}get normalsRenderer(){return this._normalsRenderer||(this._normalsRenderer=new Ol(this._scene)),this._normalsRenderer}get edgesRenderer(){return this._edgesRenderer||(this._edgesRenderer=new bl(this._scene)),this._edgesRenderer}get edgesColorRenderer(){return this._edgesColorRenderer||(this._edgesColorRenderer=new Pl(this._scene)),this._edgesColorRenderer}get pickMeshRenderer(){return this._pickMeshRenderer||(this._pickMeshRenderer=new wl(this._scene)),this._pickMeshRenderer}get pickNormalsRenderer(){return this._pickNormalsRenderer||(this._pickNormalsRenderer=new Dl(this._scene)),this._pickNormalsRenderer}get pickNormalsFlatRenderer(){return this._pickNormalsFlatRenderer||(this._pickNormalsFlatRenderer=new Vl(this._scene)),this._pickNormalsFlatRenderer}get pickDepthRenderer(){return this._pickDepthRenderer||(this._pickDepthRenderer=new Il(this._scene)),this._pickDepthRenderer}get occlusionRenderer(){return this._occlusionRenderer||(this._occlusionRenderer=new El(this._scene)),this._occlusionRenderer}get shadowRenderer(){return this._shadowRenderer||(this._shadowRenderer=new Ll(this._scene)),this._shadowRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._colorRendererWithSAO&&this._colorRendererWithSAO.destroy(),this._flatColorRenderer&&this._flatColorRenderer.destroy(),this._flatColorRendererWithSAO&&this._flatColorRendererWithSAO.destroy(),this._pbrRenderer&&this._pbrRenderer.destroy(),this._pbrRendererWithSAO&&this._pbrRendererWithSAO.destroy(),this._colorTextureRenderer&&this._colorTextureRenderer.destroy(),this._colorTextureRendererWithSAO&&this._colorTextureRendererWithSAO.destroy(),this._depthRenderer&&this._depthRenderer.destroy(),this._normalsRenderer&&this._normalsRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._edgesRenderer&&this._edgesRenderer.destroy(),this._edgesColorRenderer&&this._edgesColorRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._pickNormalsRenderer&&this._pickNormalsRenderer.destroy(),this._pickNormalsFlatRenderer&&this._pickNormalsFlatRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy(),this._shadowRenderer&&this._shadowRenderer.destroy()}}const Yl={};const Kl=new Uint8Array(4),Jl=p.vec4([0,0,0,1]),Zl=p.vec4([0,0,0,1]),Ql=p.vec4([0,0,0,1]),ql=new Float32Array(3),$l=p.vec3(),eu=p.vec3(),tu=p.vec3(),su=p.vec3(),iu=p.vec3(),ru=p.vec3(),ou=p.vec3();class nu{constructor(e){this.model=e.model,this.sortId="TrianglesInstancingLayer"+(e.solid?"-solid":"-surface")+(e.normals?"-normals":"-autoNormals"),this.layerIndex=e.layerIndex,this._instancingRenderers=function(e){const t=e.id;let s=Yl[t];return s||(s=new Xl(e),Yl[t]=s,s._compile(),e.on("compile",(()=>{s._compile()})),e.on("destroyed",(()=>{delete Yl[t],s._destroy()}))),s}(e.model.scene),this._aabb=p.collapseAABB3();const t={numInstances:0,obb:p.OBB3(),origin:p.vec3(),geometry:e.geometry,textureSet:e.textureSet,pbrSupported:!1};this._state=new ft(t),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numSelectedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this.numIndices=e.geometry.numIndices,this._colors=[],this._metallicRoughness=[],this._pickColors=[],this._offsets=[],this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._modelNormalMatrixCol0=[],this._modelNormalMatrixCol1=[],this._modelNormalMatrixCol2=[],this._portions=[],e.origin&&this._state.origin.set(e.origin),this._finalized=!1,this.aabb=p.collapseAABB3(),this.solid=!!e.solid}createPortion(e){const t=e.color,s=e.metallic,i=e.roughness,r=e.opacity,o=e.meshMatrix,n=e.worldMatrix,a=e.aabb,h=e.pickColor;if(this._finalized)throw"Already finalized";const l=t[0],u=t[1],c=t[2];if(t[3],this._colors.push(l),this._colors.push(u),this._colors.push(c),this._colors.push(r),this._metallicRoughness.push(null!=s?s:0),this._metallicRoughness.push(null!=i?i:255),this.model.scene.entityOffsetsEnabled&&(this._offsets.push(0),this._offsets.push(0),this._offsets.push(0)),this._modelMatrixCol0.push(o[0]),this._modelMatrixCol0.push(o[4]),this._modelMatrixCol0.push(o[8]),this._modelMatrixCol0.push(o[12]),this._modelMatrixCol1.push(o[1]),this._modelMatrixCol1.push(o[5]),this._modelMatrixCol1.push(o[9]),this._modelMatrixCol1.push(o[13]),this._modelMatrixCol2.push(o[2]),this._modelMatrixCol2.push(o[6]),this._modelMatrixCol2.push(o[10]),this._modelMatrixCol2.push(o[14]),this._state.geometry.normalsBuf){let e=p.transposeMat4(o,p.mat4()),t=p.inverseMat4(e);this._modelNormalMatrixCol0.push(t[0]),this._modelNormalMatrixCol0.push(t[4]),this._modelNormalMatrixCol0.push(t[8]),this._modelNormalMatrixCol0.push(t[12]),this._modelNormalMatrixCol1.push(t[1]),this._modelNormalMatrixCol1.push(t[5]),this._modelNormalMatrixCol1.push(t[9]),this._modelNormalMatrixCol1.push(t[13]),this._modelNormalMatrixCol2.push(t[2]),this._modelNormalMatrixCol2.push(t[6]),this._modelNormalMatrixCol2.push(t[10]),this._modelNormalMatrixCol2.push(t[14])}this._pickColors.push(h[0]),this._pickColors.push(h[1]),this._pickColors.push(h[2]),this._pickColors.push(h[3]),p.collapseAABB3(a);const d=this._state.geometry.obb,m=d.length;for(let e=0;e<m;e+=4)Jl[0]=d[e+0],Jl[1]=d[e+1],Jl[2]=d[e+2],p.transformPoint4(o,Jl,Zl),n?(p.transformPoint4(n,Zl,Ql),p.expandAABB3Point3(a,Ql)):p.expandAABB3Point3(a,Zl);if(this._state.origin){const e=this._state.origin;a[0]+=e[0],a[1]+=e[1],a[2]+=e[2],a[3]+=e[0],a[4]+=e[1],a[5]+=e[2]}p.expandAABB3(this.aabb,a),this._state.numInstances++;const f=this._portions.length,g={};return this.model.scene.pickSurfacePrecisionEnabled&&(g.matrix=o.slice(),g.inverseMatrix=null,g.normalMatrix=null),this._portions.push(g),this._numPortions++,this.model.numPortions++,f}finalize(){if(this._finalized)throw"Already finalized";const e=this._state,t=e.geometry,s=e.textureSet,i=this.model.scene.canvas.gl,r=this._colors.length,o=r;if(r>0){let e=!1;this._state.colorsBuf=new we(i,i.ARRAY_BUFFER,new Uint8Array(this._colors),this._colors.length,4,i.DYNAMIC_DRAW,e),this._colors=[]}if(this._metallicRoughness.length>0){const e=new Uint8Array(this._metallicRoughness);let t=!1;this._state.metallicRoughnessBuf=new we(i,i.ARRAY_BUFFER,e,this._metallicRoughness.length,2,i.STATIC_DRAW,t)}if(o>0){let e=!1,t=!0;this._state.flagsBuf=new we(i,i.ARRAY_BUFFER,new Uint8Array(o),o,4,i.DYNAMIC_DRAW,e),this._state.flags2Buf=new we(i,i.ARRAY_BUFFER,new Uint8Array(o),o,4,i.DYNAMIC_DRAW,t)}if(this.model.scene.entityOffsetsEnabled&&this._offsets.length>0){const e=!1;this._state.offsetsBuf=new we(i,i.ARRAY_BUFFER,new Float32Array(this._offsets),this._offsets.length,3,i.DYNAMIC_DRAW,e),this._offsets=[]}if(this._modelMatrixCol0.length>0){const e=!1;this._state.modelMatrixCol0Buf=new we(i,i.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol0),this._modelMatrixCol0.length,4,i.STATIC_DRAW,e),this._state.modelMatrixCol1Buf=new we(i,i.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol1),this._modelMatrixCol1.length,4,i.STATIC_DRAW,e),this._state.modelMatrixCol2Buf=new we(i,i.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol2),this._modelMatrixCol2.length,4,i.STATIC_DRAW,e),this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._state.geometry.normalsBuf&&(this._state.modelNormalMatrixCol0Buf=new we(i,i.ARRAY_BUFFER,new Float32Array(this._modelNormalMatrixCol0),this._modelNormalMatrixCol0.length,4,i.STATIC_DRAW,e),this._state.modelNormalMatrixCol1Buf=new we(i,i.ARRAY_BUFFER,new Float32Array(this._modelNormalMatrixCol1),this._modelNormalMatrixCol1.length,4,i.STATIC_DRAW,e),this._state.modelNormalMatrixCol2Buf=new we(i,i.ARRAY_BUFFER,new Float32Array(this._modelNormalMatrixCol2),this._modelNormalMatrixCol2.length,4,i.STATIC_DRAW,e),this._modelNormalMatrixCol0=[],this._modelNormalMatrixCol1=[],this._modelNormalMatrixCol2=[])}if(this._pickColors.length>0){const e=!1;this._state.pickColorsBuf=new we(i,i.ARRAY_BUFFER,new Uint8Array(this._pickColors),this._pickColors.length,4,i.STATIC_DRAW,e),this._pickColors=[]}this._state.pbrSupported=!!(e.metallicRoughnessBuf&&t.uvBuf&&t.normalsBuf&&s&&s.colorTexture&&s.metallicRoughnessTexture),this._state.colorTextureSupported=!!t.uvBuf&&!!s&&!!s.colorTexture,this._finalized=!0}initFlags(e,t,s){t&E&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&L&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&B&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&N&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&S&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&k&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&R&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&F&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),s&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(e,t,s),this._setFlags2(e,t)}setVisible(e,t,s){if(!this._finalized)throw"Not finalized";t&E?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,s)}setHighlighted(e,t,s){if(!this._finalized)throw"Not finalized";t&L?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,s)}setXRayed(e,t,s){if(!this._finalized)throw"Not finalized";t&B?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,s)}setSelected(e,t,s){if(!this._finalized)throw"Not finalized";t&N?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,s)}setEdges(e,t,s){if(!this._finalized)throw"Not finalized";t&k?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,s)}setClippable(e,t){if(!this._finalized)throw"Not finalized";t&S?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}setCollidable(e,t){if(!this._finalized)throw"Not finalized"}setPickable(e,t,s){if(!this._finalized)throw"Not finalized";t&R?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(e,t,s)}setCulled(e,t,s){if(!this._finalized)throw"Not finalized";t&F?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,s)}setColor(e,t){if(!this._finalized)throw"Not finalized";Kl[0]=t[0],Kl[1]=t[1],Kl[2]=t[2],Kl[3]=t[3],this._state.colorsBuf&&this._state.colorsBuf.setData(Kl,4*e,4)}setTransparent(e,t,s){s?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,s)}_setFlags(e,t,s){if(!this._finalized)throw"Not finalized";const i=!!(t&E),r=!!(t&B),o=!!(t&L),n=!!(t&N),a=!!(t&k),h=!!(t&R),l=!!(t&F);let u,c;u=!i||l||r||o&&!this.model.scene.highlightMaterial.glowThrough||n&&!this.model.scene.selectedMaterial.glowThrough?Xa:s?Ka:Ya,c=!i||l?Xa:n?Za:o?Ja:r?Qa:Xa;let p=0;p=!i||l?Xa:n?th:o?eh:r?sh:a?s?$a:qa:Xa;let d=i&&!l&&h?ih:Xa;Kl[0]=u,Kl[1]=c,Kl[2]=p,Kl[3]=d,this._state.flagsBuf&&this._state.flagsBuf.setData(Kl,4*e,4)}_setFlags2(e,t){if(!this._finalized)throw"Not finalized";const s=t&S?255:0;Kl[0]=s,this._state.flags2Buf&&this._state.flags2Buf.setData(Kl,4*e,4)}setOffset(e,t){if(!this._finalized)throw"Not finalized";this.model.scene.entityOffsetsEnabled?(ql[0]=t[0],ql[1]=t[1],ql[2]=t[2],this._state.offsetsBuf&&this._state.offsetsBuf.setData(ql,3*e,3)):this.model.error("Entity#offset not enabled for this Viewer")}drawColorOpaque(e,t){if(this._numCulledLayerPortions===this._numPortions||0===this._numVisibleLayerPortions||this._numTransparentLayerPortions===this._numPortions||this._numXRayedLayerPortions===this._numPortions)return;this._updateBackfaceCull(e,t);const s=this._state.geometry;t.withSAO&&this.model.saoEnabled?t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._instancingRenderers.pbrRendererWithSAO&&this._instancingRenderers.pbrRendererWithSAO.drawLayer(t,this,Ya):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._instancingRenderers.colorTextureRendererWithSAO&&this._instancingRenderers.colorTextureRendererWithSAO.drawLayer(t,this,Ya):s.normalsBuf?this._instancingRenderers.colorRendererWithSAO&&this._instancingRenderers.colorRendererWithSAO.drawLayer(t,this,Ya):this._instancingRenderers.flatColorRendererWithSAO&&this._instancingRenderers.flatColorRendererWithSAO.drawLayer(t,this,Ya):t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._instancingRenderers.pbrRenderer&&this._instancingRenderers.pbrRenderer.drawLayer(t,this,Ya):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._instancingRenderers.colorTextureRenderer&&this._instancingRenderers.colorTextureRenderer.drawLayer(t,this,Ya):s.normalsBuf?this._instancingRenderers.colorRenderer&&this._instancingRenderers.colorRenderer.drawLayer(t,this,Ya):this._instancingRenderers.flatColorRenderer&&this._instancingRenderers.flatColorRenderer.drawLayer(t,this,Ya)}_updateBackfaceCull(e,t){const s=this.model.backfaces||!this.solid||e.sectioned;if(t.backfaces!==s){const e=t.gl;s?e.disable(e.CULL_FACE):e.enable(e.CULL_FACE),t.backfaces=s}}drawColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),t.pbrEnabled&&this.model.pbrEnabled&&this._state.pbrSupported?this._instancingRenderers.pbrRenderer&&this._instancingRenderers.pbrRenderer.drawLayer(t,this,Ka):t.colorTextureEnabled&&this.model.colorTextureEnabled&&this._state.colorTextureSupported?this._instancingRenderers.colorTextureRenderer&&this._instancingRenderers.colorTextureRenderer.drawLayer(t,this,Ka):this._state.normalsBuf?this._instancingRenderers.colorRenderer&&this._instancingRenderers.colorRenderer.drawLayer(t,this,Ka):this._instancingRenderers.flatColorRenderer&&this._instancingRenderers.flatColorRenderer.drawLayer(t,this,Ka))}drawDepth(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.depthRenderer&&this._instancingRenderers.depthRenderer.drawLayer(t,this,Ya))}drawNormals(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.normalsRenderer&&this._instancingRenderers.normalsRenderer.drawLayer(t,this,Ya))}drawSilhouetteXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.silhouetteRenderer&&this._instancingRenderers.silhouetteRenderer.drawLayer(t,this,Qa))}drawSilhouetteHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.silhouetteRenderer&&this._instancingRenderers.silhouetteRenderer.drawLayer(t,this,Ja))}drawSilhouetteSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.silhouetteRenderer&&this._instancingRenderers.silhouetteRenderer.drawLayer(t,this,Za))}drawEdgesColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&this._instancingRenderers.edgesColorRenderer&&this._instancingRenderers.edgesColorRenderer.drawLayer(t,this,qa)}drawEdgesColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&this._instancingRenderers.edgesColorRenderer&&this._instancingRenderers.edgesColorRenderer.drawLayer(t,this,$a)}drawEdgesXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._instancingRenderers.edgesRenderer&&this._instancingRenderers.edgesRenderer.drawLayer(t,this,sh)}drawEdgesHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._instancingRenderers.edgesRenderer&&this._instancingRenderers.edgesRenderer.drawLayer(t,this,eh)}drawEdgesSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._instancingRenderers.edgesRenderer&&this._instancingRenderers.edgesRenderer.drawLayer(t,this,th)}drawOcclusion(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.occlusionRenderer&&this._instancingRenderers.occlusionRenderer.drawLayer(t,this,Ya))}drawShadow(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.shadowRenderer&&this._instancingRenderers.shadowRenderer.drawLayer(t,this,Ya))}drawPickMesh(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.pickMeshRenderer&&this._instancingRenderers.pickMeshRenderer.drawLayer(t,this,ih))}drawPickDepths(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.pickDepthRenderer&&this._instancingRenderers.pickDepthRenderer.drawLayer(t,this,ih))}drawPickNormals(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(e,t),this._instancingRenderers.pickNormalsRenderer&&this._instancingRenderers.pickNormalsRenderer.drawLayer(t,this,ih))}precisionRayPickSurface(e,t,s,i,r){if(!this.model.scene.pickSurfacePrecisionEnabled)return!1;const o=this._state.geometry,n=this._state,a=this._portions[e];if(!a)return this.model.error("portion not found: "+e),!1;a.inverseMatrix||(a.inverseMatrix=p.inverseMat4(a.matrix,p.mat4())),r&&!a.normalMatrix&&(a.normalMatrix=p.transposeMat4(a.inverseMatrix,p.mat4()));const h=o.quantizedPositions,l=o.indices,u=n.origin,c=a.offset,d=$l,m=eu;d.set(u?p.subVec3(t,u,tu):t),m.set(s),c&&p.subVec3(d,c),p.transformRay(this.model.worldNormalMatrix,d,m,d,m),p.transformRay(a.inverseMatrix,d,m,d,m);const f=su,g=iu,_=ru;let y=!1,v=0;const b=ou;for(let e=0,s=l.length;e<s;e+=3){const s=3*l[e+0],o=3*l[e+1],x=3*l[e+2];if(f[0]=h[s],f[1]=h[s+1],f[2]=h[s+2],g[0]=h[o],g[1]=h[o+1],g[2]=h[o+2],_[0]=h[x],_[1]=h[x+1],_[2]=h[x+2],p.decompressPosition(f,n.positionsDecodeMatrix),p.decompressPosition(g,n.positionsDecodeMatrix),p.decompressPosition(_,n.positionsDecodeMatrix),p.rayTriangleIntersect(d,m,f,g,_,b)){p.transformPoint3(a.matrix,b,b),p.transformPoint3(this.model.worldMatrix,b,b),c&&p.addVec3(b,c),u&&p.addVec3(b,u);const e=Math.abs(p.lenVec3(p.subVec3(b,t,[])));(!y||e>v)&&(v=e,i.set(b),r&&p.triangleNormal(f,g,_,r),y=!0)}}return y&&r&&(p.transformVec3(a.normalMatrix,r,r),p.transformVec3(this.model.worldNormalMatrix,r,r),p.normalizeVec3(r)),y}destroy(){const e=this._state;e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.metallicRoughnessBuf&&(e.metallicRoughnessBuf.destroy(),e.metallicRoughnessBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.modelMatrixCol0Buf&&(e.modelMatrixCol0Buf.destroy(),e.modelMatrixCol0Buf=null),e.modelMatrixCol1Buf&&(e.modelMatrixCol1Buf.destroy(),e.modelMatrixCol1Buf=null),e.modelMatrixCol2Buf&&(e.modelMatrixCol2Buf.destroy(),e.modelMatrixCol2Buf=null),e.modelNormalMatrixCol0Buf&&(e.modelNormalMatrixCol0Buf.destroy(),e.modelNormalMatrixCol0Buf=null),e.modelNormalMatrixCol1Buf&&(e.modelNormalMatrixCol1Buf.destroy(),e.modelNormalMatrixCol1Buf=null),e.modelNormalMatrixCol2Buf&&(e.modelNormalMatrixCol2Buf.destroy(),e.modelNormalMatrixCol2Buf=null),e.pickColorsBuf&&(e.pickColorsBuf.destroy(),e.pickColorsBuf=null),e.destroy()}}const au=p.vec3();class hu{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=this._scene,r=i.camera,o=t.model,n=i.canvas.gl,a=t._state,h=t._state.origin;if(t.geometry,!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(r.viewMatrix,h):r.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix),n.lineWidth(i.linesMaterial.lineWidth);const l=i._sectionPlanesState.sectionPlanes.length;if(l>0){const e=i._sectionPlanesState.sectionPlanes,s=t.layerIndex*l,r=o.renderFlags;for(let t=0;t<l;t++){const i=this._uSectionPlanes[t];if(i){const o=r.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,o?1:0),o){const s=e[t];if(h){const e=X(s.dist,s.dir,h,au);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),a.indicesBuf.bind(),n.drawElements(n.LINES,a.indicesBuf.numItems,a.indicesBuf.itemType,0),e.drawElements++}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene,s=t.canvas.gl,i=this._program,r=t.camera.project;if(i.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),t.logarithmicDepthBufferEnabled){const e=2/(Math.log(r.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Lines batching color vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),s.push("in vec4 color;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Lines batching color fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return i.push("   outColor            = vColor;"),e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const lu=new Float32Array([1,1,1]),uu=p.vec3();class cu{constructor(e,t){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin;if(t.geometry,!this._program&&(this._allocate(),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===Qa){const e=r.xrayMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===Ja){const e=r.highlightMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===Za){const e=r.selectedMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else n.uniform4fv(this._uColor,lu);const l=h?U(o.viewMatrix,h):o.viewMatrix;n.uniformMatrix4fv(this._uViewMatrix,!1,l),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.lineWidth(r.linesMaterial.lineWidth);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,o=i.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,uu);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),n.drawElements(n.LINES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uColor=s.getLocation("color"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Lines batching silhouette vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform vec4 color;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.y) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Lines batching silhouette fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("uniform vec4 color;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("outColor = color;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class pu{constructor(e){this._scene=e}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new hu(this._scene,!1)),this._colorRenderer}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new cu(this._scene)),this._silhouetteRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy()}}const du={};class mu{constructor(e=5e6){e>5e6&&(e=5e6),this.maxVerts=e,this.maxIndices=3*e,this.positions=[],this.colors=[],this.flags=[],this.flags2=[],this.offsets=[],this.indices=[]}}const fu=p.vec4([0,0,0,1]),gu=p.vec4([0,0,0,1]),_u=p.vec4([0,0,0,1]),yu=p.OBB3();class vu{constructor(e){this.layerIndex=e.layerIndex,this._batchingRenderers=function(e){const t=e.id;let s=du[t];return s||(s=new pu(e),du[t]=s,s._compile(),e.on("compile",(()=>{s._compile()})),e.on("destroyed",(()=>{delete du[t],s._destroy()}))),s}(e.model.scene),this.model=e.model,this._buffer=new mu(e.maxGeometryBatchSize),this._scratchMemory=e.scratchMemory,this._state=new ft({positionsBuf:null,offsetsBuf:null,colorsBuf:null,flagsBuf:null,flags2Buf:null,indicesBuf:null,positionsDecodeMatrix:p.mat4(),origin:null}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numSelectedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._modelAABB=p.collapseAABB3(),this._portions=[],this._numVerts=0,this._finalized=!1,e.positionsDecodeMatrix?(this._state.positionsDecodeMatrix.set(e.positionsDecodeMatrix),this._preCompressedPositionsExpected=!0):this._preCompressedPositionsExpected=!1,e.origin&&(this._state.origin=p.vec3(e.origin)),this.aabb=p.collapseAABB3()}canCreatePortion(e,t){if(this._finalized)throw"Already finalized";return this._buffer.positions.length+e<3*this._buffer.maxVerts&&this._buffer.indices.length+t<this._buffer.maxIndices}createPortion(e){if(this._finalized)throw"Already finalized";const t=e.positions,s=e.positionsCompressed,i=e.indices,r=e.color,o=e.opacity,n=e.meshMatrix,a=e.worldMatrix,h=e.worldAABB;e.pickColor;const l=this._buffer,u=l.positions.length/3;let c;if(this._preCompressedPositionsExpected){if(!s)throw"positionsCompressed expected";c=s.length/3;for(let e=0,t=s.length;e<t;e++)l.positions.push(s[e]);const e=Pt.getPositionsBounds(s),t=Pt.decompressPosition(e.min,this._state.positionsDecodeMatrix,[]),i=Pt.decompressPosition(e.max,this._state.positionsDecodeMatrix,[]);h[0]=t[0],h[1]=t[1],h[2]=t[2],h[3]=i[0],h[4]=i[1],h[5]=i[2],a&&(p.AABB3ToOBB3(h,yu),p.transformOBB3(a,yu),p.OBB3ToAABB3(yu,h))}else{if(!t)throw"positions expected";c=t.length/3;const e=t.length,s=l.positions.length;for(let e=0,s=t.length;e<s;e++)l.positions.push(t[e]);if(n)for(let t=s,i=s+e;t<i;t+=3)fu[0]=l.positions[t+0],fu[1]=l.positions[t+1],fu[2]=l.positions[t+2],p.transformPoint4(n,fu,gu),l.positions[t+0]=gu[0],l.positions[t+1]=gu[1],l.positions[t+2]=gu[2],p.expandAABB3Point3(this._modelAABB,gu),a?(p.transformPoint4(a,gu,_u),p.expandAABB3Point3(h,_u)):p.expandAABB3Point3(h,gu);else for(let t=s,i=s+e;t<i;t+=3)fu[0]=l.positions[t+0],fu[1]=l.positions[t+1],fu[2]=l.positions[t+2],p.expandAABB3Point3(this._modelAABB,fu),a?(p.transformPoint4(a,fu,gu),p.expandAABB3Point3(h,gu)):p.expandAABB3Point3(h,fu)}if(this._state.origin){const e=this._state.origin;h[0]+=e[0],h[1]+=e[1],h[2]+=e[2],h[3]+=e[0],h[4]+=e[1],h[5]+=e[2]}if(p.expandAABB3(this.aabb,h),r){const e=r[0],t=r[1],s=r[2],i=o;for(let r=0;r<c;r++)l.colors.push(e),l.colors.push(t),l.colors.push(s),l.colors.push(i)}if(i)for(let e=0,t=i.length;e<t;e++)l.indices.push(i[e]+u);if(this.model.scene.entityOffsetsEnabled)for(let e=0;e<c;e++)l.offsets.push(0),l.offsets.push(0),l.offsets.push(0);const d=this._portions.length/2;return this._portions.push(u),this._portions.push(c),this._numPortions++,this.model.numPortions++,this._numVerts+=c,d}finalize(){if(this._finalized)return void this.model.error("Already finalized");const e=this._state,t=this.model.scene.canvas.gl,s=this._buffer;if(s.positions.length>0)if(this._preCompressedPositionsExpected){const i=new Uint16Array(s.positions);e.positionsBuf=new we(t,t.ARRAY_BUFFER,i,s.positions.length,3,t.STATIC_DRAW)}else{const i=Wh(new Float32Array(s.positions),this._modelAABB,e.positionsDecodeMatrix);e.positionsBuf=new we(t,t.ARRAY_BUFFER,i,s.positions.length,3,t.STATIC_DRAW)}if(s.colors.length>0){const i=new Uint8Array(s.colors);let r=!1;e.colorsBuf=new we(t,t.ARRAY_BUFFER,i,s.colors.length,4,t.DYNAMIC_DRAW,r)}if(s.colors.length>0){const i=s.colors.length,r=new Uint8Array(i),o=new Uint8Array(i);let n=!1,a=!0;e.flagsBuf=new we(t,t.ARRAY_BUFFER,r,r.length,4,t.DYNAMIC_DRAW,n),e.flags2Buf=new we(t,t.ARRAY_BUFFER,o,o.length,4,t.DYNAMIC_DRAW,a)}if(this.model.scene.entityOffsetsEnabled&&s.offsets.length>0){const i=new Float32Array(s.offsets);e.offsetsBuf=new we(t,t.ARRAY_BUFFER,i,s.offsets.length,3,t.DYNAMIC_DRAW)}if(s.indices.length>0){const i=new Uint32Array(s.indices);e.indicesBuf=new we(t,t.ELEMENT_ARRAY_BUFFER,i,s.indices.length,1,t.STATIC_DRAW)}this._buffer=null,this._finalized=!0}initFlags(e,t,s){t&E&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&L&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&B&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&N&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&S&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&k&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&R&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&F&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),s&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++);this._setFlags(e,t,s,true),this._setFlags2(e,t,true)}flushInitFlags(){this._setDeferredFlags(),this._setDeferredFlags2()}setVisible(e,t,s){if(!this._finalized)throw"Not finalized";t&E?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,s)}setHighlighted(e,t,s){if(!this._finalized)throw"Not finalized";t&L?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,s)}setXRayed(e,t,s){if(!this._finalized)throw"Not finalized";t&B?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,s)}setSelected(e,t,s){if(!this._finalized)throw"Not finalized";t&N?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,s)}setEdges(e,t,s){if(!this._finalized)throw"Not finalized";t&k?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,s)}setClippable(e,t){if(!this._finalized)throw"Not finalized";t&S?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}setCulled(e,t,s){if(!this._finalized)throw"Not finalized";t&F?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,s)}setCollidable(e,t){if(!this._finalized)throw"Not finalized"}setPickable(e,t,s){if(!this._finalized)throw"Not finalized";t&R?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(e,t,s)}setColor(e,t){if(!this._finalized)throw"Not finalized";const s=2*e,i=4*this._portions[s],r=4*this._portions[s+1],o=this._scratchMemory.getUInt8Array(r),n=t[0],a=t[1],h=t[2],l=t[3];for(let e=0;e<r;e+=4)o[e+0]=n,o[e+1]=a,o[e+2]=h,o[e+3]=l;this._state.colorsBuf.setData(o,i,r)}setTransparent(e,t,s){s?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,s)}_setFlags(e,t,s,i=!1){if(!this._finalized)throw"Not finalized";const r=2*e,o=4*this._portions[r],n=4*this._portions[r+1];this._scratchMemory.getUInt8Array(n);const a=!!(t&E),h=!!(t&B),l=!!(t&L),u=!!(t&N),c=!!(t&R),p=!!(t&F);let d,m;d=!a||p||h||l&&!this.model.scene.highlightMaterial.glowThrough||u&&!this.model.scene.selectedMaterial.glowThrough?Xa:s?Ka:Ya,m=!a||p?Xa:u?Za:l?Ja:h?Qa:Xa;let f=a&&!p&&c?ih:Xa;if(i){this._deferredFlagValues||(this._deferredFlagValues=new Uint8Array(4*this._numVerts));for(let e=o,t=o+n;e<t;e+=4)this._deferredFlagValues[e+0]=d,this._deferredFlagValues[e+1]=m,this._deferredFlagValues[e+2]=0,this._deferredFlagValues[e+3]=f}else if(this._state.flagsBuf){const e=this._scratchMemory.getUInt8Array(n);for(let t=0;t<n;t+=4)e[t+0]=d,e[t+1]=m,e[t+2]=0,e[t+3]=f;this._state.flagsBuf.setData(e,o,n)}}_setDeferredFlags(){this._deferredFlagValues&&(this._state.flagsBuf.setData(this._deferredFlagValues),this._deferredFlagValues=null)}_setFlags2(e,t,s=!1){if(!this._finalized)throw"Not finalized";const i=2*e,r=4*this._portions[i],o=4*this._portions[i+1],n=t&S?255:0;if(s){this._setDeferredFlag2Values||(this._setDeferredFlag2Values=new Uint8Array(4*this._numVerts));for(let e=r,t=r+o;e<t;e+=4)this._setDeferredFlag2Values[e]=n}else{const e=this._scratchMemory.getUInt8Array(o);for(let t=0;t<o;t+=4)e[t+0]=n;this._state.flags2Buf.setData(e,r,o)}}_setDeferredFlags2(){this._setDeferredFlag2Values&&(this._state.flags2Buf.setData(this._setDeferredFlag2Values),this._setDeferredFlag2Values=null)}setOffset(e,t){if(!this._finalized)throw"Not finalized";if(!this.model.scene.entityOffsetsEnabled)return void this.model.error("Entity#offset not enabled for this Viewer");const s=2*e,i=3*this._portions[s],r=3*this._portions[s+1],o=this._scratchMemory.getFloat32Array(r),n=t[0],a=t[1],h=t[2];for(let e=0;e<r;e+=3)o[e+0]=n,o[e+1]=a,o[e+2]=h;this._state.offsetsBuf.setData(o,i,r)}drawColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(t,this,Ya)}drawColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(t,this,Ka)}drawDepth(e,t){}drawNormals(e,t){}drawSilhouetteXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,Qa)}drawSilhouetteHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,Ja)}drawSilhouetteSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(t,this,Za)}drawEdgesColorOpaque(e,t){}drawEdgesColorTransparent(e,t){}drawEdgesHighlighted(e,t){}drawEdgesSelected(e,t){}drawEdgesXRayed(e,t){}drawPickMesh(e){}drawPickDepths(e){}drawPickNormals(e){}drawOcclusion(e){}drawShadow(e){}destroy(){const e=this._state;e.positionsBuf&&(e.positionsBuf.destroy(),e.positionsBuf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.indicesBuf&&(e.indicesBuf.destroy(),e.indicesBuf=null),e.destroy()}}const bu=p.vec3();class xu{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin,l=t.geometry;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.lineWidth(r.linesMaterial.lineWidth);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,o=i.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,bu);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(l.positionsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),n.vertexAttribDivisor(this._aColor.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),l.indicesBuf.bind(),n.drawElementsInstanced(n.LINES,l.indicesBuf.numItems,l.indicesBuf.itemType,0,a.numInstances),e.drawElements++,n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aColor.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aOffset=s.getAttribute("offset"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Lines instancing color vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),s.push("in vec4 color;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),s.push("uniform vec4 lightAmbient;"),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("out vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0,  float(color.a) / 255.0);"),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState;let s,i;const r=t.sectionPlanes.length>0,o=[];if(o.push("#version 300 es"),o.push("// Lines instancing color fragment shader"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),e.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),o.push("in float vFragDepth;")),r)for(o.push("in vec4 vWorldPosition;"),o.push("in vec4 vFlags2;"),s=0,i=t.sectionPlanes.length;s<i;s++)o.push("uniform bool sectionPlaneActive"+s+";"),o.push("uniform vec3 sectionPlanePos"+s+";"),o.push("uniform vec3 sectionPlaneDir"+s+";");if(o.push("in vec4 vColor;"),o.push("out vec4 outColor;"),o.push("void main(void) {"),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),s=0,i=t.sectionPlanes.length;s<i;s++)o.push("if (sectionPlaneActive"+s+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+s+".xyz, vWorldPosition.xyz - sectionPlanePos"+s+".xyz), 0.0, 1000.0);"),o.push("}");o.push("if (dist > 0.0) { discard; }"),o.push("}")}return this._withSAO?(o.push("   float viewportWidth     = uSAOParams[0];"),o.push("   float viewportHeight    = uSAOParams[1];"),o.push("   float blendCutoff       = uSAOParams[2];"),o.push("   float blendFactor       = uSAOParams[3];"),o.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),o.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBAToDepth(texture(uOcclusionTexture, uv))) * blendFactor;"),o.push("   outColor            = vec4(vColor.rgb * ambient, vColor.a);")):o.push("    outColor           = vColor;"),e.logarithmicDepthBufferEnabled&&o.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Pu=p.vec3();class Tu{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin,l=t.geometry;if(!this._program&&(this._allocate(t.model.scene),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===Qa){const e=r.xrayMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===Ja){const e=r.highlightMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===Za){const e=r.selectedMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else n.uniform4fv(this._uColor,p.vec3([1,1,1]));n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.lineWidth(r.linesMaterial.lineWidth);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,o=i.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,Pu);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf,n.UNSIGNED_BYTE,!0),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,n.UNSIGNED_BYTE,!0),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),l.indicesBuf.bind(),n.drawElementsInstanced(n.LINES,l.indicesBuf.numItems,l.indicesBuf.itemType,0,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uColor=i.getLocation("color"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Lines instancing silhouette vertex shader"),s.push("uniform int renderPass;"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),s.push("out float vFragDepth;")),s.push("uniform vec4 color;"),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.y) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&s.push("vFragDepth = 1.0 + clipPos.w;"),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Lines instancing silhouette fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("uniform vec4 color;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("outColor = color;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class wu{constructor(e){this._scene=e}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new xu(this._scene)),this._colorRenderer}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new Tu(this._scene)),this._silhouetteRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy()}}const Mu={};const Iu=new Uint8Array(4),Cu=p.vec4([0,0,0,1]),Du=p.vec4([0,0,0,1]),Au=p.vec4([0,0,0,1]),Eu=new Float32Array(3);class Fu{constructor(e){this.model=e.model,this.geometry=e.geometry,this.material=e.material,this.sortId="LinesInstancingLayer",this.layerIndex=e.layerIndex,this._linesInstancingRenderers=function(e){const t=e.id;let s=Mu[t];return s||(s=new wu(e),Mu[t]=s,s._compile(),e.on("compile",(()=>{s._compile()})),e.on("destroyed",(()=>{delete Mu[t],s._destroy()}))),s}(e.model.scene),this._aabb=p.collapseAABB3(),this._state=new ft({obb:p.OBB3(),numInstances:0,origin:null}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numSelectedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this.numIndices=e.geometry.numIndices,this._colors=[],this._offsets=[],this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._portions=[],e.origin&&(this._state.origin=p.vec3(e.origin)),this._finalized=!1,this.aabb=p.collapseAABB3()}createPortion(e){const t=e.color,s=e.opacity,i=e.meshMatrix,r=e.worldMatrix,o=e.aabb;if(this._finalized)throw"Already finalized";const n=t[0],a=t[1],h=t[2];t[3],this._colors.push(n),this._colors.push(a),this._colors.push(h),this._colors.push(s),this.model.scene.entityOffsetsEnabled&&(this._offsets.push(0),this._offsets.push(0),this._offsets.push(0)),this._modelMatrixCol0.push(i[0]),this._modelMatrixCol0.push(i[4]),this._modelMatrixCol0.push(i[8]),this._modelMatrixCol0.push(i[12]),this._modelMatrixCol1.push(i[1]),this._modelMatrixCol1.push(i[5]),this._modelMatrixCol1.push(i[9]),this._modelMatrixCol1.push(i[13]),this._modelMatrixCol2.push(i[2]),this._modelMatrixCol2.push(i[6]),this._modelMatrixCol2.push(i[10]),this._modelMatrixCol2.push(i[14]),p.collapseAABB3(o);const l=this._state.obb,u=l.length;for(let e=0;e<u;e+=4)Cu[0]=l[e+0],Cu[1]=l[e+1],Cu[2]=l[e+2],p.transformPoint4(i,Cu,Du),r?(p.transformPoint4(r,Du,Au),p.expandAABB3Point3(o,Au)):p.expandAABB3Point3(o,Du);if(this._state.origin){const e=this._state.origin;o[0]+=e[0],o[1]+=e[1],o[2]+=e[2],o[3]+=e[0],o[4]+=e[1],o[5]+=e[2]}p.expandAABB3(this.aabb,o),this._state.numInstances++;const c=this._portions.length;return this._portions.push({}),this._numPortions++,this.model.numPortions++,c}finalize(){if(this._finalized)throw"Already finalized";const e=this.model.scene.canvas.gl,t=this._colors.length,s=t;if(t>0){let t=!1;this._state.colorsBuf=new we(e,e.ARRAY_BUFFER,new Uint8Array(this._colors),this._colors.length,4,e.DYNAMIC_DRAW,t),this._colors=[]}if(s>0){let t=!1,i=!0;this._state.flagsBuf=new we(e,e.ARRAY_BUFFER,new Uint8Array(s),s,4,e.DYNAMIC_DRAW,t),this._state.flags2Buf=new we(e,e.ARRAY_BUFFER,new Uint8Array(s),s,4,e.DYNAMIC_DRAW,i)}if(this.model.scene.entityOffsetsEnabled&&this._offsets.length>0){const t=!1;this._state.offsetsBuf=new we(e,e.ARRAY_BUFFER,new Float32Array(this._offsets),this._offsets.length,3,e.DYNAMIC_DRAW,t),this._offsets=[]}if(this._modelMatrixCol0.length>0){const t=!1;this._state.modelMatrixCol0Buf=new we(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol0),this._modelMatrixCol0.length,4,e.STATIC_DRAW,t),this._state.modelMatrixCol1Buf=new we(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol1),this._modelMatrixCol1.length,4,e.STATIC_DRAW,t),this._state.modelMatrixCol2Buf=new we(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol2),this._modelMatrixCol2.length,4,e.STATIC_DRAW,t),this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[]}this._finalized=!0}initFlags(e,t,s){t&E&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&L&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&B&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&N&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&S&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&k&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&R&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&F&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),s&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(e,t,s),this._setFlags2(e,t)}setVisible(e,t,s){if(!this._finalized)throw"Not finalized";t&E?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,s)}setHighlighted(e,t,s){if(!this._finalized)throw"Not finalized";t&L?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,s)}setXRayed(e,t,s){if(!this._finalized)throw"Not finalized";t&B?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,s)}setSelected(e,t,s){if(!this._finalized)throw"Not finalized";t&N?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,s)}setEdges(e,t,s){if(!this._finalized)throw"Not finalized";t&k?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,s)}setClippable(e,t){if(!this._finalized)throw"Not finalized";t&S?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}setCollidable(e,t){if(!this._finalized)throw"Not finalized"}setPickable(e,t,s){if(!this._finalized)throw"Not finalized";t&R?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags2(e,t,s)}setCulled(e,t,s){if(!this._finalized)throw"Not finalized";t&F?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,s)}setColor(e,t){if(!this._finalized)throw"Not finalized";Iu[0]=t[0],Iu[1]=t[1],Iu[2]=t[2],Iu[3]=t[3],this._state.colorsBuf.setData(Iu,4*e,4)}setTransparent(e,t,s){s?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,s)}_setFlags(e,t,s){if(!this._finalized)throw"Not finalized";const i=!!(t&E),r=!!(t&B),o=!!(t&L),n=!!(t&N),a=!!(t&k),h=!!(t&R),l=!!(t&F);let u,c;u=!i||l||r||o&&!this.model.scene.highlightMaterial.glowThrough||n&&!this.model.scene.selectedMaterial.glowThrough?Xa:s?Ka:Ya,c=!i||l?Xa:n?Za:o?Ja:r?Qa:Xa;let p=0;p=!i||l?Xa:n?th:o?eh:r?sh:a?s?$a:qa:Xa;let d=i&&!l&&h?ih:Xa;Iu[0]=u,Iu[1]=c,Iu[2]=p,Iu[3]=d,this._state.flagsBuf.setData(Iu,4*e,4)}_setFlags2(e,t){if(!this._finalized)throw"Not finalized";const s=t&S?255:0;Iu[0]=s,this._state.flags2Buf.setData(Iu,4*e,4)}setOffset(e,t){if(!this._finalized)throw"Not finalized";this.model.scene.entityOffsetsEnabled?(Eu[0]=t[0],Eu[1]=t[1],Eu[2]=t[2],this._state.offsetsBuf.setData(Eu,3*e,3)):this.model.error("Entity#offset not enabled for this Viewer")}drawColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._linesInstancingRenderers.colorRenderer&&this._linesInstancingRenderers.colorRenderer.drawLayer(t,this,Ya)}drawColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._linesInstancingRenderers.colorRenderer&&this._linesInstancingRenderers.colorRenderer.drawLayer(t,this,Ka)}drawDepth(e,t){}drawNormals(e,t){}drawSilhouetteXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._linesInstancingRenderers.silhouetteRenderer&&this._linesInstancingRenderers.silhouetteRenderer.drawLayer(t,this,Qa)}drawSilhouetteHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._linesInstancingRenderers.silhouetteRenderer&&this._linesInstancingRenderers.silhouetteRenderer.drawLayer(t,this,Ja)}drawSilhouetteSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._linesInstancingRenderers.silhouetteRenderer&&this._linesInstancingRenderers.silhouetteRenderer.drawLayer(t,this,Za)}drawEdgesColorOpaque(e,t){}drawEdgesColorTransparent(e,t){}drawEdgesXRayed(e,t){}drawEdgesHighlighted(e,t){}drawEdgesSelected(e,t){}drawOcclusion(e,t){}drawShadow(e,t){}drawPickMesh(e,t){}drawPickDepths(e,t){}drawPickNormals(e,t){}destroy(){const e=this._state;e.positionsBuf&&(e.positionsBuf.destroy(),e.positionsBuf=null),e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.modelMatrixCol0Buf&&(e.modelMatrixCol0Buf.destroy(),e.modelMatrixCol0Buf=null),e.modelMatrixCol1Buf&&(e.modelMatrixCol1Buf.destroy(),e.modelMatrixCol1Buf=null),e.modelMatrixCol2Buf&&(e.modelMatrixCol2Buf.destroy(),e.modelMatrixCol2Buf=null),e.destroy()}}const Ru=p.vec3();class Su{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,s){const i=this._scene,r=i.camera,o=t.model,n=i.canvas.gl,a=t._state,h=t._state.origin,l=i.pointsMaterial;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(r.viewMatrix,h):r.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix);const u=i._sectionPlanesState.sectionPlanes.length;if(u>0){const e=i._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,r=o.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t];if(i){const o=r.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,o?1:0),o){const s=e[t];if(h){const e=X(s.dist,s.dir,h,Ru);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),l.filterIntensity&&n.uniform2f(this._uIntensityRange,l.minIntensity,l.maxIntensity),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),n.uniform1f(this._uPointSize,l.pointSize);const c="ortho"===i.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*i.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,c),n.drawArrays(n.POINTS,0,a.positionsBuf.numItems),e.drawArrays++}_allocate(){const e=this._scene,t=e.pointsMaterial._state,s=e.canvas.gl;if(this._program=new Te(s,this._buildShader(e)),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),t.filterIntensity&&(this._uIntensityRange=i.getLocation("intensityRange")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=this._program,i=e.camera.project;if(s.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(i.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=e.pointsMaterial,i=[];return i.push("#version 300 es"),i.push("// Points batching color vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),i.push("in vec4 color;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),s.filterIntensity&&i.push("uniform vec2 intensityRange;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),s.filterIntensity&&(i.push("float intensity = float(color.a) / 255.0;"),i.push("if (intensity < intensityRange[0] || intensity > intensityRange[1]) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {")),i.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, 1.0);"),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),s.filterIntensity&&i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Points batching color fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),e.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return i.push("   outColor = vColor;"),e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Ou=new Float32Array([1,1,1]),Bu=p.vec3();class Lu{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin,l=r.pointsMaterial._state;if(!this._program&&(this._allocate(),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===Qa){const e=r.xrayMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===Ja){const e=r.highlightMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===Za){const e=r.selectedMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else n.uniform4fv(this._uColor,Ou);const u=h?U(o.viewMatrix,h):o.viewMatrix;n.uniformMatrix4fv(this._uViewMatrix,!1,u),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*c,o=i.renderFlags;for(let t=0;t<c;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,Bu);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),n.uniform1f(this._uPointSize,l.pointSize);const p="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,p),n.drawArrays(n.POINTS,0,a.positionsBuf.numItems)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uColor=s.getLocation("color"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=e.pointsMaterial._state,i=[];return i.push("#version 300 es"),i.push("// Points batching silhouette vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform vec4 color;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.y) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState;let s,i;const r=t.sectionPlanes.length>0,o=[];if(o.push("#version 300 es"),o.push("// Points batching silhouette vertex shader"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),e.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),o.push("in float vFragDepth;")),r)for(o.push("in vec4 vWorldPosition;"),o.push("in vec4 vFlags2;"),s=0,i=t.sectionPlanes.length;s<i;s++)o.push("uniform bool sectionPlaneActive"+s+";"),o.push("uniform vec3 sectionPlanePos"+s+";"),o.push("uniform vec3 sectionPlaneDir"+s+";");if(o.push("uniform vec4 color;"),o.push("out vec4 outColor;"),o.push("void main(void) {"),e.pointsMaterial.roundPoints&&(o.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),o.push("  float r = dot(cxy, cxy);"),o.push("  if (r > 1.0) {"),o.push("       discard;"),o.push("  }")),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),s=0,i=t.sectionPlanes.length;s<i;s++)o.push("if (sectionPlaneActive"+s+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+s+".xyz, vWorldPosition.xyz - sectionPlanePos"+s+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { discard; }"),o.push("}")}return e.logarithmicDepthBufferEnabled&&o.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("outColor = color;"),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Nu=p.vec3();class ku{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin,l=r.pointsMaterial._state;this._program||this._allocate(t),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=e.pickViewMatrix||o.viewMatrix,c=h?U(u,h):u;if(n.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),n.uniformMatrix4fv(this._uViewMatrix,!1,c),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,e)}const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*p,o=i.renderFlags;for(let t=0;t<p;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,Nu);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aPickColor&&this._aPickColor.bindArrayBuffer(a.pickColorsBuf),n.uniform1f(this._uPointSize,l.pointSize);const d="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,d),n.drawArrays(n.POINTS,0,a.positionsBuf.numItems)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aPickColor=s.getAttribute("pickColor"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene.canvas.gl;this._program.bind(),t.uniform1i(this._uPickInvisible,e.pickInvisible)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=e.pointsMaterial._state,i=[];return i.push("#version 300 es"),i.push("// Points batching pick mesh vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 pickColor;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vPickColor;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("      vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("gl_PointSize += 10.0;"),i.push("  }"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Points batching pick mesh vertex shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("uniform bool sectionPlaneActive"+r+";"),i.push("uniform vec3 sectionPlanePos"+r+";"),i.push("uniform vec3 sectionPlaneDir"+r+";")}if(i.push("in vec4 vPickColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),e.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(r=0;r<t.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("   outColor = vPickColor; "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const ju=p.vec3();class Gu{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin,l=r.pointsMaterial._state;this._program||this._allocate(),e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniform1i(this._uPickInvisible,e.pickInvisible);const u=e.pickViewMatrix||o.viewMatrix,c=h?U(u,h):u;if(n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uViewMatrix,!1,c),n.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),n.uniform1f(this._uPickZNear,e.pickZNear),n.uniform1f(this._uPickZFar,e.pickZFar),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(e.pickZFar+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,t)}const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*p,o=i.renderFlags;for(let t=0;t<p;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,ju);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),n.uniform1f(this._uPointSize,l.pointSize);const d="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,d),n.drawArrays(n.POINTS,0,a.positionsBuf.numItems)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uPickZNear=s.getLocation("pickZNear"),this._uPickZFar=s.getLocation("pickZFar"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=e.pointsMaterial._state,i=[];return i.push("#version 300 es"),i.push("// Points batched pick depth vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vViewPosition;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vViewPosition = viewPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("gl_PointSize += 10.0;"),i.push("  }"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Points batched pick depth fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),i.push("uniform float pickZNear;"),i.push("uniform float pickZFar;"),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vViewPosition;"),i.push("vec4 packDepth(const in float depth) {"),i.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),i.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),i.push("  vec4 res = fract(depth * bitShift);"),i.push("  res -= res.xxyz * bitMask;"),i.push("  return res;"),i.push("}"),i.push("out vec4 outColor;"),i.push("void main(void) {"),e.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(var r=0;r<t.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),i.push("    outColor = packDepth(zNormalizedDepth); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Hu=p.vec3();class Vu{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.canvas.gl,n=t._state,a=r.camera,h=t._state.origin,l=r.pointsMaterial._state;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,s),o.uniformMatrix4fv(this._uViewMatrix,!1,h?U(a.viewMatrix,h):a.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*u,n=i.renderFlags;for(let t=0;t<u;t++){const i=this._uSectionPlanes[t];if(i){const r=n.sectionPlanesActivePerLayer[s+t];if(o.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,Hu);o.uniform3fv(i.pos,e)}else o.uniform3fv(i.pos,s.pos);o.uniform3fv(i.dir,s.dir)}}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,t._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),o.uniform1f(this._uPointSize,l.pointSize);const c="ortho"===r.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,c),o.drawArrays(o.POINTS,0,n.positionsBuf.numItems)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=e.pointsMaterial._state,i=[];return i.push("#version 300 es"),i.push("// Points batching occlusion vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("  gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("  }"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Points batching occlusion fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("out vec4 outColor;"),i.push("void main(void) {"),e.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("      if (sectionPlaneActive"+e+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("   outColor = vec4(0.0, 0.0, 1.0, 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class Uu{constructor(e){this._scene=e}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new Su(this._scene)),this._colorRenderer}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new Lu(this._scene)),this._silhouetteRenderer}get pickMeshRenderer(){return this._pickMeshRenderer||(this._pickMeshRenderer=new ku(this._scene)),this._pickMeshRenderer}get pickDepthRenderer(){return this._pickDepthRenderer||(this._pickDepthRenderer=new Gu(this._scene)),this._pickDepthRenderer}get occlusionRenderer(){return this._occlusionRenderer||(this._occlusionRenderer=new Vu(this._scene)),this._occlusionRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy()}}const zu={};class Wu{constructor(e=5e6){e>5e6&&(e=5e6),this.maxVerts=e,this.maxIndices=3*e,this.positions=[],this.colors=[],this.intensities=[],this.pickColors=[],this.flags=[],this.flags2=[],this.offsets=[]}}const Xu=p.vec4(),Yu=p.vec4(),Ku=p.vec4([0,0,0,1]),Ju=p.vec4([0,0,0,1]),Zu=p.vec4([0,0,0,1]),Qu=p.OBB3();class qu{constructor(e){this.model=e.model,this.sortId="PointsBatchingLayer",this.layerIndex=e.layerIndex,this._pointsBatchingRenderers=function(e){const t=e.id;let s=zu[t];return s||(s=new Uu(e),zu[t]=s,s._compile(),e.on("compile",(()=>{s._compile()})),e.on("destroyed",(()=>{delete zu[t],s._destroy()}))),s}(e.model.scene),this._buffer=new Wu(e.maxGeometryBatchSize),this._scratchMemory=e.scratchMemory,this._state=new ft({positionsBuf:null,offsetsBuf:null,colorsBuf:null,flagsBuf:null,flags2Buf:null,positionsDecodeMatrix:p.mat4(),origin:null}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numSelectedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numClippableLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._modelAABB=p.collapseAABB3(),this._portions=[],this._finalized=!1,e.positionsDecodeMatrix?(this._state.positionsDecodeMatrix.set(e.positionsDecodeMatrix),this._preCompressedPositionsExpected=!0):this._preCompressedPositionsExpected=!1,e.origin&&(this._state.origin=p.vec3(e.origin)),this.aabb=p.collapseAABB3()}canCreatePortion(e){if(this._finalized)throw"Already finalized";return this._buffer.positions.length+e<3*this._buffer.maxVerts}createPortion(e){if(this._finalized)throw"Already finalized";const t=e.positions,s=e.positionsCompressed,i=e.color,r=e.colorsCompressed,o=e.colors,n=e.meshMatrix,a=e.worldMatrix,h=e.worldAABB,l=e.pickColor,u=this._buffer,c=u.positions.length/3;let d;if(this._preCompressedPositionsExpected){if(!s)throw"positionsCompressed expected";for(let e=0,t=s.length;e<t;e++)u.positions.push(s[e]);const e=Pt.getPositionsBounds(s),t=Pt.decompressPosition(e.min,this._state.positionsDecodeMatrix,Xu),i=Pt.decompressPosition(e.max,this._state.positionsDecodeMatrix,Yu);h[0]=t[0],h[1]=t[1],h[2]=t[2],h[3]=i[0],h[4]=i[1],h[5]=i[2],a&&(p.AABB3ToOBB3(h,Qu),p.transformOBB3(a,Qu),p.OBB3ToAABB3(Qu,h)),d=s.length/3}else{if(!t)throw"positions expected";d=t.length/3;const e=t.length,s=u.positions.length;for(let e=0,s=t.length;e<s;e++)u.positions.push(t[e]);if(n)for(let t=s,i=s+e;t<i;t+=3)Ku[0]=u.positions[t+0],Ku[1]=u.positions[t+1],Ku[2]=u.positions[t+2],p.transformPoint4(n,Ku,Ju),u.positions[t+0]=Ju[0],u.positions[t+1]=Ju[1],u.positions[t+2]=Ju[2],p.expandAABB3Point3(this._modelAABB,Ju),a?(p.transformPoint4(a,Ju,Zu),p.expandAABB3Point3(h,Zu)):p.expandAABB3Point3(h,Ju);else for(let t=s,i=s+e;t<i;t+=3)Ku[0]=u.positions[t+0],Ku[1]=u.positions[t+1],Ku[2]=u.positions[t+2],p.expandAABB3Point3(this._modelAABB,Ku),a?(p.transformPoint4(a,Ku,Ju),p.expandAABB3Point3(h,Ju)):p.expandAABB3Point3(h,Ku)}if(this._state.origin){const e=this._state.origin;h[0]+=e[0],h[1]+=e[1],h[2]+=e[2],h[3]+=e[0],h[4]+=e[1],h[5]+=e[2]}if(p.expandAABB3(this.aabb,h),r)for(let e=0,t=r.length;e<t;e++)u.colors.push(r[e]);else if(o)for(let e=0,t=o.length;e<t;e++)u.colors.push(255*o[e]);else if(i){const e=i[0],t=i[1],s=i[2],r=1;for(let i=0;i<d;i++)u.colors.push(e),u.colors.push(t),u.colors.push(s),u.colors.push(r)}{const e=u.pickColors.length;for(let t=e,s=e+4*d;t<s;t+=4)u.pickColors.push(l[0]),u.pickColors.push(l[1]),u.pickColors.push(l[2]),u.pickColors.push(l[3])}if(this.model.scene.entityOffsetsEnabled)for(let e=0;e<d;e++)u.offsets.push(0),u.offsets.push(0),u.offsets.push(0);const m=this._portions.length/2;return this._portions.push(c),this._portions.push(d),this._numPortions++,this.model.numPortions++,m}finalize(){if(this._finalized)return void this.model.error("Already finalized");const e=this._state,t=this.model.scene.canvas.gl,s=this._buffer;if(s.positions.length>0)if(this._preCompressedPositionsExpected){const i=new Uint16Array(s.positions);e.positionsBuf=new we(t,t.ARRAY_BUFFER,i,s.positions.length,3,t.STATIC_DRAW)}else{const i=Wh(new Float32Array(s.positions),this._modelAABB,e.positionsDecodeMatrix);e.positionsBuf=new we(t,t.ARRAY_BUFFER,i,s.positions.length,3,t.STATIC_DRAW)}if(s.colors.length>0){const i=new Uint8Array(s.colors);let r=!1;e.colorsBuf=new we(t,t.ARRAY_BUFFER,i,s.colors.length,4,t.STATIC_DRAW,r)}if(s.positions.length>0){const i=s.positions.length/3*4,r=new Uint8Array(i),o=new Uint8Array(i);let n=!1,a=!0;e.flagsBuf=new we(t,t.ARRAY_BUFFER,r,r.length,4,t.DYNAMIC_DRAW,n),e.flags2Buf=new we(t,t.ARRAY_BUFFER,o,o.length,4,t.DYNAMIC_DRAW,a)}if(s.pickColors.length>0){const i=new Uint8Array(s.pickColors);let r=!1;e.pickColorsBuf=new we(t,t.ARRAY_BUFFER,i,s.pickColors.length,4,t.STATIC_DRAW,r)}if(this.model.scene.entityOffsetsEnabled&&s.offsets.length>0){const i=new Float32Array(s.offsets);e.offsetsBuf=new we(t,t.ARRAY_BUFFER,i,s.offsets.length,3,t.DYNAMIC_DRAW)}this._buffer=null,this._finalized=!0}initFlags(e,t,s){t&E&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&L&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&B&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&N&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&S&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&R&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&F&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),s&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(e,t,s),this._setFlags2(e,t)}setVisible(e,t,s){if(!this._finalized)throw"Not finalized";t&E?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,s)}setHighlighted(e,t,s){if(!this._finalized)throw"Not finalized";t&L?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,s)}setXRayed(e,t,s){if(!this._finalized)throw"Not finalized";t&B?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,s)}setSelected(e,t,s){if(!this._finalized)throw"Not finalized";t&N?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,s)}setEdges(e,t,s){if(!this._finalized)throw"Not finalized"}setClippable(e,t){if(!this._finalized)throw"Not finalized";t&S?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}setCulled(e,t,s){if(!this._finalized)throw"Not finalized";t&F?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,s)}setCollidable(e,t){if(!this._finalized)throw"Not finalized"}setPickable(e,t,s){if(!this._finalized)throw"Not finalized";t&R?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(e,t,s)}setColor(e,t){if(!this._finalized)throw"Not finalized";const s=2*e,i=4*this._portions[s],r=4*this._portions[s+1],o=this._scratchMemory.getUInt8Array(r),n=t[0],a=t[1],h=t[2];for(let e=0;e<r;e+=4)o[e+0]=n,o[e+1]=a,o[e+2]=h;this._state.colorsBuf.setData(o,i,r)}setTransparent(e,t,s){s?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,s)}_setFlags(e,t,s){if(!this._finalized)throw"Not finalized";const i=2*e,r=4*this._portions[i],o=4*this._portions[i+1],n=this._scratchMemory.getUInt8Array(o),a=!!(t&E),h=!!(t&B),l=!!(t&L),u=!!(t&N),c=!!(t&R),p=!!(t&F);let d,m;d=!a||p||h||l&&!this.model.scene.highlightMaterial.glowThrough||u&&!this.model.scene.selectedMaterial.glowThrough?Xa:s?Ka:Ya,m=!a||p?Xa:u?Za:l?Ja:h?Qa:Xa;let f=a&&!p&&c?ih:Xa;for(let e=0;e<o;e+=4)n[e+0]=d,n[e+1]=m,n[e+2]=0,n[e+3]=f;this._state.flagsBuf.setData(n,r,o)}_setFlags2(e,t){if(!this._finalized)throw"Not finalized";const s=2*e,i=4*this._portions[s],r=4*this._portions[s+1],o=this._scratchMemory.getUInt8Array(r),n=t&S?255:0;for(let e=0;e<r;e+=4)o[e+0]=n;this._state.flags2Buf.setData(o,i,r)}setOffset(e,t){if(!this._finalized)throw"Not finalized";if(!this.model.scene.entityOffsetsEnabled)return void this.model.error("Entity#offset not enabled for this Viewer");const s=2*e,i=3*this._portions[s],r=3*this._portions[s+1],o=this._scratchMemory.getFloat32Array(r),n=t[0],a=t[1],h=t[2];for(let e=0;e<r;e+=3)o[e+0]=n,o[e+1]=a,o[e+2]=h;this._state.offsetsBuf.setData(o,i,r)}drawColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsBatchingRenderers.colorRenderer&&this._pointsBatchingRenderers.colorRenderer.drawLayer(t,this,Ya)}drawColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsBatchingRenderers.colorRenderer&&this._pointsBatchingRenderers.colorRenderer.drawLayer(t,this,Ka)}drawDepth(e,t){}drawNormals(e,t){}drawSilhouetteXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._pointsBatchingRenderers.silhouetteRenderer&&this._pointsBatchingRenderers.silhouetteRenderer.drawLayer(t,this,Qa)}drawSilhouetteHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._pointsBatchingRenderers.silhouetteRenderer&&this._pointsBatchingRenderers.silhouetteRenderer.drawLayer(t,this,Ja)}drawSilhouetteSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._pointsBatchingRenderers.silhouetteRenderer&&this._pointsBatchingRenderers.silhouetteRenderer.drawLayer(t,this,Za)}drawEdgesColorOpaque(e,t){}drawEdgesColorTransparent(e,t){}drawEdgesHighlighted(e,t){}drawEdgesSelected(e,t){}drawEdgesXRayed(e,t){}drawPickMesh(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsBatchingRenderers.pickMeshRenderer&&this._pointsBatchingRenderers.pickMeshRenderer.drawLayer(t,this,ih)}drawPickDepths(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsBatchingRenderers.pickDepthRenderer&&this._pointsBatchingRenderers.pickDepthRenderer.drawLayer(t,this,ih)}drawPickNormals(e,t){}drawOcclusion(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsBatchingRenderers.occlusionRenderer&&this._pointsBatchingRenderers.occlusionRenderer.drawLayer(t,this,Ya)}drawShadow(e,t){}destroy(){const e=this._state;e.positionsBuf&&(e.positionsBuf.destroy(),e.positionsBuf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.pickColorsBuf&&(e.pickColorsBuf.destroy(),e.pickColorsBuf=null),e.destroy()}}const $u=p.vec3();class ec{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin,l=r.pointsMaterial._state,u=t.geometry;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aColor.bindArrayBuffer(u.colorsBuf),l.filterIntensity&&n.uniform2f(this._uIntensityRange,l.minIntensity,l.maxIntensity);const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*c,o=i.renderFlags;for(let t=0;t<c;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,$u);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),n.uniform1f(this._uPointSize,l.pointSize);const p="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,p),n.drawArraysInstanced(n.POINTS,0,u.positionsBuf.numItems,a.numInstances),e.drawArrays++,n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.pointsMaterial._state,s=e.canvas.gl;if(this._program=new Te(s,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aOffset=i.getAttribute("offset"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),t.filterIntensity&&(this._uIntensityRange=i.getLocation("intensityRange")),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=e.pointsMaterial._state,i=[];return i.push("#version 300 es"),i.push("// Points instancing color vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),i.push("in vec4 color;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),s.filterIntensity&&i.push("uniform vec2 intensityRange;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),s.filterIntensity&&(i.push("float intensity = float(color.a) / 255.0;"),i.push("if (intensity < intensityRange[0] || intensity > intensityRange[1]) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {")),i.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, 1.0);"),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),s.filterIntensity&&i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Points instancing color fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),e.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return i.push("   outColor = vColor;"),e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const tc=p.vec3();class sc{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin,l=r.pointsMaterial._state,u=t.geometry;if(!this._program&&(this._allocate(t.model.scene),this.errors))return;if(e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===Qa){const e=r.xrayMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===Ja){const e=r.highlightMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else if(s===Za){const e=r.selectedMaterial._state,t=e.fillColor,s=e.fillAlpha;n.uniform4f(this._uColor,t[0],t[1],t[2],s)}else n.uniform4fv(this._uColor,p.vec3([1,1,1]));n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*c,o=i.renderFlags;for(let t=0;t<c;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,tc);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf,n.UNSIGNED_BYTE,!0),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,n.UNSIGNED_BYTE,!0),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),n.uniform1f(this._uPointSize,l.pointSize);const d="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,d),n.drawArraysInstanced(n.POINTS,0,u.positionsBuf.numItems,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uColor=i.getLocation("silhouetteColor"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=e.pointsMaterial._state,i=[];return i.push("#version 300 es"),i.push("// Points instancing silhouette vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 color;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),i.push("uniform vec4 silhouetteColor;"),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.y) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("vColor = vec4(float(silhouetteColor.r) / 255.0, float(silhouetteColor.g) / 255.0, float(silhouetteColor.b) / 255.0, float(color.a) / 255.0);"),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Points instancing silhouette fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),e.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("outColor = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const ic=p.vec3();class rc{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin,l=r.pointsMaterial._state,u=t.geometry;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,s);const c=e.pickViewMatrix||o.viewMatrix,p=h?U(c,h):c;if(n.uniformMatrix4fv(this._uViewMatrix,!1,p),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,e)}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPickColor.bindArrayBuffer(a.pickColorsBuf),n.vertexAttribDivisor(this._aPickColor.location,1),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),n.uniform1f(this._uPointSize,l.pointSize);const d="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,d);const m=r._sectionPlanesState.sectionPlanes.length;if(m>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*m,o=i.renderFlags;for(let t=0;t<m;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,ic);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.drawArraysInstanced(n.POINTS,0,u.positionsBuf.numItems,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aPickColor.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._uRenderPass=i.getLocation("renderPass"),this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aPickColor=i.getAttribute("pickColor"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(e){const t=this._scene.canvas.gl;this._program.bind(),t.uniform1i(this._uPickInvisible,e.pickInvisible)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=e.pointsMaterial._state,i=[];return i.push("#version 300 es"),i.push("// Points instancing pick mesh vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 pickColor;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vPickColor;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("  vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),t&&(i.push("  vWorldPosition = worldPosition;"),i.push("  vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Points instancing pick mesh fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vPickColor;"),i.push("out vec4 outColor;"),i.push("void main(void) {"),e.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("outColor = vPickColor; "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const oc=p.vec3();class nc{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.canvas.gl,n=t._state,a=t._state.origin,h=r.pointsMaterial._state,l=t.geometry;if(!this._program&&(this._allocate(t),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram());const u=r.camera;o.uniform1i(this._uRenderPass,s),o.uniform1i(this._uPickInvisible,e.pickInvisible);const c=e.pickViewMatrix||u.viewMatrix,p=a?U(c,a):c;if(o.uniformMatrix4fv(this._uViewMatrix,!1,p),o.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),o.uniformMatrix4fv(this._uProjMatrix,!1,e.pickProjMatrix),o.uniform1f(this._uPickZNear,e.pickZNear),o.uniform1f(this._uPickZFar,e.pickZFar),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(e.pickZFar+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,t)}const d=r._sectionPlanesState.sectionPlanes.length;if(d>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*d,n=i.renderFlags;for(let t=0;t<d;t++){const i=this._uSectionPlanes[t];if(i){const r=n.sectionPlanesActivePerLayer[s+t];if(o.uniform1i(i.active,r?1:0),r){const s=e[t];if(a){const e=X(s.dist,s.dir,a,oc);o.uniform3fv(i.pos,e)}else o.uniform3fv(i.pos,s.pos);o.uniform3fv(i.dir,s.dir)}}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),o.vertexAttribDivisor(this._aModelMatrixCol0.location,1),o.vertexAttribDivisor(this._aModelMatrixCol1.location,1),o.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(l.positionsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf),o.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),o.vertexAttribDivisor(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),o.vertexAttribDivisor(this._aOffset.location,1)),o.uniform1f(this._uPointSize,h.pointSize);const m="ortho"===r.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,m),o.drawArraysInstanced(o.POINTS,0,l.positionsBuf.numItems,n.numInstances),o.vertexAttribDivisor(this._aModelMatrixCol0.location,0),o.vertexAttribDivisor(this._aModelMatrixCol1.location,0),o.vertexAttribDivisor(this._aModelMatrixCol2.location,0),o.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&o.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&o.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uPickZNear=s.getLocation("pickZNear"),this._uPickZFar=s.getLocation("pickZFar"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=e.pointsMaterial._state,i=[];return i.push("#version 300 es"),i.push("// Points instancing pick depth vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("out vec4 vViewPosition;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("  vWorldPosition = worldPosition;"),i.push("  vFlags2 = flags2;")),i.push("  vViewPosition = viewPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Points instancing pick depth fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),i.push("uniform float pickZNear;"),i.push("uniform float pickZFar;"),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec4 vViewPosition;"),i.push("vec4 packDepth(const in float depth) {"),i.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),i.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),i.push("  vec4 res = fract(depth * bitShift);"),i.push("  res -= res.xxyz * bitMask;"),i.push("  return res;"),i.push("}"),i.push("out vec4 outColor;"),i.push("void main(void) {"),e.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),i.push("    outColor = packDepth(zNormalizedDepth); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const ac=p.vec3();class hc{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin,l=r.pointsMaterial._state,u=t.geometry;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*c,o=i.renderFlags;for(let t=0;t<c;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,ac);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aColor&&(this._aColor.bindArrayBuffer(u.colorsBuf),n.vertexAttribDivisor(this._aColor.location,1)),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(a.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),n.uniform1f(this._uPointSize,l.pointSize);const p="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,p),n.drawArraysInstanced(n.POINTS,0,u.positionsBuf.numItems,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),this._aColor&&n.vertexAttribDivisor(this._aColor.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=e.pointsMaterial._state,i=[];return i.push("#version 300 es"),i.push("// Points instancing occlusion vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 color;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&i.push("  vWorldPosition = worldPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Points instancing occlusion vertex shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("out vec4 outColor;"),i.push("void main(void) {"),e.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0;e<t.sectionPlanes.length;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return i.push("   outColor = vec4(0.0, 0.0, 1.0, 1.0); "),e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const lc=p.vec3();class uc{constructor(e){this._scene=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(e,t,s){const i=t.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=t._state,h=t._state.origin,l=r.pointsMaterial._state,u=t.geometry;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix);const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const e=r._sectionPlanesState.sectionPlanes,s=t.layerIndex*c,o=i.renderFlags;for(let t=0;t<c;t++){const i=this._uSectionPlanes[t];if(i){const r=o.sectionPlanesActivePerLayer[s+t];if(n.uniform1i(i.active,r?1:0),r){const s=e[t];if(h){const e=X(s.dist,s.dir,h,lc);n.uniform3fv(i.pos,e)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),n.vertexAttribDivisor(this._aModelMatrixCol0.location,1),n.vertexAttribDivisor(this._aModelMatrixCol1.location,1),n.vertexAttribDivisor(this._aModelMatrixCol2.location,1),n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,u.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(u.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),n.vertexAttribDivisor(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(a.flagsBuf),n.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),n.vertexAttribDivisor(this._aFlags2.location,1)),n.uniform1f(this._uPointSize,l.pointSize);const p="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,p),n.drawArraysInstanced(n.POINTS,0,u.positionsBuf.numItems,a.numInstances),n.vertexAttribDivisor(this._aModelMatrixCol0.location,0),n.vertexAttribDivisor(this._aModelMatrixCol1.location,0),n.vertexAttribDivisor(this._aModelMatrixCol2.location,0),n.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,i=e._sectionPlanesState.sectionPlanes.length;t<i;t++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+t),pos:s.getLocation("sectionPlanePos"+t),dir:s.getLocation("sectionPlaneDir"+t)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const e=this._scene,t=e.canvas.gl,s=e.camera.project;if(this._program.bind(),t.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const e=2/(Math.log(s.far+1)/Math.LN2);t.uniform1f(this._uLogDepthBufFC,e)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=e.pointsMaterial._state,i=[];return i.push("#version 300 es"),i.push("// Points instancing depth vertex shader"),i.push("uniform int renderPass;"),i.push("in vec3 position;"),e.entityOffsetsEnabled&&i.push("in vec3 offset;"),i.push("in vec4 flags;"),i.push("in vec4 flags2;"),i.push("in vec4 modelMatrixCol0;"),i.push("in vec4 modelMatrixCol1;"),i.push("in vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("out float vFragDepth;")),t&&(i.push("out vec4 vWorldPosition;"),i.push("out vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),t&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&i.push("vFragDepth = 1.0 + clipPos.w;"),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState;let s,i;const r=t.sectionPlanes.length>0,o=[];if(o.push("#version 300 es"),o.push("// Points instancing depth vertex shader"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),e.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),o.push("in float vFragDepth;")),r)for(o.push("in vec4 vWorldPosition;"),o.push("in vec4 vFlags2;"),s=0,i=t.sectionPlanes.length;s<i;s++)o.push("uniform bool sectionPlaneActive"+s+";"),o.push("uniform vec3 sectionPlanePos"+s+";"),o.push("uniform vec3 sectionPlaneDir"+s+";");if(o.push("const float   packUpScale = 256. / 255.;"),o.push("const float   unpackDownscale = 255. / 256.;"),o.push("const vec3    packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),o.push("const vec4    unpackFactors = unpackDownscale / vec4( packFactors, 1. );"),o.push("const float   shiftRight8 = 1.0 / 256.;"),o.push("vec4 packDepthToRGBA( const in float v ) {"),o.push("    vec4 r = vec4( fract( v * packFactors ), v );"),o.push("    r.yzw -= r.xyz * shiftRight8;"),o.push("    return r * packUpScale;"),o.push("}"),o.push("out vec4 outColor;"),o.push("void main(void) {"),e.pointsMaterial.roundPoints&&(o.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),o.push("  float r = dot(cxy, cxy);"),o.push("  if (r > 1.0) {"),o.push("       discard;"),o.push("  }")),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),s=0,i=t.sectionPlanes.length;s<i;s++)o.push("if (sectionPlaneActive"+s+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+s+".xyz, vWorldPosition.xyz - sectionPlanePos"+s+".xyz), 0.0, 1000.0);"),o.push("}");o.push("if (dist > 0.0) { discard; }"),o.push("}")}return o.push("    outColor = packDepthToRGBA( gl_FragCoord.z); "),e.logarithmicDepthBufferEnabled&&o.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const cc=p.vec3();class pc{constructor(e){this._scene=e,this._hash=this._getHash(),this._lastLightId=null,this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(e,t){const s=t.model,i=s.scene,r=i.canvas.gl,o=t._state;if(!this._program&&(this._allocate(),this.errors))return;e.lastProgramId!==this._program.id&&(e.lastProgramId=this._program.id,this._bindProgram(e,t)),r.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,geometry.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(o.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(o.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(o.modelMatrixCol2Buf),r.vertexAttribDivisor(this._aModelMatrixCol0.location,1),r.vertexAttribDivisor(this._aModelMatrixCol1.location,1),r.vertexAttribDivisor(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(o.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(o.offsetsBuf),r.vertexAttribDivisor(this._aOffset.location,1)),this._aColor.bindArrayBuffer(o.colorsBuf),r.vertexAttribDivisor(this._aColor.location,1),this._aFlags.bindArrayBuffer(o.flagsBuf),r.vertexAttribDivisor(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(o.flags2Buf),r.vertexAttribDivisor(this._aFlags2.location,1));const n=i._sectionPlanesState.sectionPlanes.length;if(n>0){const e=i._sectionPlanesState.sectionPlanes,o=t.layerIndex*n,a=s.renderFlags,h=t._state.origin;for(let t=0;t<n;t++){const s=this._uSectionPlanes[t];if(s){const i=a.sectionPlanesActivePerLayer[o+t];if(r.uniform1i(s.active,i?1:0),i){const i=e[t];if(h){const e=X(i.dist,i.dir,h,cc);r.uniform3fv(s.pos,e)}else r.uniform3fv(s.pos,i.pos);r.uniform3fv(s.dir,i.dir)}}}}r.uniform1f(this._uPointSize,10),r.drawArraysInstanced(r.POINTS,0,o.positionsBuf.numItems,o.numInstances),r.vertexAttribDivisor(this._aModelMatrixCol0.location,0),r.vertexAttribDivisor(this._aModelMatrixCol1.location,0),r.vertexAttribDivisor(this._aModelMatrixCol2.location,0),r.vertexAttribDivisor(this._aColor.location,0),r.vertexAttribDivisor(this._aFlags.location,0),this._aFlags2&&r.vertexAttribDivisor(this._aFlags2.location,0),this._aOffset&&r.vertexAttribDivisor(this._aOffset.location,0)}_allocate(){const e=this._scene,t=e.canvas.gl,s=e._sectionPlanesState;if(this._program=new Te(t,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uShadowViewMatrix=i.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=i.getLocation("shadowProjMatrix"),this._uSectionPlanes=[];for(let e=0,t=s.sectionPlanes.length;e<t;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uPointSize=i.getLocation("pointSize")}_bindProgram(e,t){const s=this._scene.canvas.gl;this._program.bind(),s.uniformMatrix4fv(this._uShadowViewMatrix,!1,e.shadowViewMatrix),s.uniformMatrix4fv(this._uShadowProjMatrix,!1,e.shadowProjMatrix),this._lastLightId=null}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const e=this._scene,t=e._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("#version 300 es"),s.push("// Instancing geometry shadow drawing vertex shader"),s.push("in vec3 position;"),e.entityOffsetsEnabled&&s.push("in vec3 offset;"),s.push("in vec4 color;"),s.push("in vec4 flags;"),s.push("in vec4 flags2;"),s.push("in vec4 modelMatrixCol0;"),s.push("in vec4 modelMatrixCol1;"),s.push("in vec4 modelMatrixCol2;"),s.push("uniform mat4 shadowViewMatrix;"),s.push("uniform mat4 shadowProjMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),t&&(s.push("out vec4 vWorldPosition;"),s.push("out vec4 vFlags2;")),s.push("void main(void) {"),s.push("bool visible      = (float(flags.x) > 0.0);"),s.push("bool transparent  = ((float(color.a) / 255.0) < 1.0);"),s.push("if (!visible || transparent) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),e.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = shadowViewMatrix * worldPosition; "),t&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("  gl_Position = shadowProjMatrix * viewPosition;"),s.push("}"),s.push("gl_PointSize = pointSize;"),s.push("}"),s}_buildFragmentShader(){const e=this._scene,t=e._sectionPlanesState,s=t.sectionPlanes.length>0,i=[];if(i.push("#version 300 es"),i.push("// Instancing geometry depth drawing fragment shader"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),e.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),i.push("in float vFragDepth;")),s){i.push("in vec4 vWorldPosition;"),i.push("in vec4 vFlags2;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("uniform bool sectionPlaneActive"+e+";"),i.push("uniform vec3 sectionPlanePos"+e+";"),i.push("uniform vec3 sectionPlaneDir"+e+";")}if(i.push("in vec3 vViewNormal;"),i.push("vec3 packNormalToRGB( const in vec3 normal ) {"),i.push("    return normalize( normal ) * 0.5 + 0.5;"),i.push("}"),i.push("out vec4 outColor;"),i.push("void main(void) {"),i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let e=0,s=t.sectionPlanes.length;e<s;e++)i.push("if (sectionPlaneActive"+e+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+e+".xyz, vWorldPosition.xyz - sectionPlanePos"+e+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return e.logarithmicDepthBufferEnabled&&i.push("gl_FragDepth = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    outColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class dc{constructor(e){this._scene=e}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._depthRenderer&&!this._depthRenderer.getValid()&&(this._depthRenderer.destroy(),this._depthRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null),this._shadowRenderer&&!this._shadowRenderer.getValid()&&(this._shadowRenderer.destroy(),this._shadowRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new ec(this._scene,!1)),this._colorRenderer}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new sc(this._scene)),this._silhouetteRenderer}get depthRenderer(){return this._depthRenderer||(this._depthRenderer=new uc(this._scene)),this._depthRenderer}get pickMeshRenderer(){return this._pickMeshRenderer||(this._pickMeshRenderer=new rc(this._scene)),this._pickMeshRenderer}get pickDepthRenderer(){return this._pickDepthRenderer||(this._pickDepthRenderer=new nc(this._scene)),this._pickDepthRenderer}get occlusionRenderer(){return this._occlusionRenderer||(this._occlusionRenderer=new hc(this._scene)),this._occlusionRenderer}get shadowRenderer(){return this._shadowRenderer||(this._shadowRenderer=new pc(this._scene)),this._shadowRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._depthRenderer&&this._depthRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy(),this._shadowRenderer&&this._shadowRenderer.destroy()}}const mc={};const fc=new Uint8Array(4),gc=p.vec4([0,0,0,1]),_c=p.vec4([0,0,0,1]),yc=p.vec4([0,0,0,1]),vc=new Float32Array(3);class bc{constructor(e){this.model=e.model,this.geometry=e.geometry,this.material=e.material,this.sortId="PointsInstancingLayer",this.layerIndex=e.layerIndex,this._pointsInstancingRenderers=function(e){const t=e.id;let s=mc[t];return s||(s=new dc(e),mc[t]=s,s._compile(),e.on("compile",(()=>{s._compile()})),e.on("destroyed",(()=>{delete mc[t],s._destroy()}))),s}(e.model.scene),this._aabb=p.collapseAABB3(),this._state=new ft({obb:p.OBB3(),numInstances:0,origin:e.origin?p.vec3(e.origin):null}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numSelectedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this.numIndices=e.geometry.numIndices,this._pickColors=[],this._offsets=[],this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._portions=[],this._finalized=!1,this.aabb=p.collapseAABB3()}createPortion(e){const t=e.meshMatrix,s=e.worldMatrix,i=e.aabb,r=e.pickColor;if(this._finalized)throw"Already finalized";this.model.scene.entityOffsetsEnabled&&(this._offsets.push(0),this._offsets.push(0),this._offsets.push(0)),this._modelMatrixCol0.push(t[0]),this._modelMatrixCol0.push(t[4]),this._modelMatrixCol0.push(t[8]),this._modelMatrixCol0.push(t[12]),this._modelMatrixCol1.push(t[1]),this._modelMatrixCol1.push(t[5]),this._modelMatrixCol1.push(t[9]),this._modelMatrixCol1.push(t[13]),this._modelMatrixCol2.push(t[2]),this._modelMatrixCol2.push(t[6]),this._modelMatrixCol2.push(t[10]),this._modelMatrixCol2.push(t[14]),this._pickColors.push(r[0]),this._pickColors.push(r[1]),this._pickColors.push(r[2]),this._pickColors.push(r[3]),p.collapseAABB3(i);const o=this._state.obb,n=o.length;for(let e=0;e<n;e+=4)gc[0]=o[e+0],gc[1]=o[e+1],gc[2]=o[e+2],p.transformPoint4(t,gc,_c),s?(p.transformPoint4(s,_c,yc),p.expandAABB3Point3(i,yc)):p.expandAABB3Point3(i,_c);if(this._state.origin){const e=this._state.origin;i[0]+=e[0],i[1]+=e[1],i[2]+=e[2],i[3]+=e[0],i[4]+=e[1],i[5]+=e[2]}p.expandAABB3(this.aabb,i),this._state.numInstances++;const a=this._portions.length;return this._portions.push({}),this._numPortions++,this.model.numPortions++,a}finalize(){if(this._finalized)throw"Already finalized";const e=this.model.scene.canvas.gl,t=this._pickColors.length;if(t>0){let s=!1,i=!0;this._state.flagsBuf=new we(e,e.ARRAY_BUFFER,new Uint8Array(t),t,4,e.DYNAMIC_DRAW,s),this._state.flags2Buf=new we(e,e.ARRAY_BUFFER,new Uint8Array(t),t,4,e.DYNAMIC_DRAW,i)}if(this.model.scene.entityOffsetsEnabled&&this._offsets.length>0){const t=!1;this._state.offsetsBuf=new we(e,e.ARRAY_BUFFER,new Float32Array(this._offsets),this._offsets.length,3,e.DYNAMIC_DRAW,t),this._offsets=[]}if(this._modelMatrixCol0.length>0){const t=!1;this._state.modelMatrixCol0Buf=new we(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol0),this._modelMatrixCol0.length,4,e.STATIC_DRAW,t),this._state.modelMatrixCol1Buf=new we(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol1),this._modelMatrixCol1.length,4,e.STATIC_DRAW,t),this._state.modelMatrixCol2Buf=new we(e,e.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol2),this._modelMatrixCol2.length,4,e.STATIC_DRAW,t),this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[]}if(this._pickColors.length>0){const t=!1;this._state.pickColorsBuf=new we(e,e.ARRAY_BUFFER,new Uint8Array(this._pickColors),this._pickColors.length,4,e.STATIC_DRAW,t),this._pickColors=[]}this._finalized=!0}initFlags(e,t,s){t&E&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),t&L&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),t&B&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),t&N&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),t&S&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),t&k&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),t&R&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),t&F&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),s&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(e,t,s),this._setFlags2(e,t)}setVisible(e,t,s){if(!this._finalized)throw"Not finalized";t&E?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(e,t,s)}setHighlighted(e,t,s){if(!this._finalized)throw"Not finalized";t&L?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(e,t,s)}setXRayed(e,t,s){if(!this._finalized)throw"Not finalized";t&B?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(e,t,s)}setSelected(e,t,s){if(!this._finalized)throw"Not finalized";t&N?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(e,t,s)}setEdges(e,t,s){if(!this._finalized)throw"Not finalized";t&k?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(e,t,s)}setClippable(e,t){if(!this._finalized)throw"Not finalized";t&S?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(e,t)}setCollidable(e,t){if(!this._finalized)throw"Not finalized"}setPickable(e,t,s){if(!this._finalized)throw"Not finalized";t&R?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags2(e,t,s)}setCulled(e,t,s){if(!this._finalized)throw"Not finalized";t&F?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(e,t,s)}setColor(e,t){if(!this._finalized)throw"Not finalized";fc[0]=t[0],fc[1]=t[1],fc[2]=t[2],this._state.colorsBuf.setData(fc,3*e,3)}setTransparent(e,t,s){s?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,s)}_setFlags(e,t,s){if(!this._finalized)throw"Not finalized";const i=!!(t&E),r=!!(t&B),o=!!(t&L),n=!!(t&N),a=!!(t&k),h=!!(t&R),l=!!(t&F);let u,c;u=!i||l||r||o&&!this.model.scene.highlightMaterial.glowThrough||n&&!this.model.scene.selectedMaterial.glowThrough?Xa:s?Ka:Ya,c=!i||l?Xa:n?Za:o?Ja:r?Qa:Xa;let p=0;p=!i||l?Xa:n?th:o?eh:r?sh:a?s?$a:qa:Xa;let d=i&&!l&&h?ih:Xa;fc[0]=u,fc[1]=c,fc[2]=p,fc[3]=d,this._state.flagsBuf.setData(fc,4*e,4)}_setFlags2(e,t){if(!this._finalized)throw"Not finalized";const s=t&S?255:0;fc[0]=s,this._state.flags2Buf.setData(fc,4*e,4)}setOffset(e,t){if(!this._finalized)throw"Not finalized";this.model.scene.entityOffsetsEnabled?(vc[0]=t[0],vc[1]=t[1],vc[2]=t[2],this._state.offsetsBuf.setData(vc,3*e,3)):this.model.error("Entity#offset not enabled for this Viewer")}drawColorOpaque(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsInstancingRenderers.colorRenderer&&this._pointsInstancingRenderers.colorRenderer.drawLayer(t,this,Ya)}drawColorTransparent(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsInstancingRenderers.colorRenderer&&this._pointsInstancingRenderers.colorRenderer.drawLayer(t,this,Ka)}drawDepth(e,t){}drawNormals(e,t){}drawSilhouetteXRayed(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._pointsInstancingRenderers.silhouetteRenderer&&this._pointsInstancingRenderers.silhouetteRenderer.drawLayer(t,this,Qa)}drawSilhouetteHighlighted(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._pointsInstancingRenderers.silhouetteRenderer&&this._pointsInstancingRenderers.silhouetteRenderer.drawLayer(t,this,Ja)}drawSilhouetteSelected(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._pointsInstancingRenderers.silhouetteRenderer&&this._pointsInstancingRenderers.silhouetteRenderer.drawLayer(t,this,Za)}drawEdgesColorOpaque(e,t){}drawEdgesColorTransparent(e,t){}drawEdgesHighlighted(e,t){}drawEdgesSelected(e,t){}drawEdgesXRayed(e,t){}drawOcclusion(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsInstancingRenderers.occlusionRenderer&&this._pointsInstancingRenderers.occlusionRenderer.drawLayer(t,this,Ya)}drawShadow(e,t){}drawPickMesh(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsInstancingRenderers.pickMeshRenderer&&this._pointsInstancingRenderers.pickMeshRenderer.drawLayer(t,this,ih)}drawPickDepths(e,t){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsInstancingRenderers.pickDepthRenderer&&this._pointsInstancingRenderers.pickDepthRenderer.drawLayer(t,this,ih)}drawPickNormals(e,t){}destroy(){const e=this._state;e.colorsBuf&&(e.colorsBuf.destroy(),e.colorsBuf=null),e.flagsBuf&&(e.flagsBuf.destroy(),e.flagsBuf=null),e.flags2Buf&&(e.flags2Buf.destroy(),e.flags2Buf=null),e.offsetsBuf&&(e.offsetsBuf.destroy(),e.offsetsBuf=null),e.modelMatrixCol0Buf&&(e.modelMatrixCol0Buf.destroy(),e.modelMatrixCol0Buf=null),e.modelMatrixCol1Buf&&(e.modelMatrixCol1Buf.destroy(),e.modelMatrixCol1Buf=null),e.modelMatrixCol2Buf&&(e.modelMatrixCol2Buf.destroy(),e.modelMatrixCol2Buf=null),e.pickColorsBuf&&(e.pickColorsBuf.destroy(),e.pickColorsBuf=null),e.destroy()}}class xc{constructor(e){this.id=e.id,this.colorTexture=e.colorTexture,this.metallicRoughnessTexture=e.metallicRoughnessTexture,this.normalsTexture=e.normalsTexture,this.emissiveTexture=e.emissiveTexture,this.occlusionTexture=e.occlusionTexture}destroy(){}}class Pc{constructor(e,t,s){this.id=s.id,this.model=s.model,this.primitive=s.primitive,this.positions=null,this.positionsCompressed=null,this.quantizedPositions=null,this.positionsDecodeMatrix=p.mat4(),this.normals=null,this.normalsCompressed=null,this.colors=null,this.colorsCompressed=null,this.uv=null,this.uvCompressed=null,this.uvDecodeMatrix=null,this.indices=null,this.numIndices=0,this.obb=p.OBB3(),this.positionsBuf=null,this.normalsBuf=null,this.edgeIndicesBuf=null,this.uvBuf=null,this.colorsBuf=null;const i=t.scene.pickSurfacePrecisionEnabled,r=t.scene.canvas.gl;if(s.positionsCompressed&&s.positionsCompressed.length>0){const e=!1;this.positionsBuf=new we(r,r.ARRAY_BUFFER,s.positionsCompressed,s.positionsCompressed.length,3,r.STATIC_DRAW,e),this.positionsDecodeMatrix.set(s.positionsDecodeMatrix);const t=p.collapseAABB3();p.expandAABB3Points3(t,s.positionsCompressed),Pt.decompressAABB(t,this.positionsDecodeMatrix),p.AABB3ToOBB3(t,this.obb),i&&(this.quantizedPositions=s.positionsCompressed)}else if(s.positions&&s.positions.length>0){const e=s.positions.length,t=p.collapseAABB3();p.expandAABB3Points3(t,s.positions),p.AABB3ToOBB3(t,this.obb);const o=Wh(s.positions,t,this.positionsDecodeMatrix);let n=!1;this.positionsBuf=new we(r,r.ARRAY_BUFFER,o,e,3,r.STATIC_DRAW,n),i&&(this.quantizedPositions=o)}if(s.normalsCompressed&&s.normalsCompressed.length>0){const e=!0;this.normalsBuf=new we(r,r.ARRAY_BUFFER,s.normalsCompressed,s.normalsCompressed.length,3,r.STATIC_DRAW,e)}else if(s.normals&&s.normals.length>0){const e=function(e){const t=e.length,s=new Int8Array(t);let i,r,o,n,a;for(let h=0;h<t;h+=3)o=i=Yh(e,h,"floor","floor"),r=Kh(i),n=a=Jh(e,h,r),i=Yh(e,h,"ceil","floor"),r=Kh(i),n=Jh(e,h,r),n>a&&(o=i,a=n),i=Yh(e,h,"floor","ceil"),r=Kh(i),n=Jh(e,h,r),n>a&&(o=i,a=n),i=Yh(e,h,"ceil","ceil"),r=Kh(i),n=Jh(e,h,r),n>a&&(o=i,a=n),s[h+0]=o[0],s[h+1]=o[1],s[h+2]=0;return s}(s.normals),t=!0;this.normalsBuf=new we(r,r.ARRAY_BUFFER,e,e.length,3,r.STATIC_DRAW,t)}if(s.colorsCompressed&&s.colorsCompressed.length>0){const e=new Uint8Array(s.colorsCompressed),t=!1;this.colorsBuf=new we(r,r.ARRAY_BUFFER,e,e.length,4,r.STATIC_DRAW,t)}else if(s.colors&&s.colors.length>0){const e=s.colors,t=new Uint8Array(e.length);for(let s=0,i=e.length;s<i;s++)t[s]=255*e[s];const i=!1;this.colorsBuf=new we(r,r.ARRAY_BUFFER,t,t.length,4,r.STATIC_DRAW,i)}if(s.uvCompressed&&s.uvCompressed.length>0){const e=new Uint16Array(s.uvCompressed);this.uvDecodeMatrix=p.mat4(s.uvDecodeMatrix),this.uvBuf=new we(r,r.ARRAY_BUFFER,s.uvCompressed,e.length,2,r.STATIC_DRAW,!1)}else if(s.uv&&s.uv.length>0){const e=Pt.getUVBounds(s.uv),t=Pt.compressUVs(s.uv,e.min,e.max),i=t.quantized;this.uvDecodeMatrix=t.decodeMatrix,this.uvBuf=new we(r,r.ARRAY_BUFFER,i,i.length,2,r.STATIC_DRAW,!1)}if(s.indices&&s.indices.length>0&&(this.indicesBuf=new we(r,r.ELEMENT_ARRAY_BUFFER,new Uint32Array(s.indices),s.indices.length,1,r.STATIC_DRAW),i&&(this.indices=s.indices),this.numIndices=s.indices.length),"triangles"===s.primitive||"solid"===s.primitive||"surface"===s.primitive){let e=s.edgeIndices;e||(e=Ve(s.positions,s.indices,null,s.edgeThreshold||10)),this.edgeIndicesBuf=new we(r,r.ELEMENT_ARRAY_BUFFER,new Uint32Array(e),e.length,1,r.STATIC_DRAW)}}destroy(){}}class Tc{constructor(e){this.id=e.id,this.texture=e.texture}destroy(){this.texture&&(this.texture.destroy(),this.texture=null)}}const wc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class Mc{constructor(e,t,s){this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=s}itemStart(e){this.itemsTotal++,!1===this.isLoading&&void 0!==this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0}itemEnd(e){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())}itemError(e){void 0!==this.onError&&this.onError(e)}resolveURL(e){return this.urlModifier?this.urlModifier(e):e}setURLModifier(e){return this.urlModifier=e,this}addHandler(e,t){return this.handlers.push(e,t),this}removeHandler(e){const t=this.handlers.indexOf(e);return-1!==t&&this.handlers.splice(t,2),this}getHandler(e){for(let t=0,s=this.handlers.length;t<s;t+=2){const s=this.handlers[t],i=this.handlers[t+1];if(s.global&&(s.lastIndex=0),s.test(e))return i}return null}}const Ic=new Mc;class Cc{constructor(e){this.manager=void 0!==e?e:Ic,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const s=this;return new Promise((function(i,r){s.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Dc={};class Ac extends Cc{constructor(e){super(e)}load(e,t,s,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=wc.get(e);if(void 0!==r)return this.manager.itemStart(e),setTimeout((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==Dc[e])return void Dc[e].push({onLoad:t,onProgress:s,onError:i});Dc[e]=[],Dc[e].push({onLoad:t,onProgress:s,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),n=this.mimeType,a=this.responseType;fetch(o).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body.getReader)return t;const s=Dc[e],i=t.body.getReader(),r=t.headers.get("Content-Length"),o=r?parseInt(r):0,n=0!==o;let a=0;const h=new ReadableStream({start(e){!function t(){i.read().then((({done:i,value:r})=>{if(i)e.close();else{a+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:n,loaded:a,total:o});for(let e=0,t=s.length;e<t;e++){const t=s[e];t.onProgress&&t.onProgress(i)}e.enqueue(r),t()}}))}()}});return new Response(h)}throw Error(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`)})).then((e=>{switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,n)));case"json":return e.json();default:if(void 0===n)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(n),s=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(s);return e.arrayBuffer().then((e=>i.decode(e)))}}})).then((t=>{wc.add(e,t);const s=Dc[e];delete Dc[e];for(let e=0,i=s.length;e<i;e++){const i=s[e];i.onLoad&&i.onLoad(t)}})).catch((t=>{const s=Dc[e];if(void 0===s)throw this.manager.itemError(e),t;delete Dc[e];for(let e=0,i=s.length;e<i;e++){const i=s[e];i.onError&&i.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Ec{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const s=this.workersResolve[e];if(s&&s(t),this.queue.length){const{resolve:t,msg:s,transfer:i}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(s,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((s=>{const i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=s,this.workers[i].postMessage(e,t)):this.queue.push({resolve:s,msg:e,transfer:t})}))}destroy(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}let Fc=0;class Rc{constructor({viewer:e,transcoderPath:t,workerLimit:s}){this._transcoderPath=t||"https://cdn.jsdelivr.net/npm/@xeokit/xeokit-sdk/dist/basis/",this._transcoderBinary=null,this._transcoderPending=null,this._workerPool=new Ec,this._workerSourceURL="",s&&this._workerPool.setWorkerLimit(s);const i=e.capabilities;this._workerConfig={astcSupported:i.astcSupported,etc1Supported:i.etc1Supported,etc2Supported:i.etc2Supported,dxtSupported:i.dxtSupported,bptcSupported:i.bptcSupported,pvrtcSupported:i.pvrtcSupported},this._supportedFileTypes=["xkt2"]}_init(){if(!this._transcoderPending){const e=new Ac;e.setPath(this._transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),s=new Ac;s.setPath(this._transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const i=s.loadAsync("basis_transcoder.wasm");this._transcoderPending=Promise.all([t,i]).then((([e,t])=>{const s=Rc.BasisWorker.toString(),i=["/* constants */","let _EngineFormat = "+JSON.stringify(Rc.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Rc.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Rc.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this._workerSourceURL=URL.createObjectURL(new Blob([i])),this._transcoderBinary=t,this._workerPool.setWorkerCreator((()=>{const e=new Worker(this._workerSourceURL),t=this._transcoderBinary.slice(0);return e.postMessage({type:"init",config:this._workerConfig,transcoderBinary:t},[t]),e}))})),Fc>0&&console.warn("KTX2TextureTranscoder: Multiple active KTX2TextureTranscoder may cause performance issues. Use a single KTX2TextureTranscoder instance, or call .dispose() on old instances."),Fc++}return this._transcoderPending}transcode(e,t,s={}){return new Promise(((i,r)=>{const o=s;this._init().then((()=>this._workerPool.postMessage({type:"transcode",buffers:e,taskConfig:o},e))).then((e=>{const s=e.data,{mipmaps:o,width:n,height:a,format:h,type:l,error:u,dfdTransferFn:c,dfdFlags:p}=s;if("error"===l)return r(u);t.setCompressedData({mipmaps:o,props:{format:h,minFilter:1===o.length?1006:1008,magFilter:1===o.length?1006:1008,encoding:2===c?3001:3e3,premultiplyAlpha:!!(1&p)}}),i()}))}))}destroy(){URL.revokeObjectURL(this._workerSourceURL),this._workerPool.destroy(),Fc--}}Rc.BasisFormat={ETC1S:0,UASTC_4x4:1},Rc.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Rc.EngineFormat={RGBAFormat:1023,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776},Rc.BasisWorker=function(){let e,t,s;const i=_EngineFormat,r=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",(function(n){const u=n.data;switch(u.type){case"init":e=u.config,c=u.transcoderBinary,t=new Promise((e=>{s={wasmBinary:c,onRuntimeInitialized:e},BASIS(s)})).then((()=>{s.initializeBasis(),void 0===s.KTX2File&&console.warn("KTX2TextureTranscoder: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((()=>{try{const{width:t,height:n,hasAlpha:c,mipmaps:p,format:d,dfdTransferFn:m,dfdFlags:f}=function(t){const n=new s.KTX2File(new Uint8Array(t));function u(){n.close(),n.delete()}if(!n.isValid())throw u(),new Error("KTX2TextureTranscoder: Invalid or unsupported .ktx2 file");const c=n.isUASTC()?o.UASTC_4x4:o.ETC1S,p=n.getWidth(),d=n.getHeight(),m=n.getLevels(),f=n.getHasAlpha(),g=n.getDFDTransferFunc(),_=n.getDFDFlags(),{transcoderFormat:y,engineFormat:v}=function(t,s,n,u){let c,p;const d=t===o.ETC1S?a:h;for(let i=0;i<d.length;i++){const r=d[i];if(e[r.if]&&(r.basisFormat.includes(t)&&!(u&&r.transcoderFormat.length<2)&&(!r.needsPowerOfTwo||l(s)&&l(n))))return c=r.transcoderFormat[u?1:0],p=r.engineFormat[u?1:0],{transcoderFormat:c,engineFormat:p}}return console.warn("KTX2TextureTranscoder: No suitable compressed texture format found. Decoding to RGBA32."),c=r.RGBA32,p=i.RGBAFormat,{transcoderFormat:c,engineFormat:p}}(c,p,d,f);if(!p||!d||!m)throw u(),new Error("KTX2TextureTranscoder: Invalid texture");if(!n.startTranscoding())throw u(),new Error("KTX2TextureTranscoder: .startTranscoding failed");const b=[];for(let e=0;e<m;e++){const t=n.getImageLevelInfo(e,0,0),s=t.origWidth,i=t.origHeight,r=new Uint8Array(n.getImageTranscodedSizeInBytes(e,0,0,y));if(!n.transcodeImage(r,e,0,0,y,0,-1,-1))throw u(),new Error("KTX2TextureTranscoder: .transcodeImage failed.");b.push({data:r,width:s,height:i})}return u(),{width:p,height:d,hasAlpha:f,mipmaps:b,format:v,dfdTransferFn:g,dfdFlags:_}}(u.buffers[0]),g=[];for(let e=0;e<p.length;++e)g.push(p[e].data.buffer);self.postMessage({type:"transcode",id:u.id,width:t,height:n,hasAlpha:c,mipmaps:p,format:d,dfdTransferFn:m,dfdFlags:f},g)}catch(e){console.error(`[KTX2TextureTranscoder.BasisWorker]: ${e}`),self.postMessage({type:"error",id:u.id,error:e.message})}}))}var c}));const n=[{if:"astcSupported",basisFormat:[o.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=n.sort((function(e,t){return e.priorityETC1S-t.priorityETC1S})),h=n.sort((function(e,t){return e.priorityUASTC-t.priorityUASTC}));function l(e){return e<=2||0==(e&e-1)&&0!==e}};const Sc={};function Oc(e){const t=e.scene.id;let s=Sc[t];return s||(s=new Rc({viewer:e}),Sc[t]=s,e.scene.on("destroyed",(()=>{delete Sc[t],s.destroy()}))),s}const Bc=p.vec3(),Lc=p.mat4(),Nc=p.vec3([1,1,1]),kc=p.vec3([0,0,0]),jc=p.vec3([0,0,0]),Gc=p.identityQuaternion();class Hc extends A{constructor(e,t={}){super(e,t),this._textureTranscoder=t.textureTranscoder||Oc(this.scene.viewer),this._maxGeometryBatchSize=t.maxGeometryBatchSize,this._aabb=p.collapseAABB3(),this._aabbDirty=!1,this._layerList=[],this._nodeList=[],this._lastOrigin=null,this._lastPositionsDecodeMatrix=null,this._lastNormals=null,this._instancingLayers={},this._currentBatchingLayers={},this._scratchMemory=(Wa++,za),this._geometries={},this._textures={},this._textureSets={},this._meshes={},this._nodes={},this.renderFlags=new Ys,this.numGeometries=0,this.numPortions=0,this.numVisibleLayerPortions=0,this.numTransparentLayerPortions=0,this.numXRayedLayerPortions=0,this.numHighlightedLayerPortions=0,this.numSelectedLayerPortions=0,this.numEdgesLayerPortions=0,this.numPickableLayerPortions=0,this.numClippableLayerPortions=0,this.numCulledLayerPortions=0,this.numEntities=0,this._numTriangles=0,this._numLines=0,this._numPoints=0,this._edgeThreshold=t.edgeThreshold||10,this._origin=p.vec3(t.origin||[0,0,0]),this._position=p.vec3(t.position||[0,0,0]),this._rotation=p.vec3(t.rotation||[0,0,0]),this._quaternion=p.vec4(t.quaternion||[0,0,0,1]),t.rotation&&p.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._scale=p.vec3(t.scale||[1,1,1]),this._worldMatrix=p.mat4(),p.composeMat4(this._position,this._quaternion,this._scale,this._worldMatrix),this._worldNormalMatrix=p.mat4(),p.inverseMat4(this._worldMatrix,this._worldNormalMatrix),p.transposeMat4(this._worldNormalMatrix),(t.matrix||t.position||t.rotation||t.scale||t.quaternion)&&(this._viewMatrix=p.mat4(),this._viewNormalMatrix=p.mat4(),this._viewMatrixDirty=!0,this._worldMatrixNonIdentity=!0),this._opacity=1,this._colorize=[1,1,1],this._saoEnabled=!1!==t.saoEnabled,this._pbrEnabled=!1!==t.pbrEnabled,this._colorTextureEnabled=!1!==t.colorTextureEnabled,this._isModel=t.isModel,this._isModel&&this.scene._registerModel(this),this._onCameraViewMatrix=this.scene.camera.on("matrix",(()=>{this._viewMatrixDirty=!0})),this._createDefaultTextureSet(),this.visible=t.visible,this.culled=t.culled,this.pickable=t.pickable,this.clippable=t.clippable,this.collidable=t.collidable,this.castsShadow=t.castsShadow,this.receivesShadow=t.receivesShadow,this.xrayed=t.xrayed,this.highlighted=t.highlighted,this.selected=t.selected,this.edges=t.edges,this.colorize=t.colorize,this.opacity=t.opacity,this.backfaces=t.backfaces}_createDefaultTextureSet(){const e=new Tc({id:"defaultColorTexture",texture:new Pn({gl:this.scene.canvas.gl,preloadColor:[1,1,1,1]})}),t=new Tc({id:"defaultMetalRoughTexture",texture:new Pn({gl:this.scene.canvas.gl,preloadColor:[0,1,1,1]})}),s=new Tc({id:"defaultNormalsTexture",texture:new Pn({gl:this.scene.canvas.gl,preloadColor:[0,0,0,0]})}),i=new Tc({id:"defaultEmissiveTexture",texture:new Pn({gl:this.scene.canvas.gl,preloadColor:[0,0,0,1]})}),r=new Tc({id:"defaultOcclusionTexture",texture:new Pn({gl:this.scene.canvas.gl,preloadColor:[1,1,1,1]})});this._textures.defaultColorTexture=e,this._textures.defaultMetalRoughTexture=t,this._textures.defaultNormalsTexture=s,this._textures.defaultEmissiveTexture=i,this._textures.defaultOcclusionTexture=r,this._textureSets.defaultTextureSet=new xc({id:"defaultTextureSet",model:this,colorTexture:e,metallicRoughnessTexture:t,normalsTexture:s,emissiveTexture:i,occlusionTexture:r})}get isPerformanceModel(){return!0}get objects(){return this._nodes}get origin(){return this._origin}get position(){return this._position}get rotation(){return this._rotation}get quaternion(){return this._quaternion}get scale(){return this._scale}get matrix(){return this._worldMatrix}get worldMatrix(){return this._worldMatrix}get worldNormalMatrix(){return this._worldNormalMatrix}get viewMatrix(){return this._viewMatrix?(this._viewMatrixDirty&&(p.mulMat4(this.scene.camera.viewMatrix,this._worldMatrix,this._viewMatrix),p.inverseMat4(this._viewMatrix,this._viewNormalMatrix),p.transposeMat4(this._viewNormalMatrix),this._viewMatrixDirty=!1),this._viewMatrix):this.scene.camera.viewMatrix}get viewNormalMatrix(){return this._viewNormalMatrix?(this._viewMatrixDirty&&(p.mulMat4(this.scene.camera.viewMatrix,this._worldMatrix,this._viewMatrix),p.inverseMat4(this._viewMatrix,this._viewNormalMatrix),p.transposeMat4(this._viewNormalMatrix),this._viewMatrixDirty=!1),this._viewNormalMatrix):this.scene.camera.viewNormalMatrix}get backfaces(){return this._backfaces}set backfaces(e){e=!!e,this._backfaces=e,this.glRedraw()}get entityList(){return this._nodeList}get isEntity(){return!0}get isModel(){return this._isModel}get isObject(){return!1}get aabb(){return this._aabbDirty&&this._rebuildAABB(),this._aabb}get numTriangles(){return this._numTriangles}get numLines(){return this._numLines}get numPoints(){return this._numPoints}get visible(){return this.numVisibleLayerPortions>0}set visible(e){e=!1!==e,this._visible=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].visible=e;this.glRedraw()}get xrayed(){return this.numXRayedLayerPortions>0}set xrayed(e){e=!!e,this._xrayed=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].xrayed=e;this.glRedraw()}get highlighted(){return this.numHighlightedLayerPortions>0}set highlighted(e){e=!!e,this._highlighted=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].highlighted=e;this.glRedraw()}get selected(){return this.numSelectedLayerPortions>0}set selected(e){e=!!e,this._selected=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].selected=e;this.glRedraw()}get edges(){return this.numEdgesLayerPortions>0}set edges(e){e=!!e,this._edges=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].edges=e;this.glRedraw()}get culled(){return this._culled}set culled(e){e=!!e,this._culled=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].culled=e;this.glRedraw()}get clippable(){return this._clippable}set clippable(e){e=!1!==e,this._clippable=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].clippable=e;this.glRedraw()}get collidable(){return this._collidable}set collidable(e){e=!1!==e,this._collidable=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].collidable=e}get pickable(){return this.numPickableLayerPortions>0}set pickable(e){e=!1!==e,this._pickable=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].pickable=e}get colorize(){return this._colorize}set colorize(e){this._colorize=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].colorize=e}get opacity(){return this._opacity}set opacity(e){this._opacity=e;for(let t=0,s=this._nodeList.length;t<s;t++)this._nodeList[t].opacity=e}get castsShadow(){return this._castsShadow}set castsShadow(e){(e=!1!==e)!==this._castsShadow&&(this._castsShadow=e,this.glRedraw())}get receivesShadow(){return this._receivesShadow}set receivesShadow(e){(e=!1!==e)!==this._receivesShadow&&(this._receivesShadow=e,this.glRedraw())}get saoEnabled(){return this._saoEnabled}get pbrEnabled(){return this._pbrEnabled}get colorTextureEnabled(){return this._colorTextureEnabled}get isDrawable(){return!0}get isStateSortable(){return!1}get xrayMaterial(){return this.scene.xrayMaterial}get highlightMaterial(){return this.scene.highlightMaterial}get selectedMaterial(){return this.scene.selectedMaterial}get edgeMaterial(){return this.scene.edgeMaterial}getPickViewMatrix(e){return this._viewMatrix?this._viewMatrix:e}createGeometry(e){const t=e.id;if(null==t)return void this.error("Config missing: id");if(this._geometries[t])return void this.error("Geometry already created: "+t);const s=e.primitive;if(null==s)return void this.error("Param expected: primitive");if("points"!==s&&"lines"!==s&&"triangles"!==s&&"solid"!==s&&"surface"!==s)return void this.error(`Unsupported value for 'primitive': '${s}' - supported values are 'points', 'lines', 'triangles', 'solid' and 'surface'. Defaulting to 'triangles'.`);if(!e.positions&&!e.positionsCompressed)return this.error("Param expected: `positions` or `positionsCompressed'"),null;if(e.positionsCompressed&&!e.positionsDecodeMatrix)return this.error("Param expected: `positionsDecodeMatrix` (required for `positionsCompressed')"),null;if(e.uvCompressed&&!e.uvDecodeMatrix)return this.error("Param expected: `uvDecodeMatrix` (required for `uvCompressed')"),null;if(!e.indices&&"points"!==s)return this.error(`Param expected: indices (required for '${s}' primitive type)`),null;const i=new Pc(t,this,e);this._geometries[t]=i,this._numTriangles+=e.indices?Math.round(e.indices.length/3):0,this.numGeometries++}createTexture(e){const t=e.id;if(null==t)return void this.error("Config missing: id");if(this._textures[t])return void this.error("Texture already created: "+t);if(!e.src&&!e.image&&!e.buffers)return this.error("Param expected: `src`, `image' or 'buffers'"),null;let s=e.minFilter||1008;1006!==s&&1007!==s&&1008!==s&&1005!==s&&1004!==s&&(this.error("[createTexture] Unsupported value for 'minFilter' - \n            supported values are LinearFilter, LinearMipMapNearestFilter, NearestMipMapNearestFilter, \n            NearestMipMapLinearFilter and LinearMipmapLinearFilter. Defaulting to LinearMipmapLinearFilter."),s=1008);let i=e.magFilter||1006;1006!==i&&1003!==i&&(this.error("[createTexture] Unsupported value for 'magFilter' - supported values are LinearFilter and NearestFilter. Defaulting to LinearFilter."),i=1006);let r=e.wrapS||1e3;1001!==r&&1002!==r&&1e3!==r&&(this.error("[createTexture] Unsupported value for 'wrapS' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),r=1e3);let o=e.wrapT||1e3;1001!==o&&1002!==o&&1e3!==o&&(this.error("[createTexture] Unsupported value for 'wrapT' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),o=1e3);let n=e.wrapR||1e3;1001!==n&&1002!==n&&1e3!==n&&(this.error("[createTexture] Unsupported value for 'wrapR' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),n=1e3);let a=e.encoding||3e3;3e3!==a&&3001!==a&&(this.error("[createTexture] Unsupported value for 'encoding' - supported values are LinearEncoding and sRGBEncoding. Defaulting to LinearEncoding."),a=3e3);const h=new Pn({gl:this.scene.canvas.gl,minFilter:s,magFilter:i,wrapS:r,wrapT:o,wrapR:n,encoding:a});if(e.preloadColor&&h.setPreloadColor(e.preloadColor),e.image){const t=e.image;t.crossOrigin="Anonymous",h.setImage(t,{minFilter:s,magFilter:i,wrapS:r,wrapT:o,wrapR:n,flipY:e.flipY,encoding:a})}else if(e.src){const t=e.src.split(".").pop();switch(t){case"jpeg":case"jpg":case"png":case"gif":const l=new Image;l.onload=()=>{h.setImage(l,{minFilter:s,magFilter:i,wrapS:r,wrapT:o,wrapR:n,flipY:e.flipY,encoding:a}),this.glRedraw()},l.src=e.src;break;default:this._textureTranscoder?y.loadArraybuffer(e.src,(e=>{e.byteLength?this._textureTranscoder.transcode([e],h).then((()=>{this.glRedraw()})):this.error("Can't create texture from 'src': file data is zero length")}),(function(e){this.error(`Can't create texture from 'src': ${e}`)})):this.error(`Can't create texture from 'src' - VBOSceneModel needs to be configured with a TextureTranscoder for this file type ('${t}')`)}}else e.buffers&&(this._textureTranscoder?this._textureTranscoder.transcode(e.buffers,h).then((()=>{this.glRedraw()})):this.error("Can't create texture from 'buffers' - VBOSceneModel needs to be configured with a TextureTranscoder for this option"));this._textures[t]=new Tc({id:t,texture:h})}createTextureSet(e){const t=e.id;if(null==t)return void this.error("Config missing: id");if(this._textureSets[t])return void this.error(`Texture set already created: ${t}`);let s,i,r,o,n;if(void 0!==e.colorTextureId&&null!==e.colorTextureId){if(s=this._textures[e.colorTextureId],!s)return void this.error(`Texture not found: ${e.colorTextureId} - ensure that you create it first with createTexture()`)}else s=this._textures.defaultColorTexture;if(void 0!==e.metallicRoughnessTextureId&&null!==e.metallicRoughnessTextureId){if(i=this._textures[e.metallicRoughnessTextureId],!i)return void this.error(`Texture not found: ${e.metallicRoughnessTextureId} - ensure that you create it first with createTexture()`)}else i=this._textures.defaultMetalRoughTexture;if(void 0!==e.normalsTextureId&&null!==e.normalsTextureId){if(r=this._textures[e.normalsTextureId],!r)return void this.error(`Texture not found: ${e.normalsTextureId} - ensure that you create it first with createTexture()`)}else r=this._textures.defaultNormalsTexture;if(void 0!==e.emissiveTextureId&&null!==e.emissiveTextureId){if(o=this._textures[e.emissiveTextureId],!o)return void this.error(`Texture not found: ${e.emissiveTextureId} - ensure that you create it first with createTexture()`)}else o=this._textures.defaultEmissiveTexture;if(void 0!==e.occlusionTextureId&&null!==e.occlusionTextureId){if(n=this._textures[e.occlusionTextureId],!n)return void this.error(`Texture not found: ${e.occlusionTextureId} - ensure that you create it first with createTexture()`)}else n=this._textures.defaultOcclusionTexture;const a=new xc({id:t,model:this,colorTexture:s,metallicRoughnessTexture:i,normalsTexture:r,emissiveTexture:o,occlusionTexture:n});this._textureSets[t]=a}createMesh(e){let t=e.id;if(null==t)return void this.error("Config missing: id");if(this._meshes[t])return void this.error(`VBOSceneModel already has a mesh with this ID: ${t}`);const s=e.geometryId,i=void 0!==e.geometryId;if(i&&!this._geometries[e.geometryId])return void this.error(`Geometry not found: ${e.geometryId} - ensure that you create it first with createGeometry()`);const r=e.textureSetId||"defaultTextureSet";if(r&&!this._textureSets[r])return void this.error(`Texture set not found: ${r} - ensure that you create it first with createTextureSet()`);let o;const n=e.color?new Uint8Array([Math.floor(255*e.color[0]),Math.floor(255*e.color[1]),Math.floor(255*e.color[2])]):[255,255,255],a=void 0!==e.opacity&&null!==e.opacity?Math.floor(255*e.opacity):255,h=void 0!==e.metallic&&null!==e.metallic?Math.floor(255*e.metallic):0,l=void 0!==e.roughness&&null!==e.roughness?Math.floor(255*e.roughness):255,u=new Ua(this,t,n,a),c=u.pickId,d=new Uint8Array([255&c,c>>8&255,c>>16&255,c>>24&255]),m=p.collapseAABB3();let f;if(i){let t,i=this._worldMatrixNonIdentity?this._worldMatrix:null;if(e.matrix)t=e.matrix;else{const s=e.scale||Nc,i=e.position||kc,r=e.rotation||jc;p.eulerToQuaternion(r,"XYZ",Gc),t=p.composeMat4(i,Gc,s,Lc)}const c=e.origin||e.rtcCenter,g=c?p.addVec3(this._origin,c,Bc):this._origin,_=this._getInstancingLayer(g,r,s);f=_,o=_.createPortion({color:n,metallic:h,roughness:l,opacity:a,meshMatrix:t,worldMatrix:i,aabb:m,pickColor:d}),p.expandAABB3(this._aabb,m);const y=Math.round(_.numIndices/3);this._numTriangles+=y,u.numTriangles=y,u.origin=g}else{let t=e.primitive;if(null==t&&(t="triangles"),"points"!==t&&"lines"!==t&&"triangles"!==t&&"solid"!==t&&"surface"!==t)return void this.error(`Unsupported value for 'primitive': '${t}'  ('geometryId' is absent) - supported values are 'points', 'lines', 'triangles', 'solid' and 'surface'.`);if(!e.positions&&!e.positionsCompressed)return this.error("Param expected: 'positions' or 'positionsCompressed'  ('geometryId' is absent)"),null;if(e.positions&&e.positionsCompressed)return this.error("Only one param expected, not both: 'positions' or 'positionsCompressed' ('geometryId' is absent)"),null;if(e.positionsCompressed&&!e.positionsDecodeMatrix)return this.error("Param expected: 'positionsDecodeMatrix' (required for 'positionsCompressed'; 'geometryId' is absent)"),null;if(e.uvCompressed&&!e.uvDecodeMatrix)return this.error("Param expected: `uvDecodeMatrix` (required for `uvCompressed'; 'geometryId' is absent)"),null;if(!e.indices&&"points"!==t)return this.error(`Param expected: indices (required for '${t}' primitive type)`),null;if(!e.indices&&"points"!==t)return this.error("Config expected: indices (no meshIds provided, so expecting geometry arrays instead)"),null;let s=e.indices,i=e.edgeIndices,c=e.origin||e.rtcCenter?p.addVec3(this._origin,e.origin||e.rtcCenter,Bc):this._origin,g=e.positions;if(g){const e=p.vec3(),t=[];W(g,t,e)&&(g=t,c=p.addVec3(c,e,e))}let _=!1;if(this._lastOrigin?p.compareVec3(this._lastOrigin,c)||(_=!0,this._lastOrigin.set(c)):(_=!0,this._lastOrigin=p.vec3(c)),e.positionsDecodeMatrix&&(this._lastPositionsDecodeMatrix?p.compareMat4(this._lastPositionsDecodeMatrix,e.positionsDecodeMatrix)||(_=!0,this._lastPositionsDecodeMatrix.set(e.positionsDecodeMatrix)):(_=!0,this._lastPositionsDecodeMatrix=p.mat4(e.positionsDecodeMatrix))),e.uvDecodeMatrix&&(this._lastUVDecodeMatrix?p.compareMat4(this._lastUVDecodeMatrix,e.uvDecodeMatrix)||(_=!0,this._lastUVDecodeMatrix.set(e.uvDecodeMatrix)):(_=!0,this._lastUVDecodeMatrix=p.mat4(e.uvDecodeMatrix))),e.textureSetId&&this._lastTextureSetId!==e.textureSetId&&(_=!0,this._lastTextureSetId=e.textureSetId),_){for(let e in this._currentBatchingLayers)this._currentBatchingLayers.hasOwnProperty(e)&&this._currentBatchingLayers[e].finalize();this._currentBatchingLayers={}}const y=!!e.normals&&e.normals.length>0;if("triangles"===t||"solid"===t||"surface"===t){if(null!==this._lastNormals&&y!==this._lastNormals)for(let e in this._currentBatchingLayers)this._currentBatchingLayers[e]&&(this._currentBatchingLayers[e].finalize(),delete this._currentBatchingLayers[e]);this._lastNormals=y}const v=this._worldMatrixNonIdentity?this._worldMatrix:null;let b;if(!e.positionsDecodeMatrix)if(e.matrix)b=e.matrix;else{const t=e.scale||Nc,s=e.position||kc,i=e.rotation||jc;p.eulerToQuaternion(i,"XYZ",Gc),b=p.composeMat4(s,Gc,t,Lc)}const x=r?this._textureSets[r]:null,P=`${t}-${e.normals&&e.normals.length>0?1:0}-${e.normalsCompressed&&e.normalsCompressed.length>0?1:0}-${e.colors&&e.colors.length>0?1:0}-${e.colorsCompressed&&e.colorsCompressed.length>0?1:0}-${e.uv&&e.uv.length>0?1:0}-${e.uvCompressed&&e.uvCompressed.length>0?1:0}`;f=this._currentBatchingLayers[P];const T=(g||e.positionsCompressed).length;switch(t){case"triangles":case"solid":case"surface":f&&(f.canCreatePortion(T,s.length)||(f.finalize(),delete this._currentBatchingLayers[P],f=null)),f||(f=new ll({model:this,textureSet:x,layerIndex:0,scratchMemory:this._scratchMemory,positionsDecodeMatrix:e.positionsDecodeMatrix,uvDecodeMatrix:e.uvDecodeMatrix,origin:c,maxGeometryBatchSize:this._maxGeometryBatchSize,solid:"solid"===t,autoNormals:!y}),this._layerList.push(f),this._currentBatchingLayers[P]=f),i||(i=Ve(g||e.positionsCompressed,s,null,this._edgeThreshold)),o=f.createPortion({positions:g,positionsCompressed:e.positionsCompressed,normals:e.normals,normalsCompressed:e.normalsCompressed,colors:e.colors,colorsCompressed:e.colorsCompressed,uv:e.uv,uvCompressed:e.uvCompressed,indices:s,edgeIndices:i,color:n,opacity:a,metallic:h,roughness:l,meshMatrix:b,worldMatrix:v,worldAABB:m,pickColor:d});const r=Math.round(s.length/3);this._numTriangles+=r,u.numTriangles=r;break;case"lines":f&&(f.canCreatePortion(T,s.length)||(f.finalize(),delete this._currentBatchingLayers[P],f=null)),f||(f=new vu({model:this,layerIndex:0,scratchMemory:this._scratchMemory,positionsDecodeMatrix:e.positionsDecodeMatrix,origin:c,maxGeometryBatchSize:this._maxGeometryBatchSize}),this._layerList.push(f),this._currentBatchingLayers[P]=f),o=f.createPortion({positions:g,positionsCompressed:e.positionsCompressed,indices:s,colors:e.colors,colorsCompressed:e.colorsCompressed,color:n,opacity:a,meshMatrix:b,worldMatrix:v,worldAABB:m,pickColor:d}),this._numLines+=Math.round(s.length/2);break;case"points":f&&(f.canCreatePortion(T)||(f.finalize(),delete this._currentBatchingLayers[P],f=null)),f||(f=new qu({model:this,layerIndex:0,scratchMemory:this._scratchMemory,positionsDecodeMatrix:e.positionsDecodeMatrix,origin:c,maxGeometryBatchSize:this._maxGeometryBatchSize}),this._layerList.push(f),this._currentBatchingLayers[P]=f),o=f.createPortion({positions:g,positionsCompressed:e.positionsCompressed,colors:e.colors,colorsCompressed:e.colorsCompressed,color:n,opacity:a,meshMatrix:b,worldMatrix:v,worldAABB:m,pickColor:d}),this._numPoints+=Math.round(T/3)}p.expandAABB3(this._aabb,m),this.numGeometries++,u.origin=c}u.parent=null,u._layer=f,u._portionId=o,u.aabb=m,this._meshes[t]=u}_getInstancingLayer(e,t,s){const i=`${e[0]}.${e[1]}.${e[2]}.${t}.${s}`;let r,o=this._instancingLayers[i];if(o)return o;if(void 0!==t&&(r=this._textureSets[t],!r))return void this.error(`TextureSet not found: ${t} - ensure that you create it first with createTextureSet()`);const n=this._geometries[s];if(this._geometries[s]){switch(n.primitive){case"triangles":case"surface":o=new nu({model:this,textureSet:r,geometry:n,origin:e,layerIndex:0,solid:!1});break;case"solid":o=new nu({model:this,textureSet:r,geometry:n,origin:e,layerIndex:0,solid:!0});break;case"lines":o=new Fu({model:this,textureSet:r,geometry:n,origin:e,layerIndex:0});break;case"points":o=new bc({model:this,textureSet:r,geometry:n,origin:e,layerIndex:0})}return this._instancingLayers[i]=o,this._layerList.push(o),o}this.error(`Geometry not found: ${s} - ensure that you create it first with createGeometry()`)}createEntity(e){let t=e.id;void 0===t?t=p.createUUID():this.scene.components[t]&&(this.error("Scene already has a Component with this ID: "+t+" - will assign random ID"),t=p.createUUID());const s=e.meshIds;if(void 0===s)return void this.error("Config missing: meshIds");let i=[];for(let e=0,t=s.length;e<t;e++){const t=s[e],r=this._meshes[t];r?r.parent?this.error("Mesh with ID "+t+" already belongs to object with ID "+r.parent.id+" - ignoring this mesh"):i.push(r):this.error("Mesh with this ID not found: "+t+" - ignoring this mesh")}let r,o=0;if(this._visible&&!1!==e.visible&&(o|=E),this._pickable&&!1!==e.pickable&&(o|=R),this._culled&&!1!==e.culled&&(o|=F),this._clippable&&!1!==e.clippable&&(o|=S),this._collidable&&!1!==e.collidable&&(o|=O),this._edges&&!1!==e.edges&&(o|=k),this._xrayed&&!1!==e.xrayed&&(o|=B),this._highlighted&&!1!==e.highlighted&&(o|=L),this._selected&&!1!==e.selected&&(o|=N),1===i.length)r=i[0].aabb;else{r=p.collapseAABB3();for(let e=0,t=i.length;e<t;e++)p.expandAABB3(r,i[e].aabb)}const n=new H(this,e.isObject,t,i,o,r);return this._nodeList.push(n),this._nodes[t]=n,this.numEntities++,n}finalize(){if(!this.destroyed){for(const e in this._instancingLayers)this._instancingLayers.hasOwnProperty(e)&&this._instancingLayers[e].finalize();for(let e in this._currentBatchingLayers)this._currentBatchingLayers.hasOwnProperty(e)&&this._currentBatchingLayers[e].finalize();this._currentBatchingLayers={};for(let e=0,t=this._nodeList.length;e<t;e++){this._nodeList[e]._finalize()}for(let e=0,t=this._nodeList.length;e<t;e++){this._nodeList[e]._finalize2()}this._layerList.sort(((e,t)=>e.sortId<t.sortId?-1:e.sortId>t.sortId?1:0));for(let e=0,t=this._layerList.length;e<t;e++){this._layerList[e].layerIndex=e}this.glRedraw(),this.scene._aabbDirty=!0}}_rebuildAABB(){p.collapseAABB3(this._aabb);for(let e=0,t=this._nodeList.length;e<t;e++){const t=this._nodeList[e];p.expandAABB3(this._aabb,t.aabb)}this._aabbDirty=!1}stateSortCompare(e,t){}rebuildRenderFlags(){this.renderFlags.reset(),this._updateRenderFlagsVisibleLayers(),this.renderFlags.numLayers>0&&0===this.renderFlags.numVisibleLayers?this.renderFlags.culled=!0:this._updateRenderFlags()}_updateRenderFlagsVisibleLayers(){const e=this.renderFlags;e.numLayers=this._layerList.length,e.numVisibleLayers=0;for(let t=0,s=this._layerList.length;t<s;t++){const s=this._layerList[t];this._getActiveSectionPlanesForLayer(s)&&(e.visibleLayers[e.numVisibleLayers++]=t)}}_getActiveSectionPlanesForLayer(e){const t=this.renderFlags,s=this.scene._sectionPlanesState.sectionPlanes,i=s.length,r=e.layerIndex*i;if(i>0)for(let e=0;e<i;e++){s[e].active?(t.sectionPlanesActivePerLayer[r+e]=!0,t.sectioned=!0):t.sectionPlanesActivePerLayer[r+e]=!1}return!0}_updateRenderFlags(){if(0===this.numVisibleLayerPortions)return;if(this.numCulledLayerPortions===this.numPortions)return;const e=this.renderFlags;if(e.colorOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.colorTransparent=!0),this.numXRayedLayerPortions>0){const t=this.scene.xrayMaterial._state;t.fill&&(t.fillAlpha<1?e.xrayedSilhouetteTransparent=!0:e.xrayedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.xrayedEdgesTransparent=!0:e.xrayedEdgesOpaque=!0)}if(this.numEdgesLayerPortions>0){this.scene.edgeMaterial._state.edges&&(e.edgesOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.edgesTransparent=!0))}if(this.numSelectedLayerPortions>0){const t=this.scene.selectedMaterial._state;t.fill&&(t.fillAlpha<1?e.selectedSilhouetteTransparent=!0:e.selectedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.selectedEdgesTransparent=!0:e.selectedEdgesOpaque=!0)}if(this.numHighlightedLayerPortions>0){const t=this.scene.highlightMaterial._state;t.fill&&(t.fillAlpha<1?e.highlightedSilhouetteTransparent=!0:e.highlightedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.highlightedEdgesTransparent=!0:e.highlightedEdgesOpaque=!0)}}drawColorOpaque(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawColorOpaque(t,e)}}drawColorTransparent(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawColorTransparent(t,e)}}drawDepth(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawDepth(t,e)}}drawNormals(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawNormals(t,e)}}drawSilhouetteXRayed(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawSilhouetteXRayed(t,e)}}drawSilhouetteHighlighted(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawSilhouetteHighlighted(t,e)}}drawSilhouetteSelected(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawSilhouetteSelected(t,e)}}drawEdgesColorOpaque(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawEdgesColorOpaque(t,e)}}drawEdgesColorTransparent(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawEdgesColorTransparent(t,e)}}drawEdgesXRayed(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawEdgesXRayed(t,e)}}drawEdgesHighlighted(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawEdgesHighlighted(t,e)}}drawEdgesSelected(e){const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawEdgesSelected(t,e)}}drawOcclusion(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawOcclusion(t,e)}}drawShadow(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawShadow(t,e)}}drawPickMesh(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawPickMesh(t,e)}}drawPickDepths(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawPickDepths(t,e)}}drawPickNormals(e){if(0===this.numVisibleLayerPortions)return;const t=this.renderFlags;for(let s=0,i=t.visibleLayers.length;s<i;s++){const i=t.visibleLayers[s];this._layerList[i].drawPickNormals(t,e)}}destroy(){for(let e in this._currentBatchingLayers)this._currentBatchingLayers.hasOwnProperty(e)&&this._currentBatchingLayers[e].destroy();this._currentBatchingLayers={},this.scene.camera.off(this._onCameraViewMatrix);for(let e=0,t=this._layerList.length;e<t;e++)this._layerList[e].destroy();for(let e=0,t=this._nodeList.length;e<t;e++)this._nodeList[e]._destroy();Object.entries(this._geometries).forEach((([e,t])=>{t.destroy()})),this._geometries={},this._textures={},this._textureSets={},this._meshes={},this._nodes={},this.scene._aabbDirty=!0,this._isModel&&this.scene._deregisterModel(this),0!==Wa&&(Wa--,0===Wa&&za._clear()),super.destroy()}}class Vc extends Hc{constructor(e,t={}){super(e,t)}}class Uc extends A{constructor(e,t={}){super(e,t),this._skyboxMesh=new Ko(this,{geometry:new Mi(this,{primitive:"triangles",positions:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],uv:[.5,.6666,.25,.6666,.25,.3333,.5,.3333,.5,.6666,.5,.3333,.75,.3333,.75,.6666,.5,.6666,.5,1,.25,1,.25,.6666,.25,.6666,0,.6666,0,.3333,.25,.3333,.25,0,.5,0,.5,.3333,.25,.3333,.75,.3333,1,.3333,1,.6666,.75,.6666],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}),background:!0,scale:[2e3,2e3,2e3],rotation:[0,-90,0],material:new Ei(this,{ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],emissive:[1,1,1],emissiveMap:new Dn(this,{src:t.src,flipY:!0,wrapS:"clampToEdge",wrapT:"clampToEdge",encoding:t.encoding||"sRGB"}),backfaces:!0}),visible:!1,pickable:!1,clippable:!1,collidable:!1}),this.size=t.size,this.active=t.active}set size(e){this._size=e||1e3,this._skyboxMesh.scale=[this._size,this._size,this._size]}get size(){return this._size}set active(e){this._skyboxMesh.visible=e}get active(){return this._skyboxMesh.visible}}class zc{transcode(e,t,s={}){}destroy(){}}const Wc=p.vec4(),Xc=p.vec4(),Yc=p.vec3(),Kc=p.vec3(),Jc=p.vec3(),Zc=p.vec4(),Qc=p.vec4(),qc=p.vec4();class $c{constructor(e){this._scene=e}dollyToCanvasPos(e,t,s){let i=!1;const r=this._scene.camera;if(e){const t=p.subVec3(e,r.eye,Yc);i=p.lenVec3(t)<s}if("perspective"===r.projection){r.ortho.scale=r.ortho.scale-s;const i=this._unproject(t,Zc),o=p.subVec3(i,r.eye,qc),n=p.mulVec3Scalar(p.normalizeVec3(o),-s,[]);if(r.eye=[r.eye[0]-n[0],r.eye[1]-n[1],r.eye[2]-n[2]],r.look=[r.look[0]-n[0],r.look[1]-n[1],r.look[2]-n[2]],e){const t=p.subVec3(e,r.eye,Yc),s=p.lenVec3(t),i=p.mulVec3Scalar(p.normalizeVec3(p.subVec3(r.look,r.eye,Kc)),s);r.look=[r.eye[0]+i[0],r.eye[1]+i[1],r.eye[2]+i[2]]}}else if("ortho"===r.projection){const e=this._unproject(t,Zc);r.ortho.scale=r.ortho.scale-s,r.ortho._update();const i=this._unproject(t,Qc),o=p.subVec3(i,e,qc),n=p.mulVec3Scalar(p.normalizeVec3(p.subVec3(r.look,r.eye,Yc)),-s,Kc),a=p.addVec3(o,n,Jc);r.eye=[r.eye[0]-a[0],r.eye[1]-a[1],r.eye[2]-a[2]],r.look=[r.look[0]-a[0],r.look[1]-a[1],r.look[2]-a[2]]}return i}_unproject(e,t){const s=this._scene.camera,i=s.project.transposedMatrix,r=i.subarray(8,12),o=i.subarray(12),n=[0,0,-1,1],a=p.dotVec4(n,r)/p.dotVec4(n,o);return s.project.unproject(e,a,Wc,Xc,t),t}destroy(){}}const ep=p.vec3(),tp=p.vec3(),sp=p.vec3(),ip=p.vec4(),rp=p.vec4(),op=p.vec4();class np{constructor(e,t){this._scene=e,this._configs=t,this._pivotWorldPos=p.vec3(),this._cameraOffset=p.vec3(),this._azimuth=0,this._polar=0,this._radius=0,this._pivotPosSet=!1,this._pivoting=!1,this._shown=!1,this._pivotViewPos=p.vec4(),this._pivotProjPos=p.vec4(),this._pivotCanvasPos=p.vec2(),this._cameraDirty=!0,this._onViewMatrix=this._scene.camera.on("viewMatrix",(()=>{this._cameraDirty=!0})),this._onProjMatrix=this._scene.camera.on("projMatrix",(()=>{this._cameraDirty=!0})),this._onTick=this._scene.on("tick",(()=>{this.updatePivotElement()}))}updatePivotElement(){const e=this._scene.camera,t=this._scene.canvas;if(this._pivoting&&this._cameraDirty){p.transformPoint3(e.viewMatrix,this.getPivotPos(),this._pivotViewPos),this._pivotViewPos[3]=1,p.transformPoint4(e.projMatrix,this._pivotViewPos,this._pivotProjPos);const s=t.boundary,i=s[2],r=s[3];this._pivotCanvasPos[0]=Math.floor((1+this._pivotProjPos[0]/this._pivotProjPos[3])*i/2),this._pivotCanvasPos[1]=Math.floor((1-this._pivotProjPos[1]/this._pivotProjPos[3])*r/2);let o=t._lastBoundingClientRect;if(!o||t._canvasSizeChanged){const e=t.canvas;o=t._lastBoundingClientRect=e.getBoundingClientRect()}this._pivotElement&&(this._pivotElement.style.left=Math.floor(o.left+this._pivotCanvasPos[0])-this._pivotElement.clientWidth/2+window.scrollX+"px",this._pivotElement.style.top=Math.floor(o.top+this._pivotCanvasPos[1])-this._pivotElement.clientHeight/2+window.scrollY+"px"),this._cameraDirty=!1}}setPivotElement(e){this._pivotElement=e}startPivot(){if(this._cameraLookingDownwards())return this._pivoting=!1,!1;const e=this._scene.camera;let t=p.lookAtMat4v(e.eye,e.look,e.worldUp);p.transformPoint3(t,this.getPivotPos(),this._cameraOffset);const s=this.getPivotPos();this._cameraOffset[2]+=p.distVec3(e.eye,s),t=p.inverseMat4(t);const i=p.transformVec3(t,this._cameraOffset),r=p.vec3();if(p.subVec3(e.eye,s,r),p.addVec3(r,i),e.zUp){const e=r[1];r[1]=r[2],r[2]=e}this._radius=p.lenVec3(r),this._polar=Math.acos(r[1]/this._radius),this._azimuth=Math.atan2(r[0],r[2]),this._pivoting=!0}_cameraLookingDownwards(){const e=this._scene.camera,t=p.normalizeVec3(p.subVec3(e.look,e.eye,ep)),s=p.cross3Vec3(t,e.worldUp,tp);return p.sqLenVec3(s)<=1e-4}getPivoting(){return this._pivoting}setPivotPos(e){this._pivotWorldPos.set(e),this._pivotPosSet=!0}setCanvasPivotPos(e){const t=this._scene.camera,s=Math.abs(p.distVec3(this._scene.center,t.eye)),i=t.project.transposedMatrix,r=i.subarray(8,12),o=i.subarray(12),n=[0,0,-1,1],a=p.dotVec4(n,r)/p.dotVec4(n,o),h=ip;t.project.unproject(e,a,rp,op,h);const l=p.normalizeVec3(p.subVec3(h,t.eye,ep)),u=p.addVec3(t.eye,p.mulVec3Scalar(l,s,tp),sp);this.setPivotPos(u)}getPivotPos(){return this._pivotPosSet?this._pivotWorldPos:this._scene.camera.look}continuePivot(e,t){if(!this._pivoting)return;if(0===e&&0===t)return;const s=this._scene.camera;var i=-e;const r=-t;1===s.worldUp[2]&&(i=-i),this._azimuth+=.01*-i,this._polar+=.01*r,this._polar=p.clamp(this._polar,.001,Math.PI-.001);const o=[this._radius*Math.sin(this._polar)*Math.sin(this._azimuth),this._radius*Math.cos(this._polar),this._radius*Math.sin(this._polar)*Math.cos(this._azimuth)];if(1===s.worldUp[2]){const e=o[1];o[1]=o[2],o[2]=e}const n=p.lenVec3(p.subVec3(s.look,s.eye,p.vec3())),a=this.getPivotPos();p.addVec3(o,a);let h=p.lookAtMat4v(o,a,s.worldUp);h=p.inverseMat4(h);const l=p.transformVec3(h,this._cameraOffset);h[12]-=l[0],h[13]-=l[1],h[14]-=l[2];const u=[h[8],h[9],h[10]];s.eye=[h[12],h[13],h[14]],p.subVec3(s.eye,p.mulVec3Scalar(u,n),s.look),s.up=[h[4],h[5],h[6]],this.showPivot()}showPivot(){this._shown||(null!==this._hideTimeout&&(window.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._pivotElement&&(this.updatePivotElement(),this._pivotElement.style.visibility="visible",this._shown=!0,this._hideTimeout=window.setTimeout((()=>{this.hidePivot()}),1e3)))}hidePivot(){this._shown&&(null!==this._hideTimeout&&(window.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._pivotElement&&(this._pivotElement.style.visibility="hidden"),this._shown=!1)}endPivot(){this._pivoting=!1}destroy(){this._scene.camera.off(this._onViewMatrix),this._scene.camera.off(this._onProjMatrix),this._scene.off(this._onTick)}}class ap{constructor(e,t){this._scene=e.scene,this._cameraControl=e,this._scene.canvas.canvas.oncontextmenu=function(e){e.preventDefault()},this._configs=t,this.schedulePickEntity=!1,this.schedulePickSurface=!1,this.pickCursorPos=p.vec2(),this.picked=!1,this.pickedSurface=!1,this.pickResult=null,this._lastPickedEntityId=null,this._needFireEvents=!1}update(){if(!this._configs.pointerEnabled)return;if(!this.schedulePickEntity&&!this.schedulePickSurface)return;this.picked=!1,this.pickedSurface=!1,this._needFireEvents=!1;const e=this._cameraControl.hasSubs("hoverSurface");if(this.schedulePickSurface&&this.pickResult&&this.pickResult.worldPos){const t=this.pickResult.canvasPos;if(t[0]===this.pickCursorPos[0]&&t[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!0,this._needFireEvents=e,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}if(this.schedulePickEntity&&this.pickResult){const e=this.pickResult.canvasPos;if(e[0]===this.pickCursorPos[0]&&e[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!1,this._needFireEvents=!1,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}this.schedulePickSurface?(this.pickResult=this._scene.pick({pickSurface:!0,pickSurfaceNormal:!1,canvasPos:this.pickCursorPos}),this.pickResult&&(this.picked=!0,this.pickedSurface=!0,this._needFireEvents=!0)):(this.pickResult=this._scene.pick({canvasPos:this.pickCursorPos}),this.pickResult&&(this.picked=!0,this.pickedSurface=!1,this._needFireEvents=!0)),this.schedulePickEntity=!1,this.schedulePickSurface=!1}fireEvents(){if(this._needFireEvents){if(this.picked&&this.pickResult&&this.pickResult.entity){const e=this.pickResult.entity.id;this._lastPickedEntityId!==e&&(void 0!==this._lastPickedEntityId&&this._cameraControl.fire("hoverOut",{entity:this._scene.objects[this._lastPickedEntityId]},!0),this._cameraControl.fire("hoverEnter",this.pickResult,!0),this._lastPickedEntityId=e),this._cameraControl.fire("hover",this.pickResult,!0),this.pickResult.worldPos&&(this.pickedSurface=!0,this._cameraControl.fire("hoverSurface",this.pickResult,!0))}else void 0!==this._lastPickedEntityId&&(this._cameraControl.fire("hoverOut",{entity:this._scene.objects[this._lastPickedEntityId]},!0),this._lastPickedEntityId=void 0),this._cameraControl.fire("hoverOff",{canvasPos:this.pickCursorPos},!0);this.pickResult=null,this._needFireEvents=!1}}destroy(){}}const hp=p.vec2();class lp{constructor(e,t,s,i,r){this._scene=e;const o=t.pickController;let n,a,h,l=0,u=0,c=0,d=0,m=!1;const f=p.vec3();let g=!0;const _=this._scene.canvas.canvas,y=[];function v(e=!0){_.style.cursor="move",l=i.pointerCanvasPos[0],u=i.pointerCanvasPos[1],c=i.pointerCanvasPos[0],d=i.pointerCanvasPos[1],e&&(o.pickCursorPos=i.pointerCanvasPos,o.schedulePickSurface=!0,o.update(),o.picked&&o.pickedSurface&&o.pickResult&&o.pickResult.worldPos?(m=!0,f.set(o.pickResult.worldPos)):m=!1)}document.addEventListener("keydown",this._documentKeyDownHandler=t=>{if(!s.active||!s.pointerEnabled||!e.input.keyboardEnabled)return;const i=t.keyCode;y[i]=!0}),document.addEventListener("keyup",this._documentKeyUpHandler=t=>{if(!s.active||!s.pointerEnabled||!e.input.keyboardEnabled)return;const i=t.keyCode;y[i]=!1}),_.addEventListener("mousedown",this._mouseDownHandler=t=>{if(s.active&&s.pointerEnabled)switch(t.which){case 1:y[e.input.KEY_SHIFT]||s.planView?(n=!0,v()):(n=!0,v(!1));break;case 2:a=!0,v();break;case 3:h=!0,s.panRightClick&&v()}}),document.addEventListener("mousemove",this._documentMouseMoveHandler=()=>{if(!s.active||!s.pointerEnabled)return;if(!n&&!a&&!h)return;const t=e.canvas.boundary,o=t[2],c=t[3],d=i.pointerCanvasPos[0],g=i.pointerCanvasPos[1];if(y[e.input.KEY_SHIFT]||s.planView||!s.panRightClick&&a||s.panRightClick&&h){const t=d-l,s=g-u,i=e.camera;if("perspective"===i.projection){const o=Math.abs(m?p.lenVec3(p.subVec3(f,e.camera.eye,[])):e.camera.eyeLookDist)*Math.tan(i.perspective.fov/2*Math.PI/180);r.panDeltaX+=1.5*t*o/c,r.panDeltaY+=1.5*s*o/c}else r.panDeltaX+=.5*i.ortho.scale*(t/c),r.panDeltaY+=.5*i.ortho.scale*(s/c)}else!n||a||h||s.planView||(s.firstPerson?(r.rotateDeltaY-=(d-l)/o*s.dragRotationRate/2,r.rotateDeltaX+=(g-u)/c*(s.dragRotationRate/4)):(r.rotateDeltaY-=(d-l)/o*(1.5*s.dragRotationRate),r.rotateDeltaX+=(g-u)/c*(1.5*s.dragRotationRate)));l=d,u=g}),_.addEventListener("mousemove",this._canvasMouseMoveHandler=e=>{s.active&&s.pointerEnabled&&i.mouseover&&(g=!0)}),document.addEventListener("mouseup",this._documentMouseUpHandler=e=>{if(s.active&&s.pointerEnabled)switch(e.which){case 1:case 2:case 3:n=!1,a=!1,h=!1}}),_.addEventListener("mouseup",this._mouseUpHandler=e=>{if(s.active&&s.pointerEnabled){if(3===e.which){!function(e,t){if(e){let s=e.target,i=0,r=0;for(;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;t[0]=e.pageX-i,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y}(e,hp);const s=hp[0],i=hp[1];Math.abs(s-c)<3&&Math.abs(i-d)<3&&t.cameraControl.fire("rightClick",{pagePos:[Math.round(e.pageX),Math.round(e.pageY)],canvasPos:hp,event:e},!0)}_.style.removeProperty("cursor")}}),_.addEventListener("mouseenter",this._mouseEnterHandler=()=>{s.active&&s.pointerEnabled});const b=1/60;let x=null;_.addEventListener("wheel",this._mouseWheelHandler=e=>{if(!s.active||!s.pointerEnabled)return;const t=performance.now()/1e3;var o=null!==x?t-x:0;x=t,o>.05&&(o=.05),o<b&&(o=b);const n=Math.max(-1,Math.min(1,40*-e.deltaY));if(0===n)return;const a=n/Math.abs(n);r.dollyDelta+=-a*o*s.mouseWheelDollyRate,g&&(i.followPointerDirty=!0,g=!1)},{passive:!0})}reset(){}destroy(){const e=this._scene.canvas.canvas;document.removeEventListener("keydown",this._documentKeyDownHandler),document.removeEventListener("keyup",this._documentKeyUpHandler),e.removeEventListener("mousedown",this._mouseDownHandler),document.removeEventListener("mousemove",this._documentMouseMoveHandler),e.removeEventListener("mousemove",this._canvasMouseMoveHandler),document.removeEventListener("mouseup",this._documentMouseUpHandler),e.removeEventListener("mouseup",this._mouseUpHandler),e.removeEventListener("mouseenter",this._mouseEnterHandler),e.removeEventListener("wheel",this._mouseWheelHandler)}}const up=p.vec3(),cp=p.vec3(),pp=p.vec3(),dp=p.vec3(),mp=p.vec3(),fp={eye:p.vec3(),look:p.vec3(),up:p.vec3()};class gp{constructor(e,t,s,i){this._scene=e;const r=t.cameraControl,o=e.camera;this._onSceneKeyDown=e.input.on("keydown",(()=>{if(!s.active||!s.pointerEnabled||!e.input.keyboardEnabled)return;if(!i.mouseover)return;const n=r._isKeyDownForAction(r.AXIS_VIEW_RIGHT),a=r._isKeyDownForAction(r.AXIS_VIEW_BACK),h=r._isKeyDownForAction(r.AXIS_VIEW_LEFT),l=r._isKeyDownForAction(r.AXIS_VIEW_FRONT),u=r._isKeyDownForAction(r.AXIS_VIEW_TOP),c=r._isKeyDownForAction(r.AXIS_VIEW_BOTTOM);if(!(n||a||h||l||u||c))return;const d=e.aabb,m=p.getAABB3Diag(d);p.getAABB3Center(d,up);const f=Math.abs(m/Math.tan(t.cameraFlight.fitFOV*p.DEGTORAD)),g=1.1*m;fp.orthoScale=g,n?(fp.eye.set(p.addVec3(up,p.mulVec3Scalar(o.worldRight,f,cp),mp)),fp.look.set(up),fp.up.set(o.worldUp)):a?(fp.eye.set(p.addVec3(up,p.mulVec3Scalar(o.worldForward,f,cp),mp)),fp.look.set(up),fp.up.set(o.worldUp)):h?(fp.eye.set(p.addVec3(up,p.mulVec3Scalar(o.worldRight,-f,cp),mp)),fp.look.set(up),fp.up.set(o.worldUp)):l?(fp.eye.set(p.addVec3(up,p.mulVec3Scalar(o.worldForward,-f,cp),mp)),fp.look.set(up),fp.up.set(o.worldUp)):u?(fp.eye.set(p.addVec3(up,p.mulVec3Scalar(o.worldUp,f,cp),mp)),fp.look.set(up),fp.up.set(p.normalizeVec3(p.mulVec3Scalar(o.worldForward,1,pp),dp))):c&&(fp.eye.set(p.addVec3(up,p.mulVec3Scalar(o.worldUp,-f,cp),mp)),fp.look.set(up),fp.up.set(p.normalizeVec3(p.mulVec3Scalar(o.worldForward,-1,pp)))),!s.firstPerson&&s.followPointer&&t.pivotController.setPivotPos(up),t.cameraFlight.duration>0?t.cameraFlight.flyTo(fp,(()=>{t.pivotController.getPivoting()&&s.followPointer&&t.pivotController.showPivot()})):(t.cameraFlight.jumpTo(fp),t.pivotController.getPivoting()&&s.followPointer&&t.pivotController.showPivot())}))}reset(){}destroy(){this._scene.input.off(this._onSceneKeyDown)}}class _p{constructor(e,t,s,i,r){this._scene=e;const o=t.pickController,n=t.pivotController,a=t.cameraControl;this._clicks=0,this._timeout=null,this._lastPickedEntityId=null;let h=!1,l=!1;const u=this._scene.canvas.canvas,c=s=>{let i;s&&s.worldPos&&(i=s.worldPos);const r=s&&s.entity?s.entity.aabb:e.aabb;if(i){const s=e.camera;p.subVec3(s.eye,s.look,[]),t.cameraFlight.flyTo({aabb:r})}else t.cameraFlight.flyTo({aabb:r})};u.addEventListener("mousemove",this._canvasMouseMoveHandler=t=>{if(!s.active||!s.pointerEnabled)return;if(h||l)return;const r=a.hasSubs("hover"),n=a.hasSubs("hoverOut"),u=a.hasSubs("hoverOff"),c=a.hasSubs("hoverSurface");if(r||n||u||c)if(o.pickCursorPos=i.pointerCanvasPos,o.schedulePickEntity=!0,o.schedulePickSurface=c,o.update(),o.pickResult){const t=o.pickResult.entity.id;this._lastPickedEntityId!==t&&(void 0!==this._lastPickedEntityId&&a.fire("hoverOut",{entity:e.objects[this._lastPickedEntityId]},!0),a.fire("hoverEnter",o.pickResult,!0),this._lastPickedEntityId=t),a.fire("hover",o.pickResult,!0),o.pickResult.worldPos&&a.fire("hoverSurface",o.pickResult,!0)}else void 0!==this._lastPickedEntityId&&(a.fire("hoverOut",{entity:e.objects[this._lastPickedEntityId]},!0),this._lastPickedEntityId=void 0),a.fire("hoverOff",{canvasPos:o.pickCursorPos},!0)}),u.addEventListener("mousedown",this._canvasMouseDownHandler=t=>{1===t.which&&(h=!0),3===t.which&&(l=!0);if(1===t.which&&s.active&&s.pointerEnabled&&(i.mouseDownClientX=t.clientX,i.mouseDownClientY=t.clientY,i.mouseDownCursorX=i.pointerCanvasPos[0],i.mouseDownCursorY=i.pointerCanvasPos[1],!s.firstPerson&&s.followPointer&&(o.pickCursorPos=i.pointerCanvasPos,o.schedulePickSurface=!0,o.update(),1===t.which))){const t=o.pickResult;t&&t.worldPos?(n.setPivotPos(t.worldPos),n.startPivot()):(s.smartPivot?n.setCanvasPivotPos(i.pointerCanvasPos):n.setPivotPos(e.camera.look),n.startPivot())}}),document.addEventListener("mouseup",this._documentMouseUpHandler=e=>{1===e.which&&(h=!1),3===e.which&&(l=!1)}),u.addEventListener("mouseup",this._canvasMouseUpHandler=r=>{if(!s.active||!s.pointerEnabled)return;if(!(1===r.which))return;if(n.hidePivot(),Math.abs(r.clientX-i.mouseDownClientX)>3||Math.abs(r.clientY-i.mouseDownClientY)>3)return;const h=a.hasSubs("picked"),l=a.hasSubs("pickedNothing"),u=a.hasSubs("pickedSurface"),d=a.hasSubs("doublePicked"),m=a.hasSubs("doublePickedSurface"),f=a.hasSubs("doublePickedNothing");if(!(s.doublePickFlyTo||d||m||f))return(h||l||u)&&(o.pickCursorPos=i.pointerCanvasPos,o.schedulePickEntity=!0,o.schedulePickSurface=u,o.update(),o.pickResult?(a.fire("picked",o.pickResult,!0),o.pickedSurface&&a.fire("pickedSurface",o.pickResult,!0)):a.fire("pickedNothing",{canvasPos:i.pointerCanvasPos},!0)),void(this._clicks=0);if(this._clicks++,1===this._clicks){o.pickCursorPos=i.pointerCanvasPos,o.schedulePickEntity=s.doublePickFlyTo,o.schedulePickSurface=u,o.update();const e=o.pickResult,r=o.pickedSurface;this._timeout=setTimeout((()=>{e?(a.fire("picked",e,!0),r&&(a.fire("pickedSurface",e,!0),!s.firstPerson&&s.followPointer&&(t.pivotController.setPivotPos(e.worldPos),t.pivotController.startPivot()&&t.pivotController.showPivot()))):a.fire("pickedNothing",{canvasPos:i.pointerCanvasPos},!0),this._clicks=0}),s.doubleClickTimeFrame)}else{if(null!==this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),o.pickCursorPos=i.pointerCanvasPos,o.schedulePickEntity=s.doublePickFlyTo||d||m,o.schedulePickSurface=o.schedulePickEntity&&m,o.update(),o.pickResult){if(a.fire("doublePicked",o.pickResult,!0),o.pickedSurface&&a.fire("doublePickedSurface",o.pickResult,!0),s.doublePickFlyTo&&(c(o.pickResult),!s.firstPerson&&s.followPointer)){const e=o.pickResult.entity.aabb,s=p.getAABB3Center(e);t.pivotController.setPivotPos(s),t.pivotController.startPivot()&&t.pivotController.showPivot()}}else if(a.fire("doublePickedNothing",{canvasPos:i.pointerCanvasPos},!0),s.doublePickFlyTo&&(c(),!s.firstPerson&&s.followPointer)){const s=e.aabb,i=p.getAABB3Center(s);t.pivotController.setPivotPos(i),t.pivotController.startPivot()&&t.pivotController.showPivot()}this._clicks=0}},!1)}reset(){this._clicks=0,this._lastPickedEntityId=null,this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)}destroy(){const e=this._scene.canvas.canvas;e.removeEventListener("mousemove",this._canvasMouseMoveHandler),e.removeEventListener("mousedown",this._canvasMouseDownHandler),document.removeEventListener("mouseup",this._documentMouseUpHandler),e.removeEventListener("mouseup",this._canvasMouseUpHandler),this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)}}class yp{constructor(e,t,s,i,r){this._scene=e;const o=e.input,n=[],a=e.canvas.canvas;let h=!0;this._onSceneMouseMove=o.on("mousemove",(()=>{h=!0})),this._onSceneKeyDown=o.on("keydown",(t=>{s.active&&s.pointerEnabled&&e.input.keyboardEnabled&&i.mouseover&&(n[t]=!0,t===o.KEY_SHIFT&&(a.style.cursor="move"))})),this._onSceneKeyUp=o.on("keyup",(t=>{s.active&&s.pointerEnabled&&e.input.keyboardEnabled&&(n[t]=!1,t===o.KEY_SHIFT&&(a.style.cursor=null))})),this._onTick=e.on("tick",(a=>{if(!s.active||!s.pointerEnabled||!e.input.keyboardEnabled)return;if(!i.mouseover)return;const l=t.cameraControl,u=a.deltaTime/1e3;if(!s.planView){const e=l._isKeyDownForAction(l.ROTATE_Y_POS,n),i=l._isKeyDownForAction(l.ROTATE_Y_NEG,n),o=l._isKeyDownForAction(l.ROTATE_X_POS,n),a=l._isKeyDownForAction(l.ROTATE_X_NEG,n),h=u*s.keyboardRotationRate;(e||i||o||a)&&(!s.firstPerson&&s.followPointer&&t.pivotController.startPivot(),e?r.rotateDeltaY+=h:i&&(r.rotateDeltaY-=h),o?r.rotateDeltaX+=h:a&&(r.rotateDeltaX-=h),!s.firstPerson&&s.followPointer&&t.pivotController.startPivot())}if(!n[o.KEY_CTRL]&&!n[o.KEY_ALT]){const e=l._isKeyDownForAction(l.DOLLY_BACKWARDS,n),o=l._isKeyDownForAction(l.DOLLY_FORWARDS,n);if(e||o){const n=u*s.keyboardDollyRate;!s.firstPerson&&s.followPointer&&t.pivotController.startPivot(),o?r.dollyDelta-=n:e&&(r.dollyDelta+=n),h&&(i.followPointerDirty=!0,h=!1)}}const c=l._isKeyDownForAction(l.PAN_FORWARDS,n),p=l._isKeyDownForAction(l.PAN_BACKWARDS,n),d=l._isKeyDownForAction(l.PAN_LEFT,n),m=l._isKeyDownForAction(l.PAN_RIGHT,n),f=l._isKeyDownForAction(l.PAN_UP,n),g=l._isKeyDownForAction(l.PAN_DOWN,n),_=(n[o.KEY_ALT]?.3:1)*u*s.keyboardPanRate;(c||p||d||m||f||g)&&(!s.firstPerson&&s.followPointer&&t.pivotController.startPivot(),g?r.panDeltaY+=_:f&&(r.panDeltaY+=-_),m?r.panDeltaX+=-_:d&&(r.panDeltaX+=_),p?r.panDeltaZ+=_:c&&(r.panDeltaZ+=-_))}))}reset(){}destroy(){this._scene.off(this._onTick),this._scene.input.off(this._onSceneMouseMove),this._scene.input.off(this._onSceneKeyDown),this._scene.input.off(this._onSceneKeyUp)}}const vp=p.vec3();class bp{constructor(e,t,s,i,r){this._scene=e;const o=e.camera,n=t.pickController,a=t.pivotController,h=t.panController;let l=1,u=1,c=null;this._onTick=e.on("tick",(()=>{if(!s.active||!s.pointerEnabled)return;let t="default";if(Math.abs(r.dollyDelta)<.001&&(r.dollyDelta=0),Math.abs(r.rotateDeltaX)<.001&&(r.rotateDeltaX=0),Math.abs(r.rotateDeltaY)<.001&&(r.rotateDeltaY=0),0===r.rotateDeltaX&&0===r.rotateDeltaY||(r.dollyDelta=0),s.followPointer&&--l<=0&&(l=1,0!==r.dollyDelta)){if(0===r.rotateDeltaY&&0===r.rotateDeltaX&&s.followPointer&&i.followPointerDirty&&(n.pickCursorPos=i.pointerCanvasPos,n.schedulePickSurface=!0,n.update(),n.pickResult&&n.pickResult.worldPos?c=n.pickResult.worldPos:(u=1,c=null),i.followPointerDirty=!1),c){const t=Math.abs(p.lenVec3(p.subVec3(c,e.camera.eye,vp)));u=t/s.dollyProximityThreshold}u<s.dollyMinSpeed&&(u=s.dollyMinSpeed)}const d=r.dollyDelta*u;if(0===r.rotateDeltaY&&0===r.rotateDeltaX||(!s.firstPerson&&s.followPointer&&a.getPivoting()?(a.continuePivot(r.rotateDeltaY,r.rotateDeltaX),a.showPivot()):(0!==r.rotateDeltaX&&(s.firstPerson?o.pitch(-r.rotateDeltaX):o.orbitPitch(r.rotateDeltaX)),0!==r.rotateDeltaY&&(s.firstPerson?o.yaw(r.rotateDeltaY):o.orbitYaw(r.rotateDeltaY))),r.rotateDeltaX*=s.rotationInertia,r.rotateDeltaY*=s.rotationInertia,t="grabbing"),Math.abs(r.panDeltaX)<.001&&(r.panDeltaX=0),Math.abs(r.panDeltaY)<.001&&(r.panDeltaY=0),Math.abs(r.panDeltaZ)<.001&&(r.panDeltaZ=0),0!==r.panDeltaX||0!==r.panDeltaY||0!==r.panDeltaZ){const e=p.vec3();let i,n;if(e[0]=r.panDeltaX,e[1]=r.panDeltaY,e[2]=r.panDeltaZ,s.constrainVertical){o.xUp?(i=o.eye[0],n=o.look[0]):o.yUp?(i=o.eye[1],n=o.look[1]):o.zUp&&(i=o.eye[2],n=o.look[2]),o.pan(e);const t=o.eye,s=o.look;o.xUp?(t[0]=i,s[0]=n):o.yUp?(t[1]=i,s[1]=n):o.zUp&&(t[2]=i,s[2]=n),o.eye=t,o.look=s}else o.pan(e);t="grabbing"}if(r.panDeltaX*=s.panInertia,r.panDeltaY*=s.panInertia,r.panDeltaZ*=s.panInertia,0!==d){if(t=d<0?"zoom-in":"zoom-out",s.firstPerson){let e,t;if(s.constrainVertical&&(o.xUp?(e=o.eye[0],t=o.look[0]):o.yUp?(e=o.eye[1],t=o.look[1]):o.zUp&&(e=o.eye[2],t=o.look[2])),s.followPointer){h.dollyToCanvasPos(c,i.pointerCanvasPos,-d)&&(i.followPointerDirty=!0)}else o.pan([0,0,d]),o.ortho.scale=o.ortho.scale-d;if(s.constrainVertical){const s=o.eye,i=o.look;o.xUp?(s[0]=e,i[0]=t):o.yUp?(s[1]=e,i[1]=t):o.zUp&&(s[2]=e,i[2]=t),o.eye=s,o.look=i}}else if(s.planView)if(s.followPointer){h.dollyToCanvasPos(c,i.pointerCanvasPos,-d)&&(i.followPointerDirty=!0)}else o.ortho.scale=o.ortho.scale+d,o.zoom(d);else if(s.followPointer){h.dollyToCanvasPos(c,i.pointerCanvasPos,-d)&&(i.followPointerDirty=!0)}else o.ortho.scale=o.ortho.scale+d,o.zoom(d);r.dollyDelta*=s.dollyInertia}n.fireEvents(),document.body.style.cursor=t}))}destroy(){this._scene.off(this._onTick)}}class xp{constructor(e,t,s,i,r){this._scene=e;const o=this._scene.canvas.canvas;o.addEventListener("mouseenter",this._mouseEnterHandler=()=>{i.mouseover=!0}),o.addEventListener("mouseleave",this._mouseLeaveHandler=()=>{i.mouseover=!1,o.style.cursor=null}),document.addEventListener("mousemove",this._mouseMoveHandler=e=>{Pp(e,o,i.pointerCanvasPos)}),o.addEventListener("mousedown",this._mouseDownHandler=e=>{s.active&&s.pointerEnabled&&(Pp(e,o,i.pointerCanvasPos),i.mouseover=!0)}),o.addEventListener("mouseup",this._mouseUpHandler=e=>{s.active&&s.pointerEnabled})}reset(){}destroy(){const e=this._scene.canvas.canvas;document.removeEventListener("mousemove",this._mouseMoveHandler),e.removeEventListener("mouseenter",this._mouseEnterHandler),e.removeEventListener("mouseleave",this._mouseLeaveHandler),e.removeEventListener("mousedown",this._mouseDownHandler),e.removeEventListener("mouseup",this._mouseUpHandler)}}function Pp(e,t,s){if(e){const{x:i,y:r}=t.getBoundingClientRect();s[0]=e.clientX-i,s[1]=e.clientY-r}else e=window.event,s[0]=e.x,s[1]=e.y;return s}const Tp=function(e,t){if(e){let s=e.target,i=0,r=0;for(;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;t[0]=e.pageX-i,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t};class wp{constructor(e,t,s,i,r){this._scene=e;const o=t.pickController,n=t.pivotController,a=p.vec2(),h=p.vec2(),l=p.vec2(),u=p.vec2(),c=[],d=this._scene.canvas.canvas;let m=0,f=!1;this._onTick=e.on("tick",(()=>{f=!1})),d.addEventListener("touchstart",this._canvasTouchStartHandler=t=>{if(!s.active||!s.pointerEnabled)return;t.preventDefault();const r=t.touches,h=t.changedTouches;for(i.touchStartTime=Date.now(),1===r.length&&1===h.length&&(Tp(r[0],a),s.followPointer&&(o.pickCursorPos=a,o.schedulePickSurface=!0,o.update(),s.planView||(o.picked&&o.pickedSurface&&o.pickResult&&o.pickResult.worldPos?(n.setPivotPos(o.pickResult.worldPos),!s.firstPerson&&n.startPivot()&&n.showPivot()):(s.smartPivot?n.setCanvasPivotPos(i.pointerCanvasPos):n.setPivotPos(e.camera.look),!s.firstPerson&&n.startPivot()&&n.showPivot()))));c.length<r.length;)c.push(p.vec2());for(let e=0,t=r.length;e<t;++e)Tp(r[e],c[e]);m=r.length}),d.addEventListener("touchmove",this._canvasTouchMoveHandler=t=>{if(!s.active||!s.pointerEnabled)return;if(t.stopPropagation(),t.preventDefault(),f)return;f=!0;const n=e.canvas.boundary,a=n[2],d=n[3],g=t.touches;if(t.touches.length===m){if(1===m){Tp(g[0],h),p.subVec2(h,c[0],u);const t=u[0],o=u[1];if(null!==i.longTouchTimeout&&(Math.abs(t)>s.longTapRadius||Math.abs(o)>s.longTapRadius)&&(clearTimeout(i.longTouchTimeout),i.longTouchTimeout=null),s.planView){const i=e.camera;if("perspective"===i.projection){const n=Math.abs(e.camera.eyeLookDist)*Math.tan(i.perspective.fov/2*Math.PI/180);r.panDeltaX+=t*n/d*s.touchPanRate,r.panDeltaY+=o*n/d*s.touchPanRate}else r.panDeltaX+=.5*i.ortho.scale*(t/d)*s.touchPanRate,r.panDeltaY+=.5*i.ortho.scale*(o/d)*s.touchPanRate}else r.rotateDeltaY-=t/a*(1*s.dragRotationRate),r.rotateDeltaX+=o/d*(1.5*s.dragRotationRate)}else if(2===m){const t=g[0],n=g[1];Tp(t,h),Tp(n,l);const a=p.geometricMeanVec2(c[0],c[1]),u=p.geometricMeanVec2(h,l),m=p.vec2();p.subVec2(a,u,m);const f=m[0],_=m[1],y=e.camera,v=p.distVec2([t.pageX,t.pageY],[n.pageX,n.pageY]),b=(p.distVec2(c[0],c[1])-v)*s.touchDollyRate;if(r.dollyDelta=b,Math.abs(b)<1)if("perspective"===y.projection){const t=o.pickResult?o.pickResult.worldPos:e.center,i=Math.abs(p.lenVec3(p.subVec3(t,e.camera.eye,[])))*Math.tan(y.perspective.fov/2*Math.PI/180);r.panDeltaX-=f*i/d*s.touchPanRate,r.panDeltaY-=_*i/d*s.touchPanRate}else r.panDeltaX-=.5*y.ortho.scale*(f/d)*s.touchPanRate,r.panDeltaY-=.5*y.ortho.scale*(_/d)*s.touchPanRate;i.pointerCanvasPos=u}for(let e=0;e<m;++e)Tp(g[e],c[e])}})}reset(){}destroy(){const e=this._scene.canvas.canvas;e.removeEventListener("touchstart",this._canvasTouchStartHandler),e.removeEventListener("touchmove",this._canvasTouchMoveHandler),this._scene.off(this._onTick)}}const Mp=function(e,t){if(e){let s=e.target,i=0,r=0;for(;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;t[0]=e.pageX-i,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t};class Ip{constructor(e,t,s,i,r){this._scene=e;const o=t.pickController,n=t.cameraControl;let a;const h=[],l=new Float32Array(2);let u=-1,c=-1;const d=this._scene.canvas.canvas,m=s=>{let i;s&&s.worldPos&&(i=s.worldPos);const r=s?s.entity.aabb:e.aabb;if(i){const s=e.camera;p.subVec3(s.eye,s.look,[]),t.cameraFlight.flyTo({aabb:r})}else t.cameraFlight.flyTo({aabb:r})};d.addEventListener("touchstart",this._canvasTouchStartHandler=e=>{if(!s.active||!s.pointerEnabled)return;null!==i.longTouchTimeout&&(clearTimeout(i.longTouchTimeout),i.longTouchTimeout=null);const r=e.touches,o=e.changedTouches;if(a=Date.now(),1===r.length&&1===o.length){u=a,Mp(r[0],l);const o=l[0],n=l[1],h=r[0].pageX,c=r[0].pageY;i.longTouchTimeout=setTimeout((()=>{t.cameraControl.fire("rightClick",{pagePos:[Math.round(h),Math.round(c)],canvasPos:[Math.round(o),Math.round(n)],event:e},!0),i.longTouchTimeout=null}),s.longTapTimeout)}else u=-1;for(;h.length<r.length;)h.push(new Float32Array(2));for(let e=0,t=r.length;e<t;++e)Mp(r[e],h[e]);h.length=r.length},{passive:!0}),d.addEventListener("touchend",this._canvasTouchEndHandler=e=>{if(!s.active||!s.pointerEnabled)return;const t=Date.now(),r=e.touches,a=e.changedTouches,d=n.hasSubs("pickedSurface");null!==i.longTouchTimeout&&(clearTimeout(i.longTouchTimeout),i.longTouchTimeout=null),0===r.length&&1===a.length&&u>-1&&t-u<150&&(c>-1&&u-c<325?(Mp(a[0],o.pickCursorPos),o.schedulePickEntity=!0,o.schedulePickSurface=d,o.update(),o.pickResult?(o.pickResult.touchInput=!0,n.fire("doublePicked",o.pickResult),o.pickedSurface&&n.fire("doublePickedSurface",o.pickResult),s.doublePickFlyTo&&m(o.pickResult)):(n.fire("doublePickedNothing"),s.doublePickFlyTo&&m()),c=-1):p.distVec2(h[0],l)<4&&(Mp(a[0],o.pickCursorPos),o.schedulePickEntity=!0,o.schedulePickSurface=d,o.update(),o.pickResult?(o.pickResult.touchInput=!0,n.fire("picked",o.pickResult),o.pickedSurface&&n.fire("pickedSurface",o.pickResult)):n.fire("pickedNothing"),c=t),u=-1),h.length=r.length;for(let e=0,t=r.length;e<t;++e)h[e][0]=r[e].pageX,h[e][1]=r[e].pageY},{passive:!0})}reset(){}destroy(){const e=this._scene.canvas.canvas;e.removeEventListener("touchstart",this._canvasTouchStartHandler),e.removeEventListener("touchend",this._canvasTouchEndHandler)}}class Cp extends A{constructor(e,t={}){super(e,t),this.PAN_LEFT=0,this.PAN_RIGHT=1,this.PAN_UP=2,this.PAN_DOWN=3,this.PAN_FORWARDS=4,this.PAN_BACKWARDS=5,this.ROTATE_X_POS=6,this.ROTATE_X_NEG=7,this.ROTATE_Y_POS=8,this.ROTATE_Y_NEG=9,this.DOLLY_FORWARDS=10,this.DOLLY_BACKWARDS=11,this.AXIS_VIEW_RIGHT=12,this.AXIS_VIEW_BACK=13,this.AXIS_VIEW_LEFT=14,this.AXIS_VIEW_FRONT=15,this.AXIS_VIEW_TOP=16,this.AXIS_VIEW_BOTTOM=17,this._keyMap={},this.scene.canvas.canvas.oncontextmenu=e=>{e.preventDefault()},this._configs={longTapTimeout:600,longTapRadius:5,active:!0,keyboardLayout:"qwerty",navMode:"orbit",planView:!1,firstPerson:!1,followPointer:!0,doublePickFlyTo:!0,panRightClick:!0,showPivot:!1,pointerEnabled:!0,constrainVertical:!1,smartPivot:!1,doubleClickTimeFrame:250,dragRotationRate:360,keyboardRotationRate:90,rotationInertia:0,keyboardPanRate:1,touchPanRate:1,panInertia:.5,keyboardDollyRate:10,mouseWheelDollyRate:100,touchDollyRate:.2,dollyInertia:0,dollyProximityThreshold:30,dollyMinSpeed:.04},this._states={pointerCanvasPos:p.vec2(),mouseover:!1,followPointerDirty:!0,mouseDownClientX:0,mouseDownClientY:0,mouseDownCursorX:0,mouseDownCursorY:0,touchStartTime:null,activeTouches:[],tapStartPos:p.vec2(),tapStartTime:-1,lastTapTime:-1,longTouchTimeout:null},this._updates={rotateDeltaX:0,rotateDeltaY:0,panDeltaX:0,panDeltaY:0,panDeltaZ:0,dollyDelta:0};const s=this.scene;this._controllers={cameraControl:this,pickController:new ap(this,this._configs),pivotController:new np(s,this._configs),panController:new $c(s),cameraFlight:new pa(this,{duration:.5})},this._handlers=[new xp(this.scene,this._controllers,this._configs,this._states,this._updates),new wp(this.scene,this._controllers,this._configs,this._states,this._updates),new lp(this.scene,this._controllers,this._configs,this._states,this._updates),new gp(this.scene,this._controllers,this._configs,this._states,this._updates),new _p(this.scene,this._controllers,this._configs,this._states,this._updates),new Ip(this.scene,this._controllers,this._configs,this._states,this._updates),new yp(this.scene,this._controllers,this._configs,this._states,this._updates)],this._cameraUpdater=new bp(this.scene,this._controllers,this._configs,this._states,this._updates),this.navMode=t.navMode,t.planView&&(this.planView=t.planView),this.constrainVertical=t.constrainVertical,t.keyboardLayout?this.keyboardLayout=t.keyboardLayout:this.keyMap=t.keyMap,this.doublePickFlyTo=t.doublePickFlyTo,this.panRightClick=t.panRightClick,this.active=t.active,this.followPointer=t.followPointer,this.rotationInertia=t.rotationInertia,this.keyboardPanRate=t.keyboardPanRate,this.touchPanRate=t.touchPanRate,this.keyboardRotationRate=t.keyboardRotationRate,this.dragRotationRate=t.dragRotationRate,this.touchDollyRate=t.touchDollyRate,this.dollyInertia=t.dollyInertia,this.dollyProximityThreshold=t.dollyProximityThreshold,this.dollyMinSpeed=t.dollyMinSpeed,this.panInertia=t.panInertia,this.pointerEnabled=!0,this.keyboardDollyRate=t.keyboardDollyRate,this.mouseWheelDollyRate=t.mouseWheelDollyRate}set keyMap(e){if(e=e||"qwerty",y.isString(e)){const t=this.scene.input,s={};switch(e){default:this.error("Unsupported value for 'keyMap': "+e+" defaulting to 'qwerty'");case"qwerty":s[this.PAN_LEFT]=[t.KEY_A],s[this.PAN_RIGHT]=[t.KEY_D],s[this.PAN_UP]=[t.KEY_Z],s[this.PAN_DOWN]=[t.KEY_X],s[this.PAN_BACKWARDS]=[],s[this.PAN_FORWARDS]=[],s[this.DOLLY_FORWARDS]=[t.KEY_W,t.KEY_ADD],s[this.DOLLY_BACKWARDS]=[t.KEY_S,t.KEY_SUBTRACT],s[this.ROTATE_X_POS]=[t.KEY_DOWN_ARROW],s[this.ROTATE_X_NEG]=[t.KEY_UP_ARROW],s[this.ROTATE_Y_POS]=[t.KEY_Q,t.KEY_LEFT_ARROW],s[this.ROTATE_Y_NEG]=[t.KEY_E,t.KEY_RIGHT_ARROW],s[this.AXIS_VIEW_RIGHT]=[t.KEY_NUM_1],s[this.AXIS_VIEW_BACK]=[t.KEY_NUM_2],s[this.AXIS_VIEW_LEFT]=[t.KEY_NUM_3],s[this.AXIS_VIEW_FRONT]=[t.KEY_NUM_4],s[this.AXIS_VIEW_TOP]=[t.KEY_NUM_5],s[this.AXIS_VIEW_BOTTOM]=[t.KEY_NUM_6];break;case"azerty":s[this.PAN_LEFT]=[t.KEY_Q],s[this.PAN_RIGHT]=[t.KEY_D],s[this.PAN_UP]=[t.KEY_W],s[this.PAN_DOWN]=[t.KEY_X],s[this.PAN_BACKWARDS]=[],s[this.PAN_FORWARDS]=[],s[this.DOLLY_FORWARDS]=[t.KEY_Z,t.KEY_ADD],s[this.DOLLY_BACKWARDS]=[t.KEY_S,t.KEY_SUBTRACT],s[this.ROTATE_X_POS]=[t.KEY_DOWN_ARROW],s[this.ROTATE_X_NEG]=[t.KEY_UP_ARROW],s[this.ROTATE_Y_POS]=[t.KEY_A,t.KEY_LEFT_ARROW],s[this.ROTATE_Y_NEG]=[t.KEY_E,t.KEY_RIGHT_ARROW],s[this.AXIS_VIEW_RIGHT]=[t.KEY_NUM_1],s[this.AXIS_VIEW_BACK]=[t.KEY_NUM_2],s[this.AXIS_VIEW_LEFT]=[t.KEY_NUM_3],s[this.AXIS_VIEW_FRONT]=[t.KEY_NUM_4],s[this.AXIS_VIEW_TOP]=[t.KEY_NUM_5],s[this.AXIS_VIEW_BOTTOM]=[t.KEY_NUM_6]}this._keyMap=s}else{const t=e;this._keyMap=t}}get keyMap(){return this._keyMap}_isKeyDownForAction(e,t){const s=this._keyMap[e];if(!s)return!1;t||(t=this.scene.input.keyDown);for(let e=0,i=s.length;e<i;e++){if(t[s[e]])return!0}return!1}set pivotElement(e){this._controllers.pivotController.setPivotElement(e)}set active(e){this._configs.active=!1!==e}get active(){return this._configs.active}set navMode(e){"firstPerson"!==(e=e||"orbit")&&"orbit"!==e&&"planView"!==e&&(this.error("Unsupported value for navMode: "+e+" - supported values are 'orbit', 'firstPerson' and 'planView' - defaulting to 'orbit'"),e="orbit"),this._configs.firstPerson="firstPerson"===e,this._configs.planView="planView"===e,(this._configs.firstPerson||this._configs.planView)&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot()),this._configs.navMode=e}get navMode(){return this._configs.navMode}set pointerEnabled(e){this._reset(),this._configs.pointerEnabled=!!e}_reset(){for(let e=0,t=this._handlers.length;e<t;e++){const t=this._handlers[e];t.reset&&t.reset()}this._updates.panDeltaX=0,this._updates.panDeltaY=0,this._updates.rotateDeltaX=0,this._updates.rotateDeltaY=0,this._updates.dolyDelta=0}get pointerEnabled(){return this._configs.pointerEnabled}set followPointer(e){this._configs.followPointer=!1!==e}get followPointer(){return this._configs.followPointer}set pivotPos(e){this._controllers.pivotController.setPivotPos(e)}get pivotPos(){return this._controllers.pivotController.getPivotPos()}set dollyToPointer(e){this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer=e}get dollyToPointer(){return this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer}set panToPointer(e){this.warn("panToPointer property is deprecated - replaced with followPointer")}get panToPointer(){return this.warn("panToPointer property is deprecated - replaced with followPointer"),!1}set planView(e){this._configs.planView=!!e,this._configs.firstPerson=!1,this._configs.planView&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot()),this.warn("planView property is deprecated - replaced with navMode")}get planView(){return this.warn("planView property is deprecated - replaced with navMode"),this._configs.planView}set firstPerson(e){this.warn("firstPerson property is deprecated - replaced with navMode"),this._configs.firstPerson=!!e,this._configs.planView=!1,this._configs.firstPerson&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot())}get firstPerson(){return this.warn("firstPerson property is deprecated - replaced with navMode"),this._configs.firstPerson}set constrainVertical(e){this._configs.constrainVertical=!!e}get constrainVertical(){return this._configs.constrainVertical}set doublePickFlyTo(e){this._configs.doublePickFlyTo=!1!==e}get doublePickFlyTo(){return this._configs.doublePickFlyTo}set panRightClick(e){this._configs.panRightClick=!1!==e}get panRightClick(){return this._configs.panRightClick}set rotationInertia(e){this._configs.rotationInertia=null!=e?e:0}get rotationInertia(){return this._configs.rotationInertia}set keyboardPanRate(e){this._configs.keyboardPanRate=null!=e?e:5}set touchPanRate(e){this._configs.touchPanRate=null!=e?e:1}get touchPanRate(){return this._configs.touchPanRate}get keyboardPanRate(){return this._configs.keyboardPanRate}set keyboardRotationRate(e){this._configs.keyboardRotationRate=null!=e?e:90}get keyboardRotationRate(){return this._configs.keyboardRotationRate}set dragRotationRate(e){this._configs.dragRotationRate=null!=e?e:360}get dragRotationRate(){return this._configs.dragRotationRate}set keyboardDollyRate(e){this._configs.keyboardDollyRate=null!=e?e:15}get keyboardDollyRate(){return this._configs.keyboardDollyRate}set touchDollyRate(e){this._configs.touchDollyRate=null!=e?e:.2}get touchDollyRate(){return this._configs.touchDollyRate}set mouseWheelDollyRate(e){this._configs.mouseWheelDollyRate=null!=e?e:100}get mouseWheelDollyRate(){return this._configs.mouseWheelDollyRate}set dollyInertia(e){this._configs.dollyInertia=null!=e?e:0}get dollyInertia(){return this._configs.dollyInertia}set dollyProximityThreshold(e){this._configs.dollyProximityThreshold=null!=e?e:35}get dollyProximityThreshold(){return this._configs.dollyProximityThreshold}set dollyMinSpeed(e){this._configs.dollyMinSpeed=null!=e?e:.04}get dollyMinSpeed(){return this._configs.dollyMinSpeed}set panInertia(e){this._configs.panInertia=null!=e?e:.5}get panInertia(){return this._configs.panInertia}set keyboardLayout(e){"qwerty"!==(e=e||"qwerty")&&"azerty"!==e&&(this.error("Unsupported value for keyboardLayout - defaulting to 'qwerty'"),e="qwerty"),this._configs.keyboardLayout=e,this.keyMap=this._configs.keyboardLayout}get keyboardLayout(){return this._configs.keyboardLayout}set smartPivot(e){this._configs.smartPivot=!1!==e}get smartPivot(){return this._configs.smartPivot}set doubleClickTimeFrame(e){this._configs.doubleClickTimeFrame=null!=e?e:250}get doubleClickTimeFrame(){return this._configs.doubleClickTimeFrame}destroy(){this._destroyHandlers(),this._destroyControllers(),this._cameraUpdater.destroy(),super.destroy()}_destroyHandlers(){for(let e=0,t=this._handlers.length;e<t;e++){const t=this._handlers[e];t.destroy&&t.destroy()}}_destroyControllers(){for(let e=0,t=this._controllers.length;e<t;e++){const t=this._controllers[e];t.destroy&&t.destroy()}}}class Dp{constructor(e,t,s,i,r,o,n,a,h){this.id=t,this.projectId=s,this.revisionId=i,this.author=r,this.createdAt=o,this.creatingApplication=n,this.schema=a,this.metaScene=e,this.propertySets=h,this.rootMetaObject=null,this.rootMetaObjects=[]}getJSON(){const e=[];!function t(s){const i={id:s.id,extId:s.extId,type:s.type,name:s.name};s.parent&&(i.parent=s.parent.id),e.push(i);const r=s.children;if(r)for(let e=0,s=r.length;e<s;e++)t(r[e])}(this.rootMetaObject);return{id:this.id,projectId:this.projectId,revisionId:this.revisionId,metaObjects:e}}}class Ap{constructor(e,t,s,i,r,o,n,a,h){this.metaModel=e,this.metaModels=[e],this.id=t,this.originalSystemId=s,this.name=i,this.type=r,this.propertySets=o,null!=n&&(this.parent=n),null!=a&&(this.children=a),null!=h&&(this.external=h)}getObjectIDsInSubtree(){const e=[];return function t(s){if(!s)return;e.push(s.id);const i=s.children;if(i)for(var r=0,o=i.length;r<o;r++)t(i[r])}(this),e}withMetaObjectsInSubtree(e){!function t(s){if(!s)return;e(s);const i=s.children;if(i)for(var r=0,o=i.length;r<o;r++)t(i[r])}(this)}getObjectIDsInSubtreeByType(e){const t={};for(var s=0,i=e.length;s<i;s++)t[e[s]]=e[s];const r=[];return function e(s){if(!s)return;t[s.type]&&r.push(s.id);const i=s.children;if(i)for(var o=0,n=i.length;o<n;o++)e(i[o])}(this),r}getJSON(){var e={id:this.id,type:this.type,name:this.name};return this.parent&&(e.parent=this.parent.id),e}}class Ep{constructor(e,t,s,i,r){this.name=e,this.type=s,this.value=t,this.valueType=i,this.description=r}}class Fp{constructor(e,t,s,i,r){if(this.id=e,this.originalSystemId=t,this.name=s,this.type=i,this.properties=[],r)for(let e=0,t=r.length;e<t;e++){const t=r[e];this.properties.push(new Ep(t.name,t.value,t.type,t.valueType,t.description))}}}class Rp{constructor(e,t){this.viewer=e,this.scene=t,this.metaModels={},this.propertySets={},this.metaObjects={},this.metaObjectsByType={},this.rootMetaObjects={},this._typeCounts={},this._eventSubs={}}on(e,t){let s=this._eventSubs[e];s||(s=[],this._eventSubs[e]=s),s.push(t)}fire(e,t){const s=this._eventSubs[e];if(s)for(let e=0,i=s.length;e<i;e++)s[e](t)}off(e){}createMetaModel(e,t,s={}){const i=t.projectId||"none",r=t.revisionId||"none",o=t.propertySets||[],n=t.metaObjects||[],a=t.author,h=t.createdAt,l=t.creatingApplication,u=t.schema,c=new Dp(this,e,i,r,a,h,l,u,[],null);this.metaModels[e]=c;for(let e=0,t=o.length;e<t;e++){const t=o[e],s=t.id,i=new Fp(s,t.originalSystemId,t.name,t.type,t.properties);c.propertySets[s]=i,this.propertySets[s]=i}const d=[],m=[],f=[];for(let e=0,t=n.length;e<t;e++){const t=n[e];t.type,d.push(t)}for(let e=0,t=d.length;e<t;e++){let t=d[e];const s=this.metaObjects[t.id];s?(s.metaModels.push(c),m.push(s)):f.push(t)}for(let t=0,i=f.length;t<i;t++){const i=f[t],r=i.type,o=s.globalizeObjectIds?p.globalizeObjectId(e,i.id):i.id,n=i.id,a=i.name,h=[];if(i.propertySetIds&&i.propertySetIds.length>0)for(let e=0,t=i.propertySetIds.length;e<t;e++){const t=i.propertySetIds[e],s=c.propertySets[t];s&&h.push(s)}const l=null,u=null,d=i.external,g=new Ap(c,o,n,a,r,h,l,u,d);g._parentId=i.parent,this.metaObjects[o]=g,(this.metaObjectsByType[r]||(this.metaObjectsByType[r]={}))[o]=g,void 0===this._typeCounts[r]?this._typeCounts[r]=1:this._typeCounts[r]++,m.push(g),void 0===i.parent||i.parent}for(let t=0,i=m.length;t<i;t++){const i=m[t],r=s.globalizeObjectIds?p.globalizeObjectId(e,i.id):i.id;if(void 0!==i._parentId&&null!==i._parentId||i.parent){if(i._parentId){const t=s.globalizeObjectIds?p.globalizeObjectId(e,i._parentId):i._parentId;i._parentId=null;let r=this.metaObjects[t];r&&(i.parent=r,r.children=r.children||[],r.children.push(i))}}else c.rootMetaObject=i,c.rootMetaObjects[r]=i,this.rootMetaObjects[r]=i}return this.fire("metaModelCreated",e),c}destroyMetaModel(e){const t=this.metaModels[e];t&&(this._removeMetaModel(t),this.fire("metaModelDestroyed",e))}_removeMetaModel(e){const t=this.metaObjects,s=this.metaObjectsByType;let i=e=>{delete t[e.id];const r=s[e.type];r&&r[e.id]&&(delete r[e.id],0==--this._typeCounts[e.type]&&(delete this._typeCounts[e.type],delete s[e.type]));const o=e.children;if(o)for(let e=0,t=o.length;e<t;e++){const t=o[e];i(t)}};i(e.rootMetaObject);for(let t in e.propertySets)e.propertySets.hasOwnProperty(t)&&delete this.propertySets[t];delete this.metaModels[e.id]}getObjectIDsByType(e){const t=this.metaObjectsByType[e];return t?Object.keys(t):[]}getObjectIDsInSubtree(e,t,s){const i=[],r=this.metaObjects[e],o=t&&t.length>0?Sp(t):null,n=s&&s.length>0?Sp(s):null;return function e(t){if(!t)return;var s=!0;(n&&n[t.type]||o&&!o[t.type])&&(s=!1),s&&i.push(t.id);const r=t.children;if(r)for(var a=0,h=r.length;a<h;a++)e(r[a])}(r),i}withMetaObjectsInSubtree(e,t){const s=this.metaObjects[e];s&&s.withMetaObjectsInSubtree(t)}}function Sp(e){const t={};for(var s=0,i=e.length;s<i;s++)t[e[s]]=!0;return t}class Op{constructor(e){this.language="en",this.localeService=e.localeService||new ea,this.scene=new Ui(this,{canvasId:e.canvasId,canvasElement:e.canvasElement,keyboardEventsElement:e.keyboardEventsElement,contextAttr:{preserveDrawingBuffer:!1!==e.preserveDrawingBuffer,premultipliedAlpha:!!e.premultipliedAlpha,antialias:!1!==e.antialias},spinnerElementId:e.spinnerElementId,transparent:!1!==e.transparent,gammaInput:!0,gammaOutput:!1,backgroundColor:e.backgroundColor,backgroundColorFromAmbientLight:e.backgroundColorFromAmbientLight,ticksPerRender:1,ticksPerOcclusionTest:20,units:e.units,scale:e.scale,origin:e.origin,saoEnabled:e.saoEnabled,alphaDepthMask:!1!==e.alphaDepthMask,entityOffsetsEnabled:!!e.entityOffsetsEnabled,pickSurfacePrecisionEnabled:!!e.pickSurfacePrecisionEnabled,logarithmicDepthBufferEnabled:!!e.logarithmicDepthBufferEnabled,pbrEnabled:!!e.pbrEnabled,colorTextureEnabled:!1!==e.colorTextureEnabled}),this.metaScene=new Rp(this,this.scene),this.id=e.id||this.scene.id,this.camera=this.scene.camera,this.cameraFlight=new pa(this.scene,{duration:.5}),this.cameraControl=new Cp(this.scene,{doublePickFlyTo:!0}),this._plugins=[],this._eventSubs={}}get capabilities(){return this.scene.capabilities}on(e,t){let s=this._eventSubs[e];s||(s=[],this._eventSubs[e]=s),s.push(t)}fire(e,t){const s=this._eventSubs[e];if(s)for(let e=0,i=s.length;e<i;e++)s[e](t)}off(e){}log(e){console.log(`[xeokit viewer ${this.id}]: ${e}`)}error(e){console.error(`[xeokit viewer ${this.id}]: ${e}`)}addPlugin(e){this._plugins.push(e)}removePlugin(e){for(let t=0,s=this._plugins.length;t<s;t++){const s=this._plugins[t];if(s===e)return s.clear&&s.clear(),void this._plugins.splice(t,1)}}sendToPlugins(e,t){for(let s=0,i=this._plugins.length;s<i;s++){const i=this._plugins[s];i.send&&i.send(e,t)}}clear(){throw'Viewer#clear() no longer implemented - use \'#sendToPlugins("clear") instead'}resetView(){throw"Viewer#resetView() no longer implemented - use CameraMemento & ObjectsMemento classes instead"}beginSnapshot(){this._snapshotBegun||(this.scene._renderer.beginSnapshot(),this._snapshotBegun=!0)}getSnapshot(e={}){const t=!this._snapshotBegun,s=void 0!==e.width&&void 0!==e.height,i=this.scene.canvas.canvas,r=i.clientWidth,o=i.clientHeight;i.style.width,i.style.height;const n=e.width?Math.floor(e.width):i.width,a=e.height?Math.floor(e.height):i.height;s&&(i.width=n,i.height=a),this._snapshotBegun||this.beginSnapshot(),e.includeGizmos||this.sendToPlugins("snapshotStarting"),this.scene._renderer.renderSnapshot();const h=this.scene._renderer.readSnapshot(e);return s&&(i.width=r,i.height=o,this.scene.glRedraw()),e.includeGizmos||this.sendToPlugins("snapshotFinished"),t&&this.endSnapshot(),h}endSnapshot(){this._snapshotBegun&&(this.scene._renderer.endSnapshot(),this.scene._renderer.render({force:!0}),this._snapshotBegun=!1)}destroy(){const e=this._plugins.slice();for(let t=0,s=e.length;t<s;t++){e[t].destroy()}this.scene.destroy()}}class Bp{constructor(){}set doublePrecisionEnabled(e){p.setDoublePrecisionEnabled(e)}get doublePrecisionEnabled(){return p.getDoublePrecisionEnabled()}}class Lp extends A{constructor(e){super(e.viewer.scene),this.plugin=e,this._active=!1,this._currentDistanceMeasurementByMouse=null,this._currentDistanceMeasurementByMouseInittouchState={wireVisible:null,axisVisible:null,xAxisVisible:null,yaxisVisible:null,zAxisVisible:null,targetVisible:null},this._touchStartDot=new Q(e._container,{fillColor:e.defaultColor,zIndex:e.zIndex+1,visible:!1}),this._touchStartMarker=new J(this,{id:"distanceMeasurementMarker"}),this._touchStartMarker.on("canvasPos",(e=>{this._touchStartDot.setPos(e[0],e[1])})),this._onMouseHoverSurface=null,this._onMouseHoverOff=null,this._onPickedNothing=null,this._onInputMouseDown=null,this._onInputMouseUp=null,this._onCanvasTouchStart=null,this._onCanvasTouchEnd=null}get active(){return this._active}activate(){if(this._active)return;const e=this.plugin,t=this.scene,s=e.viewer.cameraControl,i=t.canvas.canvas,r=t.input,o=this._touchStartDot,n=t.pickSurfacePrecisionEnabled;let a=null;const h=p.vec3(),l=p.vec2();let u,c;let d=0;const m=p.vec2(),f=p.vec2(),g=p.vec3();this._onMouseHoverSurface=s.on("hoverSurface",(e=>{a=e.entity,h.set(e.worldPos),l.set(e.canvasPos),i.style.cursor="pointer",this._currentDistanceMeasurementByMouse&&(this._currentDistanceMeasurementByMouse.wireVisible=this._currentDistanceMeasurementByMouseInittouchState.wireVisible,this._currentDistanceMeasurementByMouse.axisVisible=this._currentDistanceMeasurementByMouseInittouchState.axisVisible&&this.plugin.defaultAxisVisible,this._currentDistanceMeasurementByMouse.xAxisVisible=this._currentDistanceMeasurementByMouseInittouchState.xAxisVisible&&this.plugin.defaultXAxisVisible,this._currentDistanceMeasurementByMouse.yAxisVisible=this._currentDistanceMeasurementByMouseInittouchState.yAxisVisible&&this.plugin.defaultYAxisVisible,this._currentDistanceMeasurementByMouse.zAxisVisible=this._currentDistanceMeasurementByMouseInittouchState.zAxisVisible&&this.plugin.defaultZAxisVisible,this._currentDistanceMeasurementByMouse.targetVisible=this._currentDistanceMeasurementByMouseInittouchState.targetVisible,this._currentDistanceMeasurementByMouse.target.entity=a,this._currentDistanceMeasurementByMouse.target.worldPos=h)})),this._onInputMouseDown=r.on("mousedown",(e=>{u=e[0],c=e[1]})),this._onInputMouseUp=r.on("mouseup",(s=>{if(!(s[0]>u+5||s[0]<u-5||s[1]>c+5||s[1]<c-5))if(this._currentDistanceMeasurementByMouse)if(a){if(n){const e=t.pick({canvasPos:l,pickSurface:!0,pickSurfacePrecision:!0});e&&e.worldPos&&(this._currentDistanceMeasurementByMouse.target.worldPos=e.worldPos),this._currentDistanceMeasurementByMouse.approximate=!1}this._currentDistanceMeasurementByMouse.clickable=!0,this.fire("measurementEnd",this._currentDistanceMeasurementByMouse),this._currentDistanceMeasurementByMouse=null}else this._currentDistanceMeasurementByMouse.destroy(),this.fire("measurementCancel",this._currentDistanceMeasurementByMouse),this._currentDistanceMeasurementByMouse=null;else if(a){if(n){const e=t.pick({canvasPos:l,pickSurface:!0,pickSurfacePrecision:!0});e&&e.worldPos&&h.set(e.worldPos)}this._currentDistanceMeasurementByMouse=e.createMeasurement({id:p.createUUID(),origin:{entity:a,worldPos:h},target:{entity:a,worldPos:h},approximate:!0}),this._currentDistanceMeasurementByMouseInittouchState.axisVisible=this._currentDistanceMeasurementByMouse.axisVisible&&this.plugin.defaultAxisVisible,this._currentDistanceMeasurementByMouseInittouchState.xAxisVisible=this._currentDistanceMeasurementByMouse.xAxisVisible&&this.plugin.defaultXAxisVisible,this._currentDistanceMeasurementByMouseInittouchState.yAxisVisible=this._currentDistanceMeasurementByMouse.yAxisVisible&&this.plugin.defaultYAxisVisible,this._currentDistanceMeasurementByMouseInittouchState.zAxisVisible=this._currentDistanceMeasurementByMouse.zAxisVisible&&this.plugin.defaultZAxisVisible,this._currentDistanceMeasurementByMouseInittouchState.wireVisible=this._currentDistanceMeasurementByMouse.wireVisible,this._currentDistanceMeasurementByMouseInittouchState.targetVisible=this._currentDistanceMeasurementByMouse.targetVisible,this._currentDistanceMeasurementByMouse.clickable=!1,this.fire("measurementStart",this._currentDistanceMeasurementByMouse)}})),this._onMouseHoverOff=s.on("hoverOff",(e=>{a=null,this._currentDistanceMeasurementByMouse&&(this._currentDistanceMeasurementByMouse.wireVisible=!1,this._currentDistanceMeasurementByMouse.targetVisible=!1,this._currentDistanceMeasurementByMouse.axisVisible=!1),i.style.cursor="default"})),this._onPickedNothing=s.on("pickedNothing",(e=>{this._currentDistanceMeasurementByMouse&&(this.fire("measurementCancel",this._currentDistanceMeasurementByMouse),this._currentDistanceMeasurementByMouse.destroy(),this._currentDistanceMeasurementByMouse=null),o.setVisible(!1),d=0})),i.addEventListener("touchstart",this._onCanvasTouchStart=e=>{const t=e.touches,s=e.changedTouches;1===t.length&&1===s.length&&Np(t[0],m)},{passive:!0}),i.addEventListener("touchend",this._onCanvasTouchEnd=s=>{const i=s.touches,r=s.changedTouches;if(0===i.length&&1===r.length){if(Np(r[0],f),f[0]>m[0]+5||f[0]<m[0]-5||f[1]>m[1]+5||f[1]<m[1]-5)return;const s=t.pick({canvasPos:f,pickSurface:!0,pickSurfacePrecision:n});if(s&&s.worldPos)switch(d){case 0:o.setVisible(!0),this._touchStartMarker.worldPos=s.worldPos,g.set(s.worldPos),d=1;break;case 1:o.setVisible(!1),this._touchStartMarker.worldPos=s.worldPos;const t=e.createMeasurement({id:p.createUUID(),origin:{entity:a,worldPos:g},target:{entity:a,worldPos:s.worldPos},approximate:!n});t.clickable=!0,d=0,this.fire("measurementEnd",t)}else o.setVisible(!1),d=0}},{passive:!0}),this._active=!0}deactivate(){if(!this._active)return;this._touchStartDot.setVisible(!1),this.reset();const e=this.plugin.viewer.scene.input;e.off(this._onInputMouseDown),e.off(this._onInputMouseUp);const t=this.plugin.viewer.cameraControl;t.off(this._onMouseHoverSurface),t.off(this._onMouseHoverOff),t.off(this._onPickedNothing);const s=this.plugin.viewer.scene.canvas.canvas;s.removeEventListener("touchstart",this._onCanvasTouchStart),s.removeEventListener("touchend",this._onCanvasTouchEnd),this._currentDistanceMeasurementByMouse&&(this.fire("measurementCancel",this._currentDistanceMeasurementByMouse),this._currentDistanceMeasurementByMouse.destroy(),this._currentDistanceMeasurementByMouse=null),this._active=!1}reset(){this._active&&this._currentDistanceMeasurementByMouse&&(this.fire("measurementCancel",this._currentDistanceMeasurementByMouse),this._currentDistanceMeasurementByMouse.destroy(),this._currentDistanceMeasurementByMouse=null)}destroy(){this._touchStartDot.destroy(),this.deactivate(),super.destroy()}}const Np=function(e,t){if(e){let s=e.target,i=0,r=0;for(;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;t[0]=e.pageX-i,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t};class kp extends n{constructor(e,t={}){super("DistanceMeasurements",e),this._container=t.container||document.body,this._control=new Lp(this),this._measurements={},this.labelMinAxisLength=t.labelMinAxisLength,this.defaultVisible=!1!==t.defaultVisible,this.defaultOriginVisible=!1!==t.defaultOriginVisible,this.defaultTargetVisible=!1!==t.defaultTargetVisible,this.defaultWireVisible=!1!==t.defaultWireVisible,this.defaultLabelsVisible=!1!==t.defaultLabelsVisible,this.defaultAxisVisible=!1!==t.defaultAxisVisible,this.defaultXAxisVisible=!1!==t.defaultXAxisVisible,this.defaultYAxisVisible=!1!==t.defaultYAxisVisible,this.defaultZAxisVisible=!1!==t.defaultZAxisVisible,this.defaultColor=void 0!==t.defaultColor?t.defaultColor:"#00BBFF",this.zIndex=t.zIndex||1e4,this._onMouseOver=(e,t)=>{this.fire("mouseOver",{plugin:this,distanceMeasurement:t,measurement:t,event:e})},this._onMouseLeave=(e,t)=>{this.fire("mouseLeave",{plugin:this,distanceMeasurement:t,measurement:t,event:e})},this._onContextMenu=(e,t)=>{this.fire("contextMenu",{plugin:this,distanceMeasurement:t,measurement:t,event:e})}}send(e,t){}get control(){return this._control}get measurements(){return this._measurements}set labelMinAxisLength(e){e<1&&(this.error("labelMinAxisLength must be >= 1; defaulting to 25"),e=25),this._labelMinAxisLength=e||25}get labelMinAxisLength(){return this._labelMinAxisLength}createMeasurement(e={}){this.viewer.scene.components[e.id]&&(this.error("Viewer scene component with this ID already exists: "+e.id),delete e.id);const t=e.origin,s=e.target,i=new $n(this,{id:e.id,plugin:this,container:this._container,origin:{entity:t.entity,worldPos:t.worldPos},target:{entity:s.entity,worldPos:s.worldPos},visible:e.visible,wireVisible:e.wireVisible,axisVisible:!1!==e.axisVisible&&!1!==this.defaultAxisVisible,xAxisVisible:!1!==e.xAxisVisible&&!1!==this.defaultXAxisVisible,yAxisVisible:!1!==e.yAxisVisible&&!1!==this.defaultYAxisVisible,zAxisVisible:!1!==e.zAxisVisible&&!1!==this.defaultZAxisVisible,labelsVisible:!1!==e.labelsVisible&&!1!==this.defaultLabelsVisible,originVisible:e.originVisible,targetVisible:e.targetVisible,color:e.color,onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave,onContextMenu:this._onContextMenu});return this._measurements[i.id]=i,i.on("destroyed",(()=>{delete this._measurements[i.id]})),this.fire("measurementCreated",i),i}destroyMeasurement(e){const t=this._measurements[e];t?(t.destroy(),this.fire("measurementDestroyed",t)):this.log("DistanceMeasurement not found: "+e)}setLabelsShown(e){for(const[t,s]of Object.entries(this.measurements))s.labelShown=e}clear(){const e=Object.keys(this._measurements);for(var t=0,s=e.length;t<s;t++)this.destroyMeasurement(e[t])}destroy(){this.clear(),super.destroy()}}class jp extends n{constructor(e,t={}){super("FastNav",e),this._hideColorTexture=!1!==t.hideColorTexture,this._hidePBR=!1!==t.hidePBR,this._hideSAO=!1!==t.hideSAO,this._hideEdges=!1!==t.hideEdges,this._hideTransparentObjects=!!t.hideTransparentObjects,this._scaleCanvasResolution=!!t.scaleCanvasResolution,this._scaleCanvasResolutionFactor=t.scaleCanvasResolutionFactor||.6,this._delayBeforeRestore=!1!==t.delayBeforeRestore,this._delayBeforeRestoreSeconds=t.delayBeforeRestoreSeconds||.5;let s=1e3*this._delayBeforeRestoreSeconds,i=!1;const r=()=>{s=1e3*this._delayBeforeRestoreSeconds,i||(e.scene._renderer.setColorTextureEnabled(!this._hideColorTexture),e.scene._renderer.setPBREnabled(!this._hidePBR),e.scene._renderer.setSAOEnabled(!this._hideSAO),e.scene._renderer.setTransparentEnabled(!this._hideTransparentObjects),e.scene._renderer.setEdgesEnabled(!this._hideEdges),this._scaleCanvasResolution?e.scene.canvas.resolutionScale=this._scaleCanvasResolutionFactor:e.scene.canvas.resolutionScale=1,i=!0)};this._onCanvasBoundary=e.scene.canvas.on("boundary",r),this._onCameraMatrix=e.scene.camera.on("matrix",r),this._onSceneTick=e.scene.on("tick",(t=>{i&&(s-=t.deltaTime,(!this._delayBeforeRestore||s<=0)&&(e.scene.canvas.resolutionScale=1,e.scene._renderer.setEdgesEnabled(!0),e.scene._renderer.setColorTextureEnabled(!0),e.scene._renderer.setPBREnabled(!0),e.scene._renderer.setSAOEnabled(!0),e.scene._renderer.setTransparentEnabled(!0),i=!1))}));let o=!1;this._onSceneMouseDown=e.scene.input.on("mousedown",(()=>{o=!0})),this._onSceneMouseUp=e.scene.input.on("mouseup",(()=>{o=!1})),this._onSceneMouseMove=e.scene.input.on("mousemove",(()=>{o&&r()}))}get hideColorTexture(){return this._hideColorTexture}set hideColorTexture(e){this._hideColorTexture=e}get hidePBR(){return this._hidePBR}set hidePBR(e){this._hidePBR=e}get hideSAO(){return this._hideSAO}set hideSAO(e){this._hideSAO=e}get hideEdges(){return this._hideEdges}set hideEdges(e){this._hideEdges=e}get hideTransparentObjects(){return this._hideTransparentObjects}set hideTransparentObjects(e){this._hideTransparentObjects=!1!==e}get scaleCanvasResolution(){return this._scaleCanvasResolution}set scaleCanvasResolution(e){this._scaleCanvasResolution=e}get scaleCanvasResolutionFactor(){return this._scaleCanvasResolutionFactor}set scaleCanvasResolutionFactor(e){this._scaleCanvasResolutionFactor=e||.6}get delayBeforeRestore(){return this._delayBeforeRestore}set delayBeforeRestore(e){this._delayBeforeRestore=e}get delayBeforeRestoreSeconds(){return this._delayBeforeRestoreSeconds}set delayBeforeRestoreSeconds(e){this._delayBeforeRestoreSeconds=null!=e?e:.5}send(e,t){}destroy(){this.viewer.scene.camera.off(this._onCameraMatrix),this.viewer.scene.canvas.off(this._onCanvasBoundary),this.viewer.scene.input.off(this._onSceneMouseDown),this.viewer.scene.input.off(this._onSceneMouseUp),this.viewer.scene.input.off(this._onSceneMouseMove),this.viewer.scene.off(this._onSceneTick),super.destroy()}}class Gp{constructor(){}getMetaModel(e,t,s){y.loadJSON(e,(e=>{t(e)}),(function(e){s(e)}))}getGLTF(e,t,s){y.loadArraybuffer(e,(e=>{t(e)}),(function(e){s(e)}))}getGLB(e,t,s){y.loadArraybuffer(e,(e=>{t(e)}),(function(e){s(e)}))}getArrayBuffer(e,t,s,i){!function(e,t,s,i){var r=()=>{};s=s||r,i=i||r;const o=/^data:(.*?)(;base64)?,(.*)$/,n=t.match(o);if(n){const e=!!n[2];var a=n[3];a=window.decodeURIComponent(a),e&&(a=window.atob(a));try{const e=new ArrayBuffer(a.length),t=new Uint8Array(e);for(var h=0;h<a.length;h++)t[h]=a.charCodeAt(h);window.setTimeout((function(){s(e)}),0)}catch(e){window.setTimeout((function(){i(e)}),0)}}else{const r=function(e){var t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}(e),o=r+t,n=new XMLHttpRequest;n.open("GET",o,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){4===n.readyState&&(200===n.status?s(n.response):i("loadArrayBuffer error : "+n.response))},n.send(null)}}(e,t,(e=>{s(e)}),(function(e){i(e)}))}}function Hp(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const Vp=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),Up="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Up&&parseFloat(Up[1]);function zp(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const Wp={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document},Xp=Wp.global||Wp.self||Wp.window||{},Yp="object"!=typeof process||"[object process]"!==String(process)||process.browser,Kp="function"==typeof importScripts,Jp="undefined"!=typeof window&&void 0!==window.orientation,Zp="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function Qp(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}Zp&&parseFloat(Zp[1]);class qp{constructor(e,t){Qp(this,"name",void 0),Qp(this,"workerThread",void 0),Qp(this,"isRunning",!0),Qp(this,"result",void 0),Qp(this,"_resolve",(()=>{})),Qp(this,"_reject",(()=>{})),this.name=e,this.workerThread=t,this.result=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){zp(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){zp(this.isRunning),this.isRunning=!1,this._reject(e)}}class $p{}const ed=new Map;function td(e){zp(e.source&&!e.url||!e.source&&e.url);let t=ed.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return sd((t=e,"try {\n  importScripts('".concat(t,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")));var t}(e.url),ed.set(e.url,t)),e.source&&(t=sd(e.source),ed.set(e.source,t))),zp(t),t}function sd(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function id(e,t=!0,s){const i=s||new Set;if(e){if(rd(e))i.add(e);else if(rd(e.buffer))i.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const s in e)id(e[s],t,i)}else;return void 0===s?Array.from(i):[]}function rd(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const od=()=>{};class nd{static isSupported(){return"undefined"!=typeof Worker&&Yp||void 0!==typeof $p}constructor(e){Qp(this,"name",void 0),Qp(this,"source",void 0),Qp(this,"url",void 0),Qp(this,"terminated",!1),Qp(this,"worker",void 0),Qp(this,"onMessage",void 0),Qp(this,"onError",void 0),Qp(this,"_loadableURL","");const{name:t,source:s,url:i}=e;zp(s||i),this.name=t,this.source=s,this.url=i,this.onMessage=od,this.onError=e=>console.log(e),this.worker=Yp?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=od,this.onError=od,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||id(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}_createBrowserWorker(){this._loadableURL=td({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new $p(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new $p(this.source,{eval:!0})}return e.on("message",(e=>{this.onMessage(e)})),e.on("error",(e=>{this.onError(e)})),e.on("exit",(e=>{})),e}}class ad{static isSupported(){return nd.isSupported()}constructor(e){Qp(this,"name","unnamed"),Qp(this,"source",void 0),Qp(this,"url",void 0),Qp(this,"maxConcurrency",1),Qp(this,"maxMobileConcurrency",1),Qp(this,"onDebug",(()=>{})),Qp(this,"reuseWorkers",!0),Qp(this,"props",{}),Qp(this,"jobQueue",[]),Qp(this,"idleQueue",[]),Qp(this,"count",0),Qp(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=((e,t,s)=>e.done(s)),s=((e,t)=>e.error(t))){const i=new Promise((i=>(this.jobQueue.push({name:e,onMessage:t,onError:s,onStart:i}),this)));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const s=new qp(t.name,e);e.onMessage=e=>t.onMessage(s,e.type,e.payload),e.onError=e=>t.onError(s,e),t.onStart(s);try{await s.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new nd({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Jp?this.maxMobileConcurrency:this.maxConcurrency}}const hd={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class ld{static isSupported(){return nd.isSupported()}static getWorkerFarm(e={}){return ld._workerFarm=ld._workerFarm||new ld({}),ld._workerFarm.setProps(e),ld._workerFarm}constructor(e){Qp(this,"props",void 0),Qp(this,"workerPools",new Map),this.props={...hd},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:s,url:i}=e;let r=this.workerPools.get(t);return r||(r=new ad({name:t,source:s,url:i}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}Qp(ld,"_workerFarm",void 0);var ud=Object.freeze({__proto__:null,default:{}});const cd={};async function pd(e,t=null,s={}){return t&&(e=function(e,t,s){if(e.startsWith("http"))return e;const i=s.modules||{};if(i[e])return i[e];if(!Yp)return"modules/".concat(t,"/dist/libs/").concat(e);if(s.CDN)return zp(s.CDN.startsWith("http")),"".concat(s.CDN,"/").concat(t,"@").concat("3.2.6","/dist/libs/").concat(e);if(Kp)return"../src/libs/".concat(e);return"modules/".concat(t,"/src/libs/").concat(e)}(e,t,s)),cd[e]=cd[e]||async function(e){if(e.endsWith("wasm")){const t=await fetch(e);return await t.arrayBuffer()}if(!Yp)try{return ud&&void 0}catch{return null}if(Kp)return importScripts(e);const t=await fetch(e);return function(e,t){if(!Yp)return;if(Kp)return eval.call(Xp,e),null;const s=document.createElement("script");s.id=t;try{s.appendChild(document.createTextNode(e))}catch(t){s.text=e}return document.body.appendChild(s),null}(await t.text(),e)}(e),await cd[e]}async function dd(e,t,s,i,r){const o=e.id,n=function(e,t={}){const s=t[e.id]||{},i="".concat(e.id,"-worker.js");let r=s.workerUrl;if(r||"compression"!==e.id||(r=t.workerUrl),"test"===t._workerType&&(r="modules/".concat(e.module,"/dist/").concat(i)),!r){let t=e.version;"latest"===t&&(t="latest");const s=t?"@".concat(t):"";r="https://unpkg.com/@loaders.gl/".concat(e.module).concat(s,"/dist/").concat(i)}return zp(r),r}(e,s),a=ld.getWorkerFarm(s).getWorkerPool({name:o,url:n});s=JSON.parse(JSON.stringify(s)),i=JSON.parse(JSON.stringify(i||{}));const h=await a.startJob("process-on-worker",md.bind(null,r));h.postMessage("process",{input:t,options:s,context:i});const l=await h.result;return await l.result}async function md(e,t,s,i){switch(s){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:r,input:o,options:n}=i;try{const s=await e(o,n);t.postMessage("done",{id:r,result:s})}catch(e){const s=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:r,error:s})}break;default:console.warn("parse-with-worker unknown message ".concat(s))}}function fd(e,t,s){if(e.byteLength<=t+s)return"";const i=new DataView(e);let r="";for(let e=0;e<s;e++)r+=String.fromCharCode(i.getUint8(t+e));return r}function gd(e){try{return JSON.parse(e)}catch(t){throw new Error('Failed to parse JSON from data starting with "'.concat(function(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return fd(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer)return fd(e,0,t);return""}(e),'"'))}}function _d(e){return e&&"object"==typeof e&&e.isBuffer}function yd(e){if(_d(e))return function(e){if(_d(e))return new Uint8Array(e.buffer,e.byteOffset,e.length).slice().buffer;return e}(e);if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function vd(e,t,s){const i=void 0!==s?new Uint8Array(e).subarray(t,t+s):new Uint8Array(e).subarray(t);return new Uint8Array(i).buffer}function bd(e,t){return Hp(e>=0),Hp(t>0),e+(t-1)&~(t-1)}function xd(e,t,s){let i;if(e instanceof ArrayBuffer)i=new Uint8Array(e);else{const t=e.byteOffset,s=e.byteLength;i=new Uint8Array(e.buffer||e.arrayBuffer,t,s)}return t.set(i,s),s+bd(i.byteLength,4)}async function Pd(e){const t=[];for await(const s of e)t.push(s);return function(...e){const t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),s=t.reduce(((e,t)=>e+t.byteLength),0),i=new Uint8Array(s);let r=0;for(const e of t)i.set(e,r),r+=e.byteLength;return i.buffer}(...t)}const Td={};const wd=e=>"function"==typeof e,Md=e=>null!==e&&"object"==typeof e,Id=e=>Md(e)&&e.constructor==={}.constructor,Cd=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,Dd=e=>"undefined"!=typeof Blob&&e instanceof Blob,Ad=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||Md(e)&&wd(e.tee)&&wd(e.cancel)&&wd(e.getReader))(e)||(e=>Md(e)&&wd(e.read)&&wd(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e),Ed=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Fd=/^([-\w.]+\/[-\w.+]+)/;function Rd(e){const t=Fd.exec(e);return t?t[1]:e}function Sd(e){const t=Ed.exec(e);return t?t[1]:""}const Od=/\?.*/;function Bd(e){if(Cd(e)){const t=Ld(e.url||"");return{url:t,type:Rd(e.headers.get("content-type")||"")||Sd(t)}}return Dd(e)?{url:Ld(e.name||""),type:e.type||""}:"string"==typeof e?{url:Ld(e),type:Sd(e)}:{url:"",type:""}}function Ld(e){return e.replace(Od,"")}async function Nd(e){if(Cd(e))return e;const t={},s=function(e){return Cd(e)?e.headers["content-length"]||-1:Dd(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);s>=0&&(t["content-length"]=String(s));const{url:i,type:r}=Bd(e);r&&(t["content-type"]=r);const o=await async function(e){const t=5;if("string"==typeof e)return"data:,".concat(e.slice(0,t));if(e instanceof Blob){const t=e.slice(0,5);return await new Promise((e=>{const s=new FileReader;s.onload=t=>{var s;return e(null==t||null===(s=t.target)||void 0===s?void 0:s.result)},s.readAsDataURL(t)}))}if(e instanceof ArrayBuffer){const s=function(e){let t="";const s=new Uint8Array(e);for(let e=0;e<s.byteLength;e++)t+=String.fromCharCode(s[e]);return btoa(t)}(e.slice(0,t));return"data:base64,".concat(s)}return null}(e);o&&(t["x-first-bytes"]=o),"string"==typeof e&&(e=(new TextEncoder).encode(e));const n=new Response(e,{headers:t});return Object.defineProperty(n,"url",{value:i}),n}async function kd(e,t){if("string"==typeof e){e=function(e){for(const t in Td)if(e.startsWith(t)){const s=Td[t];e=e.replace(t,s)}return e.startsWith("http://")||e.startsWith("https://")||(e="".concat("").concat(e)),e}(e);let s=t;return null!=t&&t.fetch&&"function"!=typeof(null==t?void 0:t.fetch)&&(s=t.fetch),await fetch(e,s)}return await Nd(e)}const jd={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},Gd=jd.window||jd.self||jd.global,Hd=jd.process||{},Vd="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source",Ud=!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent,s=e||t;return!!(s&&s.indexOf("Electron")>=0)}();class zd{constructor(e,t,s="sessionStorage"){this.storage=function(e){try{const t=window[e],s="__storage_test__";return t.setItem(s,s),t.removeItem(s),t}catch(e){return null}}(s),this.id=e,this.config={},Object.assign(this.config,t),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function Wd(e,t,s,i=600){const r=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>i&&(s=Math.min(s,i/e.width));const o=e.width*s,n=e.height*s,a=["font-size:1px;","padding:".concat(Math.floor(n/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(n,"px;"),"background:url(".concat(r,");"),"background-size:".concat(o,"px ").concat(n,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}const Xd={BLACK:30,RED:31,GREEN:32,YELLOW:33,BLUE:34,MAGENTA:35,CYAN:36,WHITE:37,BRIGHT_BLACK:90,BRIGHT_RED:91,BRIGHT_GREEN:92,BRIGHT_YELLOW:93,BRIGHT_BLUE:94,BRIGHT_MAGENTA:95,BRIGHT_CYAN:96,BRIGHT_WHITE:97};function Yd(e){return"string"==typeof e?Xd[e.toUpperCase()]||Xd.WHITE:e}function Kd(e,t){if(!e)throw new Error(t||"Assertion failed")}function Jd(){let e;if(Ud&&Gd.performance)e=Gd.performance.now();else if(Hd.hrtime){const t=Hd.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}const Zd={debug:Ud&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Qd={enabled:!0,level:0};function qd(){}const $d={},em={once:!0};function tm(e){for(const t in e)for(const s in e[t])return s||"untitled";return"empty"}class sm{constructor({id:e}={id:""}){this.id=e,this.VERSION=Vd,this._startTs=Jd(),this._deltaTs=Jd(),this.LOG_THROTTLE_TIMEOUT=0,this._storage=new zd("__probe-".concat(this.id,"__"),Qd),this.userData={},this.timeStamp("".concat(this.id," started")),function(e,t=["constructor"]){const s=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(s);for(const s of i)"function"==typeof e[s]&&(t.find((e=>s===e))||(e[s]=e[s].bind(e)))}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Jd()-this._startTs).toPrecision(10))}getDelta(){return Number((Jd()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}assert(e,t){Kd(e,t)}warn(e){return this._getLogFunction(0,e,Zd.warn,arguments,em)}error(e){return this._getLogFunction(0,e,Zd.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,Zd.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Zd.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Zd.debug||Zd.info,arguments,em)}table(e,t,s){return t?this._getLogFunction(e,t,console.table||qd,s&&[s],{tag:tm(t)}):qd}image({logLevel:e,priority:t,image:s,message:i="",scale:r=1}){return this._shouldLog(e||t)?Ud?function({image:e,message:t="",scale:s=1}){if("string"==typeof e){const i=new Image;return i.onload=()=>{const e=Wd(i,t,s);console.log(...e)},i.src=e,qd}const i=e.nodeName||"";if("img"===i.toLowerCase())return console.log(...Wd(e,t,s)),qd;if("canvas"===i.toLowerCase()){const i=new Image;return i.onload=()=>console.log(...Wd(i,t,s)),i.src=e.toDataURL(),qd}return qd}({image:s,message:i,scale:r}):function({image:e,message:t="",scale:s=1}){let i=null;try{i=module.require("asciify-image")}catch(e){}if(i)return()=>i(e,{fit:"box",width:"".concat(Math.round(80*s),"%")}).then((e=>console.log(e)));return qd}({image:s,message:i,scale:r}):qd}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}get(e){return this._storage.config[e]}set(e,t){this._storage.updateConfiguration({[e]:t})}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||qd)}group(e,t,s={collapsed:!1}){s=rm({logLevel:e,message:t,opts:s});const{collapsed:i}=s;return s.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t,s={}){return this.group(e,t,Object.assign({},s,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||qd)}withGroup(e,t,s){this.group(e,t)();try{s()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=im(e)}_getLogFunction(e,t,s,i=[],r){if(this._shouldLog(e)){r=rm({logLevel:e,message:t,args:i,opts:r}),Kd(s=s||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Jd();const o=r.tag||r.message;if(r.once){if($d[o])return qd;$d[o]=Jd()}return t=function(e,t,s){if("string"==typeof t){const i=s.time?function(e,t=8){const s=Math.max(t-e.length,0);return"".concat(" ".repeat(s)).concat(e)}(function(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}(s.total)):"";t=function(e,t,s){return Ud||"string"!=typeof e||(t&&(t=Yd(t),e="[".concat(t,"m").concat(e,"[39m")),s&&(t=Yd(s),e="[".concat(s+10,"m").concat(e,"[49m"))),e}(t=s.time?"".concat(e,": ").concat(i,"  ").concat(t):"".concat(e,": ").concat(t),s.color,s.background)}return t}(this.id,r.message,r),s.bind(console,t,...r.args)}return qd}}function im(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Kd(Number.isFinite(t)&&t>=0),t}function rm(e){const{logLevel:t,message:s}=e;e.logLevel=im(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==s;);switch(e.args=i,typeof t){case"string":case"function":void 0!==s&&i.unshift(s),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const r=typeof e.message;return Kd("string"===r||"object"===r),Object.assign(e,e.opts)}sm.VERSION=Vd;const om=new sm({id:"loaders.gl"});class nm{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const am={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){Qp(this,"console",void 0),this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Vp,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},hm={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function lm(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state=e._state||{},e._state}const um=()=>{const e=lm();return e.globalOptions=e.globalOptions||{...am},e.globalOptions};function cm(e,t,s,i){return s=s||[],function(e,t){dm(e,null,am,hm,t);for(const s of t){const i=e&&e[s.id]||{},r=s.options&&s.options[s.id]||{},o=s.deprecatedOptions&&s.deprecatedOptions[s.id]||{};dm(i,s.id,r,o,t)}}(e,s=Array.isArray(s)?s:[s]),function(e,t,s){const i={...e.options||{}};(function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)})(i,s),null===i.log&&(i.log=new nm);return fm(i,um()),fm(i,t),i}(t,e,i)}function pm(e,t){const s=um(),i=e||s;return"function"==typeof i.fetch?i.fetch:Md(i.fetch)?e=>kd(e,i):null!=t&&t.fetch?null==t?void 0:t.fetch:kd}function dm(e,t,s,i,r){const o=t||"Top level",n=t?"".concat(t,"."):"";for(const a in e){const h=!t&&Md(e[a]),l="baseUri"===a&&!t,u="workerUrl"===a&&t;if(!(a in s)&&!l&&!u)if(a in i)om.warn("".concat(o," loader option '").concat(n).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!h){const e=mm(a,r);om.warn("".concat(o," loader option '").concat(n).concat(a,"' not recognized. ").concat(e))()}}}function mm(e,t){const s=e.toLowerCase();let i="";for(const r of t)for(const t in r.options){if(e===t)return"Did you mean '".concat(r.id,".").concat(t,"'?");const o=t.toLowerCase();(s.startsWith(o)||o.startsWith(s))&&(i=i||"Did you mean '".concat(r.id,".").concat(t,"'?"))}return i}function fm(e,t){for(const s in t)if(s in t){const i=t[s];Id(i)&&Id(e[s])?e[s]={...e[s],...t[s]}:e[s]=t[s]}}function gm(e){var t;if(!e)return!1;Array.isArray(e)&&(e=e[0]);return Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions)}function _m(e){var t,s;let i;return Hp(e,"null loader"),Hp(gm(e),"invalid loader"),Array.isArray(e)&&(i=e[1],e=e[0],e={...e,options:{...e.options,...i}}),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(s=e)&&void 0!==s&&s.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}function ym(){return(()=>{const e=lm();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry})()}function vm(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(e){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const t="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent,s=e||t;return!!(s&&s.indexOf("Electron")>=0)}()}const bm={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},xm=bm.window||bm.self||bm.global,Pm=bm.process||{},Tm="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";vm();class wm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";Qp(this,"storage",void 0),Qp(this,"id",void 0),Qp(this,"config",{}),this.storage=function(e){try{const t=window[e],s="__storage_test__";return t.setItem(s,s),t.removeItem(s),t}catch(e){return null}}(s),this.id=e,this.config={},Object.assign(this.config,t),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){return this.config={},this.updateConfiguration(e)}updateConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}return this}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function Mm(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const r=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>i&&(s=Math.min(s,i/e.width));const o=e.width*s,n=e.height*s,a=["font-size:1px;","padding:".concat(Math.floor(n/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(n,"px;"),"background:url(".concat(r,");"),"background-size:".concat(o,"px ").concat(n,"px;"),"color:transparent;"].join("");return["".concat(t," %c+"),a]}let Im;function Cm(e){return"string"==typeof e?Im[e.toUpperCase()]||Im.WHITE:e}function Dm(e,t){if(!e)throw new Error(t||"Assertion failed")}function Am(){let e;var t,s;if(vm&&"performance"in xm)e=null==xm||null===(t=xm.performance)||void 0===t||null===(s=t.now)||void 0===s?void 0:s.call(t);else if("hrtime"in Pm){var i;const t=null==Pm||null===(i=Pm.hrtime)||void 0===i?void 0:i.call(Pm);e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(Im||(Im={}));const Em={debug:vm&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Fm={enabled:!0,level:0};function Rm(){}const Sm={},Om={once:!0};class Bm{constructor(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};Qp(this,"id",void 0),Qp(this,"VERSION",Tm),Qp(this,"_startTs",Am()),Qp(this,"_deltaTs",Am()),Qp(this,"_storage",void 0),Qp(this,"userData",{}),Qp(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this._storage=new wm("__probe-".concat(this.id,"__"),Fm),this.userData={},this.timeStamp("".concat(this.id," started")),function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const s=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(s);for(const s of i)"function"==typeof e[s]&&(t.find((e=>s===e))||(e[s]=e[s].bind(e)))}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Am()-this._startTs).toPrecision(10))}getDelta(){return Number((Am()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:e}),this}setLevel(e){return this._storage.updateConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.updateConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){Dm(e,t)}warn(e){return this._getLogFunction(0,e,Em.warn,arguments,Om)}error(e){return this._getLogFunction(0,e,Em.error,arguments)}deprecated(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}removed(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}probe(e,t){return this._getLogFunction(e,t,Em.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Em.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){for(var s=arguments.length,i=new Array(s>2?s-2:0),r=2;r<s;r++)i[r-2]=arguments[r];return this._getLogFunction(e,t,Em.debug||Em.info,arguments,Om)}table(e,t,s){return t?this._getLogFunction(e,t,console.table||Rm,s&&[s],{tag:km(t)}):Rm}image(e){let{logLevel:t,priority:s,image:i,message:r="",scale:o=1}=e;return this._shouldLog(t||s)?vm?function(e){let{image:t,message:s="",scale:i=1}=e;if("string"==typeof t){const e=new Image;return e.onload=()=>{const t=Mm(e,s,i);console.log(...t)},e.src=t,Rm}const r=t.nodeName||"";if("img"===r.toLowerCase())return console.log(...Mm(t,s,i)),Rm;if("canvas"===r.toLowerCase()){const e=new Image;return e.onload=()=>console.log(...Mm(e,s,i)),e.src=t.toDataURL(),Rm}return Rm}({image:i,message:r,scale:o}):function(e){let{image:t,message:s="",scale:i=1}=e,r=null;try{r=module.require("asciify-image")}catch(e){}if(r)return()=>r(t,{fit:"box",width:"".concat(Math.round(80*i),"%")}).then((e=>console.log(e)));return Rm}({image:i,message:r,scale:o}):Rm}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Rm)}group(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const i=Nm({logLevel:e,message:t,opts:s}),{collapsed:r}=s;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(e,t,Object.assign({},s,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Rm)}withGroup(e,t,s){this.group(e,t)();try{s()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Lm(e)}_getLogFunction(e,t,s,i,r){if(this._shouldLog(e)){r=Nm({logLevel:e,message:t,args:i,opts:r}),Dm(s=s||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Am();const o=r.tag||r.message;if(r.once){if(Sm[o])return Rm;Sm[o]=Am()}return t=function(e,t,s){if("string"==typeof t){const i=s.time?function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const s=Math.max(t-e.length,0);return"".concat(" ".repeat(s)).concat(e)}(function(e){let t;return t=e<10?"".concat(e.toFixed(2),"ms"):e<100?"".concat(e.toFixed(1),"ms"):e<1e3?"".concat(e.toFixed(0),"ms"):"".concat((e/1e3).toFixed(2),"s"),t}(s.total)):"";t=function(e,t,s){return vm||"string"!=typeof e||(t&&(t=Cm(t),e="[".concat(t,"m").concat(e,"[39m")),s&&(t=Cm(s),e="[".concat(s+10,"m").concat(e,"[49m"))),e}(t=s.time?"".concat(e,": ").concat(i,"  ").concat(t):"".concat(e,": ").concat(t),s.color,s.background)}return t}(this.id,r.message,r),s.bind(console,t,...r.args)}return Rm}}function Lm(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Dm(Number.isFinite(t)&&t>=0),t}function Nm(e){const{logLevel:t,message:s}=e;e.logLevel=Lm(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==s;);switch(typeof t){case"string":case"function":void 0!==s&&i.unshift(s),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const r=typeof e.message;return Dm("string"===r||"object"===r),Object.assign(e,{args:i},e.opts)}function km(e){for(const t in e)for(const s in e[t])return s||"untitled";return"empty"}Qp(Bm,"VERSION",Tm);const jm=new Bm({id:"loaders.gl"}),Gm=/\.([^.]+)$/;function Hm(e,t=[],s,i){if(!Vm(e))return null;if(t&&!Array.isArray(t))return _m(t);let r=[];t&&(r=r.concat(t)),null!=s&&s.ignoreRegisteredLoaders||r.push(...ym()),function(e){for(const t of e)_m(t)}(r);const o=function(e,t,s,i){const{url:r,type:o}=Bd(e),n=r||(null==i?void 0:i.url);let a=null,h="";null!=s&&s.mimeType&&(a=zm(t,null==s?void 0:s.mimeType),h="match forced by supplied MIME type ".concat(null==s?void 0:s.mimeType));var l;a=a||function(e,t){const s=t&&Gm.exec(t),i=s&&s[1];return i?function(e,t){t=t.toLowerCase();for(const s of e)for(const e of s.extensions)if(e.toLowerCase()===t)return s;return null}(e,i):null}(t,n),h=h||(a?"matched url ".concat(n):""),a=a||zm(t,o),h=h||(a?"matched MIME type ".concat(o):""),a=a||function(e,t){if(!t)return null;for(const s of e)if("string"==typeof t){if(Wm(t,s))return s}else if(ArrayBuffer.isView(t)){if(Xm(t.buffer,t.byteOffset,s))return s}else if(t instanceof ArrayBuffer){if(Xm(t,0,s))return s}return null}(t,e),h=h||(a?"matched initial data ".concat(Ym(e)):""),a=a||zm(t,null==s?void 0:s.fallbackMimeType),h=h||(a?"matched fallback MIME type ".concat(o):""),h&&jm.log(1,"selectLoader selected ".concat(null===(l=a)||void 0===l?void 0:l.name,": ").concat(h,"."));return a}(e,r,s,i);if(!(o||null!=s&&s.nothrow))throw new Error(Um(e));return o}function Vm(e){return!(e instanceof Response&&204===e.status)}function Um(e){const{url:t,type:s}=Bd(e);let i="No valid loader found (";i+=t?"".concat(function(e){const t=e&&e.lastIndexOf("/");return t>=0?e.substr(t+1):""}(t),", "):"no url provided, ",i+="MIME type: ".concat(s?'"'.concat(s,'"'):"not provided",", ");const r=e?Ym(e):"";return i+=r?' first bytes: "'.concat(r,'"'):"first bytes: not available",i+=")",i}function zm(e,t){for(const s of e){if(s.mimeTypes&&s.mimeTypes.includes(t))return s;if(t==="application/x.".concat(s.id))return s}return null}function Wm(e,t){if(t.testText)return t.testText(e);return(Array.isArray(t.tests)?t.tests:[t.tests]).some((t=>e.startsWith(t)))}function Xm(e,t,s){return(Array.isArray(s.tests)?s.tests:[s.tests]).some((i=>function(e,t,s,i){if(i instanceof ArrayBuffer)return function(e,t,s){if(s=s||e.byteLength,e.byteLength<s||t.byteLength<s)return!1;const i=new Uint8Array(e),r=new Uint8Array(t);for(let e=0;e<i.length;++e)if(i[e]!==r[e])return!1;return!0}(i,e,i.byteLength);switch(typeof i){case"function":return i(e,s);case"string":return i===Km(e,t,i.length);default:return!1}}(e,t,s,i)))}function Ym(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return Km(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return Km(e,0,t)}return""}function Km(e,t,s){if(e.byteLength<t+s)return"";const i=new DataView(e);let r="";for(let e=0;e<s;e++)r+=String.fromCharCode(i.getUint8(t+e));return r}const Jm=262144;function Zm(e,t){return Vp?async function*(e,t){const s=e.getReader();let i;try{for(;;){const e=i||s.read();null!=t&&t._streamReadAhead&&(i=s.read());const{done:r,value:o}=await e;if(r)return;yield yd(o)}}catch(e){s.releaseLock()}}(e,t):async function*(e,t){for await(const t of e)yield yd(t)}(e)}function Qm(e,t){if("string"==typeof e)return function*(e,t){const s=(null==t?void 0:t.chunkSize)||262144;let i=0;const r=new TextEncoder;for(;i<e.length;){const t=Math.min(e.length-i,s),o=e.slice(i,i+t);i+=t,yield r.encode(o)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){const{chunkSize:s=Jm}=t;let i=0;for(;i<e.byteLength;){const t=Math.min(e.byteLength-i,s),r=new ArrayBuffer(t),o=new Uint8Array(e,i,t);new Uint8Array(r).set(o),i+=t,yield r}}(e,t);if(Dd(e))return async function*(e,t){const s=(null==t?void 0:t.chunkSize)||1048576;let i=0;for(;i<e.size;){const t=i+s,r=await e.slice(i,t).arrayBuffer();i=t,yield r}}(e,t);if(Ad(e))return Zm(e,t);if(Cd(e)){return Zm(e.body,t)}throw new Error("makeIterator")}const qm="Cannot convert supplied data type";async function $m(e,t,s){const i=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||i)return function(e,t,s){if(t.text&&"string"==typeof e)return e;var i;if((i=e)&&"object"==typeof i&&i.isBuffer&&(e=e.buffer),e instanceof ArrayBuffer){const s=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(s):s}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let s=e.buffer;const i=e.byteLength||e.length;return 0===e.byteOffset&&i===s.byteLength||(s=s.slice(e.byteOffset,e.byteOffset+i)),s}throw new Error(qm)}(e,t);if(Dd(e)&&(e=await Nd(e)),Cd(e)){const s=e;return await async function(e){if(!e.ok){const t=await async function(e){let t="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): ");try{const s=e.headers.get("Content-Type");let i=e.statusText;s.includes("application/json")&&(i+=" ".concat(await e.text())),t+=i,t=t.length>60?"".concat(t.slice(0,60),"..."):t}catch(e){}return t}(e);throw new Error(t)}}(s),t.binary?await s.arrayBuffer():await s.text()}if(Ad(e)&&(e=Qm(e,s)),(r=e)&&"function"==typeof r[Symbol.iterator]||(e=>e&&"function"==typeof e[Symbol.asyncIterator])(e))return Pd(e);var r;throw new Error(qm)}async function ef(e,t,s,i){zp(!i||"object"==typeof i),!t||Array.isArray(t)||gm(t)||(i=void 0,s=t,t=void 0),e=await e,s=s||{};const{url:r}=Bd(e),o=function(e,t){if(!t&&e&&!Array.isArray(e))return e;let s;if(e&&(s=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];s=s?[...s,...e]:e}return s&&s.length?s:null}(t,i),n=await async function(e,t=[],s,i){if(!Vm(e))return null;let r=Hm(e,t,{...s,nothrow:!0},i);if(r)return r;if(Dd(e)&&(r=Hm(e=await e.slice(0,10).arrayBuffer(),t,s,i)),!(r||null!=s&&s.nothrow))throw new Error(Um(e));return r}(e,o,s);return n?(i=function(e,t,s=null){if(s)return s;const i={fetch:pm(t,e),...e};return Array.isArray(i.loaders)||(i.loaders=null),i}({url:r,parse:ef,loaders:o},s=cm(s,n,o,r),i),await async function(e,t,s,i){if(function(e,t="3.2.6"){zp(e,"no worker provided");const s=e.version}(e),Cd(t)){const e=t,{ok:s,redirected:r,status:o,statusText:n,type:a,url:h}=e,l=Object.fromEntries(e.headers.entries());i.response={headers:l,ok:s,redirected:r,status:o,statusText:n,type:a,url:h}}if(t=await $m(t,e,s),e.parseTextSync&&"string"==typeof t)return s.dataType="text",e.parseTextSync(t,s,i,e);if(function(e,t){return!!ld.isSupported()&&!!(Yp||null!=t&&t._nodeWorkers)&&e.worker&&(null==t?void 0:t.worker)}(e,s))return await dd(e,t,s,i,ef);if(e.parseText&&"string"==typeof t)return await e.parseText(t,s,i,e);if(e.parse)return await e.parse(t,s,i,e);throw zp(!e.parseSync),new Error("".concat(e.id," loader - no parser found and worker is disabled"))}(n,e,s,i)):null}const tf="https://unpkg.com/@loaders.gl/textures@".concat("3.2.6","/dist/libs/basis_encoder.wasm"),sf="https://unpkg.com/@loaders.gl/textures@".concat("3.2.6","/dist/libs/basis_encoder.js");let rf,of;async function nf(e){const t=e.modules||{};return t.basis?t.basis:(rf=rf||async function(e){let t=null,s=null;return[t,s]=await Promise.all([await pd("basis_transcoder.js","textures",e),await pd("basis_transcoder.wasm","textures",e)]),t=t||globalThis.BASIS,await function(e,t){const s={};t&&(s.wasmBinary=t);return new Promise((t=>{e(s).then((e=>{const{BasisFile:s,initializeBasis:i}=e;i(),t({BasisFile:s})}))}))}(t,s)}(e),await rf)}async function af(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(of=of||async function(e){let t=null,s=null;return[t,s]=await Promise.all([await pd(sf,"textures",e),await pd(tf,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){const s={};t&&(s.wasmBinary=t);return new Promise((t=>{e(s).then((e=>{const{BasisFile:s,KTX2File:i,initializeBasis:r,BasisEncoder:o}=e;r(),t({BasisFile:s,KTX2File:i,BasisEncoder:o})}))}))}(t,s)}(e),await of)}const hf=33776,lf=33779,uf=35840,cf=35842,pf=36196,df=37808,mf=["","WEBKIT_","MOZ_"],ff={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let gf=null;function _f(e){if(!gf){e=e||function(){try{return document.createElement("canvas").getContext("webgl")}catch(e){return null}}()||void 0,gf=new Set;for(const t of mf)for(const s in ff)if(e&&e.getExtension("".concat(t).concat(s))){const e=ff[s];gf.add(e)}}return gf}var yf,vf,bf,xf,Pf,Tf,wf,Mf,If;(If=yf||(yf={}))[If.NONE=0]="NONE",If[If.BASISLZ=1]="BASISLZ",If[If.ZSTD=2]="ZSTD",If[If.ZLIB=3]="ZLIB",function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(vf||(vf={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(bf||(bf={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(xf||(xf={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(Pf||(Pf={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(Tf||(Tf={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(wf||(wf={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(Mf||(Mf={}));const Cf=[171,75,84,88,32,50,48,187,13,10,26,10];const Df={etc1:{basisFormat:0,compressed:!0,format:pf},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:hf},bc3:{basisFormat:3,compressed:!0,format:lf},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:uf},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:cf},"astc-4x4":{basisFormat:10,compressed:!0,format:df},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function Af(e,t,s){const i=new e(new Uint8Array(t));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const e=i.getNumImages(),t=[];for(let r=0;r<e;r++){const e=i.getNumLevels(r),o=[];for(let t=0;t<e;t++)o.push(Ef(i,r,t,s));t.push(o)}return t}finally{i.close(),i.delete()}}function Ef(e,t,s,i){const r=e.getImageWidth(t,s),o=e.getImageHeight(t,s),n=e.getHasAlpha(),{compressed:a,format:h,basisFormat:l}=Sf(i,n),u=e.getImageTranscodedSizeInBytes(t,s,l),c=new Uint8Array(u);if(!e.transcodeImage(c,t,s,l,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:o,data:c,compressed:a,format:h,hasAlpha:n}}function Ff(e,t,s){const i=new e(new Uint8Array(t));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const e=i.getLevels(),t=[];for(let r=0;r<e;r++){t.push(Rf(i,r,s));break}return[t]}finally{i.close(),i.delete()}}function Rf(e,t,s){const{alphaFlag:i,height:r,width:o}=e.getImageLevelInfo(t,0,0),{compressed:n,format:a,basisFormat:h}=Sf(s,i),l=e.getImageTranscodedSizeInBytes(t,0,0,h),u=new Uint8Array(l);if(!e.transcodeImage(u,t,0,0,h,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:o,height:r,data:u,compressed:n,hasAlpha:i,format:a}}function Sf(e,t){let s=e&&e.basis&&e.basis.format;return"auto"===s&&(s=Of()),"object"==typeof s&&(s=t?s.alpha:s.noAlpha),s=s.toLowerCase(),Df[s]}function Of(){const e=_f();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const Bf={...{name:"Basis",id:"basis",module:"textures",version:"3.2.6",worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:async function(e,t){if("auto"===t.basis.containerFormat){if(function(e){const t=new Uint8Array(e);return!(t.byteLength<Cf.length||t[0]!==Cf[0]||t[1]!==Cf[1]||t[2]!==Cf[2]||t[3]!==Cf[3]||t[4]!==Cf[4]||t[5]!==Cf[5]||t[6]!==Cf[6]||t[7]!==Cf[7]||t[8]!==Cf[8]||t[9]!==Cf[9]||t[10]!==Cf[10]||t[11]!==Cf[11])}(e)){return Ff((await af(t)).KTX2File,e,t)}const{BasisFile:s}=await nf(t);return Af(s,e,t)}if("encoder"===t.basis.module){const s=await af(t);return"ktx2"===t.basis.containerFormat?Ff(s.KTX2File,e,t):Af(s.BasisFile,e,t)}{const{BasisFile:s}=await nf(t);return Af(s,e,t)}}},{_parseImageNode:Lf}=globalThis,Nf="undefined"!=typeof Image,kf="undefined"!=typeof ImageBitmap,jf=Boolean(Lf),Gf=!!Vp||jf;function Hf(e){const t=function(e){if("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return"imagebitmap";if("undefined"!=typeof Image&&e instanceof Image)return"image";if(e&&"object"==typeof e&&e.data&&e.width&&e.height)return"data";return null}(e);if(!t)throw new Error("Not an image");return t}const Vf=/^data:image\/svg\+xml/,Uf=/\.svg((\?|#).*)?$/;function zf(e){return e&&(Vf.test(e)||Uf.test(e))}function Wf(e,t){if(zf(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function Xf(e,t,s){const i=function(e,t){if(zf(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw new Error(e.message)}return"data:image/svg+xml;base64,".concat(btoa(t))}return Wf(e,t)}(e,s),r=self.URL||self.webkitURL,o="string"!=typeof i&&r.createObjectURL(i);try{return await async function(e,t){const s=new Image;if(s.src=e,t.image&&t.image.decode&&s.decode)return await s.decode(),s;return await new Promise(((t,i)=>{try{s.onload=()=>t(s),s.onerror=t=>i(new Error("Could not load image ".concat(e,": ").concat(t)))}catch(e){i(e)}}))}(o||i,t)}finally{o&&r.revokeObjectURL(o)}}const Yf={};let Kf=!0;async function Jf(e,t,s){let i;if(zf(s)){i=await Xf(e,t,s)}else i=Wf(e,s);const r=t&&t.imagebitmap;return await async function(e,t=null){!function(e){for(const t in e||Yf)return!1;return!0}(t)&&Kf||(t=null);if(t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),Kf=!1}return await createImageBitmap(e)}(i,r)}function Zf(e){const t=Qf(e);return function(e){const t=Qf(e);if(!(t.byteLength>=24&&2303741511===t.getUint32(0,false)))return null;return{mimeType:"image/png",width:t.getUint32(16,false),height:t.getUint32(20,false)}}(t)||function(e){const t=Qf(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,false)&&255===t.getUint8(2)))return null;const{tableMarkers:s,sofMarkers:i}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);const t=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:t}}();let r=2;for(;r+9<t.byteLength;){const e=t.getUint16(r,false);if(i.has(e))return{mimeType:"image/jpeg",height:t.getUint16(r+5,false),width:t.getUint16(r+7,false)};if(!s.has(e))return null;r+=2,r+=t.getUint16(r,false)}return null}(t)||function(e){const t=Qf(e);if(!(t.byteLength>=10&&1195984440===t.getUint32(0,false)))return null;return{mimeType:"image/gif",width:t.getUint16(6,true),height:t.getUint16(8,true)}}(t)||function(e){const t=Qf(e);if(!(t.byteLength>=14&&16973===t.getUint16(0,false)&&t.getUint32(2,true)===t.byteLength))return null;return{mimeType:"image/bmp",width:t.getUint32(18,true),height:t.getUint32(22,true)}}(t)}function Qf(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const qf={id:"image",module:"images",name:"Images",version:"3.2.6",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg"],parse:async function(e,t,s){const i=((t=t||{}).image||{}).type||"auto",{url:r}=s||{};let o;switch(function(e){switch(e){case"auto":case"data":return function(){if(kf)return"imagebitmap";if(Nf)return"image";if(Gf)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return kf||Nf||Gf;case"imagebitmap":return kf;case"image":return Nf;case"data":return Gf;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}(e),e}}(i)){case"imagebitmap":o=await Jf(e,t,r);break;case"image":o=await Xf(e,t,r);break;case"data":o=await async function(e,t){const{mimeType:s}=Zf(e)||{},i=globalThis._parseImageNode;return Hp(i),await i(e,s)}(e);break;default:Hp(!1)}return"data"===i&&(o=function(e){switch(Hf(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),s=t.getContext("2d");if(!s)throw new Error("getImageData");return t.width=e.width,t.height=e.height,s.drawImage(e,0,0),s.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}(o)),o},tests:[e=>Boolean(Zf(new DataView(e)))],options:{image:{type:"auto",decode:!0}}},$f=["image/png","image/jpeg","image/gif"],eg={};function tg(e){return void 0===eg[e]&&(eg[e]=function(e){switch(e){case"image/webp":return function(){if(!Vp)return!1;try{return 0===document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp")}catch{return!1}}();case"image/svg":return Vp;default:if(!Vp){const{_parseImageNode:t}=globalThis;return Boolean(t)&&$f.includes(e)}return!0}}(e)),eg[e]}function sg(e,t){if(!e)throw new Error(t||"assert failed: gltf")}function ig(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const s=t.baseUri||t.uri;if(!s)throw new Error("'baseUri' must be provided to resolve relative url ".concat(e));return s.substr(0,s.lastIndexOf("/")+1)+e}const rg=["SCALAR","VEC2","VEC3","VEC4"],og=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],ng=new Map(og),ag={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},hg={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},lg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function ug(e){return rg[e-1]||rg[0]}function cg(e){const t=ng.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function pg(e,t){const s=lg[e.componentType],i=ag[e.type],r=hg[e.componentType],o=e.count*i,n=e.count*i*r;return sg(n>=0&&n<=t.byteLength),{ArrayType:s,length:o,byteLength:n}}const dg={asset:{version:"2.0",generator:"loaders.gl"},buffers:[]};class mg{constructor(e){Qp(this,"gltf",void 0),Qp(this,"sourceBuffers",void 0),Qp(this,"byteLength",void 0),this.gltf=e||{json:{...dg},buffers:[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}getExtension(e){const t=this.getUsedExtensions().find((t=>t===e)),s=this.json.extensions||{};return t?s[e]||!0:null}getRequiredExtension(e){const t=this.getRequiredExtensions().find((t=>t===e));return t?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;const s=this.json[e]&&this.json[e][t];if(!s)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return s}getTypedArrayForBufferView(e){const t=(e=this.getBufferView(e)).buffer,s=this.gltf.buffers[t];sg(s);const i=(e.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),s=this.getBuffer(t.buffer).data,{ArrayType:i,length:r}=pg(e,t);return new i(s,t.byteOffset+e.byteOffset,r)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),s=this.getBuffer(t.buffer).data,i=t.byteOffset||0;return new Uint8Array(s,i,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,s){return e.extensions=e.extensions||{},e.extensions[t]=s,this.registerUsedExtension(t),this}setObjectExtension(e,t,s){(e.extensions||{})[t]=s}removeObjectExtension(e,t){const s=e.extensions||{},i=s[t];return delete s[t],i}addExtension(e,t={}){return sg(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return sg(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((t=>t===e))||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((t=>t===e))||this.json.extensionsRequired.push(e)}removeExtension(e){this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e),this.json.extensions&&delete this.json.extensions[e]}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:s}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return s&&(i.matrix=s),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:s,material:i,mode:r=4}=e,o={primitives:[{attributes:this._addAttributes(t),mode:r}]};if(s){const e=this._addIndices(s);o.primitives[0].indices=e}return Number.isFinite(i)&&(o.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(o),this.json.meshes.length-1}addPointCloud(e){const t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(e,t){const s=Zf(e),i=t||(null==s?void 0:s.mimeType),r={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(e){const t=e.byteLength;sg(Number.isFinite(t)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const s={buffer:0,byteOffset:this.byteLength,byteLength:t};return this.byteLength+=bd(t,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(e,t){const s={bufferView:e,type:ug(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(s),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const s=this.addBufferView(e);let i={min:t.min,max:t.max};i.min&&i.max||(i=this._getAccessorMinMax(e,t.size));const r={size:t.size,componentType:cg(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(s,Object.assign(r,t))}addTexture(e){const{imageIndex:t}=e,s={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(s),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){var e,t;this.gltf.buffers=[];const s=this.byteLength,i=new ArrayBuffer(s),r=new Uint8Array(i);let o=0;for(const e of this.sourceBuffers||[])o=xd(e,r,o);null!==(e=this.json)&&void 0!==e&&null!==(t=e.buffers)&&void 0!==t&&t[0]?this.json.buffers[0].byteLength=s:this.json.buffers=[{byteLength:s}],this.gltf.binary=i,this.sourceBuffers=[i]}_removeStringFromArray(e,t){let s=!0;for(;s;){const i=e.indexOf(t);i>-1?e.splice(i,1):s=!1}}_addAttributes(e={}){const t={};for(const s in e){const i=e[s],r=this._getGltfAttributeName(s),o=this.addBinaryBuffer(i.value,i);t[r]=o}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const s={min:null,max:null};if(e.length<t)return s;s.min=[],s.max=[];const i=e.subarray(0,t);for(const e of i)s.min.push(e),s.max.push(e);for(let i=t;i<e.length;i+=t)for(let r=0;r<t;r++)s.min[0+r]=Math.min(s.min[0+r],e[i+r]),s.max[0+r]=Math.max(s.max[0+r],e[i+r]);return s}}const fg="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",gg="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",_g=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),yg=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),vg={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},bg={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function xg(e,t,s,i,r,o="NONE"){const n=await async function(){Pg||(Pg=async function(){let e=fg;WebAssembly.validate(_g)&&(e=gg,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(function(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;++s){const i=e.charCodeAt(s);t[s]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let s=0;for(let i=0;i<e.length;++i)t[s++]=t[i]<60?yg[t[i]]:64*(t[i]-60)+t[++i];return t.buffer.slice(0,s)}(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}());return Pg}();!function(e,t,s,i,r,o,n){const a=e.exports.sbrk,h=i+3&-4,l=a(h*r),u=a(o.length),c=new Uint8Array(e.exports.memory.buffer);c.set(o,u);const p=t(l,i,r,u,o.length);0===p&&n&&n(l,h,r);if(s.set(c.subarray(l,l+i*r)),a(l-a(0)),0!==p)throw new Error("Malformed buffer data: ".concat(p))}(n,n.exports[bg[r]],e,t,s,i,n.exports[vg[o||"NONE"]])}let Pg;async function Tg(e,t){const s=e.getObjectExtension(t,"EXT_meshopt_compression");if(s){const{byteOffset:i=0,byteLength:r=0,byteStride:o,count:n,mode:a,filter:h="NONE",buffer:l}=s,u=e.gltf.buffers[l],c=new Uint8Array(u.arrayBuffer,u.byteOffset+i,r),p=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);return await xg(p,n,o,c,a,h),p}return null}var wg=Object.freeze({__proto__:null,name:"EXT_meshopt_compression",decode:async function(e,t){var s;const i=new mg(e);if(null==t||null===(s=t.gltf)||void 0===s||!s.decompressMeshes)return;const r=[];for(const t of e.json.bufferViews||[])r.push(Tg(i,t));await Promise.all(r),i.removeExtension("EXT_meshopt_compression")}});var Mg=Object.freeze({__proto__:null,name:"EXT_texture_webp",preprocess:function(e,t){const s=new mg(e);if(!tg("image/webp")){if(s.getRequiredExtensions().includes("EXT_texture_webp"))throw new Error("gltf: Required extension ".concat("EXT_texture_webp"," not supported by browser"));return}const{json:i}=s;for(const e of i.textures||[]){const t=s.getObjectExtension(e,"EXT_texture_webp");t&&(e.source=t.source),s.removeObjectExtension(e,"EXT_texture_webp")}s.removeExtension("EXT_texture_webp")}});var Ig=Object.freeze({__proto__:null,name:"KHR_texture_basisu",preprocess:function(e,t){const s=new mg(e),{json:i}=s;for(const e of i.textures||[]){const t=s.getObjectExtension(e,"KHR_texture_basisu");t&&(e.source=t.source),s.removeObjectExtension(e,"KHR_texture_basisu")}s.removeExtension("KHR_texture_basisu")}});const Cg={name:"Draco",id:"draco",module:"draco",shapes:["mesh"],version:"3.2.6",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};class Dg{constructor(e,t){Qp(this,"fields",void 0),Qp(this,"metadata",void 0),function(e,t){if(!e)throw new Error(t||"loader assertion failed.")}(Array.isArray(e)),function(e){const t={};for(const s of e)t[s.name]&&console.warn("Schema: duplicated field name",s.name,s),t[s.name]=!0}(e),this.fields=e,this.metadata=t||new Map}compareTo(e){if(this.metadata!==e.metadata)return!1;if(this.fields.length!==e.fields.length)return!1;for(let t=0;t<this.fields.length;++t)if(!this.fields[t].compareTo(e.fields[t]))return!1;return!0}select(...e){const t=Object.create(null);for(const s of e)t[s]=!0;const s=this.fields.filter((e=>t[e.name]));return new Dg(s,this.metadata)}selectAt(...e){const t=e.map((e=>this.fields[e])).filter(Boolean);return new Dg(t,this.metadata)}assign(e){let t,s=this.metadata;if(e instanceof Dg){const i=e;t=i.fields,s=Ag(Ag(new Map,this.metadata),i.metadata)}else t=e;const i=Object.create(null);for(const e of this.fields)i[e.name]=e;for(const e of t)i[e.name]=e;const r=Object.values(i);return new Dg(r,s)}}function Ag(e,t){return new Map([...e||new Map,...t||new Map])}class Eg{constructor(e,t,s=!1,i=new Map){Qp(this,"name",void 0),Qp(this,"type",void 0),Qp(this,"nullable",void 0),Qp(this,"metadata",void 0),this.name=e,this.type=t,this.nullable=s,this.metadata=i}get typeId(){return this.type&&this.type.typeId}clone(){return new Eg(this.name,this.type,this.nullable,this.metadata)}compareTo(e){return this.name===e.name&&this.type===e.type&&this.nullable===e.nullable&&this.metadata===e.metadata}toString(){return"".concat(this.type).concat(this.nullable?", nullable":"").concat(this.metadata?", metadata: ".concat(this.metadata):"")}}let Fg,Rg,Sg,Og;!function(e){e[e.NONE=0]="NONE",e[e.Null=1]="Null",e[e.Int=2]="Int",e[e.Float=3]="Float",e[e.Binary=4]="Binary",e[e.Utf8=5]="Utf8",e[e.Bool=6]="Bool",e[e.Decimal=7]="Decimal",e[e.Date=8]="Date",e[e.Time=9]="Time",e[e.Timestamp=10]="Timestamp",e[e.Interval=11]="Interval",e[e.List=12]="List",e[e.Struct=13]="Struct",e[e.Union=14]="Union",e[e.FixedSizeBinary=15]="FixedSizeBinary",e[e.FixedSizeList=16]="FixedSizeList",e[e.Map=17]="Map",e[e.Dictionary=-1]="Dictionary",e[e.Int8=-2]="Int8",e[e.Int16=-3]="Int16",e[e.Int32=-4]="Int32",e[e.Int64=-5]="Int64",e[e.Uint8=-6]="Uint8",e[e.Uint16=-7]="Uint16",e[e.Uint32=-8]="Uint32",e[e.Uint64=-9]="Uint64",e[e.Float16=-10]="Float16",e[e.Float32=-11]="Float32",e[e.Float64=-12]="Float64",e[e.DateDay=-13]="DateDay",e[e.DateMillisecond=-14]="DateMillisecond",e[e.TimestampSecond=-15]="TimestampSecond",e[e.TimestampMillisecond=-16]="TimestampMillisecond",e[e.TimestampMicrosecond=-17]="TimestampMicrosecond",e[e.TimestampNanosecond=-18]="TimestampNanosecond",e[e.TimeSecond=-19]="TimeSecond",e[e.TimeMillisecond=-20]="TimeMillisecond",e[e.TimeMicrosecond=-21]="TimeMicrosecond",e[e.TimeNanosecond=-22]="TimeNanosecond",e[e.DenseUnion=-23]="DenseUnion",e[e.SparseUnion=-24]="SparseUnion",e[e.IntervalDayTime=-25]="IntervalDayTime",e[e.IntervalYearMonth=-26]="IntervalYearMonth"}(Fg||(Fg={}));class Bg{static isNull(e){return e&&e.typeId===Fg.Null}static isInt(e){return e&&e.typeId===Fg.Int}static isFloat(e){return e&&e.typeId===Fg.Float}static isBinary(e){return e&&e.typeId===Fg.Binary}static isUtf8(e){return e&&e.typeId===Fg.Utf8}static isBool(e){return e&&e.typeId===Fg.Bool}static isDecimal(e){return e&&e.typeId===Fg.Decimal}static isDate(e){return e&&e.typeId===Fg.Date}static isTime(e){return e&&e.typeId===Fg.Time}static isTimestamp(e){return e&&e.typeId===Fg.Timestamp}static isInterval(e){return e&&e.typeId===Fg.Interval}static isList(e){return e&&e.typeId===Fg.List}static isStruct(e){return e&&e.typeId===Fg.Struct}static isUnion(e){return e&&e.typeId===Fg.Union}static isFixedSizeBinary(e){return e&&e.typeId===Fg.FixedSizeBinary}static isFixedSizeList(e){return e&&e.typeId===Fg.FixedSizeList}static isMap(e){return e&&e.typeId===Fg.Map}static isDictionary(e){return e&&e.typeId===Fg.Dictionary}get typeId(){return Fg.NONE}compareTo(e){return this===e}}Rg=Symbol.toStringTag;class Lg extends Bg{constructor(e,t){super(),Qp(this,"isSigned",void 0),Qp(this,"bitWidth",void 0),this.isSigned=e,this.bitWidth=t}get typeId(){return Fg.Int}get[Rg](){return"Int"}toString(){return"".concat(this.isSigned?"I":"Ui","nt").concat(this.bitWidth)}}class Ng extends Lg{constructor(){super(!0,8)}}class kg extends Lg{constructor(){super(!0,16)}}class jg extends Lg{constructor(){super(!0,32)}}class Gg extends Lg{constructor(){super(!1,8)}}class Hg extends Lg{constructor(){super(!1,16)}}class Vg extends Lg{constructor(){super(!1,32)}}const Ug=32,zg=64;Sg=Symbol.toStringTag;class Wg extends Bg{constructor(e){super(),Qp(this,"precision",void 0),this.precision=e}get typeId(){return Fg.Float}get[Sg](){return"Float"}toString(){return"Float".concat(this.precision)}}class Xg extends Wg{constructor(){super(Ug)}}class Yg extends Wg{constructor(){super(zg)}}Og=Symbol.toStringTag;class Kg extends Bg{constructor(e,t){super(),Qp(this,"listSize",void 0),Qp(this,"children",void 0),this.listSize=e,this.children=[t]}get typeId(){return Fg.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[Og](){return"FixedSizeList"}toString(){return"FixedSizeList[".concat(this.listSize,"]<").concat(this.valueType,">")}}function Jg(e,t,s){const i=function(e){switch(e.constructor){case Int8Array:return new Ng;case Uint8Array:return new Gg;case Int16Array:return new kg;case Uint16Array:return new Hg;case Int32Array:return new jg;case Uint32Array:return new Vg;case Float32Array:return new Xg;case Float64Array:return new Yg;default:throw new Error("array type not supported")}}(t.value),r=s||function(e){const t=new Map;"byteOffset"in e&&t.set("byteOffset",e.byteOffset.toString(10));"byteStride"in e&&t.set("byteStride",e.byteStride.toString(10));"normalized"in e&&t.set("normalized",e.normalized.toString());return t}(t);return new Eg(e,new Kg(t.size,new Eg("value",i)),!1,r)}function Zg(e,t,s){return Jg(e,t,s?Qg(s.metadata):void 0)}function Qg(e){const t=new Map;for(const s in e)t.set("".concat(s,".string"),JSON.stringify(e[s]));return t}const qg={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},$g={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class e_{constructor(e){Qp(this,"draco",void 0),Qp(this,"decoder",void 0),Qp(this,"metadataQuerier",void 0),this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const s=new this.draco.DecoderBuffer;s.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(s),r=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let e;switch(i){case this.draco.TRIANGULAR_MESH:e=this.decoder.DecodeBufferToMesh(s,r);break;case this.draco.POINT_CLOUD:e=this.decoder.DecodeBufferToPointCloud(s,r);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!e.ok()||!r.ptr){const t="DRACO decompression failed: ".concat(e.error_msg());throw new Error(t)}const o=this._getDracoLoaderData(r,i,t),n=this._getMeshData(r,o,t),a=function(e){let t=1/0,s=1/0,i=1/0,r=-1/0,o=-1/0,n=-1/0;const a=e.POSITION?e.POSITION.value:[],h=a&&a.length;for(let e=0;e<h;e+=3){const h=a[e],l=a[e+1],u=a[e+2];t=h<t?h:t,s=l<s?l:s,i=u<i?u:i,r=h>r?h:r,o=l>o?l:o,n=u>n?u:n}return[[t,s,i],[r,o,n]]}(n.attributes),h=function(e,t,s){const i=Qg(t.metadata),r=[],o=function(e){const t={};for(const s in e){const i=e[s];t[i.name||"undefined"]=i}return t}(t.attributes);for(const t in e){const s=Zg(t,e[t],o[t]);r.push(s)}if(s){const e=Zg("indices",s);r.push(e)}return new Dg(r,i)}(n.attributes,o,n.indices);return{loader:"draco",loaderData:o,header:{vertexCount:r.num_points(),boundingBox:a},...n,schema:h}}finally{this.draco.destroy(s),r&&this.draco.destroy(r)}}_getDracoLoaderData(e,t,s){const i=this._getTopLevelMetadata(e),r=this._getDracoAttributes(e,s);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:r}}_getDracoAttributes(e,t){const s={};for(let i=0;i<e.num_attributes();i++){const r=this.decoder.GetAttribute(e,i),o=this._getAttributeMetadata(e,i);s[r.unique_id()]={unique_id:r.unique_id(),attribute_type:r.attribute_type(),data_type:r.data_type(),num_components:r.num_components(),byte_offset:r.byte_offset(),byte_stride:r.byte_stride(),normalized:r.normalized(),attribute_index:i,metadata:o};const n=this._getQuantizationTransform(r,t);n&&(s[r.unique_id()].quantization_transform=n);const a=this._getOctahedronTransform(r,t);a&&(s[r.unique_id()].octahedron_transform=a)}return s}_getMeshData(e,t,s){const i=this._getMeshAttributes(t,e,s);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");return e instanceof this.draco.Mesh?"triangle-strip"===s.topology?{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}}:{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}:{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,s){const i={};for(const r of Object.values(e.attributes)){const e=this._deduceAttributeName(r,s);r.name=e;const{value:o,size:n}=this._getAttributeValues(t,r);i[e]={value:o,size:n,byteOffset:r.byte_offset,byteStride:r.byte_stride,normalized:r.normalized}}return i}_getTriangleListIndices(e){const t=3*e.num_faces(),s=4*t,i=this.draco._malloc(s);try{return this.decoder.GetTrianglesUInt32Array(e,s,i),new Uint32Array(this.draco.HEAPF32.buffer,i,t).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),function(e){const t=e.size(),s=new Int32Array(t);for(let i=0;i<t;i++)s[i]=e.GetValue(i);return s}(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const s=$g[t.data_type],i=t.num_components,r=e.num_points()*i,o=r*s.BYTES_PER_ELEMENT,n=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}(this.draco,s);let a;const h=this.draco._malloc(o);try{const i=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,i,n,o,h),a=new s(this.draco.HEAPF32.buffer,h,r).slice()}finally{this.draco._free(h)}return{value:a,size:i}}_deduceAttributeName(e,t){const s=e.unique_id;for(const[e,i]of Object.entries(t.extraAttributes||{}))if(i===s)return e;const i=e.attribute_type;for(const e in qg){if(this.draco[e]===i)return qg[e]}const r=t.attributeNameEntry||"name";return e.metadata[r]?e.metadata[r].string:"CUSTOM_ATTRIBUTE_".concat(s)}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const s=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(s)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},s=this.metadataQuerier.NumEntries(e);for(let i=0;i<s;i++){const s=this.metadataQuerier.GetEntryName(e,i);t[s]=this._getDracoMetadataField(e,s)}return t}_getDracoMetadataField(e,t){const s=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,s);const i=function(e){const t=e.size(),s=new Int32Array(t);for(let i=0;i<t;i++)s[i]=e.GetValue(i);return s}(s);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(s)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:s=[]}=e,i=[...t,...s];for(const e of i)this.decoder.SkipAttributeTransform(this.draco[e])}_getQuantizationTransform(e,t){const{quantizedAttributes:s=[]}=t,i=e.attribute_type();if(s.map((e=>this.decoder[e])).includes(i)){const t=new this.draco.AttributeQuantizationTransform;try{if(t.InitFromAttribute(e))return{quantization_bits:t.quantization_bits(),range:t.range(),min_values:new Float32Array([1,2,3]).map((e=>t.min_value(e)))}}finally{this.draco.destroy(t)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:s=[]}=t,i=e.attribute_type();if(s.map((e=>this.decoder[e])).includes(i)){const t=new this.draco.AttributeQuantizationTransform;try{if(t.InitFromAttribute(e))return{quantization_bits:t.quantization_bits()}}finally{this.draco.destroy(t)}}return null}}const t_="https://www.gstatic.com/draco/versioned/decoders/".concat("1.4.1","/draco_decoder.js"),s_="https://www.gstatic.com/draco/versioned/decoders/".concat("1.4.1","/draco_wasm_wrapper.js"),i_="https://www.gstatic.com/draco/versioned/decoders/".concat("1.4.1","/draco_decoder.wasm");let r_;async function o_(e){const t=e.modules||{};return r_=t.draco3d?r_||t.draco3d.createDecoderModule({}).then((e=>({draco:e}))):r_||async function(e){let t,s;if("js"===(e.draco&&e.draco.decoderType))t=await pd(t_,"draco",e);else[t,s]=await Promise.all([await pd(s_,"draco",e),await pd(i_,"draco",e)]);return t=t||globalThis.DracoDecoderModule,await function(e,t){const s={};t&&(s.wasmBinary=t);return new Promise((t=>{e({...s,onModuleLoaded:e=>t({draco:e})})}))}(t,s)}(e),await r_}const n_={...Cg,parse:async function(e,t){const{draco:s}=await o_(t),i=new e_(s);try{return i.parseSync(e,null==t?void 0:t.draco)}finally{i.destroy()}}};function a_(e){const{buffer:t,size:s,count:i}=function(e){let t=e,s=1,i=0;e&&e.value&&(t=e.value,s=e.size||1);t&&(ArrayBuffer.isView(t)||(t=function(e,t,s=!1){if(!e)return null;if(Array.isArray(e))return new t(e);if(s&&!(e instanceof t))return new t(e);return e}(t,Float32Array)),i=t.length/s);return{buffer:t,size:s,count:i}}(e);return{value:t,size:s,byteOffset:0,count:i,type:ug(s),componentType:cg(t)}}async function h_(e,t,s,i){const r=e.getObjectExtension(t,"KHR_draco_mesh_compression");if(!r)return;const o=e.getTypedArrayForBufferView(r.bufferView),n=vd(o.buffer,o.byteOffset),{parse:a}=i,h={...s};delete h["3d-tiles"];const l=await a(n,n_,h,i),u=function(e){const t={};for(const s in e){const i=e[s];if("indices"!==s){const e=a_(i);t[s]=e}}return t}(l.attributes);for(const[s,i]of Object.entries(u))if(s in t.attributes){const r=t.attributes[s],o=e.getAccessor(r);null!=o&&o.min&&null!=o&&o.max&&(i.min=o.min,i.max=o.max)}t.attributes=u,l.indices&&(t.indices=a_(l.indices)),function(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}(t)}function l_(e,t,s=4,i,r){var o;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const n=i.DracoWriter.encodeSync({attributes:e}),a=null==r||null===(o=r.parseSync)||void 0===o?void 0:o.call(r,{attributes:e}),h=i._addFauxAttributes(a.attributes);return{primitives:[{attributes:h,mode:s,extensions:{KHR_draco_mesh_compression:{bufferView:i.addBufferView(n),attributes:h}}}]}}function*u_(e){for(const t of e.json.meshes||[])for(const e of t.primitives)yield e}var c_=Object.freeze({__proto__:null,name:"KHR_draco_mesh_compression",preprocess:function(e,t,s){const i=new mg(e);for(const e of u_(i))i.getObjectExtension(e,"KHR_draco_mesh_compression")},decode:async function(e,t,s){var i;if(null==t||null===(i=t.gltf)||void 0===i||!i.decompressMeshes)return;const r=new mg(e),o=[];for(const e of u_(r))r.getObjectExtension(e,"KHR_draco_mesh_compression")&&o.push(h_(r,e,t,s));await Promise.all(o),r.removeExtension("KHR_draco_mesh_compression")},encode:function(e,t={}){const s=new mg(e);for(const e of s.json.meshes||[])l_(e),s.addRequiredExtension("KHR_draco_mesh_compression")}});var p_=Object.freeze({__proto__:null,name:"KHR_lights_punctual",decode:async function(e){const t=new mg(e),{json:s}=t,i=t.getExtension("KHR_lights_punctual");i&&(t.json.lights=i.lights,t.removeExtension("KHR_lights_punctual"));for(const e of s.nodes||[]){const s=t.getObjectExtension(e,"KHR_lights_punctual");s&&(e.light=s.light),t.removeObjectExtension(e,"KHR_lights_punctual")}},encode:async function(e){const t=new mg(e),{json:s}=t;if(s.lights){const e=t.addExtension("KHR_lights_punctual");sg(!e.lights),e.lights=s.lights,delete s.lights}if(t.json.lights){for(const e of t.json.lights){const s=e.node;t.addObjectExtension(s,"KHR_lights_punctual",e)}delete t.json.lights}}});function d_(e,t){const s=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((t=>{e.uniforms[t].value&&!(t in s)&&(s[t]=e.uniforms[t].value)})),Object.keys(s).forEach((e=>{"object"==typeof s[e]&&void 0!==s[e].index&&(s[e].texture=t.getTexture(s[e].index))})),s}const m_=[wg,Mg,Ig,c_,p_,Object.freeze({__proto__:null,name:"KHR_materials_unlit",decode:async function(e){const t=new mg(e),{json:s}=t;t.removeExtension("KHR_materials_unlit");for(const e of s.materials||[]){e.extensions&&e.extensions.KHR_materials_unlit&&(e.unlit=!0),t.removeObjectExtension(e,"KHR_materials_unlit")}},encode:function(e){const t=new mg(e),{json:s}=t;if(t.materials)for(const e of s.materials||[])e.unlit&&(delete e.unlit,t.addObjectExtension(e,"KHR_materials_unlit",{}),t.addExtension("KHR_materials_unlit"))}}),Object.freeze({__proto__:null,name:"KHR_techniques_webgl",decode:async function(e){const t=new mg(e),{json:s}=t,i=t.getExtension("KHR_techniques_webgl");if(i){const e=function(e,t){const{programs:s=[],shaders:i=[],techniques:r=[]}=e,o=new TextDecoder;return i.forEach((e=>{if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=o.decode(t.getTypedArrayForBufferView(e.bufferView))})),s.forEach((e=>{e.fragmentShader=i[e.fragmentShader],e.vertexShader=i[e.vertexShader]})),r.forEach((e=>{e.program=s[e.program]})),r}(i,t);for(const i of s.materials||[]){const s=t.getObjectExtension(i,"KHR_techniques_webgl");s&&(i.technique=Object.assign({},s,e[s.technique]),i.technique.values=d_(i.technique,t)),t.removeObjectExtension(i,"KHR_techniques_webgl")}t.removeExtension("KHR_techniques_webgl")}},encode:async function(e,t){}})];function f_(e,t){var s;const i=(null==t||null===(s=t.gltf)||void 0===s?void 0:s.excludeExtensions)||{};return!(e in i&&!i[e])}const g_={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},__={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class y_{constructor(){Qp(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),Qp(this,"json",void 0)}normalize(e,t){this.json=e.json;const s=e.json;switch(s.asset&&s.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn("glTF: Unknown version ".concat(s.asset.version))}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(s),this._convertTopLevelObjectsToArrays(s),function(e){const t=new mg(e),{json:s}=t;for(const e of s.images||[]){const s=t.getObjectExtension(e,"KHR_binary_glTF");s&&Object.assign(e,s),t.removeObjectExtension(e,"KHR_binary_glTF")}s.buffers&&s.buffers[0]&&delete s.buffers[0].uri,t.removeExtension("KHR_binary_glTF")}(e),this._convertObjectIdsToArrayIndices(s),this._updateObjects(s),this._updateMaterial(s)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in g_)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const s=e[t];if(s&&!Array.isArray(s)){e[t]=[];for(const i in s){const r=s[i];r.id=r.id||i;const o=e[t].length;e[t].push(r),this.idToIndexMap[t][i]=o}}}_convertObjectIdsToArrayIndices(e){for(const t in g_)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:e,indices:s,material:i}=t;for(const t in e)e[t]=this._convertIdToIndex(e[t],"accessor");s&&(t.indices=this._convertIdToIndex(s,"accessor")),i&&(t.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map((e=>this._convertIdToIndex(e,"node")))),e.meshes&&(e.meshes=e.meshes.map((e=>this._convertIdToIndex(e,"mesh"))))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map((e=>this._convertIdToIndex(e,"node"))))}_convertIdsToIndices(e,t){e[t]||(console.warn("gltf v1: json doesn't contain attribute ".concat(t)),e[t]=[]);for(const s of e[t])for(const e in s){const t=s[e],i=this._convertIdToIndex(t,e);s[e]=i}}_convertIdToIndex(e,t){const s=__[t];if(s in this.idToIndexMap){const i=this.idToIndexMap[s][e];if(!Number.isFinite(i))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return i}return e}_updateObjects(e){for(const e of this.json.buffers)delete e.type}_updateMaterial(e){for(const i of e.materials){var t,s;i.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const r=(null===(t=i.values)||void 0===t?void 0:t.tex)||(null===(s=i.values)||void 0===s?void 0:s.texture2d_0),o=e.textures.findIndex((e=>e.id===r));-1!==o&&(i.pbrMetallicRoughness.baseColorTexture={index:o})}}}const v_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},b_={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},x_=10240,P_=10241,T_=10242,w_=10243,M_=10497,I_={magFilter:x_,minFilter:P_,wrapS:T_,wrapT:w_},C_={[x_]:9729,[P_]:9986,[T_]:M_,[w_]:M_};class D_{constructor(){Qp(this,"baseUri",""),Qp(this,"json",{}),Qp(this,"buffers",[]),Qp(this,"images",[])}postProcess(e,t={}){const{json:s,buffers:i=[],images:r=[],baseUri:o=""}=e;return sg(s),this.baseUri=o,this.json=s,this.buffers=i,this.images=r,this._resolveTree(this.json,t),this.json}_resolveTree(e,t={}){e.bufferViews&&(e.bufferViews=e.bufferViews.map(((e,t)=>this._resolveBufferView(e,t)))),e.images&&(e.images=e.images.map(((e,t)=>this._resolveImage(e,t)))),e.samplers&&(e.samplers=e.samplers.map(((e,t)=>this._resolveSampler(e,t)))),e.textures&&(e.textures=e.textures.map(((e,t)=>this._resolveTexture(e,t)))),e.accessors&&(e.accessors=e.accessors.map(((e,t)=>this._resolveAccessor(e,t)))),e.materials&&(e.materials=e.materials.map(((e,t)=>this._resolveMaterial(e,t)))),e.meshes&&(e.meshes=e.meshes.map(((e,t)=>this._resolveMesh(e,t)))),e.nodes&&(e.nodes=e.nodes.map(((e,t)=>this._resolveNode(e,t)))),e.skins&&(e.skins=e.skins.map(((e,t)=>this._resolveSkin(e,t)))),e.scenes&&(e.scenes=e.scenes.map(((e,t)=>this._resolveScene(e,t)))),void 0!==e.scene&&(e.scene=e.scenes[this.json.scene])}getScene(e){return this._get("scenes",e)}getNode(e){return this._get("nodes",e)}getSkin(e){return this._get("skins",e)}getMesh(e){return this._get("meshes",e)}getMaterial(e){return this._get("materials",e)}getAccessor(e){return this._get("accessors",e)}getCamera(e){return null}getTexture(e){return this._get("textures",e)}getSampler(e){return this._get("samplers",e)}getImage(e){return this._get("images",e)}getBufferView(e){return this._get("bufferViews",e)}getBuffer(e){return this._get("buffers",e)}_get(e,t){if("object"==typeof t)return t;const s=this.json[e]&&this.json[e][t];return s||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),s}_resolveScene(e,t){return e.id=e.id||"scene-".concat(t),e.nodes=(e.nodes||[]).map((e=>this.getNode(e))),e}_resolveNode(e,t){return e.id=e.id||"node-".concat(t),e.children&&(e.children=e.children.map((e=>this.getNode(e)))),void 0!==e.mesh?e.mesh=this.getMesh(e.mesh):void 0!==e.meshes&&e.meshes.length&&(e.mesh=e.meshes.reduce(((e,t)=>{const s=this.getMesh(t);return e.id=s.id,e.primitives=e.primitives.concat(s.primitives),e}),{primitives:[]})),void 0!==e.camera&&(e.camera=this.getCamera(e.camera)),void 0!==e.skin&&(e.skin=this.getSkin(e.skin)),e}_resolveSkin(e,t){return e.id=e.id||"skin-".concat(t),e.inverseBindMatrices=this.getAccessor(e.inverseBindMatrices),e}_resolveMesh(e,t){return e.id=e.id||"mesh-".concat(t),e.primitives&&(e.primitives=e.primitives.map((e=>{const t=(e={...e}).attributes;e.attributes={};for(const s in t)e.attributes[s]=this.getAccessor(t[s]);return void 0!==e.indices&&(e.indices=this.getAccessor(e.indices)),void 0!==e.material&&(e.material=this.getMaterial(e.material)),e}))),e}_resolveMaterial(e,t){if(e.id=e.id||"material-".concat(t),e.normalTexture&&(e.normalTexture={...e.normalTexture},e.normalTexture.texture=this.getTexture(e.normalTexture.index)),e.occlusionTexture&&(e.occlustionTexture={...e.occlustionTexture},e.occlusionTexture.texture=this.getTexture(e.occlusionTexture.index)),e.emissiveTexture&&(e.emmisiveTexture={...e.emmisiveTexture},e.emissiveTexture.texture=this.getTexture(e.emissiveTexture.index)),e.emissiveFactor||(e.emissiveFactor=e.emmisiveTexture?[1,1,1]:[0,0,0]),e.pbrMetallicRoughness){e.pbrMetallicRoughness={...e.pbrMetallicRoughness};const t=e.pbrMetallicRoughness;t.baseColorTexture&&(t.baseColorTexture={...t.baseColorTexture},t.baseColorTexture.texture=this.getTexture(t.baseColorTexture.index)),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture={...t.metallicRoughnessTexture},t.metallicRoughnessTexture.texture=this.getTexture(t.metallicRoughnessTexture.index))}return e}_resolveAccessor(e,t){var s,i;if(e.id=e.id||"accessor-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView)),e.bytesPerComponent=(s=e.componentType,b_[s]),e.components=(i=e.type,v_[i]),e.bytesPerElement=e.bytesPerComponent*e.components,e.bufferView){const t=e.bufferView.buffer,{ArrayType:s,byteLength:i}=pg(e,e.bufferView),r=(e.bufferView.byteOffset||0)+(e.byteOffset||0)+t.byteOffset;let o=t.arrayBuffer.slice(r,r+i);e.bufferView.byteStride&&(o=this._getValueFromInterleavedBuffer(t,r,e.bufferView.byteStride,e.bytesPerElement,e.count)),e.value=new s(o)}return e}_getValueFromInterleavedBuffer(e,t,s,i,r){const o=new Uint8Array(r*i);for(let n=0;n<r;n++){const r=t+n*s;o.set(new Uint8Array(e.arrayBuffer.slice(r,r+i)),n*i)}return o.buffer}_resolveTexture(e,t){return e.id=e.id||"texture-".concat(t),e.sampler="sampler"in e?this.getSampler(e.sampler):C_,e.source=this.getImage(e.source),e}_resolveSampler(e,t){e.id=e.id||"sampler-".concat(t),e.parameters={};for(const t in e){const s=this._enumSamplerParameter(t);void 0!==s&&(e.parameters[s]=e[t])}return e}_enumSamplerParameter(e){return I_[e]}_resolveImage(e,t){e.id=e.id||"image-".concat(t),void 0!==e.bufferView&&(e.bufferView=this.getBufferView(e.bufferView));const s=this.images[t];return s&&(e.image=s),e}_resolveBufferView(e,t){const s=e.buffer,i={id:"bufferView-".concat(t),...e,buffer:this.buffers[s]},r=this.buffers[s].arrayBuffer;let o=this.buffers[s].byteOffset||0;return"byteOffset"in e&&(o+=e.byteOffset),i.data=new Uint8Array(r,o,e.byteLength),i}_resolveCamera(e,t){return e.id=e.id||"camera-".concat(t),e.perspective,e.orthographic,e}}const A_=1735152710,E_=!0;function F_(e,t,s=0,i={}){const r=new DataView(t),o=function(e,t=0){return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}(r,s+0),n=r.getUint32(s+4,E_),a=r.getUint32(s+8,E_);switch(Object.assign(e,{header:{byteOffset:s,byteLength:a,hasBinChunk:!1},type:o,version:n,json:{},binChunks:[]}),s+=12,e.version){case 1:return function(e,t,s){Hp(e.header.byteLength>20);const i=t.getUint32(s+0,E_),r=t.getUint32(s+4,E_);return s+=8,Hp(0===r),R_(e,t,s,i),s+=i,s+=S_(e,t,s,e.header.byteLength)}(e,r,s);case 2:return function(e,t,s,i){return Hp(e.header.byteLength>20),function(e,t,s,i){for(;s+8<=e.header.byteLength;){const r=t.getUint32(s+0,E_),o=t.getUint32(s+4,E_);switch(s+=8,o){case 1313821514:R_(e,t,s,r);break;case 5130562:S_(e,t,s,r);break;case 0:i.strict||R_(e,t,s,r);break;case 1:i.strict||S_(e,t,s,r)}s+=bd(r,4)}}(e,t,s,i),s+e.header.byteLength}(e,r,s,{});default:throw new Error("Invalid GLB version ".concat(e.version,". Only supports v1 and v2."))}}function R_(e,t,s,i){const r=new Uint8Array(t.buffer,s,i),o=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(o),bd(i,4)}function S_(e,t,s,i){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:s,byteLength:i,arrayBuffer:t.buffer}),bd(i,4)}async function O_(e,t,s=0,i,r){var o,n,a,h;!function(e,t,s,i){i.uri&&(e.baseUri=i.uri);if(t instanceof ArrayBuffer&&!function(e,t=0,s={}){const i=new DataView(e),{magic:r=A_}=s,o=i.getUint32(t,!1);return o===r||o===A_}(t,s,i)){t=(new TextDecoder).decode(t)}if("string"==typeof t)e.json=gd(t);else if(t instanceof ArrayBuffer){const r={};s=F_(r,t,s,i.glb),sg("glTF"===r.type,"Invalid GLB magic string ".concat(r.type)),e._glb=r,e.json=r.json}else sg(!1,"GLTF: must be ArrayBuffer or string");const r=e.json.buffers||[];if(e.buffers=new Array(r.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:t}=e._glb;e.buffers[0]={arrayBuffer:t[0].arrayBuffer,byteOffset:t[0].byteOffset,byteLength:t[0].byteLength}}const o=e.json.images||[];e.images=new Array(o.length).fill({})}(e,t,s,i),function(e,t={}){(new y_).normalize(e,t)}(e,{normalize:null==i||null===(o=i.gltf)||void 0===o?void 0:o.normalize}),function(e,t={},s){const i=m_.filter((e=>f_(e.name,t)));for(const o of i){var r;null===(r=o.preprocess)||void 0===r||r.call(o,e,t,s)}}(e,i,r);const l=[];if(null!=i&&null!==(n=i.gltf)&&void 0!==n&&n.loadBuffers&&e.json.buffers&&await async function(e,t,s){const i=e.json.buffers||[];for(let n=0;n<i.length;++n){const a=i[n];if(a.uri){var r,o;const{fetch:i}=s;sg(i);const h=ig(a.uri,t),l=await(null==s||null===(r=s.fetch)||void 0===r?void 0:r.call(s,h)),u=await(null==l||null===(o=l.arrayBuffer)||void 0===o?void 0:o.call(l));e.buffers[n]={arrayBuffer:u,byteOffset:0,byteLength:u.byteLength},delete a.uri}else null===e.buffers[n]&&(e.buffers[n]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength})}}(e,i,r),null!=i&&null!==(a=i.gltf)&&void 0!==a&&a.loadImages){const t=async function(e,t,s){const i=function(e){const t=new Set,s=e.json.textures||[];for(const e of s)void 0!==e.source&&t.add(e.source);return Array.from(t).sort()}(e),r=e.json.images||[],o=[];for(const n of i)o.push(B_(e,r[n],n,t,s));return await Promise.all(o)}(e,i,r);l.push(t)}const u=async function(e,t={},s){const i=m_.filter((e=>f_(e.name,t)));for(const o of i){var r;await(null===(r=o.decode)||void 0===r?void 0:r.call(o,e,t,s))}}(e,i,r);return l.push(u),await Promise.all(l),null!=i&&null!==(h=i.gltf)&&void 0!==h&&h.postProcess?function(e,t){return(new D_).postProcess(e,t)}(e,i):e}async function B_(e,t,s,i,r){const{fetch:o,parse:n}=r;let a;if(t.uri){const e=ig(t.uri,i),s=await o(e);a=await s.arrayBuffer()}if(Number.isFinite(t.bufferView)){const s=function(e,t,s){const i=e.bufferViews[s];sg(i);const r=t[i.buffer];sg(r);const o=(i.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,o,i.byteLength)}(e.json,e.buffers,t.bufferView);a=vd(s.buffer,s.byteOffset,s.byteLength)}sg(a,"glTF image has no data");let h=await n(a,[qf,Bf],{mimeType:t.mimeType,basis:i.basis||{format:Of()}},r);h&&h[0]&&(h={compressed:!0,mipmaps:!1,width:h[0].width,height:h[0].height,data:h[0]}),e.images=e.images||[],e.images[s]=h}const L_={name:"glTF",id:"gltf",module:"gltf",version:"3.2.6",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(e,t={},s){(t={...L_.options,...t}).gltf={...L_.options.gltf,...t.gltf};const{byteOffset:i=0}=t;return await O_({},e,i,t,s)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0,postProcess:!0},log:console},deprecatedOptions:{fetchImages:"gltf.loadImages",createImages:"gltf.loadImages",decompress:"gltf.decompressMeshes",postProcess:"gltf.postProcess",gltf:{decompress:"gltf.decompressMeshes"}}};class N_{constructor(e){}load(e,t,s,i,r,o,n){!function(e,t,s,i,r,o,n){const a=e.viewer.scene.canvas.spinner;a.processes++;"glb"===t.split(".").pop()?e.dataSource.getGLB(t,(n=>{i.basePath=j_(t),G_(e,t,n,s,i,r,o),a.processes--}),(e=>{a.processes--,n(e)})):e.dataSource.getGLTF(t,(n=>{i.basePath=j_(t),G_(e,t,n,s,i,r,o),a.processes--}),(e=>{a.processes--,n(e)}))}(e,t,s,i=i||{},r,(function(){C.scheduleTask((function(){r.scene.fire("modelLoaded",r.id),r.fire("loaded",!0,!1)})),o&&o()}),(function(t){e.error(t),n&&n(t),r.fire("error",t)}))}parse(e,t,s,i,r,o,n){G_(e,"",t,s,i=i||{},r,(function(){r.scene.fire("modelLoaded",r.id),r.fire("loaded",!0,!1),o&&o()}))}}function k_(e){const t={},s={},i=e.metaObjects||[],r={};for(let e=0,t=i.length;e<t;e++){const t=i[e];r[t.id]=t}for(let e=0,o=i.length;e<o;e++){const o=i[e];if(void 0!==o.parent&&null!==o.parent){const e=r[o.parent];if(o.type===e.type){let i=e;for(;i.parent&&r[i.parent].type===i.type;)i=r[i.parent];(t[i.id]||(t[i.id]={numChildren:0,countChildren:0})).numChildren++,s[o.id]=i}}}return{metaObjectsMap:r,eachRootStats:t,eachChildRoot:s}}function j_(e){const t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}function G_(e,t,s,i,r,o,n){const a=e.viewer.scene.canvas.spinner;a.processes++,ef(s,L_,{baseUri:r.basePath}).then((s=>{const h={src:t,metaModelCorrections:i?k_(i):null,loadBuffer:r.loadBuffer,basePath:r.basePath,handlenode:r.handlenode,gltfData:s,scene:o.scene,plugin:e,sceneModel:o,numObjects:0,nodes:[],nextId:0,log:t=>{e.log(t)}};!function(e){const t=e.gltfData.textures;if(t)for(let s=0,i=t.length;s<i;s++)H_(e,t[s])}(h),function(e){const t=e.gltfData.materials;if(t)for(let s=0,i=t.length;s<i;s++){const i=t[s];i._textureSetId=V_(e,i),i._attributes=U_(e,i)}}(h),function(e){const t=e.gltfData,s=t.scene||t.scenes[0];if(!s)return void Y_(e,"glTF has no default scene");!function(e,t){const s=t.nodes;if(!s)return;for(let t=0,i=s.length;t<i;t++){z_(e,s[t])}for(let t=0,i=s.length;t<i;t++){X_(e,s[t],0,null)}}(e,s)}(h),o.finalize(),a.processes--,n()}))}function H_(e,t){if(!t.source||!t.source.image)return;const s="texture-"+e.nextId++;let i=1005;switch(t.sampler.minFilter){case 9728:i=1003;break;case 9729:i=1006;break;case 9984:i=1004;break;case 9985:i=1007;break;case 9986:i=1005;break;case 9987:i=1008}let r=1006;switch(t.sampler.magFilter){case 9728:r=1003;break;case 9729:r=1006}let o=1e3;switch(t.sampler.wrapS){case 33071:o=1001;break;case 33648:o=1002;break;case 10497:o=1e3}let n=1e3;switch(t.sampler.wrapT){case 33071:n=1001;break;case 33648:n=1002;break;case 10497:n=1e3}let a=1e3;switch(t.sampler.wrapR){case 33071:a=1001;break;case 33648:a=1002;break;case 10497:a=1e3}e.sceneModel.createTexture({id:s,image:t.source.image,flipY:!!t.flipY,minFilter:i,magFilter:r,wrapS:o,wrapT:n,wrapR:a,encoding:3001}),t._textureId=s}function V_(e,t){const s={};t.normalTexture&&(s.normalTextureId=t.normalTexture.texture._textureId),t.occlusionTexture&&(s.occlusionTextureId=t.occlusionTexture.texture._textureId),t.emissiveTexture&&(s.emissiveTextureId=t.emissiveTexture.texture._textureId);const i=t.pbrMetallicRoughness;if(t.pbrMetallicRoughness){const r=t.pbrMetallicRoughness,o=r.baseColorTexture||r.colorTexture;o&&(o.texture?s.colorTextureId=o.texture._textureId:s.colorTextureId=e.gltfData.textures[o.index]._textureId),i.metallicRoughnessTexture&&(s.metallicRoughnessTextureId=i.metallicRoughnessTexture.texture._textureId)}const r=t.extensions;if(r){const t=r.KHR_materials_pbrSpecularGlossiness;if(t){t.specularTexture;const i=t.specularColorTexture;null!=i&&(s.colorTextureId=e.gltfData.textures[i.index]._textureId)}}return void 0!==s.normalTextureId||void 0!==s.occlusionTextureId||void 0!==s.emissiveTextureId||void 0!==s.colorTextureId||void 0!==s.metallicRoughnessTextureId?(s.id=`textureSet-${e.nextId++};`,e.sceneModel.createTextureSet(s),s.id):null}function U_(e,t){const s=t.extensions,i={color:new Float32Array([1,1,1,1]),opacity:1,metallic:0,roughness:1};if(s){const e=s.KHR_materials_pbrSpecularGlossiness;if(e){const t=e.diffuseFactor;null!=t&&i.color.set(t)}const t=s.KHR_materials_common;if(t){const e=t.technique,s=t.values||{},r="BLINN"===e,o="PHONG"===e,n="LAMBERT"===e,a=s.diffuse;a&&(r||o||n)&&(y.isString(a)||i.color.set(a));const h=s.transparency;null!=h&&(i.opacity=h);const l=s.transparent;null!=l&&(i.opacity=l)}}const r=t.pbrMetallicRoughness;if(r){const e=r.baseColorFactor;e&&(i.color[0]=e[0],i.color[1]=e[1],i.color[2]=e[2],i.opacity=e[3]);const t=r.metallicFactor;null!=t&&(i.metallic=t);const s=r.roughnessFactor;null!=s&&(i.roughness=s)}return i}function z_(e,t){const s=t.mesh;if(s&&(s.instances=s.instances?s.instances+1:1),t.children){const s=t.children;for(let t=0,i=s.length;t<i;t++){const i=s[t];i?z_(e,i):Y_(e,"Node not found: "+t)}}}const W_=[];function X_(e,t,s,i){let r;e.gltfData,t.matrix&&(r=t.matrix,i=i?p.mulMat4(i,r,p.mat4()):r),t.translation&&(r=p.translationMat4v(t.translation),i=i?p.mulMat4(i,r,p.mat4()):r),t.rotation&&(r=p.quaternionToMat4(t.rotation),i=i?p.mulMat4(i,r,p.mat4()):r),t.scale&&(r=p.scalingMat4v(t.scale),i=i?p.mulMat4(i,r,p.mat4()):r);const o=e.sceneModel;if(t.mesh){const s=t.mesh;if(e.handlenode){const s={};if(!e.handlenode(e.sceneModel.id,t,s))return;s.createEntity}const r=i?i.slice():p.identityMat4(),n=s.primitives.length;if(n>0)for(let t=0;t<n;t++){const i=s.primitives[t];if(i.mode<4)continue;const n={id:o.id+"."+e.numObjects++};switch(i.mode){case 0:n.primitive="points";break;case 1:case 2:case 3:n.primitive="lines";break;default:n.primitive="triangles"}const a=i.attributes.POSITION;if(!a)continue;n.localPositions=a.value,n.positions=new Float64Array(n.localPositions.length),i.attributes.NORMAL&&(n.normals=i.attributes.NORMAL.value),i.attributes.TEXCOORD_0&&(n.uv=i.attributes.TEXCOORD_0.value),i.indices&&(n.indices=i.indices.value),p.transformPositions3(r,n.localPositions,n.positions);const h=p.vec3();W(n.positions,n.positions,h)&&(n.origin=h);const l=i.material;l?(n.textureSetId=l._textureSetId,n.color=l._attributes.color,n.opacity=l._attributes.opacity,n.metallic=l._attributes.metallic,n.roughness=l._attributes.roughness):(n.color=new Float32Array([1,1,1]),n.opacity=1),o.createMesh(n),W_.push(n.id)}}if(t.children){const r=t.children;for(let t=0,o=r.length;t<o;t++){X_(e,r[t],s+1,i)}}const n=t.name;if((null!=n||0===s)&&W_.length>0){null==n&&e.log("Warning: 'name' properties not found on glTF scene nodes - will randomly-generate object IDs in XKT");let t=n;if(e.metaModelCorrections){const s=e.metaModelCorrections.eachChildRoot[t];if(s){const t=e.metaModelCorrections.eachRootStats[s.id];t.countChildren++,t.countChildren>=t.numChildren&&(o.createEntity({id:s.id,meshIds:W_}),W_.length=0)}else{e.metaModelCorrections.metaObjectsMap[t]&&(o.createEntity({id:t,meshIds:W_}),W_.length=0)}}else o.createEntity({id:t,meshIds:W_}),W_.length=0}}function Y_(e,t){e.plugin.error(t)}const K_={IfcOpeningElement:{pickable:!1,visible:!1},IfcSpace:{colorize:[.137255,.403922,.870588],pickable:!1,visible:!1,opacity:.4},IfcWindow:{colorize:[.137255,.403922,.870588],opacity:.3},IfcPlate:{colorize:[.8470588235,.427450980392,0,.5],opacity:.3},DEFAULT:{}};class J_ extends n{constructor(e,t={}){super("GLTFLoader",e,t),this._sceneModelLoader=new N_(this,t),this.dataSource=t.dataSource,this.objectDefaults=t.objectDefaults}set dataSource(e){this._dataSource=e||new Gp}get dataSource(){return this._dataSource}set objectDefaults(e){this._objectDefaults=e||K_}get objectDefaults(){return this._objectDefaults}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new Hc(this.viewer.scene,y.apply(e,{isModel:!0})),s=t.id;if(!e.src&&!e.gltf)return this.error("load() param expected: src or gltf"),t;if(e.metaModelSrc||e.metaModelJSON){const i=e.objectDefaults||this._objectDefaults||K_,r=r=>{let o;if(this.viewer.metaScene.createMetaModel(s,r,{includeTypes:e.includeTypes,excludeTypes:e.excludeTypes}),this.viewer.scene.canvas.spinner.processes--,e.includeTypes){o={};for(let t=0,s=e.includeTypes.length;t<s;t++)o[e.includeTypes[t]]=!0}if(e.excludeTypes){o||(o={});for(let t=0,s=e.excludeTypes.length;t<s;t++)o[e.excludeTypes[t]]=!0}e.readableGeometry=!1,e.handleGLTFNode=(e,t,s)=>{const r=t.name;if(!r)return!0;const o=r,n=this.viewer.metaScene.metaObjects[o],a=(n?n.type:"DEFAULT")||"DEFAULT";s.createEntity={id:o,isObject:!0};const h=i[a];return h&&(!1===h.visible&&(s.createEntity.visible=!1),h.colorize&&(s.createEntity.colorize=h.colorize),!1===h.pickable&&(s.createEntity.pickable=!1),void 0!==h.opacity&&null!==h.opacity&&(s.createEntity.opacity=h.opacity)),!0},e.src?this._sceneModelLoader.load(this,e.src,r,e,t):this._sceneModelLoader.parse(this,e.gltf,r,e,t)};if(e.metaModelSrc){const t=e.metaModelSrc;this.viewer.scene.canvas.spinner.processes++,this._dataSource.getMetaModel(t,(e=>{this.viewer.scene.canvas.spinner.processes--,r(e)}),(e=>{this.error(`load(): Failed to load model metadata for model '${s} from  '${t}' - ${e}`),this.viewer.scene.canvas.spinner.processes--}))}else e.metaModelJSON&&r(e.metaModelJSON)}else e.handleGLTFNode=(e,t,s)=>{const i=t.name;if(!i)return!0;const r=i;return s.createEntity={id:r,isObject:!0},!0},e.src?this._sceneModelLoader.load(this,e.src,null,e,t):this._sceneModelLoader.parse(this,e.gltf,null,e,t);return t.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(s)})),t}destroy(){super.destroy()}}function Z_(e,t={}){const s="lightgrey",i=t.hoverColor||"rgba(0,0,0,0.4)",r=500,o=r+r/3,n=o/24,a=[{boundary:[6,6,6,6],color:t.frontColor||t.color||"#55FF55"},{boundary:[18,6,6,6],color:t.backColor||t.color||"#55FF55"},{boundary:[12,6,6,6],color:t.leftColor||t.color||"#FF5555"},{boundary:[0,6,6,6],color:t.rightColor||t.color||"#FF5555"},{boundary:[6,0,6,6],color:t.topColor||t.color||"#7777FF"},{boundary:[6,12,6,6],color:t.bottomColor||t.color||"#7777FF"}],h=[{label:"NavCube.front",boundaries:[[7,7,4,4]],dir:[0,1,0],up:[0,0,1]},{label:"NavCube.back",boundaries:[[19,7,4,4]],dir:[0,-1,0],up:[0,0,1]},{label:"NavCube.right",boundaries:[[13,7,4,4]],dir:[-1,0,0],up:[0,0,1]},{label:"NavCube.left",boundaries:[[1,7,4,4]],dir:[1,0,0],up:[0,0,1]},{label:"NavCube.top",boundaries:[[7,1,4,4]],dir:[0,0,-1],up:[0,1,0]},{label:"NavCube.bottom",boundaries:[[7,13,4,4]],dir:[0,0,1],up:[0,-1,0]},{boundaries:[[7,5,4,2]],dir:[0,1,-1],up:[0,1,1]},{boundaries:[[1,6,4,1],[6,1,1,4]],dir:[1,0,-1],up:[1,0,1]},{boundaries:[[7,0,4,1],[19,6,4,1]],dir:[0,-1,-1],up:[0,-1,1]},{boundaries:[[13,6,4,1],[11,1,1,4]],dir:[-1,0,-1],up:[-1,0,1]},{boundaries:[[7,11,4,2]],dir:[0,1,1],up:[0,-1,1]},{boundaries:[[1,11,4,1],[6,13,1,4]],dir:[1,0,1],up:[-1,0,1]},{boundaries:[[7,17,4,1],[19,11,4,1]],dir:[0,-1,1],up:[0,1,1]},{boundaries:[[13,11,4,1],[11,13,1,4]],dir:[-1,0,1],up:[1,0,1]},{boundaries:[[5,7,2,4]],dir:[1,1,0],up:[0,0,1]},{boundaries:[[11,7,2,4]],dir:[-1,1,0],up:[0,0,1]},{boundaries:[[17,7,2,4]],dir:[-1,-1,0],up:[0,0,1]},{boundaries:[[0,7,1,4],[23,7,1,4]],dir:[1,-1,0],up:[0,0,1]},{boundaries:[[5,11,2,2]],dir:[1,1,1],up:[-1,-1,1]},{boundaries:[[23,11,1,1],[6,17,1,1],[0,11,1,1]],dir:[1,-1,1],up:[-1,1,1]},{boundaries:[[5,5,2,2]],dir:[1,1,-1],up:[1,1,1]},{boundaries:[[11,17,1,1],[17,11,2,1]],dir:[-1,-1,1],up:[1,1,1]},{boundaries:[[17,6,2,1],[11,0,1,1]],dir:[-1,-1,-1],up:[-1,-1,1]},{boundaries:[[11,11,2,2]],dir:[-1,1,1],up:[1,-1,1]},{boundaries:[[0,6,1,1],[6,0,1,1],[23,6,1,1]],dir:[1,-1,-1],up:[1,-1,1]},{boundaries:[[11,5,2,2]],dir:[-1,1,-1],up:[-1,1,1]}];t.frontColor||t.color,t.backColor||t.color,t.leftColor||t.color,t.rightColor||t.color,t.topColor||t.color,t.bottomColor||t.color;const l=[{yUp:"",label:"NavCube.front",boundaries:[[7,7,4,4]],dir:[0,0,-1],up:[0,1,0]},{label:"NavCube.back",boundaries:[[19,7,4,4]],dir:[0,0,1],up:[0,1,0]},{label:"NavCube.right",boundaries:[[13,7,4,4]],dir:[-1,0,0],up:[0,1,0]},{label:"NavCube.left",boundaries:[[1,7,4,4]],dir:[1,0,0],up:[0,1,0]},{label:"NavCube.top",boundaries:[[7,1,4,4]],dir:[0,-1,0],up:[0,0,-1]},{label:"NavCube.bottom",boundaries:[[7,13,4,4]],dir:[0,1,0],up:[0,0,1]},{boundaries:[[7,5,4,2]],dir:[0,-.7071,-.7071],up:[0,.7071,-.7071]},{boundaries:[[1,6,4,1],[6,1,1,4]],dir:[1,-1,0],up:[1,1,0]},{boundaries:[[7,0,4,1],[19,6,4,1]],dir:[0,-.7071,.7071],up:[0,.7071,.7071]},{boundaries:[[13,6,4,1],[11,1,1,4]],dir:[-1,-1,0],up:[-1,1,0]},{boundaries:[[7,11,4,2]],dir:[0,1,-1],up:[0,1,1]},{boundaries:[[1,11,4,1],[6,13,1,4]],dir:[1,1,0],up:[-1,1,0]},{boundaries:[[7,17,4,1],[19,11,4,1]],dir:[0,1,1],up:[0,1,-1]},{boundaries:[[13,11,4,1],[11,13,1,4]],dir:[-1,1,0],up:[1,1,0]},{boundaries:[[5,7,2,4]],dir:[1,0,-1],up:[0,1,0]},{boundaries:[[11,7,2,4]],dir:[-1,0,-1],up:[0,1,0]},{boundaries:[[17,7,2,4]],dir:[-1,0,1],up:[0,1,0]},{boundaries:[[0,7,1,4],[23,7,1,4]],dir:[1,0,1],up:[0,1,0]},{boundaries:[[5,11,2,2]],dir:[.5,.7071,-.5],up:[-.5,.7071,.5]},{boundaries:[[23,11,1,1],[6,17,1,1],[0,11,1,1]],dir:[.5,.7071,.5],up:[-.5,.7071,-.5]},{boundaries:[[5,5,2,2]],dir:[.5,-.7071,-.5],up:[.5,.7071,-.5]},{boundaries:[[11,17,1,1],[17,11,2,1]],dir:[-.5,.7071,.5],up:[.5,.7071,-.5]},{boundaries:[[17,6,2,1],[11,0,1,1]],dir:[-.5,-.7071,.5],up:[-.5,.7071,.5]},{boundaries:[[11,11,2,2]],dir:[-.5,.7071,-.5],up:[.5,.7071,.5]},{boundaries:[[0,6,1,1],[6,0,1,1],[23,6,1,1]],dir:[.5,-.7071,.5],up:[.5,.7071,.5]},{boundaries:[[11,5,2,2]],dir:[-.5,-.7071,-.5],up:[-.5,.7071,-.5]}];for(let e=0,t=h.length;e<t;e++)p.normalizeVec3(h[e].dir,h[e].dir),p.normalizeVec3(h[e].up,h[e].up);for(let e=0,t=l.length;e<t;e++)p.normalizeVec3(l[e].dir,l[e].dir),p.normalizeVec3(l[e].up,l[e].up);var u=l;this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=o,this._textureCanvas.height=r,this._textureCanvas.style.width=o+"px",this._textureCanvas.style.height="500px",this._textureCanvas.style.padding="0",this._textureCanvas.style.margin="0",this._textureCanvas.style.top="0",this._textureCanvas.style.background=s,this._textureCanvas.style.position="absolute",this._textureCanvas.style.opacity="1.0",this._textureCanvas.style.visibility="hidden",this._textureCanvas.style["z-index"]=2e6;document.getElementsByTagName("body")[0].appendChild(this._textureCanvas);const c=this._textureCanvas.getContext("2d");let d=!1;function m(){for(let e=0,t=a.length;e<t;e++){const t=a[e],s=t.boundary,i=Math.round(s[0]*n),r=Math.round(s[1]*n),o=Math.round(s[2]*n),h=Math.round(s[3]*n);c.fillStyle=t.color,c.fillRect(i,r,o,h)}for(let e=0,a=u.length;e<a;e++){let a,l,p,d;const m=u[e],g=m.boundaries;for(var t=0,r=g.length;t<r;t++){const e=g[t];a=Math.round(e[0]*n),l=Math.round(e[1]*n),p=Math.round(e[2]*n),d=Math.round(e[3]*n),m.highlighted&&(c.fillStyle=m.highlighted?i:m.color||s,c.fillRect(a,l,p,d))}if(m.label){c.fillStyle="black",c.font="60px sans-serif",c.textAlign="center";var o=a+.5*p,h=l+.7*d;c.fillText(f(m.label),o,h,80)}}e.scene.glRedraw()}const f=function(){const t={"NavCube.front":"NavCube.front","NavCube.back":"NavCube.back","NavCube.right":"NavCube.right","NavCube.left":"NavCube.left","NavCube.top":"NavCube.top","NavCube.bottom":"NavCube.bottom"},s={"NavCube.front":"NavCube.front","NavCube.back":"NavCube.back","NavCube.right":"NavCube.right","NavCube.left":"NavCube.left","NavCube.top":"NavCube.top","NavCube.bottom":"NavCube.bottom"},i={"NavCube.front":"FRONT","NavCube.back":"BACK","NavCube.right":"RIGHT","NavCube.left":"LEFT","NavCube.top":"TOP","NavCube.bottom":"BOTTOM"};return function(r){const o=d?s:t,n=o?o[r]:null;return n?e.localeService.translate(n)||i[n]||n:r}}();this.setZUp=function(){d=!0,u=h,this.clear()},this.setYUp=function(){d=!1,u=l,this.clear()},this.clear=function(){c.fillStyle=s,c.fillRect(0,0,o,r);for(var e=0,t=u.length;e<t;e++){u[e].highlighted=!1}m()},this.getArea=function(e){const t=e[0]*o,s=r-e[1]*r;for(var i=0,a=u.length;i<a;i++){const e=u[i].boundaries;for(var h=0,l=e.length;h<l;h++){const r=e[h];if(t>=r[0]*n&&t<=(r[0]+r[2])*n&&s>=r[1]*n&&s<=(r[1]+r[3])*n)return i}}return-1},this.setAreaHighlighted=function(e,t){var s=u[e];if(!s)throw"Area not found: "+e;s.highlighted=!!t,m()},this.getAreaDir=function(e){var t=u[e];if(!t)throw"Unknown area: "+e;return t.dir},this.getAreaUp=function(e){var t=u[e];if(!t)throw"Unknown area: "+e;return t.up},this.getImage=function(){return this._textureCanvas},this.destroy=function(){this._textureCanvas&&(this._textureCanvas.parentNode.removeChild(this._textureCanvas),this._textureCanvas=null)}}const Q_=p.vec3(),q_=p.vec3();p.mat4();class $_ extends n{constructor(e,t={}){super("NavCube",e,t),e.navCube=this;try{this._navCubeScene=new Ui(e,{canvasId:t.canvasId,canvasElement:t.canvasElement,transparent:!0}),this._navCubeCanvas=this._navCubeScene.canvas.canvas,this._navCubeScene.input.keyboardEnabled=!1}catch(e){return void this.error(e)}const s=this._navCubeScene;s.clearLights(),new bi(s,{dir:[.4,-.4,.8],color:[.8,1,1],intensity:1,space:"view"}),new bi(s,{dir:[-.8,-.3,-.4],color:[.8,.8,.8],intensity:1,space:"view"}),new bi(s,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"}),this._navCubeCamera=s.camera,this._navCubeCamera.ortho.scale=7,this._navCubeCamera.ortho.near=.1,this._navCubeCamera.ortho.far=2e3,s.edgeMaterial.edgeColor=[.2,.2,.2],s.edgeMaterial.edgeAlpha=.6,this._zUp=Boolean(e.camera.zUp);var i=this;this.setIsProjectNorth(t.isProjectNorth),this.setProjectNorthOffsetAngle(t.projectNorthOffsetAngle);const r=function(){const e=p.mat4();return function(t,s,r){return p.identityMat4(e),p.rotationMat4v(t*i._projectNorthOffsetAngle*p.DEGTORAD,[0,1,0],e),p.transformVec3(e,s,r)}}();this._synchCamera=function(){var t=p.rotationMat4c(-90*p.DEGTORAD,1,0,0),s=p.vec3(),o=p.vec3(),n=p.vec3();return function(){var a=e.camera.eye,h=e.camera.look,l=e.camera.up;s=p.mulVec3Scalar(p.normalizeVec3(p.subVec3(a,h,s)),5),i._isProjectNorth&&i._projectNorthOffsetAngle&&(s=r(-1,s,Q_),l=r(-1,l,q_)),i._zUp?(p.transformVec3(t,s,o),p.transformVec3(t,l,n),i._navCubeCamera.look=[0,0,0],i._navCubeCamera.eye=p.transformVec3(t,s,o),i._navCubeCamera.up=p.transformPoint3(t,l,n)):(i._navCubeCamera.look=[0,0,0],i._navCubeCamera.eye=s,i._navCubeCamera.up=l)}}(),this._cubeTextureCanvas=new Z_(e,t),this._cubeSampler=new Dn(s,{image:this._cubeTextureCanvas.getImage(),flipY:!0,wrapS:1001,wrapT:1001}),this._cubeMesh=new Ko(s,{geometry:new Mi(s,{primitive:"triangles",normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],positions:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],uv:[.5,.6666,.25,.6666,.25,.3333,.5,.3333,.5,.6666,.5,.3333,.75,.3333,.75,.6666,.5,.6666,.5,1,.25,1,.25,.6666,.25,.6666,0,.6666,0,.3333,.25,.3333,.25,0,.5,0,.5,.3333,.25,.3333,.75,.3333,1,.3333,1,.6666,.75,.6666],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}),material:new Ei(s,{diffuse:[.4,.4,.4],specular:[.4,.4,.4],emissive:[.6,.6,.6],diffuseMap:this._cubeSampler,emissiveMap:this._cubeSampler}),visible:!0,edges:!0}),this._shadow=!1===t.shadowVisible?null:new Ko(s,{geometry:new Mi(s,Zo({center:[0,0,0],radiusTop:.001,radiusBottom:1.4,height:.01,radialSegments:20,heightSegments:1,openEnded:!0})),material:new Ei(s,{diffuse:[0,0,0],specular:[0,0,0],emissive:[0,0,0],alpha:.5}),position:[0,-1.5,0],visible:!0,pickable:!1,backfaces:!1}),this._onCameraMatrix=e.camera.on("matrix",this._synchCamera),this._onCameraWorldAxis=e.camera.on("worldAxis",(()=>{e.camera.zUp?(this._zUp=!0,this._cubeTextureCanvas.setZUp(),this._repaint(),this._synchCamera()):e.camera.yUp&&(this._zUp=!1,this._cubeTextureCanvas.setYUp(),this._repaint(),this._synchCamera())})),this._onCameraFOV=e.camera.perspective.on("fov",(e=>{this._synchProjection&&(this._navCubeCamera.perspective.fov=e)})),this._onCameraProjection=e.camera.on("projection",(e=>{this._synchProjection&&(this._navCubeCamera.projection="ortho"===e||"perspective"===e?e:"perspective")}));var o=-1;function n(e){var t=[0,0];if(e){for(var s=e.target,i=0,r=0;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;t[0]=e.pageX-i,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t}var a,h,l=null,u=null,c=!1,d=!1,m=.5;i._navCubeCanvas.addEventListener("mouseenter",i._onMouseEnter=function(e){d=!0}),i._navCubeCanvas.addEventListener("mouseleave",i._onMouseLeave=function(e){d=!1}),i._navCubeCanvas.addEventListener("mousedown",i._onMouseDown=function(e){if(1===e.which){l=e.x,u=e.y,a=e.clientX,h=e.clientY;var t=n(e),i=s.pick({canvasPos:t});c=!!i}}),document.addEventListener("mouseup",i._onMouseUp=function(e){if(1===e.which&&(c=!1,null!==l)){var t=n(e),a=s.pick({canvasPos:t,pickSurface:!0});if(a&&a.uv){var h=i._cubeTextureCanvas.getArea(a.uv);if(h>=0&&(document.body.style.cursor="pointer",o>=0&&(i._cubeTextureCanvas.setAreaHighlighted(o,!1),i._repaint(),o=-1),h>=0)){if(i._cubeTextureCanvas.setAreaHighlighted(h,!0),o=h,i._repaint(),e.x<l-3||e.x>l+3||e.y<u-3||e.y>u+3)return;var p=i._cubeTextureCanvas.getAreaDir(h);if(p){var d=i._cubeTextureCanvas.getAreaUp(h);i._isProjectNorth&&i._projectNorthOffsetAngle&&(p=r(1,p,Q_),d=r(1,d,q_)),f(p,d,(function(){o>=0&&(i._cubeTextureCanvas.setAreaHighlighted(o,!1),i._repaint(),o=-1),document.body.style.cursor="pointer",o>=0&&(i._cubeTextureCanvas.setAreaHighlighted(o,!1),i._repaint(),o=-1),h>=0&&(i._cubeTextureCanvas.setAreaHighlighted(h,!1),o=-1,i._repaint())}))}}}}}),document.addEventListener("mousemove",i._onMouseMove=function(t){if(o>=0&&(i._cubeTextureCanvas.setAreaHighlighted(o,!1),i._repaint(),o=-1),1!==t.buttons||c){if(c){var r=t.clientX,l=t.clientY;return document.body.style.cursor="move",void function(t,s){var i=(t-a)*-m,r=(s-h)*-m;e.camera.orbitYaw(i),e.camera.orbitPitch(-r),a=t,h=s}(r,l)}if(d){var u=n(t),p=s.pick({canvasPos:u,pickSurface:!0});if(p){if(p.uv){document.body.style.cursor="pointer";var f=i._cubeTextureCanvas.getArea(p.uv);if(f===o)return;o>=0&&i._cubeTextureCanvas.setAreaHighlighted(o,!1),f>=0&&(i._cubeTextureCanvas.setAreaHighlighted(f,!0),i._repaint(),o=f)}}else document.body.style.cursor="default",o>=0&&(i._cubeTextureCanvas.setAreaHighlighted(o,!1),i._repaint(),o=-1)}}});var f=function(){var t=p.vec3();return function(s,r,o){var n=i._fitVisible?e.scene.getAABB(e.scene.visibleObjectIds):e.scene.aabb,a=p.getAABB3Diag(n);p.getAABB3Center(n,t);var h=Math.abs(a/Math.tan(i._cameraFitFOV*p.DEGTORAD));e.cameraControl.pivotPos=t,i._cameraFly?e.cameraFlight.flyTo({look:t,eye:[t[0]-h*s[0],t[1]-h*s[1],t[2]-h*s[2]],up:r||[0,1,0],orthoScale:1.1*a,fitFOV:i._cameraFitFOV,duration:i._cameraFlyDuration},o):e.cameraFlight.jumpTo({look:t,eye:[t[0]-h*s[0],t[1]-h*s[1],t[2]-h*s[2]],up:r||[0,1,0],orthoScale:1.1*a,fitFOV:i._cameraFitFOV},o)}}();this._onUpdated=e.localeService.on("updated",(()=>{this._cubeTextureCanvas.clear(),this._repaint()})),this.setVisible(t.visible),this.setCameraFitFOV(t.cameraFitFOV),this.setCameraFly(t.cameraFly),this.setCameraFlyDuration(t.cameraFlyDuration),this.setFitVisible(t.fitVisible),this.setSynchProjection(t.synchProjection)}send(e,t){if("language"===e)this._cubeTextureCanvas.clear(),this._repaint()}_repaint(){const e=this._cubeTextureCanvas.getImage();this._cubeMesh.material.diffuseMap.image=e,this._cubeMesh.material.emissiveMap.image=e}setVisible(e=!0){this._navCubeCanvas&&(this._cubeMesh.visible=e,this._shadow&&(this._shadow.visible=e),this._navCubeCanvas.style.visibility=e?"visible":"hidden")}getVisible(){return!!this._navCubeCanvas&&this._cubeMesh.visible}setFitVisible(e=!1){this._fitVisible=e}getFitVisible(){return this._fitVisible}setCameraFly(e=!0){this._cameraFly=e}getCameraFly(){return this._cameraFly}setCameraFitFOV(e=45){this._cameraFitFOV=e}getCameraFitFOV(){return this._cameraFitFOV}setCameraFlyDuration(e=.5){this._cameraFlyDuration=e}getCameraFlyDuration(){return this._cameraFlyDuration}setSynchProjection(e=!1){this._synchProjection=e}getSynchProjection(){return this._synchProjection}setIsProjectNorth(e=!1){this._isProjectNorth=e}getIsProjectNorth(){return this._isProjectNorth}setProjectNorthOffsetAngle(e){this._projectNorthOffsetAngle=e}getProjectNorthOffsetAngle(){return this._projectNorthOffsetAngle}destroy(){this._navCubeCanvas&&(this.viewer.localeService.off(this._onUpdated),this.viewer.camera.off(this._onCameraMatrix),this.viewer.camera.off(this._onCameraWorldAxis),this.viewer.camera.perspective.off(this._onCameraFOV),this.viewer.camera.off(this._onCameraProjection),this._navCubeCanvas.removeEventListener("mouseenter",this._onMouseEnter),this._navCubeCanvas.removeEventListener("mouseleave",this._onMouseLeave),this._navCubeCanvas.removeEventListener("mousedown",this._onMouseDown),document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this._navCubeCanvas=null,this._cubeTextureCanvas.destroy(),this._cubeTextureCanvas=null,this._onMouseEnter=null,this._onMouseLeave=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null),this._navCubeScene.destroy(),this._navCubeScene=null,this._cubeMesh=null,this._shadow=null,super.destroy()}}const ey=p.vec3();class ty{load(e,t,s={}){var i=e.scene.canvas.spinner;i.processes++,sy(e,t,(function(t){!function(e,t,s){for(var i=t.basePath,r=Object.keys(t.materialLibraries),o=r.length,n=0,a=o;n<a;n++)ry(e,i,i+r[n],(function(){0==--o&&s()}))}(e,t,(function(){ny(e,t),i.processes--,C.scheduleTask((function(){e.fire("loaded",!0,!1)}))}))}))}parse(e,t,s,i){if(t){var r=iy(e,t,null);s&&oy(e,s,i),ny(e,r),e.src=null,e.fire("loaded",!0,!1)}else this.warn("load() param expected: objText")}}var sy=function(e,t,s){ay(t,(function(i){var r=iy(e,i,t);s(r)}),(function(t){e.error(t)}))},iy=function(){const e={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /};return function(i,r,o){var n={src:o=o||"",basePath:t(o),objects:[],object:{},positions:[],normals:[],uv:[],materialLibraries:{}};s(n,"",!1),-1!==r.indexOf("\r\n")&&(r=r.replace("\r\n","\n"));for(var a=r.split("\n"),h="",l="",u="",d=[],m="function"==typeof"".trimLeft,f=0,g=a.length;f<g;f++)if(h=a[f],0!==(h=m?h.trimLeft():h.trim()).length&&"#"!==(l=h.charAt(0)))if("v"===l)if(" "===(u=h.charAt(1))&&null!==(d=e.vertex_pattern.exec(h)))n.positions.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));else if("n"===u&&null!==(d=e.normal_pattern.exec(h)))n.normals.push(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]));else{if("t"!==u||null===(d=e.uv_pattern.exec(h)))return void i.error("Unexpected vertex/normal/uv line: '"+h+"'");n.uv.push(parseFloat(d[1]),parseFloat(d[2]))}else if("f"===l)if(null!==(d=e.face_vertex_uv_normal.exec(h)))c(n,d[1],d[4],d[7],d[10],d[2],d[5],d[8],d[11],d[3],d[6],d[9],d[12]);else if(null!==(d=e.face_vertex_uv.exec(h)))c(n,d[1],d[3],d[5],d[7],d[2],d[4],d[6],d[8]);else if(null!==(d=e.face_vertex_normal.exec(h)))c(n,d[1],d[3],d[5],d[7],void 0,void 0,void 0,void 0,d[2],d[4],d[6],d[8]);else{if(null===(d=e.face_vertex.exec(h)))return void i.error("Unexpected face line: '"+h+"'");c(n,d[1],d[2],d[3],d[4])}else if("l"===l){var _=h.substring(1).trim().split(" "),y=[],v=[];if(-1===h.indexOf("/"))y=_;else for(var b=0,x=_.length;b<x;b++){var P=_[b].split("/");""!==P[0]&&y.push(P[0]),""!==P[1]&&v.push(P[1])}p(n,y,v)}else if(null!==(d=e.object_pattern.exec(h))){s(n,T=d[0].substr(1).trim(),!0)}else if(e.material_use_pattern.test(h)){var T=h.substring(7).trim();n.object.material.id=T}else if(e.material_library_pattern.test(h))n.materialLibraries[h.substring(7).trim()]=!0;else{if(null===(d=e.smoothing_pattern.exec(h))){if("\0"===h)continue;return void i.error("Unexpected line: '"+h+"'")}var w=d[1].trim().toLowerCase();n.object.material.smooth="1"===w||"on"===w}return n};function t(e){var t=e.lastIndexOf("/");return-1===t?e:e.substring(0,t+1)}function s(e,t,s){if(e.object&&!1===e.object.fromDeclaration)return e.object.id=t,void(e.object.fromDeclaration=!1!==s);e.object={id:t||"",geometry:{positions:[],normals:[],uv:[]},material:{id:"",smooth:!0},fromDeclaration:!1!==s},e.objects.push(e.object)}function i(e,t){var s=parseInt(e,10);return 3*(s>=0?s-1:s+t/3)}function r(e,t){var s=parseInt(e,10);return 3*(s>=0?s-1:s+t/3)}function o(e,t){var s=parseInt(e,10);return 2*(s>=0?s-1:s+t/2)}function n(e,t,s,i){var r=e.positions,o=e.object.geometry.positions;o.push(r[t+0]),o.push(r[t+1]),o.push(r[t+2]),o.push(r[s+0]),o.push(r[s+1]),o.push(r[s+2]),o.push(r[i+0]),o.push(r[i+1]),o.push(r[i+2])}function a(e,t){var s=e.positions,i=e.object.geometry.positions;i.push(s[t+0]),i.push(s[t+1]),i.push(s[t+2])}function h(e,t,s,i){var r=e.normals,o=e.object.geometry.normals;o.push(r[t+0]),o.push(r[t+1]),o.push(r[t+2]),o.push(r[s+0]),o.push(r[s+1]),o.push(r[s+2]),o.push(r[i+0]),o.push(r[i+1]),o.push(r[i+2])}function l(e,t,s,i){var r=e.uv,o=e.object.geometry.uv;o.push(r[t+0]),o.push(r[t+1]),o.push(r[s+0]),o.push(r[s+1]),o.push(r[i+0]),o.push(r[i+1])}function u(e,t){var s=e.uv,i=e.object.geometry.uv;i.push(s[t+0]),i.push(s[t+1])}function c(e,t,s,a,u,c,p,d,m,f,g,_,y){var v,b=e.positions.length,x=i(t,b),P=i(s,b),T=i(a,b);if(void 0===u?n(e,x,P,T):(n(e,x,P,v=i(u,b)),n(e,P,T,v)),void 0!==c){var w=e.uv.length;x=o(c,w),P=o(p,w),T=o(d,w),void 0===u?l(e,x,P,T):(l(e,x,P,v=o(m,w)),l(e,P,T,v))}if(void 0!==f){var M=e.normals.length;x=r(f,M),P=f===g?x:r(g,M),T=f===_?x:r(_,M),void 0===u?h(e,x,P,T):(h(e,x,P,v=r(y,M)),h(e,P,T,v))}}function p(e,t,s){e.object.geometry.type="Line";for(var r=e.positions.length,n=e.uv.length,h=0,l=t.length;h<l;h++)a(e,i(t[h],r));for(var c=0,p=s.length;c<p;c++)u(e,o(s[c],n))}}();var ry=function(e,t,s,i){ay(s,(function(s){oy(e,s,t),i()}),(function(t){e.error(t),i()}))},oy=function(){var e=/\s+/;return function(e,r,o){var n,a,h,l,u,c=r.split("\n"),p={id:"Default"},d=!1;o=o||"";for(var m=0;m<c.length;m++)if(0!==(n=c[m].trim()).length&&"#"!==n.charAt(0))switch(h=(h=(a=n.indexOf(" "))>=0?n.substring(0,a):n).toLowerCase(),l=(l=a>=0?n.substring(a+1):"").trim(),h.toLowerCase()){case"newmtl":s(e,p),p={id:l},d=!0;break;case"ka":p.ambient=i(l);break;case"kd":p.diffuse=i(l);break;case"ks":p.specular=i(l);break;case"map_kd":p.diffuseMap||(p.diffuseMap=t(e,o,l,"sRGB"));break;case"map_ks":p.specularMap||(p.specularMap=t(e,o,l,"linear"));break;case"map_bump":case"bump":p.normalMap||(p.normalMap=t(e,o,l));break;case"ns":p.shininess=parseFloat(l);break;case"d":(u=parseFloat(l))<1&&(p.alpha=u,p.alphaMode="blend");break;case"tr":(u=parseFloat(l))>0&&(p.alpha=1-u,p.alphaMode="blend")}d&&s(e,p)};function t(e,t,s,i){var r={},o=s.split(/\s+/),n=o.indexOf("-bm");return n>=0&&o.splice(n,2),(n=o.indexOf("-s"))>=0&&(r.scale=[parseFloat(o[n+1]),parseFloat(o[n+2])],o.splice(n,4)),(n=o.indexOf("-o"))>=0&&(r.translate=[parseFloat(o[n+1]),parseFloat(o[n+2])],o.splice(n,4)),r.src=t+o.join(" ").trim(),r.flipY=!0,r.encoding=i||"linear",new Dn(e,r).id}function s(e,t){new Ei(e,t)}function i(t){var s=t.split(e,3);return[parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2])]}}();function ny(e,t){for(var s=0,i=t.objects.length;s<i;s++){var r=t.objects[s],o=r.geometry;if(o.type,0===o.positions.length)continue;var n={primitive:"triangles",compressGeometry:!1};n.positions=o.positions,o.normals.length>0&&(n.normals=o.normals),o.uv.length>0&&(n.uv=o.uv);for(var a=new Array(n.positions.length/3),h=0;h<a.length;h++)a[h]=h;n.indices=a;const i=ey;W(o.positions,o.positions,i);var l,u=new Mi(e,n),c=r.material.id;c&&""!==c?(l=e.scene.components[c])||e.error("Material not found: "+c):l=new Ei(e,{diffuse:[.6,.6,.6],backfaces:!0});var p=new Ko(e,{id:e.id+"#"+r.id,origin:0!==i[0]||0!==i[1]||0!==i[2]?i:null,isObject:!0,geometry:u,material:l,pickable:!0});e.addChild(p)}}function ay(e,t,s){var i=new XMLHttpRequest;i.open("GET",e,!0),i.addEventListener("load",(function(e){var i=e.target.response;200===this.status?t&&t(i):0===this.status?(console.warn("loadFile: HTTP Status 0 received."),t&&t(i)):s&&s(e)}),!1),i.addEventListener("error",(function(e){s&&s(e)}),!1),i.send(null)}class hy extends n{constructor(e,t){super("OBJLoader",e,t),this._sceneGraphLoader=new ty}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);var t=new pn(this.viewer.scene,y.apply(e,{isModel:!0}));const s=t.id,i=e.src;if(!i)return this.error("load() param expected: src"),t;if(e.metaModelSrc){const r=e.metaModelSrc;y.loadJSON(r,(r=>{this.viewer.metaScene.createMetaModel(s,r),this._sceneGraphLoader.load(t,i,e)}),(e=>{this.error(`load(): Failed to load model modelMetadata for model '${s} from  '${r}' - ${e}`)}))}else this._sceneGraphLoader.load(t,i,e);return t.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(s)})),t}destroy(){super.destroy()}}const ly=new Float64Array([0,0,1]),uy=new Float64Array(4);class cy{constructor(e){this.id=null,this._viewer=e.viewer,this._visible=!1,this._pos=p.vec3(),this._origin=p.vec3(),this._rtcPos=p.vec3(),this._baseDir=p.vec3(),this._rootNode=null,this._displayMeshes=null,this._affordanceMeshes=null,this._ignoreNextSectionPlaneDirUpdate=!1,this._createNodes(),this._bindEvents()}_setSectionPlane(e){this._sectionPlane&&(this._sectionPlane.off(this._onSectionPlanePos),this._sectionPlane.off(this._onSectionPlaneDir),this._onSectionPlanePos=null,this._onSectionPlaneDir=null,this._sectionPlane=null),e&&(this.id=e.id,this._setPos(e.pos),this._setDir(e.dir),this._sectionPlane=e,this._onSectionPlanePos=e.on("pos",(()=>{this._setPos(this._sectionPlane.pos)})),this._onSectionPlaneDir=e.on("dir",(()=>{this._ignoreNextSectionPlaneDirUpdate?this._ignoreNextSectionPlaneDirUpdate=!1:this._setDir(this._sectionPlane.dir)})))}get sectionPlane(){return this._sectionPlane}_setPos(e){this._pos.set(e),z(this._pos,this._origin,this._rtcPos),this._rootNode.origin=this._origin,this._rootNode.position=this._rtcPos}_setDir(e){this._baseDir.set(e),this._rootNode.quaternion=p.vec3PairToQuaternion(ly,e,uy)}_setSectionPlaneDir(e){this._sectionPlane&&(this._ignoreNextSectionPlaneDirUpdate=!0,this._sectionPlane.dir=e)}setVisible(e=!0){if(this._visible!==e){var t;for(t in this._visible=e,this._displayMeshes)this._displayMeshes.hasOwnProperty(t)&&(this._displayMeshes[t].visible=e);if(!e)for(t in this._affordanceMeshes)this._affordanceMeshes.hasOwnProperty(t)&&(this._affordanceMeshes[t].visible=e)}}getVisible(){return this._visible}setCulled(e){var t;for(t in this._displayMeshes)this._displayMeshes.hasOwnProperty(t)&&(this._displayMeshes[t].culled=e);if(!e)for(t in this._affordanceMeshes)this._affordanceMeshes.hasOwnProperty(t)&&(this._affordanceMeshes[t].culled=e)}_createNodes(){const e=!1,t=this._viewer.scene,s=.01;this._rootNode=new pn(t,{position:[0,0,0],scale:[5,5,5]});const i=this._rootNode,r={arrowHead:new Mi(i,Zo({radiusTop:.001,radiusBottom:.07,radialSegments:32,heightSegments:1,height:.2,openEnded:!1})),arrowHeadBig:new Mi(i,Zo({radiusTop:.001,radiusBottom:.09,radialSegments:32,heightSegments:1,height:.25,openEnded:!1})),arrowHeadHandle:new Mi(i,Zo({radiusTop:.09,radiusBottom:.09,radialSegments:8,heightSegments:1,height:.37,openEnded:!1})),curve:new Mi(i,jn({radius:.8,tube:s,radialSegments:64,tubeSegments:14,arc:2*Math.PI/4})),curveHandle:new Mi(i,jn({radius:.8,tube:.06,radialSegments:64,tubeSegments:14,arc:2*Math.PI/4})),hoop:new Mi(i,jn({radius:.8,tube:s,radialSegments:64,tubeSegments:8,arc:2*Math.PI})),axis:new Mi(i,Zo({radiusTop:s,radiusBottom:s,radialSegments:20,heightSegments:1,height:1,openEnded:!1})),axisHandle:new Mi(i,Zo({radiusTop:.08,radiusBottom:.08,radialSegments:20,heightSegments:1,height:1,openEnded:!1}))},o={pickable:new Ei(i,{diffuse:[1,1,0],alpha:0,alphaMode:"blend"}),red:new Ei(i,{diffuse:[1,0,0],emissive:[1,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),highlightRed:new Ri(i,{edges:!1,fill:!0,fillColor:[1,0,0],fillAlpha:.6}),green:new Ei(i,{diffuse:[0,1,0],emissive:[0,1,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),highlightGreen:new Ri(i,{edges:!1,fill:!0,fillColor:[0,1,0],fillAlpha:.6}),blue:new Ei(i,{diffuse:[0,0,1],emissive:[0,0,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),highlightBlue:new Ri(i,{edges:!1,fill:!0,fillColor:[0,0,1],fillAlpha:.2}),center:new Ei(i,{diffuse:[0,0,0],emissive:[0,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80}),highlightBall:new Ri(i,{edges:!1,fill:!0,fillColor:[.5,.5,.5],fillAlpha:.5,vertices:!1}),highlightPlane:new Ri(i,{edges:!0,edgeWidth:3,fill:!1,fillColor:[.5,.5,.5],fillAlpha:.5,vertices:!1})};this._displayMeshes={plane:i.addChild(new Ko(i,{geometry:new Mi(i,{primitive:"triangles",positions:[.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,.5,.5,-0,.5,-.5,-0,-.5,-.5,-0,-.5,.5,-0],indices:[0,1,2,2,3,0]}),material:new Ei(i,{emissive:[0,0,0],diffuse:[0,0,0],backfaces:!0}),opacity:.6,ghosted:!0,ghostMaterial:new Ri(i,{edges:!1,filled:!0,fillColor:[1,1,0],edgeColor:[0,0,0],fillAlpha:.1,backfaces:!0}),pickable:!1,collidable:!0,clippable:!1,visible:!1,scale:[2.4,2.4,1]}),e),planeFrame:i.addChild(new Ko(i,{geometry:new Mi(i,jn({center:[0,0,0],radius:1.7,tube:.02,radialSegments:4,tubeSegments:4,arc:2*Math.PI})),material:new Ei(i,{emissive:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],shininess:0}),highlightMaterial:new Ri(i,{edges:!1,edgeColor:[0,0,0],filled:!0,fillColor:[.8,.8,.8],fillAlpha:1}),pickable:!1,collidable:!1,clippable:!1,visible:!1,scale:[1,1,.1],rotation:[0,0,45]}),e),xCurve:i.addChild(new Ko(i,{geometry:r.curve,material:o.red,matrix:function(){const e=p.rotationMat4v(90*p.DEGTORAD,[0,1,0],p.identityMat4()),t=p.rotationMat4v(270*p.DEGTORAD,[1,0,0],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),xCurveHandle:i.addChild(new Ko(i,{geometry:r.curveHandle,material:o.pickable,matrix:function(){const e=p.rotationMat4v(90*p.DEGTORAD,[0,1,0],p.identityMat4()),t=p.rotationMat4v(270*p.DEGTORAD,[1,0,0],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),xCurveArrow1:i.addChild(new Ko(i,{geometry:r.arrowHead,material:o.red,matrix:function(){const e=p.translateMat4c(0,-.07,-.8,p.identityMat4()),t=p.scaleMat4v([.6,.6,.6],p.identityMat4()),s=p.rotationMat4v(0*p.DEGTORAD,[0,0,1],p.identityMat4());return p.mulMat4(p.mulMat4(e,t,p.identityMat4()),s,p.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),xCurveArrow2:i.addChild(new Ko(i,{geometry:r.arrowHead,material:o.red,matrix:function(){const e=p.translateMat4c(0,-.8,-.07,p.identityMat4()),t=p.scaleMat4v([.6,.6,.6],p.identityMat4()),s=p.rotationMat4v(90*p.DEGTORAD,[1,0,0],p.identityMat4());return p.mulMat4(p.mulMat4(e,t,p.identityMat4()),s,p.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),yCurve:i.addChild(new Ko(i,{geometry:r.curve,material:o.green,rotation:[-90,0,0],pickable:!1,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),yCurveHandle:i.addChild(new Ko(i,{geometry:r.curveHandle,material:o.pickable,rotation:[-90,0,0],pickable:!0,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),yCurveArrow1:i.addChild(new Ko(i,{geometry:r.arrowHead,material:o.green,matrix:function(){const e=p.translateMat4c(.07,0,-.8,p.identityMat4()),t=p.scaleMat4v([.6,.6,.6],p.identityMat4()),s=p.rotationMat4v(90*p.DEGTORAD,[0,0,1],p.identityMat4());return p.mulMat4(p.mulMat4(e,t,p.identityMat4()),s,p.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),yCurveArrow2:i.addChild(new Ko(i,{geometry:r.arrowHead,material:o.green,matrix:function(){const e=p.translateMat4c(.8,0,-.07,p.identityMat4()),t=p.scaleMat4v([.6,.6,.6],p.identityMat4()),s=p.rotationMat4v(90*p.DEGTORAD,[1,0,0],p.identityMat4());return p.mulMat4(p.mulMat4(e,t,p.identityMat4()),s,p.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zCurve:i.addChild(new Ko(i,{geometry:r.curve,material:o.blue,matrix:p.rotationMat4v(180*p.DEGTORAD,[1,0,0],p.identityMat4()),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zCurveHandle:i.addChild(new Ko(i,{geometry:r.curveHandle,material:o.pickable,matrix:p.rotationMat4v(180*p.DEGTORAD,[1,0,0],p.identityMat4()),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zCurveCurveArrow1:i.addChild(new Ko(i,{geometry:r.arrowHead,material:o.blue,matrix:function(){const e=p.translateMat4c(.8,-.07,0,p.identityMat4()),t=p.scaleMat4v([.6,.6,.6],p.identityMat4());return p.mulMat4(e,t,p.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zCurveArrow2:i.addChild(new Ko(i,{geometry:r.arrowHead,material:o.blue,matrix:function(){const e=p.translateMat4c(.05,-.8,0,p.identityMat4()),t=p.scaleMat4v([.6,.6,.6],p.identityMat4()),s=p.rotationMat4v(90*p.DEGTORAD,[0,0,1],p.identityMat4());return p.mulMat4(p.mulMat4(e,t,p.identityMat4()),s,p.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),center:i.addChild(new Ko(i,{geometry:new Mi(i,Qo({radius:.05})),material:o.center,pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),xAxisArrow:i.addChild(new Ko(i,{geometry:r.arrowHead,material:o.red,matrix:function(){const e=p.translateMat4c(0,1.1,0,p.identityMat4()),t=p.rotationMat4v(-90*p.DEGTORAD,[0,0,1],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),xAxisArrowHandle:i.addChild(new Ko(i,{geometry:r.arrowHeadHandle,material:o.pickable,matrix:function(){const e=p.translateMat4c(0,1.1,0,p.identityMat4()),t=p.rotationMat4v(-90*p.DEGTORAD,[0,0,1],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),xAxis:i.addChild(new Ko(i,{geometry:r.axis,material:o.red,matrix:function(){const e=p.translateMat4c(0,.5,0,p.identityMat4()),t=p.rotationMat4v(-90*p.DEGTORAD,[0,0,1],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),xAxisHandle:i.addChild(new Ko(i,{geometry:r.axisHandle,material:o.pickable,matrix:function(){const e=p.translateMat4c(0,.5,0,p.identityMat4()),t=p.rotationMat4v(-90*p.DEGTORAD,[0,0,1],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),yAxisArrow:i.addChild(new Ko(i,{geometry:r.arrowHead,material:o.green,matrix:function(){const e=p.translateMat4c(0,1.1,0,p.identityMat4()),t=p.rotationMat4v(180*p.DEGTORAD,[1,0,0],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),yAxisArrowHandle:i.addChild(new Ko(i,{geometry:r.arrowHeadHandle,material:o.pickable,matrix:function(){const e=p.translateMat4c(0,1.1,0,p.identityMat4()),t=p.rotationMat4v(180*p.DEGTORAD,[1,0,0],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1,opacity:.2}),e),yShaft:i.addChild(new Ko(i,{geometry:r.axis,material:o.green,position:[0,-.5,0],pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),yShaftHandle:i.addChild(new Ko(i,{geometry:r.axisHandle,material:o.pickable,position:[0,-.5,0],pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zAxisArrow:i.addChild(new Ko(i,{geometry:r.arrowHead,material:o.blue,matrix:function(){const e=p.translateMat4c(0,1.1,0,p.identityMat4()),t=p.rotationMat4v(-90*p.DEGTORAD,[.8,0,0],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zAxisArrowHandle:i.addChild(new Ko(i,{geometry:r.arrowHeadHandle,material:o.pickable,matrix:function(){const e=p.translateMat4c(0,1.1,0,p.identityMat4()),t=p.rotationMat4v(-90*p.DEGTORAD,[.8,0,0],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),e),zShaft:i.addChild(new Ko(i,{geometry:r.axis,material:o.blue,matrix:function(){const e=p.translateMat4c(0,.5,0,p.identityMat4()),t=p.rotationMat4v(-90*p.DEGTORAD,[1,0,0],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),clippable:!1,pickable:!1,collidable:!0,visible:!1}),e),zAxisHandle:i.addChild(new Ko(i,{geometry:r.axisHandle,material:o.pickable,matrix:function(){const e=p.translateMat4c(0,.5,0,p.identityMat4()),t=p.rotationMat4v(-90*p.DEGTORAD,[1,0,0],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),clippable:!1,pickable:!0,collidable:!0,visible:!1}),e)},this._affordanceMeshes={planeFrame:i.addChild(new Ko(i,{geometry:new Mi(i,jn({center:[0,0,0],radius:2,tube:s,radialSegments:4,tubeSegments:4,arc:2*Math.PI})),material:new Ei(i,{ambient:[1,1,1],diffuse:[0,0,0],emissive:[1,1,0]}),highlighted:!0,highlightMaterial:new Ri(i,{edges:!1,filled:!0,fillColor:[1,1,0],fillAlpha:1}),pickable:!1,collidable:!1,clippable:!1,visible:!1,scale:[1,1,1],rotation:[0,0,45]}),e),xHoop:i.addChild(new Ko(i,{geometry:r.hoop,material:o.red,highlighted:!0,highlightMaterial:o.highlightRed,matrix:function(){const e=p.rotationMat4v(90*p.DEGTORAD,[0,1,0],p.identityMat4()),t=p.rotationMat4v(270*p.DEGTORAD,[1,0,0],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),yHoop:i.addChild(new Ko(i,{geometry:r.hoop,material:o.green,highlighted:!0,highlightMaterial:o.highlightGreen,rotation:[-90,0,0],pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zHoop:i.addChild(new Ko(i,{geometry:r.hoop,material:o.blue,highlighted:!0,highlightMaterial:o.highlightBlue,matrix:p.rotationMat4v(180*p.DEGTORAD,[1,0,0],p.identityMat4()),pickable:!1,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),e),xAxisArrow:i.addChild(new Ko(i,{geometry:r.arrowHeadBig,material:o.red,matrix:function(){const e=p.translateMat4c(0,1.1,0,p.identityMat4()),t=p.rotationMat4v(-90*p.DEGTORAD,[0,0,1],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),yAxisArrow:i.addChild(new Ko(i,{geometry:r.arrowHeadBig,material:o.green,matrix:function(){const e=p.translateMat4c(0,1.1,0,p.identityMat4()),t=p.rotationMat4v(180*p.DEGTORAD,[1,0,0],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zAxisArrow:i.addChild(new Ko(i,{geometry:r.arrowHeadBig,material:o.blue,matrix:function(){const e=p.translateMat4c(0,1.1,0,p.identityMat4()),t=p.rotationMat4v(-90*p.DEGTORAD,[.8,0,0],p.identityMat4());return p.mulMat4(t,e,p.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e)}}_bindEvents(){const e=this;var t=!1;const s=-1,i=0,r=1,o=2,n=3,a=4,h=5,l=this._rootNode;var u=null,c=null;const d=p.vec2(),m=p.vec3([1,0,0]),f=p.vec3([0,1,0]),g=p.vec3([0,0,1]),_=this._viewer.scene.canvas.canvas,y=this._viewer.camera,v=this._viewer.scene;{const e=p.vec3([0,0,0]);let t=-1;this._onCameraViewMatrix=v.camera.on("viewMatrix",(()=>{})),this._onCameraProjMatrix=v.camera.on("projMatrix",(()=>{})),this._onSceneTick=v.on("tick",(()=>{const s=Math.abs(p.lenVec3(p.subVec3(v.camera.eye,this._pos,e)));if(s!==t&&"perspective"===y.projection){const e=.07*(Math.tan(y.perspective.fov*p.DEGTORAD)*s);l.scale=[e,e,e],t=s}if("ortho"===y.projection){const e=y.ortho.scale/10;l.scale=[e,e,e],t=s}}))}const b=function(){const e=new Float64Array(2);return function(t){if(t){for(var s=t.target,i=0,r=0;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;e[0]=t.pageX-i,e[1]=t.pageY-r}else t=window.event,e[0]=t.x,e[1]=t.y;return e}}(),x=function(){const t=p.mat4();return function(s,i){return p.quaternionToMat4(e._rootNode.quaternion,t),p.transformVec3(t,s,i),p.normalizeVec3(i),i}}();var P=function(){const e=p.vec3();return function(t){const s=Math.abs(t[0]);return s>Math.abs(t[1])&&s>Math.abs(t[2])?p.cross3Vec3(t,[0,1,0],e):p.cross3Vec3(t,[1,0,0],e),p.cross3Vec3(e,t,e),p.normalizeVec3(e),e}}();const T=function(){const t=p.vec3(),s=p.vec3(),i=p.vec4();return function(r,o,n){x(r,i);const a=P(i,o,n);M(o,a,t),M(n,a,s),p.subVec3(s,t);const h=p.dotVec3(s,i);e._pos[0]+=i[0]*h,e._pos[1]+=i[1]*h,e._pos[2]+=i[2]*h,e._rootNode.position=e._pos,e._sectionPlane&&(e._sectionPlane.pos=e._pos)}}();var w=function(){const t=p.vec4(),s=p.vec4(),i=p.vec4(),r=p.vec4();return function(o,n,a){x(o,r);if(!(M(n,r,t)&&M(a,r,s))){const e=P(r,n,a);M(n,e,t,1),M(a,e,s,1);var h=p.dotVec3(t,r);t[0]-=h*r[0],t[1]-=h*r[1],t[2]-=h*r[2],h=p.dotVec3(s,r),s[0]-=h*r[0],s[1]-=h*r[1],s[2]-=h*r[2]}p.normalizeVec3(t),p.normalizeVec3(s),h=p.dotVec3(t,s),h=p.clamp(h,-1,1);var l=Math.acos(h)*p.RADTODEG;p.cross3Vec3(t,s,i),p.dotVec3(i,r)<0&&(l=-l),e._rootNode.rotate(o,l),I()}}(),M=function(){const t=p.vec4([0,0,0,1]),s=p.mat4();return function(i,r,o,n){n=n||0,t[0]=i[0]/_.width*2-1,t[1]=-(i[1]/_.height*2-1),t[2]=0,t[3]=1,p.mulMat4(y.projMatrix,y.viewMatrix,s),p.inverseMat4(s),p.transformVec4(s,t,t),p.mulVec4Scalar(t,1/t[3]);var a=y.eye;p.subVec4(t,a,t);const h=e._sectionPlane.pos;var l=-p.dotVec3(h,r)-n,u=p.dotVec3(r,t);if(Math.abs(u)>.005){var c=-(p.dotVec3(r,a)+l)/u;return p.mulVec3Scalar(t,c,o),p.addVec3(o,a),p.subVec3(o,h,o),!0}return!1}}();const I=function(){const t=p.vec3(),s=p.mat4();return function(){e.sectionPlane&&(p.quaternionToMat4(l.quaternion,s),p.transformVec3(s,[0,0,1],t),e._setSectionPlaneDir(t))}}();var C,D=!1;this._onCameraControlHover=this._viewer.cameraControl.on("hoverEnter",(e=>{if(!this._visible)return;if(D)return;var l;t=!1,C&&(C.visible=!1);switch(e.entity.id){case this._displayMeshes.xAxisArrowHandle.id:case this._displayMeshes.xAxisHandle.id:l=this._affordanceMeshes.xAxisArrow,u=i;break;case this._displayMeshes.yAxisArrowHandle.id:case this._displayMeshes.yShaftHandle.id:l=this._affordanceMeshes.yAxisArrow,u=r;break;case this._displayMeshes.zAxisArrowHandle.id:case this._displayMeshes.zAxisHandle.id:l=this._affordanceMeshes.zAxisArrow,u=o;break;case this._displayMeshes.xCurveHandle.id:l=this._affordanceMeshes.xHoop,u=n;break;case this._displayMeshes.yCurveHandle.id:l=this._affordanceMeshes.yHoop,u=a;break;case this._displayMeshes.zCurveHandle.id:l=this._affordanceMeshes.zHoop,u=h;break;default:return void(u=s)}l&&(l.visible=!0),C=l,t=!0})),this._onCameraControlHoverLeave=this._viewer.cameraControl.on("hoverOut",(e=>{this._visible&&(C&&(C.visible=!1),C=null,u=s)})),_.addEventListener("mousedown",this._canvasMouseDownListener=e=>{if(e.preventDefault(),this._visible&&t&&(this._viewer.cameraControl.pointerEnabled=!1,1===e.which)){D=!0;var s=b(e);c=u,d[0]=s[0],d[1]=s[1]}}),_.addEventListener("mousemove",this._canvasMouseMoveListener=e=>{if(!this._visible)return;if(!D)return;var t=b(e);const s=t[0],l=t[1];switch(c){case i:T(m,d,t);break;case r:T(f,d,t);break;case o:T(g,d,t);break;case n:w(m,d,t);break;case a:w(f,d,t);break;case h:w(g,d,t)}d[0]=s,d[1]=l}),_.addEventListener("mouseup",this._canvasMouseUpListener=e=>{this._visible&&(this._viewer.cameraControl.pointerEnabled=!0,D&&(e.which,D=!1,t=!1))}),_.addEventListener("wheel",this._canvasWheelListener=e=>{if(this._visible)Math.max(-1,Math.min(1,40*-e.deltaY))})}_destroy(){this._unbindEvents(),this._destroyNodes()}_unbindEvents(){const e=this._viewer,t=e.scene,s=t.canvas.canvas,i=e.camera,r=e.cameraControl;t.off(this._onSceneTick),s.removeEventListener("mousedown",this._canvasMouseDownListener),s.removeEventListener("mousemove",this._canvasMouseMoveListener),s.removeEventListener("mouseup",this._canvasMouseUpListener),s.removeEventListener("wheel",this._canvasWheelListener),i.off(this._onCameraViewMatrix),i.off(this._onCameraProjMatrix),r.off(this._onCameraControlHover),r.off(this._onCameraControlHoverLeave)}_destroyNodes(){this._setSectionPlane(null),this._rootNode.destroy(),this._displayMeshes={},this._affordanceMeshes={}}}class py{constructor(e,t,s){this.id=s.id,this._sectionPlane=s,this._mesh=new Ko(t,{id:s.id,geometry:new Mi(t,Ii({xSize:.5,ySize:.5,zSize:.001})),material:new Ei(t,{emissive:[1,1,1],diffuse:[0,0,0],backfaces:!1}),edgeMaterial:new Oi(t,{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),highlightMaterial:new Ri(t,{fill:!0,fillColor:[.5,1,.5],fillAlpha:.7,edges:!0,edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),selectedMaterial:new Ri(t,{fill:!0,fillColor:[0,0,1],fillAlpha:.7,edges:!0,edgeColor:[1,0,0],edgeAlpha:1,edgeWidth:1}),highlighted:!0,scale:[3,3,3],position:[0,0,0],rotation:[0,0,0],opacity:.3,edges:!0});{const e=p.vec3([0,0,0]),t=p.vec3(),s=p.vec3([0,0,1]),i=p.vec4(4),r=p.vec3(),o=()=>{const o=this._sectionPlane.scene.center,n=[-this._sectionPlane.dir[0],-this._sectionPlane.dir[1],-this._sectionPlane.dir[2]];p.subVec3(o,this._sectionPlane.pos,e);const a=-p.dotVec3(n,e);p.normalizeVec3(n),p.mulVec3Scalar(n,a,t);const h=p.vec3PairToQuaternion(s,this._sectionPlane.dir,i);r[0]=.1*t[0],r[1]=.1*t[1],r[2]=.1*t[2],this._mesh.quaternion=h,this._mesh.position=r};this._onSectionPlanePos=this._sectionPlane.on("pos",o),this._onSectionPlaneDir=this._sectionPlane.on("dir",o)}this._highlighted=!1,this._selected=!1}setHighlighted(e){this._highlighted=!!e,this._mesh.highlighted=this._highlighted,this._mesh.highlightMaterial.fillColor=e?[0,.7,0]:[0,0,0]}getHighlighted(){return this._highlighted}setSelected(e){this._selected=!!e,this._mesh.edgeMaterial.edgeWidth=e?3:1,this._mesh.highlightMaterial.edgeWidth=e?3:1}getSelected(){return this._selected}destroy(){this._sectionPlane.off(this._onSectionPlanePos),this._sectionPlane.off(this._onSectionPlaneDir),this._mesh.destroy()}}class dy{constructor(e,t){if(!(t.onHoverEnterPlane&&t.onHoverLeavePlane&&t.onClickedNothing&&t.onClickedPlane))throw"Missing config(s): onHoverEnterPlane, onHoverLeavePlane, onClickedNothing || onClickedPlane";this.plugin=e,this._viewer=e.viewer,this._onHoverEnterPlane=t.onHoverEnterPlane,this._onHoverLeavePlane=t.onHoverLeavePlane,this._onClickedNothing=t.onClickedNothing,this._onClickedPlane=t.onClickedPlane,this._visible=!0,this._planes={},this._canvas=t.overviewCanvas,this._scene=new Ui(this._viewer,{canvasId:this._canvas.id,transparent:!0}),this._scene.clearLights(),new bi(this._scene,{dir:[.4,-.4,.8],color:[.8,1,1],intensity:1,space:"view"}),new bi(this._scene,{dir:[-.8,-.3,-.4],color:[.8,.8,.8],intensity:1,space:"view"}),new bi(this._scene,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"}),this._scene.camera,this._scene.camera.perspective.fov=70,this._zUp=!1;{const e=this._scene.camera,t=p.rotationMat4c(-90*p.DEGTORAD,1,0,0),s=p.vec3(),i=p.vec3(),r=p.vec3();this._synchCamera=()=>{const o=this._viewer.camera.eye,n=this._viewer.camera.look,a=this._viewer.camera.up;p.mulVec3Scalar(p.normalizeVec3(p.subVec3(o,n,s)),7),this._zUp?(p.transformVec3(t,s,i),p.transformVec3(t,a,r),e.look=[0,0,0],e.eye=p.transformVec3(t,s,i),e.up=p.transformPoint3(t,a,r)):(e.look=[0,0,0],e.eye=s,e.up=a)}}this._onViewerCameraMatrix=this._viewer.camera.on("matrix",this._synchCamera),this._onViewerCameraWorldAxis=this._viewer.camera.on("worldAxis",this._synchCamera),this._onViewerCameraFOV=this._viewer.camera.perspective.on("fov",(e=>{this._scene.camera.perspective.fov=e}));var s=null;this._onInputMouseMove=this._scene.input.on("mousemove",(e=>{const t=this._scene.pick({canvasPos:e});if(t){if(!s||t.entity.id!==s.id){if(s){this._planes[s.id]&&this._onHoverLeavePlane(s.id)}s=t.entity;this._planes[s.id]&&this._onHoverEnterPlane(s.id)}}else s&&(this._onHoverLeavePlane(s.id),s=null)})),this._scene.canvas.canvas.addEventListener("mouseup",this._onCanvasMouseUp=()=>{if(s){this._planes[s.id]&&this._onClickedPlane(s.id)}else this._onClickedNothing()}),this._scene.canvas.canvas.addEventListener("mouseout",this._onCanvasMouseOut=()=>{s&&(this._onHoverLeavePlane(s.id),s=null)}),this.setVisible(t.overviewVisible)}addSectionPlane(e){this._planes[e.id]=new py(this,this._scene,e)}setPlaneHighlighted(e,t){const s=this._planes[e];s&&s.setHighlighted(t)}setPlaneSelected(e,t){const s=this._planes[e];s&&s.setSelected(t)}removeSectionPlane(e){const t=this._planes[e.id];t&&(t.destroy(),delete this._planes[e.id])}setVisible(e=!0){this._visible=e,this._canvas.style.visibility=e?"visible":"hidden"}getVisible(){return this._visible}destroy(){this._viewer.camera.off(this._onViewerCameraMatrix),this._viewer.camera.off(this._onViewerCameraWorldAxis),this._viewer.camera.perspective.off(this._onViewerCameraFOV),this._scene.input.off(this._onInputMouseMove),this._scene.canvas.canvas.removeEventListener("mouseup",this._onCanvasMouseUp),this._scene.canvas.canvas.removeEventListener("mouseout",this._onCanvasMouseOut),this._scene.destroy()}}const my=p.AABB3(),fy=p.vec3();class gy extends n{constructor(e,t={}){if(super("SectionPlanes",e),this._freeControls=[],this._sectionPlanes=e.scene.sectionPlanes,this._controls={},this._shownControlId=null,null!==t.overviewCanvasId&&void 0!==t.overviewCanvasId){const e=document.getElementById(t.overviewCanvasId);e?this._overview=new dy(this,{overviewCanvas:e,visible:t.overviewVisible,onHoverEnterPlane:e=>{this._overview.setPlaneHighlighted(e,!0)},onHoverLeavePlane:e=>{this._overview.setPlaneHighlighted(e,!1)},onClickedPlane:e=>{if(this.getShownControl()===e)return void this.hideControl();this.showControl(e);const t=this.sectionPlanes[e].pos;my.set(this.viewer.scene.aabb),p.getAABB3Center(my,fy),my[0]+=t[0]-fy[0],my[1]+=t[1]-fy[1],my[2]+=t[2]-fy[2],my[3]+=t[0]-fy[0],my[4]+=t[1]-fy[1],my[5]+=t[2]-fy[2],this.viewer.cameraFlight.flyTo({aabb:my,fitFOV:65})},onClickedNothing:()=>{this.hideControl()}}):this.warn("Can't find overview canvas: '"+t.overviewCanvasId+"' - will create plugin without overview")}this._onSceneSectionPlaneCreated=e.scene.on("sectionPlaneCreated",(e=>{this._sectionPlaneCreated(e)}))}setOverviewVisible(e){this._overview&&this._overview.setVisible(e)}getOverviewVisible(){if(this._overview)return this._overview.getVisible()}get sectionPlanes(){return this._sectionPlanes}createSectionPlane(e={}){void 0!==e.id&&null!==e.id&&this.viewer.scene.components[e.id]&&(this.error("Viewer component with this ID already exists: "+e.id),delete e.id);return new tn(this.viewer.scene,{id:e.id,pos:e.pos,dir:e.dir,active:!0})}_sectionPlaneCreated(e){const t=this._freeControls.length>0?this._freeControls.pop():new cy(this);t._setSectionPlane(e),t.setVisible(!1),this._controls[e.id]=t,this._overview&&this._overview.addSectionPlane(e),e.once("destroyed",(()=>{this._sectionPlaneDestroyed(e)}))}flipSectionPlanes(){const e=this.viewer.scene.sectionPlanes;for(let t in e){e[t].flipDir()}}showControl(e){const t=this._controls[e];t?(this.hideControl(),t.setVisible(!0),this._overview&&this._overview.setPlaneSelected(e,!0),this._shownControlId=e):this.error("Control not found: "+e)}getShownControl(){return this._shownControlId}hideControl(){for(var e in this._controls)this._controls.hasOwnProperty(e)&&(this._controls[e].setVisible(!1),this._overview&&this._overview.setPlaneSelected(e,!1));this._shownControlId=null}destroySectionPlane(e){var t=this.viewer.scene.sectionPlanes[e];t?(this._sectionPlaneDestroyed(t),t.destroy(),e===this._shownControlId&&(this._shownControlId=null)):this.error("SectionPlane not found: "+e)}_sectionPlaneDestroyed(e){this._overview&&this._overview.removeSectionPlane(e);const t=this._controls[e.id];t&&(t.setVisible(!1),t._setSectionPlane(null),delete this._controls[e.id],this._freeControls.push(t))}clear(){const e=Object.keys(this._sectionPlanes);for(var t=0,s=e.length;t<s;t++)this.destroySectionPlane(e[t])}send(e,t){switch(e){case"snapshotStarting":for(let e in this._controls)this._controls.hasOwnProperty(e)&&this._controls[e].setCulled(!0);break;case"snapshotFinished":for(let e in this._controls)this._controls.hasOwnProperty(e)&&this._controls[e].setCulled(!1);break;case"clearSectionPlanes":this.clear()}}destroy(){this.clear(),this._overview&&this._overview.destroy(),this._destroyFreeControls(),super.destroy()}_destroyFreeControls(){for(var e=this._freeControls.pop();e;)e._destroy(),e=this._freeControls.pop();this.viewer.scene.off(this._onSceneSectionPlaneCreated)}}class _y extends n{constructor(e){super("skyboxes",e),this.skyboxes={}}send(e,t){if("clear"===e)this.clear()}createSkybox(e,t){if(this.viewer.scene.components[e])return this.error("Component with this ID already exists: "+e),this;var s=new Uc(this.viewer.scene,{id:e,pos:t.pos,dir:t.dir,active:!0});return this.skyboxes[e]=s,s}destroySkybox(e){var t=this.skyboxes[e];t?t.destroy():this.error("Skybox not found: "+e)}clear(){for(var e=Object.keys(this.viewer.scene.skyboxes),t=0,s=e.length;t<s;t++)this.destroySkybox(e[t])}destroy(){this.clear(),super.clear()}}class yy{getSTL(e,t,s){const i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t(i.response):s(i.statusText))},i.send(null)}}const vy=p.vec3();class by{load(e,t,s,i,r,o){i=i||{};const n=e.viewer.scene.canvas.spinner;n.processes++,e.dataSource.getSTL(s,(function(s){!function(e,t,s,i){try{const r=Iy(s);xy(r)?Py(e,r,t,i):Ty(e,My(s),t,i)}catch(e){t.fire("error",e)}}(e,t,s,i);try{const o=Iy(s);xy(o)?Py(e,o,t,i):Ty(e,My(s),t,i),n.processes--,C.scheduleTask((function(){t.fire("loaded",!0,!1)})),r&&r()}catch(s){n.processes--,e.error(s),o&&o(s),t.fire("error",s)}}),(function(s){n.processes--,e.error(s),o&&o(s),t.fire("error",s)}))}parse(e,t,s,i){const r=e.viewer.scene.canvas.spinner;r.processes++;try{const o=Iy(s);xy(o)?Py(e,o,t,i):Ty(e,My(s),t,i),r.processes--,C.scheduleTask((function(){t.fire("loaded",!0,!1)}))}catch(e){r.processes--,t.fire("error",e)}}}function xy(e){const t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;const s=[115,111,108,105,100];for(var i=0;i<5;i++)if(s[i]!==t.getUint8(i,!1))return!0;return!1}function Py(e,t,s,i){const r=new DataView(t),o=r.getUint32(80,!0);let n,a,h,l,u,c,p,d=!1,m=null,f=null,g=null,_=!1;for(let e=0;e<70;e++)1129270351===r.getUint32(e,!1)&&82===r.getUint8(e+4)&&61===r.getUint8(e+5)&&(d=!0,l=[],u=r.getUint8(e+6)/255,c=r.getUint8(e+7)/255,p=r.getUint8(e+8)/255,r.getUint8(e+9));const y=new gn(s,{roughness:.5});let v=[],b=[],x=i.splitMeshes;for(let e=0;e<o;e++){let t=84+50*e,o=r.getFloat32(t,!0),P=r.getFloat32(t+4,!0),T=r.getFloat32(t+8,!0);if(d){let e=r.getUint16(t+48,!0);0==(32768&e)?(n=(31&e)/31,a=(e>>5&31)/31,h=(e>>10&31)/31):(n=u,a=c,h=p),(x&&n!==m||a!==f||h!==g)&&(null!==m&&(_=!0),m=n,f=a,g=h)}for(let e=1;e<=3;e++){let s=t+12*e;v.push(r.getFloat32(s,!0)),v.push(r.getFloat32(s+4,!0)),v.push(r.getFloat32(s+8,!0)),b.push(o,P,T),d&&l.push(n,a,h,1)}x&&_&&(wy(s,v,b,l,y,i),v=[],b=[],l=l?[]:null,_=!1)}v.length>0&&wy(s,v,b,l,y,i)}function Ty(e,t,s,i){const r=/facet([\s\S]*?)endfacet/g;let o=0;const n=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,a=new RegExp("vertex"+n+n+n,"g"),h=new RegExp("normal"+n+n+n,"g"),l=[],u=[];let c,p,d,m,f,g,_;for(;null!==(m=r.exec(t));){for(f=0,g=0,_=m[0];null!==(m=h.exec(_));)c=parseFloat(m[1]),p=parseFloat(m[2]),d=parseFloat(m[3]),g++;for(;null!==(m=a.exec(_));)l.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3])),u.push(c,p,d),f++;1!==g&&e.error("Error in normal of face "+o),3!==f&&e.error("Error in positions of face "+o),o++}wy(s,l,u,null,new gn(s,{roughness:.5}),i)}function wy(e,t,s,i,r,o){const n=new Int32Array(t.length/3);for(let e=0,t=n.length;e<t;e++)n[e]=e;s=s&&s.length>0?s:null,i=i&&i.length>0?i:null,o.smoothNormals&&p.faceToVertexNormals(t,s,o);const a=vy;W(t,t,a);const h=new Mi(e,{primitive:"triangles",positions:t,normals:s,colors:i,indices:n}),l=new Ko(e,{origin:0!==a[0]||0!==a[1]||0!==a[2]?a:null,geometry:h,material:r,edges:o.edges});e.addChild(l)}function My(e){return"string"!=typeof e?function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let s=0,i=e.length;s<i;s++)t+=String.fromCharCode(e[s]);return decodeURIComponent(escape(t))}(new Uint8Array(e)):e}function Iy(e){if("string"==typeof e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=255&e.charCodeAt(s);return t.buffer||t}return e}class Cy extends n{constructor(e,t={}){super("STLLoader",e,t),this._sceneGraphLoader=new by,this.dataSource=t.dataSource}set dataSource(e){this._dataSource=e||new yy}get dataSource(){return this._dataSource}load(e){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new pn(this.viewer.scene,y.apply(e,{isModel:!0})),s=e.src,i=e.stl;return s||i?(s?this._sceneGraphLoader.load(this,t,s,e):this._sceneGraphLoader.parse(this,t,i,e),t):(this.error("load() param expected: either 'src' or 'stl'"),t)}}class Dy{constructor(e,t,s,i,r){this.plugin=e,this.storeyId=i,this.modelId=s,this.aabb=t.slice(),this.numObjects=r}}const Ay={IfcSlab:{visible:!0,edges:!1,colorize:[1,1,1,1]},IfcWall:{visible:!0,edges:!1,colorize:[.1,.1,.1,1]},IfcWallStandardCase:{visible:!0,edges:!1,colorize:[.1,.1,.1,1]},IfcDoor:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcWindow:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcColumn:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcCurtainWall:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcStair:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcStairFlight:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcRamp:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcFurniture:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcFooting:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcFloor:{visible:!0,edges:!1,colorize:[1,1,1,1]},DEFAULT:{visible:!1}};class Ey{constructor(e,t,s,i,r,o){this.storeyId=e,this.imageData=t,this.format=s,this.width=i,this.height=r}}const Fy=p.vec3(),Ry=p.mat4();class Sy extends n{constructor(e,t={}){super("StoreyViews",e),this._objectsMemento=new ka,this._cameraMemento=new Oa,this.storeys={},this.modelStoreys={},this.objectStates=t.objectStates,this._onModelLoaded=this.viewer.scene.on("modelLoaded",(e=>{this._registerModelStoreys(e),this.fire("storeys",this.storeys)}))}_registerModelStoreys(e){const t=this.viewer,s=t.scene,i=t.metaScene,r=i.metaModels[e],o=s.models[e];if(!r||!r.rootMetaObject)return;const n=r.rootMetaObject.getObjectIDsInSubtreeByType(["IfcBuildingStorey"]);for(let t=0,r=n.length;t<r;t++){const r=n[t],a=i.metaObjects[r].getObjectIDsInSubtree(),h=s.getAABB(a),l=Math.random()>.5?a.length:0,u=new Dy(this,h,e,r,l);u._onModelDestroyed=o.once("destroyed",(()=>{this._deregisterModelStoreys(e),this.fire("storeys",this.storeys)})),this.storeys[r]=u,this.modelStoreys[e]||(this.modelStoreys[e]={}),this.modelStoreys[e][r]=u}}_deregisterModelStoreys(e){const t=this.modelStoreys[e];if(t){const s=this.viewer.scene;for(let e in t)if(t.hasOwnProperty(e)){const i=t[e],r=s.models[i.modelId];r&&r.off(i._onModelDestroyed),delete this.storeys[e]}delete this.modelStoreys[e]}}set objectStates(e){this._objectStates=e||Ay}get objectStates(){return this._objectStates}gotoStoreyCamera(e,t={}){const s=this.storeys[e];if(!s)return this.error("IfcBuildingStorey not found with this ID: "+e),void(t.done&&t.done());const i=this.viewer,r=i.scene.camera,o=s.aabb;if(o[3]<o[0]||o[4]<o[1]||o[5]<o[2])return void(t.done&&t.done());if(o[3]===o[0]&&o[4]===o[1]&&o[5]===o[2])return void(t.done&&t.done());const n=p.getAABB3Center(o),a=p.getAABB3Diag(o),h=Math.abs(a/Math.tan(45*p.DEGTORAD)),l=1.3*a,u=Fy;u[0]=n[0]+r.worldUp[0]*h,u[1]=n[1]+r.worldUp[1]*h,u[2]=n[2]+r.worldUp[2]*h;const c=r.worldForward;t.done?i.cameraFlight.flyTo(y.apply(t,{eye:u,look:n,up:c,orthoScale:l}),(()=>{t.done()})):(i.cameraFlight.jumpTo(y.apply(t,{eye:u,look:n,up:c,orthoScale:l})),i.camera.ortho.scale=l)}showStoreyObjects(e,t={}){if(!this.storeys[e])return void this.error("IfcBuildingStorey not found with this ID: "+e);const s=this.viewer,i=s.scene;s.metaScene.metaObjects[e]&&(t.hideOthers&&i.setObjectsVisible(s.scene.visibleObjectIds,!1),this.withStoreyObjects(e,((e,s)=>{if(e)if(t.useObjectStates){const t=this._objectStates[s.type]||this._objectStates.DEFAULT;t&&(e.visible=t.visible,e.edges=t.edges,t.colorize&&(e.colorize=t.colorize),null!==t.opacity&&void 0!==t.opacity&&(e.opacity=t.opacity))}else e.visible=!0})))}withStoreyObjects(e,t){const s=this.viewer,i=s.scene,r=s.metaScene,o=r.metaObjects[e];if(!o)return;const n=o.getObjectIDsInSubtree();for(var a=0,h=n.length;a<h;a++){const e=n[a],s=r.metaObjects[e],o=i.objects[e];o&&t(o,s)}}createStoreyMap(e,t={}){const s=this.storeys[e];if(!s)return this.error("IfcBuildingStorey not found with this ID: "+e),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==";const i=this.viewer,r=i.scene,o=t.format||"png",n=s.aabb,a=(n[5]-n[2])/(n[3]-n[0]),h=t.padding||0;let l,u;t.width&&t.height?(l=t.width,u=t.height):t.height?(u=t.height,l=u/a):t.width?(l=t.width,u=l*a):(l=300,u=l*a),this._objectsMemento.saveObjects(r),this._cameraMemento.saveCamera(r),i.beginSnapshot(),this.showStoreyObjects(e,y.apply(t,{useObjectStates:!0,hideOthers:!0})),this._arrangeStoreyMapCamera(s);const c=i.getSnapshot({width:l,height:u,format:o});return this._objectsMemento.restoreObjects(r),this._cameraMemento.restoreCamera(r),i.endSnapshot(),new Ey(e,c,o,l,u,h)}_arrangeStoreyMapCamera(e){const t=this.viewer,s=t.scene.camera,i=e.aabb,r=p.getAABB3Center(i),o=Fy;o[0]=r[0]+.5*s.worldUp[0],o[1]=r[1]+.5*s.worldUp[1],o[2]=r[2]+.5*s.worldUp[2];const n=s.worldForward;t.cameraFlight.jumpTo({eye:o,look:r,up:n});const a=(i[3]-i[0])/2,h=(i[4]-i[1])/2,l=(i[5]-i[2])/2,u=-a,c=+a,d=-h,m=+h,f=-l,g=+l;t.camera.customProjection.matrix=p.orthoMat4c(u,c,f,g,d,m,Ry),t.camera.projection="customProjection"}pickStoreyMap(e,t,s={}){const i=e.storeyId,r=this.storeys[i];if(!r)return this.error("IfcBuildingStorey not found with this ID: "+i),null;const o=1-t[0]/e.width,n=1-t[1]/e.height,a=r.aabb,h=a[0],l=a[1],u=a[2],c=a[3]-h,d=a[4]-l,m=a[5]-u,f=p.vec3([h+c*o,l+.5*d,u+m*n]),g=p.vec3([0,-1,0]),_=p.addVec3(f,g,Fy),y=this.viewer.camera.worldForward,v=p.lookAtMat4v(f,_,y,Ry),b=this.viewer.scene.pick({pickSurface:s.pickSurface,pickInvisible:!0,matrix:v});if(b){const e=this.viewer.metaScene.metaObjects[b.entity.id],t=this.objectStates[e.type];if(!t||!t.visible)return null}return b}getStoreyContainingWorldPos(e){for(var t in this.storeys){const s=this.storeys[t];if(p.point3AABB3Intersect(s.aabb,e))return t}return null}worldPosToStoreyMap(e,t,s){const i=e.storeyId,r=this.storeys[i];if(!r)return this.error("IfcBuildingStorey not found with this ID: "+i),!1;const o=r.aabb,n=o[0],a=o[1],h=o[2],l=o[3]-n,u=o[4]-a,c=o[5]-h,p=this.viewer.camera.worldUp,d=p[0]>p[1]&&p[0]>p[2],m=!d&&p[1]>p[0]&&p[1]>p[2];!d&&!m&&p[2]>p[0]&&(p[2],p[1]);const f=e.width/l,g=m?e.height/c:e.height/u;return s[0]=Math.floor(e.width-(t[0]-n)*f),s[1]=Math.floor(e.height-(t[2]-h)*g),s[0]>=0&&s[0]<e.width&&s[1]>=0&&s[1]<=e.height}worldDirToStoreyMap(e,t,s){const i=this.viewer.camera,r=i.eye,o=i.look,n=p.subVec3(o,r,Fy),a=i.worldUp,h=a[0]>a[1]&&a[0]>a[2],l=!h&&a[1]>a[0]&&a[1]>a[2];!h&&!l&&a[2]>a[0]&&(a[2],a[1]),h?(s[0]=n[1],s[1]=n[2]):l?(s[0]=n[0],s[1]=n[2]):(s[0]=n[0],s[1]=n[1]),p.normalizeVec2(s)}destroy(){this.viewer.scene.off(this._onModelLoaded),super.destroy()}}const Oy=[];class By extends n{constructor(e,t={}){if(super("TreeViewPlugin",e),this.errors=[],this.valid=!0,t.containerElement){for(let e=0;;e++)if(!Oy[e]){Oy[e]=this,this._index=e,this._id=`tree-${e}`;break}if(this._containerElement=t.containerElement,this._metaModels={},this._autoAddModels=!1!==t.autoAddModels,this._autoExpandDepth=t.autoExpandDepth||0,this._sortNodes=!1!==t.sortNodes,this._pruneEmptyNodes=!1!==t.pruneEmptyNodes,this._viewer=e,this._rootElement=null,this._muteSceneEvents=!1,this._muteTreeEvents=!1,this._rootNodes=[],this._objectNodes={},this._nodeNodes={},this._rootName=t.rootName,this._sortNodes=t.sortNodes,this._pruneEmptyNodes=t.pruneEmptyNodes,this._showListItemElementId=null,this._containerElement.oncontextmenu=e=>{e.preventDefault()},this._onObjectVisibility=this._viewer.scene.on("objectVisibility",(e=>{if(this._muteSceneEvents)return;const t=e.id,s=this._objectNodes[t];if(!s)return;const i=e.visible;if(!(i!==s.checked))return;this._muteTreeEvents=!0,s.checked=i,i?s.numVisibleEntities++:s.numVisibleEntities--;const r=document.getElementById(`checkbox-${s.nodeId}`);r&&(r.checked=i);let o=s.parent;for(;o;){o.checked=i,i?o.numVisibleEntities++:o.numVisibleEntities--;const e=document.getElementById(`checkbox-${o.nodeId}`);if(e){const t=o.numVisibleEntities>0;t!==e.checked&&(e.checked=t)}o=o.parent}this._muteTreeEvents=!1})),this._onObjectXrayed=this._viewer.scene.on("objectXRayed",(e=>{if(this._muteSceneEvents)return;const t=e.id,s=this._objectNodes[t];if(!s)return;this._muteTreeEvents=!0;const i=e.xrayed;if(!(i!==s.xrayed))return;s.xrayed=i;const r=s.nodeId,o=document.getElementById(r);null!==o&&(i?o.classList.add("xrayed-node"):o.classList.remove("xrayed-node")),this._muteTreeEvents=!1})),this._switchExpandHandler=e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this._expandSwitchElement(t)},this._switchCollapseHandler=e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this._collapseSwitchElement(t)},this._checkboxChangeHandler=e=>{if(this._muteTreeEvents)return;this._muteSceneEvents=!0;const t=e.target,s=t.checked,i=t.id.replace("checkbox-",""),r=this._nodeNodes[i],o=this._viewer.scene.objects;let n=0;this._withNodeTree(r,(e=>{const t=e.objectId,i=`checkbox-${e.nodeId}`,r=o[t],a=0===e.children.length;e.numVisibleEntities=s?e.numEntities:0,a&&s!==e.checked&&n++,e.checked=s;const h=document.getElementById(i);h&&(h.checked=s),r&&(r.visible=s)}));let a=r.parent;for(;a;){a.checked=s;const e=document.getElementById(`checkbox-${a.nodeId}`);s?a.numVisibleEntities+=n:a.numVisibleEntities-=n;const t=a.numVisibleEntities>0;t!==e.checked&&(e.checked=t),a=a.parent}this._muteSceneEvents=!1},this._hierarchy=t.hierarchy||"containment",this._autoExpandDepth=t.autoExpandDepth||0,this._autoAddModels){const e=Object.keys(this.viewer.metaScene.metaModels);for(let t=0,s=e.length;t<s;t++){const s=e[t];this.addModel(s)}this.viewer.scene.on("modelLoaded",(e=>{this.viewer.metaScene.metaModels[e]&&this.addModel(e)}))}this.hierarchy=t.hierarchy}else this.error("Config expected: containerElement")}set hierarchy(e){"containment"!==(e=e||"containment")&&"storeys"!==e&&"types"!==e&&(this.error("Unsupported value for `hierarchy' - defaulting to 'containment'"),e="containment"),this._hierarchy!==e&&(this._hierarchy=e,this._createNodes())}get hierarchy(){return this._hierarchy}addModel(e,t={}){if(!this._containerElement)return;const s=this.viewer.scene.models[e];if(!s)throw"Model not found: "+e;const i=this.viewer.metaScene.metaModels[e];i?this._metaModels[e]?this.warn("Model already added: "+e):(this._metaModels[e]=i,s.on("destroyed",(()=>{this.removeModel(s.id)})),this._createNodes()):this.error("MetaModel not found: "+e)}removeModel(e){if(!this._containerElement)return;this._metaModels[e]&&(delete this._metaModels[e],this._createNodes())}showNode(e){this._showListItemElementId&&this.unShowNode();const t=this._objectNodes[e];if(!t)return;const s=t.nodeId,i="switch-"+s,r=document.getElementById(i);if(r)return this._expandSwitchElement(r),void r.scrollIntoView();const o=[];o.unshift(t);let n=t.parent;for(;n;)o.unshift(n),n=n.parent;for(let e=0,t=o.length;e<t;e++){const t="switch-"+o[e].nodeId,s=document.getElementById(t);s&&this._expandSwitchElement(s)}const a=s,h=document.getElementById(a);h.scrollIntoView({block:"center"}),h.classList.add("highlighted-node"),this._showListItemElementId=a}unShowNode(){if(!this._showListItemElementId)return;const e=document.getElementById(this._showListItemElementId);e?(e.classList.remove("highlighted-node"),this._showListItemElementId=null):this._showListItemElementId=null}expandToDepth(e){this.collapse();const t=(s,i)=>{if(i===e)return;const r="switch-"+s.nodeId,o=document.getElementById(r);if(o){this._expandSwitchElement(o);const e=s.children;for(var n=0,a=e.length;n<a;n++){const s=e[n];t(s,i+1)}}};for(let e=0,s=this._rootNodes.length;e<s;e++){const s=this._rootNodes[e];t(s,0)}}collapse(){for(let e=0,t=this._rootNodes.length;e<t;e++){const t=this._rootNodes[e].objectId;this._collapseNode(t)}}withNodeTree(e,t){t(e);const s=e.children;if(s)for(let e=0,i=s.length;e<i;e++)this.withNodeTree(s[e],t)}destroy(){this._containerElement&&(this._metaModels={},this._rootElement&&!this._destroyed&&(this._rootElement.parentNode.removeChild(this._rootElement),this._viewer.scene.off(this._onObjectVisibility),this._destroyed=!0),delete Oy[this._index],super.destroy())}_createNodes(){this._rootElement&&(this._rootElement.parentNode.removeChild(this._rootElement),this._rootElement=null),this._rootNodes=[],this._objectNodes={},this._nodeNodes={},this._validate(),this.valid||"storeys"!==this._hierarchy?this._createEnabledNodes():this._createDisabledNodes()}_validate(){if(this.errors=[],"storeys"===this._hierarchy)this.valid=this._validateMetaModelForStoreysHierarchy();else this.valid=this._rootNodes.length>0;return this.valid}_validateMetaModelForStoreysHierarchy(e=0,t,s){return!0}_createEnabledNodes(){switch(this._pruneEmptyNodes&&this._findEmptyNodes(),this._hierarchy){case"storeys":this._createStoreysNodes(),0===this._rootNodes.length&&this.error("Failed to build storeys hierarchy");break;case"types":this._createTypesNodes();break;default:this._createContainmentNodes()}this._sortNodes&&this._doSortNodes(),this._synchNodesToEntities(),this._createTrees(),this.expandToDepth(this._autoExpandDepth)}_createDisabledNodes(){const e=document.createElement("ul");this._rootElement=e,this._containerElement.appendChild(e);const t=this._viewer.metaScene.rootMetaObjects;for(let s in t){const i=t[s],r=i.type,o=i.name,n=o&&""!==o&&"Undefined"!==o&&"Default"!==o?o:r,a=document.createElement("li");e.appendChild(a);const h=document.createElement("a");h.href="#",h.textContent="!",h.classList.add("warn"),h.classList.add("warning"),a.appendChild(h);const l=document.createElement("span");l.textContent=n,a.appendChild(l)}}_findEmptyNodes(){const e=this._viewer.metaScene.rootMetaObjects;for(let t in e)this._findEmptyNodes2(e[t])}_findEmptyNodes2(e,t=0){const s=this.viewer.scene,i=e.children,r=e.id,o=s.objects[r];if(e._countEntities=0,o&&e._countEntities++,i)for(let t=0,s=i.length;t<s;t++){const s=i[t];s._countEntities=this._findEmptyNodes2(s),e._countEntities+=s._countEntities}return e._countEntities}_createStoreysNodes(){const e=this._viewer.metaScene.rootMetaObjects;for(let t in e)this._createStoreysNodes2(e[t],null,null,null)}_createStoreysNodes2(e,t,s,i){if(this._pruneEmptyNodes&&0===e._countEntities)return;const r=e.type,o=e.name,n=e.children,a=e.id;if("IfcBuilding"===r)t={nodeId:`${this._id}-${a}`,objectId:a,title:this._rootName||(o&&""!==o&&"Undefined"!==o&&"Default"!==o?o:r),type:r,parent:null,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},this._rootNodes.push(t),this._objectNodes[t.objectId]=t,this._nodeNodes[t.nodeId]=t;else if("IfcBuildingStorey"===r){if(!t)return void this.error("Failed to build storeys hierarchy for model '"+this.metaModel.id+"' - model does not have an IfcBuilding object, or is not an IFC model");s={nodeId:`${this._id}-${a}`,objectId:a,title:o&&""!==o&&"Undefined"!==o&&"Default"!==o?o:r,type:r,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},t.children.push(s),this._objectNodes[s.objectId]=s,this._nodeNodes[s.nodeId]=s,i={}}else if(s){if(this._viewer.scene.objects[a]){let e=(i=i||{})[r];e||(e={nodeId:`${this._id}-${s.objectId}-${r}`,objectId:`${s.objectId}-${r}`,title:r,type:r,parent:s,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},s.children.push(e),this._objectNodes[e.objectId]=e,this._nodeNodes[e.nodeId]=e,i[r]=e);const t={nodeId:`${this._id}-${a}`,objectId:a,title:o&&""!==o&&"Undefined"!==o&&"Default"!==o?o:r,type:r,parent:e,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]};e.children.push(t),this._objectNodes[t.objectId]=t,this._nodeNodes[t.nodeId]=t}}if(n)for(let e=0,r=n.length;e<r;e++){const r=n[e];this._createStoreysNodes2(r,t,s,i)}}_createTypesNodes(){const e=this._viewer.metaScene.rootMetaObjects;for(let t in e)this._createTypesNodes2(e[t],null,null)}_createTypesNodes2(e,t,s){if(this._pruneEmptyNodes&&0===e._countEntities)return;const i=e.type,r=e.name,o=e.children,n=e.id;if(e.parent){if(t){if(this._viewer.scene.objects[n]){let e=s[i];e||(e={nodeId:`${this._id}-${t.objectId}-${i}`,objectId:`${t.objectId}-${i}`,title:i,type:i,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},t.children.push(e),this._objectNodes[e.objectId]=e,this._nodeNodes[e.nodeId]=e,s[i]=e);const o={nodeId:`${this._id}-${n}`,objectId:n,title:r&&""!==r&&"Default"!==r?r:i,type:i,parent:e,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]};e.children.push(o),this._objectNodes[o.objectId]=o,this._nodeNodes[o.nodeId]=o}}}else t={nodeId:`${this._id}-${n}`,objectId:n,title:this._rootName||(r&&""!==r&&"Undefined"!==r&&"Default"!==r?r:i),type:i,parent:null,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},this._rootNodes.push(t),this._objectNodes[t.objectId]=t,this._nodeNodes[t.nodeId]=t,s={};if(o)for(let e=0,i=o.length;e<i;e++){const i=o[e];this._createTypesNodes2(i,t,s)}}_createContainmentNodes(){const e=this._viewer.metaScene.rootMetaObjects;for(let t in e)this._createContainmentNodes2(e[t],null)}_createContainmentNodes2(e,t){if(this._pruneEmptyNodes&&0===e._countEntities)return;const s=e.type,i=e.name||s,r=e.children,o=e.id,n={nodeId:`${this._id}-${o}`,objectId:o,title:t?i&&""!==i&&"Undefined"!==i&&"Default"!==i?i:s:this._rootName||i,type:s,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]};if(t?t.children.push(n):this._rootNodes.push(n),this._objectNodes[n.objectId]=n,this._nodeNodes[n.nodeId]=n,r)for(let e=0,t=r.length;e<t;e++){const t=r[e];this._createContainmentNodes2(t,n)}}_doSortNodes(){for(let e=0,t=this._rootNodes.length;e<t;e++){const t=this._rootNodes[e];this._sortChildren(t)}}_sortChildren(e){const t=e.children;if(t&&0!==t.length){"storeys"===this._hierarchy&&"IfcBuilding"===e.type?t.sort(this._getSpatialSortFunc()):t.sort(this._alphaSortFunc);for(let e=0,s=t.length;e<s;e++){const s=t[e];this._sortChildren(s)}}}_getSpatialSortFunc(){const e=this.viewer,t=e.scene,s=t.camera,i=e.metaScene;return this._spatialSortFunc||(this._spatialSortFunc=(e,r)=>{e.aabb&&r.aabb||(e.aabb||(e.aabb=t.getAABB(i.getObjectIDsInSubtree(e.objectId))),r.aabb||(r.aabb=t.getAABB(i.getObjectIDsInSubtree(r.objectId))));let o=0;return o=s.xUp?0:s.yUp?1:2,e.aabb[o]>r.aabb[o]?-1:e.aabb[o]<r.aabb[o]?1:0})}_alphaSortFunc(e,t){const s=e.title.toUpperCase(),i=t.title.toUpperCase();return s<i?-1:s>i?1:0}_synchNodesToEntities(){const e=Object.keys(this.viewer.metaScene.metaObjects),t=this._viewer.metaScene.metaObjects,s=this._viewer.scene.objects;for(let i=0,r=e.length;i<r;i++){const r=e[i];if(t[r]){const e=this._objectNodes[r];if(e){const t=s[r];if(t){const s=t.visible;e.numEntities=1,e.xrayed=t.xrayed,s?(e.numVisibleEntities=1,e.checked=!0):(e.numVisibleEntities=0,e.checked=!1);let i=e.parent;for(;i;)i.numEntities++,s&&(i.numVisibleEntities++,i.checked=!0),i=i.parent}}}}}_withNodeTree(e,t){t(e);const s=e.children;if(s)for(let e=0,i=s.length;e<i;e++)this._withNodeTree(s[e],t)}_createTrees(){if(0===this._rootNodes.length)return;const e=this._rootNodes.map((e=>this._createNodeElement(e))),t=document.createElement("ul");e.forEach((e=>{t.appendChild(e)})),this._containerElement.appendChild(t),this._rootElement=t}_createNodeElement(e){const t=document.createElement("li"),s=e.nodeId;if(e.xrayed&&t.classList.add("xrayed-node"),t.id=s,e.children.length>0){const e="switch-"+s,i=document.createElement("a");i.href="#",i.id=e,i.textContent="+",i.classList.add("plus"),i.addEventListener("click",this._switchExpandHandler),t.appendChild(i)}const i=document.createElement("input");i.id=`checkbox-${s}`,i.type="checkbox",i.checked=e.checked,i.style["pointer-events"]="all",i.addEventListener("change",this._checkboxChangeHandler),t.appendChild(i);const r=document.createElement("span");return r.textContent=e.title,t.appendChild(r),r.oncontextmenu=t=>{this.fire("contextmenu",{event:t,viewer:this._viewer,treeViewPlugin:this,treeViewNode:e}),t.preventDefault()},r.onclick=t=>{this.fire("nodeTitleClicked",{event:t,viewer:this._viewer,treeViewPlugin:this,treeViewNode:e}),t.preventDefault()},t}_expandSwitchElement(e){const t=e.parentElement;if(t.getElementsByTagName("li")[0])return;const s=t.id,i=this._nodeNodes[s].children.map((e=>this._createNodeElement(e))),r=document.createElement("ul");i.forEach((e=>{r.appendChild(e)})),t.appendChild(r),e.classList.remove("plus"),e.classList.add("minus"),e.textContent="-",e.removeEventListener("click",this._switchExpandHandler),e.addEventListener("click",this._switchCollapseHandler)}_collapseNode(e){const t="switch-"+e,s=document.getElementById(t);this._collapseSwitchElement(s)}_collapseSwitchElement(e){if(!e)return;const t=e.parentElement;if(!t)return;const s=t.querySelector("ul");s&&(t.removeChild(s),e.classList.remove("minus"),e.classList.add("plus"),e.textContent="+",e.removeEventListener("click",this._switchCollapseHandler),e.addEventListener("click",this._switchExpandHandler))}}class Ly{constructor(e){this._scene=e,this._objects=[],this._objectsViewCulled=[],this._objectsDetailCulled=[],this._objectsChanged=[],this._objectsChangedList=[],this._modelInfos={},this._numObjects=0,this._lenObjectsChangedList=0,this._dirty=!0,this._onModelLoaded=e.on("modelLoaded",(t=>{const s=e.models[t];s&&this._addModel(s)})),this._onTick=e.on("tick",(()=>{this._dirty&&this._build(),this._applyChanges()}))}_addModel(e){const t={model:e,onDestroyed:e.on("destroyed",(()=>{this._removeModel(e)}))};this._modelInfos[e.id]=t,this._dirty=!0}_removeModel(e){const t=this._modelInfos[e.id];t&&(t.model.off(t.onDestroyed),delete this._modelInfos[e.id],this._dirty=!0)}_build(){if(!this._dirty)return;this._applyChanges();const e=this._scene.objects;for(let e=0;e<this._numObjects;e++)this._objects[e]=null;this._numObjects=0;for(let t in e){const s=e[t];this._objects[this._numObjects++]=s}this._lenObjectsChangedList=0,this._dirty=!1}_applyChanges(){if(this._lenObjectsChangedList>0){for(let e=0;e<this._lenObjectsChangedList;e++){const t=this._objectsChangedList[e],s=this._objects[t],i=this._objectsViewCulled[t],r=this._objectsDetailCulled[t],o=i||r;s.culled=o,this._objectsChanged[t]=!1}this._lenObjectsChangedList=0}}get objects(){return this._dirty&&this._build(),this._objects}get numObjects(){return this._dirty&&this._build(),this._numObjects}setObjectViewCulled(e,t){this._dirty&&this._build(),this._objectsViewCulled[e]!==t&&(this._objectsViewCulled[e]=t,this._objectsChanged[e]||(this._objectsChanged[e]=!0,this._objectsChangedList[this._lenObjectsChangedList++]=e))}setObjectDetailCulled(e,t){this._dirty&&this._build(),this._objectsDetailCulled[e]!==t&&(this._objectsDetailCulled[e]=t,this._objectsChanged[e]||(this._objectsChanged[e]=!0,this._objectsChangedList[this._lenObjectsChangedList++]=e))}_destroy(){this._clear(),this._scene.off(this._onModelLoaded),this._scene.off(this._onTick)}_clear(){for(let e in this._modelInfos){const t=this._modelInfos[e];t.model.off(t.onDestroyed)}this._modelInfos={},this._dirty=!0}}const Ny={};const ky=new Float32Array(3);class jy extends n{constructor(e,t={}){super("ViewCull",e),this._objectCullStates=function(e){const t=e.id;let s=Ny[t];return s||(s=new Ly(e),Ny[t]=s,e.on("destroyed",(()=>{delete Ny[t],s._destroy()}))),s}(e.scene),this._maxTreeDepth=t.maxTreeDepth||8,this._modelInfos={},this._frustum=new Fa,this._kdRoot=null,this._frustumDirty=!1,this._kdTreeDirty=!1,this._onViewMatrix=e.scene.camera.on("viewMatrix",(()=>{this._frustumDirty=!0})),this._onProjMatrix=e.scene.camera.on("projMatMatrix",(()=>{this._frustumDirty=!0})),this._onModelLoaded=e.scene.on("modelLoaded",(e=>{const t=this.viewer.scene.models[e];t&&this._addModel(t)})),this._onSceneTick=e.scene.on("tick",(()=>{this._doCull()}))}set enabled(e){this._enabled=e}get enabled(){return this._enabled}_addModel(e){const t={model:e,onDestroyed:e.on("destroyed",(()=>{this._removeModel(e)}))};this._modelInfos[e.id]=t,this._kdTreeDirty=!0}_removeModel(e){const t=this._modelInfos[e.id];t&&(t.model.off(t.onDestroyed),delete this._modelInfos[e.id],this._kdTreeDirty=!0)}_doCull(){const e=this._frustumDirty||this._kdTreeDirty;if(this._frustumDirty&&this._buildFrustum(),this._kdTreeDirty&&this._buildKDTree(),e){const e=this._kdRoot;e&&this._visitKDNode(e)}}_buildFrustum(){const e=this.viewer.scene.camera;Ra(this._frustum,e.viewMatrix,e.projMatrix),this._frustumDirty=!1}_buildKDTree(){const e=this.viewer.scene;this._kdRoot,this._kdRoot={aabb:e.getAABB(),intersection:Fa.INTERSECT};for(let e=0,t=this._objectCullStates.numObjects;e<t;e++){const t=this._objectCullStates.objects[e];this._insertEntityIntoKDTree(this._kdRoot,t,e,1)}this._kdTreeDirty=!1}_insertEntityIntoKDTree(e,t,s,i){const r=t.aabb;if(i>=this._maxTreeDepth)return e.objects=e.objects||[],e.objects.push(s),void p.expandAABB3(e.aabb,r);if(e.left&&p.containsAABB3(e.left.aabb,r))return void this._insertEntityIntoKDTree(e.left,t,s,i+1);if(e.right&&p.containsAABB3(e.right.aabb,r))return void this._insertEntityIntoKDTree(e.right,t,s,i+1);const o=e.aabb;ky[0]=o[3]-o[0],ky[1]=o[4]-o[1],ky[2]=o[5]-o[2];let n=0;if(ky[1]>ky[n]&&(n=1),ky[2]>ky[n]&&(n=2),!e.left){const a=o.slice();if(a[n+3]=(o[n]+o[n+3])/2,e.left={aabb:a,intersection:Fa.INTERSECT},p.containsAABB3(a,r))return void this._insertEntityIntoKDTree(e.left,t,s,i+1)}if(!e.right){const a=o.slice();if(a[n]=(o[n]+o[n+3])/2,e.right={aabb:a,intersection:Fa.INTERSECT},p.containsAABB3(a,r))return void this._insertEntityIntoKDTree(e.right,t,s,i+1)}e.objects=e.objects||[],e.objects.push(s),p.expandAABB3(e.aabb,r)}_visitKDNode(e,t=Fa.INTERSECT){if(t!==Fa.INTERSECT&&e.intersects===t)return;t===Fa.INTERSECT&&(t=Sa(this._frustum,e.aabb),e.intersects=t);const s=t===Fa.OUTSIDE,i=e.objects;if(i&&i.length>0)for(let e=0,t=i.length;e<t;e++){const t=i[e];this._objectCullStates.setObjectViewCulled(t,s)}e.left&&this._visitKDNode(e.left,t),e.right&&this._visitKDNode(e.right,t)}send(e,t){}destroy(){super.destroy(),this._clear();const e=this.viewer.scene,t=e.camera;e.off(this._onModelLoaded),e.off(this._onSceneTick),t.off(this._onViewMatrix),t.off(this._onProjMatrix)}_clear(){for(let e in this._modelInfos){const t=this._modelInfos[e];t.model.off(t.onDestroyed)}this._modelInfos={},this._kdRoot=null,this._kdTreeDirty=!0}}class Gy{constructor(){}getMetaModel(e,t,s){y.loadJSON(e,(e=>{t(e)}),(function(e){s(e)}))}getXKT(e,t,s){var i=()=>{};t=t||i,s=s||i;const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const e=!!r[2];var o=r[3];o=window.decodeURIComponent(o),e&&(o=window.atob(o));try{const e=new ArrayBuffer(o.length),s=new Uint8Array(e);for(var n=0;n<o.length;n++)s[n]=o.charCodeAt(n);t(e)}catch(e){s(e)}}else{const i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t(i.response):s("getXKT error : "+i.response))},i.send(null)}}}
/*! pako 2.0.4 https://github.com/nodeca/pako @license (MIT AND Zlib) */!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).pako={})}(void 0,(function(e){function t(e){let t=e.length;for(;--t>=0;)e[t]=0}const s=256,i=286,r=30,o=15,n=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),a=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),l=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u=new Array(576);t(u);const c=new Array(60);t(c);const p=new Array(512);t(p);const d=new Array(256);t(d);const m=new Array(29);t(m);const f=new Array(r);function g(e,t,s,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=s,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}let _,y,v;function b(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(f);const x=e=>e<256?p[e]:p[256+(e>>>7)],P=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},T=(e,t,s)=>{e.bi_valid>16-s?(e.bi_buf|=t<<e.bi_valid&65535,P(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=s)},w=(e,t,s)=>{T(e,s[2*t],s[2*t+1])},M=(e,t)=>{let s=0;do{s|=1&e,e>>>=1,s<<=1}while(--t>0);return s>>>1},I=(e,t,s)=>{const i=new Array(16);let r,n,a=0;for(r=1;r<=o;r++)i[r]=a=a+s[r-1]<<1;for(n=0;n<=t;n++){let t=e[2*n+1];0!==t&&(e[2*n]=M(i[t]++,t))}},C=e=>{let t;for(t=0;t<i;t++)e.dyn_ltree[2*t]=0;for(t=0;t<r;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},D=e=>{e.bi_valid>8?P(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},A=(e,t,s,i)=>{const r=2*t,o=2*s;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[s]},E=(e,t,s)=>{const i=e.heap[s];let r=s<<1;for(;r<=e.heap_len&&(r<e.heap_len&&A(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!A(t,i,e.heap[r],e.depth));)e.heap[s]=e.heap[r],s=r,r<<=1;e.heap[s]=i},F=(e,t,i)=>{let r,o,h,l,u=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*u]<<8|e.pending_buf[e.d_buf+2*u+1],o=e.pending_buf[e.l_buf+u],u++,0===r?w(e,o,t):(h=d[o],w(e,h+s+1,t),l=n[h],0!==l&&(o-=m[h],T(e,o,l)),r--,h=x(r),w(e,h,i),l=a[h],0!==l&&(r-=f[h],T(e,r,l)))}while(u<e.last_lit);w(e,256,t)},R=(e,t)=>{const s=t.dyn_tree,i=t.stat_desc.static_tree,r=t.stat_desc.has_stree,n=t.stat_desc.elems;let a,h,l,u=-1;for(e.heap_len=0,e.heap_max=573,a=0;a<n;a++)0!==s[2*a]?(e.heap[++e.heap_len]=u=a,e.depth[a]=0):s[2*a+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=u<2?++u:0,s[2*l]=1,e.depth[l]=0,e.opt_len--,r&&(e.static_len-=i[2*l+1]);for(t.max_code=u,a=e.heap_len>>1;a>=1;a--)E(e,s,a);l=n;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],E(e,s,1),h=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=h,s[2*l]=s[2*a]+s[2*h],e.depth[l]=(e.depth[a]>=e.depth[h]?e.depth[a]:e.depth[h])+1,s[2*a+1]=s[2*h+1]=l,e.heap[1]=l++,E(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const s=t.dyn_tree,i=t.max_code,r=t.stat_desc.static_tree,n=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,l=t.stat_desc.max_length;let u,c,p,d,m,f,g=0;for(d=0;d<=o;d++)e.bl_count[d]=0;for(s[2*e.heap[e.heap_max]+1]=0,u=e.heap_max+1;u<573;u++)c=e.heap[u],d=s[2*s[2*c+1]+1]+1,d>l&&(d=l,g++),s[2*c+1]=d,c>i||(e.bl_count[d]++,m=0,c>=h&&(m=a[c-h]),f=s[2*c],e.opt_len+=f*(d+m),n&&(e.static_len+=f*(r[2*c+1]+m)));if(0!==g){do{for(d=l-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[l]--,g-=2}while(g>0);for(d=l;0!==d;d--)for(c=e.bl_count[d];0!==c;)p=e.heap[--u],p>i||(s[2*p+1]!==d&&(e.opt_len+=(d-s[2*p+1])*s[2*p],s[2*p+1]=d),c--)}})(e,t),I(s,u,e.bl_count)},S=(e,t,s)=>{let i,r,o=-1,n=t[1],a=0,h=7,l=4;for(0===n&&(h=138,l=3),t[2*(s+1)+1]=65535,i=0;i<=s;i++)r=n,n=t[2*(i+1)+1],++a<h&&r===n||(a<l?e.bl_tree[2*r]+=a:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,o=r,0===n?(h=138,l=3):r===n?(h=6,l=3):(h=7,l=4))},O=(e,t,s)=>{let i,r,o=-1,n=t[1],a=0,h=7,l=4;for(0===n&&(h=138,l=3),i=0;i<=s;i++)if(r=n,n=t[2*(i+1)+1],!(++a<h&&r===n)){if(a<l)do{w(e,r,e.bl_tree)}while(0!=--a);else 0!==r?(r!==o&&(w(e,r,e.bl_tree),a--),w(e,16,e.bl_tree),T(e,a-3,2)):a<=10?(w(e,17,e.bl_tree),T(e,a-3,3)):(w(e,18,e.bl_tree),T(e,a-11,7));a=0,o=r,0===n?(h=138,l=3):r===n?(h=6,l=3):(h=7,l=4)}};let B=!1;const L=(e,t,s,i)=>{T(e,0+(i?1:0),3),((e,t,s,i)=>{D(e),i&&(P(e,s),P(e,~s)),e.pending_buf.set(e.window.subarray(t,t+s),e.pending),e.pending+=s})(e,t,s,!0)};var N=e=>{B||((()=>{let e,t,s,l,b;const x=new Array(16);for(s=0,l=0;l<28;l++)for(m[l]=s,e=0;e<1<<n[l];e++)d[s++]=l;for(d[s-1]=l,b=0,l=0;l<16;l++)for(f[l]=b,e=0;e<1<<a[l];e++)p[b++]=l;for(b>>=7;l<r;l++)for(f[l]=b<<7,e=0;e<1<<a[l]-7;e++)p[256+b++]=l;for(t=0;t<=o;t++)x[t]=0;for(e=0;e<=143;)u[2*e+1]=8,e++,x[8]++;for(;e<=255;)u[2*e+1]=9,e++,x[9]++;for(;e<=279;)u[2*e+1]=7,e++,x[7]++;for(;e<=287;)u[2*e+1]=8,e++,x[8]++;for(I(u,287,x),e=0;e<r;e++)c[2*e+1]=5,c[2*e]=M(e,5);_=new g(u,n,257,i,o),y=new g(c,a,0,r,o),v=new g(new Array(0),h,0,19,7)})(),B=!0),e.l_desc=new b(e.dyn_ltree,_),e.d_desc=new b(e.dyn_dtree,y),e.bl_desc=new b(e.bl_tree,v),e.bi_buf=0,e.bi_valid=0,C(e)},k=(e,t,i,r)=>{let o,n,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<s;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),R(e,e.l_desc),R(e,e.d_desc),a=(e=>{let t;for(S(e,e.dyn_ltree,e.l_desc.max_code),S(e,e.dyn_dtree,e.d_desc.max_code),R(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*l[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),o=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=o&&(o=n)):o=n=i+5,i+4<=o&&-1!==t?L(e,t,i,r):4===e.strategy||n===o?(T(e,2+(r?1:0),3),F(e,u,c)):(T(e,4+(r?1:0),3),((e,t,s,i)=>{let r;for(T(e,t-257,5),T(e,s-1,5),T(e,i-4,4),r=0;r<i;r++)T(e,e.bl_tree[2*l[r]+1],3);O(e,e.dyn_ltree,t-1),O(e,e.dyn_dtree,s-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),F(e,e.dyn_ltree,e.dyn_dtree)),C(e),r&&D(e)},j=(e,t,i)=>(e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(d[i]+s+1)]++,e.dyn_dtree[2*x(t)]++),e.last_lit===e.lit_bufsize-1),G=e=>{T(e,2,3),w(e,256,u),(e=>{16===e.bi_valid?(P(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},H={_tr_init:N,_tr_stored_block:L,_tr_flush_block:k,_tr_tally:j,_tr_align:G};var V=(e,t,s,i)=>{let r=65535&e|0,o=e>>>16&65535|0,n=0;for(;0!==s;){n=s>2e3?2e3:s,s-=n;do{r=r+t[i++]|0,o=o+r|0}while(--n);r%=65521,o%=65521}return r|o<<16|0};const U=new Uint32Array((()=>{let e,t=[];for(var s=0;s<256;s++){e=s;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t})());var z=(e,t,s,i)=>{const r=U,o=i+s;e^=-1;for(let s=i;s<o;s++)e=e>>>8^r[255&(e^t[s])];return-1^e},W={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},X={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Y,_tr_stored_block:K,_tr_flush_block:J,_tr_tally:Z,_tr_align:Q}=H,{Z_NO_FLUSH:q,Z_PARTIAL_FLUSH:$,Z_FULL_FLUSH:ee,Z_FINISH:te,Z_BLOCK:se,Z_OK:ie,Z_STREAM_END:re,Z_STREAM_ERROR:oe,Z_DATA_ERROR:ne,Z_BUF_ERROR:ae,Z_DEFAULT_COMPRESSION:he,Z_FILTERED:le,Z_HUFFMAN_ONLY:ue,Z_RLE:ce,Z_FIXED:pe,Z_DEFAULT_STRATEGY:de,Z_UNKNOWN:me,Z_DEFLATED:fe}=X,ge=258,_e=262,ye=103,ve=113,be=666,xe=(e,t)=>(e.msg=W[t],t),Pe=e=>(e<<1)-(e>4?9:0),Te=e=>{let t=e.length;for(;--t>=0;)e[t]=0};let we=(e,t,s)=>(t<<e.hash_shift^s)&e.hash_mask;const Me=e=>{const t=e.state;let s=t.pending;s>e.avail_out&&(s=e.avail_out),0!==s&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),e.next_out),e.next_out+=s,t.pending_out+=s,e.total_out+=s,e.avail_out-=s,t.pending-=s,0===t.pending&&(t.pending_out=0))},Ie=(e,t)=>{J(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Me(e.strm)},Ce=(e,t)=>{e.pending_buf[e.pending++]=t},De=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Ae=(e,t,s,i)=>{let r=e.avail_in;return r>i&&(r=i),0===r?0:(e.avail_in-=r,t.set(e.input.subarray(e.next_in,e.next_in+r),s),1===e.state.wrap?e.adler=V(e.adler,t,r,s):2===e.state.wrap&&(e.adler=z(e.adler,t,r,s)),e.next_in+=r,e.total_in+=r,r)},Ee=(e,t)=>{let s,i,r=e.max_chain_length,o=e.strstart,n=e.prev_length,a=e.nice_match;const h=e.strstart>e.w_size-_e?e.strstart-(e.w_size-_e):0,l=e.window,u=e.w_mask,c=e.prev,p=e.strstart+ge;let d=l[o+n-1],m=l[o+n];e.prev_length>=e.good_match&&(r>>=2),a>e.lookahead&&(a=e.lookahead);do{if(s=t,l[s+n]===m&&l[s+n-1]===d&&l[s]===l[o]&&l[++s]===l[o+1]){o+=2,s++;do{}while(l[++o]===l[++s]&&l[++o]===l[++s]&&l[++o]===l[++s]&&l[++o]===l[++s]&&l[++o]===l[++s]&&l[++o]===l[++s]&&l[++o]===l[++s]&&l[++o]===l[++s]&&o<p);if(i=ge-(p-o),o=p-ge,i>n){if(e.match_start=t,n=i,i>=a)break;d=l[o+n-1],m=l[o+n]}}}while((t=c[t&u])>h&&0!=--r);return n<=e.lookahead?n:e.lookahead},Fe=e=>{const t=e.w_size;let s,i,r,o,n;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-_e)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,i=e.hash_size,s=i;do{r=e.head[--s],e.head[s]=r>=t?r-t:0}while(--i);i=t,s=i;do{r=e.prev[--s],e.prev[s]=r>=t?r-t:0}while(--i);o+=t}if(0===e.strm.avail_in)break;if(i=Ae(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=3)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=we(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=we(e,e.ins_h,e.window[n+3-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<_e&&0!==e.strm.avail_in)},Re=(e,t)=>{let s,i;for(;;){if(e.lookahead<_e){if(Fe(e),e.lookahead<_e&&t===q)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=we(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==s&&e.strstart-s<=e.w_size-_e&&(e.match_length=Ee(e,s)),e.match_length>=3)if(i=Z(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=we(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=we(e,e.ins_h,e.window[e.strstart+1]);else i=Z(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(Ie(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===te?(Ie(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ie(e,!1),0===e.strm.avail_out)?1:2},Se=(e,t)=>{let s,i,r;for(;;){if(e.lookahead<_e){if(Fe(e),e.lookahead<_e&&t===q)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=we(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==s&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-_e&&(e.match_length=Ee(e,s),e.match_length<=5&&(e.strategy===le||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,i=Z(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=we(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(Ie(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=Z(e,0,e.window[e.strstart-1]),i&&Ie(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Z(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===te?(Ie(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ie(e,!1),0===e.strm.avail_out)?1:2};function Oe(e,t,s,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=s,this.max_chain=i,this.func=r}const Be=[new Oe(0,0,0,0,((e,t)=>{let s=65535;for(s>e.pending_buf_size-5&&(s=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Fe(e),0===e.lookahead&&t===q)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const i=e.block_start+s;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,Ie(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-_e&&(Ie(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===te?(Ie(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(Ie(e,!1),e.strm.avail_out),1)})),new Oe(4,4,8,4,Re),new Oe(4,5,16,8,Re),new Oe(4,6,32,32,Re),new Oe(4,4,16,16,Se),new Oe(8,16,32,32,Se),new Oe(8,16,128,128,Se),new Oe(8,32,128,256,Se),new Oe(32,128,258,1024,Se),new Oe(32,258,258,4096,Se)];function Le(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=fe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Te(this.dyn_ltree),Te(this.dyn_dtree),Te(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Te(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Te(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Ne=e=>{if(!e||!e.state)return xe(e,oe);e.total_in=e.total_out=0,e.data_type=me;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:ve,e.adler=2===t.wrap?0:1,t.last_flush=q,Y(t),ie},ke=e=>{const t=Ne(e);return t===ie&&(e=>{e.window_size=2*e.w_size,Te(e.head),e.max_lazy_match=Be[e.level].max_lazy,e.good_match=Be[e.level].good_length,e.nice_match=Be[e.level].nice_length,e.max_chain_length=Be[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},je=(e,t,s,i,r,o)=>{if(!e)return oe;let n=1;if(t===he&&(t=6),i<0?(n=0,i=-i):i>15&&(n=2,i-=16),r<1||r>9||s!==fe||i<8||i>15||t<0||t>9||o<0||o>pe)return xe(e,oe);8===i&&(i=9);const a=new Le;return e.state=a,a.strm=e,a.wrap=n,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=o,a.method=s,ke(e)};var Ge=(e,t)=>{let s,i;if(!e||!e.state||t>se||t<0)return e?xe(e,oe):oe;const r=e.state;if(!e.output||!e.input&&0!==e.avail_in||r.status===be&&t!==te)return xe(e,0===e.avail_out?ae:oe);r.strm=e;const o=r.last_flush;if(r.last_flush=t,42===r.status)if(2===r.wrap)e.adler=0,Ce(r,31),Ce(r,139),Ce(r,8),r.gzhead?(Ce(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),Ce(r,255&r.gzhead.time),Ce(r,r.gzhead.time>>8&255),Ce(r,r.gzhead.time>>16&255),Ce(r,r.gzhead.time>>24&255),Ce(r,9===r.level?2:r.strategy>=ue||r.level<2?4:0),Ce(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(Ce(r,255&r.gzhead.extra.length),Ce(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=z(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(Ce(r,0),Ce(r,0),Ce(r,0),Ce(r,0),Ce(r,0),Ce(r,9===r.level?2:r.strategy>=ue||r.level<2?4:0),Ce(r,3),r.status=ve);else{let t=fe+(r.w_bits-8<<4)<<8,s=-1;s=r.strategy>=ue||r.level<2?0:r.level<6?1:6===r.level?2:3,t|=s<<6,0!==r.strstart&&(t|=32),t+=31-t%31,r.status=ve,De(r,t),0!==r.strstart&&(De(r,e.adler>>>16),De(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(s=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>s&&(e.adler=z(e.adler,r.pending_buf,r.pending-s,s)),Me(e),s=r.pending,r.pending!==r.pending_buf_size));)Ce(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>s&&(e.adler=z(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(e.adler=z(e.adler,r.pending_buf,r.pending-s,s)),Me(e),s=r.pending,r.pending===r.pending_buf_size)){i=1;break}i=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,Ce(r,i)}while(0!==i);r.gzhead.hcrc&&r.pending>s&&(e.adler=z(e.adler,r.pending_buf,r.pending-s,s)),0===i&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(e.adler=z(e.adler,r.pending_buf,r.pending-s,s)),Me(e),s=r.pending,r.pending===r.pending_buf_size)){i=1;break}i=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,Ce(r,i)}while(0!==i);r.gzhead.hcrc&&r.pending>s&&(e.adler=z(e.adler,r.pending_buf,r.pending-s,s)),0===i&&(r.status=ye)}else r.status=ye;if(r.status===ye&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Me(e),r.pending+2<=r.pending_buf_size&&(Ce(r,255&e.adler),Ce(r,e.adler>>8&255),e.adler=0,r.status=ve)):r.status=ve),0!==r.pending){if(Me(e),0===e.avail_out)return r.last_flush=-1,ie}else if(0===e.avail_in&&Pe(t)<=Pe(o)&&t!==te)return xe(e,ae);if(r.status===be&&0!==e.avail_in)return xe(e,ae);if(0!==e.avail_in||0!==r.lookahead||t!==q&&r.status!==be){let s=r.strategy===ue?((e,t)=>{let s;for(;;){if(0===e.lookahead&&(Fe(e),0===e.lookahead)){if(t===q)return 1;break}if(e.match_length=0,s=Z(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,s&&(Ie(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===te?(Ie(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ie(e,!1),0===e.strm.avail_out)?1:2})(r,t):r.strategy===ce?((e,t)=>{let s,i,r,o;const n=e.window;for(;;){if(e.lookahead<=ge){if(Fe(e),e.lookahead<=ge&&t===q)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=e.strstart-1,i=n[r],i===n[++r]&&i===n[++r]&&i===n[++r])){o=e.strstart+ge;do{}while(i===n[++r]&&i===n[++r]&&i===n[++r]&&i===n[++r]&&i===n[++r]&&i===n[++r]&&i===n[++r]&&i===n[++r]&&r<o);e.match_length=ge-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(s=Z(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(s=Z(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),s&&(Ie(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===te?(Ie(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ie(e,!1),0===e.strm.avail_out)?1:2})(r,t):Be[r.level].func(r,t);if(3!==s&&4!==s||(r.status=be),1===s||3===s)return 0===e.avail_out&&(r.last_flush=-1),ie;if(2===s&&(t===$?Q(r):t!==se&&(K(r,0,0,!1),t===ee&&(Te(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Me(e),0===e.avail_out))return r.last_flush=-1,ie}return t!==te?ie:r.wrap<=0?re:(2===r.wrap?(Ce(r,255&e.adler),Ce(r,e.adler>>8&255),Ce(r,e.adler>>16&255),Ce(r,e.adler>>24&255),Ce(r,255&e.total_in),Ce(r,e.total_in>>8&255),Ce(r,e.total_in>>16&255),Ce(r,e.total_in>>24&255)):(De(r,e.adler>>>16),De(r,65535&e.adler)),Me(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?ie:re)},He=(e,t)=>{let s=t.length;if(!e||!e.state)return oe;const i=e.state,r=i.wrap;if(2===r||1===r&&42!==i.status||i.lookahead)return oe;if(1===r&&(e.adler=V(e.adler,t,s,0)),i.wrap=0,s>=i.w_size){0===r&&(Te(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(s-i.w_size,s),0),t=e,s=i.w_size}const o=e.avail_in,n=e.next_in,a=e.input;for(e.avail_in=s,e.next_in=0,e.input=t,Fe(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do{i.ins_h=we(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=2,Fe(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=n,e.input=a,e.avail_in=o,i.wrap=r,ie},Ve={deflateInit:(e,t)=>je(e,t,fe,15,8,de),deflateInit2:je,deflateReset:ke,deflateResetKeep:Ne,deflateSetHeader:(e,t)=>e&&e.state?2!==e.state.wrap?oe:(e.state.gzhead=t,ie):oe,deflate:Ge,deflateEnd:e=>{if(!e||!e.state)return oe;const t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&t!==ye&&t!==ve&&t!==be?xe(e,oe):(e.state=null,t===ve?xe(e,ne):ie)},deflateSetDictionary:He,deflateInfo:"pako deflate (from Nodeca project)"};const Ue=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var ze=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const s=t.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(const t in s)Ue(s,t)&&(e[t]=s[t])}}return e},We=e=>{let t=0;for(let s=0,i=e.length;s<i;s++)t+=e[s].length;const s=new Uint8Array(t);for(let t=0,i=0,r=e.length;t<r;t++){let r=e[t];s.set(r,i),i+=r.length}return s};let Xe=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Xe=!1}const Ye=new Uint8Array(256);for(let e=0;e<256;e++)Ye[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Ye[254]=Ye[254]=1;var Ke=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,s,i,r,o,n=e.length,a=0;for(r=0;r<n;r++)s=e.charCodeAt(r),55296==(64512&s)&&r+1<n&&(i=e.charCodeAt(r+1),56320==(64512&i)&&(s=65536+(s-55296<<10)+(i-56320),r++)),a+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(a),o=0,r=0;o<a;r++)s=e.charCodeAt(r),55296==(64512&s)&&r+1<n&&(i=e.charCodeAt(r+1),56320==(64512&i)&&(s=65536+(s-55296<<10)+(i-56320),r++)),s<128?t[o++]=s:s<2048?(t[o++]=192|s>>>6,t[o++]=128|63&s):s<65536?(t[o++]=224|s>>>12,t[o++]=128|s>>>6&63,t[o++]=128|63&s):(t[o++]=240|s>>>18,t[o++]=128|s>>>12&63,t[o++]=128|s>>>6&63,t[o++]=128|63&s);return t},Je=(e,t)=>{const s=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,r;const o=new Array(2*s);for(r=0,i=0;i<s;){let t=e[i++];if(t<128){o[r++]=t;continue}let n=Ye[t];if(n>4)o[r++]=65533,i+=n-1;else{for(t&=2===n?31:3===n?15:7;n>1&&i<s;)t=t<<6|63&e[i++],n--;n>1?o[r++]=65533:t<65536?o[r++]=t:(t-=65536,o[r++]=55296|t>>10&1023,o[r++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Xe)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let s="";for(let i=0;i<t;i++)s+=String.fromCharCode(e[i]);return s})(o,r)},Ze=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let s=t-1;for(;s>=0&&128==(192&e[s]);)s--;return s<0||0===s?t:s+Ye[e[s]]>t?s:t};var Qe=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const qe=Object.prototype.toString,{Z_NO_FLUSH:$e,Z_SYNC_FLUSH:et,Z_FULL_FLUSH:tt,Z_FINISH:st,Z_OK:it,Z_STREAM_END:rt,Z_DEFAULT_COMPRESSION:ot,Z_DEFAULT_STRATEGY:nt,Z_DEFLATED:at}=X;function ht(e){this.options=ze({level:ot,method:at,chunkSize:16384,windowBits:15,memLevel:8,strategy:nt},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Qe,this.strm.avail_out=0;let s=Ve.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==it)throw new Error(W[s]);if(t.header&&Ve.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Ke(t.dictionary):"[object ArrayBuffer]"===qe.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,s=Ve.deflateSetDictionary(this.strm,e),s!==it)throw new Error(W[s]);this._dict_set=!0}}function lt(e,t){const s=new ht(t);if(s.push(e,!0),s.err)throw s.msg||W[s.err];return s.result}ht.prototype.push=function(e,t){const s=this.strm,i=this.options.chunkSize;let r,o;if(this.ended)return!1;for(o=t===~~t?t:!0===t?st:$e,"string"==typeof e?s.input=Ke(e):"[object ArrayBuffer]"===qe.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(i),s.next_out=0,s.avail_out=i),(o===et||o===tt)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(r=Ve.deflate(s,o),r===rt)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),r=Ve.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===it;if(0!==s.avail_out){if(o>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},ht.prototype.onData=function(e){this.chunks.push(e)},ht.prototype.onEnd=function(e){e===it&&(this.result=We(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ut={Deflate:ht,deflate:lt,deflateRaw:function(e,t){return(t=t||{}).raw=!0,lt(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,lt(e,t)},constants:X};var ct=function(e,t){let s,i,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v,b,x,P,T,w,M;const I=e.state;s=e.next_in,w=e.input,i=s+(e.avail_in-5),r=e.next_out,M=e.output,o=r-(t-e.avail_out),n=r+(e.avail_out-257),a=I.dmax,h=I.wsize,l=I.whave,u=I.wnext,c=I.window,p=I.hold,d=I.bits,m=I.lencode,f=I.distcode,g=(1<<I.lenbits)-1,_=(1<<I.distbits)-1;e:do{d<15&&(p+=w[s++]<<d,d+=8,p+=w[s++]<<d,d+=8),y=m[p&g];t:for(;;){if(v=y>>>24,p>>>=v,d-=v,v=y>>>16&255,0===v)M[r++]=65535&y;else{if(!(16&v)){if(0==(64&v)){y=m[(65535&y)+(p&(1<<v)-1)];continue t}if(32&v){I.mode=12;break e}e.msg="invalid literal/length code",I.mode=30;break e}b=65535&y,v&=15,v&&(d<v&&(p+=w[s++]<<d,d+=8),b+=p&(1<<v)-1,p>>>=v,d-=v),d<15&&(p+=w[s++]<<d,d+=8,p+=w[s++]<<d,d+=8),y=f[p&_];s:for(;;){if(v=y>>>24,p>>>=v,d-=v,v=y>>>16&255,!(16&v)){if(0==(64&v)){y=f[(65535&y)+(p&(1<<v)-1)];continue s}e.msg="invalid distance code",I.mode=30;break e}if(x=65535&y,v&=15,d<v&&(p+=w[s++]<<d,d+=8,d<v&&(p+=w[s++]<<d,d+=8)),x+=p&(1<<v)-1,x>a){e.msg="invalid distance too far back",I.mode=30;break e}if(p>>>=v,d-=v,v=r-o,x>v){if(v=x-v,v>l&&I.sane){e.msg="invalid distance too far back",I.mode=30;break e}if(P=0,T=c,0===u){if(P+=h-v,v<b){b-=v;do{M[r++]=c[P++]}while(--v);P=r-x,T=M}}else if(u<v){if(P+=h+u-v,v-=u,v<b){b-=v;do{M[r++]=c[P++]}while(--v);if(P=0,u<b){v=u,b-=v;do{M[r++]=c[P++]}while(--v);P=r-x,T=M}}}else if(P+=u-v,v<b){b-=v;do{M[r++]=c[P++]}while(--v);P=r-x,T=M}for(;b>2;)M[r++]=T[P++],M[r++]=T[P++],M[r++]=T[P++],b-=3;b&&(M[r++]=T[P++],b>1&&(M[r++]=T[P++]))}else{P=r-x;do{M[r++]=M[P++],M[r++]=M[P++],M[r++]=M[P++],b-=3}while(b>2);b&&(M[r++]=M[P++],b>1&&(M[r++]=M[P++]))}break}}break}}while(s<i&&r<n);b=d>>3,s-=b,d-=b<<3,p&=(1<<d)-1,e.next_in=s,e.next_out=r,e.avail_in=s<i?i-s+5:5-(s-i),e.avail_out=r<n?n-r+257:257-(r-n),I.hold=p,I.bits=d};const pt=15,dt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),mt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ft=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),gt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var _t=(e,t,s,i,r,o,n,a)=>{const h=a.bits;let l,u,c,p,d,m,f=0,g=0,_=0,y=0,v=0,b=0,x=0,P=0,T=0,w=0,M=null,I=0;const C=new Uint16Array(16),D=new Uint16Array(16);let A,E,F,R=null,S=0;for(f=0;f<=pt;f++)C[f]=0;for(g=0;g<i;g++)C[t[s+g]]++;for(v=h,y=pt;y>=1&&0===C[y];y--);if(v>y&&(v=y),0===y)return r[o++]=20971520,r[o++]=20971520,a.bits=1,0;for(_=1;_<y&&0===C[_];_++);for(v<_&&(v=_),P=1,f=1;f<=pt;f++)if(P<<=1,P-=C[f],P<0)return-1;if(P>0&&(0===e||1!==y))return-1;for(D[1]=0,f=1;f<pt;f++)D[f+1]=D[f]+C[f];for(g=0;g<i;g++)0!==t[s+g]&&(n[D[t[s+g]]++]=g);if(0===e?(M=R=n,m=19):1===e?(M=dt,I-=257,R=mt,S-=257,m=256):(M=ft,R=gt,m=-1),w=0,g=0,f=_,d=o,b=v,x=0,c=-1,T=1<<v,p=T-1,1===e&&T>852||2===e&&T>592)return 1;for(;;){A=f-x,n[g]<m?(E=0,F=n[g]):n[g]>m?(E=R[S+n[g]],F=M[I+n[g]]):(E=96,F=0),l=1<<f-x,u=1<<b,_=u;do{u-=l,r[d+(w>>x)+u]=A<<24|E<<16|F|0}while(0!==u);for(l=1<<f-1;w&l;)l>>=1;if(0!==l?(w&=l-1,w+=l):w=0,g++,0==--C[f]){if(f===y)break;f=t[s+n[g]]}if(f>v&&(w&p)!==c){for(0===x&&(x=v),d+=_,b=f-x,P=1<<b;b+x<y&&(P-=C[b+x],!(P<=0));)b++,P<<=1;if(T+=1<<b,1===e&&T>852||2===e&&T>592)return 1;c=w&p,r[c]=v<<24|b<<16|d-o|0}}return 0!==w&&(r[d+w]=f-x<<24|64<<16|0),a.bits=v,0};const{Z_FINISH:yt,Z_BLOCK:vt,Z_TREES:bt,Z_OK:xt,Z_STREAM_END:Pt,Z_NEED_DICT:Tt,Z_STREAM_ERROR:wt,Z_DATA_ERROR:Mt,Z_MEM_ERROR:It,Z_BUF_ERROR:Ct,Z_DEFLATED:Dt}=X,At=12,Et=30,Ft=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Rt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const St=e=>{if(!e||!e.state)return wt;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,xt},Ot=e=>{if(!e||!e.state)return wt;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,St(e)},Bt=(e,t)=>{let s;if(!e||!e.state)return wt;const i=e.state;return t<0?(s=0,t=-t):(s=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?wt:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=s,i.wbits=t,Ot(e))},Lt=(e,t)=>{if(!e)return wt;const s=new Rt;e.state=s,s.window=null;const i=Bt(e,t);return i!==xt&&(e.state=null),i};let Nt,kt,jt=!0;const Gt=e=>{if(jt){Nt=new Int32Array(512),kt=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(_t(1,e.lens,0,288,Nt,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;_t(2,e.lens,0,32,kt,0,e.work,{bits:5}),jt=!1}e.lencode=Nt,e.lenbits=9,e.distcode=kt,e.distbits=5},Ht=(e,t,s,i)=>{let r;const o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),i>=o.wsize?(o.window.set(t.subarray(s-o.wsize,s),0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>i&&(r=i),o.window.set(t.subarray(s-i,s-i+r),o.wnext),(i-=r)?(o.window.set(t.subarray(s-i,s),0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0};var Vt=(e,t)=>{let s,i,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v,b,x,P,T,w=0;const M=new Uint8Array(4);let I,C;const D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return wt;s=e.state,s.mode===At&&(s.mode=13),n=e.next_out,r=e.output,h=e.avail_out,o=e.next_in,i=e.input,a=e.avail_in,l=s.hold,u=s.bits,c=a,p=h,T=xt;e:for(;;)switch(s.mode){case 1:if(0===s.wrap){s.mode=13;break}for(;u<16;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}if(2&s.wrap&&35615===l){s.check=0,M[0]=255&l,M[1]=l>>>8&255,s.check=z(s.check,M,2,0),l=0,u=0,s.mode=2;break}if(s.flags=0,s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",s.mode=Et;break}if((15&l)!==Dt){e.msg="unknown compression method",s.mode=Et;break}if(l>>>=4,u-=4,P=8+(15&l),0===s.wbits)s.wbits=P;else if(P>s.wbits){e.msg="invalid window size",s.mode=Et;break}s.dmax=1<<s.wbits,e.adler=s.check=1,s.mode=512&l?10:At,l=0,u=0;break;case 2:for(;u<16;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}if(s.flags=l,(255&s.flags)!==Dt){e.msg="unknown compression method",s.mode=Et;break}if(57344&s.flags){e.msg="unknown header flags set",s.mode=Et;break}s.head&&(s.head.text=l>>8&1),512&s.flags&&(M[0]=255&l,M[1]=l>>>8&255,s.check=z(s.check,M,2,0)),l=0,u=0,s.mode=3;case 3:for(;u<32;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}s.head&&(s.head.time=l),512&s.flags&&(M[0]=255&l,M[1]=l>>>8&255,M[2]=l>>>16&255,M[3]=l>>>24&255,s.check=z(s.check,M,4,0)),l=0,u=0,s.mode=4;case 4:for(;u<16;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}s.head&&(s.head.xflags=255&l,s.head.os=l>>8),512&s.flags&&(M[0]=255&l,M[1]=l>>>8&255,s.check=z(s.check,M,2,0)),l=0,u=0,s.mode=5;case 5:if(1024&s.flags){for(;u<16;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}s.length=l,s.head&&(s.head.extra_len=l),512&s.flags&&(M[0]=255&l,M[1]=l>>>8&255,s.check=z(s.check,M,2,0)),l=0,u=0}else s.head&&(s.head.extra=null);s.mode=6;case 6:if(1024&s.flags&&(d=s.length,d>a&&(d=a),d&&(s.head&&(P=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(i.subarray(o,o+d),P)),512&s.flags&&(s.check=z(s.check,i,d,o)),a-=d,o+=d,s.length-=d),s.length))break e;s.length=0,s.mode=7;case 7:if(2048&s.flags){if(0===a)break e;d=0;do{P=i[o+d++],s.head&&P&&s.length<65536&&(s.head.name+=String.fromCharCode(P))}while(P&&d<a);if(512&s.flags&&(s.check=z(s.check,i,d,o)),a-=d,o+=d,P)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=8;case 8:if(4096&s.flags){if(0===a)break e;d=0;do{P=i[o+d++],s.head&&P&&s.length<65536&&(s.head.comment+=String.fromCharCode(P))}while(P&&d<a);if(512&s.flags&&(s.check=z(s.check,i,d,o)),a-=d,o+=d,P)break e}else s.head&&(s.head.comment=null);s.mode=9;case 9:if(512&s.flags){for(;u<16;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}if(l!==(65535&s.check)){e.msg="header crc mismatch",s.mode=Et;break}l=0,u=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=At;break;case 10:for(;u<32;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}e.adler=s.check=Ft(l),l=0,u=0,s.mode=11;case 11:if(0===s.havedict)return e.next_out=n,e.avail_out=h,e.next_in=o,e.avail_in=a,s.hold=l,s.bits=u,Tt;e.adler=s.check=1,s.mode=At;case At:if(t===vt||t===bt)break e;case 13:if(s.last){l>>>=7&u,u-=7&u,s.mode=27;break}for(;u<3;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}switch(s.last=1&l,l>>>=1,u-=1,3&l){case 0:s.mode=14;break;case 1:if(Gt(s),s.mode=20,t===bt){l>>>=2,u-=2;break e}break;case 2:s.mode=17;break;case 3:e.msg="invalid block type",s.mode=Et}l>>>=2,u-=2;break;case 14:for(l>>>=7&u,u-=7&u;u<32;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",s.mode=Et;break}if(s.length=65535&l,l=0,u=0,s.mode=15,t===bt)break e;case 15:s.mode=16;case 16:if(d=s.length,d){if(d>a&&(d=a),d>h&&(d=h),0===d)break e;r.set(i.subarray(o,o+d),n),a-=d,o+=d,h-=d,n+=d,s.length-=d;break}s.mode=At;break;case 17:for(;u<14;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}if(s.nlen=257+(31&l),l>>>=5,u-=5,s.ndist=1+(31&l),l>>>=5,u-=5,s.ncode=4+(15&l),l>>>=4,u-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=Et;break}s.have=0,s.mode=18;case 18:for(;s.have<s.ncode;){for(;u<3;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}s.lens[D[s.have++]]=7&l,l>>>=3,u-=3}for(;s.have<19;)s.lens[D[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,I={bits:s.lenbits},T=_t(0,s.lens,0,19,s.lencode,0,s.work,I),s.lenbits=I.bits,T){e.msg="invalid code lengths set",s.mode=Et;break}s.have=0,s.mode=19;case 19:for(;s.have<s.nlen+s.ndist;){for(;w=s.lencode[l&(1<<s.lenbits)-1],g=w>>>24,_=w>>>16&255,y=65535&w,!(g<=u);){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}if(y<16)l>>>=g,u-=g,s.lens[s.have++]=y;else{if(16===y){for(C=g+2;u<C;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}if(l>>>=g,u-=g,0===s.have){e.msg="invalid bit length repeat",s.mode=Et;break}P=s.lens[s.have-1],d=3+(3&l),l>>>=2,u-=2}else if(17===y){for(C=g+3;u<C;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}l>>>=g,u-=g,P=0,d=3+(7&l),l>>>=3,u-=3}else{for(C=g+7;u<C;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}l>>>=g,u-=g,P=0,d=11+(127&l),l>>>=7,u-=7}if(s.have+d>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=Et;break}for(;d--;)s.lens[s.have++]=P}}if(s.mode===Et)break;if(0===s.lens[256]){e.msg="invalid code -- missing end-of-block",s.mode=Et;break}if(s.lenbits=9,I={bits:s.lenbits},T=_t(1,s.lens,0,s.nlen,s.lencode,0,s.work,I),s.lenbits=I.bits,T){e.msg="invalid literal/lengths set",s.mode=Et;break}if(s.distbits=6,s.distcode=s.distdyn,I={bits:s.distbits},T=_t(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,I),s.distbits=I.bits,T){e.msg="invalid distances set",s.mode=Et;break}if(s.mode=20,t===bt)break e;case 20:s.mode=21;case 21:if(a>=6&&h>=258){e.next_out=n,e.avail_out=h,e.next_in=o,e.avail_in=a,s.hold=l,s.bits=u,ct(e,p),n=e.next_out,r=e.output,h=e.avail_out,o=e.next_in,i=e.input,a=e.avail_in,l=s.hold,u=s.bits,s.mode===At&&(s.back=-1);break}for(s.back=0;w=s.lencode[l&(1<<s.lenbits)-1],g=w>>>24,_=w>>>16&255,y=65535&w,!(g<=u);){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}if(_&&0==(240&_)){for(v=g,b=_,x=y;w=s.lencode[x+((l&(1<<v+b)-1)>>v)],g=w>>>24,_=w>>>16&255,y=65535&w,!(v+g<=u);){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}l>>>=v,u-=v,s.back+=v}if(l>>>=g,u-=g,s.back+=g,s.length=y,0===_){s.mode=26;break}if(32&_){s.back=-1,s.mode=At;break}if(64&_){e.msg="invalid literal/length code",s.mode=Et;break}s.extra=15&_,s.mode=22;case 22:if(s.extra){for(C=s.extra;u<C;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}s.length+=l&(1<<s.extra)-1,l>>>=s.extra,u-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=23;case 23:for(;w=s.distcode[l&(1<<s.distbits)-1],g=w>>>24,_=w>>>16&255,y=65535&w,!(g<=u);){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}if(0==(240&_)){for(v=g,b=_,x=y;w=s.distcode[x+((l&(1<<v+b)-1)>>v)],g=w>>>24,_=w>>>16&255,y=65535&w,!(v+g<=u);){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}l>>>=v,u-=v,s.back+=v}if(l>>>=g,u-=g,s.back+=g,64&_){e.msg="invalid distance code",s.mode=Et;break}s.offset=y,s.extra=15&_,s.mode=24;case 24:if(s.extra){for(C=s.extra;u<C;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}s.offset+=l&(1<<s.extra)-1,l>>>=s.extra,u-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=Et;break}s.mode=25;case 25:if(0===h)break e;if(d=p-h,s.offset>d){if(d=s.offset-d,d>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=Et;break}d>s.wnext?(d-=s.wnext,m=s.wsize-d):m=s.wnext-d,d>s.length&&(d=s.length),f=s.window}else f=r,m=n-s.offset,d=s.length;d>h&&(d=h),h-=d,s.length-=d;do{r[n++]=f[m++]}while(--d);0===s.length&&(s.mode=21);break;case 26:if(0===h)break e;r[n++]=s.length,h--,s.mode=21;break;case 27:if(s.wrap){for(;u<32;){if(0===a)break e;a--,l|=i[o++]<<u,u+=8}if(p-=h,e.total_out+=p,s.total+=p,p&&(e.adler=s.check=s.flags?z(s.check,r,p,n-p):V(s.check,r,p,n-p)),p=h,(s.flags?l:Ft(l))!==s.check){e.msg="incorrect data check",s.mode=Et;break}l=0,u=0}s.mode=28;case 28:if(s.wrap&&s.flags){for(;u<32;){if(0===a)break e;a--,l+=i[o++]<<u,u+=8}if(l!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=Et;break}l=0,u=0}s.mode=29;case 29:T=Pt;break e;case Et:T=Mt;break e;case 31:return It;default:return wt}return e.next_out=n,e.avail_out=h,e.next_in=o,e.avail_in=a,s.hold=l,s.bits=u,(s.wsize||p!==e.avail_out&&s.mode<Et&&(s.mode<27||t!==yt))&&Ht(e,e.output,e.next_out,p-e.avail_out),c-=e.avail_in,p-=e.avail_out,e.total_in+=c,e.total_out+=p,s.total+=p,s.wrap&&p&&(e.adler=s.check=s.flags?z(s.check,r,p,e.next_out-p):V(s.check,r,p,e.next_out-p)),e.data_type=s.bits+(s.last?64:0)+(s.mode===At?128:0)+(20===s.mode||15===s.mode?256:0),(0===c&&0===p||t===yt)&&T===xt&&(T=Ct),T},Ut={inflateReset:Ot,inflateReset2:Bt,inflateResetKeep:St,inflateInit:e=>Lt(e,15),inflateInit2:Lt,inflate:Vt,inflateEnd:e=>{if(!e||!e.state)return wt;let t=e.state;return t.window&&(t.window=null),e.state=null,xt},inflateGetHeader:(e,t)=>{if(!e||!e.state)return wt;const s=e.state;return 0==(2&s.wrap)?wt:(s.head=t,t.done=!1,xt)},inflateSetDictionary:(e,t)=>{const s=t.length;let i,r,o;return e&&e.state?(i=e.state,0!==i.wrap&&11!==i.mode?wt:11===i.mode&&(r=1,r=V(r,t,s,0),r!==i.check)?Mt:(o=Ht(e,t,s,s),o?(i.mode=31,It):(i.havedict=1,xt))):wt},inflateInfo:"pako inflate (from Nodeca project)"};var zt=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Wt=Object.prototype.toString,{Z_NO_FLUSH:Xt,Z_FINISH:Yt,Z_OK:Kt,Z_STREAM_END:Jt,Z_NEED_DICT:Zt,Z_STREAM_ERROR:Qt,Z_DATA_ERROR:qt,Z_MEM_ERROR:$t}=X;function es(e){this.options=ze({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Qe,this.strm.avail_out=0;let s=Ut.inflateInit2(this.strm,t.windowBits);if(s!==Kt)throw new Error(W[s]);if(this.header=new zt,Ut.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Ke(t.dictionary):"[object ArrayBuffer]"===Wt.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=Ut.inflateSetDictionary(this.strm,t.dictionary),s!==Kt)))throw new Error(W[s])}function ts(e,t){const s=new es(t);if(s.push(e),s.err)throw s.msg||W[s.err];return s.result}es.prototype.push=function(e,t){const s=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let o,n,a;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Yt:Xt,"[object ArrayBuffer]"===Wt.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(i),s.next_out=0,s.avail_out=i),o=Ut.inflate(s,n),o===Zt&&r&&(o=Ut.inflateSetDictionary(s,r),o===Kt?o=Ut.inflate(s,n):o===qt&&(o=Zt));s.avail_in>0&&o===Jt&&s.state.wrap>0&&0!==e[s.next_in];)Ut.inflateReset(s),o=Ut.inflate(s,n);switch(o){case Qt:case qt:case Zt:case $t:return this.onEnd(o),this.ended=!0,!1}if(a=s.avail_out,s.next_out&&(0===s.avail_out||o===Jt))if("string"===this.options.to){let e=Ze(s.output,s.next_out),t=s.next_out-e,r=Je(s.output,e);s.next_out=t,s.avail_out=i-t,t&&s.output.set(s.output.subarray(e,e+t),0),this.onData(r)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(o!==Kt||0!==a){if(o===Jt)return o=Ut.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},es.prototype.onData=function(e){this.chunks.push(e)},es.prototype.onEnd=function(e){e===Kt&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=We(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ss={Inflate:es,inflate:ts,inflateRaw:function(e,t){return(t=t||{}).raw=!0,ts(e,t)},ungzip:ts,constants:X};const{Deflate:is,deflate:rs,deflateRaw:os,gzip:ns}=ut,{Inflate:as,inflate:hs,inflateRaw:ls,ungzip:us}=ss;var cs=is,ps=rs,ds=os,ms=ns,fs=as,gs=hs,_s=ls,ys=us,vs=X,bs={Deflate:cs,deflate:ps,deflateRaw:ds,gzip:ms,Inflate:fs,inflate:gs,inflateRaw:_s,ungzip:ys,constants:vs};e.Deflate=cs,e.Inflate=fs,e.constants=vs,e.default=bs,e.deflate=ps,e.deflateRaw=ds,e.gzip=ms,e.inflate=gs,e.inflateRaw=_s,e.ungzip=ys,Object.defineProperty(e,"__esModule",{value:!0})}));var Hy=Object.freeze({__proto__:null});let Vy=window.pako||Hy;Vy.inflate||(Vy=Vy.default);const Uy=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const zy={version:1,parse:function(e,t,s,i){const r=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],positionsDecodeMatrix:e[11]}}(s),o=function(e){return{positions:new Uint16Array(Vy.inflate(e.positions).buffer),normals:new Int8Array(Vy.inflate(e.normals).buffer),indices:new Uint32Array(Vy.inflate(e.indices).buffer),edgeIndices:new Uint32Array(Vy.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(Vy.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(Vy.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(Vy.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(Vy.inflate(e.meshColors).buffer),entityIDs:Vy.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(Vy.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(Vy.inflate(e.entityIsObjects).buffer),positionsDecodeMatrix:new Float32Array(Vy.inflate(e.positionsDecodeMatrix).buffer)}}(r);!function(e,t,s,i){i.positionsCompression="precompressed",i.normalsCompression="precompressed";const r=s.positions,o=s.normals,n=s.indices,a=s.edgeIndices,h=s.meshPositions,l=s.meshIndices,u=s.meshEdgesIndices,c=s.meshColors,d=JSON.parse(s.entityIDs),m=s.entityMeshes,f=s.entityIsObjects,g=h.length,_=m.length;for(let v=0;v<_;v++){const b=d[v],x=t.globalizeObjectIds?p.globalizeObjectId(i.id,b):b,P=e.metaScene.metaObjects[x],T={},w={};if(P){if(t.excludeTypesMap&&P.type&&t.excludeTypesMap[P.type])continue;if(t.includeTypesMap&&P.type&&!t.includeTypesMap[P.type])continue;const e=t.objectDefaults?t.objectDefaults[P.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(T.visible=!1),!1===e.pickable&&(T.pickable=!1),e.colorize&&(w.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(w.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;const M=v===_-1,I=[];for(let e=m[v],t=M?m.length:m[v+1];e<t;e++){const t=e===g-1,p=x+".mesh."+e,d=Uy(c.subarray(4*e,4*e+3)),m=c[4*e+3]/255;i.createMesh(y.apply(w,{id:p,primitive:"triangles",positionsCompressed:r.subarray(h[e],t?r.length:h[e+1]),normalsCompressed:o.subarray(h[e],t?r.length:h[e+1]),indices:n.subarray(l[e],t?n.length:l[e+1]),edgeIndices:a.subarray(u[e],t?a.length:u[e+1]),positionsDecodeMatrix:s.positionsDecodeMatrix,color:d,opacity:m})),I.push(p)}i.createEntity(y.apply(T,{id:x,isObject:1===f[v],meshIds:I}))}}(e,t,o,i)}};let Wy=window.pako||Hy;Wy.inflate||(Wy=Wy.default);const Xy=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const Yy={version:2,parse:function(e,t,s,i){const r=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],positionsDecodeMatrix:e[11],entityMeshIds:e[12],entityMatrices:e[13],entityUsesInstancing:e[14]}}(s),o=function(e){return{positions:new Uint16Array(Wy.inflate(e.positions).buffer),normals:new Int8Array(Wy.inflate(e.normals).buffer),indices:new Uint32Array(Wy.inflate(e.indices).buffer),edgeIndices:new Uint32Array(Wy.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(Wy.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(Wy.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(Wy.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(Wy.inflate(e.meshColors).buffer),entityIDs:Wy.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(Wy.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(Wy.inflate(e.entityIsObjects).buffer),positionsDecodeMatrix:new Float32Array(Wy.inflate(e.positionsDecodeMatrix).buffer),entityMeshIds:new Uint32Array(Wy.inflate(e.entityMeshIds).buffer),entityMatrices:new Float32Array(Wy.inflate(e.entityMatrices).buffer),entityUsesInstancing:new Uint8Array(Wy.inflate(e.entityUsesInstancing).buffer)}}(r);!function(e,t,s,i){i.positionsCompression="precompressed",i.normalsCompression="precompressed";const r=s.positions,o=s.normals,n=s.indices,a=s.edgeIndices,h=s.meshPositions,l=s.meshIndices,u=s.meshEdgesIndices,c=s.meshColors,d=JSON.parse(s.entityIDs),m=s.entityMeshes,f=s.entityIsObjects,g=s.entityMeshIds,_=s.entityMatrices,v=s.entityUsesInstancing,b=h.length,x=m.length,P={};for(let T=0;T<x;T++){const w=d[T],M=t.globalizeObjectIds?p.globalizeObjectId(i.id,w):w,I=e.metaScene.metaObjects[M],C={},D={},A=_.subarray(16*T,16*T+16);if(I){if(t.excludeTypesMap&&I.type&&t.excludeTypesMap[I.type])continue;if(t.includeTypesMap&&I.type&&!t.includeTypesMap[I.type])continue;const e=t.objectDefaults?t.objectDefaults[I.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(C.visible=!1),!1===e.pickable&&(C.pickable=!1),e.colorize&&(D.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(D.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;const E=T===x-1,F=[];for(let e=m[T],t=E?g.length:m[T+1];e<t;e++){const t=g[e],p=t===b-1,d=M+".mesh."+t,m=Xy(c.subarray(4*t,4*t+3)),f=c[4*t+3]/255,_=r.subarray(h[t],p?r.length:h[t+1]),x=o.subarray(h[t],p?r.length:h[t+1]),w=n.subarray(l[t],p?n.length:l[t+1]),I=a.subarray(u[t],p?a.length:u[t+1]);if(1===v[T]){const e="geometry."+t;e in P||(i.createGeometry({id:e,positionsCompressed:_,normalsCompressed:x,indices:w,edgeIndices:I,primitive:"triangles",positionsDecodeMatrix:s.positionsDecodeMatrix}),P[e]=!0),i.createMesh(y.apply(D,{id:d,color:m,opacity:f,matrix:A,geometryId:e})),F.push(d)}else i.createMesh(y.apply(D,{id:d,primitive:"triangles",positionsCompressed:_,normalsCompressed:x,indices:w,edgeIndices:I,positionsDecodeMatrix:s.positionsDecodeMatrix,color:m,opacity:f})),F.push(d)}F.length&&i.createEntity(y.apply(C,{id:M,isObject:1===f[T],meshIds:F}))}}(e,t,o,i)}};let Ky=window.pako||Hy;Ky.inflate||(Ky=Ky.default);const Jy=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const Zy={version:3,parse:function(e,t,s,i){const r=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],instancedPositionsDecodeMatrix:e[11],batchedPositionsDecodeMatrix:e[12],entityMeshIds:e[13],entityMatrices:e[14],entityUsesInstancing:e[15]}}(s),o=function(e){return{positions:new Uint16Array(Ky.inflate(e.positions).buffer),normals:new Int8Array(Ky.inflate(e.normals).buffer),indices:new Uint32Array(Ky.inflate(e.indices).buffer),edgeIndices:new Uint32Array(Ky.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(Ky.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(Ky.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(Ky.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(Ky.inflate(e.meshColors).buffer),entityIDs:Ky.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(Ky.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(Ky.inflate(e.entityIsObjects).buffer),instancedPositionsDecodeMatrix:new Float32Array(Ky.inflate(e.instancedPositionsDecodeMatrix).buffer),batchedPositionsDecodeMatrix:new Float32Array(Ky.inflate(e.batchedPositionsDecodeMatrix).buffer),entityMeshIds:new Uint32Array(Ky.inflate(e.entityMeshIds).buffer),entityMatrices:new Float32Array(Ky.inflate(e.entityMatrices).buffer),entityUsesInstancing:new Uint8Array(Ky.inflate(e.entityUsesInstancing).buffer)}}(r);!function(e,t,s,i){i.positionsCompression="precompressed",i.normalsCompression="precompressed";const r=s.positions,o=s.normals,n=s.indices,a=s.edgeIndices,h=s.meshPositions,l=s.meshIndices,u=s.meshEdgesIndices,c=s.meshColors,d=JSON.parse(s.entityIDs),m=s.entityMeshes,f=s.entityIsObjects,g=s.entityMeshIds,_=s.entityMatrices,v=s.entityUsesInstancing,b=h.length,x=m.length,P={};for(let A=0;A<x;A++){const E=d[A],F=t.globalizeObjectIds?p.globalizeObjectId(i.id,E):E,R=e.metaScene.metaObjects[F],S={},O={},B=_.subarray(16*A,16*A+16);if(R){if(t.excludeTypesMap&&R.type&&t.excludeTypesMap[R.type])continue;if(t.includeTypesMap&&R.type&&!t.includeTypesMap[R.type])continue;const e=t.objectDefaults?t.objectDefaults[R.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(S.visible=!1),!1===e.pickable&&(S.pickable=!1),e.colorize&&(O.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(O.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;const L=A===x-1,N=[];for(let e=m[A],t=L?g.length:m[A+1];e<t;e++){var T=g[e];const t=T===b-1,p=F+".mesh."+T,d=Jy(c.subarray(4*T,4*T+3)),m=c[4*T+3]/255;var w=r.subarray(h[T],t?r.length:h[T+1]),M=o.subarray(h[T],t?r.length:h[T+1]),I=n.subarray(l[T],t?n.length:l[T+1]),C=a.subarray(u[T],t?a.length:u[T+1]);if(1===v[A]){var D="geometry."+T;D in P||(i.createGeometry({id:D,positionsCompressed:w,normalsCompressed:M,indices:I,edgeIndices:C,primitive:"triangles",positionsDecodeMatrix:s.instancedPositionsDecodeMatrix}),P[D]=!0),i.createMesh(y.apply(O,{id:p,color:d,opacity:m,matrix:B,geometryId:D})),N.push(p)}else i.createMesh(y.apply(O,{id:p,primitive:"triangles",positionsCompressed:w,normalsCompressed:M,indices:I,edgeIndices:C,positionsDecodeMatrix:s.batchedPositionsDecodeMatrix,color:d,opacity:m})),N.push(p)}N.length&&i.createEntity(y.apply(S,{id:F,isObject:1===f[A],meshIds:N}))}}(e,t,o,i)}};let Qy=window.pako||Hy;Qy.inflate||(Qy=Qy.default);const qy=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const $y={version:4,parse:function(e,t,s,i){const r=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],decodeMatrices:e[4],matrices:e[5],eachPrimitivePositionsAndNormalsPortion:e[6],eachPrimitiveIndicesPortion:e[7],eachPrimitiveEdgeIndicesPortion:e[8],eachPrimitiveDecodeMatricesPortion:e[9],eachPrimitiveColor:e[10],primitiveInstances:e[11],eachEntityId:e[12],eachEntityPrimitiveInstancesPortion:e[13],eachEntityMatricesPortion:e[14],eachEntityMatrix:e[15]}}(s),o=function(e){return{positions:new Uint16Array(Qy.inflate(e.positions).buffer),normals:new Int8Array(Qy.inflate(e.normals).buffer),indices:new Uint32Array(Qy.inflate(e.indices).buffer),edgeIndices:new Uint32Array(Qy.inflate(e.edgeIndices).buffer),decodeMatrices:new Float32Array(Qy.inflate(e.decodeMatrices).buffer),matrices:new Float32Array(Qy.inflate(e.matrices).buffer),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(Qy.inflate(e.eachPrimitivePositionsAndNormalsPortion).buffer),eachPrimitiveIndicesPortion:new Uint32Array(Qy.inflate(e.eachPrimitiveIndicesPortion).buffer),eachPrimitiveEdgeIndicesPortion:new Uint32Array(Qy.inflate(e.eachPrimitiveEdgeIndicesPortion).buffer),eachPrimitiveDecodeMatricesPortion:new Uint32Array(Qy.inflate(e.eachPrimitiveDecodeMatricesPortion).buffer),eachPrimitiveColor:new Uint8Array(Qy.inflate(e.eachPrimitiveColor).buffer),primitiveInstances:new Uint32Array(Qy.inflate(e.primitiveInstances).buffer),eachEntityId:Qy.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(Qy.inflate(e.eachEntityPrimitiveInstancesPortion).buffer),eachEntityMatricesPortion:new Uint32Array(Qy.inflate(e.eachEntityMatricesPortion).buffer)}}(r);!function(e,t,s,i){i.positionsCompression="precompressed",i.normalsCompression="precompressed";const r=s.positions,o=s.normals,n=s.indices,a=s.edgeIndices,h=s.decodeMatrices,l=s.matrices,u=s.eachPrimitivePositionsAndNormalsPortion,c=s.eachPrimitiveIndicesPortion,p=s.eachPrimitiveEdgeIndicesPortion,d=s.eachPrimitiveDecodeMatricesPortion,m=s.eachPrimitiveColor,f=s.primitiveInstances,g=JSON.parse(s.eachEntityId),_=s.eachEntityPrimitiveInstancesPortion,v=s.eachEntityMatricesPortion,b=u.length,x=f.length,P=new Uint8Array(b),T=new Uint32Array(b),w=g.length;for(let e=0;e<b;e++)T[e]=e;T.sort(((e,t)=>d[e]<d[t]?-1:d[e]>d[t]?1:0));for(let e=0;e<x;e++)P[f[e]]++;const M={};for(let e=0;e<w;e++){const t=w-1,s=e===t,i=_[e],r=s?_[t]:_[e+1];for(let t=i;t<r;t++){const s=f[t];P[s]>1||(M[s]=e)}}for(let e=0;e<b;e++){const t=T[e],s=t===b-1,l=P[t]>1,f=qy(m.subarray(4*t,4*t+3)),_=m[4*t+3]/255,v=r.subarray(u[t],s?r.length:u[t+1]),x=o.subarray(u[t],s?o.length:u[t+1]),w=n.subarray(c[t],s?n.length:c[t+1]),C=a.subarray(p[t],s?a.length:p[t+1]),D=h.subarray(d[t],d[t]+16);if(l){var I="geometry"+t;i.createGeometry({id:I,primitive:"triangles",positionsCompressed:v,normalsCompressed:x,indices:w,edgeIndices:C,positionsDecodeMatrix:D})}else{const e=t;g[M[t]];const s={};i.createMesh(y.apply(s,{id:e,primitive:"triangles",positionsCompressed:v,normalsCompressed:x,indices:w,edgeIndices:C,positionsDecodeMatrix:D,color:f,opacity:_}))}}let C=0;for(let e=0;e<w;e++){const t=w-1,s=e===t,r=g[e],o=_[e],n=s?_[t]:_[e+1],a=[];for(let t=o;t<n;t++){const s=f[t];if(P[s]>1){const t={},r="instance."+C++,o="geometry"+s,n=16*v[e],h=l.subarray(n,n+16);i.createMesh(y.apply(t,{id:r,geometryId:o,matrix:h})),a.push(r)}else a.push(s)}if(a.length>0){const e={};i.createEntity(y.apply(e,{id:r,isObject:!0,meshIds:a}))}}}(0,0,o,i)}};let ev=window.pako||Hy;ev.inflate||(ev=ev.default);const tv=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const sv={version:5,parse:function(e,t,s,i){const r=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],matrices:e[4],eachPrimitivePositionsAndNormalsPortion:e[5],eachPrimitiveIndicesPortion:e[6],eachPrimitiveEdgeIndicesPortion:e[7],eachPrimitiveColor:e[8],primitiveInstances:e[9],eachEntityId:e[10],eachEntityPrimitiveInstancesPortion:e[11],eachEntityMatricesPortion:e[12]}}(s),o=function(e){return{positions:new Float32Array(ev.inflate(e.positions).buffer),normals:new Int8Array(ev.inflate(e.normals).buffer),indices:new Uint32Array(ev.inflate(e.indices).buffer),edgeIndices:new Uint32Array(ev.inflate(e.edgeIndices).buffer),matrices:new Float32Array(ev.inflate(e.matrices).buffer),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(ev.inflate(e.eachPrimitivePositionsAndNormalsPortion).buffer),eachPrimitiveIndicesPortion:new Uint32Array(ev.inflate(e.eachPrimitiveIndicesPortion).buffer),eachPrimitiveEdgeIndicesPortion:new Uint32Array(ev.inflate(e.eachPrimitiveEdgeIndicesPortion).buffer),eachPrimitiveColor:new Uint8Array(ev.inflate(e.eachPrimitiveColor).buffer),primitiveInstances:new Uint32Array(ev.inflate(e.primitiveInstances).buffer),eachEntityId:ev.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(ev.inflate(e.eachEntityPrimitiveInstancesPortion).buffer),eachEntityMatricesPortion:new Uint32Array(ev.inflate(e.eachEntityMatricesPortion).buffer)}}(r);!function(e,t,s,i){i.positionsCompression="disabled",i.normalsCompression="precompressed";const r=s.positions,o=s.normals,n=s.indices,a=s.edgeIndices,h=s.matrices,l=s.eachPrimitivePositionsAndNormalsPortion,u=s.eachPrimitiveIndicesPortion,c=s.eachPrimitiveEdgeIndicesPortion,p=s.eachPrimitiveColor,d=s.primitiveInstances,m=JSON.parse(s.eachEntityId),f=s.eachEntityPrimitiveInstancesPortion,g=s.eachEntityMatricesPortion,_=l.length,v=d.length,b=new Uint8Array(_),x=m.length;for(let e=0;e<v;e++)b[d[e]]++;const P={};for(let e=0;e<x;e++){const t=x-1,s=e===t,i=f[e],r=s?f[t]:f[e+1];for(let t=i;t<r;t++){const s=d[t];b[s]>1||(P[s]=e)}}for(let e=0;e<_;e++){const t=e===_-1,s=b[e]>1,h=tv(p.subarray(4*e,4*e+3)),d=p[4*e+3]/255,f=r.subarray(l[e],t?r.length:l[e+1]),g=o.subarray(l[e],t?o.length:l[e+1]),v=n.subarray(u[e],t?n.length:u[e+1]),x=a.subarray(c[e],t?a.length:c[e+1]);if(s){var T="geometry"+e;i.createGeometry({id:T,primitive:"triangles",positionsCompressed:f,normalsCompressed:g,indices:v,edgeIndices:x})}else{const t=e;m[P[e]];const s={};i.createMesh(y.apply(s,{id:t,primitive:"triangles",positionsCompressed:f,normalsCompressed:g,indices:v,edgeIndices:x,color:h,opacity:d}))}}let w=0;for(let e=0;e<x;e++){const t=x-1,s=e===t,r=m[e],o=f[e],n=s?f[t]:f[e+1],a=[];for(let t=o;t<n;t++){const s=d[t];if(b[s]>1){const t={},r="instance."+w++,o="geometry"+s,n=16*g[e],l=h.subarray(n,n+16);i.createMesh(y.apply(t,{id:r,geometryId:o,matrix:l})),a.push(r)}else a.push(s)}if(a.length>0){const e={};i.createEntity(y.apply(e,{id:r,isObject:!0,meshIds:a}))}}}(0,0,o,i)}};let iv=window.pako||Hy;iv.inflate||(iv=iv.default);const rv=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const ov={version:6,parse:function(e,t,s,i){const r=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],matrices:e[4],reusedPrimitivesDecodeMatrix:e[5],eachPrimitivePositionsAndNormalsPortion:e[6],eachPrimitiveIndicesPortion:e[7],eachPrimitiveEdgeIndicesPortion:e[8],eachPrimitiveColorAndOpacity:e[9],primitiveInstances:e[10],eachEntityId:e[11],eachEntityPrimitiveInstancesPortion:e[12],eachEntityMatricesPortion:e[13],eachTileAABB:e[14],eachTileEntitiesPortion:e[15]}}(s),o=function(e){function t(e,t){return 0===e.length?[]:iv.inflate(e,t).buffer}return{positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedPrimitivesDecodeMatrix:new Float32Array(t(e.reusedPrimitivesDecodeMatrix)),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(t(e.eachPrimitivePositionsAndNormalsPortion)),eachPrimitiveIndicesPortion:new Uint32Array(t(e.eachPrimitiveIndicesPortion)),eachPrimitiveEdgeIndicesPortion:new Uint32Array(t(e.eachPrimitiveEdgeIndicesPortion)),eachPrimitiveColorAndOpacity:new Uint8Array(t(e.eachPrimitiveColorAndOpacity)),primitiveInstances:new Uint32Array(t(e.primitiveInstances)),eachEntityId:iv.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(t(e.eachEntityPrimitiveInstancesPortion)),eachEntityMatricesPortion:new Uint32Array(t(e.eachEntityMatricesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(r);!function(e,t,s,i){const r=s.positions,o=s.normals,n=s.indices,a=s.edgeIndices,h=s.matrices,l=s.reusedPrimitivesDecodeMatrix,u=s.eachPrimitivePositionsAndNormalsPortion,c=s.eachPrimitiveIndicesPortion,d=s.eachPrimitiveEdgeIndicesPortion,m=s.eachPrimitiveColorAndOpacity,f=s.primitiveInstances,g=JSON.parse(s.eachEntityId),_=s.eachEntityPrimitiveInstancesPortion,v=s.eachEntityMatricesPortion,b=s.eachTileAABB,x=s.eachTileEntitiesPortion,P=u.length,T=f.length,w=g.length,M=x.length;let I=0;const C=new Uint32Array(P);for(let e=0;e<T;e++){const t=f[e];void 0!==C[t]?C[t]++:C[t]=1}const D=p.vec3(),A=p.AABB3();for(let s=0;s<M;s++){const T=s===M-1,E=x[s],F=T?w:x[s+1],R=6*s,S=b.subarray(R,R+6);p.getAABB3Center(S,D),A[0]=S[0]-D[0],A[1]=S[1]-D[1],A[2]=S[2]-D[2],A[3]=S[3]-D[0],A[4]=S[4]-D[1],A[5]=S[5]-D[2];const O=Pt.createPositionsDecodeMatrix(A),B={};for(let b=E;b<F;b++){const x=g[b],T=t.globalizeObjectIds?p.globalizeObjectId(i.id,x):x,M=v[b],A=h.slice(M,M+16),E=b===w-1,F=_[b],R=E?f.length:_[b+1],S=[],L=e.metaScene.metaObjects[T],N={},k={};if(L){if(t.excludeTypesMap&&L.type&&t.excludeTypesMap[L.type])continue;if(t.includeTypesMap&&L.type&&!t.includeTypesMap[L.type])continue;const e=t.objectDefaults?t.objectDefaults[L.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(N.visible=!1),!1===e.pickable&&(N.pickable=!1),e.colorize&&(k.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(k.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;for(let e=F;e<R;e++){const t=f[e],h=C[t]>1,p=t===P-1,g=r.subarray(u[t],p?r.length:u[t+1]),_=o.subarray(u[t],p?o.length:u[t+1]),v=n.subarray(c[t],p?n.length:c[t+1]),b=a.subarray(d[t],p?a.length:d[t+1]),x=rv(m.subarray(4*t,4*t+3)),T=m[4*t+3]/255,w=I++;if(h){const e="geometry."+s+"."+t;B[e]||(i.createGeometry({id:e,primitive:"triangles",positionsCompressed:g,normalsCompressed:_,indices:v,edgeIndices:b,positionsDecodeMatrix:l}),B[e]=!0),i.createMesh(y.apply(k,{id:w,geometryId:e,origin:D,matrix:A,color:x,opacity:T})),S.push(w)}else i.createMesh(y.apply(k,{id:w,origin:D,primitive:"triangles",positionsCompressed:g,normalsCompressed:_,indices:v,edgeIndices:b,positionsDecodeMatrix:O,color:x,opacity:T})),S.push(w)}S.length>0&&i.createEntity(y.apply(N,{id:T,isObject:!0,meshIds:S}))}}}(e,t,o,i)}};let nv=window.pako||Hy;nv.inflate||(nv=nv.default);const av=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function hv(e){const t=[];for(let s=0,i=e.length;s<i;s+=3)t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]),t.push(1);return t}const lv={version:7,parse:function(e,t,s,i){const r=function(e){return{positions:e[0],normals:e[1],colors:e[2],indices:e[3],edgeIndices:e[4],matrices:e[5],reusedGeometriesDecodeMatrix:e[6],eachGeometryPrimitiveType:e[7],eachGeometryPositionsPortion:e[8],eachGeometryNormalsPortion:e[9],eachGeometryColorsPortion:e[10],eachGeometryIndicesPortion:e[11],eachGeometryEdgeIndicesPortion:e[12],eachMeshGeometriesPortion:e[13],eachMeshMatricesPortion:e[14],eachMeshMaterial:e[15],eachEntityId:e[16],eachEntityMeshesPortion:e[17],eachTileAABB:e[18],eachTileEntitiesPortion:e[19]}}(s),o=function(e){function t(e,t){return 0===e.length?[]:nv.inflate(e,t).buffer}return{positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityId:nv.inflate(e.eachEntityId,{to:"string"}),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(r);!function(e,t,s,i){const r=s.positions,o=s.normals,n=s.colors,a=s.indices,h=s.edgeIndices,l=s.matrices,u=s.reusedGeometriesDecodeMatrix,c=s.eachGeometryPrimitiveType,d=s.eachGeometryPositionsPortion,m=s.eachGeometryNormalsPortion,f=s.eachGeometryColorsPortion,g=s.eachGeometryIndicesPortion,_=s.eachGeometryEdgeIndicesPortion,v=s.eachMeshGeometriesPortion,b=s.eachMeshMatricesPortion,x=s.eachMeshMaterial,P=JSON.parse(s.eachEntityId),T=s.eachEntityMeshesPortion,w=s.eachTileAABB,M=s.eachTileEntitiesPortion,I=d.length,C=v.length,D=P.length,A=M.length;let E=0;const F=new Uint32Array(I);for(let e=0;e<C;e++){const t=v[e];void 0!==F[t]?F[t]++:F[t]=1}const R=p.vec3(),S=p.AABB3();for(let s=0;s<A;s++){const C=s===A-1,O=M[s],B=C?D:M[s+1],L=6*s,N=w.subarray(L,L+6);p.getAABB3Center(N,R),S[0]=N[0]-R[0],S[1]=N[1]-R[1],S[2]=N[2]-R[2],S[3]=N[3]-R[0],S[4]=N[4]-R[1],S[5]=N[5]-R[2];const k=Pt.createPositionsDecodeMatrix(S),j={};for(let w=O;w<B;w++){const M=P[w],C=t.globalizeObjectIds?p.globalizeObjectId(i.id,M):M,A=w===D-1,S=T[w],O=A?v.length:T[w+1],B=[],L=e.metaScene.metaObjects[C],N={},G={};if(L){if(t.excludeTypesMap&&L.type&&t.excludeTypesMap[L.type])continue;if(t.includeTypesMap&&L.type&&!t.includeTypesMap[L.type])continue;const e=t.objectDefaults?t.objectDefaults[L.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(N.visible=!1),!1===e.pickable&&(N.pickable=!1),e.colorize&&(G.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(G.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(G.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(G.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let e=S;e<O;e++){const t=v[e],p=F[t]>1,P=t===I-1,T=av(x.subarray(6*e,6*e+3)),w=x[6*e+3]/255,M=x[6*e+4]/255,C=x[6*e+5]/255,D=E++;if(p){const p=b[e],v=l.slice(p,p+16),x="geometry."+s+"."+t;if(!j[x]){let e,s,l,p,y,v;switch(c[t]){case 0:e="solid",s=r.subarray(d[t],P?r.length:d[t+1]),l=o.subarray(m[t],P?o.length:m[t+1]),y=a.subarray(g[t],P?a.length:g[t+1]),v=h.subarray(_[t],P?h.length:_[t+1]);break;case 1:e="surface",s=r.subarray(d[t],P?r.length:d[t+1]),l=o.subarray(m[t],P?o.length:m[t+1]),y=a.subarray(g[t],P?a.length:g[t+1]),v=h.subarray(_[t],P?h.length:_[t+1]);break;case 2:e="points",s=r.subarray(d[t],P?r.length:d[t+1]),p=hv(n.subarray(f[t],P?n.length:f[t+1]));break;case 3:e="lines",s=r.subarray(d[t],P?r.length:d[t+1]),y=a.subarray(g[t],P?a.length:g[t+1]);break;default:continue}i.createGeometry({id:x,primitive:e,positionsCompressed:s,normalsCompressed:l,colors:p,indices:y,edgeIndices:v,positionsDecodeMatrix:u}),j[x]=!0}i.createMesh(y.apply(G,{id:D,geometryId:x,origin:R,matrix:v,color:T,metallic:M,roughness:C,opacity:w})),B.push(D)}else{let e,s,l,u,p,v;switch(c[t]){case 0:e="solid",s=r.subarray(d[t],P?r.length:d[t+1]),l=o.subarray(m[t],P?o.length:m[t+1]),p=a.subarray(g[t],P?a.length:g[t+1]),v=h.subarray(_[t],P?h.length:_[t+1]);break;case 1:e="surface",s=r.subarray(d[t],P?r.length:d[t+1]),l=o.subarray(m[t],P?o.length:m[t+1]),p=a.subarray(g[t],P?a.length:g[t+1]),v=h.subarray(_[t],P?h.length:_[t+1]);break;case 2:e="points",s=r.subarray(d[t],P?r.length:d[t+1]),u=hv(n.subarray(f[t],P?n.length:f[t+1]));break;case 3:e="lines",s=r.subarray(d[t],P?r.length:d[t+1]),p=a.subarray(g[t],P?a.length:g[t+1]);break;default:continue}i.createMesh(y.apply(G,{id:D,origin:R,primitive:e,positionsCompressed:s,normalsCompressed:l,colors:u,indices:p,edgeIndices:v,positionsDecodeMatrix:k,color:T,metallic:M,roughness:C,opacity:w})),B.push(D)}}B.length>0&&i.createEntity(y.apply(N,{id:C,isObject:!0,meshIds:B}))}}}(e,t,o,i)}};let uv=window.pako||Hy;uv.inflate||(uv=uv.default);const cv=p.vec4(),pv=p.vec4();const dv=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function mv(e){const t=[];for(let s=0,i=e.length;s<i;s+=3)t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]),t.push(1);return t}const fv={version:8,parse:function(e,t,s,i){const r=function(e){return{types:e[0],eachMetaObjectId:e[1],eachMetaObjectType:e[2],eachMetaObjectName:e[3],eachMetaObjectParent:e[4],positions:e[5],normals:e[6],colors:e[7],indices:e[8],edgeIndices:e[9],matrices:e[10],reusedGeometriesDecodeMatrix:e[11],eachGeometryPrimitiveType:e[12],eachGeometryPositionsPortion:e[13],eachGeometryNormalsPortion:e[14],eachGeometryColorsPortion:e[15],eachGeometryIndicesPortion:e[16],eachGeometryEdgeIndicesPortion:e[17],eachMeshGeometriesPortion:e[18],eachMeshMatricesPortion:e[19],eachMeshMaterial:e[20],eachEntityMetaObject:e[21],eachEntityMeshesPortion:e[22],eachTileAABB:e[23],eachTileEntitiesPortion:e[24]}}(s),o=function(e){function t(e,t){return 0===e.length?[]:uv.inflate(e,t).buffer}return{types:uv.inflate(e.types,{to:"string"}),eachMetaObjectId:uv.inflate(e.eachMetaObjectId,{to:"string"}),eachMetaObjectType:new Uint32Array(t(e.eachMetaObjectType)),eachMetaObjectName:uv.inflate(e.eachMetaObjectName,{to:"string"}),eachMetaObjectParent:new Uint32Array(t(e.eachMetaObjectParent)),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityMetaObject:new Uint32Array(t(e.eachEntityMetaObject)),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(r);!function(e,t,s,i){const r=JSON.parse(s.types),o=JSON.parse(s.eachMetaObjectId),n=s.eachMetaObjectType,a=JSON.parse(s.eachMetaObjectName),h=s.eachMetaObjectParent,l=s.positions,u=s.normals,c=s.colors,d=s.indices,m=s.edgeIndices,f=s.matrices,g=s.reusedGeometriesDecodeMatrix,_=s.eachGeometryPrimitiveType,v=s.eachGeometryPositionsPortion,b=s.eachGeometryNormalsPortion,x=s.eachGeometryColorsPortion,P=s.eachGeometryIndicesPortion,T=s.eachGeometryEdgeIndicesPortion,w=s.eachMeshGeometriesPortion,M=s.eachMeshMatricesPortion,I=s.eachMeshMaterial,C=s.eachEntityMetaObject,D=s.eachEntityMeshesPortion,A=s.eachTileAABB,E=s.eachTileEntitiesPortion,F=o.length,R=v.length,S=w.length,O=C.length,B=E.length;let L=0;const N=i.id;if(!e.metaScene.metaModels[N]){const s={metaObjects:[]};for(let e=0;e<F;e++){const t=o[e],i=r[n[e]]||"default",l=a[e],u=h[e],c=u!==e?o[u]:null;s.metaObjects.push({id:t,type:i,name:l,parent:c})}e.metaScene.createMetaModel(N,s,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds}),i.once("destroyed",(()=>{e.metaScene.destroyMetaModel(N)}))}const k=new Uint32Array(R);for(let e=0;e<S;e++){const t=w[e];void 0!==k[t]?k[t]++:k[t]=1}const j=p.vec3(),G=p.AABB3(),H={};for(let s=0;s<B;s++){const r=s===B-1,n=E[s],a=r?O:E[s+1],h=6*s,F=A.subarray(h,h+6);p.getAABB3Center(F,j),G[0]=F[0]-j[0],G[1]=F[1]-j[1],G[2]=F[2]-j[2],G[3]=F[3]-j[0],G[4]=F[4]-j[1],G[5]=F[5]-j[2];const S=Pt.createPositionsDecodeMatrix(G),N={};for(let r=n;r<a;r++){const n=o[C[r]],a=t.globalizeObjectIds?p.globalizeObjectId(i.id,n):n,h=r===O-1,A=D[r],E=h?w.length:D[r+1],F=[],B=e.metaScene.metaObjects[a],V={},U={};if(B){if(t.excludeTypesMap&&B.type&&t.excludeTypesMap[B.type])continue;if(t.includeTypesMap&&B.type&&!t.includeTypesMap[B.type])continue;const e=t.objectDefaults?t.objectDefaults[B.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(V.visible=!1),!1===e.pickable&&(V.pickable=!1),e.colorize&&(U.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(U.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(U.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(U.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let e=A;e<E;e++){const r=w[e],o=k[r]>1,n=r===R-1,a=dv(I.subarray(6*e,6*e+3)),h=I[6*e+3]/255,C=I[6*e+4]/255,D=I[6*e+5]/255,A=L++;if(o){const o=M[e],w=f.slice(o,o+16),I="geometry."+s+"."+r;let E=H[I];if(!E){E={batchThisMesh:!t.reuseGeometries};let e=!1;switch(_[r]){case 0:E.primitiveName="solid",E.geometryPositions=l.subarray(v[r],n?l.length:v[r+1]),E.geometryNormals=u.subarray(b[r],n?u.length:b[r+1]),E.geometryIndices=d.subarray(P[r],n?d.length:P[r+1]),E.geometryEdgeIndices=m.subarray(T[r],n?m.length:T[r+1]),e=E.geometryPositions.length>0&&E.geometryIndices.length>0;break;case 1:E.primitiveName="surface",E.geometryPositions=l.subarray(v[r],n?l.length:v[r+1]),E.geometryNormals=u.subarray(b[r],n?u.length:b[r+1]),E.geometryIndices=d.subarray(P[r],n?d.length:P[r+1]),E.geometryEdgeIndices=m.subarray(T[r],n?m.length:T[r+1]),e=E.geometryPositions.length>0&&E.geometryIndices.length>0;break;case 2:E.primitiveName="points",E.geometryPositions=l.subarray(v[r],n?l.length:v[r+1]),E.geometryColors=mv(c.subarray(x[r],n?c.length:x[r+1])),e=E.geometryPositions.length>0;break;case 3:E.primitiveName="lines",E.geometryPositions=l.subarray(v[r],n?l.length:v[r+1]),E.geometryIndices=d.subarray(P[r],n?d.length:P[r+1]),e=E.geometryPositions.length>0&&E.geometryIndices.length>0;break;default:continue}if(e||(E=null),E&&(E.geometryPositions.length,E.batchThisMesh)){E.decompressedPositions=new Float32Array(E.geometryPositions.length);const e=E.geometryPositions,t=E.decompressedPositions;for(let s=0,i=e.length;s<i;s+=3)t[s+0]=e[s+0]*g[0]+g[12],t[s+1]=e[s+1]*g[5]+g[13],t[s+2]=e[s+2]*g[10]+g[14];E.geometryPositions=null,H[I]=E}}if(E)if(E.batchThisMesh){const e=E.decompressedPositions,t=new Uint16Array(e.length);for(let s=0,i=e.length;s<i;s+=3)cv[0]=e[s+0],cv[1]=e[s+1],cv[2]=e[s+2],cv[3]=1,p.transformVec4(w,cv,pv),Pt.compressPosition(pv,G,cv),t[s+0]=cv[0],t[s+1]=cv[1],t[s+2]=cv[2];i.createMesh(y.apply(U,{id:A,origin:j,primitive:E.primitiveName,positionsCompressed:t,normalsCompressed:E.geometryNormals,colorsCompressed:E.geometryColors,indices:E.geometryIndices,edgeIndices:E.geometryEdgeIndices,positionsDecodeMatrix:S,color:a,metallic:C,roughness:D,opacity:h})),F.push(A)}else N[I]||(i.createGeometry({id:I,primitive:E.primitiveName,positionsCompressed:E.geometryPositions,normalsCompressed:E.geometryNormals,colorsCompressed:E.geometryColors,indices:E.geometryIndices,edgeIndices:E.geometryEdgeIndices,positionsDecodeMatrix:g}),N[I]=!0),i.createMesh(y.apply(U,{id:A,geometryId:I,origin:j,matrix:w,color:a,metallic:C,roughness:D,opacity:h})),F.push(A)}else{let e,t,s,o,p,f,g=!1;switch(_[r]){case 0:e="solid",t=l.subarray(v[r],n?l.length:v[r+1]),s=u.subarray(b[r],n?u.length:b[r+1]),p=d.subarray(P[r],n?d.length:P[r+1]),f=m.subarray(T[r],n?m.length:T[r+1]),g=t.length>0&&p.length>0;break;case 1:e="surface",t=l.subarray(v[r],n?l.length:v[r+1]),s=u.subarray(b[r],n?u.length:b[r+1]),p=d.subarray(P[r],n?d.length:P[r+1]),f=m.subarray(T[r],n?m.length:T[r+1]),g=t.length>0&&p.length>0;break;case 2:e="points",t=l.subarray(v[r],n?l.length:v[r+1]),o=mv(c.subarray(x[r],n?c.length:x[r+1])),g=t.length>0;break;case 3:e="lines",t=l.subarray(v[r],n?l.length:v[r+1]),p=d.subarray(P[r],n?d.length:P[r+1]),g=t.length>0&&p.length>0;break;default:continue}g&&(i.createMesh(y.apply(U,{id:A,origin:j,primitive:e,positionsCompressed:t,normalsCompressed:s,colorsCompressed:o,indices:p,edgeIndices:f,positionsDecodeMatrix:S,color:a,metallic:C,roughness:D,opacity:h})),F.push(A))}}F.length>0&&i.createEntity(y.apply(V,{id:a,isObject:!0,meshIds:F}))}}}(e,t,o,i)}};let gv=window.pako||Hy;gv.inflate||(gv=gv.default);const _v=p.vec4(),yv=p.vec4();const vv=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const bv={version:9,parse:function(e,t,s,i){const r=function(e){return{metadata:e[0],positions:e[1],normals:e[2],colors:e[3],indices:e[4],edgeIndices:e[5],matrices:e[6],reusedGeometriesDecodeMatrix:e[7],eachGeometryPrimitiveType:e[8],eachGeometryPositionsPortion:e[9],eachGeometryNormalsPortion:e[10],eachGeometryColorsPortion:e[11],eachGeometryIndicesPortion:e[12],eachGeometryEdgeIndicesPortion:e[13],eachMeshGeometriesPortion:e[14],eachMeshMatricesPortion:e[15],eachMeshMaterial:e[16],eachEntityId:e[17],eachEntityMeshesPortion:e[18],eachTileAABB:e[19],eachTileEntitiesPortion:e[20]}}(s),o=function(e){function t(e,t){return 0===e.length?[]:gv.inflate(e,t).buffer}return{metadata:JSON.parse(gv.inflate(e.metadata,{to:"string"})),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityId:JSON.parse(gv.inflate(e.eachEntityId,{to:"string"})),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(r);!function(e,t,s,i){const r=s.metadata,o=s.positions,n=s.normals,a=s.colors,h=s.indices,l=s.edgeIndices,u=s.matrices,c=s.reusedGeometriesDecodeMatrix,d=s.eachGeometryPrimitiveType,m=s.eachGeometryPositionsPortion,f=s.eachGeometryNormalsPortion,g=s.eachGeometryColorsPortion,_=s.eachGeometryIndicesPortion,v=s.eachGeometryEdgeIndicesPortion,b=s.eachMeshGeometriesPortion,x=s.eachMeshMatricesPortion,P=s.eachMeshMaterial,T=s.eachEntityId,w=s.eachEntityMeshesPortion,M=s.eachTileAABB,I=s.eachTileEntitiesPortion,C=m.length,D=b.length,A=w.length,E=I.length;let F=0;const R=i.id;e.metaScene.metaModels[R]||(e.metaScene.createMetaModel(R,r,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds}),i.once("destroyed",(()=>{e.metaScene.destroyMetaModel(R)})));const S=new Uint32Array(C);for(let e=0;e<D;e++){const t=b[e];void 0!==S[t]?S[t]++:S[t]=1}const O=p.vec3(),B=p.AABB3(),L={};for(let s=0;s<E;s++){const r=s===E-1,D=I[s],R=r?A-1:I[s+1]-1,N=6*s,k=M.subarray(N,N+6);p.getAABB3Center(k,O),B[0]=k[0]-O[0],B[1]=k[1]-O[1],B[2]=k[2]-O[2],B[3]=k[3]-O[0],B[4]=k[4]-O[1],B[5]=k[5]-O[2];const j=Pt.createPositionsDecodeMatrix(B),G={};for(let r=D;r<=R;r++){const M=T[r],I=t.globalizeObjectIds?p.globalizeObjectId(i.id,M):M,D=r===A-1,E=w[r],R=D?b.length-1:w[r+1]-1,N=[],k=e.metaScene.metaObjects[I],H={},V={};if(k){if(t.excludeTypesMap&&k.type&&t.excludeTypesMap[k.type])continue;if(t.includeTypesMap&&k.type&&!t.includeTypesMap[k.type])continue;const e=t.objectDefaults?t.objectDefaults[k.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(H.visible=!1),!1===e.pickable&&(H.pickable=!1),e.colorize&&(V.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(V.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(V.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(V.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let e=E;e<=R;e++){const r=b[e],T=S[r]>1,w=r===C-1,M=vv(P.subarray(6*e,6*e+3)),I=P[6*e+3]/255,D=P[6*e+4]/255,A=P[6*e+5]/255,E=F++;if(T){const b=x[e],P=u.slice(b,b+16),T="geometry."+s+"."+r;let C=L[T];if(!C){C={batchThisMesh:!t.reuseGeometries};let e=!1;switch(d[r]){case 0:C.primitiveName="solid",C.geometryPositions=o.subarray(m[r],w?o.length:m[r+1]),C.geometryNormals=n.subarray(f[r],w?n.length:f[r+1]),C.geometryIndices=h.subarray(_[r],w?h.length:_[r+1]),C.geometryEdgeIndices=l.subarray(v[r],w?l.length:v[r+1]),e=C.geometryPositions.length>0&&C.geometryIndices.length>0;break;case 1:C.primitiveName="surface",C.geometryPositions=o.subarray(m[r],w?o.length:m[r+1]),C.geometryNormals=n.subarray(f[r],w?n.length:f[r+1]),C.geometryIndices=h.subarray(_[r],w?h.length:_[r+1]),C.geometryEdgeIndices=l.subarray(v[r],w?l.length:v[r+1]),e=C.geometryPositions.length>0&&C.geometryIndices.length>0;break;case 2:C.primitiveName="points",C.geometryPositions=o.subarray(m[r],w?o.length:m[r+1]),C.geometryColors=a.subarray(g[r],w?a.length:g[r+1]),e=C.geometryPositions.length>0;break;case 3:C.primitiveName="lines",C.geometryPositions=o.subarray(m[r],w?o.length:m[r+1]),C.geometryIndices=h.subarray(_[r],w?h.length:_[r+1]),e=C.geometryPositions.length>0&&C.geometryIndices.length>0;break;default:continue}if(e||(C=null),C&&(C.geometryPositions.length,C.batchThisMesh)){C.decompressedPositions=new Float32Array(C.geometryPositions.length),C.transformedAndRecompressedPositions=new Uint16Array(C.geometryPositions.length);const e=C.geometryPositions,t=C.decompressedPositions;for(let s=0,i=e.length;s<i;s+=3)t[s+0]=e[s+0]*c[0]+c[12],t[s+1]=e[s+1]*c[5]+c[13],t[s+2]=e[s+2]*c[10]+c[14];C.geometryPositions=null,L[T]=C}}if(C)if(C.batchThisMesh){const e=C.decompressedPositions,t=C.transformedAndRecompressedPositions;for(let s=0,i=e.length;s<i;s+=3)_v[0]=e[s+0],_v[1]=e[s+1],_v[2]=e[s+2],_v[3]=1,p.transformVec4(P,_v,yv),Pt.compressPosition(yv,B,_v),t[s+0]=_v[0],t[s+1]=_v[1],t[s+2]=_v[2];i.createMesh(y.apply(V,{id:E,origin:O,primitive:C.primitiveName,positionsCompressed:t,normalsCompressed:C.geometryNormals,colorsCompressed:C.geometryColors,indices:C.geometryIndices,edgeIndices:C.geometryEdgeIndices,positionsDecodeMatrix:j,color:M,metallic:D,roughness:A,opacity:I})),N.push(E)}else G[T]||(i.createGeometry({id:T,primitive:C.primitiveName,positionsCompressed:C.geometryPositions,normalsCompressed:C.geometryNormals,colorsCompressed:C.geometryColors,indices:C.geometryIndices,edgeIndices:C.geometryEdgeIndices,positionsDecodeMatrix:c}),G[T]=!0),i.createMesh(y.apply(V,{id:E,geometryId:T,origin:O,matrix:P,color:M,metallic:D,roughness:A,opacity:I})),N.push(E)}else{let e,t,s,u,c,p,b=!1;switch(d[r]){case 0:e="solid",t=o.subarray(m[r],w?o.length:m[r+1]),s=n.subarray(f[r],w?n.length:f[r+1]),c=h.subarray(_[r],w?h.length:_[r+1]),p=l.subarray(v[r],w?l.length:v[r+1]),b=t.length>0&&c.length>0;break;case 1:e="surface",t=o.subarray(m[r],w?o.length:m[r+1]),s=n.subarray(f[r],w?n.length:f[r+1]),c=h.subarray(_[r],w?h.length:_[r+1]),p=l.subarray(v[r],w?l.length:v[r+1]),b=t.length>0&&c.length>0;break;case 2:e="points",t=o.subarray(m[r],w?o.length:m[r+1]),u=a.subarray(g[r],w?a.length:g[r+1]),b=t.length>0;break;case 3:e="lines",t=o.subarray(m[r],w?o.length:m[r+1]),c=h.subarray(_[r],w?h.length:_[r+1]),b=t.length>0&&c.length>0;break;default:continue}b&&(i.createMesh(y.apply(V,{id:E,origin:O,primitive:e,positionsCompressed:t,normalsCompressed:s,colorsCompressed:u,indices:c,edgeIndices:p,positionsDecodeMatrix:j,color:M,metallic:D,roughness:A,opacity:I})),N.push(E))}}N.length>0&&i.createEntity(y.apply(H,{id:I,isObject:!0,meshIds:N}))}}}(e,t,o,i)}};let xv=window.pako||Hy;xv.inflate||(xv=xv.default);const Pv=p.vec4(),Tv=p.vec4();const wv=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();!function(){const e=document.createElement("canvas"),t=e.getContext("2d")}();const Mv={version:10,parse:function(e,t,s,i){const r=function(e){let t=0;return{metadata:e[t++],textureData:e[t++],eachTextureDataPortion:e[t++],eachTextureAttributes:e[t++],positions:e[t++],normals:e[t++],colors:e[t++],uvs:e[t++],indices:e[t++],edgeIndices:e[t++],eachTextureSetTextures:e[t++],matrices:e[t++],reusedGeometriesDecodeMatrix:e[t++],eachGeometryPrimitiveType:e[t++],eachGeometryPositionsPortion:e[t++],eachGeometryNormalsPortion:e[t++],eachGeometryColorsPortion:e[t++],eachGeometryUVsPortion:e[t++],eachGeometryIndicesPortion:e[t++],eachGeometryEdgeIndicesPortion:e[t++],eachMeshGeometriesPortion:e[t++],eachMeshMatricesPortion:e[t++],eachMeshTextureSet:e[t++],eachMeshMaterialAttributes:e[t++],eachEntityId:e[t++],eachEntityMeshesPortion:e[t++],eachTileAABB:e[t++],eachTileEntitiesPortion:e[t++]}}(s),o=function(e){function t(e,t){return 0===e.length?[]:xv.inflate(e,t).buffer}return{metadata:JSON.parse(xv.inflate(e.metadata,{to:"string"})),textureData:new Uint8Array(t(e.textureData)),eachTextureDataPortion:new Uint32Array(t(e.eachTextureDataPortion)),eachTextureAttributes:new Uint16Array(t(e.eachTextureAttributes)),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),uvs:new Float32Array(t(e.uvs)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),eachTextureSetTextures:new Int32Array(t(e.eachTextureSetTextures)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryUVsPortion:new Uint32Array(t(e.eachGeometryUVsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshTextureSet:new Int32Array(t(e.eachMeshTextureSet)),eachMeshMaterialAttributes:new Uint8Array(t(e.eachMeshMaterialAttributes)),eachEntityId:JSON.parse(xv.inflate(e.eachEntityId,{to:"string"})),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(r);!function(e,t,s,i){const r=s.metadata,o=s.textureData,n=s.eachTextureDataPortion,a=s.eachTextureAttributes,h=s.positions,l=s.normals,u=s.colors,c=s.uvs,d=s.indices,m=s.edgeIndices,f=s.eachTextureSetTextures,g=s.matrices,_=s.reusedGeometriesDecodeMatrix,v=s.eachGeometryPrimitiveType,b=s.eachGeometryPositionsPortion,x=s.eachGeometryNormalsPortion,P=s.eachGeometryColorsPortion,T=s.eachGeometryUVsPortion,w=s.eachGeometryIndicesPortion,M=s.eachGeometryEdgeIndicesPortion,I=s.eachMeshGeometriesPortion,C=s.eachMeshMatricesPortion,D=s.eachMeshTextureSet,A=s.eachMeshMaterialAttributes,E=s.eachEntityId,F=s.eachEntityMeshesPortion,R=s.eachTileAABB,S=s.eachTileEntitiesPortion,O=n.length,B=f.length/5,L=b.length,N=I.length,k=F.length,j=S.length;let G=0;const H=i.id;e.metaScene.metaModels[H]||(e.metaScene.createMetaModel(H,r,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds}),i.once("destroyed",(()=>{e.metaScene.destroyMetaModel(H)})));for(let e=0;e<O;e++){const t=e===O-1,s=n[e],r=t?o.length:n[e+1],h=r-s>0,l=9*e,u=1===a[l+0],c=a[l+1];a[l+2],a[l+3];const p=a[l+4],d=a[l+5],m=a[l+6],f=a[l+7],g=a[l+8];if(h){const t=new Uint8Array(o.subarray(s,r)).buffer,n=`texture-${e}`;if(u)i.createTexture({id:n,buffers:[t],minFilter:p,magFilter:d,wrapS:m,wrapT:f,wrapR:g});else{const e=new Blob([t],{type:10001===c?"image/jpeg":10002===c?"image/png":"image/gif"}),s=(window.URL||window.webkitURL).createObjectURL(e),r=document.createElement("img");r.src=s,i.createTexture({id:n,image:r,minFilter:p,magFilter:d,wrapS:m,wrapT:f,wrapR:g})}}}for(let e=0;e<B;e++){const t=5*e,s=`textureSet-${e}`,r=f[t+0],o=f[t+1],n=f[t+2],a=f[t+3],h=f[t+4];i.createTextureSet({id:s,colorTextureId:r>=0?`texture-${r}`:null,normalsTextureId:n>=0?`texture-${n}`:null,metallicRoughnessTextureId:o>=0?`texture-${o}`:null,emissiveTextureId:a>=0?`texture-${a}`:null,occlusionTextureId:h>=0?`texture-${h}`:null})}const V=new Uint32Array(L);for(let e=0;e<N;e++){const t=I[e];void 0!==V[t]?V[t]++:V[t]=1}const U=p.vec3(),z=p.AABB3(),W={};for(let s=0;s<j;s++){const r=s===j-1,o=S[s],n=r?k-1:S[s+1]-1,a=6*s,f=R.subarray(a,a+6);p.getAABB3Center(f,U),z[0]=f[0]-U[0],z[1]=f[1]-U[1],z[2]=f[2]-U[2],z[3]=f[3]-U[0],z[4]=f[4]-U[1],z[5]=f[5]-U[2];const O=Pt.createPositionsDecodeMatrix(z),B={};for(let r=o;r<=n;r++){const o=E[r],n=t.globalizeObjectIds?p.globalizeObjectId(i.id,o):o,a=r===k-1,f=F[r],R=a?I.length-1:F[r+1]-1,S=[],N=e.metaScene.metaObjects[n],j={},H={};if(N){if(t.excludeTypesMap&&N.type&&t.excludeTypesMap[N.type])continue;if(t.includeTypesMap&&N.type&&!t.includeTypesMap[N.type])continue;const e=t.objectDefaults?t.objectDefaults[N.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(j.visible=!1),!1===e.pickable&&(j.pickable=!1),e.colorize&&(H.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(H.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(H.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(H.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let e=f;e<=R;e++){const r=I[e],o=V[r]>1,n=r===L-1,a=D[e],f=a>=0?`textureSet-${a}`:null,E=wv(A.subarray(6*e,6*e+3)),F=A[6*e+3]/255,R=A[6*e+4]/255,N=A[6*e+5]/255,k=G++;if(o){const o=C[e],a=g.slice(o,o+16),I="geometry."+s+"."+r;let D=W[I];if(!D){D={batchThisMesh:!t.reuseGeometries};let e=!1;switch(v[r]){case 0:D.primitiveName="solid",D.geometryPositions=h.subarray(b[r],n?h.length:b[r+1]),D.geometryNormals=l.subarray(x[r],n?l.length:x[r+1]),D.geometryUVs=c.subarray(T[r],n?c.length:T[r+1]),D.geometryIndices=d.subarray(w[r],n?d.length:w[r+1]),D.geometryEdgeIndices=m.subarray(M[r],n?m.length:M[r+1]),e=D.geometryPositions.length>0&&D.geometryIndices.length>0;break;case 1:D.primitiveName="surface",D.geometryPositions=h.subarray(b[r],n?h.length:b[r+1]),D.geometryNormals=l.subarray(x[r],n?l.length:x[r+1]),D.geometryUVs=c.subarray(T[r],n?c.length:T[r+1]),D.geometryIndices=d.subarray(w[r],n?d.length:w[r+1]),D.geometryEdgeIndices=m.subarray(M[r],n?m.length:M[r+1]),e=D.geometryPositions.length>0&&D.geometryIndices.length>0;break;case 2:D.primitiveName="points",D.geometryPositions=h.subarray(b[r],n?h.length:b[r+1]),D.geometryColors=u.subarray(P[r],n?u.length:P[r+1]),e=D.geometryPositions.length>0;break;case 3:D.primitiveName="lines",D.geometryPositions=h.subarray(b[r],n?h.length:b[r+1]),D.geometryIndices=d.subarray(w[r],n?d.length:w[r+1]),e=D.geometryPositions.length>0&&D.geometryIndices.length>0;break;default:continue}if(e||(D=null),D&&(D.geometryPositions.length,D.batchThisMesh)){D.decompressedPositions=new Float32Array(D.geometryPositions.length),D.transformedAndRecompressedPositions=new Uint16Array(D.geometryPositions.length);const e=D.geometryPositions,t=D.decompressedPositions;for(let s=0,i=e.length;s<i;s+=3)t[s+0]=e[s+0]*_[0]+_[12],t[s+1]=e[s+1]*_[5]+_[13],t[s+2]=e[s+2]*_[10]+_[14];D.geometryPositions=null,W[I]=D}}if(D)if(D.batchThisMesh){const e=D.decompressedPositions,t=D.transformedAndRecompressedPositions;for(let s=0,i=e.length;s<i;s+=3)Pv[0]=e[s+0],Pv[1]=e[s+1],Pv[2]=e[s+2],Pv[3]=1,p.transformVec4(a,Pv,Tv),Pt.compressPosition(Tv,z,Pv),t[s+0]=Pv[0],t[s+1]=Pv[1],t[s+2]=Pv[2];i.createMesh(y.apply(H,{id:k,textureSetId:f,origin:U,primitive:D.primitiveName,positionsCompressed:t,normalsCompressed:D.geometryNormals,uv:D.geometryUVs,colorsCompressed:D.geometryColors,indices:D.geometryIndices,edgeIndices:D.geometryEdgeIndices,positionsDecodeMatrix:O,color:E,metallic:R,roughness:N,opacity:F})),S.push(k)}else B[I]||(i.createGeometry({id:I,primitive:D.primitiveName,positionsCompressed:D.geometryPositions,normalsCompressed:D.geometryNormals,uv:D.geometryUVs,colorsCompressed:D.geometryColors,indices:D.geometryIndices,edgeIndices:D.geometryEdgeIndices,positionsDecodeMatrix:_}),B[I]=!0),i.createMesh(y.apply(H,{id:k,geometryId:I,textureSetId:f,matrix:a,color:E,metallic:R,roughness:N,opacity:F,origin:U})),S.push(k)}else{let e,t,s,o,a,p,g,_=!1;switch(v[r]){case 0:e="solid",t=h.subarray(b[r],n?h.length:b[r+1]),s=l.subarray(x[r],n?l.length:x[r+1]),o=c.subarray(T[r],n?c.length:T[r+1]),p=d.subarray(w[r],n?d.length:w[r+1]),g=m.subarray(M[r],n?m.length:M[r+1]),_=t.length>0&&p.length>0;break;case 1:e="surface",t=h.subarray(b[r],n?h.length:b[r+1]),s=l.subarray(x[r],n?l.length:x[r+1]),o=c.subarray(T[r],n?c.length:T[r+1]),p=d.subarray(w[r],n?d.length:w[r+1]),g=m.subarray(M[r],n?m.length:M[r+1]),_=t.length>0&&p.length>0;break;case 2:e="points",t=h.subarray(b[r],n?h.length:b[r+1]),a=u.subarray(P[r],n?u.length:P[r+1]),_=t.length>0;break;case 3:e="lines",t=h.subarray(b[r],n?h.length:b[r+1]),p=d.subarray(w[r],n?d.length:w[r+1]),_=t.length>0&&p.length>0;break;default:continue}_&&(i.createMesh(y.apply(H,{id:k,textureSetId:f,origin:U,primitive:e,positionsCompressed:t,normalsCompressed:s,uv:o&&o.length>0?o:null,colorsCompressed:a,indices:p,edgeIndices:g,positionsDecodeMatrix:O,color:E,metallic:R,roughness:N,opacity:F})),S.push(k))}}S.length>0&&i.createEntity(y.apply(j,{id:n,isObject:!0,meshIds:S}))}}}(e,t,o,i)}},Iv={};Iv[zy.version]=zy,Iv[Yy.version]=Yy,Iv[Zy.version]=Zy,Iv[$y.version]=$y,Iv[sv.version]=sv,Iv[ov.version]=ov,Iv[lv.version]=lv,Iv[fv.version]=fv,Iv[bv.version]=bv,Iv[Mv.version]=Mv;class Cv extends n{constructor(e,t={}){super("XKTLoader",e,t),this._maxGeometryBatchSize=t.maxGeometryBatchSize,this.textureTranscoder=t.textureTranscoder,this.dataSource=t.dataSource,this.objectDefaults=t.objectDefaults,this.includeTypes=t.includeTypes,this.excludeTypes=t.excludeTypes,this.excludeUnclassifiedObjects=t.excludeUnclassifiedObjects,this.reuseGeometries=t.reuseGeometries}get supportedVersions(){return Object.keys(Iv)}get textureTranscoder(){return this._textureTranscoder}set textureTranscoder(e){this._textureTranscoder=e}get dataSource(){return this._dataSource}set dataSource(e){this._dataSource=e||new Gy}get objectDefaults(){return this._objectDefaults}set objectDefaults(e){this._objectDefaults=e||K_}get includeTypes(){return this._includeTypes}set includeTypes(e){this._includeTypes=e}get excludeTypes(){return this._excludeTypes}set excludeTypes(e){this._excludeTypes=e}get excludeUnclassifiedObjects(){return this._excludeUnclassifiedObjects}set excludeUnclassifiedObjects(e){this._excludeUnclassifiedObjects=!!e}get globalizeObjectIds(){return this._globalizeObjectIds}set globalizeObjectIds(e){this._globalizeObjectIds=!!e}get reuseGeometries(){return this._reuseGeometries}set reuseGeometries(e){this._reuseGeometries=!1!==e}load(e={}){let t;e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id),t=e.useDataTextures?new fi(this.viewer.scene,y.apply(e,{isModel:!0,origin:e.origin,targetLodFps:e.useDataTextures.targetLodFps||!1,enableViewFrustumCulling:e.useDataTextures.enableViewFrustumCulling||!1,disableVertexWelding:e.useDataTextures.disableVertexWelding||!1,disableIndexRebucketing:e.useDataTextures.disableIndexRebucketing||!1})):new Hc(this.viewer.scene,y.apply(e,{isModel:!0,textureTranscoder:this._textureTranscoder,maxGeometryBatchSize:this._maxGeometryBatchSize,origin:e.origin}));const s=t.id;if(!e.src&&!e.xkt)return this.error("load() param expected: src or xkt"),t;const i={},r=e.includeTypes||this._includeTypes,o=e.excludeTypes||this._excludeTypes,n=e.objectDefaults||this._objectDefaults;if(i.reuseGeometries=null!==e.reuseGeometries&&void 0!==e.reuseGeometries?e.reuseGeometries:!1!==this._reuseGeometries,r){i.includeTypesMap={};for(let e=0,t=r.length;e<t;e++)i.includeTypesMap[r[e]]=!0}if(o){i.excludeTypesMap={};for(let e=0,t=o.length;e<t;e++)i.excludeTypesMap[o[e]]=!0}if(n&&(i.objectDefaults=n),i.excludeUnclassifiedObjects=void 0!==e.excludeUnclassifiedObjects?!!e.excludeUnclassifiedObjects:this._excludeUnclassifiedObjects,i.globalizeObjectIds=void 0!==e.globalizeObjectIds&&null!==e.globalizeObjectIds?!!e.globalizeObjectIds:this._globalizeObjectIds,e.metaModelSrc||e.metaModelData){const n=n=>!!this.viewer.metaScene.createMetaModel(s,n,{includeTypes:r,excludeTypes:o,globalizeObjectIds:i.globalizeObjectIds})&&(e.src?this._loadModel(e.src,e,i,t):this._parseModel(e.xkt,e,i,t),t.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(t.id)})),!0);if(e.metaModelSrc){const i=e.metaModelSrc;this.viewer.scene.canvas.spinner.processes++,this._dataSource.getMetaModel(i,(e=>{t.destroyed||(n(e)||(this.error(`load(): Failed to load model metadata for model '${s} from '${i}' - metadata not valid`),t.fire("error","Metadata not valid")),this.viewer.scene.canvas.spinner.processes--)}),(e=>{this.error(`load(): Failed to load model metadata for model '${s} from  '${i}' - ${e}`),t.fire("error",`Failed to load model metadata from  '${i}' - ${e}`),this.viewer.scene.canvas.spinner.processes--}))}else e.metaModelData&&(n(e.metaModelData)||(this.error(`load(): Failed to load model metadata for model '${s} from '${e.metaModelSrc}' - metadata not valid`),t.fire("error","Metadata not valid")))}else e.src?this._loadModel(e.src,e,i,t):this._parseModel(e.xkt,e,i,t);return t}_loadModel(e,t,s,i){const r=this.viewer.scene.canvas.spinner;r.processes++,this._dataSource.getXKT(t.src,(e=>{this._parseModel(e,t,s,i),r.processes--}),(e=>{r.processes--,this.error(e),i.fire("error",e)}))}_parseModel(e,t,s,i){if(i.destroyed)return;const r=new DataView(e),o=new Uint8Array(e),n=r.getUint32(0,!0),a=Iv[n];if(!a)return void this.error("Unsupported .XKT file version: "+n+" - this XKTLoaderPlugin supports versions "+Object.keys(Iv));this.log("Loading .xkt V"+n);const h=r.getUint32(4,!0),l=[];let u=4*(h+2);for(let e=0;e<h;e++){const t=r.getUint32(4*(e+2),!0);l.push(o.subarray(u,u+t)),u+=t}a.parse(this.viewer,s,l,i),i.finalize(),this._createDefaultMetaModelIfNeeded(i,t,s),i.scene.once("tick",(()=>{i.destroyed||(i.scene.fire("modelLoaded",i.id),i.fire("loaded",!0,!1))}))}_createDefaultMetaModelIfNeeded(e,t,s){const i=e.id;if(!this.viewer.metaScene.metaModels[i]){const r={metaObjects:[]};r.metaObjects.push({id:i,type:"default",name:i,parent:null});const o=e.entityList;for(let e=0,t=o.length;e<t;e++){const t=o[e];t.isObject&&r.metaObjects.push({id:t.id,type:"default",name:t.id,parent:i})}const n=t.src;this.viewer.metaScene.createMetaModel(i,r,{includeTypes:s.includeTypes,excludeTypes:s.excludeTypes,globalizeObjectIds:s.globalizeObjectIds,getProperties:async e=>await this._dataSource.getProperties(n,e)}),e.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(i)}))}}}var Dv={};!function(e){var t,s="File format is not recognized.",i="Error while reading zip file.",r="Error while reading file data.",o=524288,n="text/plain";try{t=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(e){}function a(){this.crc=-1}function h(){}function l(e,t){var s,i;return s=new ArrayBuffer(e),i=new Uint8Array(s),t&&i.set(t,0),{buffer:s,array:i,view:new DataView(s)}}function u(){}function c(e){var t,s=this;s.size=0,s.init=function(i,r){var o=new Blob([e],{type:n});(t=new d(o)).init((function(){s.size=t.size,i()}),r)},s.readUint8Array=function(e,s,i,r){t.readUint8Array(e,s,i,r)}}function p(t){var s,i=this;i.size=0,i.init=function(e){for(var r=t.length;"="==t.charAt(r-1);)r--;s=t.indexOf(",")+1,i.size=Math.floor(.75*(r-s)),e()},i.readUint8Array=function(i,r,o){var n,a=l(r),h=4*Math.floor(i/3),u=4*Math.ceil((i+r)/3),c=e.atob(t.substring(h+s,u+s)),p=i-3*Math.floor(h/4);for(n=p;n<p+r;n++)a.array[n-p]=c.charCodeAt(n);o(a.array)}}function d(e){var t=this;t.size=0,t.init=function(s){t.size=e.size,s()},t.readUint8Array=function(t,s,i,r){var o=new FileReader;o.onload=function(e){i(new Uint8Array(e.target.result))},o.onerror=r;try{o.readAsArrayBuffer(function(e,t,s){if(t<0||s<0||t+s>e.size)throw new RangeError("offset:"+t+", length:"+s+", size:"+e.size);return e.slice?e.slice(t,t+s):e.webkitSlice?e.webkitSlice(t,t+s):e.mozSlice?e.mozSlice(t,t+s):e.msSlice?e.msSlice(t,t+s):void 0}(e,t,s))}catch(e){r(e)}}}function m(){}function f(e){var s,i=this;i.init=function(e){s=new Blob([],{type:n}),e()},i.writeUint8Array=function(e,i){s=new Blob([s,t?e:e.buffer],{type:n}),i()},i.getData=function(t,i){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=i,r.readAsText(s,e)}}function g(t){var s=this,i="",r="";s.init=function(e){i+="data:"+(t||"")+";base64,",e()},s.writeUint8Array=function(t,s){var o,n=r.length,a=r;for(r="",o=0;o<3*Math.floor((n+t.length)/3)-n;o++)a+=String.fromCharCode(t[o]);for(;o<t.length;o++)r+=String.fromCharCode(t[o]);a.length>2?i+=e.btoa(a):r=a,s()},s.getData=function(t){t(i+e.btoa(r))}}function _(e){var s,i=this;i.init=function(t){s=new Blob([],{type:e}),t()},i.writeUint8Array=function(i,r){s=new Blob([s,t?i:i.buffer],{type:e}),r()},i.getData=function(e){e(s)}}function y(e,t,s,i,r,n,a,h,l,u){var c,p,d,m=0,f=t.sn;function g(){e.removeEventListener("message",_,!1),h(p,d)}function _(t){var s=t.data,r=s.data,o=s.error;if(o)return o.toString=function(){return"Error: "+this.message},void l(o);if(s.sn===f)switch("number"==typeof s.codecTime&&(e.codecTime+=s.codecTime),"number"==typeof s.crcTime&&(e.crcTime+=s.crcTime),s.type){case"append":r?(p+=r.length,i.writeUint8Array(r,(function(){y()}),u)):y();break;case"flush":d=s.crc,r?(p+=r.length,i.writeUint8Array(r,(function(){g()}),u)):g();break;case"progress":a&&a(c+s.loaded,n);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",s)}}function y(){(c=m*o)<=n?s.readUint8Array(r+c,Math.min(o,n-c),(function(s){a&&a(c,n);var i=0===c?t:{sn:f};i.type="append",i.data=s;try{e.postMessage(i,[s.buffer])}catch(t){e.postMessage(i)}m++}),l):e.postMessage({sn:f,type:"flush"})}p=0,e.addEventListener("message",_,!1),y()}function v(e,t,s,i,r,n,h,l,u,c){var p,d=0,m=0,f="input"===n,g="output"===n,_=new a;!function n(){var a;if((p=d*o)<r)t.readUint8Array(i+p,Math.min(o,r-p),(function(t){var i;try{i=e.append(t,(function(e){h&&h(p+e,r)}))}catch(e){return void u(e)}i?(m+=i.length,s.writeUint8Array(i,(function(){d++,setTimeout(n,1)}),c),g&&_.append(i)):(d++,setTimeout(n,1)),f&&_.append(t),h&&h(p,r)}),u);else{try{a=e.flush()}catch(e){return void u(e)}a?(g&&_.append(a),m+=a.length,s.writeUint8Array(a,(function(){l(m,_.get())}),c)):l(m,_.get())}}()}function b(t,s,i,r,o,n,a,l,u,c,p){var d="input";e.zip.useWebWorkers&&a?y(t,{sn:s,codecClass:"NOOP",crcType:d},i,r,o,n,u,l,c,p):v(new h,i,r,o,n,d,u,l,c,p)}function x(e){var t,s,i="",r=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "];for(t=0;t<e.length;t++)i+=(s=255&e.charCodeAt(t))>127?r[s-128]:String.fromCharCode(s);return i}function P(e){return decodeURIComponent(escape(e))}function T(e){var t,s="";for(t=0;t<e.length;t++)s+=String.fromCharCode(e[t]);return s}function w(e,t,s,i,r){e.version=t.view.getUint16(s,!0),e.bitFlag=t.view.getUint16(s+2,!0),e.compressionMethod=t.view.getUint16(s+4,!0),e.lastModDateRaw=t.view.getUint32(s+6,!0),e.lastModDate=function(e){var t=(4294901760&e)>>16,s=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&s)>>11,(2016&s)>>5,2*(31&s),0)}catch(e){}}(e.lastModDateRaw),1!=(1&e.bitFlag)?((i||8!=(8&e.bitFlag))&&(e.crc32=t.view.getUint32(s+10,!0),e.compressedSize=t.view.getUint32(s+14,!0),e.uncompressedSize=t.view.getUint32(s+18,!0)),4294967295!==e.compressedSize&&4294967295!==e.uncompressedSize?(e.filenameLength=t.view.getUint16(s+22,!0),e.extraFieldLength=t.view.getUint16(s+24,!0)):r("File is using Zip64 (4gb+ file size).")):r("File contains encrypted entry.")}function M(t,o,n){var a=0;function h(){}h.prototype.getData=function(i,o,h,u){var c=this;function p(e,t){u&&!function(e){var t=l(4);return t.view.setUint32(0,e),c.crc32==t.view.getUint32(0)}(t)?n("CRC failed."):i.getData((function(e){o(e)}))}function d(e){n(e||r)}function m(e){n(e||"Error while writing file data.")}t.readUint8Array(c.offset,30,(function(r){var o,f=l(r.length,r);1347093252==f.view.getUint32(0)?(w(c,f,4,!1,n),o=c.offset+30+c.filenameLength+c.extraFieldLength,i.init((function(){0===c.compressionMethod?b(c._worker,a++,t,i,o,c.compressedSize,u,p,h,d,m):function(t,s,i,r,o,n,a,h,l,u,c){var p=a?"output":"none";e.zip.useWebWorkers?y(t,{sn:s,codecClass:"Inflater",crcType:p},i,r,o,n,l,h,u,c):v(new e.zip.Inflater,i,r,o,n,p,l,h,u,c)}(c._worker,a++,t,i,o,c.compressedSize,u,p,h,d,m)}),m)):n(s)}),d)};var u={getEntries:function(e){var r=this._worker;!function(e){t.size<22?n(s):r(22,(function(){r(Math.min(65558,t.size),(function(){n(s)}))}));function r(s,r){t.readUint8Array(t.size-s,s,(function(t){for(var s=t.length-22;s>=0;s--)if(80===t[s]&&75===t[s+1]&&5===t[s+2]&&6===t[s+3])return void e(new DataView(t.buffer,s,22));r()}),(function(){n(i)}))}}((function(o){var a,u;a=o.getUint32(16,!0),u=o.getUint16(8,!0),a<0||a>=t.size?n(s):t.readUint8Array(a,t.size-a,(function(t){var i,o,a,c,p=0,d=[],m=l(t.length,t);for(i=0;i<u;i++){if((o=new h)._worker=r,1347092738!=m.view.getUint32(p))return void n(s);w(o,m,p+6,!0,n),o.commentLength=m.view.getUint16(p+32,!0),o.directory=16==(16&m.view.getUint8(p+38)),o.offset=m.view.getUint32(p+42,!0),a=T(m.array.subarray(p+46,p+46+o.filenameLength)),o.filename=2048==(2048&o.bitFlag)?P(a):x(a),o.directory||"/"!=o.filename.charAt(o.filename.length-1)||(o.directory=!0),c=T(m.array.subarray(p+46+o.filenameLength+o.extraFieldLength,p+46+o.filenameLength+o.extraFieldLength+o.commentLength)),o.comment=2048==(2048&o.bitFlag)?P(c):x(c),d.push(o),p+=46+o.filenameLength+o.extraFieldLength+o.commentLength}e(d)}),(function(){n(i)}))}))},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null),e&&e()},_worker:null};e.zip.useWebWorkers?E("inflater",(function(e){u._worker=e,o(u)}),(function(e){n(e)})):o(u)}function I(e){return unescape(encodeURIComponent(e))}function C(e){var t,s=[];for(t=0;t<e.length;t++)s.push(e.charCodeAt(t));return s}function D(t,s,i,o){var n={},a=[],h=0,u=0;function c(e){i(e||"Error while writing zip file.")}function p(e){i(e||r)}var d={add:function(s,r,d,m,f){var g,_,x,P=this._worker;function T(e,s){var i=l(16);h+=e||0,i.view.setUint32(0,1347094280),void 0!==s&&(g.view.setUint32(10,s,!0),i.view.setUint32(4,s,!0)),r&&(i.view.setUint32(8,e,!0),g.view.setUint32(14,e,!0),i.view.setUint32(12,r.size,!0),g.view.setUint32(18,r.size,!0)),t.writeUint8Array(i.array,(function(){h+=16,d()}),c)}function w(){f=f||{},s=s.trim(),f.directory&&"/"!=s.charAt(s.length-1)&&(s+="/"),n.hasOwnProperty(s)?i("File already exists."):(_=C(I(s)),a.push(s),function(e){var i;x=f.lastModDate||new Date,g=l(26),n[s]={headerArray:g.array,directory:f.directory,filename:_,offset:h,comment:C(I(f.comment||""))},g.view.setUint32(0,335546376),f.version&&g.view.setUint8(0,f.version),o||0===f.level||f.directory||g.view.setUint16(4,2048),g.view.setUint16(6,(x.getHours()<<6|x.getMinutes())<<5|x.getSeconds()/2,!0),g.view.setUint16(8,(x.getFullYear()-1980<<4|x.getMonth()+1)<<5|x.getDate(),!0),g.view.setUint16(22,_.length,!0),(i=l(30+_.length)).view.setUint32(0,1347093252),i.array.set(g.array,4),i.array.set(_,30),h+=i.array.length,t.writeUint8Array(i.array,e,c)}((function(){r?o||0===f.level?b(P,u++,r,t,0,r.size,!0,T,m,p,c):function(t,s,i,r,o,n,a,h,l){var u="input";e.zip.useWebWorkers?y(t,{sn:s,options:{level:o},codecClass:"Deflater",crcType:u},i,r,0,i.size,a,n,h,l):v(new e.zip.Deflater,i,r,0,i.size,u,a,n,h,l)}(P,u++,r,t,f.level,T,m,p,c):T()})))}r?r.init(w,p):w()},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null);var s,i,r,o=0,u=0;for(i=0;i<a.length;i++)o+=46+(r=n[a[i]]).filename.length+r.comment.length;for(s=l(o+22),i=0;i<a.length;i++)r=n[a[i]],s.view.setUint32(u,1347092738),s.view.setUint16(u+4,5120),s.array.set(r.headerArray,u+6),s.view.setUint16(u+32,r.comment.length,!0),r.directory&&s.view.setUint8(u+38,16),s.view.setUint32(u+42,r.offset,!0),s.array.set(r.filename,u+46),s.array.set(r.comment,u+46+r.filename.length),u+=46+r.filename.length+r.comment.length;s.view.setUint32(u,1347093766),s.view.setUint16(u+8,a.length,!0),s.view.setUint16(u+10,a.length,!0),s.view.setUint32(u+12,o,!0),s.view.setUint32(u+16,h,!0),t.writeUint8Array(s.array,(function(){t.getData(e)}),c)},_worker:null};e.zip.useWebWorkers?E("deflater",(function(e){d._worker=e,s(d)}),(function(e){i(e)})):s(d)}a.prototype.append=function(e){for(var t=0|this.crc,s=this.table,i=0,r=0|e.length;i<r;i++)t=t>>>8^s[255&(t^e[i])];this.crc=t},a.prototype.get=function(){return~this.crc},a.prototype.table=function(){var e,t,s,i=[];for(e=0;e<256;e++){for(s=e,t=0;t<8;t++)1&s?s=s>>>1^3988292384:s>>>=1;i[e]=s}return i}(),h.prototype.append=function(e,t){return e},h.prototype.flush=function(){},c.prototype=new u,c.prototype.constructor=c,p.prototype=new u,p.prototype.constructor=p,d.prototype=new u,d.prototype.constructor=d,m.prototype.getData=function(e){e(this.data)},f.prototype=new m,f.prototype.constructor=f,g.prototype=new m,g.prototype.constructor=g,_.prototype=new m,_.prototype.constructor=_;var A={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};function E(t,s,i){if(null===e.zip.workerScripts||null===e.zip.workerScriptsPath){var r;if(e.zip.workerScripts){if(r=e.zip.workerScripts[t],!Array.isArray(r))return void i(new Error("zip.workerScripts."+t+" is not an array!"));r=function(e){var t=document.createElement("a");return e.map((function(e){return t.href=e,t.href}))}(r)}else(r=A[t].slice(0))[0]=(e.zip.workerScriptsPath||"")+r[0];var o=new Worker(r[0]);o.codecTime=o.crcTime=0,o.postMessage({type:"importScripts",scripts:r.slice(1)}),o.addEventListener("message",(function e(t){var r=t.data;if(r.error)return o.terminate(),void i(r.error);"importScripts"===r.type&&(o.removeEventListener("message",e),o.removeEventListener("error",n),s(o))})),o.addEventListener("error",n)}else i(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));function n(e){o.terminate(),i(e)}}function F(e){console.error(e)}e.zip={Reader:u,Writer:m,BlobReader:d,Data64URIReader:p,TextReader:c,BlobWriter:_,Data64URIWriter:g,TextWriter:f,createReader:function(e,t,s){s=s||F,e.init((function(){M(e,t,s)}),s)},createWriter:function(e,t,s,i){s=s||F,i=!!i,e.init((function(){D(e,t,s,i)}),s)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null}}(Dv);const Av=Dv.zip;!function(e){var t,s,i=e.Reader,r=e.Writer;try{s=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(e){}function o(e){var t=this;function s(s,i){var r;t.data?s():((r=new XMLHttpRequest).addEventListener("load",(function(){t.size||(t.size=Number(r.getResponseHeader("Content-Length"))||Number(r.response.byteLength)),t.data=new Uint8Array(r.response),s()}),!1),r.addEventListener("error",i,!1),r.open("GET",e),r.responseType="arraybuffer",r.send())}t.size=0,t.init=function(i,r){if(function(e){var t=document.createElement("a");return t.href=e,"http:"===t.protocol||"https:"===t.protocol}(e)){var o=new XMLHttpRequest;o.addEventListener("load",(function(){t.size=Number(o.getResponseHeader("Content-Length")),t.size?i():s(i,r)}),!1),o.addEventListener("error",r,!1),o.open("HEAD",e),o.send()}else s(i,r)},t.readUint8Array=function(e,i,r,o){s((function(){r(new Uint8Array(t.data.subarray(e,e+i)))}),o)}}function n(e){var t=this;t.size=0,t.init=function(s,i){var r=new XMLHttpRequest;r.addEventListener("load",(function(){t.size=Number(r.getResponseHeader("Content-Length")),"bytes"==r.getResponseHeader("Accept-Ranges")?s():i("HTTP Range not supported.")}),!1),r.addEventListener("error",i,!1),r.open("HEAD",e),r.send()},t.readUint8Array=function(t,s,i,r){!function(t,s,i,r){var o=new XMLHttpRequest;o.open("GET",e),o.responseType="arraybuffer",o.setRequestHeader("Range","bytes="+t+"-"+(t+s-1)),o.addEventListener("load",(function(){i(o.response)}),!1),o.addEventListener("error",r,!1),o.send()}(t,s,(function(e){i(new Uint8Array(e))}),r)}}function a(e){var t=this;t.size=0,t.init=function(s,i){t.size=e.byteLength,s()},t.readUint8Array=function(t,s,i,r){i(new Uint8Array(e.slice(t,t+s)))}}function h(){var e,t=this;t.init=function(t,s){e=new Uint8Array,t()},t.writeUint8Array=function(t,s,i){var r=new Uint8Array(e.length+t.length);r.set(e),r.set(t,e.length),e=r,s()},t.getData=function(t){t(e.buffer)}}function l(e,t){var i,r=this;r.init=function(t,s){e.createWriter((function(e){i=e,t()}),s)},r.writeUint8Array=function(e,r,o){var n=new Blob([s?e:e.buffer],{type:t});i.onwrite=function(){i.onwrite=null,r()},i.onerror=o,i.write(n)},r.getData=function(t){e.file(t)}}o.prototype=new i,o.prototype.constructor=o,n.prototype=new i,n.prototype.constructor=n,a.prototype=new i,a.prototype.constructor=a,h.prototype=new r,h.prototype.constructor=h,l.prototype=new r,l.prototype.constructor=l,e.FileWriter=l,e.HttpReader=o,e.HttpRangeReader=n,e.ArrayBufferReader=a,e.ArrayBufferWriter=h,e.fs&&((t=e.fs.ZipDirectoryEntry).prototype.addHttpContent=function(s,i,r){return function(s,i,r,o){if(s.directory)return o?new t(s.fs,i,r,s):new e.fs.ZipFileEntry(s.fs,i,r,s);throw"Parent entry is not a directory."}(this,s,{data:i,Reader:r?n:o})},t.prototype.importHttpContent=function(e,t,s,i){this.importZip(t?new n(e):new o(e),s,i)},e.fs.FS.prototype.importHttpContent=function(e,s,i,r){this.entries=[],this.root=new t(this),this.root.importHttpContent(e,s,i,r)})}(Av);const Ev=["4.2"];class Fv{constructor(e,t={}){this.supportedSchemas=Ev,this._xrayOpacity=.7,this._src=null,this._options=t,this.viewpoint=null,t.workerScriptsPath?(Av.workerScriptsPath=t.workerScriptsPath,this.src=t.src,this.xrayOpacity=.7,this.displayEffect=t.displayEffect,this.createMetaModel=t.createMetaModel):e.error("Config expected: workerScriptsPath")}load(e,t,s,i,r,o){switch(i.materialType){case"MetallicMaterial":t._defaultMaterial=new gn(t,{baseColor:[1,1,1],metallic:.6,roughness:.6});break;case"SpecularMaterial":t._defaultMaterial=new vn(t,{diffuse:[1,1,1],specular:p.vec3([1,1,1]),glossiness:.5});break;default:t._defaultMaterial=new Ei(t,{reflectivity:.75,shiness:100,diffuse:[1,1,1]})}t._wireframeMaterial=new dn(t,{color:[0,0,0],lineWidth:2});var n=t.scene.canvas.spinner;n.processes++,Rv(e,t,s,i,(function(){n.processes--,r&&r(),t.fire("loaded",!0,!1)}),(function(e){n.processes--,t.error(e),o&&o(e),t.fire("error",e)}),(function(e){console.log("Error, Will Robinson: "+e)}))}}var Rv=function(e,t,s,i,r,o){!function(e,t,s){var i=new Gv;i.load(e,(function(){t(i)}),(function(e){s("Error loading ZIP archive: "+e)}))}(s,(function(s){Sv(e,s,i,t,r,o)}),o)},Sv=function(){return function(t,s,i,r,o){var n={plugin:t,zip:s,edgeThreshold:30,materialType:i.materialType,scene:r.scene,modelNode:r,info:{references:{}},materials:{}};i.createMetaModel&&(n.metaModelData={modelId:r.id,metaObjects:[{name:r.id,type:"Default",id:r.id}]}),r.scene.loading++,function(t,s){t.zip.getFile("Manifest.xml",(function(i,r){for(var o=r.children,n=0,a=o.length;n<a;n++){var h=o[n];if("Manifest"===h.type)e(t,h,s)}}))}(n,(function(){n.metaModelData&&t.viewer.metaScene.createMetaModel(r.id,n.metaModelData),r.scene.loading--,o()}))};function e(e,s,i){for(var r=s.children,o=0,n=r.length;o<n;o++){var a=r[o];if("Root"===a.type){var h=a.children[0];e.zip.getFile(h,(function(s,r){t(e,r,i)}))}}}function t(e,t,i){for(var r=t.children,o=0,n=r.length;o<n;o++){var a=r[o];if("Model_3dxml"===a.type)s(e,a,i)}}function s(e,t,s){for(var r=t.children,a=0,h=r.length;a<h;a++){var l=r[a];switch(l.type){case"Header":i(e,l);break;case"ProductStructure":o(e,l,s);break;case"DefaultView":n(e,l)}}}function i(e,t){for(var s=t.children,i={},o=0,n=s.length;o<n;o++){var a=s[o];switch(a.type){case"SchemaVersion":i.schemaVersion=a.children[0],r(e,i.schemaVersion)||e.plugin.error("Schema version not supported: "+i.schemaVersion+" - supported versions are: "+Ev.join(","));break;case"Title":i.title=a.children[0];break;case"Author":i.author=a.children[0];break;case"Created":i.created=a.children[0]}}e.modelNode.meta=i}function r(e,t){for(var s=0,i=Ev.length;s<i;s++)if(t===Ev[s])return!0;return!1}function o(e,t,s){!function(e,t,s){for(var i={},r=t.children,o=0,n=0,h=r.length;n<h;n++){"ReferenceRep"===(l=r[n]).type&&o++}for(n=0,h=r.length;n<h;n++){var l;if("ReferenceRep"===(l=r[n]).type)if(l.associatedFile){var u=Hv(l.associatedFile);!function(){var t=l.id;e.zip.getFile(u,(function(r,n){var h=r.getElementsByTagName("MaterialId");Ov(e,h,(function(){var r={id:t};a(e,n,r),i[t]=r,0==--o&&s(i)}))}),(function(e){}))}()}}}(e,t,(function(i){for(var r=t.children,o={},n={},a={},h=0,l=r.length;h<l;h++){var u=r[h];switch(u.type){case"Reference3D":o[u.id]={type:"Reference3D",id:u.id,name:u.name,instance3Ds:{},instanceReps:{}};break;case"InstanceRep":for(var c=0,d=u.children.length;c<d;c++){switch((y=u.children[c]).type){case"IsAggregatedBy":m=y.children[0];break;case"IsInstanceOf":f=y.children[0]}}n[u.id]={type:"InstanceRep",id:u.id,name:u.name,isAggregatedBy:m,isInstanceOf:f,referenceReps:{}};break;case"Instance3D":var m,f,_;for(c=0,d=u.children.length;c<d;c++){var y;switch((y=u.children[c]).type){case"IsAggregatedBy":m=y.children[0];break;case"IsInstanceOf":f=y.children[0];break;case"RelativeMatrix":_=y.children[0]}}a[u.id]={type:"Instance3D",id:u.id,name:u.name,isAggregatedBy:m,isInstanceOf:f,relativeMatrix:_,reference3Ds:{}}}}for(var v in a){(x=o[(b=a[v]).isAggregatedBy])?x.instance3Ds[b.id]=b:alert("foo")}for(var v in a){var b,x=o[(b=a[v]).isInstanceOf];b.reference3Ds[x.id]=x,x.instance3D=b}for(var v in n){var P=i[(T=n[v]).isInstanceOf];P&&(T.referenceReps[P.id]=P)}for(var v in n){var T;(x=o[(T=n[v]).isAggregatedBy])&&(x.instanceReps[T.id]=T)}function w(e,t,s){for(var i in t.instance3Ds)M(e,t.instance3Ds[i],s);for(var i in t.instanceReps)I(e,t.instanceReps[i],s)}function M(e,t,s){if(t.relativeMatrix){var i=g(t.relativeMatrix,12),r=[i[9],i[10],i[11]],o=i.slice(0,9),n=p.mat3ToMat4(o,p.identityMat4()),a=new pn(e.modelNode,{position:r});e.metaModelData&&e.metaModelData.metaObjects.push({id:a.id,type:"Default",name:t.name,parent:s?s.id:e.modelNode.id}),s?s.addChild(a,!0):e.modelNode.addChild(a,!0),s=a,a=new pn(e.modelNode,{matrix:n}),e.metaModelData&&e.metaModelData.metaObjects.push({id:a.id,type:"Default",name:t.name,parent:s?s.id:e.modelNode.id}),s.addChild(a,!0),s=a}else{a=new pn(e.modelNode,{});e.metaModelData&&e.metaModelData.metaObjects.push({id:a.id,type:"Default",name:t.name,parent:s?s.id:e.modelNode.id}),s?s.addChild(a,!0):e.modelNode.addChild(a,!0),s=a}for(var h in t.reference3Ds)w(e,t.reference3Ds[h],s)}function I(e,t,s){if(t.referenceReps)for(var i in t.referenceReps){var r=t.referenceReps[i];for(var o in r)if("id"!==o){var n=r[o],a="lines"===n.geometry.primitive?e.modelNode._wireframeMaterial:n.materialId?e.materials[n.materialId]:null,h=n.color,l=new Ko(e.modelNode,{isObject:!0,geometry:n.geometry,material:a||e.modelNode._defaultMaterial,colorize:h,backfaces:!1});e.metaModelData&&e.metaModelData.metaObjects.push({id:l.id,type:"Default",name:t.name,parent:s?s.id:e.modelNode.id}),s?s.addChild(l,!0):e.modelNode.addChild(l,!0),l.colorize=h}}}for(var v in o){if(!(x=o[v]).instance3D)return w(e,x,null),void s()}alert("No root Reference3D element found in this modelNode - can't load."),s()}))}function n(e,t){for(var s=t.children,i=0,r=s.length;i<r;i++){var o=s[i];if("Viewpoint"===o.type){var n=o.children;e.modelNode.viewpoint={};for(var a=0,h=n.length;a<h;a++){var l=n[i];switch(l.type){case"Position":e.modelNode.viewpoint.eye=g(l.children[0],3);break;case"Sight":e.modelNode.viewpoint.look=g(l.children[0],3);break;case"Up":e.modelNode.viewpoint.up=g(l.children[0],3)}}}}}function a(e,t,s){for(var i=t.children,r=0,o=i.length;r<o;r++){var n=i[r];if("XMLRepresentation"===n.type)h(e,n,s)}}function h(e,t,s){for(var i=t.children,r=0,o=i.length;r<o;r++){var n=i[r];if("Root"===n.type)l(e,n,s)}}function l(e,t,s){t["xsi:type"];for(var i=t.children,r=0,o=i.length;r<o;r++){var n=i[r];if("Rep"===n.type)u(e,n,s)}}function u(e,t,s){t["xsi:type"];for(var i={edgeThreshold:e.edgeThreshold||30,compressGeometry:!0},r=t.children,o=0,n=r.length;o<n;o++){var a=r[o];switch(a.type){case"Rep":u(e,a,s);break;case"Edges":break;case"Faces":i.primitive="triangles",c(e,a,i);break;case"VertexBuffer":f(e,a,i);break;case"SurfaceAttributes":_(e,a,i)}}if(i.positions){var h=new Mi(e.modelNode,i);s[h.id]={geometry:h,color:i.color||[1,1,1,1],materialId:i.materialId}}}function c(e,t,s){for(var i=t.children,r=0,o=i.length;r<o;r++){var n=i[r];if("Face"===n.type)d(e,n,s)}}function d(e,t,s){var i=t.strips;if(i){var r=function(e){for(var t=e.split(","),s=[],i=0,r=t.length;i<r;i++){var o=t[i].trim();if(o.length>0){for(var n=o.trim().split(" "),a=new Int16Array(n.length),h=0,l=0,u=n.length;l<u;l++)""!==n[l]&&(a[h++]=parseInt(n[l]));s.push(a)}}return s}(i);if(r.length>0){s.primitive="triangles";for(var o=[],n=0,a=r.length;n<a;n++)for(var h=m(r[n]),l=0,u=h.length;l<u;l++)o.push(h[l]);s.indices=o}}else{var c=t.triangles;c&&(s.primitive="triangles",s.indices=function(e){e=e.trim().split(" ");for(var t=new Int32Array(e.length),s=0,i=e.length;s<i;s++){var r=e[s];t[s]=parseInt(r)}return t}(c))}var p=t.children;for(n=0,a=p.length;n<a;n++){var d=p[n];if("SurfaceAttributes"===d.type)_(e,d,s)}}function m(e){for(var t=[],s=0,i=e.length;s<i-2;s++)1&s?(t.push(e[s]),t.push(e[s+2]),t.push(e[s+1])):(t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]));return t}function f(e,t,s){for(var i=t.children,r=0,o=i.length;r<o;r++){var n=i[r];switch(n.type){case"Positions":s.positions=g(n.children[0],3);break;case"Normals":s.normals=g(n.children[0],3);break;case"TextureCoordinates":s.uv=g(n.children[0],2)}}}function g(e,t){e=e.split(",");for(var s=new Float32Array(e.length*t),i=0,r=0,o=e.length;r<o;r++)for(var n=e[r],a=0,h=(n=n.split(" ")).length;a<h;a++)""!==n[a]&&(s[i++]=parseFloat(n[a]));return s}function _(e,t,s){s.color=[1,1,1,1];for(var i,r,o=t.children,n=0,a=o.length;n<a;n++){var h=o[n];switch(h.type){case"Color":s.color[0]=h.red,s.color[1]=h.green,s.color[2]=h.blue,s.color[3]=h.alpha;break;case"MaterialApplication":for(var l=h.children,u=0,c=l.length;u<c;u++){var p=l[u];if("MaterialId"===p.type){var d=(i=p.id,r=void 0,-1!==(r=i.lastIndexOf("#"))?i.substring(r+1):i);e.materials[d]||e.plugin.error("material  not found: "+d),s.materialId=d}}}}}}();function Ov(e,t,s){var i={};!function r(o,n){if(o>=t.length)s();else{var a=t[o].id,h=a.lastIndexOf(":");h>0&&(a=a.substring(h+1));var l=a.lastIndexOf("#");l>0&&(a=a.substring(0,l)),i[a]?r(o+1):function(e,t,s){e.zip.getFile(t,(function(t,i){!function(e,t,s){for(var i,r=t.children,o=0,n=r.length;o<n;o++)"Model_3dxml"===(i=r[o]).type&&Bv(e,i,s)}(e,i,s)}))}(e,a,(function(){i[a]=!0,r(o+1)}))}}(0)}function Bv(e,t,s){for(var i,r=t.children,o=0,n=r.length;o<n;o++)"CATMaterialRef"===(i=r[o]).type&&Lv(e,i,s)}function Lv(e,t,s){for(var i={},r=t.children,o=0,n=0,a=r.length;n<a;n++){if("MaterialDomainInstance"===(d=r[n]).type){for(var h,l,u=0,c=d.children.length;u<c;u++){var p=d.children[u];switch(p.type){case"IsAggregatedBy":h=p.children[0];break;case"IsInstanceOf":l=p.children[0]}}i[l]=h}}for(n=0,a=r.length;n<a;n++){if("MaterialDomain"===(d=r[n]).type)o++}for(n=0,a=r.length;n<a;n++){var d;if("MaterialDomain"===(d=r[n]).type)d.associatedFile&&function(){var t=d.id,r=Hv(d.associatedFile);e.zip.getFile(r,(function(r,n){e.materials[i[t]]=Nv(e,n),0==--o&&s()}),(function(e){}))}()}}function Nv(e,t){for(var s=t.children,i=0,r=s.length;i<r;i++){var o=s[i];if("Osm"===o.type)return kv(e,o)}}function kv(e,t){for(var s=t.children,i=0,r=s.length;i<r;i++){var o=s[i];switch(o.type){case"RenderingRootFeature":break;case"Feature":if("RenderingFeature"===o.Alias){var n,a,h,l,u={},c={},p=o.children;for(n=0,a=p.length;n<a;n++)switch((h=p[n]).Name){case"AmbientCoef":u.ambient=parseFloat(h.Value);break;case"DiffuseCoef":u.diffuse=parseFloat(h.Value);break;case"EmissiveCoef":u.emissive=parseFloat(h.Value);break;case"SpecularExponent":u.specular=parseFloat(h.Value)}for(n=0,a=p.length;n<a;n++)switch((h=p[n]).Name){case"AmbientColor":c.ambient=jv(h.Value,u.ambient);break;case"DiffuseColor":c.diffuse=jv(h.Value,u.diffuse);break;case"EmissiveColor":c.emissive=jv(h.Value,u.emissive);break;case"SpecularColor":c.specular=jv(h.Value,u.specular);break;case"Transparency":var d=1-parseFloat(h.Value);d<1&&(c.alpha=d,c.alphaMode="blend")}switch(e.materialType){case"MetallicMaterial":l=new gn(e.modelNode,{baseColor:c.diffuse,metallic:.7,roughness:.5,emissive:c.emissive,alpha:c.alpha,alphaMode:c.alphaMode});break;case"SpecularMaterial":l=new vn(e.modelNode,{diffuse:c.diffuse,specular:c.specular,glossiness:.5,emissive:c.emissive,alpha:c.alpha,alphaMode:c.alphaMode});break;default:l=new Ei(e.modelNode,{reflectivity:.5,ambient:c.ambient,diffuse:c.diffuse,specular:c.specular,emissive:c.emissive,alphaMode:c.alphaMode,alpha:t.alpha})}return l}}}}function jv(e,t){t=void 0!==t?t:.5;var s=e.indexOf("["),i=e.indexOf("]");e=(e=e.substring(s+1,i-s)).split(",");for(var r=new Float32Array(e.length),o=0,n=0,a=e.length;n<a;n++)for(var h=e[n],l=0,u=(h=h.trim().split(" ")).length;l<u;l++)""!==h[l]&&(r[o++]=parseFloat(h[l])*t);return r}var Gv=function(){var e={};function t(e,s){if(e.nodeType===e.TEXT_NODE){var i=e.nodeValue;if(null===i.match(/^\s+$/))return i}else if(e.nodeType===e.ELEMENT_NODE||e.nodeType===e.DOCUMENT_NODE){var r={type:e.nodeName,children:[]};if(e.nodeType===e.ELEMENT_NODE)for(var o=0;o<e.attributes.length;o++){var n=e.attributes[o];r[s[n.nodeName]||n.nodeName]=n.nodeValue}for(var a=0;a<e.childNodes.length;a++){(o=t(e.childNodes[a],s))&&r.children.push(o)}return r}}this.load=function(t,s,i){Av.createReader(new Av.HttpReader(t),(function(t){t.getEntries((function(t){if(t.length>0)for(var i=0,r=t.length;i<r;i++){var o=t[i];e[o.filename]=o}s()}))}),i)},this.getFile=function(s,i,r){var o=e[s];if(!o){var n="ZIP entry not found: "+s;return console.error(n),void(r&&r(n))}o.getData(new Av.TextWriter,(function(e){var s=(new DOMParser).parseFromString(e,"text/xml"),r=t(s,{});i(s,r)}))},this.destroy=function(){undefined.close((function(){}))}};function Hv(e){var t="urn:3DXML:";return 0===e.indexOf(t)?e.substring(t.length):e}class Vv extends n{constructor(e,t={}){super("XML3DLoader",e,t),t.workerScriptsPath?(this._workerScriptsPath=t.workerScriptsPath,this._loader=new Fv(this,t),this.supportedSchemas=this._loader.supportedSchemas):this.error("Config expected: workerScriptsPath")}load(e={}){e.workerScriptsPath=this._workerScriptsPath,e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new pn(this.viewer.scene,y.apply(e,{isModel:!0})),s=e.src;return s?(this._loader.load(this,t,s,e),t):(this.error("load() param expected: src"),t)}}var Uv,zv=Object.defineProperty,Wv=Object.getOwnPropertySymbols,Xv=Object.prototype.hasOwnProperty,Yv=Object.prototype.propertyIsEnumerable,Kv=(e,t,s)=>t in e?zv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Jv=(e,t)=>{for(var s in t||(t={}))Xv.call(t,s)&&Kv(e,s,t[s]);if(Wv)for(var s of Wv(t))Yv.call(t,s)&&Kv(e,s,t[s]);return e},Zv=e=>{if("undefined"!=typeof require)return require(e);throw new Error('Dynamic require of "'+e+'" is not supported')},Qv=(e,t)=>function(){return t||(0,e[Object.keys(e)[0]])((t={exports:{}}).exports,t),t.exports},qv=(e,t,s)=>new Promise(((i,r)=>{var o=e=>{try{a(s.next(e))}catch(e){r(e)}},n=e=>{try{a(s.throw(e))}catch(e){r(e)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,n);a((s=s.apply(e,t)).next())})),$v=Qv({"(disabled):crypto"(){}}),eb=Qv({"dist/web-ifc-mt.js"(e,t){var s,i=(s="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(s=s||__filename),function(e){function t(){return R.buffer!=z&&ne(R.buffer),W}function i(){return R.buffer!=z&&ne(R.buffer),X}function r(){return R.buffer!=z&&ne(R.buffer),Y}function o(){return R.buffer!=z&&ne(R.buffer),K}function n(){return R.buffer!=z&&ne(R.buffer),J}function a(){return R.buffer!=z&&ne(R.buffer),Z}function h(){return R.buffer!=z&&ne(R.buffer),q}var l,u,c=void 0!==(e=e||{})?e:{};c.ready=new Promise((function(e,t){l=e,u=t}));var p,d={};for(p in c)c.hasOwnProperty(p)&&(d[p]=c[p]);var m,f,g,_,y,v="./this.program",b=function(e,t){throw t},x="object"==typeof window,P="function"==typeof importScripts,T="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,w=c.ENVIRONMENT_IS_PTHREAD||!1,M="";function I(e){return c.locateFile?c.locateFile(e,M):M+e}if(T){var C;M=P?Zv("path").dirname(M)+"/":__dirname+"/",m=function(e,t){return _||(_=Zv("fs")),y||(y=Zv("path")),e=y.normalize(e),_.readFileSync(e,t?null:"utf8")},g=function(e){var t=m(e,!0);return t.buffer||(t=new Uint8Array(t)),L(t.buffer),t},f=function(e,t,s){_||(_=Zv("fs")),y||(y=Zv("path")),e=y.normalize(e),_.readFile(e,(function(e,i){e?s(e):t(i.buffer)}))},process.argv.length>1&&(v=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof fi))throw e})),process.on("unhandledRejection",Pe),b=function(e,t){if(de())throw process.exitCode=e,t;process.exit(e)},c.inspect=function(){return"[Emscripten Module object]"};try{C=Zv("worker_threads")}catch(e){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),e}global.Worker=C.Worker}else(x||P)&&(P?M=self.location.href:"undefined"!=typeof document&&document.currentScript&&(M=document.currentScript.src),s&&(M=s),M=0!==M.indexOf("blob:")?M.substr(0,M.lastIndexOf("/")+1):"",T?(m=function(e,t){return _||(_=Zv("fs")),y||(y=Zv("path")),e=y.normalize(e),_.readFileSync(e,t?null:"utf8")},g=function(e){var t=m(e,!0);return t.buffer||(t=new Uint8Array(t)),L(t.buffer),t},f=function(e,t,s){_||(_=Zv("fs")),y||(y=Zv("path")),e=y.normalize(e),_.readFile(e,(function(e,i){e?s(e):t(i.buffer)}))}):(m=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},P&&(g=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),f=function(e,t,s){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){200==i.status||0==i.status&&i.response?t(i.response):s()},i.onerror=s,i.send(null)}));T&&"undefined"==typeof performance&&(global.performance=Zv("perf_hooks").performance);var D,A=c.print||console.log.bind(console),E=c.printErr||console.warn.bind(console);for(p in d)d.hasOwnProperty(p)&&(c[p]=d[p]);function F(e){F.shown||(F.shown={}),F.shown[e]||(F.shown[e]=1,E(e))}d=null,c.arguments,c.thisProgram&&(v=c.thisProgram),c.quit&&(b=c.quit),c.wasmBinary&&(D=c.wasmBinary);var R,S,O=c.noExitRuntime||!0;"object"!=typeof WebAssembly&&Pe("no native wasm support detected");var B=!1;function L(e,t){e||Pe("Assertion failed: "+t)}function N(e){var t=new TextDecoder(e);this.decode=function(e){return e.buffer instanceof SharedArrayBuffer&&(e=new Uint8Array(e)),t.decode.call(t,e)}}var k="undefined"!=typeof TextDecoder?new N("utf8"):void 0;function j(e,t,s){for(var i=(t>>>=0)+s,r=t;e[r>>>0]&&!(r>=i);)++r;if(r-t>16&&e.subarray&&k)return k.decode(e.subarray(t>>>0,r>>>0));for(var o="";t<r;){var n=e[t++>>>0];if(128&n){var a=63&e[t++>>>0];if(192!=(224&n)){var h=63&e[t++>>>0];if((n=224==(240&n)?(15&n)<<12|a<<6|h:(7&n)<<18|a<<12|h<<6|63&e[t++>>>0])<65536)o+=String.fromCharCode(n);else{var l=n-65536;o+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else o+=String.fromCharCode((31&n)<<6|a)}else o+=String.fromCharCode(n)}return o}function G(e,t){return(e>>>=0)?j(i(),e,t):""}function H(e,t,s,i){if(!(i>0))return 0;for(var r=s>>>=0,o=s+i-1,n=0;n<e.length;++n){var a=e.charCodeAt(n);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++n)),a<=127){if(s>=o)break;t[s++>>>0]=a}else if(a<=2047){if(s+1>=o)break;t[s++>>>0]=192|a>>6,t[s++>>>0]=128|63&a}else if(a<=65535){if(s+2>=o)break;t[s++>>>0]=224|a>>12,t[s++>>>0]=128|a>>6&63,t[s++>>>0]=128|63&a}else{if(s+3>=o)break;t[s++>>>0]=240|a>>18,t[s++>>>0]=128|a>>12&63,t[s++>>>0]=128|a>>6&63,t[s++>>>0]=128|63&a}}return t[s>>>0]=0,s-r}function V(e,t,s){return H(e,i(),t,s)}function U(e){for(var t=0,s=0;s<e.length;++s){var i=e.charCodeAt(s);i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++s)),i<=127?++t:t+=i<=2047?2:i<=65535?3:4}return t}var z,W,X,Y,K,J,Z,Q,q,$="undefined"!=typeof TextDecoder?new N("utf-16le"):void 0;function ee(e,t){for(var s=e,n=s>>1,a=n+t/2;!(n>=a)&&o()[n>>>0];)++n;if((s=n<<1)-e>32&&$)return $.decode(i().subarray(e>>>0,s>>>0));for(var h="",l=0;!(l>=t/2);++l){var u=r()[e+2*l>>>1];if(0==u)break;h+=String.fromCharCode(u)}return h}function te(e,t,s){if(void 0===s&&(s=2147483647),s<2)return 0;for(var i=t,o=(s-=2)<2*e.length?s/2:e.length,n=0;n<o;++n){var a=e.charCodeAt(n);r()[t>>>1]=a,t+=2}return r()[t>>>1]=0,t-i}function se(e){return 2*e.length}function ie(e,t){for(var s=0,i="";!(s>=t/4);){var r=n()[e+4*s>>>2];if(0==r)break;if(++s,r>=65536){var o=r-65536;i+=String.fromCharCode(55296|o>>10,56320|1023&o)}else i+=String.fromCharCode(r)}return i}function re(e,t,s){if(void 0===s&&(s=2147483647),s<4)return 0;for(var i=t>>>=0,r=i+s-4,o=0;o<e.length;++o){var a=e.charCodeAt(o);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++o)),n()[t>>>2]=a,(t+=4)+4>r)break}return n()[t>>>2]=0,t-i}function oe(e){for(var t=0,s=0;s<e.length;++s){var i=e.charCodeAt(s);i>=55296&&i<=57343&&++s,t+=4}return t}function ne(e){z=e,c.HEAP8=W=new Int8Array(e),c.HEAP16=Y=new Int16Array(e),c.HEAP32=J=new Int32Array(e),c.HEAPU8=X=new Uint8Array(e),c.HEAPU16=K=new Uint16Array(e),c.HEAPU32=Z=new Uint32Array(e),c.HEAPF32=Q=new Float32Array(e),c.HEAPF64=q=new Float64Array(e)}w&&(z=c.buffer);var ae,he=c.INITIAL_MEMORY||16777216;if(w)R=c.wasmMemory,z=c.buffer;else if(c.wasmMemory)R=c.wasmMemory;else if(!((R=new WebAssembly.Memory({initial:he/65536,maximum:65536,shared:!0})).buffer instanceof SharedArrayBuffer))throw E("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),T&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");R&&(z=R.buffer),he=z.byteLength,ne(z);var le=[],ue=[],ce=[],pe=[];function de(){return O||!1}function me(){w||(c.noFSInit||ke.init.initialized||ke.init(),ke.ignorePermissions=!1,Ce(ue))}var fe,ge,_e,ye=0,ve=null;function be(e){ye++,c.monitorRunDependencies&&c.monitorRunDependencies(ye)}function xe(e){if(ye--,c.monitorRunDependencies&&c.monitorRunDependencies(ye),0==ye&&ve){var t=ve;ve=null,t()}}function Pe(e){c.onAbort&&c.onAbort(e),w&&console.error("Pthread aborting at "+(new Error).stack),E(e+=""),B=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw u(t),t}function Te(e){return e.startsWith("data:application/octet-stream;base64,")}function we(e){return e.startsWith("file://")}function Me(e){try{if(e==fe&&D)return new Uint8Array(D);if(g)return g(e);throw"both async and sync fetching of the wasm failed"}catch(e){Pe(e)}}c.preloadedImages={},c.preloadedAudios={},Te(fe="web-ifc-mt.wasm")||(fe=I(fe));var Ie={44848:function(){throw"Canceled!"},44866:function(e,t){setTimeout((function(){Qs(e,t)}),0)}};function Ce(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var s=t.func;"number"==typeof s?void 0===t.arg?ae.get(s)():ae.get(s)(t.arg):s(void 0===t.arg?null:t.arg)}else t(c)}}function De(e,s){if(e<=0||e>t().length||!0&e||s<0)return-28;if(0==s)return 0;s>=2147483647&&(s=1/0);var i=Atomics.load(n(),mi>>2),r=0;if(i==e&&Atomics.compareExchange(n(),mi>>2,i,0)==i&&(r=1,--s<=0))return 1;var o=Atomics.notify(n(),e>>2,s);if(o>=0)return o+r;throw"Atomics.notify returned an unexpected value "+o}c._emscripten_futex_wake=De;var Ae,Ee={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],initMainThreadBlock:function(){for(var e=navigator.hardwareConcurrency,t=0;t<e;++t)Ee.allocateUnusedWorker()},initRuntime:function(){for(var e=Ys(228),t=0;t<57;++t)a()[e/4+t>>>0]=0;n()[e+12>>>2]=e;var s=e+152;n()[s>>>2]=s;var i=Ys(512);for(t=0;t<128;++t)a()[i/4+t>>>0]=0;Atomics.store(a(),e+100>>2,i),Atomics.store(a(),e+40>>2,e),si(e,!P,1),Zs(e)},initWorker:function(){},pthreads:{},threadExitHandlers:[],runExitHandlers:function(){for(;Ee.threadExitHandlers.length>0;)Ee.threadExitHandlers.pop()();ni()},runExitHandlersAndDeinitThread:function(e,t){Atomics.store(a(),e+56>>2,1),Atomics.store(a(),e+60>>2,0),Ee.runExitHandlers(),Atomics.store(a(),e+4>>2,t),Atomics.store(a(),e+0>>2,1),De(e+0,2147483647),si(0,0,0)},setExitStatus:function(e){},threadExit:function(e){var t=oi();t&&(Ee.runExitHandlersAndDeinitThread(t,e),w&&postMessage({cmd:"exit"}))},threadCancel:function(){Ee.runExitHandlersAndDeinitThread(oi(),-1),postMessage({cmd:"cancelDone"})},terminateAllThreads:function(){for(var e in Ee.pthreads)(i=Ee.pthreads[e])&&i.worker&&Ee.returnWorkerToPool(i.worker);Ee.pthreads={};for(var t=0;t<Ee.unusedWorkers.length;++t)(s=Ee.unusedWorkers[t]).terminate();for(Ee.unusedWorkers=[],t=0;t<Ee.runningWorkers.length;++t){var s,i=(s=Ee.runningWorkers[t]).pthread;Ee.freeThreadData(i),s.terminate()}Ee.runningWorkers=[]},freeThreadData:function(e){if(e){if(e.threadInfoStruct){var t=n()[e.threadInfoStruct+100>>>2];n()[e.threadInfoStruct+100>>>2]=0,Ks(t),Ks(e.threadInfoStruct)}e.threadInfoStruct=0,e.allocatedOwnStack&&e.stackBase&&Ks(e.stackBase),e.stackBase=0,e.worker&&(e.worker.pthread=null)}},returnWorkerToPool:function(e){Ee.runWithoutMainThreadQueuedCalls((function(){delete Ee.pthreads[e.pthread.threadInfoStruct],Ee.unusedWorkers.push(e),Ee.runningWorkers.splice(Ee.runningWorkers.indexOf(e),1),Ee.freeThreadData(e.pthread),e.pthread=void 0}))},runWithoutMainThreadQueuedCalls:function(e){n()[di>>>2]=0;try{e()}finally{n()[di>>>2]=1}},receiveObjectTransfer:function(e){},threadInit:function(){for(var e in Ee.tlsInitFunctions)Ee.tlsInitFunctions[e]()},loadWasmModuleToWorker:function(e,t){e.onmessage=function(s){var i=s.data,r=i.cmd;if(e.pthread&&(Ee.currentProxiedOperationCallerThread=e.pthread.threadInfoStruct),i.targetThread&&i.targetThread!=oi()){var o=Ee.pthreads[i.targetThread];return o?o.worker.postMessage(s.data,i.transferList):console.error('Internal error! Worker sent a message "'+r+'" to target pthread '+i.targetThread+", but that thread no longer exists!"),void(Ee.currentProxiedOperationCallerThread=void 0)}if("processQueuedMainThreadWork"===r)$s();else if("spawnThread"===r)Ss(s.data);else if("cleanupThread"===r)!function(e){if(w)throw"Internal Error! cleanupThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in cleanupThread!";var t=Ee.pthreads[e];if(t){n()[e+12>>>2]=0;var s=t.worker;Ee.returnWorkerToPool(s)}}(i.thread);else if("killThread"===r)!function(e){if(w)throw"Internal Error! killThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in killThread!";n()[e+12>>>2]=0;var t=Ee.pthreads[e];t.worker.terminate(),Ee.freeThreadData(t),Ee.runningWorkers.splice(Ee.runningWorkers.indexOf(t.worker),1),t.worker.pthread=void 0}(i.thread);else if("cancelThread"===r)!function(e){if(w)throw"Internal Error! cancelThread() can only ever be called from main application thread!";if(!e)throw"Internal Error! Null pthread_ptr in cancelThread!";Ee.pthreads[e].worker.postMessage({cmd:"cancel"})}(i.thread);else if("loaded"===r)e.loaded=!0,t&&t(e),e.runPthread&&(e.runPthread(),delete e.runPthread);else if("print"===r)A("Thread "+i.threadId+": "+i.text);else if("printErr"===r)E("Thread "+i.threadId+": "+i.text);else if("alert"===r)alert("Thread "+i.threadId+": "+i.text);else if("exit"===r)e.pthread&&Atomics.load(a(),e.pthread.threadInfoStruct+64>>2)&&Ee.returnWorkerToPool(e);else if("exitProcess"===r)try{_i(i.returnCode)}catch(e){if(e instanceof fi)return;throw e}else"cancelDone"===r?Ee.returnWorkerToPool(e):"objectTransfer"===r?Ee.receiveObjectTransfer(s.data):"setimmediate"===s.data.target?e.postMessage(s.data):E("worker sent an unknown command "+r);Ee.currentProxiedOperationCallerThread=void 0},e.onerror=function(e){E("pthread sent an error! "+e.filename+":"+e.lineno+": "+e.message)},T&&(e.on("message",(function(t){e.onmessage({data:t})})),e.on("error",(function(t){e.onerror(t)})),e.on("exit",(function(e){}))),e.postMessage({cmd:"load",urlOrBlob:c.mainScriptUrlOrBlob||s,wasmMemory:R,wasmModule:S})},allocateUnusedWorker:function(){var e=I("web-ifc-mt.worker.js");Ee.unusedWorkers.push(new Worker(e))},getNewWorker:function(){return 0==Ee.unusedWorkers.length&&(Ee.allocateUnusedWorker(),Ee.loadWasmModuleToWorker(Ee.unusedWorkers[0])),Ee.unusedWorkers.pop()},busySpinWait:function(e){for(var t=performance.now()+e;performance.now()<t;);}};function Fe(e){return n()[ri()>>>2]=e,e}function Re(e){this.excPtr=e,this.ptr=e-16,this.set_type=function(e){n()[this.ptr+4>>>2]=e},this.get_type=function(){return n()[this.ptr+4>>>2]},this.set_destructor=function(e){n()[this.ptr+8>>>2]=e},this.get_destructor=function(){return n()[this.ptr+8>>>2]},this.set_refcount=function(e){n()[this.ptr>>>2]=e},this.set_caught=function(e){e=e?1:0,t()[this.ptr+12>>>0]=e},this.get_caught=function(){return 0!=t()[this.ptr+12>>>0]},this.set_rethrown=function(e){e=e?1:0,t()[this.ptr+13>>>0]=e},this.get_rethrown=function(){return 0!=t()[this.ptr+13>>>0]},this.init=function(e,t){this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){Atomics.add(n(),this.ptr+0>>2,1)},this.release_ref=function(){return 1===Atomics.sub(n(),this.ptr+0>>2,1)}}c.establishStackSpace=function(e,t){ui(e,t),hi(e)},c.invokeEntryPoint=function(e,t){return ae.get(e)(t)},Ae=T?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:w?function(){return performance.now()-c.__performance_now_clock_drift}:function(){return performance.now()};var Se={splitPath:function(e){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1)},normalizeArray:function(e,t){for(var s=0,i=e.length-1;i>=0;i--){var r=e[i];"."===r?e.splice(i,1):".."===r?(e.splice(i,1),s++):s&&(e.splice(i,1),s--)}if(t)for(;s;s--)e.unshift("..");return e},normalize:function(e){var t="/"===e.charAt(0),s="/"===e.substr(-1);return e=Se.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"),e||t||(e="."),e&&s&&(e+="/"),(t?"/":"")+e},dirname:function(e){var t=Se.splitPath(e),s=t[0],i=t[1];return s||i?(i&&(i=i.substr(0,i.length-1)),s+i):"."},basename:function(e){if("/"===e)return"/";var t=(e=(e=Se.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)},extname:function(e){return Se.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return Se.normalize(e.join("/"))},join2:function(e,t){return Se.normalize(e+"/"+t)}},Oe={resolve:function(){for(var e="",t=!1,s=arguments.length-1;s>=-1&&!t;s--){var i=s>=0?arguments[s]:ke.cwd();if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");if(!i)return"";e=i+"/"+e,t="/"===i.charAt(0)}return e=Se.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"),(t?"/":"")+e||"."},relative:function(e,t){function s(e){for(var t=0;t<e.length&&""===e[t];t++);for(var s=e.length-1;s>=0&&""===e[s];s--);return t>s?[]:e.slice(t,s-t+1)}e=Oe.resolve(e).substr(1),t=Oe.resolve(t).substr(1);for(var i=s(e.split("/")),r=s(t.split("/")),o=Math.min(i.length,r.length),n=o,a=0;a<o;a++)if(i[a]!==r[a]){n=a;break}var h=[];for(a=n;a<i.length;a++)h.push("..");return(h=h.concat(r.slice(n))).join("/")}},Be={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){Be.ttys[e]={input:[],output:[],ops:t},ke.registerDevice(e,Be.stream_ops)},stream_ops:{open:function(e){var t=Be.ttys[e.node.rdev];if(!t)throw new ke.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.flush(e.tty)},flush:function(e){e.tty.ops.flush(e.tty)},read:function(e,t,s,i,r){if(!e.tty||!e.tty.ops.get_char)throw new ke.ErrnoError(60);for(var o=0,n=0;n<i;n++){var a;try{a=e.tty.ops.get_char(e.tty)}catch(e){throw new ke.ErrnoError(29)}if(void 0===a&&0===o)throw new ke.ErrnoError(6);if(null==a)break;o++,t[s+n]=a}return o&&(e.node.timestamp=Date.now()),o},write:function(e,t,s,i,r){if(!e.tty||!e.tty.ops.put_char)throw new ke.ErrnoError(60);try{for(var o=0;o<i;o++)e.tty.ops.put_char(e.tty,t[s+o])}catch(e){throw new ke.ErrnoError(29)}return i&&(e.node.timestamp=Date.now()),o}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if(T){var s=Buffer.alloc(256),i=0;try{i=_.readSync(process.stdin.fd,s,0,256,null)}catch(e){if(!e.toString().includes("EOF"))throw e;i=0}t=i>0?s.slice(0,i).toString("utf-8"):null}else"undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n");if(!t)return null;e.input=Ws(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(A(j(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(A(j(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(E(j(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(E(j(e.output,0)),e.output=[])}}};function Le(e){e=function(e,t){return t||(t=16),Math.ceil(e/t)*t}(e,65536);var t=ci(65536,e);return t?(function(e,t){i().fill(0,e,e+t)}(t,e),t):0}var Ne={ops_table:null,mount:function(e){return Ne.createNode(null,"/",16895,0)},createNode:function(e,t,s,i){if(ke.isBlkdev(s)||ke.isFIFO(s))throw new ke.ErrnoError(63);Ne.ops_table||(Ne.ops_table={dir:{node:{getattr:Ne.node_ops.getattr,setattr:Ne.node_ops.setattr,lookup:Ne.node_ops.lookup,mknod:Ne.node_ops.mknod,rename:Ne.node_ops.rename,unlink:Ne.node_ops.unlink,rmdir:Ne.node_ops.rmdir,readdir:Ne.node_ops.readdir,symlink:Ne.node_ops.symlink},stream:{llseek:Ne.stream_ops.llseek}},file:{node:{getattr:Ne.node_ops.getattr,setattr:Ne.node_ops.setattr},stream:{llseek:Ne.stream_ops.llseek,read:Ne.stream_ops.read,write:Ne.stream_ops.write,allocate:Ne.stream_ops.allocate,mmap:Ne.stream_ops.mmap,msync:Ne.stream_ops.msync}},link:{node:{getattr:Ne.node_ops.getattr,setattr:Ne.node_ops.setattr,readlink:Ne.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Ne.node_ops.getattr,setattr:Ne.node_ops.setattr},stream:ke.chrdev_stream_ops}});var r=ke.createNode(e,t,s,i);return ke.isDir(r.mode)?(r.node_ops=Ne.ops_table.dir.node,r.stream_ops=Ne.ops_table.dir.stream,r.contents={}):ke.isFile(r.mode)?(r.node_ops=Ne.ops_table.file.node,r.stream_ops=Ne.ops_table.file.stream,r.usedBytes=0,r.contents=null):ke.isLink(r.mode)?(r.node_ops=Ne.ops_table.link.node,r.stream_ops=Ne.ops_table.link.stream):ke.isChrdev(r.mode)&&(r.node_ops=Ne.ops_table.chrdev.node,r.stream_ops=Ne.ops_table.chrdev.stream),r.timestamp=Date.now(),e&&(e.contents[t]=r,e.timestamp=r.timestamp),r},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){t>>>=0;var s=e.contents?e.contents.length:0;if(!(s>=t)){t=Math.max(t,s*(s<1048576?2:1.125)>>>0),0!=s&&(t=Math.max(t,256));var i=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(i.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(t>>>=0,e.usedBytes!=t)if(0==t)e.contents=null,e.usedBytes=0;else{var s=e.contents;e.contents=new Uint8Array(t),s&&e.contents.set(s.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=ke.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,ke.isDir(e.mode)?t.size=4096:ke.isFile(e.mode)?t.size=e.usedBytes:ke.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&Ne.resizeFileStorage(e,t.size)},lookup:function(e,t){throw ke.genericErrors[44]},mknod:function(e,t,s,i){return Ne.createNode(e,t,s,i)},rename:function(e,t,s){if(ke.isDir(e.mode)){var i;try{i=ke.lookupNode(t,s)}catch(e){}if(i)for(var r in i.contents)throw new ke.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=s,t.contents[s]=e,t.timestamp=e.parent.timestamp,e.parent=t},unlink:function(e,t){delete e.contents[t],e.timestamp=Date.now()},rmdir:function(e,t){var s=ke.lookupNode(e,t);for(var i in s.contents)throw new ke.ErrnoError(55);delete e.contents[t],e.timestamp=Date.now()},readdir:function(e){var t=[".",".."];for(var s in e.contents)e.contents.hasOwnProperty(s)&&t.push(s);return t},symlink:function(e,t,s){var i=Ne.createNode(e,t,41471,0);return i.link=s,i},readlink:function(e){if(!ke.isLink(e.mode))throw new ke.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,s,i,r){var o=e.node.contents;if(r>=e.node.usedBytes)return 0;var n=Math.min(e.node.usedBytes-r,i);if(n>8&&o.subarray)t.set(o.subarray(r,r+n),s);else for(var a=0;a<n;a++)t[s+a]=o[r+a];return n},write:function(e,s,i,r,o,n){if(s.buffer===t().buffer&&(n=!1),!r)return 0;var a=e.node;if(a.timestamp=Date.now(),s.subarray&&(!a.contents||a.contents.subarray)){if(n)return a.contents=s.subarray(i,i+r),a.usedBytes=r,r;if(0===a.usedBytes&&0===o)return a.contents=s.slice(i,i+r),a.usedBytes=r,r;if(o+r<=a.usedBytes)return a.contents.set(s.subarray(i,i+r),o),r}if(Ne.expandFileStorage(a,o+r),a.contents.subarray&&s.subarray)a.contents.set(s.subarray(i,i+r),o);else for(var h=0;h<r;h++)a.contents[o+h]=s[i+h];return a.usedBytes=Math.max(a.usedBytes,o+r),r},llseek:function(e,t,s){var i=t;if(1===s?i+=e.position:2===s&&ke.isFile(e.node.mode)&&(i+=e.node.usedBytes),i<0)throw new ke.ErrnoError(28);return i},allocate:function(e,t,s){Ne.expandFileStorage(e.node,t+s),e.node.usedBytes=Math.max(e.node.usedBytes,t+s)},mmap:function(e,s,i,r,o,n){if(0!==s)throw new ke.ErrnoError(28);if(!ke.isFile(e.node.mode))throw new ke.ErrnoError(43);var a,h,l=e.node.contents;if(2&n||l.buffer!==z){if((r>0||r+i<l.length)&&(l=l.subarray?l.subarray(r,r+i):Array.prototype.slice.call(l,r,r+i)),h=!0,!(a=Le(i)))throw new ke.ErrnoError(48);a>>>=0,t().set(l,a>>>0)}else h=!1,a=l.byteOffset;return{ptr:a,allocated:h}},msync:function(e,t,s,i,r){if(!ke.isFile(e.node.mode))throw new ke.ErrnoError(43);return 2&r||Ne.stream_ops.write(e,t,0,i,s,!1),0}}},ke={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(e,t){if(t=t||{},!(e=Oe.resolve(ke.cwd(),e)))return{path:"",node:null};var s={follow_mount:!0,recurse_count:0};for(var i in s)void 0===t[i]&&(t[i]=s[i]);if(t.recurse_count>8)throw new ke.ErrnoError(32);for(var r=Se.normalizeArray(e.split("/").filter((function(e){return!!e})),!1),o=ke.root,n="/",a=0;a<r.length;a++){var h=a===r.length-1;if(h&&t.parent)break;if(o=ke.lookupNode(o,r[a]),n=Se.join2(n,r[a]),ke.isMountpoint(o)&&(!h||h&&t.follow_mount)&&(o=o.mounted.root),!h||t.follow)for(var l=0;ke.isLink(o.mode);){var u=ke.readlink(n);if(n=Oe.resolve(Se.dirname(n),u),o=ke.lookupPath(n,{recurse_count:t.recurse_count}).node,l++>40)throw new ke.ErrnoError(32)}}return{path:n,node:o}},getPath:function(e){for(var t;;){if(ke.isRoot(e)){var s=e.mount.mountpoint;return t?"/"!==s[s.length-1]?s+"/"+t:s+t:s}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:function(e,t){for(var s=0,i=0;i<t.length;i++)s=(s<<5)-s+t.charCodeAt(i)|0;return(e+s>>>0)%ke.nameTable.length},hashAddNode:function(e){var t=ke.hashName(e.parent.id,e.name);e.name_next=ke.nameTable[t],ke.nameTable[t]=e},hashRemoveNode:function(e){var t=ke.hashName(e.parent.id,e.name);if(ke.nameTable[t]===e)ke.nameTable[t]=e.name_next;else for(var s=ke.nameTable[t];s;){if(s.name_next===e){s.name_next=e.name_next;break}s=s.name_next}},lookupNode:function(e,t){var s=ke.mayLookup(e);if(s)throw new ke.ErrnoError(s,e);for(var i=ke.hashName(e.id,t),r=ke.nameTable[i];r;r=r.name_next){var o=r.name;if(r.parent.id===e.id&&o===t)return r}return ke.lookup(e,t)},createNode:function(e,t,s,i){var r=new ke.FSNode(e,t,s,i);return ke.hashAddNode(r),r},destroyNode:function(e){ke.hashRemoveNode(e)},isRoot:function(e){return e===e.parent},isMountpoint:function(e){return!!e.mounted},isFile:function(e){return 32768==(61440&e)},isDir:function(e){return 16384==(61440&e)},isLink:function(e){return 40960==(61440&e)},isChrdev:function(e){return 8192==(61440&e)},isBlkdev:function(e){return 24576==(61440&e)},isFIFO:function(e){return 4096==(61440&e)},isSocket:function(e){return 49152==(49152&e)},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(e){var t=ke.flagModes[e];if(void 0===t)throw new Error("Unknown file open mode: "+e);return t},flagsToPermissionString:function(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:function(e,t){return ke.ignorePermissions||(!t.includes("r")||292&e.mode)&&(!t.includes("w")||146&e.mode)&&(!t.includes("x")||73&e.mode)?0:2},mayLookup:function(e){var t=ke.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:function(e,t){try{return ke.lookupNode(e,t),20}catch(e){}return ke.nodePermissions(e,"wx")},mayDelete:function(e,t,s){var i;try{i=ke.lookupNode(e,t)}catch(e){return e.errno}var r=ke.nodePermissions(e,"wx");if(r)return r;if(s){if(!ke.isDir(i.mode))return 54;if(ke.isRoot(i)||ke.getPath(i)===ke.cwd())return 10}else if(ke.isDir(i.mode))return 31;return 0},mayOpen:function(e,t){return e?ke.isLink(e.mode)?32:ke.isDir(e.mode)&&("r"!==ke.flagsToPermissionString(t)||512&t)?31:ke.nodePermissions(e,ke.flagsToPermissionString(t)):44},MAX_OPEN_FDS:4096,nextfd:function(e,t){e=e||0,t=t||ke.MAX_OPEN_FDS;for(var s=e;s<=t;s++)if(!ke.streams[s])return s;throw new ke.ErrnoError(33)},getStream:function(e){return ke.streams[e]},createStream:function(e,t,s){ke.FSStream||(ke.FSStream=function(){},ke.FSStream.prototype={object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}});var i=new ke.FSStream;for(var r in e)i[r]=e[r];e=i;var o=ke.nextfd(t,s);return e.fd=o,ke.streams[o]=e,e},closeStream:function(e){ke.streams[e]=null},chrdev_stream_ops:{open:function(e){var t=ke.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:function(){throw new ke.ErrnoError(70)}},major:function(e){return e>>8},minor:function(e){return 255&e},makedev:function(e,t){return e<<8|t},registerDevice:function(e,t){ke.devices[e]={stream_ops:t}},getDevice:function(e){return ke.devices[e]},getMounts:function(e){for(var t=[],s=[e];s.length;){var i=s.pop();t.push(i),s.push.apply(s,i.mounts)}return t},syncfs:function(e,t){"function"==typeof e&&(t=e,e=!1),ke.syncFSRequests++,ke.syncFSRequests>1&&E("warning: "+ke.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var s=ke.getMounts(ke.root.mount),i=0;function r(e){return ke.syncFSRequests--,t(e)}function o(e){if(e)return o.errored?void 0:(o.errored=!0,r(e));++i>=s.length&&r(null)}s.forEach((function(t){if(!t.type.syncfs)return o(null);t.type.syncfs(t,e,o)}))},mount:function(e,t,s){var i,r="/"===s,o=!s;if(r&&ke.root)throw new ke.ErrnoError(10);if(!r&&!o){var n=ke.lookupPath(s,{follow_mount:!1});if(s=n.path,i=n.node,ke.isMountpoint(i))throw new ke.ErrnoError(10);if(!ke.isDir(i.mode))throw new ke.ErrnoError(54)}var a={type:e,opts:t,mountpoint:s,mounts:[]},h=e.mount(a);return h.mount=a,a.root=h,r?ke.root=h:i&&(i.mounted=a,i.mount&&i.mount.mounts.push(a)),h},unmount:function(e){var t=ke.lookupPath(e,{follow_mount:!1});if(!ke.isMountpoint(t.node))throw new ke.ErrnoError(28);var s=t.node,i=s.mounted,r=ke.getMounts(i);Object.keys(ke.nameTable).forEach((function(e){for(var t=ke.nameTable[e];t;){var s=t.name_next;r.includes(t.mount)&&ke.destroyNode(t),t=s}})),s.mounted=null;var o=s.mount.mounts.indexOf(i);s.mount.mounts.splice(o,1)},lookup:function(e,t){return e.node_ops.lookup(e,t)},mknod:function(e,t,s){var i=ke.lookupPath(e,{parent:!0}).node,r=Se.basename(e);if(!r||"."===r||".."===r)throw new ke.ErrnoError(28);var o=ke.mayCreate(i,r);if(o)throw new ke.ErrnoError(o);if(!i.node_ops.mknod)throw new ke.ErrnoError(63);return i.node_ops.mknod(i,r,t,s)},create:function(e,t){return t=void 0!==t?t:438,t&=4095,t|=32768,ke.mknod(e,t,0)},mkdir:function(e,t){return t=void 0!==t?t:511,t&=1023,t|=16384,ke.mknod(e,t,0)},mkdirTree:function(e,t){for(var s=e.split("/"),i="",r=0;r<s.length;++r)if(s[r]){i+="/"+s[r];try{ke.mkdir(i,t)}catch(e){if(20!=e.errno)throw e}}},mkdev:function(e,t,s){return void 0===s&&(s=t,t=438),t|=8192,ke.mknod(e,t,s)},symlink:function(e,t){if(!Oe.resolve(e))throw new ke.ErrnoError(44);var s=ke.lookupPath(t,{parent:!0}).node;if(!s)throw new ke.ErrnoError(44);var i=Se.basename(t),r=ke.mayCreate(s,i);if(r)throw new ke.ErrnoError(r);if(!s.node_ops.symlink)throw new ke.ErrnoError(63);return s.node_ops.symlink(s,i,e)},rename:function(e,t){var s,i,r=Se.dirname(e),o=Se.dirname(t),n=Se.basename(e),a=Se.basename(t);if(s=ke.lookupPath(e,{parent:!0}).node,i=ke.lookupPath(t,{parent:!0}).node,!s||!i)throw new ke.ErrnoError(44);if(s.mount!==i.mount)throw new ke.ErrnoError(75);var h,l=ke.lookupNode(s,n),u=Oe.relative(e,o);if("."!==u.charAt(0))throw new ke.ErrnoError(28);if("."!==(u=Oe.relative(t,r)).charAt(0))throw new ke.ErrnoError(55);try{h=ke.lookupNode(i,a)}catch(e){}if(l!==h){var c=ke.isDir(l.mode),p=ke.mayDelete(s,n,c);if(p)throw new ke.ErrnoError(p);if(p=h?ke.mayDelete(i,a,c):ke.mayCreate(i,a))throw new ke.ErrnoError(p);if(!s.node_ops.rename)throw new ke.ErrnoError(63);if(ke.isMountpoint(l)||h&&ke.isMountpoint(h))throw new ke.ErrnoError(10);if(i!==s&&(p=ke.nodePermissions(s,"w")))throw new ke.ErrnoError(p);try{ke.trackingDelegate.willMovePath&&ke.trackingDelegate.willMovePath(e,t)}catch(s){E("FS.trackingDelegate['willMovePath']('"+e+"', '"+t+"') threw an exception: "+s.message)}ke.hashRemoveNode(l);try{s.node_ops.rename(l,i,a)}catch(e){throw e}finally{ke.hashAddNode(l)}try{ke.trackingDelegate.onMovePath&&ke.trackingDelegate.onMovePath(e,t)}catch(s){E("FS.trackingDelegate['onMovePath']('"+e+"', '"+t+"') threw an exception: "+s.message)}}},rmdir:function(e){var t=ke.lookupPath(e,{parent:!0}).node,s=Se.basename(e),i=ke.lookupNode(t,s),r=ke.mayDelete(t,s,!0);if(r)throw new ke.ErrnoError(r);if(!t.node_ops.rmdir)throw new ke.ErrnoError(63);if(ke.isMountpoint(i))throw new ke.ErrnoError(10);try{ke.trackingDelegate.willDeletePath&&ke.trackingDelegate.willDeletePath(e)}catch(t){E("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.rmdir(t,s),ke.destroyNode(i);try{ke.trackingDelegate.onDeletePath&&ke.trackingDelegate.onDeletePath(e)}catch(t){E("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readdir:function(e){var t=ke.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new ke.ErrnoError(54);return t.node_ops.readdir(t)},unlink:function(e){var t=ke.lookupPath(e,{parent:!0}).node,s=Se.basename(e),i=ke.lookupNode(t,s),r=ke.mayDelete(t,s,!1);if(r)throw new ke.ErrnoError(r);if(!t.node_ops.unlink)throw new ke.ErrnoError(63);if(ke.isMountpoint(i))throw new ke.ErrnoError(10);try{ke.trackingDelegate.willDeletePath&&ke.trackingDelegate.willDeletePath(e)}catch(t){E("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.unlink(t,s),ke.destroyNode(i);try{ke.trackingDelegate.onDeletePath&&ke.trackingDelegate.onDeletePath(e)}catch(t){E("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readlink:function(e){var t=ke.lookupPath(e).node;if(!t)throw new ke.ErrnoError(44);if(!t.node_ops.readlink)throw new ke.ErrnoError(28);return Oe.resolve(ke.getPath(t.parent),t.node_ops.readlink(t))},stat:function(e,t){var s=ke.lookupPath(e,{follow:!t}).node;if(!s)throw new ke.ErrnoError(44);if(!s.node_ops.getattr)throw new ke.ErrnoError(63);return s.node_ops.getattr(s)},lstat:function(e){return ke.stat(e,!0)},chmod:function(e,t,s){var i;if(!(i="string"==typeof e?ke.lookupPath(e,{follow:!s}).node:e).node_ops.setattr)throw new ke.ErrnoError(63);i.node_ops.setattr(i,{mode:4095&t|-4096&i.mode,timestamp:Date.now()})},lchmod:function(e,t){ke.chmod(e,t,!0)},fchmod:function(e,t){var s=ke.getStream(e);if(!s)throw new ke.ErrnoError(8);ke.chmod(s.node,t)},chown:function(e,t,s,i){var r;if(!(r="string"==typeof e?ke.lookupPath(e,{follow:!i}).node:e).node_ops.setattr)throw new ke.ErrnoError(63);r.node_ops.setattr(r,{timestamp:Date.now()})},lchown:function(e,t,s){ke.chown(e,t,s,!0)},fchown:function(e,t,s){var i=ke.getStream(e);if(!i)throw new ke.ErrnoError(8);ke.chown(i.node,t,s)},truncate:function(e,t){if(t<0)throw new ke.ErrnoError(28);var s;if(!(s="string"==typeof e?ke.lookupPath(e,{follow:!0}).node:e).node_ops.setattr)throw new ke.ErrnoError(63);if(ke.isDir(s.mode))throw new ke.ErrnoError(31);if(!ke.isFile(s.mode))throw new ke.ErrnoError(28);var i=ke.nodePermissions(s,"w");if(i)throw new ke.ErrnoError(i);s.node_ops.setattr(s,{size:t,timestamp:Date.now()})},ftruncate:function(e,t){var s=ke.getStream(e);if(!s)throw new ke.ErrnoError(8);if(0==(2097155&s.flags))throw new ke.ErrnoError(28);ke.truncate(s.node,t)},utime:function(e,t,s){var i=ke.lookupPath(e,{follow:!0}).node;i.node_ops.setattr(i,{timestamp:Math.max(t,s)})},open:function(e,t,s,i,r){if(""===e)throw new ke.ErrnoError(44);var o;if(s=void 0===s?438:s,s=64&(t="string"==typeof t?ke.modeStringToFlags(t):t)?4095&s|32768:0,"object"==typeof e)o=e;else{e=Se.normalize(e);try{o=ke.lookupPath(e,{follow:!(131072&t)}).node}catch(e){}}var n=!1;if(64&t)if(o){if(128&t)throw new ke.ErrnoError(20)}else o=ke.mknod(e,s,0),n=!0;if(!o)throw new ke.ErrnoError(44);if(ke.isChrdev(o.mode)&&(t&=-513),65536&t&&!ke.isDir(o.mode))throw new ke.ErrnoError(54);if(!n){var a=ke.mayOpen(o,t);if(a)throw new ke.ErrnoError(a)}512&t&&ke.truncate(o,0),t&=-131713;var h=ke.createStream({node:o,path:ke.getPath(o),flags:t,seekable:!0,position:0,stream_ops:o.stream_ops,ungotten:[],error:!1},i,r);h.stream_ops.open&&h.stream_ops.open(h),!c.logReadFiles||1&t||(ke.readFiles||(ke.readFiles={}),e in ke.readFiles||(ke.readFiles[e]=1,E("FS.trackingDelegate error on read file: "+e)));try{if(ke.trackingDelegate.onOpenFile){var l=0;1!=(2097155&t)&&(l|=ke.tracking.openFlags.READ),0!=(2097155&t)&&(l|=ke.tracking.openFlags.WRITE),ke.trackingDelegate.onOpenFile(e,l)}}catch(t){E("FS.trackingDelegate['onOpenFile']('"+e+"', flags) threw an exception: "+t.message)}return h},close:function(e){if(ke.isClosed(e))throw new ke.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(e){throw e}finally{ke.closeStream(e.fd)}e.fd=null},isClosed:function(e){return null===e.fd},llseek:function(e,t,s){if(ke.isClosed(e))throw new ke.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new ke.ErrnoError(70);if(0!=s&&1!=s&&2!=s)throw new ke.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,s),e.ungotten=[],e.position},read:function(e,t,s,i,r){if(s>>>=0,i<0||r<0)throw new ke.ErrnoError(28);if(ke.isClosed(e))throw new ke.ErrnoError(8);if(1==(2097155&e.flags))throw new ke.ErrnoError(8);if(ke.isDir(e.node.mode))throw new ke.ErrnoError(31);if(!e.stream_ops.read)throw new ke.ErrnoError(28);var o=void 0!==r;if(o){if(!e.seekable)throw new ke.ErrnoError(70)}else r=e.position;var n=e.stream_ops.read(e,t,s,i,r);return o||(e.position+=n),n},write:function(e,t,s,i,r,o){if(s>>>=0,i<0||r<0)throw new ke.ErrnoError(28);if(ke.isClosed(e))throw new ke.ErrnoError(8);if(0==(2097155&e.flags))throw new ke.ErrnoError(8);if(ke.isDir(e.node.mode))throw new ke.ErrnoError(31);if(!e.stream_ops.write)throw new ke.ErrnoError(28);e.seekable&&1024&e.flags&&ke.llseek(e,0,2);var n=void 0!==r;if(n){if(!e.seekable)throw new ke.ErrnoError(70)}else r=e.position;var a=e.stream_ops.write(e,t,s,i,r,o);n||(e.position+=a);try{e.path&&ke.trackingDelegate.onWriteToFile&&ke.trackingDelegate.onWriteToFile(e.path)}catch(t){E("FS.trackingDelegate['onWriteToFile']('"+e.path+"') threw an exception: "+t.message)}return a},allocate:function(e,t,s){if(ke.isClosed(e))throw new ke.ErrnoError(8);if(t<0||s<=0)throw new ke.ErrnoError(28);if(0==(2097155&e.flags))throw new ke.ErrnoError(8);if(!ke.isFile(e.node.mode)&&!ke.isDir(e.node.mode))throw new ke.ErrnoError(43);if(!e.stream_ops.allocate)throw new ke.ErrnoError(138);e.stream_ops.allocate(e,t,s)},mmap:function(e,t,s,i,r,o){if(t>>>=0,0!=(2&r)&&0==(2&o)&&2!=(2097155&e.flags))throw new ke.ErrnoError(2);if(1==(2097155&e.flags))throw new ke.ErrnoError(2);if(!e.stream_ops.mmap)throw new ke.ErrnoError(43);return e.stream_ops.mmap(e,t,s,i,r,o)},msync:function(e,t,s,i,r){return s>>>=0,e&&e.stream_ops.msync?e.stream_ops.msync(e,t,s,i,r):0},munmap:function(e){return 0},ioctl:function(e,t,s){if(!e.stream_ops.ioctl)throw new ke.ErrnoError(59);return e.stream_ops.ioctl(e,t,s)},readFile:function(e,t){if((t=t||{}).flags=t.flags||0,t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw new Error('Invalid encoding type "'+t.encoding+'"');var s,i=ke.open(e,t.flags),r=ke.stat(e).size,o=new Uint8Array(r);return ke.read(i,o,0,r,0),"utf8"===t.encoding?s=j(o,0):"binary"===t.encoding&&(s=o),ke.close(i),s},writeFile:function(e,t,s){(s=s||{}).flags=s.flags||577;var i=ke.open(e,s.flags,s.mode);if("string"==typeof t){var r=new Uint8Array(U(t)+1),o=H(t,r,0,r.length);ke.write(i,r,0,o,void 0,s.canOwn)}else{if(!ArrayBuffer.isView(t))throw new Error("Unsupported data type");ke.write(i,t,0,t.byteLength,void 0,s.canOwn)}ke.close(i)},cwd:function(){return ke.currentPath},chdir:function(e){var t=ke.lookupPath(e,{follow:!0});if(null===t.node)throw new ke.ErrnoError(44);if(!ke.isDir(t.node.mode))throw new ke.ErrnoError(54);var s=ke.nodePermissions(t.node,"x");if(s)throw new ke.ErrnoError(s);ke.currentPath=t.path},createDefaultDirectories:function(){ke.mkdir("/tmp"),ke.mkdir("/home"),ke.mkdir("/home/web_user")},createDefaultDevices:function(){ke.mkdir("/dev"),ke.registerDevice(ke.makedev(1,3),{read:function(){return 0},write:function(e,t,s,i,r){return i}}),ke.mkdev("/dev/null",ke.makedev(1,3)),Be.register(ke.makedev(5,0),Be.default_tty_ops),Be.register(ke.makedev(6,0),Be.default_tty1_ops),ke.mkdev("/dev/tty",ke.makedev(5,0)),ke.mkdev("/dev/tty1",ke.makedev(6,0));var e=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}if(T)try{var t=$v();return function(){return t.randomBytes(1)[0]}}catch(e){}return function(){Pe("randomDevice")}}();ke.createDevice("/dev","random",e),ke.createDevice("/dev","urandom",e),ke.mkdir("/dev/shm"),ke.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){ke.mkdir("/proc");var e=ke.mkdir("/proc/self");ke.mkdir("/proc/self/fd"),ke.mount({mount:function(){var t=ke.createNode(e,"fd",16895,73);return t.node_ops={lookup:function(e,t){var s=+t,i=ke.getStream(s);if(!i)throw new ke.ErrnoError(8);var r={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return i.path}}};return r.parent=r,r}},t}},{},"/proc/self/fd")},createStandardStreams:function(){c.stdin?ke.createDevice("/dev","stdin",c.stdin):ke.symlink("/dev/tty","/dev/stdin"),c.stdout?ke.createDevice("/dev","stdout",null,c.stdout):ke.symlink("/dev/tty","/dev/stdout"),c.stderr?ke.createDevice("/dev","stderr",null,c.stderr):ke.symlink("/dev/tty1","/dev/stderr"),ke.open("/dev/stdin",0),ke.open("/dev/stdout",1),ke.open("/dev/stderr",1)},ensureErrnoError:function(){ke.ErrnoError||(ke.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){this.errno=e},this.setErrno(e),this.message="FS error"},ke.ErrnoError.prototype=new Error,ke.ErrnoError.prototype.constructor=ke.ErrnoError,[44].forEach((function(e){ke.genericErrors[e]=new ke.ErrnoError(e),ke.genericErrors[e].stack="<generic error, no stack>"})))},staticInit:function(){ke.ensureErrnoError(),ke.nameTable=new Array(4096),ke.mount(Ne,{},"/"),ke.createDefaultDirectories(),ke.createDefaultDevices(),ke.createSpecialDirectories(),ke.filesystems={MEMFS:Ne}},init:function(e,t,s){ke.init.initialized=!0,ke.ensureErrnoError(),c.stdin=e||c.stdin,c.stdout=t||c.stdout,c.stderr=s||c.stderr,ke.createStandardStreams()},quit:function(){ke.init.initialized=!1;var e=c._fflush;e&&e(0);for(var t=0;t<ke.streams.length;t++){var s=ke.streams[t];s&&ke.close(s)}},getMode:function(e,t){var s=0;return e&&(s|=365),t&&(s|=146),s},findObject:function(e,t){var s=ke.analyzePath(e,t);return s.exists?s.object:null},analyzePath:function(e,t){try{e=(i=ke.lookupPath(e,{follow:!t})).path}catch(e){}var s={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var i=ke.lookupPath(e,{parent:!0});s.parentExists=!0,s.parentPath=i.path,s.parentObject=i.node,s.name=Se.basename(e),i=ke.lookupPath(e,{follow:!t}),s.exists=!0,s.path=i.path,s.object=i.node,s.name=i.node.name,s.isRoot="/"===i.path}catch(e){s.error=e.errno}return s},createPath:function(e,t,s,i){e="string"==typeof e?e:ke.getPath(e);for(var r=t.split("/").reverse();r.length;){var o=r.pop();if(o){var n=Se.join2(e,o);try{ke.mkdir(n)}catch(e){}e=n}}return n},createFile:function(e,t,s,i,r){var o=Se.join2("string"==typeof e?e:ke.getPath(e),t),n=ke.getMode(i,r);return ke.create(o,n)},createDataFile:function(e,t,s,i,r,o){var n=t?Se.join2("string"==typeof e?e:ke.getPath(e),t):e,a=ke.getMode(i,r),h=ke.create(n,a);if(s){if("string"==typeof s){for(var l=new Array(s.length),u=0,c=s.length;u<c;++u)l[u]=s.charCodeAt(u);s=l}ke.chmod(h,146|a);var p=ke.open(h,577);ke.write(p,s,0,s.length,0,o),ke.close(p),ke.chmod(h,a)}return h},createDevice:function(e,t,s,i){var r=Se.join2("string"==typeof e?e:ke.getPath(e),t),o=ke.getMode(!!s,!!i);ke.createDevice.major||(ke.createDevice.major=64);var n=ke.makedev(ke.createDevice.major++,0);return ke.registerDevice(n,{open:function(e){e.seekable=!1},close:function(e){i&&i.buffer&&i.buffer.length&&i(10)},read:function(e,t,i,r,o){for(var n=0,a=0;a<r;a++){var h;try{h=s()}catch(e){throw new ke.ErrnoError(29)}if(void 0===h&&0===n)throw new ke.ErrnoError(6);if(null==h)break;n++,t[i+a]=h}return n&&(e.node.timestamp=Date.now()),n},write:function(e,t,s,r,o){for(var n=0;n<r;n++)try{i(t[s+n])}catch(e){throw new ke.ErrnoError(29)}return r&&(e.node.timestamp=Date.now()),n}}),ke.mkdev(r,o,n)},forceLoadFile:function(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!m)throw new Error("Cannot load without read() or XMLHttpRequest.");try{e.contents=Ws(m(e.url),!0),e.usedBytes=e.contents.length}catch(e){throw new ke.ErrnoError(29)}},createLazyFile:function(e,t,s,i,r){function o(){this.lengthKnown=!1,this.chunks=[]}if(o.prototype.get=function(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,s=e/this.chunkSize|0;return this.getter(s)[t]}},o.prototype.setDataGetter=function(e){this.getter=e},o.prototype.cacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",s,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+s+". Status: "+e.status);var t,i=Number(e.getResponseHeader("Content-length")),r=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,o=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,n=1048576;r||(n=i);var a=this;a.setDataGetter((function(e){var t=e*n,r=(e+1)*n-1;if(r=Math.min(r,i-1),void 0===a.chunks[e]&&(a.chunks[e]=function(e,t){if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>i-1)throw new Error("only "+i+" bytes available! programmer error!");var r=new XMLHttpRequest;if(r.open("GET",s,!1),i!==n&&r.setRequestHeader("Range","bytes="+e+"-"+t),"undefined"!=typeof Uint8Array&&(r.responseType="arraybuffer"),r.overrideMimeType&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(null),!(r.status>=200&&r.status<300||304===r.status))throw new Error("Couldn't load "+s+". Status: "+r.status);return void 0!==r.response?new Uint8Array(r.response||[]):Ws(r.responseText||"",!0)}(t,r)),void 0===a.chunks[e])throw new Error("doXHR failed!");return a.chunks[e]})),!o&&i||(n=i=1,i=this.getter(0).length,n=i,A("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=i,this._chunkSize=n,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest){if(!P)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var n=new o;Object.defineProperties(n,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var a={isDevice:!1,contents:n}}else a={isDevice:!1,url:s};var h=ke.createFile(e,t,a,i,r);a.contents?h.contents=a.contents:a.url&&(h.contents=null,h.url=a.url),Object.defineProperties(h,{usedBytes:{get:function(){return this.contents.length}}});var l={};return Object.keys(h.stream_ops).forEach((function(e){var t=h.stream_ops[e];l[e]=function(){return ke.forceLoadFile(h),t.apply(null,arguments)}})),l.read=function(e,t,s,i,r){ke.forceLoadFile(h);var o=e.node.contents;if(r>=o.length)return 0;var n=Math.min(o.length-r,i);if(o.slice)for(var a=0;a<n;a++)t[s+a]=o[r+a];else for(a=0;a<n;a++)t[s+a]=o.get(r+a);return n},h.stream_ops=l,h},createPreloadedFile:function(e,t,s,i,r,o,n,a,h,l){Browser.init();var u=t?Oe.resolve(Se.join2(e,t)):e;function p(s){function p(s){l&&l(),a||ke.createDataFile(e,t,s,i,r,h),o&&o(),xe()}var d=!1;c.preloadPlugins.forEach((function(e){d||e.canHandle(u)&&(e.handle(s,u,p,(function(){n&&n(),xe()})),d=!0)})),d||p(s)}be(),"string"==typeof s?function(e,t,s,i){var r=i?"":"al "+e;f(e,(function(s){L(s,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(s)),r&&xe()}),(function(t){if(!s)throw'Loading data file "'+e+'" failed.';s()})),r&&be()}(s,(function(e){p(e)}),n):p(s)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(e,t,s){t=t||function(){},s=s||function(){};var i=ke.indexedDB();try{var r=i.open(ke.DB_NAME(),ke.DB_VERSION)}catch(e){return s(e)}r.onupgradeneeded=function(){A("creating db"),r.result.createObjectStore(ke.DB_STORE_NAME)},r.onsuccess=function(){var i=r.result.transaction([ke.DB_STORE_NAME],"readwrite"),o=i.objectStore(ke.DB_STORE_NAME),n=0,a=0,h=e.length;function l(){0==a?t():s()}e.forEach((function(e){var t=o.put(ke.analyzePath(e).object.contents,e);t.onsuccess=function(){++n+a==h&&l()},t.onerror=function(){a++,n+a==h&&l()}})),i.onerror=s},r.onerror=s},loadFilesFromDB:function(e,t,s){t=t||function(){},s=s||function(){};var i=ke.indexedDB();try{var r=i.open(ke.DB_NAME(),ke.DB_VERSION)}catch(e){return s(e)}r.onupgradeneeded=s,r.onsuccess=function(){var i=r.result;try{var o=i.transaction([ke.DB_STORE_NAME],"readonly")}catch(e){return void s(e)}var n=o.objectStore(ke.DB_STORE_NAME),a=0,h=0,l=e.length;function u(){0==h?t():s()}e.forEach((function(e){var t=n.get(e);t.onsuccess=function(){ke.analyzePath(e).exists&&ke.unlink(e),ke.createDataFile(Se.dirname(e),Se.basename(e),t.result,!0,!0,!0),++a+h==l&&u()},t.onerror=function(){h++,a+h==l&&u()}})),o.onerror=s},r.onerror=s}},je={mappings:{},DEFAULT_POLLMASK:5,umask:511,calculateAt:function(e,t,s){if("/"===t[0])return t;var i;if(-100===e)i=ke.cwd();else{var r=ke.getStream(e);if(!r)throw new ke.ErrnoError(8);i=r.path}if(0==t.length){if(!s)throw new ke.ErrnoError(44);return i}return Se.join2(i,t)},doStat:function(e,t,s){try{var i=e(t)}catch(e){if(e&&e.node&&Se.normalize(t)!==Se.normalize(ke.getPath(e.node)))return-54;throw e}return n()[s>>>2]=i.dev,n()[s+4>>>2]=0,n()[s+8>>>2]=i.ino,n()[s+12>>>2]=i.mode,n()[s+16>>>2]=i.nlink,n()[s+20>>>2]=i.uid,n()[s+24>>>2]=i.gid,n()[s+28>>>2]=i.rdev,n()[s+32>>>2]=0,_e=[i.size>>>0,(ge=i.size,+Math.abs(ge)>=1?ge>0?(0|Math.min(+Math.floor(ge/4294967296),4294967295))>>>0:~~+Math.ceil((ge-+(~~ge>>>0))/4294967296)>>>0:0)],n()[s+40>>>2]=_e[0],n()[s+44>>>2]=_e[1],n()[s+48>>>2]=4096,n()[s+52>>>2]=i.blocks,n()[s+56>>>2]=i.atime.getTime()/1e3|0,n()[s+60>>>2]=0,n()[s+64>>>2]=i.mtime.getTime()/1e3|0,n()[s+68>>>2]=0,n()[s+72>>>2]=i.ctime.getTime()/1e3|0,n()[s+76>>>2]=0,_e=[i.ino>>>0,(ge=i.ino,+Math.abs(ge)>=1?ge>0?(0|Math.min(+Math.floor(ge/4294967296),4294967295))>>>0:~~+Math.ceil((ge-+(~~ge>>>0))/4294967296)>>>0:0)],n()[s+80>>>2]=_e[0],n()[s+84>>>2]=_e[1],0},doMsync:function(e,t,s,r,o){var n=i().slice(e,e+s);ke.msync(t,n,o,s,r)},doMkdir:function(e,t){return"/"===(e=Se.normalize(e))[e.length-1]&&(e=e.substr(0,e.length-1)),ke.mkdir(e,t,0),0},doMknod:function(e,t,s){switch(61440&t){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return ke.mknod(e,t,s),0},doReadlink:function(e,s,i){if(i<=0)return-28;var r=ke.readlink(e),o=Math.min(i,U(r)),n=t()[s+o>>>0];return V(r,s,i+1),t()[s+o>>>0]=n,o},doAccess:function(e,t){if(-8&t)return-28;var s;if(!(s=ke.lookupPath(e,{follow:!0}).node))return-44;var i="";return 4&t&&(i+="r"),2&t&&(i+="w"),1&t&&(i+="x"),i&&ke.nodePermissions(s,i)?-2:0},doDup:function(e,t,s){var i=ke.getStream(s);return i&&ke.close(i),ke.open(e,t,0,s,s).fd},doReadv:function(e,s,i,r){for(var o=0,a=0;a<i;a++){var h=n()[s+8*a>>>2],l=n()[s+(8*a+4)>>>2],u=ke.read(e,t(),h,l,r);if(u<0)return-1;if(o+=u,u<l)break}return o},doWritev:function(e,s,i,r){for(var o=0,a=0;a<i;a++){var h=n()[s+8*a>>>2],l=n()[s+(8*a+4)>>>2],u=ke.write(e,t(),h,l,r);if(u<0)return-1;o+=u}return o},varargs:void 0,get:function(){return je.varargs+=4,n()[je.varargs-4>>>2]},getStr:function(e){return G(e)},getStreamFromFD:function(e){var t=ke.getStream(e);if(!t)throw new ke.ErrnoError(8);return t},get64:function(e,t){return e}};function Ge(e,t,s){if(w)return ds(2,1,e,t,s);je.varargs=s;try{var i=je.getStreamFromFD(e);switch(t){case 0:return(o=je.get())<0?-28:ke.open(i.path,i.flags,0,o).fd;case 1:case 2:case 13:case 14:return 0;case 3:return i.flags;case 4:var o=je.get();return i.flags|=o,0;case 12:return o=je.get(),r()[o+0>>>1]=2,0;case 16:case 8:default:return-28;case 9:return Fe(28),-1}}catch(e){return void 0!==ke&&e instanceof ke.ErrnoError||Pe(e),-e.errno}}function He(e,t,s){if(w)return ds(3,1,e,t,s);je.varargs=s;try{var i=je.getStreamFromFD(e);switch(t){case 21509:case 21505:case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:case 21523:case 21524:return i.tty?0:-59;case 21519:if(!i.tty)return-59;var r=je.get();return n()[r>>>2]=0,0;case 21520:return i.tty?-28:-59;case 21531:return r=je.get(),ke.ioctl(i,t,r);default:Pe("bad ioctl syscall "+t)}}catch(e){return void 0!==ke&&e instanceof ke.ErrnoError||Pe(e),-e.errno}}function Ve(e,t,s){if(w)return ds(4,1,e,t,s);je.varargs=s;try{var i=je.getStr(e),r=s?je.get():0;return ke.open(i,t,r).fd}catch(e){return void 0!==ke&&e instanceof ke.ErrnoError||Pe(e),-e.errno}}var Ue={};function ze(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function We(e){return this.fromWireType(a()[e>>>2])}var Xe={},Ye={},Ke={};function Je(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function Ze(e,t){return e=Je(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function Qe(e,t){var s=Ze(t,(function(e){this.name=t,this.message=e;var s=new Error(e).stack;void 0!==s&&(this.stack=this.toString()+"\n"+s.replace(/^Error(:[^\n]*)?\n/,""))}));return s.prototype=Object.create(e.prototype),s.prototype.constructor=s,s.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},s}var qe=void 0;function $e(e){throw new qe(e)}function et(e,t,s){function i(t){var i=s(t);i.length!==e.length&&$e("Mismatched type converter count");for(var r=0;r<e.length;++r)at(e[r],i[r])}e.forEach((function(e){Ke[e]=t}));var r=new Array(t.length),o=[],n=0;t.forEach((function(e,t){Ye.hasOwnProperty(e)?r[t]=Ye[e]:(o.push(e),Xe.hasOwnProperty(e)||(Xe[e]=[]),Xe[e].push((function(){r[t]=Ye[e],++n===o.length&&i(r)})))})),0===o.length&&i(r)}var tt={};function st(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var it=void 0;function rt(e){for(var t="",s=e;i()[s>>>0];)t+=it[i()[s++>>>0]];return t}var ot=void 0;function nt(e){throw new ot(e)}function at(e,t,s){if(s=s||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var i=t.name;if(e||nt('type "'+i+'" must have a positive integer typeid pointer'),Ye.hasOwnProperty(e)){if(s.ignoreDuplicateRegistrations)return;nt("Cannot register type '"+i+"' twice")}if(Ye[e]=t,delete Ke[e],Xe.hasOwnProperty(e)){var r=Xe[e];delete Xe[e],r.forEach((function(e){e()}))}}function ht(e){if(!(this instanceof Pt))return!1;if(!(e instanceof Pt))return!1;for(var t=this.$$.ptrType.registeredClass,s=this.$$.ptr,i=e.$$.ptrType.registeredClass,r=e.$$.ptr;t.baseClass;)s=t.upcast(s),t=t.baseClass;for(;i.baseClass;)r=i.upcast(r),i=i.baseClass;return t===i&&s===r}function lt(e){return{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType}}function ut(e){nt(e.$$.ptrType.registeredClass.name+" instance already deleted")}var ct=!1;function pt(e){}function dt(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function mt(e){return"undefined"==typeof FinalizationGroup?(mt=function(e){return e},e):(ct=new FinalizationGroup((function(e){for(var t=e.next();!t.done;t=e.next()){var s=t.value;s.ptr?dt(s):console.warn("object already deleted: "+s.ptr)}})),pt=function(e){ct.unregister(e.$$)},(mt=function(e){return ct.register(e,e.$$,e.$$),e})(e))}function ft(){if(this.$$.ptr||ut(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e=mt(Object.create(Object.getPrototypeOf(this),{$$:{value:lt(this.$$)}}));return e.$$.count.value+=1,e.$$.deleteScheduled=!1,e}function gt(){this.$$.ptr||ut(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&nt("Object already scheduled for deletion"),pt(this),dt(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function _t(){return!this.$$.ptr}var yt=void 0,vt=[];function bt(){for(;vt.length;){var e=vt.pop();e.$$.deleteScheduled=!1,e.delete()}}function xt(){return this.$$.ptr||ut(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&nt("Object already scheduled for deletion"),vt.push(this),1===vt.length&&yt&&yt(bt),this.$$.deleteScheduled=!0,this}function Pt(){}var Tt={};function wt(e,t,s){if(void 0===e[t].overloadTable){var i=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||nt("Function '"+s+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[i.argCount]=i}}function Mt(e,t,s){c.hasOwnProperty(e)?((void 0===s||void 0!==c[e].overloadTable&&void 0!==c[e].overloadTable[s])&&nt("Cannot register public name '"+e+"' twice"),wt(c,e,e),c.hasOwnProperty(s)&&nt("Cannot register multiple overloads of a function with the same number of arguments ("+s+")!"),c[e].overloadTable[s]=t):(c[e]=t,void 0!==s&&(c[e].numArguments=s))}function It(e,t,s,i,r,o,n,a){this.name=e,this.constructor=t,this.instancePrototype=s,this.rawDestructor=i,this.baseClass=r,this.getActualType=o,this.upcast=n,this.downcast=a,this.pureVirtualFunctions=[]}function Ct(e,t,s){for(;t!==s;)t.upcast||nt("Expected null or instance of "+s.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function Dt(e,t){if(null===t)return this.isReference&&nt("null is not a valid "+this.name),0;t.$$||nt('Cannot pass "'+os(t)+'" as a '+this.name),t.$$.ptr||nt("Cannot pass deleted object as a pointer of type "+this.name);var s=t.$$.ptrType.registeredClass;return Ct(t.$$.ptr,s,this.registeredClass)}function At(e,t){var s;if(null===t)return this.isReference&&nt("null is not a valid "+this.name),this.isSmartPointer?(s=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,s),s):0;t.$$||nt('Cannot pass "'+os(t)+'" as a '+this.name),t.$$.ptr||nt("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&nt("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var i=t.$$.ptrType.registeredClass;if(s=Ct(t.$$.ptr,i,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&nt("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?s=t.$$.smartPtr:nt("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:s=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)s=t.$$.smartPtr;else{var r=t.clone();s=this.rawShare(s,ss((function(){r.delete()}))),null!==e&&e.push(this.rawDestructor,s)}break;default:nt("Unsupporting sharing policy")}return s}function Et(e,t){if(null===t)return this.isReference&&nt("null is not a valid "+this.name),0;t.$$||nt('Cannot pass "'+os(t)+'" as a '+this.name),t.$$.ptr||nt("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&nt("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var s=t.$$.ptrType.registeredClass;return Ct(t.$$.ptr,s,this.registeredClass)}function Ft(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function Rt(e){this.rawDestructor&&this.rawDestructor(e)}function St(e){null!==e&&e.delete()}function Ot(e,t,s){if(t===s)return e;if(void 0===s.baseClass)return null;var i=Ot(e,t,s.baseClass);return null===i?null:s.downcast(i)}function Bt(){return Object.keys(kt).length}function Lt(){var e=[];for(var t in kt)kt.hasOwnProperty(t)&&e.push(kt[t]);return e}function Nt(e){yt=e,vt.length&&yt&&yt(bt)}var kt={};function jt(e,t){return t=function(e,t){for(void 0===t&&nt("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),kt[t]}function Gt(e,t){return t.ptrType&&t.ptr||$e("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!=!!t.smartPtr&&$e("Both smartPtrType and smartPtr must be specified"),t.count={value:1},mt(Object.create(e,{$$:{value:t}}))}function Ht(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var s=jt(this.registeredClass,t);if(void 0!==s){if(0===s.$$.count.value)return s.$$.ptr=t,s.$$.smartPtr=e,s.clone();var i=s.clone();return this.destructor(e),i}function r(){return this.isSmartPointer?Gt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):Gt(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var o,n=this.registeredClass.getActualType(t),a=Tt[n];if(!a)return r.call(this);o=this.isConst?a.constPointerType:a.pointerType;var h=Ot(t,this.registeredClass,o.registeredClass);return null===h?r.call(this):this.isSmartPointer?Gt(o.registeredClass.instancePrototype,{ptrType:o,ptr:h,smartPtrType:this,smartPtr:e}):Gt(o.registeredClass.instancePrototype,{ptrType:o,ptr:h})}function Vt(e,t,s,i,r,o,n,a,h,l,u){this.name=e,this.registeredClass=t,this.isReference=s,this.isConst=i,this.isSmartPointer=r,this.pointeeType=o,this.sharingPolicy=n,this.rawGetPointee=a,this.rawConstructor=h,this.rawShare=l,this.rawDestructor=u,r||void 0!==t.baseClass?this.toWireType=At:i?(this.toWireType=Dt,this.destructorFunction=null):(this.toWireType=Et,this.destructorFunction=null)}function Ut(e,t,s){c.hasOwnProperty(e)||$e("Replacing nonexistant public symbol"),void 0!==c[e].overloadTable&&void 0!==s?c[e].overloadTable[s]=t:(c[e]=t,c[e].argCount=s)}function zt(e,t,s){return e.includes("j")?function(e,t,s){var i=c["dynCall_"+e];return s&&s.length?i.apply(null,[t].concat(s)):i.call(null,t)}(e,t,s):ae.get(t).apply(null,s)}function Wt(e,t){var s,i,r,o=(e=rt(e)).includes("j")?(s=e,i=t,r=[],function(){r.length=arguments.length;for(var e=0;e<arguments.length;e++)r[e]=arguments[e];return zt(s,i,r)}):ae.get(t);return"function"!=typeof o&&nt("unknown function pointer with signature "+e+": "+t),o}var Xt=void 0;function Yt(e){var t=Js(e),s=rt(t);return Ks(t),s}function Kt(e,t){var s=[],i={};throw t.forEach((function e(t){i[t]||Ye[t]||(Ke[t]?Ke[t].forEach(e):(s.push(t),i[t]=!0))})),new Xt(e+": "+s.map(Yt).join([", "]))}function Jt(e,t){for(var s=[],i=0;i<e;i++)s.push(n()[(t>>2)+i>>>0]);return s}function Zt(e,t,s,i,r){var o=t.length;o<2&&nt("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var n=null!==t[1]&&null!==s,a=!1,h=1;h<t.length;++h)if(null!==t[h]&&void 0===t[h].destructorFunction){a=!0;break}var l="void"!==t[0].name,u="",c="";for(h=0;h<o-2;++h)u+=(0!==h?", ":"")+"arg"+h,c+=(0!==h?", ":"")+"arg"+h+"Wired";var p="return function "+Je(e)+"("+u+") {\nif (arguments.length !== "+(o-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(o-2)+" args!');\n}\n";a&&(p+="var destructors = [];\n");var d=a?"destructors":"null",m=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],f=[nt,i,r,ze,t[0],t[1]];for(n&&(p+="var thisWired = classParam.toWireType("+d+", this);\n"),h=0;h<o-2;++h)p+="var arg"+h+"Wired = argType"+h+".toWireType("+d+", arg"+h+"); // "+t[h+2].name+"\n",m.push("argType"+h),f.push(t[h+2]);if(n&&(c="thisWired"+(c.length>0?", ":"")+c),p+=(l?"var rv = ":"")+"invoker(fn"+(c.length>0?", ":"")+c+");\n",a)p+="runDestructors(destructors);\n";else for(h=n?1:2;h<t.length;++h){var g=1===h?"thisWired":"arg"+(h-2)+"Wired";null!==t[h].destructorFunction&&(p+=g+"_dtor("+g+"); // "+t[h].name+"\n",m.push(g+"_dtor"),f.push(t[h].destructorFunction))}l&&(p+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),p+="}\n",m.push(p);var _=function(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var s=Ze(e.name||"unknownFunctionName",(function(){}));s.prototype=e.prototype;var i=new s,r=e.apply(i,t);return r instanceof Object?r:i}(Function,m).apply(null,f);return _}var Qt=[],qt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function $t(e){e>4&&0==--qt[e].refcount&&(qt[e]=void 0,Qt.push(e))}function es(){for(var e=0,t=5;t<qt.length;++t)void 0!==qt[t]&&++e;return e}function ts(){for(var e=5;e<qt.length;++e)if(void 0!==qt[e])return qt[e];return null}function ss(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=Qt.length?Qt.pop():qt.length;return qt[t]={refcount:1,value:e},t}}function is(e,s,h){switch(s){case 0:return function(e){var s=h?t():i();return this.fromWireType(s[e>>>0])};case 1:return function(e){var t=h?r():o();return this.fromWireType(t[e>>>1])};case 2:return function(e){var t=h?n():a();return this.fromWireType(t[e>>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function rs(e,t){var s=Ye[e];return void 0===s&&nt(t+" has unknown type "+Yt(e)),s}function os(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function ns(e,t){switch(t){case 2:return function(e){return this.fromWireType((R.buffer!=z&&ne(R.buffer),Q)[e>>>2])};case 3:return function(e){return this.fromWireType(h()[e>>>3])};default:throw new TypeError("Unknown float type: "+e)}}function as(e,s,h){switch(s){case 0:return h?function(e){return t()[e>>>0]}:function(e){return i()[e>>>0]};case 1:return h?function(e){return r()[e>>>1]}:function(e){return o()[e>>>1]};case 2:return h?function(e){return n()[e>>>2]}:function(e){return a()[e>>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function hs(e){return e||nt("Cannot use deleted val. handle = "+e),qt[e].value}var ls={};function us(e){var t=ls[e];return void 0===t?rt(e):t}function cs(){return"object"==typeof globalThis?globalThis:Function("return this")()}var ps=[];function ds(e,t){for(var s=arguments.length-2,i=ai(),r=s,o=li(8*r),n=o>>3,a=0;a<s;a++){var l=arguments[2+a];h()[n+a>>>0]=l}var u=ei(e,r,o,t);return hi(i),u}var ms=[];function fs(e){try{return R.grow(e-z.byteLength+65535>>>16),ne(R.buffer),1}catch(e){}}var gs={inEventHandler:0,removeAllEventListeners:function(){for(var e=gs.eventHandlers.length-1;e>=0;--e)gs._removeHandler(e);gs.eventHandlers=[],gs.deferredCalls=[]},registerRemoveEventListeners:function(){gs.removeEventListenersRegistered||(gs.removeEventListenersRegistered=!0)},deferredCalls:[],deferCall:function(e,t,s){function i(e,t){if(e.length!=t.length)return!1;for(var s in e)if(e[s]!=t[s])return!1;return!0}for(var r in gs.deferredCalls){var o=gs.deferredCalls[r];if(o.targetFunction==e&&i(o.argsList,s))return}gs.deferredCalls.push({targetFunction:e,precedence:t,argsList:s}),gs.deferredCalls.sort((function(e,t){return e.precedence<t.precedence}))},removeDeferredCalls:function(e){for(var t=0;t<gs.deferredCalls.length;++t)gs.deferredCalls[t].targetFunction==e&&(gs.deferredCalls.splice(t,1),--t)},canPerformEventHandlerRequests:function(){return gs.inEventHandler&&gs.currentEventHandler.allowsDeferredCalls},runDeferredCalls:function(){if(gs.canPerformEventHandlerRequests())for(var e=0;e<gs.deferredCalls.length;++e){var t=gs.deferredCalls[e];gs.deferredCalls.splice(e,1),--e,t.targetFunction.apply(null,t.argsList)}},eventHandlers:[],removeAllHandlersOnTarget:function(e,t){for(var s=0;s<gs.eventHandlers.length;++s)gs.eventHandlers[s].target!=e||t&&t!=gs.eventHandlers[s].eventTypeString||gs._removeHandler(s--)},_removeHandler:function(e){var t=gs.eventHandlers[e];t.target.removeEventListener(t.eventTypeString,t.eventListenerFunc,t.useCapture),gs.eventHandlers.splice(e,1)},registerOrRemoveHandler:function(e){var t=function(t){++gs.inEventHandler,gs.currentEventHandler=e,gs.runDeferredCalls(),e.handlerFunc(t),gs.runDeferredCalls(),--gs.inEventHandler};if(e.callbackfunc)e.eventListenerFunc=t,e.target.addEventListener(e.eventTypeString,t,e.useCapture),gs.eventHandlers.push(e),gs.registerRemoveEventListeners();else for(var s=0;s<gs.eventHandlers.length;++s)gs.eventHandlers[s].target==e.target&&gs.eventHandlers[s].eventTypeString==e.eventTypeString&&gs._removeHandler(s--)},queueEventHandlerOnThread_iiii:function(e,t,s,i,r){var o=ai(),a=li(12);n()[a>>>2]=s,n()[a+4>>>2]=i,n()[a+8>>>2]=r,ti(0,e,637534208,t,i,a),hi(o)},getTargetThreadForEventCallback:function(e){switch(e){case 1:return 0;case 2:return Ee.currentProxiedOperationCallerThread;default:return e}},getNodeNameForTarget:function(e){return e?e==window?"#window":e==screen?"#screen":e&&e.nodeName?e.nodeName:"":""},fullscreenEnabled:function(){return document.fullscreenEnabled||document.webkitFullscreenEnabled}};function _s(e,t,s,i){var r,o,a,h=ai(),l=li(12),u=0;t&&(o=U(r=t)+1,a=Ys(o),V(r,a,o),u=a),n()[l>>>2]=u,n()[l+4>>>2]=s,n()[l+8>>>2]=i,ti(0,e,657457152,0,u,l),hi(h)}var ys=[0,"undefined"!=typeof document?document:0,"undefined"!=typeof window?window:0];function vs(e){var t;return e=(t=e)>2?G(t):t,ys[e]||("undefined"!=typeof document?document.querySelector(e):void 0)}function bs(e){return vs(e)}function xs(e,t,s){var i=bs(e);if(!i)return-4;if(i.canvasSharedPtr&&(n()[i.canvasSharedPtr>>>2]=t,n()[i.canvasSharedPtr+4>>>2]=s),!i.offscreenCanvas&&i.controlTransferredOffscreen)return i.canvasSharedPtr?(function(e,t,s,i){_s(e,t=t?G(t):"",s,i)}(n()[i.canvasSharedPtr+8>>>2],e,t,s),1):-4;i.offscreenCanvas&&(i=i.offscreenCanvas);var r=!1;if(i.GLctxObject&&i.GLctxObject.GLctx){var o=i.GLctxObject.GLctx.getParameter(2978);r=0===o[0]&&0===o[1]&&o[2]===i.width&&o[3]===i.height}return i.width=t,i.height=s,r&&i.GLctxObject.GLctx.viewport(0,0,t,s),0}function Ps(e,t,s){return w?ds(5,1,e,t,s):xs(e,t,s)}var Ts={counter:1,buffers:[],programs:[],framebuffers:[],renderbuffers:[],textures:[],shaders:[],vaos:[],contexts:{},offscreenCanvases:{},queries:[],stringCache:{},unpackAlignment:4,recordError:function(e){Ts.lastError||(Ts.lastError=e)},getNewId:function(e){for(var t=Ts.counter++,s=e.length;s<t;s++)e[s]=null;return t},getSource:function(e,t,s,i){for(var r="",o=0;o<t;++o){var a=i?n()[i+4*o>>>2]:-1;r+=G(n()[s+4*o>>>2],a<0?void 0:a)}return r},createContext:function(e,t){e.getContextSafariWebGL2Fixed||(e.getContextSafariWebGL2Fixed=e.getContext,e.getContext=function(t,s){var i=e.getContextSafariWebGL2Fixed(t,s);return"webgl"==t==i instanceof WebGLRenderingContext?i:null});var s=e.getContext("webgl",t);return s?Ts.registerContext(s,t):0},registerContext:function(e,t){var s=Ys(8);n()[s+4>>>2]=oi();var i={handle:s,attributes:t,version:t.majorVersion,GLctx:e};return e.canvas&&(e.canvas.GLctxObject=i),Ts.contexts[s]=i,(void 0===t.enableExtensionsByDefault||t.enableExtensionsByDefault)&&Ts.initExtensions(i),s},makeContextCurrent:function(e){return Ts.currentContext=Ts.contexts[e],c.ctx=Gs=Ts.currentContext&&Ts.currentContext.GLctx,!(e&&!Gs)},getContext:function(e){return Ts.contexts[e]},deleteContext:function(e){Ts.currentContext===Ts.contexts[e]&&(Ts.currentContext=null),"object"==typeof gs&&gs.removeAllHandlersOnTarget(Ts.contexts[e].GLctx.canvas),Ts.contexts[e]&&Ts.contexts[e].GLctx.canvas&&(Ts.contexts[e].GLctx.canvas.GLctxObject=void 0),Ks(Ts.contexts[e].handle),Ts.contexts[e]=null},initExtensions:function(e){if(e||(e=Ts.currentContext),!e.initExtensionsDone){e.initExtensionsDone=!0;var t,s=e.GLctx;!function(e){var t=e.getExtension("ANGLE_instanced_arrays");t&&(e.vertexAttribDivisor=function(e,s){t.vertexAttribDivisorANGLE(e,s)},e.drawArraysInstanced=function(e,s,i,r){t.drawArraysInstancedANGLE(e,s,i,r)},e.drawElementsInstanced=function(e,s,i,r,o){t.drawElementsInstancedANGLE(e,s,i,r,o)})}(s),function(e){var t=e.getExtension("OES_vertex_array_object");t&&(e.createVertexArray=function(){return t.createVertexArrayOES()},e.deleteVertexArray=function(e){t.deleteVertexArrayOES(e)},e.bindVertexArray=function(e){t.bindVertexArrayOES(e)},e.isVertexArray=function(e){return t.isVertexArrayOES(e)})}(s),function(e){var t=e.getExtension("WEBGL_draw_buffers");t&&(e.drawBuffers=function(e,s){t.drawBuffersWEBGL(e,s)})}(s),s.disjointTimerQueryExt=s.getExtension("EXT_disjoint_timer_query"),(t=s).multiDrawWebgl=t.getExtension("WEBGL_multi_draw"),(s.getSupportedExtensions()||[]).forEach((function(e){e.includes("lose_context")||e.includes("debug")||s.getExtension(e)}))}}},ws=["default","low-power","high-performance"],Ms={};function Is(){if(!Is.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:v||"./this.program"};for(var t in Ms)void 0===Ms[t]?delete e[t]:e[t]=Ms[t];var s=[];for(var t in e)s.push(t+"="+e[t]);Is.strings=s}return Is.strings}function Cs(e,s){if(w)return ds(6,1,e,s);try{var i=0;return Is().forEach((function(r,o){var a=s+i;n()[e+4*o>>>2]=a,function(e,s,i){for(var r=0;r<e.length;++r)t()[s++>>>0]=e.charCodeAt(r);i||(t()[s>>>0]=0)}(r,a),i+=r.length+1})),0}catch(e){return void 0!==ke&&e instanceof ke.ErrnoError||Pe(e),e.errno}}function Ds(e,t){if(w)return ds(7,1,e,t);try{var s=Is();n()[e>>>2]=s.length;var i=0;return s.forEach((function(e){i+=e.length+1})),n()[t>>>2]=i,0}catch(e){return void 0!==ke&&e instanceof ke.ErrnoError||Pe(e),e.errno}}function As(e){if(w)return ds(8,1,e);try{var t=je.getStreamFromFD(e);return ke.close(t),0}catch(e){return void 0!==ke&&e instanceof ke.ErrnoError||Pe(e),e.errno}}function Es(e,t,s,i){if(w)return ds(9,1,e,t,s,i);try{var r=je.getStreamFromFD(e),o=je.doReadv(r,t,s);return n()[i>>>2]=o,0}catch(e){return void 0!==ke&&e instanceof ke.ErrnoError||Pe(e),e.errno}}function Fs(e,t,s,i,r){if(w)return ds(10,1,e,t,s,i,r);try{var o=je.getStreamFromFD(e),a=4294967296*s+(t>>>0),h=9007199254740992;return a<=-h||a>=h?-61:(ke.llseek(o,a,i),_e=[o.position>>>0,(ge=o.position,+Math.abs(ge)>=1?ge>0?(0|Math.min(+Math.floor(ge/4294967296),4294967295))>>>0:~~+Math.ceil((ge-+(~~ge>>>0))/4294967296)>>>0:0)],n()[r>>>2]=_e[0],n()[r+4>>>2]=_e[1],o.getdents&&0===a&&0===i&&(o.getdents=null),0)}catch(e){return void 0!==ke&&e instanceof ke.ErrnoError||Pe(e),e.errno}}function Rs(e,t,s,i){if(w)return ds(11,1,e,t,s,i);try{var r=je.getStreamFromFD(e),o=je.doWritev(r,t,s);return n()[i>>>2]=o,0}catch(e){return void 0!==ke&&e instanceof ke.ErrnoError||Pe(e),e.errno}}function Ss(e){if(w)throw"Internal Error! spawnThread() can only ever be called from main application thread!";var t=Ee.getNewWorker();if(!t)return 6;if(void 0!==t.pthread)throw"Internal error!";if(!e.pthread_ptr)throw"Internal error, no pthread ptr!";Ee.runningWorkers.push(t);for(var s=Ys(512),i=0;i<128;++i)n()[s+4*i>>>2]=0;var r=e.stackBase+e.stackSize,o=Ee.pthreads[e.pthread_ptr]={worker:t,stackBase:e.stackBase,stackSize:e.stackSize,allocatedOwnStack:e.allocatedOwnStack,threadInfoStruct:e.pthread_ptr},h=o.threadInfoStruct>>2;Atomics.store(a(),h+16,e.detached),Atomics.store(a(),h+25,s),Atomics.store(a(),h+10,o.threadInfoStruct),Atomics.store(a(),h+20,e.stackSize),Atomics.store(a(),h+19,r),Atomics.store(a(),h+26,e.stackSize),Atomics.store(a(),h+28,r),Atomics.store(a(),h+29,e.detached);var l=ii()+40;Atomics.store(a(),h+43,l),t.pthread=o;var u={cmd:"run",start_routine:e.startRoutine,arg:e.arg,threadInfoStruct:e.pthread_ptr,stackBase:e.stackBase,stackSize:e.stackSize};return t.runPthread=function(){u.time=performance.now(),t.postMessage(u,e.transferList)},t.loaded&&(t.runPthread(),delete t.runPthread),0}function Os(e){return e%4==0&&(e%100!=0||e%400==0)}function Bs(e,t){for(var s=0,i=0;i<=t;s+=e[i++]);return s}var Ls=[31,29,31,30,31,30,31,31,30,31,30,31],Ns=[31,28,31,30,31,30,31,31,30,31,30,31];function ks(e,t){for(var s=new Date(e.getTime());t>0;){var i=Os(s.getFullYear()),r=s.getMonth(),o=(i?Ls:Ns)[r];if(!(t>o-s.getDate()))return s.setDate(s.getDate()+t),s;t-=o-s.getDate()+1,s.setDate(1),r<11?s.setMonth(r+1):(s.setMonth(0),s.setFullYear(s.getFullYear()+1))}return s}function js(e,s,i,r){var o=n()[r+40>>>2],a={tm_sec:n()[r>>>2],tm_min:n()[r+4>>>2],tm_hour:n()[r+8>>>2],tm_mday:n()[r+12>>>2],tm_mon:n()[r+16>>>2],tm_year:n()[r+20>>>2],tm_wday:n()[r+24>>>2],tm_yday:n()[r+28>>>2],tm_isdst:n()[r+32>>>2],tm_gmtoff:n()[r+36>>>2],tm_zone:o?G(o):""},h=G(i),l={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var u in l)h=h.replace(new RegExp(u,"g"),l[u]);var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],p=["January","February","March","April","May","June","July","August","September","October","November","December"];function d(e,t,s){for(var i="number"==typeof e?e.toString():e||"";i.length<t;)i=s[0]+i;return i}function m(e,t){return d(e,t,"0")}function f(e,t){function s(e){return e<0?-1:e>0?1:0}var i;return 0===(i=s(e.getFullYear()-t.getFullYear()))&&0===(i=s(e.getMonth()-t.getMonth()))&&(i=s(e.getDate()-t.getDate())),i}function g(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function _(e){var t=ks(new Date(e.tm_year+1900,0,1),e.tm_yday),s=new Date(t.getFullYear(),0,4),i=new Date(t.getFullYear()+1,0,4),r=g(s),o=g(i);return f(r,t)<=0?f(o,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var y={"%a":function(e){return c[e.tm_wday].substring(0,3)},"%A":function(e){return c[e.tm_wday]},"%b":function(e){return p[e.tm_mon].substring(0,3)},"%B":function(e){return p[e.tm_mon]},"%C":function(e){return m((e.tm_year+1900)/100|0,2)},"%d":function(e){return m(e.tm_mday,2)},"%e":function(e){return d(e.tm_mday,2," ")},"%g":function(e){return _(e).toString().substring(2)},"%G":function(e){return _(e)},"%H":function(e){return m(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),m(t,2)},"%j":function(e){return m(e.tm_mday+Bs(Os(e.tm_year+1900)?Ls:Ns,e.tm_mon-1),3)},"%m":function(e){return m(e.tm_mon+1,2)},"%M":function(e){return m(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return m(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=new Date(e.tm_year+1900,0,1),s=0===t.getDay()?t:ks(t,7-t.getDay()),i=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(f(s,i)<0){var r=Bs(Os(i.getFullYear())?Ls:Ns,i.getMonth()-1)-31,o=31-s.getDate()+r+i.getDate();return m(Math.ceil(o/7),2)}return 0===f(s,t)?"01":"00"},"%V":function(e){var t,s=new Date(e.tm_year+1900,0,4),i=new Date(e.tm_year+1901,0,4),r=g(s),o=g(i),n=ks(new Date(e.tm_year+1900,0,1),e.tm_yday);return f(n,r)<0?"53":f(o,n)<=0?"01":(t=r.getFullYear()<e.tm_year+1900?e.tm_yday+32-r.getDate():e.tm_yday+1-r.getDate(),m(Math.ceil(t/7),2))},"%w":function(e){return e.tm_wday},"%W":function(e){var t=new Date(e.tm_year,0,1),s=1===t.getDay()?t:ks(t,0===t.getDay()?1:7-t.getDay()+1),i=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(f(s,i)<0){var r=Bs(Os(i.getFullYear())?Ls:Ns,i.getMonth()-1)-31,o=31-s.getDate()+r+i.getDate();return m(Math.ceil(o/7),2)}return 0===f(s,t)?"01":"00"},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,s=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(s?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var u in y)h.includes(u)&&(h=h.replace(new RegExp(u,"g"),y[u](a)));var v,b,x=Ws(h,!1);return x.length>s?0:(v=x,b=e,t().set(v,b>>>0),x.length-1)}w||Ee.initMainThreadBlock();var Gs,Hs=function(e,t,s,i){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=ke.nextInode++,this.name=t,this.mode=s,this.node_ops={},this.stream_ops={},this.rdev=i},Vs=365,Us=146;Object.defineProperties(Hs.prototype,{read:{get:function(){return(this.mode&Vs)===Vs},set:function(e){e?this.mode|=Vs:this.mode&=-366}},write:{get:function(){return(this.mode&Us)===Us},set:function(e){e?this.mode|=Us:this.mode&=-147}},isFolder:{get:function(){return ke.isDir(this.mode)}},isDevice:{get:function(){return ke.isChrdev(this.mode)}}}),ke.FSNode=Hs,ke.staticInit(),c.FS_createPath=ke.createPath,c.FS_createDataFile=ke.createDataFile,c.FS_createPreloadedFile=ke.createPreloadedFile,c.FS_createLazyFile=ke.createLazyFile,c.FS_createDevice=ke.createDevice,c.FS_unlink=ke.unlink,qe=c.InternalError=Qe(Error,"InternalError"),function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);it=e}(),ot=c.BindingError=Qe(Error,"BindingError"),Pt.prototype.isAliasOf=ht,Pt.prototype.clone=ft,Pt.prototype.delete=gt,Pt.prototype.isDeleted=_t,Pt.prototype.deleteLater=xt,Vt.prototype.getPointee=Ft,Vt.prototype.destructor=Rt,Vt.prototype.argPackAdvance=8,Vt.prototype.readValueFromPointer=We,Vt.prototype.deleteObject=St,Vt.prototype.fromWireType=Ht,c.getInheritedInstanceCount=Bt,c.getLiveInheritedInstances=Lt,c.flushPendingDeletes=bt,c.setDelayFunction=Nt,Xt=c.UnboundTypeError=Qe(Error,"UnboundTypeError"),c.count_emval_handles=es,c.get_first_emval=ts;var zs=[null,function(e,t){if(w)return ds(1,1,e,t)},Ge,He,Ve,Ps,Cs,Ds,As,Es,Fs,Rs];function Ws(e,t,s){var i=s>0?s:U(e)+1,r=new Array(i),o=H(e,r,0,r.length);return t&&(r.length=o),r}var Xs={l:function(e,t,s,i){Pe("Assertion failed: "+G(e)+", at: "+[t?G(t):"unknown filename",s,i?G(i):"unknown function"])},B:function(e){return Ys(e+16)+16},ka:function(e,t){Ee.threadExitHandlers.push((function(){ae.get(e)(t)}))},A:function(e,t,s){throw new Re(e).init(t,s),e},D:Ge,V:He,W:Ve,ma:function(e){var t=Ue[e];delete Ue[e];var s=t.elements,i=s.length,r=s.map((function(e){return e.getterReturnType})).concat(s.map((function(e){return e.setterArgumentType}))),o=t.rawConstructor,n=t.rawDestructor;et([e],r,(function(e){return s.forEach((function(t,s){var r=e[s],o=t.getter,n=t.getterContext,a=e[s+i],h=t.setter,l=t.setterContext;t.read=function(e){return r.fromWireType(o(n,e))},t.write=function(e,t){var s=[];h(l,e,a.toWireType(s,t)),ze(s)}})),[{name:t.name,fromWireType:function(e){for(var t=new Array(i),r=0;r<i;++r)t[r]=s[r].read(e);return n(e),t},toWireType:function(e,r){if(i!==r.length)throw new TypeError("Incorrect number of tuple elements for "+t.name+": expected="+i+", actual="+r.length);for(var a=o(),h=0;h<i;++h)s[h].write(a,r[h]);return null!==e&&e.push(n,a),a},argPackAdvance:8,readValueFromPointer:We,destructorFunction:n}]}))},s:function(e){var t=tt[e];delete tt[e];var s=t.rawConstructor,i=t.rawDestructor,r=t.fields;et([e],r.map((function(e){return e.getterReturnType})).concat(r.map((function(e){return e.setterArgumentType}))),(function(e){var o={};return r.forEach((function(t,s){var i=t.fieldName,n=e[s],a=t.getter,h=t.getterContext,l=e[s+r.length],u=t.setter,c=t.setterContext;o[i]={read:function(e){return n.fromWireType(a(h,e))},write:function(e,t){var s=[];u(c,e,l.toWireType(s,t)),ze(s)}}})),[{name:t.name,fromWireType:function(e){var t={};for(var s in o)t[s]=o[s].read(e);return i(e),t},toWireType:function(e,t){for(var r in o)if(!(r in t))throw new TypeError('Missing field:  "'+r+'"');var n=s();for(r in o)o[r].write(n,t[r]);return null!==e&&e.push(i,n),n},argPackAdvance:8,readValueFromPointer:We,destructorFunction:i}]}))},O:function(e,t,s,i,r){},ia:function(e,s,i,o,a){var h=st(i);at(e,{name:s=rt(s),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?o:a},argPackAdvance:8,readValueFromPointer:function(e){var o;if(1===i)o=t();else if(2===i)o=r();else{if(4!==i)throw new TypeError("Unknown boolean type size: "+s);o=n()}return this.fromWireType(o[e>>>h])},destructorFunction:null})},v:function(e,t,s,i,r,o,n,a,h,l,u,c,p){u=rt(u),o=Wt(r,o),a&&(a=Wt(n,a)),l&&(l=Wt(h,l)),p=Wt(c,p);var d=Je(u);Mt(d,(function(){Kt("Cannot construct "+u+" due to unbound types",[i])})),et([e,t,s],i?[i]:[],(function(t){var s,r;t=t[0],r=i?(s=t.registeredClass).instancePrototype:Pt.prototype;var n=Ze(d,(function(){if(Object.getPrototypeOf(this)!==h)throw new ot("Use 'new' to construct "+u);if(void 0===c.constructor_body)throw new ot(u+" has no accessible constructor");var e=c.constructor_body[arguments.length];if(void 0===e)throw new ot("Tried to invoke ctor of "+u+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(c.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),h=Object.create(r,{constructor:{value:n}});n.prototype=h;var c=new It(u,n,h,p,s,o,a,l),m=new Vt(u,c,!0,!1,!1),f=new Vt(u+"*",c,!1,!1,!1),g=new Vt(u+" const*",c,!1,!0,!1);return Tt[e]={pointerType:f,constPointerType:g},Ut(d,n),[m,f,g]}))},u:function(e,t,s,i,r,o){L(t>0);var n=Jt(t,s);r=Wt(i,r);var a=[o],h=[];et([],[e],(function(e){var s="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new ot("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=function(){Kt("Cannot construct "+e.name+" due to unbound types",n)},et([],n,(function(i){return e.registeredClass.constructor_body[t-1]=function(){arguments.length!==t-1&&nt(s+" called with "+arguments.length+" arguments, expected "+(t-1)),h.length=0,a.length=t;for(var e=1;e<t;++e)a[e]=i[e].toWireType(h,arguments[e-1]);var o=r.apply(null,a);return ze(h),i[0].fromWireType(o)},[]})),[]}))},c:function(e,t,s,i,r,o,n,a){var h=Jt(s,i);t=rt(t),o=Wt(r,o),et([],[e],(function(e){var i=(e=e[0]).name+"."+t;function r(){Kt("Cannot call "+i+" due to unbound types",h)}t.startsWith("@@")&&(t=Symbol[t.substring(2)]),a&&e.registeredClass.pureVirtualFunctions.push(t);var l=e.registeredClass.instancePrototype,u=l[t];return void 0===u||void 0===u.overloadTable&&u.className!==e.name&&u.argCount===s-2?(r.argCount=s-2,r.className=e.name,l[t]=r):(wt(l,t,i),l[t].overloadTable[s-2]=r),et([],h,(function(r){var a=Zt(i,r,e,o,n);return void 0===l[t].overloadTable?(a.argCount=s-2,l[t]=a):l[t].overloadTable[s-2]=a,[]})),[]}))},ha:function(e,t){at(e,{name:t=rt(t),fromWireType:function(e){var t=qt[e].value;return $t(e),t},toWireType:function(e,t){return ss(t)},argPackAdvance:8,readValueFromPointer:We,destructorFunction:null})},la:function(e,t,s,i){var r=st(s);function o(){}t=rt(t),o.values={},at(e,{name:t,constructor:o,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:is(t,r,i),destructorFunction:null}),Mt(t,o)},y:function(e,t,s){var i=rs(e,"enum");t=rt(t);var r=i.constructor,o=Object.create(i.constructor.prototype,{value:{value:s},constructor:{value:Ze(i.name+"_"+t,(function(){}))}});r.values[s]=o,r[t]=o},J:function(e,t,s){var i=st(s);at(e,{name:t=rt(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+os(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:ns(t,i),destructorFunction:null})},f:function(e,t,s,i,r,o){var n=Jt(t,s);e=rt(e),r=Wt(i,r),Mt(e,(function(){Kt("Cannot call "+e+" due to unbound types",n)}),t-1),et([],n,(function(s){var i=[s[0],null].concat(s.slice(1));return Ut(e,Zt(e,i,null,r,o),t-1),[]}))},p:function(e,t,s,i,r){t=rt(t),-1===r&&(r=4294967295);var o=st(s),n=function(e){return e};if(0===i){var a=32-8*s;n=function(e){return e<<a>>>a}}var h=t.includes("unsigned");at(e,{name:t,fromWireType:n,toWireType:function(e,s){if("number"!=typeof s&&"boolean"!=typeof s)throw new TypeError('Cannot convert "'+os(s)+'" to '+this.name);if(s<i||s>r)throw new TypeError('Passing a number "'+os(s)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+i+", "+r+"]!");return h?s>>>0:0|s},argPackAdvance:8,readValueFromPointer:as(t,o,0!==i),destructorFunction:null})},k:function(e,t,s){var i=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function r(e){e>>=2;var t=a(),s=t[e>>>0],r=t[e+1>>>0];return new i(z,r,s)}at(e,{name:s=rt(s),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{ignoreDuplicateRegistrations:!0})},K:function(e,t){var s="std::string"===(t=rt(t));at(e,{name:t,fromWireType:function(e){var t,r=a()[e>>>2];if(s)for(var o=e+4,n=0;n<=r;++n){var h=e+4+n;if(n==r||0==i()[h>>>0]){var l=G(o,h-o);void 0===t?t=l:(t+=String.fromCharCode(0),t+=l),o=h+1}}else{var u=new Array(r);for(n=0;n<r;++n)u[n]=String.fromCharCode(i()[e+4+n>>>0]);t=u.join("")}return Ks(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;r||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||nt("Cannot pass non-string to std::string");var o=(s&&r?function(){return U(t)}:function(){return t.length})(),n=Ys(4+o+1);if(n>>>=0,a()[n>>>2]=o,s&&r)V(t,n+4,o+1);else if(r)for(var h=0;h<o;++h){var l=t.charCodeAt(h);l>255&&(Ks(n),nt("String has UTF-16 code units that do not fit in 8 bits")),i()[n+4+h>>>0]=l}else for(h=0;h<o;++h)i()[n+4+h>>>0]=t[h];return null!==e&&e.push(Ks,n),n},argPackAdvance:8,readValueFromPointer:We,destructorFunction:function(e){Ks(e)}})},z:function(e,t,s){var i,r,n,h,l;s=rt(s),2===t?(i=ee,r=te,h=se,n=function(){return o()},l=1):4===t&&(i=ie,r=re,h=oe,n=function(){return a()},l=2),at(e,{name:s,fromWireType:function(e){for(var s,r=a()[e>>>2],o=n(),h=e+4,u=0;u<=r;++u){var c=e+4+u*t;if(u==r||0==o[c>>>l]){var p=i(h,c-h);void 0===s?s=p:(s+=String.fromCharCode(0),s+=p),h=c+t}}return Ks(e),s},toWireType:function(e,i){"string"!=typeof i&&nt("Cannot pass non-string to C++ string type "+s);var o=h(i),n=Ys(4+o+t);return n>>>=0,a()[n>>>2]=o>>l,r(i,n+4,o+t),null!==e&&e.push(Ks,n),n},argPackAdvance:8,readValueFromPointer:We,destructorFunction:function(e){Ks(e)}})},na:function(e,t,s,i,r,o){Ue[e]={name:rt(t),rawConstructor:Wt(s,i),rawDestructor:Wt(r,o),elements:[]}},h:function(e,t,s,i,r,o,n,a,h){Ue[e].elements.push({getterReturnType:t,getter:Wt(s,i),getterContext:r,setterArgumentType:o,setter:Wt(n,a),setterContext:h})},t:function(e,t,s,i,r,o){tt[e]={name:rt(t),rawConstructor:Wt(s,i),rawDestructor:Wt(r,o),fields:[]}},e:function(e,t,s,i,r,o,n,a,h,l){tt[e].fields.push({fieldName:rt(t),getterReturnType:s,getter:Wt(i,r),getterContext:o,setterArgumentType:n,setter:Wt(a,h),setterContext:l})},ja:function(e,t){at(e,{isVoid:!0,name:t=rt(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},ea:function(e,t){if(e==t)postMessage({cmd:"processQueuedMainThreadWork"});else if(w)postMessage({targetThread:e,cmd:"processThreadQueue"});else{var s=Ee.pthreads[e],i=s&&s.worker;if(!i)return;i.postMessage({cmd:"processThreadQueue"})}return 1},n:function(e,t,s){e=hs(e),t=rs(t,"emval::as");var i=[],r=ss(i);return n()[s>>>2]=r,t.toWireType(i,e)},L:function(e,t,s,i){e=hs(e);for(var r=function(e,t){for(var s=new Array(e),i=0;i<e;++i)s[i]=rs(n()[(t>>2)+i>>>0],"parameter "+i);return s}(t,s),o=new Array(t),a=0;a<t;++a){var h=r[a];o[a]=h.readValueFromPointer(i),i+=h.argPackAdvance}return ss(e.apply(void 0,o))},b:$t,U:function(e){return 0===e?ss(cs()):(e=us(e),ss(cs()[e]))},o:function(e,t){return ss((e=hs(e))[t=hs(t)])},j:function(e){e>4&&(qt[e].refcount+=1)},ca:function(e,t){return(e=hs(e))instanceof(t=hs(t))},M:function(e){return"number"==typeof(e=hs(e))},C:function(){return ss([])},g:function(e){return ss(us(e))},w:function(){return ss({})},m:function(e){ze(qt[e].value),$t(e)},i:function(e,t,s){e=hs(e),t=hs(t),s=hs(s),e[t]=s},d:function(e,t){return ss((e=rs(e,"_emval_take_value")).readValueFromPointer(t))},I:function(){Pe()},T:function(e,t){var s;if(0===e)s=Date.now();else{if(1!==e&&4!==e)return Fe(28),-1;s=Ae()}return n()[t>>>2]=s/1e3|0,n()[t+4>>>2]=s%1e3*1e3*1e3|0,0},G:function(e,t,s){var r=function(e,t){var s;for(ps.length=0,t>>=2;s=i()[e++>>>0];){var r=s<105;r&&1&t&&t++,ps.push(r?h()[t++>>>1]:n()[t>>>0]),++t}return ps}(t,s);return Ie[e].apply(null,r)},_:function(){T||P||F("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")},F:function(e,t){},r:function(e,s,i){if(e<=0||e>t().length||!0&e)return-28;if(x){if(Atomics.load(n(),e>>2)!=s)return-6;var r=performance.now(),o=r+i;for(Atomics.exchange(n(),mi>>2,e);;){if((r=performance.now())>o)return Atomics.exchange(n(),mi>>2,0),-73;if(0==Atomics.exchange(n(),mi>>2,0))break;if($s(),Atomics.load(n(),e>>2)!=s)return-6;Atomics.exchange(n(),mi>>2,e)}return 0}var a=Atomics.wait(n(),e>>2,s,i);if("timed-out"===a)return-73;if("not-equal"===a)return-6;if("ok"===a)return 0;throw"Atomics.wait returned an unexpected value "+a},q:De,x:Ae,R:function(e,t,s){i().copyWithin(e>>>0,t>>>0,t+s>>>0)},$:function(e,t,s){ms.length=t;for(var i=s>>3,r=0;r<t;r++)ms[r]=h()[i+r>>>0];return(e<0?Ie[-e-1]:zs[e]).apply(null,ms)},S:function(e){var t=i().length;if((e>>>=0)<=t)return!1;var s,r,o=4294901760;if(e>o)return!1;for(var n=1;n<=4;n*=2){var a=t*(1+.2/n);if(a=Math.min(a,e+100663296),fs(Math.min(o,((s=Math.max(e,a))%(r=65536)>0&&(s+=r-s%r),s))))return!0}return!1},aa:function(e,t,s){return bs(e)?xs(e,t,s):Ps(e,t,s)},E:function(e){},ba:function(e,t){return function(e,t){var s=t>>2,i=n()[s+6>>>0],r={alpha:!!n()[s+0>>>0],depth:!!n()[s+1>>>0],stencil:!!n()[s+2>>>0],antialias:!!n()[s+3>>>0],premultipliedAlpha:!!n()[s+4>>>0],preserveDrawingBuffer:!!n()[s+5>>>0],powerPreference:ws[i],failIfMajorPerformanceCaveat:!!n()[s+7>>>0],majorVersion:n()[s+8>>>0],minorVersion:n()[s+9>>>0],enableExtensionsByDefault:n()[s+10>>>0],explicitSwapControl:n()[s+11>>>0],proxyContextToMainThread:n()[s+12>>>0],renderViaOffscreenBackBuffer:n()[s+13>>>0]},o=bs(e);return o?r.explicitSwapControl?0:Ts.createContext(o,r):0}(e,t)},Y:Cs,Z:Ds,H:As,ga:Es,N:Fs,fa:Rs,Q:function(){Ee.initRuntime()},a:R||c.wasmMemory,da:function(e,t,s,i){if("undefined"==typeof SharedArrayBuffer)return E("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;if(!e)return E("pthread_create called with a null thread pointer!"),28;var r=[];if(w&&0===r.length)return qs(687865856,e,t,s,i);var o=0,h=0,l=0;t&&-1!=t?(o=n()[t>>>2],o+=81920,h=n()[t+8>>>2],l=0!==n()[t+12>>>2]):o=2097152;var u=0==h;u?h=ci(16,o):L((h-=o)>0);for(var c=Ys(228),p=0;p<57;++p)a()[(c>>2)+p>>>0]=0;n()[e>>>2]=c,n()[c+12>>>2]=c;var d=c+152;n()[d>>>2]=d;var m={stackBase:h,stackSize:o,allocatedOwnStack:u,detached:l,startRoutine:s,pthread_ptr:c,arg:i,transferList:r};return w?(m.cmd="spawnThread",postMessage(m,r),0):Ss(m)},P:function(e){},X:function(e,t,s,i){return js(e,t,s,i)}};!function(){var e={a:Xs};function t(e,t){var s,i=e.exports;if(c.asm=i,ae=c.asm.ta,s=c.asm.oa,ue.unshift(s),Ee.tlsInitFunctions.push(c.asm.sa),S=t,!w){var r=Ee.unusedWorkers.length;Ee.unusedWorkers.forEach((function(e){Ee.loadWasmModuleToWorker(e,(function(){--r||xe()}))}))}}function s(e){t(e.instance,e.module)}function i(t){return function(){if(!D&&(x||P)){if("function"==typeof fetch&&!we(fe))return fetch(fe,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+fe+"'";return e.arrayBuffer()})).catch((function(){return Me(fe)}));if(f)return new Promise((function(e,t){f(fe,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return Me(fe)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){E("failed to asynchronously prepare wasm: "+e),Pe(e)}))}if(w||be(),c.instantiateWasm)try{return c.instantiateWasm(e,t)}catch(e){return E("Module.instantiateWasm callback failed with error: "+e),!1}(D||"function"!=typeof WebAssembly.instantiateStreaming||Te(fe)||we(fe)||"function"!=typeof fetch?i(s):fetch(fe,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(s,(function(e){return E("wasm streaming compile failed: "+e),E("falling back to ArrayBuffer instantiation"),i(s)}))}))).catch(u)}(),c.___wasm_call_ctors=function(){return(c.___wasm_call_ctors=c.asm.oa).apply(null,arguments)},c._main=function(){return(c._main=c.asm.pa).apply(null,arguments)};var Ys=c._malloc=function(){return(Ys=c._malloc=c.asm.qa).apply(null,arguments)},Ks=c._free=function(){return(Ks=c._free=c.asm.ra).apply(null,arguments)};c._emscripten_tls_init=function(){return(c._emscripten_tls_init=c.asm.sa).apply(null,arguments)};var Js=c.___getTypeName=function(){return(Js=c.___getTypeName=c.asm.ua).apply(null,arguments)};c.___embind_register_native_and_builtin_types=function(){return(c.___embind_register_native_and_builtin_types=c.asm.va).apply(null,arguments)},c._emscripten_current_thread_process_queued_calls=function(){return(c._emscripten_current_thread_process_queued_calls=c.asm.wa).apply(null,arguments)};var Zs=c._emscripten_register_main_browser_thread_id=function(){return(Zs=c._emscripten_register_main_browser_thread_id=c.asm.xa).apply(null,arguments)},Qs=c.__emscripten_do_dispatch_to_thread=function(){return(Qs=c.__emscripten_do_dispatch_to_thread=c.asm.ya).apply(null,arguments)},qs=c._emscripten_sync_run_in_main_thread_4=function(){return(qs=c._emscripten_sync_run_in_main_thread_4=c.asm.za).apply(null,arguments)},$s=c._emscripten_main_thread_process_queued_calls=function(){return($s=c._emscripten_main_thread_process_queued_calls=c.asm.Aa).apply(null,arguments)},ei=c._emscripten_run_in_main_runtime_thread_js=function(){return(ei=c._emscripten_run_in_main_runtime_thread_js=c.asm.Ba).apply(null,arguments)},ti=c.__emscripten_call_on_thread=function(){return(ti=c.__emscripten_call_on_thread=c.asm.Ca).apply(null,arguments)},si=c.__emscripten_thread_init=function(){return(si=c.__emscripten_thread_init=c.asm.Da).apply(null,arguments)},ii=c._emscripten_get_global_libc=function(){return(ii=c._emscripten_get_global_libc=c.asm.Ea).apply(null,arguments)},ri=c.___errno_location=function(){return(ri=c.___errno_location=c.asm.Fa).apply(null,arguments)},oi=c._pthread_self=function(){return(oi=c._pthread_self=c.asm.Ga).apply(null,arguments)},ni=c.___pthread_tsd_run_dtors=function(){return(ni=c.___pthread_tsd_run_dtors=c.asm.Ha).apply(null,arguments)},ai=c.stackSave=function(){return(ai=c.stackSave=c.asm.Ia).apply(null,arguments)},hi=c.stackRestore=function(){return(hi=c.stackRestore=c.asm.Ja).apply(null,arguments)},li=c.stackAlloc=function(){return(li=c.stackAlloc=c.asm.Ka).apply(null,arguments)},ui=c._emscripten_stack_set_limits=function(){return(ui=c._emscripten_stack_set_limits=c.asm.La).apply(null,arguments)},ci=c._memalign=function(){return(ci=c._memalign=c.asm.Ma).apply(null,arguments)};c.dynCall_jiji=function(){return(c.dynCall_jiji=c.asm.Na).apply(null,arguments)},c.dynCall_viijii=function(){return(c.dynCall_viijii=c.asm.Oa).apply(null,arguments)},c.dynCall_iiiiij=function(){return(c.dynCall_iiiiij=c.asm.Pa).apply(null,arguments)},c.dynCall_iiiiijj=function(){return(c.dynCall_iiiiijj=c.asm.Qa).apply(null,arguments)},c.dynCall_iiiiiijj=function(){return(c.dynCall_iiiiiijj=c.asm.Ra).apply(null,arguments)};var pi,di=c.__emscripten_allow_main_runtime_queued_calls=44840,mi=c.__emscripten_main_thread_futex=48292;function fi(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function gi(e){if(!(ye>0)){if(w)return l(c),me(),void postMessage({cmd:"loaded"});!function(){if(!w){if(c.preRun)for("function"==typeof c.preRun&&(c.preRun=[c.preRun]);c.preRun.length;)e=c.preRun.shift(),le.unshift(e);var e;Ce(le)}}(),ye>0||(c.setStatus?(c.setStatus("Running..."),setTimeout((function(){setTimeout((function(){c.setStatus("")}),1),t()}),1)):t())}function t(){pi||(pi=!0,c.calledRun=!0,B||(me(),w||Ce(ce),l(c),c.onRuntimeInitialized&&c.onRuntimeInitialized(),yi&&function(e){var t=c._main;try{_i(t(0,0),!0)}catch(e){if(e instanceof fi||"unwind"==e)return;var s=e;e&&"object"==typeof e&&e.stack&&(s=[e,e.stack]),E("exception thrown: "+s),b(1,e)}}(),function(){if(!w){if(c.postRun)for("function"==typeof c.postRun&&(c.postRun=[c.postRun]);c.postRun.length;)e=c.postRun.shift(),pe.unshift(e);var e;Ce(pe)}}()))}}function _i(e,t){if(!t&&w)throw postMessage({cmd:"exitProcess",returnCode:e}),new fi(e);de()||(Ee.terminateAllThreads(),c.onExit&&c.onExit(e),B=!0),b(e,new fi(e))}if(c.addRunDependency=be,c.removeRunDependency=xe,c.FS_createPath=ke.createPath,c.FS_createDataFile=ke.createDataFile,c.FS_createPreloadedFile=ke.createPreloadedFile,c.FS_createLazyFile=ke.createLazyFile,c.FS_createDevice=ke.createDevice,c.FS_unlink=ke.unlink,c.keepRuntimeAlive=de,c.FS=ke,c.PThread=Ee,c.PThread=Ee,c.wasmMemory=R,c.ExitStatus=fi,ve=function e(){pi||gi(),pi||(ve=e)},c.run=gi,c.preInit)for("function"==typeof c.preInit&&(c.preInit=[c.preInit]);c.preInit.length>0;)c.preInit.pop()();var yi=!0;return c.noInitialRun&&(yi=!1),w&&(O=!1,Ee.initWorker()),gi(),e.ready});"object"==typeof e&&"object"==typeof t?t.exports=i:"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof e&&(e.WebIFCWasm=i)}}),tb=Qv({"dist/web-ifc.js"(e,t){var s,i=(s="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(s=s||__filename),function(e){var t,i,r=void 0!==(e=e||{})?e:{};r.ready=new Promise((function(e,s){t=e,i=s}));var o,n={};for(o in r)r.hasOwnProperty(o)&&(n[o]=r[o]);var a,h,l,u,c,p="./this.program",d=function(e,t){throw t},m="object"==typeof window,f="function"==typeof importScripts,g="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,_="";g?(_=f?Zv("path").dirname(_)+"/":__dirname+"/",a=function(e,t){return u||(u=Zv("fs")),c||(c=Zv("path")),e=c.normalize(e),u.readFileSync(e,t?null:"utf8")},l=function(e){var t=a(e,!0);return t.buffer||(t=new Uint8Array(t)),w(t.buffer),t},h=function(e,t,s){u||(u=Zv("fs")),c||(c=Zv("path")),e=c.normalize(e),u.readFile(e,(function(e,i){e?s(e):t(i.buffer)}))},process.argv.length>1&&(p=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof us))throw e})),process.on("unhandledRejection",he),d=function(e,t){if($())throw process.exitCode=e,t;process.exit(e)},r.inspect=function(){return"[Emscripten Module object]"}):(m||f)&&(f?_=self.location.href:"undefined"!=typeof document&&document.currentScript&&(_=document.currentScript.src),s&&(_=s),_=0!==_.indexOf("blob:")?_.substr(0,_.lastIndexOf("/")+1):"",a=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},f&&(l=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),h=function(e,t,s){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){200==i.status||0==i.status&&i.response?t(i.response):s()},i.onerror=s,i.send(null)});var y,v=r.print||console.log.bind(console),b=r.printErr||console.warn.bind(console);for(o in n)n.hasOwnProperty(o)&&(r[o]=n[o]);n=null,r.arguments,r.thisProgram&&(p=r.thisProgram),r.quit&&(d=r.quit),r.wasmBinary&&(y=r.wasmBinary);var x,P=r.noExitRuntime||!0;"object"!=typeof WebAssembly&&he("no native wasm support detected");var T=!1;function w(e,t){e||he("Assertion failed: "+t)}var M="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function I(e,t,s){for(var i=(t>>>=0)+s,r=t;e[r>>>0]&&!(r>=i);)++r;if(r-t>16&&e.subarray&&M)return M.decode(e.subarray(t>>>0,r>>>0));for(var o="";t<r;){var n=e[t++>>>0];if(128&n){var a=63&e[t++>>>0];if(192!=(224&n)){var h=63&e[t++>>>0];if((n=224==(240&n)?(15&n)<<12|a<<6|h:(7&n)<<18|a<<12|h<<6|63&e[t++>>>0])<65536)o+=String.fromCharCode(n);else{var l=n-65536;o+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else o+=String.fromCharCode((31&n)<<6|a)}else o+=String.fromCharCode(n)}return o}function C(e,t){return(e>>>=0)?I(S,e,t):""}function D(e,t,s,i){if(!(i>0))return 0;for(var r=s>>>=0,o=s+i-1,n=0;n<e.length;++n){var a=e.charCodeAt(n);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&e.charCodeAt(++n)),a<=127){if(s>=o)break;t[s++>>>0]=a}else if(a<=2047){if(s+1>=o)break;t[s++>>>0]=192|a>>6,t[s++>>>0]=128|63&a}else if(a<=65535){if(s+2>=o)break;t[s++>>>0]=224|a>>12,t[s++>>>0]=128|a>>6&63,t[s++>>>0]=128|63&a}else{if(s+3>=o)break;t[s++>>>0]=240|a>>18,t[s++>>>0]=128|a>>12&63,t[s++>>>0]=128|a>>6&63,t[s++>>>0]=128|63&a}}return t[s>>>0]=0,s-r}function A(e,t,s){return D(e,S,t,s)}function E(e){for(var t=0,s=0;s<e.length;++s){var i=e.charCodeAt(s);i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++s)),i<=127?++t:t+=i<=2047?2:i<=65535?3:4}return t}var F,R,S,O,B,L,N,k,j,G,H="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function V(e,t){for(var s=e,i=s>>1,r=i+t/2;!(i>=r)&&B[i>>>0];)++i;if((s=i<<1)-e>32&&H)return H.decode(S.subarray(e>>>0,s>>>0));for(var o="",n=0;!(n>=t/2);++n){var a=O[e+2*n>>>1];if(0==a)break;o+=String.fromCharCode(a)}return o}function U(e,t,s){if(void 0===s&&(s=2147483647),s<2)return 0;for(var i=t,r=(s-=2)<2*e.length?s/2:e.length,o=0;o<r;++o){var n=e.charCodeAt(o);O[t>>>1]=n,t+=2}return O[t>>>1]=0,t-i}function z(e){return 2*e.length}function W(e,t){for(var s=0,i="";!(s>=t/4);){var r=L[e+4*s>>>2];if(0==r)break;if(++s,r>=65536){var o=r-65536;i+=String.fromCharCode(55296|o>>10,56320|1023&o)}else i+=String.fromCharCode(r)}return i}function X(e,t,s){if(void 0===s&&(s=2147483647),s<4)return 0;for(var i=t>>>=0,r=i+s-4,o=0;o<e.length;++o){var n=e.charCodeAt(o);if(n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&e.charCodeAt(++o)),L[t>>>2]=n,(t+=4)+4>r)break}return L[t>>>2]=0,t-i}function Y(e){for(var t=0,s=0;s<e.length;++s){var i=e.charCodeAt(s);i>=55296&&i<=57343&&++s,t+=4}return t}function K(e){F=e,r.HEAP8=R=new Int8Array(e),r.HEAP16=O=new Int16Array(e),r.HEAP32=L=new Int32Array(e),r.HEAPU8=S=new Uint8Array(e),r.HEAPU16=B=new Uint16Array(e),r.HEAPU32=N=new Uint32Array(e),r.HEAPF32=k=new Float32Array(e),r.HEAPF64=j=new Float64Array(e)}r.INITIAL_MEMORY;var J=[],Z=[],Q=[],q=[];function $(){return P||!1}var ee,te,se,ie,re=0,oe=null;function ne(e){re++,r.monitorRunDependencies&&r.monitorRunDependencies(re)}function ae(e){if(re--,r.monitorRunDependencies&&r.monitorRunDependencies(re),0==re&&oe){var t=oe;oe=null,t()}}function he(e){r.onAbort&&r.onAbort(e),b(e+=""),T=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw i(t),t}function le(e){return e.startsWith("data:application/octet-stream;base64,")}function ue(e){return e.startsWith("file://")}function ce(e){try{if(e==ee&&y)return new Uint8Array(y);if(l)return l(e);throw"both async and sync fetching of the wasm failed"}catch(e){he(e)}}function pe(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var s=t.func;"number"==typeof s?void 0===t.arg?G.get(s)():G.get(s)(t.arg):s(void 0===t.arg?null:t.arg)}else t(r)}}function de(e){this.excPtr=e,this.ptr=e-16,this.set_type=function(e){L[this.ptr+4>>>2]=e},this.get_type=function(){return L[this.ptr+4>>>2]},this.set_destructor=function(e){L[this.ptr+8>>>2]=e},this.get_destructor=function(){return L[this.ptr+8>>>2]},this.set_refcount=function(e){L[this.ptr>>>2]=e},this.set_caught=function(e){e=e?1:0,R[this.ptr+12>>>0]=e},this.get_caught=function(){return 0!=R[this.ptr+12>>>0]},this.set_rethrown=function(e){e=e?1:0,R[this.ptr+13>>>0]=e},this.get_rethrown=function(){return 0!=R[this.ptr+13>>>0]},this.init=function(e,t){this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=L[this.ptr>>>2];L[this.ptr>>>2]=e+1},this.release_ref=function(){var e=L[this.ptr>>>2];return L[this.ptr>>>2]=e-1,1===e}}function me(e){return L[ls()>>>2]=e,e}r.preloadedImages={},r.preloadedAudios={},le(ee="web-ifc.wasm")||(te=ee,ee=r.locateFile?r.locateFile(te,_):_+te);var fe={splitPath:function(e){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1)},normalizeArray:function(e,t){for(var s=0,i=e.length-1;i>=0;i--){var r=e[i];"."===r?e.splice(i,1):".."===r?(e.splice(i,1),s++):s&&(e.splice(i,1),s--)}if(t)for(;s;s--)e.unshift("..");return e},normalize:function(e){var t="/"===e.charAt(0),s="/"===e.substr(-1);return e=fe.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"),e||t||(e="."),e&&s&&(e+="/"),(t?"/":"")+e},dirname:function(e){var t=fe.splitPath(e),s=t[0],i=t[1];return s||i?(i&&(i=i.substr(0,i.length-1)),s+i):"."},basename:function(e){if("/"===e)return"/";var t=(e=(e=fe.normalize(e)).replace(/\/$/,"")).lastIndexOf("/");return-1===t?e:e.substr(t+1)},extname:function(e){return fe.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return fe.normalize(e.join("/"))},join2:function(e,t){return fe.normalize(e+"/"+t)}},ge={resolve:function(){for(var e="",t=!1,s=arguments.length-1;s>=-1&&!t;s--){var i=s>=0?arguments[s]:ve.cwd();if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");if(!i)return"";e=i+"/"+e,t="/"===i.charAt(0)}return e=fe.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"),(t?"/":"")+e||"."},relative:function(e,t){function s(e){for(var t=0;t<e.length&&""===e[t];t++);for(var s=e.length-1;s>=0&&""===e[s];s--);return t>s?[]:e.slice(t,s-t+1)}e=ge.resolve(e).substr(1),t=ge.resolve(t).substr(1);for(var i=s(e.split("/")),r=s(t.split("/")),o=Math.min(i.length,r.length),n=o,a=0;a<o;a++)if(i[a]!==r[a]){n=a;break}var h=[];for(a=n;a<i.length;a++)h.push("..");return(h=h.concat(r.slice(n))).join("/")}},_e={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){_e.ttys[e]={input:[],output:[],ops:t},ve.registerDevice(e,_e.stream_ops)},stream_ops:{open:function(e){var t=_e.ttys[e.node.rdev];if(!t)throw new ve.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.flush(e.tty)},flush:function(e){e.tty.ops.flush(e.tty)},read:function(e,t,s,i,r){if(!e.tty||!e.tty.ops.get_char)throw new ve.ErrnoError(60);for(var o=0,n=0;n<i;n++){var a;try{a=e.tty.ops.get_char(e.tty)}catch(e){throw new ve.ErrnoError(29)}if(void 0===a&&0===o)throw new ve.ErrnoError(6);if(null==a)break;o++,t[s+n]=a}return o&&(e.node.timestamp=Date.now()),o},write:function(e,t,s,i,r){if(!e.tty||!e.tty.ops.put_char)throw new ve.ErrnoError(60);try{for(var o=0;o<i;o++)e.tty.ops.put_char(e.tty,t[s+o])}catch(e){throw new ve.ErrnoError(29)}return i&&(e.node.timestamp=Date.now()),o}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if(g){var s=Buffer.alloc(256),i=0;try{i=u.readSync(process.stdin.fd,s,0,256,null)}catch(e){if(!e.toString().includes("EOF"))throw e;i=0}t=i>0?s.slice(0,i).toString("utf-8"):null}else"undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n");if(!t)return null;e.input=is(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(v(I(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(v(I(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(b(I(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(b(I(e.output,0)),e.output=[])}}},ye={ops_table:null,mount:function(e){return ye.createNode(null,"/",16895,0)},createNode:function(e,t,s,i){if(ve.isBlkdev(s)||ve.isFIFO(s))throw new ve.ErrnoError(63);ye.ops_table||(ye.ops_table={dir:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr,lookup:ye.node_ops.lookup,mknod:ye.node_ops.mknod,rename:ye.node_ops.rename,unlink:ye.node_ops.unlink,rmdir:ye.node_ops.rmdir,readdir:ye.node_ops.readdir,symlink:ye.node_ops.symlink},stream:{llseek:ye.stream_ops.llseek}},file:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr},stream:{llseek:ye.stream_ops.llseek,read:ye.stream_ops.read,write:ye.stream_ops.write,allocate:ye.stream_ops.allocate,mmap:ye.stream_ops.mmap,msync:ye.stream_ops.msync}},link:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr,readlink:ye.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr},stream:ve.chrdev_stream_ops}});var r=ve.createNode(e,t,s,i);return ve.isDir(r.mode)?(r.node_ops=ye.ops_table.dir.node,r.stream_ops=ye.ops_table.dir.stream,r.contents={}):ve.isFile(r.mode)?(r.node_ops=ye.ops_table.file.node,r.stream_ops=ye.ops_table.file.stream,r.usedBytes=0,r.contents=null):ve.isLink(r.mode)?(r.node_ops=ye.ops_table.link.node,r.stream_ops=ye.ops_table.link.stream):ve.isChrdev(r.mode)&&(r.node_ops=ye.ops_table.chrdev.node,r.stream_ops=ye.ops_table.chrdev.stream),r.timestamp=Date.now(),e&&(e.contents[t]=r,e.timestamp=r.timestamp),r},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){t>>>=0;var s=e.contents?e.contents.length:0;if(!(s>=t)){t=Math.max(t,s*(s<1048576?2:1.125)>>>0),0!=s&&(t=Math.max(t,256));var i=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(i.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(t>>>=0,e.usedBytes!=t)if(0==t)e.contents=null,e.usedBytes=0;else{var s=e.contents;e.contents=new Uint8Array(t),s&&e.contents.set(s.subarray(0,Math.min(t,e.usedBytes))),e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=ve.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,ve.isDir(e.mode)?t.size=4096:ve.isFile(e.mode)?t.size=e.usedBytes:ve.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&ye.resizeFileStorage(e,t.size)},lookup:function(e,t){throw ve.genericErrors[44]},mknod:function(e,t,s,i){return ye.createNode(e,t,s,i)},rename:function(e,t,s){if(ve.isDir(e.mode)){var i;try{i=ve.lookupNode(t,s)}catch(e){}if(i)for(var r in i.contents)throw new ve.ErrnoError(55)}delete e.parent.contents[e.name],e.parent.timestamp=Date.now(),e.name=s,t.contents[s]=e,t.timestamp=e.parent.timestamp,e.parent=t},unlink:function(e,t){delete e.contents[t],e.timestamp=Date.now()},rmdir:function(e,t){var s=ve.lookupNode(e,t);for(var i in s.contents)throw new ve.ErrnoError(55);delete e.contents[t],e.timestamp=Date.now()},readdir:function(e){var t=[".",".."];for(var s in e.contents)e.contents.hasOwnProperty(s)&&t.push(s);return t},symlink:function(e,t,s){var i=ye.createNode(e,t,41471,0);return i.link=s,i},readlink:function(e){if(!ve.isLink(e.mode))throw new ve.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,s,i,r){var o=e.node.contents;if(r>=e.node.usedBytes)return 0;var n=Math.min(e.node.usedBytes-r,i);if(n>8&&o.subarray)t.set(o.subarray(r,r+n),s);else for(var a=0;a<n;a++)t[s+a]=o[r+a];return n},write:function(e,t,s,i,r,o){if(t.buffer===R.buffer&&(o=!1),!i)return 0;var n=e.node;if(n.timestamp=Date.now(),t.subarray&&(!n.contents||n.contents.subarray)){if(o)return n.contents=t.subarray(s,s+i),n.usedBytes=i,i;if(0===n.usedBytes&&0===r)return n.contents=t.slice(s,s+i),n.usedBytes=i,i;if(r+i<=n.usedBytes)return n.contents.set(t.subarray(s,s+i),r),i}if(ye.expandFileStorage(n,r+i),n.contents.subarray&&t.subarray)n.contents.set(t.subarray(s,s+i),r);else for(var a=0;a<i;a++)n.contents[r+a]=t[s+a];return n.usedBytes=Math.max(n.usedBytes,r+i),i},llseek:function(e,t,s){var i=t;if(1===s?i+=e.position:2===s&&ve.isFile(e.node.mode)&&(i+=e.node.usedBytes),i<0)throw new ve.ErrnoError(28);return i},allocate:function(e,t,s){ye.expandFileStorage(e.node,t+s),e.node.usedBytes=Math.max(e.node.usedBytes,t+s)},mmap:function(e,t,s,i,r,o){if(0!==t)throw new ve.ErrnoError(28);if(!ve.isFile(e.node.mode))throw new ve.ErrnoError(43);var n,a,h=e.node.contents;if(2&o||h.buffer!==F){if((i>0||i+s<h.length)&&(h=h.subarray?h.subarray(i,i+s):Array.prototype.slice.call(h,i,i+s)),a=!0,!(n=void he()))throw new ve.ErrnoError(48);n>>>=0,R.set(h,n>>>0)}else a=!1,n=h.byteOffset;return{ptr:n,allocated:a}},msync:function(e,t,s,i,r){if(!ve.isFile(e.node.mode))throw new ve.ErrnoError(43);return 2&r||ye.stream_ops.write(e,t,0,i,s,!1),0}}},ve={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(e,t){if(t=t||{},!(e=ge.resolve(ve.cwd(),e)))return{path:"",node:null};var s={follow_mount:!0,recurse_count:0};for(var i in s)void 0===t[i]&&(t[i]=s[i]);if(t.recurse_count>8)throw new ve.ErrnoError(32);for(var r=fe.normalizeArray(e.split("/").filter((function(e){return!!e})),!1),o=ve.root,n="/",a=0;a<r.length;a++){var h=a===r.length-1;if(h&&t.parent)break;if(o=ve.lookupNode(o,r[a]),n=fe.join2(n,r[a]),ve.isMountpoint(o)&&(!h||h&&t.follow_mount)&&(o=o.mounted.root),!h||t.follow)for(var l=0;ve.isLink(o.mode);){var u=ve.readlink(n);if(n=ge.resolve(fe.dirname(n),u),o=ve.lookupPath(n,{recurse_count:t.recurse_count}).node,l++>40)throw new ve.ErrnoError(32)}}return{path:n,node:o}},getPath:function(e){for(var t;;){if(ve.isRoot(e)){var s=e.mount.mountpoint;return t?"/"!==s[s.length-1]?s+"/"+t:s+t:s}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:function(e,t){for(var s=0,i=0;i<t.length;i++)s=(s<<5)-s+t.charCodeAt(i)|0;return(e+s>>>0)%ve.nameTable.length},hashAddNode:function(e){var t=ve.hashName(e.parent.id,e.name);e.name_next=ve.nameTable[t],ve.nameTable[t]=e},hashRemoveNode:function(e){var t=ve.hashName(e.parent.id,e.name);if(ve.nameTable[t]===e)ve.nameTable[t]=e.name_next;else for(var s=ve.nameTable[t];s;){if(s.name_next===e){s.name_next=e.name_next;break}s=s.name_next}},lookupNode:function(e,t){var s=ve.mayLookup(e);if(s)throw new ve.ErrnoError(s,e);for(var i=ve.hashName(e.id,t),r=ve.nameTable[i];r;r=r.name_next){var o=r.name;if(r.parent.id===e.id&&o===t)return r}return ve.lookup(e,t)},createNode:function(e,t,s,i){var r=new ve.FSNode(e,t,s,i);return ve.hashAddNode(r),r},destroyNode:function(e){ve.hashRemoveNode(e)},isRoot:function(e){return e===e.parent},isMountpoint:function(e){return!!e.mounted},isFile:function(e){return 32768==(61440&e)},isDir:function(e){return 16384==(61440&e)},isLink:function(e){return 40960==(61440&e)},isChrdev:function(e){return 8192==(61440&e)},isBlkdev:function(e){return 24576==(61440&e)},isFIFO:function(e){return 4096==(61440&e)},isSocket:function(e){return 49152==(49152&e)},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(e){var t=ve.flagModes[e];if(void 0===t)throw new Error("Unknown file open mode: "+e);return t},flagsToPermissionString:function(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:function(e,t){return ve.ignorePermissions||(!t.includes("r")||292&e.mode)&&(!t.includes("w")||146&e.mode)&&(!t.includes("x")||73&e.mode)?0:2},mayLookup:function(e){var t=ve.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:function(e,t){try{return ve.lookupNode(e,t),20}catch(e){}return ve.nodePermissions(e,"wx")},mayDelete:function(e,t,s){var i;try{i=ve.lookupNode(e,t)}catch(e){return e.errno}var r=ve.nodePermissions(e,"wx");if(r)return r;if(s){if(!ve.isDir(i.mode))return 54;if(ve.isRoot(i)||ve.getPath(i)===ve.cwd())return 10}else if(ve.isDir(i.mode))return 31;return 0},mayOpen:function(e,t){return e?ve.isLink(e.mode)?32:ve.isDir(e.mode)&&("r"!==ve.flagsToPermissionString(t)||512&t)?31:ve.nodePermissions(e,ve.flagsToPermissionString(t)):44},MAX_OPEN_FDS:4096,nextfd:function(e,t){e=e||0,t=t||ve.MAX_OPEN_FDS;for(var s=e;s<=t;s++)if(!ve.streams[s])return s;throw new ve.ErrnoError(33)},getStream:function(e){return ve.streams[e]},createStream:function(e,t,s){ve.FSStream||(ve.FSStream=function(){},ve.FSStream.prototype={object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}});var i=new ve.FSStream;for(var r in e)i[r]=e[r];e=i;var o=ve.nextfd(t,s);return e.fd=o,ve.streams[o]=e,e},closeStream:function(e){ve.streams[e]=null},chrdev_stream_ops:{open:function(e){var t=ve.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:function(){throw new ve.ErrnoError(70)}},major:function(e){return e>>8},minor:function(e){return 255&e},makedev:function(e,t){return e<<8|t},registerDevice:function(e,t){ve.devices[e]={stream_ops:t}},getDevice:function(e){return ve.devices[e]},getMounts:function(e){for(var t=[],s=[e];s.length;){var i=s.pop();t.push(i),s.push.apply(s,i.mounts)}return t},syncfs:function(e,t){"function"==typeof e&&(t=e,e=!1),ve.syncFSRequests++,ve.syncFSRequests>1&&b("warning: "+ve.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var s=ve.getMounts(ve.root.mount),i=0;function r(e){return ve.syncFSRequests--,t(e)}function o(e){if(e)return o.errored?void 0:(o.errored=!0,r(e));++i>=s.length&&r(null)}s.forEach((function(t){if(!t.type.syncfs)return o(null);t.type.syncfs(t,e,o)}))},mount:function(e,t,s){var i,r="/"===s,o=!s;if(r&&ve.root)throw new ve.ErrnoError(10);if(!r&&!o){var n=ve.lookupPath(s,{follow_mount:!1});if(s=n.path,i=n.node,ve.isMountpoint(i))throw new ve.ErrnoError(10);if(!ve.isDir(i.mode))throw new ve.ErrnoError(54)}var a={type:e,opts:t,mountpoint:s,mounts:[]},h=e.mount(a);return h.mount=a,a.root=h,r?ve.root=h:i&&(i.mounted=a,i.mount&&i.mount.mounts.push(a)),h},unmount:function(e){var t=ve.lookupPath(e,{follow_mount:!1});if(!ve.isMountpoint(t.node))throw new ve.ErrnoError(28);var s=t.node,i=s.mounted,r=ve.getMounts(i);Object.keys(ve.nameTable).forEach((function(e){for(var t=ve.nameTable[e];t;){var s=t.name_next;r.includes(t.mount)&&ve.destroyNode(t),t=s}})),s.mounted=null;var o=s.mount.mounts.indexOf(i);s.mount.mounts.splice(o,1)},lookup:function(e,t){return e.node_ops.lookup(e,t)},mknod:function(e,t,s){var i=ve.lookupPath(e,{parent:!0}).node,r=fe.basename(e);if(!r||"."===r||".."===r)throw new ve.ErrnoError(28);var o=ve.mayCreate(i,r);if(o)throw new ve.ErrnoError(o);if(!i.node_ops.mknod)throw new ve.ErrnoError(63);return i.node_ops.mknod(i,r,t,s)},create:function(e,t){return t=void 0!==t?t:438,t&=4095,t|=32768,ve.mknod(e,t,0)},mkdir:function(e,t){return t=void 0!==t?t:511,t&=1023,t|=16384,ve.mknod(e,t,0)},mkdirTree:function(e,t){for(var s=e.split("/"),i="",r=0;r<s.length;++r)if(s[r]){i+="/"+s[r];try{ve.mkdir(i,t)}catch(e){if(20!=e.errno)throw e}}},mkdev:function(e,t,s){return void 0===s&&(s=t,t=438),t|=8192,ve.mknod(e,t,s)},symlink:function(e,t){if(!ge.resolve(e))throw new ve.ErrnoError(44);var s=ve.lookupPath(t,{parent:!0}).node;if(!s)throw new ve.ErrnoError(44);var i=fe.basename(t),r=ve.mayCreate(s,i);if(r)throw new ve.ErrnoError(r);if(!s.node_ops.symlink)throw new ve.ErrnoError(63);return s.node_ops.symlink(s,i,e)},rename:function(e,t){var s,i,r=fe.dirname(e),o=fe.dirname(t),n=fe.basename(e),a=fe.basename(t);if(s=ve.lookupPath(e,{parent:!0}).node,i=ve.lookupPath(t,{parent:!0}).node,!s||!i)throw new ve.ErrnoError(44);if(s.mount!==i.mount)throw new ve.ErrnoError(75);var h,l=ve.lookupNode(s,n),u=ge.relative(e,o);if("."!==u.charAt(0))throw new ve.ErrnoError(28);if("."!==(u=ge.relative(t,r)).charAt(0))throw new ve.ErrnoError(55);try{h=ve.lookupNode(i,a)}catch(e){}if(l!==h){var c=ve.isDir(l.mode),p=ve.mayDelete(s,n,c);if(p)throw new ve.ErrnoError(p);if(p=h?ve.mayDelete(i,a,c):ve.mayCreate(i,a))throw new ve.ErrnoError(p);if(!s.node_ops.rename)throw new ve.ErrnoError(63);if(ve.isMountpoint(l)||h&&ve.isMountpoint(h))throw new ve.ErrnoError(10);if(i!==s&&(p=ve.nodePermissions(s,"w")))throw new ve.ErrnoError(p);try{ve.trackingDelegate.willMovePath&&ve.trackingDelegate.willMovePath(e,t)}catch(s){b("FS.trackingDelegate['willMovePath']('"+e+"', '"+t+"') threw an exception: "+s.message)}ve.hashRemoveNode(l);try{s.node_ops.rename(l,i,a)}catch(e){throw e}finally{ve.hashAddNode(l)}try{ve.trackingDelegate.onMovePath&&ve.trackingDelegate.onMovePath(e,t)}catch(s){b("FS.trackingDelegate['onMovePath']('"+e+"', '"+t+"') threw an exception: "+s.message)}}},rmdir:function(e){var t=ve.lookupPath(e,{parent:!0}).node,s=fe.basename(e),i=ve.lookupNode(t,s),r=ve.mayDelete(t,s,!0);if(r)throw new ve.ErrnoError(r);if(!t.node_ops.rmdir)throw new ve.ErrnoError(63);if(ve.isMountpoint(i))throw new ve.ErrnoError(10);try{ve.trackingDelegate.willDeletePath&&ve.trackingDelegate.willDeletePath(e)}catch(t){b("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.rmdir(t,s),ve.destroyNode(i);try{ve.trackingDelegate.onDeletePath&&ve.trackingDelegate.onDeletePath(e)}catch(t){b("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readdir:function(e){var t=ve.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new ve.ErrnoError(54);return t.node_ops.readdir(t)},unlink:function(e){var t=ve.lookupPath(e,{parent:!0}).node,s=fe.basename(e),i=ve.lookupNode(t,s),r=ve.mayDelete(t,s,!1);if(r)throw new ve.ErrnoError(r);if(!t.node_ops.unlink)throw new ve.ErrnoError(63);if(ve.isMountpoint(i))throw new ve.ErrnoError(10);try{ve.trackingDelegate.willDeletePath&&ve.trackingDelegate.willDeletePath(e)}catch(t){b("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+t.message)}t.node_ops.unlink(t,s),ve.destroyNode(i);try{ve.trackingDelegate.onDeletePath&&ve.trackingDelegate.onDeletePath(e)}catch(t){b("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+t.message)}},readlink:function(e){var t=ve.lookupPath(e).node;if(!t)throw new ve.ErrnoError(44);if(!t.node_ops.readlink)throw new ve.ErrnoError(28);return ge.resolve(ve.getPath(t.parent),t.node_ops.readlink(t))},stat:function(e,t){var s=ve.lookupPath(e,{follow:!t}).node;if(!s)throw new ve.ErrnoError(44);if(!s.node_ops.getattr)throw new ve.ErrnoError(63);return s.node_ops.getattr(s)},lstat:function(e){return ve.stat(e,!0)},chmod:function(e,t,s){var i;if(!(i="string"==typeof e?ve.lookupPath(e,{follow:!s}).node:e).node_ops.setattr)throw new ve.ErrnoError(63);i.node_ops.setattr(i,{mode:4095&t|-4096&i.mode,timestamp:Date.now()})},lchmod:function(e,t){ve.chmod(e,t,!0)},fchmod:function(e,t){var s=ve.getStream(e);if(!s)throw new ve.ErrnoError(8);ve.chmod(s.node,t)},chown:function(e,t,s,i){var r;if(!(r="string"==typeof e?ve.lookupPath(e,{follow:!i}).node:e).node_ops.setattr)throw new ve.ErrnoError(63);r.node_ops.setattr(r,{timestamp:Date.now()})},lchown:function(e,t,s){ve.chown(e,t,s,!0)},fchown:function(e,t,s){var i=ve.getStream(e);if(!i)throw new ve.ErrnoError(8);ve.chown(i.node,t,s)},truncate:function(e,t){if(t<0)throw new ve.ErrnoError(28);var s;if(!(s="string"==typeof e?ve.lookupPath(e,{follow:!0}).node:e).node_ops.setattr)throw new ve.ErrnoError(63);if(ve.isDir(s.mode))throw new ve.ErrnoError(31);if(!ve.isFile(s.mode))throw new ve.ErrnoError(28);var i=ve.nodePermissions(s,"w");if(i)throw new ve.ErrnoError(i);s.node_ops.setattr(s,{size:t,timestamp:Date.now()})},ftruncate:function(e,t){var s=ve.getStream(e);if(!s)throw new ve.ErrnoError(8);if(0==(2097155&s.flags))throw new ve.ErrnoError(28);ve.truncate(s.node,t)},utime:function(e,t,s){var i=ve.lookupPath(e,{follow:!0}).node;i.node_ops.setattr(i,{timestamp:Math.max(t,s)})},open:function(e,t,s,i,o){if(""===e)throw new ve.ErrnoError(44);var n;if(s=void 0===s?438:s,s=64&(t="string"==typeof t?ve.modeStringToFlags(t):t)?4095&s|32768:0,"object"==typeof e)n=e;else{e=fe.normalize(e);try{n=ve.lookupPath(e,{follow:!(131072&t)}).node}catch(e){}}var a=!1;if(64&t)if(n){if(128&t)throw new ve.ErrnoError(20)}else n=ve.mknod(e,s,0),a=!0;if(!n)throw new ve.ErrnoError(44);if(ve.isChrdev(n.mode)&&(t&=-513),65536&t&&!ve.isDir(n.mode))throw new ve.ErrnoError(54);if(!a){var h=ve.mayOpen(n,t);if(h)throw new ve.ErrnoError(h)}512&t&&ve.truncate(n,0),t&=-131713;var l=ve.createStream({node:n,path:ve.getPath(n),flags:t,seekable:!0,position:0,stream_ops:n.stream_ops,ungotten:[],error:!1},i,o);l.stream_ops.open&&l.stream_ops.open(l),!r.logReadFiles||1&t||(ve.readFiles||(ve.readFiles={}),e in ve.readFiles||(ve.readFiles[e]=1,b("FS.trackingDelegate error on read file: "+e)));try{if(ve.trackingDelegate.onOpenFile){var u=0;1!=(2097155&t)&&(u|=ve.tracking.openFlags.READ),0!=(2097155&t)&&(u|=ve.tracking.openFlags.WRITE),ve.trackingDelegate.onOpenFile(e,u)}}catch(t){b("FS.trackingDelegate['onOpenFile']('"+e+"', flags) threw an exception: "+t.message)}return l},close:function(e){if(ve.isClosed(e))throw new ve.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(e){throw e}finally{ve.closeStream(e.fd)}e.fd=null},isClosed:function(e){return null===e.fd},llseek:function(e,t,s){if(ve.isClosed(e))throw new ve.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new ve.ErrnoError(70);if(0!=s&&1!=s&&2!=s)throw new ve.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,s),e.ungotten=[],e.position},read:function(e,t,s,i,r){if(s>>>=0,i<0||r<0)throw new ve.ErrnoError(28);if(ve.isClosed(e))throw new ve.ErrnoError(8);if(1==(2097155&e.flags))throw new ve.ErrnoError(8);if(ve.isDir(e.node.mode))throw new ve.ErrnoError(31);if(!e.stream_ops.read)throw new ve.ErrnoError(28);var o=void 0!==r;if(o){if(!e.seekable)throw new ve.ErrnoError(70)}else r=e.position;var n=e.stream_ops.read(e,t,s,i,r);return o||(e.position+=n),n},write:function(e,t,s,i,r,o){if(s>>>=0,i<0||r<0)throw new ve.ErrnoError(28);if(ve.isClosed(e))throw new ve.ErrnoError(8);if(0==(2097155&e.flags))throw new ve.ErrnoError(8);if(ve.isDir(e.node.mode))throw new ve.ErrnoError(31);if(!e.stream_ops.write)throw new ve.ErrnoError(28);e.seekable&&1024&e.flags&&ve.llseek(e,0,2);var n=void 0!==r;if(n){if(!e.seekable)throw new ve.ErrnoError(70)}else r=e.position;var a=e.stream_ops.write(e,t,s,i,r,o);n||(e.position+=a);try{e.path&&ve.trackingDelegate.onWriteToFile&&ve.trackingDelegate.onWriteToFile(e.path)}catch(t){b("FS.trackingDelegate['onWriteToFile']('"+e.path+"') threw an exception: "+t.message)}return a},allocate:function(e,t,s){if(ve.isClosed(e))throw new ve.ErrnoError(8);if(t<0||s<=0)throw new ve.ErrnoError(28);if(0==(2097155&e.flags))throw new ve.ErrnoError(8);if(!ve.isFile(e.node.mode)&&!ve.isDir(e.node.mode))throw new ve.ErrnoError(43);if(!e.stream_ops.allocate)throw new ve.ErrnoError(138);e.stream_ops.allocate(e,t,s)},mmap:function(e,t,s,i,r,o){if(t>>>=0,0!=(2&r)&&0==(2&o)&&2!=(2097155&e.flags))throw new ve.ErrnoError(2);if(1==(2097155&e.flags))throw new ve.ErrnoError(2);if(!e.stream_ops.mmap)throw new ve.ErrnoError(43);return e.stream_ops.mmap(e,t,s,i,r,o)},msync:function(e,t,s,i,r){return s>>>=0,e&&e.stream_ops.msync?e.stream_ops.msync(e,t,s,i,r):0},munmap:function(e){return 0},ioctl:function(e,t,s){if(!e.stream_ops.ioctl)throw new ve.ErrnoError(59);return e.stream_ops.ioctl(e,t,s)},readFile:function(e,t){if((t=t||{}).flags=t.flags||0,t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw new Error('Invalid encoding type "'+t.encoding+'"');var s,i=ve.open(e,t.flags),r=ve.stat(e).size,o=new Uint8Array(r);return ve.read(i,o,0,r,0),"utf8"===t.encoding?s=I(o,0):"binary"===t.encoding&&(s=o),ve.close(i),s},writeFile:function(e,t,s){(s=s||{}).flags=s.flags||577;var i=ve.open(e,s.flags,s.mode);if("string"==typeof t){var r=new Uint8Array(E(t)+1),o=D(t,r,0,r.length);ve.write(i,r,0,o,void 0,s.canOwn)}else{if(!ArrayBuffer.isView(t))throw new Error("Unsupported data type");ve.write(i,t,0,t.byteLength,void 0,s.canOwn)}ve.close(i)},cwd:function(){return ve.currentPath},chdir:function(e){var t=ve.lookupPath(e,{follow:!0});if(null===t.node)throw new ve.ErrnoError(44);if(!ve.isDir(t.node.mode))throw new ve.ErrnoError(54);var s=ve.nodePermissions(t.node,"x");if(s)throw new ve.ErrnoError(s);ve.currentPath=t.path},createDefaultDirectories:function(){ve.mkdir("/tmp"),ve.mkdir("/home"),ve.mkdir("/home/web_user")},createDefaultDevices:function(){ve.mkdir("/dev"),ve.registerDevice(ve.makedev(1,3),{read:function(){return 0},write:function(e,t,s,i,r){return i}}),ve.mkdev("/dev/null",ve.makedev(1,3)),_e.register(ve.makedev(5,0),_e.default_tty_ops),_e.register(ve.makedev(6,0),_e.default_tty1_ops),ve.mkdev("/dev/tty",ve.makedev(5,0)),ve.mkdev("/dev/tty1",ve.makedev(6,0));var e=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}if(g)try{var t=$v();return function(){return t.randomBytes(1)[0]}}catch(e){}return function(){he("randomDevice")}}();ve.createDevice("/dev","random",e),ve.createDevice("/dev","urandom",e),ve.mkdir("/dev/shm"),ve.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){ve.mkdir("/proc");var e=ve.mkdir("/proc/self");ve.mkdir("/proc/self/fd"),ve.mount({mount:function(){var t=ve.createNode(e,"fd",16895,73);return t.node_ops={lookup:function(e,t){var s=+t,i=ve.getStream(s);if(!i)throw new ve.ErrnoError(8);var r={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return i.path}}};return r.parent=r,r}},t}},{},"/proc/self/fd")},createStandardStreams:function(){r.stdin?ve.createDevice("/dev","stdin",r.stdin):ve.symlink("/dev/tty","/dev/stdin"),r.stdout?ve.createDevice("/dev","stdout",null,r.stdout):ve.symlink("/dev/tty","/dev/stdout"),r.stderr?ve.createDevice("/dev","stderr",null,r.stderr):ve.symlink("/dev/tty1","/dev/stderr"),ve.open("/dev/stdin",0),ve.open("/dev/stdout",1),ve.open("/dev/stderr",1)},ensureErrnoError:function(){ve.ErrnoError||(ve.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){this.errno=e},this.setErrno(e),this.message="FS error"},ve.ErrnoError.prototype=new Error,ve.ErrnoError.prototype.constructor=ve.ErrnoError,[44].forEach((function(e){ve.genericErrors[e]=new ve.ErrnoError(e),ve.genericErrors[e].stack="<generic error, no stack>"})))},staticInit:function(){ve.ensureErrnoError(),ve.nameTable=new Array(4096),ve.mount(ye,{},"/"),ve.createDefaultDirectories(),ve.createDefaultDevices(),ve.createSpecialDirectories(),ve.filesystems={MEMFS:ye}},init:function(e,t,s){ve.init.initialized=!0,ve.ensureErrnoError(),r.stdin=e||r.stdin,r.stdout=t||r.stdout,r.stderr=s||r.stderr,ve.createStandardStreams()},quit:function(){ve.init.initialized=!1;var e=r._fflush;e&&e(0);for(var t=0;t<ve.streams.length;t++){var s=ve.streams[t];s&&ve.close(s)}},getMode:function(e,t){var s=0;return e&&(s|=365),t&&(s|=146),s},findObject:function(e,t){var s=ve.analyzePath(e,t);return s.exists?s.object:null},analyzePath:function(e,t){try{e=(i=ve.lookupPath(e,{follow:!t})).path}catch(e){}var s={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var i=ve.lookupPath(e,{parent:!0});s.parentExists=!0,s.parentPath=i.path,s.parentObject=i.node,s.name=fe.basename(e),i=ve.lookupPath(e,{follow:!t}),s.exists=!0,s.path=i.path,s.object=i.node,s.name=i.node.name,s.isRoot="/"===i.path}catch(e){s.error=e.errno}return s},createPath:function(e,t,s,i){e="string"==typeof e?e:ve.getPath(e);for(var r=t.split("/").reverse();r.length;){var o=r.pop();if(o){var n=fe.join2(e,o);try{ve.mkdir(n)}catch(e){}e=n}}return n},createFile:function(e,t,s,i,r){var o=fe.join2("string"==typeof e?e:ve.getPath(e),t),n=ve.getMode(i,r);return ve.create(o,n)},createDataFile:function(e,t,s,i,r,o){var n=t?fe.join2("string"==typeof e?e:ve.getPath(e),t):e,a=ve.getMode(i,r),h=ve.create(n,a);if(s){if("string"==typeof s){for(var l=new Array(s.length),u=0,c=s.length;u<c;++u)l[u]=s.charCodeAt(u);s=l}ve.chmod(h,146|a);var p=ve.open(h,577);ve.write(p,s,0,s.length,0,o),ve.close(p),ve.chmod(h,a)}return h},createDevice:function(e,t,s,i){var r=fe.join2("string"==typeof e?e:ve.getPath(e),t),o=ve.getMode(!!s,!!i);ve.createDevice.major||(ve.createDevice.major=64);var n=ve.makedev(ve.createDevice.major++,0);return ve.registerDevice(n,{open:function(e){e.seekable=!1},close:function(e){i&&i.buffer&&i.buffer.length&&i(10)},read:function(e,t,i,r,o){for(var n=0,a=0;a<r;a++){var h;try{h=s()}catch(e){throw new ve.ErrnoError(29)}if(void 0===h&&0===n)throw new ve.ErrnoError(6);if(null==h)break;n++,t[i+a]=h}return n&&(e.node.timestamp=Date.now()),n},write:function(e,t,s,r,o){for(var n=0;n<r;n++)try{i(t[s+n])}catch(e){throw new ve.ErrnoError(29)}return r&&(e.node.timestamp=Date.now()),n}}),ve.mkdev(r,o,n)},forceLoadFile:function(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!a)throw new Error("Cannot load without read() or XMLHttpRequest.");try{e.contents=is(a(e.url),!0),e.usedBytes=e.contents.length}catch(e){throw new ve.ErrnoError(29)}},createLazyFile:function(e,t,s,i,r){function o(){this.lengthKnown=!1,this.chunks=[]}if(o.prototype.get=function(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,s=e/this.chunkSize|0;return this.getter(s)[t]}},o.prototype.setDataGetter=function(e){this.getter=e},o.prototype.cacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",s,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+s+". Status: "+e.status);var t,i=Number(e.getResponseHeader("Content-length")),r=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,o=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,n=1048576;r||(n=i);var a=this;a.setDataGetter((function(e){var t=e*n,r=(e+1)*n-1;if(r=Math.min(r,i-1),void 0===a.chunks[e]&&(a.chunks[e]=function(e,t){if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>i-1)throw new Error("only "+i+" bytes available! programmer error!");var r=new XMLHttpRequest;if(r.open("GET",s,!1),i!==n&&r.setRequestHeader("Range","bytes="+e+"-"+t),"undefined"!=typeof Uint8Array&&(r.responseType="arraybuffer"),r.overrideMimeType&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(null),!(r.status>=200&&r.status<300||304===r.status))throw new Error("Couldn't load "+s+". Status: "+r.status);return void 0!==r.response?new Uint8Array(r.response||[]):is(r.responseText||"",!0)}(t,r)),void 0===a.chunks[e])throw new Error("doXHR failed!");return a.chunks[e]})),!o&&i||(n=i=1,i=this.getter(0).length,n=i,v("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=i,this._chunkSize=n,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest){if(!f)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var n=new o;Object.defineProperties(n,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var a={isDevice:!1,contents:n}}else a={isDevice:!1,url:s};var h=ve.createFile(e,t,a,i,r);a.contents?h.contents=a.contents:a.url&&(h.contents=null,h.url=a.url),Object.defineProperties(h,{usedBytes:{get:function(){return this.contents.length}}});var l={};return Object.keys(h.stream_ops).forEach((function(e){var t=h.stream_ops[e];l[e]=function(){return ve.forceLoadFile(h),t.apply(null,arguments)}})),l.read=function(e,t,s,i,r){ve.forceLoadFile(h);var o=e.node.contents;if(r>=o.length)return 0;var n=Math.min(o.length-r,i);if(o.slice)for(var a=0;a<n;a++)t[s+a]=o[r+a];else for(a=0;a<n;a++)t[s+a]=o.get(r+a);return n},h.stream_ops=l,h},createPreloadedFile:function(e,t,s,i,o,n,a,l,u,c){Browser.init();var p=t?ge.resolve(fe.join2(e,t)):e;function d(s){function h(s){c&&c(),l||ve.createDataFile(e,t,s,i,o,u),n&&n(),ae()}var d=!1;r.preloadPlugins.forEach((function(e){d||e.canHandle(p)&&(e.handle(s,p,h,(function(){a&&a(),ae()})),d=!0)})),d||h(s)}ne(),"string"==typeof s?function(e,t,s,i){var r=i?"":"al "+e;h(e,(function(s){w(s,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(s)),r&&ae()}),(function(t){if(!s)throw'Loading data file "'+e+'" failed.';s()})),r&&ne()}(s,(function(e){d(e)}),a):d(s)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(e,t,s){t=t||function(){},s=s||function(){};var i=ve.indexedDB();try{var r=i.open(ve.DB_NAME(),ve.DB_VERSION)}catch(e){return s(e)}r.onupgradeneeded=function(){v("creating db"),r.result.createObjectStore(ve.DB_STORE_NAME)},r.onsuccess=function(){var i=r.result.transaction([ve.DB_STORE_NAME],"readwrite"),o=i.objectStore(ve.DB_STORE_NAME),n=0,a=0,h=e.length;function l(){0==a?t():s()}e.forEach((function(e){var t=o.put(ve.analyzePath(e).object.contents,e);t.onsuccess=function(){++n+a==h&&l()},t.onerror=function(){a++,n+a==h&&l()}})),i.onerror=s},r.onerror=s},loadFilesFromDB:function(e,t,s){t=t||function(){},s=s||function(){};var i=ve.indexedDB();try{var r=i.open(ve.DB_NAME(),ve.DB_VERSION)}catch(e){return s(e)}r.onupgradeneeded=s,r.onsuccess=function(){var i=r.result;try{var o=i.transaction([ve.DB_STORE_NAME],"readonly")}catch(e){return void s(e)}var n=o.objectStore(ve.DB_STORE_NAME),a=0,h=0,l=e.length;function u(){0==h?t():s()}e.forEach((function(e){var t=n.get(e);t.onsuccess=function(){ve.analyzePath(e).exists&&ve.unlink(e),ve.createDataFile(fe.dirname(e),fe.basename(e),t.result,!0,!0,!0),++a+h==l&&u()},t.onerror=function(){h++,a+h==l&&u()}})),o.onerror=s},r.onerror=s}},be={mappings:{},DEFAULT_POLLMASK:5,umask:511,calculateAt:function(e,t,s){if("/"===t[0])return t;var i;if(-100===e)i=ve.cwd();else{var r=ve.getStream(e);if(!r)throw new ve.ErrnoError(8);i=r.path}if(0==t.length){if(!s)throw new ve.ErrnoError(44);return i}return fe.join2(i,t)},doStat:function(e,t,s){try{var i=e(t)}catch(e){if(e&&e.node&&fe.normalize(t)!==fe.normalize(ve.getPath(e.node)))return-54;throw e}return L[s>>>2]=i.dev,L[s+4>>>2]=0,L[s+8>>>2]=i.ino,L[s+12>>>2]=i.mode,L[s+16>>>2]=i.nlink,L[s+20>>>2]=i.uid,L[s+24>>>2]=i.gid,L[s+28>>>2]=i.rdev,L[s+32>>>2]=0,ie=[i.size>>>0,(se=i.size,+Math.abs(se)>=1?se>0?(0|Math.min(+Math.floor(se/4294967296),4294967295))>>>0:~~+Math.ceil((se-+(~~se>>>0))/4294967296)>>>0:0)],L[s+40>>>2]=ie[0],L[s+44>>>2]=ie[1],L[s+48>>>2]=4096,L[s+52>>>2]=i.blocks,L[s+56>>>2]=i.atime.getTime()/1e3|0,L[s+60>>>2]=0,L[s+64>>>2]=i.mtime.getTime()/1e3|0,L[s+68>>>2]=0,L[s+72>>>2]=i.ctime.getTime()/1e3|0,L[s+76>>>2]=0,ie=[i.ino>>>0,(se=i.ino,+Math.abs(se)>=1?se>0?(0|Math.min(+Math.floor(se/4294967296),4294967295))>>>0:~~+Math.ceil((se-+(~~se>>>0))/4294967296)>>>0:0)],L[s+80>>>2]=ie[0],L[s+84>>>2]=ie[1],0},doMsync:function(e,t,s,i,r){var o=S.slice(e,e+s);ve.msync(t,o,r,s,i)},doMkdir:function(e,t){return"/"===(e=fe.normalize(e))[e.length-1]&&(e=e.substr(0,e.length-1)),ve.mkdir(e,t,0),0},doMknod:function(e,t,s){switch(61440&t){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return ve.mknod(e,t,s),0},doReadlink:function(e,t,s){if(s<=0)return-28;var i=ve.readlink(e),r=Math.min(s,E(i)),o=R[t+r>>>0];return A(i,t,s+1),R[t+r>>>0]=o,r},doAccess:function(e,t){if(-8&t)return-28;var s;if(!(s=ve.lookupPath(e,{follow:!0}).node))return-44;var i="";return 4&t&&(i+="r"),2&t&&(i+="w"),1&t&&(i+="x"),i&&ve.nodePermissions(s,i)?-2:0},doDup:function(e,t,s){var i=ve.getStream(s);return i&&ve.close(i),ve.open(e,t,0,s,s).fd},doReadv:function(e,t,s,i){for(var r=0,o=0;o<s;o++){var n=L[t+8*o>>>2],a=L[t+(8*o+4)>>>2],h=ve.read(e,R,n,a,i);if(h<0)return-1;if(r+=h,h<a)break}return r},doWritev:function(e,t,s,i){for(var r=0,o=0;o<s;o++){var n=L[t+8*o>>>2],a=L[t+(8*o+4)>>>2],h=ve.write(e,R,n,a,i);if(h<0)return-1;r+=h}return r},varargs:void 0,get:function(){return be.varargs+=4,L[be.varargs-4>>>2]},getStr:function(e){return C(e)},getStreamFromFD:function(e){var t=ve.getStream(e);if(!t)throw new ve.ErrnoError(8);return t},get64:function(e,t){return e}},xe={};function Pe(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function Te(e){return this.fromWireType(N[e>>>2])}var we={},Me={},Ie={};function Ce(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function De(e,t){return e=Ce(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function Ae(e,t){var s=De(t,(function(e){this.name=t,this.message=e;var s=new Error(e).stack;void 0!==s&&(this.stack=this.toString()+"\n"+s.replace(/^Error(:[^\n]*)?\n/,""))}));return s.prototype=Object.create(e.prototype),s.prototype.constructor=s,s.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},s}var Ee=void 0;function Fe(e){throw new Ee(e)}function Re(e,t,s){function i(t){var i=s(t);i.length!==e.length&&Fe("Mismatched type converter count");for(var r=0;r<e.length;++r)je(e[r],i[r])}e.forEach((function(e){Ie[e]=t}));var r=new Array(t.length),o=[],n=0;t.forEach((function(e,t){Me.hasOwnProperty(e)?r[t]=Me[e]:(o.push(e),we.hasOwnProperty(e)||(we[e]=[]),we[e].push((function(){r[t]=Me[e],++n===o.length&&i(r)})))})),0===o.length&&i(r)}var Se={};function Oe(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var Be=void 0;function Le(e){for(var t="",s=e;S[s>>>0];)t+=Be[S[s++>>>0]];return t}var Ne=void 0;function ke(e){throw new Ne(e)}function je(e,t,s){if(s=s||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var i=t.name;if(e||ke('type "'+i+'" must have a positive integer typeid pointer'),Me.hasOwnProperty(e)){if(s.ignoreDuplicateRegistrations)return;ke("Cannot register type '"+i+"' twice")}if(Me[e]=t,delete Ie[e],we.hasOwnProperty(e)){var r=we[e];delete we[e],r.forEach((function(e){e()}))}}function Ge(e){if(!(this instanceof et))return!1;if(!(e instanceof et))return!1;for(var t=this.$$.ptrType.registeredClass,s=this.$$.ptr,i=e.$$.ptrType.registeredClass,r=e.$$.ptr;t.baseClass;)s=t.upcast(s),t=t.baseClass;for(;i.baseClass;)r=i.upcast(r),i=i.baseClass;return t===i&&s===r}function He(e){return{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType}}function Ve(e){ke(e.$$.ptrType.registeredClass.name+" instance already deleted")}var Ue=!1;function ze(e){}function We(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function Xe(e){return"undefined"==typeof FinalizationGroup?(Xe=function(e){return e},e):(Ue=new FinalizationGroup((function(e){for(var t=e.next();!t.done;t=e.next()){var s=t.value;s.ptr?We(s):console.warn("object already deleted: "+s.ptr)}})),ze=function(e){Ue.unregister(e.$$)},(Xe=function(e){return Ue.register(e,e.$$,e.$$),e})(e))}function Ye(){if(this.$$.ptr||Ve(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e=Xe(Object.create(Object.getPrototypeOf(this),{$$:{value:He(this.$$)}}));return e.$$.count.value+=1,e.$$.deleteScheduled=!1,e}function Ke(){this.$$.ptr||Ve(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ke("Object already scheduled for deletion"),ze(this),We(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Je(){return!this.$$.ptr}var Ze=void 0,Qe=[];function qe(){for(;Qe.length;){var e=Qe.pop();e.$$.deleteScheduled=!1,e.delete()}}function $e(){return this.$$.ptr||Ve(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ke("Object already scheduled for deletion"),Qe.push(this),1===Qe.length&&Ze&&Ze(qe),this.$$.deleteScheduled=!0,this}function et(){}var tt={};function st(e,t,s){if(void 0===e[t].overloadTable){var i=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||ke("Function '"+s+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[i.argCount]=i}}function it(e,t,s){r.hasOwnProperty(e)?((void 0===s||void 0!==r[e].overloadTable&&void 0!==r[e].overloadTable[s])&&ke("Cannot register public name '"+e+"' twice"),st(r,e,e),r.hasOwnProperty(s)&&ke("Cannot register multiple overloads of a function with the same number of arguments ("+s+")!"),r[e].overloadTable[s]=t):(r[e]=t,void 0!==s&&(r[e].numArguments=s))}function rt(e,t,s,i,r,o,n,a){this.name=e,this.constructor=t,this.instancePrototype=s,this.rawDestructor=i,this.baseClass=r,this.getActualType=o,this.upcast=n,this.downcast=a,this.pureVirtualFunctions=[]}function ot(e,t,s){for(;t!==s;)t.upcast||ke("Expected null or instance of "+s.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function nt(e,t){if(null===t)return this.isReference&&ke("null is not a valid "+this.name),0;t.$$||ke('Cannot pass "'+Nt(t)+'" as a '+this.name),t.$$.ptr||ke("Cannot pass deleted object as a pointer of type "+this.name);var s=t.$$.ptrType.registeredClass;return ot(t.$$.ptr,s,this.registeredClass)}function at(e,t){var s;if(null===t)return this.isReference&&ke("null is not a valid "+this.name),this.isSmartPointer?(s=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,s),s):0;t.$$||ke('Cannot pass "'+Nt(t)+'" as a '+this.name),t.$$.ptr||ke("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&ke("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var i=t.$$.ptrType.registeredClass;if(s=ot(t.$$.ptr,i,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&ke("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?s=t.$$.smartPtr:ke("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:s=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)s=t.$$.smartPtr;else{var r=t.clone();s=this.rawShare(s,Ot((function(){r.delete()}))),null!==e&&e.push(this.rawDestructor,s)}break;default:ke("Unsupporting sharing policy")}return s}function ht(e,t){if(null===t)return this.isReference&&ke("null is not a valid "+this.name),0;t.$$||ke('Cannot pass "'+Nt(t)+'" as a '+this.name),t.$$.ptr||ke("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&ke("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var s=t.$$.ptrType.registeredClass;return ot(t.$$.ptr,s,this.registeredClass)}function lt(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function ut(e){this.rawDestructor&&this.rawDestructor(e)}function ct(e){null!==e&&e.delete()}function pt(e,t,s){if(t===s)return e;if(void 0===s.baseClass)return null;var i=pt(e,t,s.baseClass);return null===i?null:s.downcast(i)}function dt(){return Object.keys(gt).length}function mt(){var e=[];for(var t in gt)gt.hasOwnProperty(t)&&e.push(gt[t]);return e}function ft(e){Ze=e,Qe.length&&Ze&&Ze(qe)}var gt={};function _t(e,t){return t=function(e,t){for(void 0===t&&ke("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),gt[t]}function yt(e,t){return t.ptrType&&t.ptr||Fe("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!=!!t.smartPtr&&Fe("Both smartPtrType and smartPtr must be specified"),t.count={value:1},Xe(Object.create(e,{$$:{value:t}}))}function vt(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var s=_t(this.registeredClass,t);if(void 0!==s){if(0===s.$$.count.value)return s.$$.ptr=t,s.$$.smartPtr=e,s.clone();var i=s.clone();return this.destructor(e),i}function r(){return this.isSmartPointer?yt(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):yt(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var o,n=this.registeredClass.getActualType(t),a=tt[n];if(!a)return r.call(this);o=this.isConst?a.constPointerType:a.pointerType;var h=pt(t,this.registeredClass,o.registeredClass);return null===h?r.call(this):this.isSmartPointer?yt(o.registeredClass.instancePrototype,{ptrType:o,ptr:h,smartPtrType:this,smartPtr:e}):yt(o.registeredClass.instancePrototype,{ptrType:o,ptr:h})}function bt(e,t,s,i,r,o,n,a,h,l,u){this.name=e,this.registeredClass=t,this.isReference=s,this.isConst=i,this.isSmartPointer=r,this.pointeeType=o,this.sharingPolicy=n,this.rawGetPointee=a,this.rawConstructor=h,this.rawShare=l,this.rawDestructor=u,r||void 0!==t.baseClass?this.toWireType=at:i?(this.toWireType=nt,this.destructorFunction=null):(this.toWireType=ht,this.destructorFunction=null)}function xt(e,t,s){r.hasOwnProperty(e)||Fe("Replacing nonexistant public symbol"),void 0!==r[e].overloadTable&&void 0!==s?r[e].overloadTable[s]=t:(r[e]=t,r[e].argCount=s)}function Pt(e,t,s){return e.includes("j")?function(e,t,s){var i=r["dynCall_"+e];return s&&s.length?i.apply(null,[t].concat(s)):i.call(null,t)}(e,t,s):G.get(t).apply(null,s)}function Tt(e,t){var s,i,r,o=(e=Le(e)).includes("j")?(s=e,i=t,r=[],function(){r.length=arguments.length;for(var e=0;e<arguments.length;e++)r[e]=arguments[e];return Pt(s,i,r)}):G.get(t);return"function"!=typeof o&&ke("unknown function pointer with signature "+e+": "+t),o}var wt=void 0;function Mt(e){var t=as(e),s=Le(t);return ns(t),s}function It(e,t){var s=[],i={};throw t.forEach((function e(t){i[t]||Me[t]||(Ie[t]?Ie[t].forEach(e):(s.push(t),i[t]=!0))})),new wt(e+": "+s.map(Mt).join([", "]))}function Ct(e,t){for(var s=[],i=0;i<e;i++)s.push(L[(t>>2)+i>>>0]);return s}function Dt(e,t,s,i,r){var o=t.length;o<2&&ke("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var n=null!==t[1]&&null!==s,a=!1,h=1;h<t.length;++h)if(null!==t[h]&&void 0===t[h].destructorFunction){a=!0;break}var l="void"!==t[0].name,u="",c="";for(h=0;h<o-2;++h)u+=(0!==h?", ":"")+"arg"+h,c+=(0!==h?", ":"")+"arg"+h+"Wired";var p="return function "+Ce(e)+"("+u+") {\nif (arguments.length !== "+(o-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(o-2)+" args!');\n}\n";a&&(p+="var destructors = [];\n");var d=a?"destructors":"null",m=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],f=[ke,i,r,Pe,t[0],t[1]];for(n&&(p+="var thisWired = classParam.toWireType("+d+", this);\n"),h=0;h<o-2;++h)p+="var arg"+h+"Wired = argType"+h+".toWireType("+d+", arg"+h+"); // "+t[h+2].name+"\n",m.push("argType"+h),f.push(t[h+2]);if(n&&(c="thisWired"+(c.length>0?", ":"")+c),p+=(l?"var rv = ":"")+"invoker(fn"+(c.length>0?", ":"")+c+");\n",a)p+="runDestructors(destructors);\n";else for(h=n?1:2;h<t.length;++h){var g=1===h?"thisWired":"arg"+(h-2)+"Wired";null!==t[h].destructorFunction&&(p+=g+"_dtor("+g+"); // "+t[h].name+"\n",m.push(g+"_dtor"),f.push(t[h].destructorFunction))}l&&(p+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),p+="}\n",m.push(p);var _=function(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var s=De(e.name||"unknownFunctionName",(function(){}));s.prototype=e.prototype;var i=new s,r=e.apply(i,t);return r instanceof Object?r:i}(Function,m).apply(null,f);return _}var At=[],Et=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function Ft(e){e>4&&0==--Et[e].refcount&&(Et[e]=void 0,At.push(e))}function Rt(){for(var e=0,t=5;t<Et.length;++t)void 0!==Et[t]&&++e;return e}function St(){for(var e=5;e<Et.length;++e)if(void 0!==Et[e])return Et[e];return null}function Ot(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=At.length?At.pop():Et.length;return Et[t]={refcount:1,value:e},t}}function Bt(e,t,s){switch(t){case 0:return function(e){var t=s?R:S;return this.fromWireType(t[e>>>0])};case 1:return function(e){var t=s?O:B;return this.fromWireType(t[e>>>1])};case 2:return function(e){var t=s?L:N;return this.fromWireType(t[e>>>2])};default:throw new TypeError("Unknown integer type: "+e)}}function Lt(e,t){var s=Me[e];return void 0===s&&ke(t+" has unknown type "+Mt(e)),s}function Nt(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function kt(e,t){switch(t){case 2:return function(e){return this.fromWireType(k[e>>>2])};case 3:return function(e){return this.fromWireType(j[e>>>3])};default:throw new TypeError("Unknown float type: "+e)}}function jt(e,t,s){switch(t){case 0:return s?function(e){return R[e>>>0]}:function(e){return S[e>>>0]};case 1:return s?function(e){return O[e>>>1]}:function(e){return B[e>>>1]};case 2:return s?function(e){return L[e>>>2]}:function(e){return N[e>>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function Gt(e){return e||ke("Cannot use deleted val. handle = "+e),Et[e].value}var Ht,Vt={};function Ut(e){var t=Vt[e];return void 0===t?Le(e):t}function zt(){return"object"==typeof globalThis?globalThis:Function("return this")()}function Wt(e){try{return x.grow(e-F.byteLength+65535>>>16),K(x.buffer),1}catch(e){}}Ht=g?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:function(){return performance.now()};var Xt={};function Yt(){if(!Yt.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:p||"./this.program"};for(var t in Xt)void 0===Xt[t]?delete e[t]:e[t]=Xt[t];var s=[];for(var t in e)s.push(t+"="+e[t]);Yt.strings=s}return Yt.strings}function Kt(e){return e%4==0&&(e%100!=0||e%400==0)}function Jt(e,t){for(var s=0,i=0;i<=t;s+=e[i++]);return s}var Zt=[31,29,31,30,31,30,31,31,30,31,30,31],Qt=[31,28,31,30,31,30,31,31,30,31,30,31];function qt(e,t){for(var s=new Date(e.getTime());t>0;){var i=Kt(s.getFullYear()),r=s.getMonth(),o=(i?Zt:Qt)[r];if(!(t>o-s.getDate()))return s.setDate(s.getDate()+t),s;t-=o-s.getDate()+1,s.setDate(1),r<11?s.setMonth(r+1):(s.setMonth(0),s.setFullYear(s.getFullYear()+1))}return s}function $t(e,t,s,i){var r=L[i+40>>>2],o={tm_sec:L[i>>>2],tm_min:L[i+4>>>2],tm_hour:L[i+8>>>2],tm_mday:L[i+12>>>2],tm_mon:L[i+16>>>2],tm_year:L[i+20>>>2],tm_wday:L[i+24>>>2],tm_yday:L[i+28>>>2],tm_isdst:L[i+32>>>2],tm_gmtoff:L[i+36>>>2],tm_zone:r?C(r):""},n=C(s),a={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var h in a)n=n.replace(new RegExp(h,"g"),a[h]);var l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],u=["January","February","March","April","May","June","July","August","September","October","November","December"];function c(e,t,s){for(var i="number"==typeof e?e.toString():e||"";i.length<t;)i=s[0]+i;return i}function p(e,t){return c(e,t,"0")}function d(e,t){function s(e){return e<0?-1:e>0?1:0}var i;return 0===(i=s(e.getFullYear()-t.getFullYear()))&&0===(i=s(e.getMonth()-t.getMonth()))&&(i=s(e.getDate()-t.getDate())),i}function m(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function f(e){var t=qt(new Date(e.tm_year+1900,0,1),e.tm_yday),s=new Date(t.getFullYear(),0,4),i=new Date(t.getFullYear()+1,0,4),r=m(s),o=m(i);return d(r,t)<=0?d(o,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var g={"%a":function(e){return l[e.tm_wday].substring(0,3)},"%A":function(e){return l[e.tm_wday]},"%b":function(e){return u[e.tm_mon].substring(0,3)},"%B":function(e){return u[e.tm_mon]},"%C":function(e){return p((e.tm_year+1900)/100|0,2)},"%d":function(e){return p(e.tm_mday,2)},"%e":function(e){return c(e.tm_mday,2," ")},"%g":function(e){return f(e).toString().substring(2)},"%G":function(e){return f(e)},"%H":function(e){return p(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),p(t,2)},"%j":function(e){return p(e.tm_mday+Jt(Kt(e.tm_year+1900)?Zt:Qt,e.tm_mon-1),3)},"%m":function(e){return p(e.tm_mon+1,2)},"%M":function(e){return p(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return p(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=new Date(e.tm_year+1900,0,1),s=0===t.getDay()?t:qt(t,7-t.getDay()),i=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(d(s,i)<0){var r=Jt(Kt(i.getFullYear())?Zt:Qt,i.getMonth()-1)-31,o=31-s.getDate()+r+i.getDate();return p(Math.ceil(o/7),2)}return 0===d(s,t)?"01":"00"},"%V":function(e){var t,s=new Date(e.tm_year+1900,0,4),i=new Date(e.tm_year+1901,0,4),r=m(s),o=m(i),n=qt(new Date(e.tm_year+1900,0,1),e.tm_yday);return d(n,r)<0?"53":d(o,n)<=0?"01":(t=r.getFullYear()<e.tm_year+1900?e.tm_yday+32-r.getDate():e.tm_yday+1-r.getDate(),p(Math.ceil(t/7),2))},"%w":function(e){return e.tm_wday},"%W":function(e){var t=new Date(e.tm_year,0,1),s=1===t.getDay()?t:qt(t,0===t.getDay()?1:7-t.getDay()+1),i=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(d(s,i)<0){var r=Jt(Kt(i.getFullYear())?Zt:Qt,i.getMonth()-1)-31,o=31-s.getDate()+r+i.getDate();return p(Math.ceil(o/7),2)}return 0===d(s,t)?"01":"00"},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,s=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(s?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var h in g)n.includes(h)&&(n=n.replace(new RegExp(h,"g"),g[h](o)));var _,y,v=is(n,!1);return v.length>t?0:(_=v,y=e,R.set(_,y>>>0),v.length-1)}var es=function(e,t,s,i){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=ve.nextInode++,this.name=t,this.mode=s,this.node_ops={},this.stream_ops={},this.rdev=i},ts=365,ss=146;function is(e,t,s){var i=s>0?s:E(e)+1,r=new Array(i),o=D(e,r,0,r.length);return t&&(r.length=o),r}Object.defineProperties(es.prototype,{read:{get:function(){return(this.mode&ts)===ts},set:function(e){e?this.mode|=ts:this.mode&=-366}},write:{get:function(){return(this.mode&ss)===ss},set:function(e){e?this.mode|=ss:this.mode&=-147}},isFolder:{get:function(){return ve.isDir(this.mode)}},isDevice:{get:function(){return ve.isChrdev(this.mode)}}}),ve.FSNode=es,ve.staticInit(),r.FS_createPath=ve.createPath,r.FS_createDataFile=ve.createDataFile,r.FS_createPreloadedFile=ve.createPreloadedFile,r.FS_createLazyFile=ve.createLazyFile,r.FS_createDevice=ve.createDevice,r.FS_unlink=ve.unlink,Ee=r.InternalError=Ae(Error,"InternalError"),function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);Be=e}(),Ne=r.BindingError=Ae(Error,"BindingError"),et.prototype.isAliasOf=Ge,et.prototype.clone=Ye,et.prototype.delete=Ke,et.prototype.isDeleted=Je,et.prototype.deleteLater=$e,bt.prototype.getPointee=lt,bt.prototype.destructor=ut,bt.prototype.argPackAdvance=8,bt.prototype.readValueFromPointer=Te,bt.prototype.deleteObject=ct,bt.prototype.fromWireType=vt,r.getInheritedInstanceCount=dt,r.getLiveInheritedInstances=mt,r.flushPendingDeletes=qe,r.setDelayFunction=ft,wt=r.UnboundTypeError=Ae(Error,"UnboundTypeError"),r.count_emval_handles=Rt,r.get_first_emval=St;var rs={y:function(e,t,s,i){he("Assertion failed: "+C(e)+", at: "+[t?C(t):"unknown filename",s,i?C(i):"unknown function"])},x:function(e){return os(e+16)+16},w:function(e,t,s){throw new de(e).init(t,s),e},A:function(e,t,s){be.varargs=s;try{var i=be.getStreamFromFD(e);switch(t){case 0:return(r=be.get())<0?-28:ve.open(i.path,i.flags,0,r).fd;case 1:case 2:case 13:case 14:return 0;case 3:return i.flags;case 4:var r=be.get();return i.flags|=r,0;case 12:return r=be.get(),O[r+0>>>1]=2,0;case 16:case 8:default:return-28;case 9:return me(28),-1}}catch(e){return void 0!==ve&&e instanceof ve.ErrnoError||he(e),-e.errno}},O:function(e,t,s){be.varargs=s;try{var i=be.getStreamFromFD(e);switch(t){case 21509:case 21505:case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:case 21523:case 21524:return i.tty?0:-59;case 21519:if(!i.tty)return-59;var r=be.get();return L[r>>>2]=0,0;case 21520:return i.tty?-28:-59;case 21531:return r=be.get(),ve.ioctl(i,t,r);default:he("bad ioctl syscall "+t)}}catch(e){return void 0!==ve&&e instanceof ve.ErrnoError||he(e),-e.errno}},P:function(e,t,s){be.varargs=s;try{var i=be.getStr(e),r=s?be.get():0;return ve.open(i,t,r).fd}catch(e){return void 0!==ve&&e instanceof ve.ErrnoError||he(e),-e.errno}},Z:function(e){var t=xe[e];delete xe[e];var s=t.elements,i=s.length,r=s.map((function(e){return e.getterReturnType})).concat(s.map((function(e){return e.setterArgumentType}))),o=t.rawConstructor,n=t.rawDestructor;Re([e],r,(function(e){return s.forEach((function(t,s){var r=e[s],o=t.getter,n=t.getterContext,a=e[s+i],h=t.setter,l=t.setterContext;t.read=function(e){return r.fromWireType(o(n,e))},t.write=function(e,t){var s=[];h(l,e,a.toWireType(s,t)),Pe(s)}})),[{name:t.name,fromWireType:function(e){for(var t=new Array(i),r=0;r<i;++r)t[r]=s[r].read(e);return n(e),t},toWireType:function(e,r){if(i!==r.length)throw new TypeError("Incorrect number of tuple elements for "+t.name+": expected="+i+", actual="+r.length);for(var a=o(),h=0;h<i;++h)s[h].write(a,r[h]);return null!==e&&e.push(n,a),a},argPackAdvance:8,readValueFromPointer:Te,destructorFunction:n}]}))},o:function(e){var t=Se[e];delete Se[e];var s=t.rawConstructor,i=t.rawDestructor,r=t.fields;Re([e],r.map((function(e){return e.getterReturnType})).concat(r.map((function(e){return e.setterArgumentType}))),(function(e){var o={};return r.forEach((function(t,s){var i=t.fieldName,n=e[s],a=t.getter,h=t.getterContext,l=e[s+r.length],u=t.setter,c=t.setterContext;o[i]={read:function(e){return n.fromWireType(a(h,e))},write:function(e,t){var s=[];u(c,e,l.toWireType(s,t)),Pe(s)}}})),[{name:t.name,fromWireType:function(e){var t={};for(var s in o)t[s]=o[s].read(e);return i(e),t},toWireType:function(e,t){for(var r in o)if(!(r in t))throw new TypeError('Missing field:  "'+r+'"');var n=s();for(r in o)o[r].write(n,t[r]);return null!==e&&e.push(i,n),n},argPackAdvance:8,readValueFromPointer:Te,destructorFunction:i}]}))},J:function(e,t,s,i,r){},W:function(e,t,s,i,r){var o=Oe(s);je(e,{name:t=Le(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?i:r},argPackAdvance:8,readValueFromPointer:function(e){var i;if(1===s)i=R;else if(2===s)i=O;else{if(4!==s)throw new TypeError("Unknown boolean type size: "+t);i=L}return this.fromWireType(i[e>>>o])},destructorFunction:null})},r:function(e,t,s,i,r,o,n,a,h,l,u,c,p){u=Le(u),o=Tt(r,o),a&&(a=Tt(n,a)),l&&(l=Tt(h,l)),p=Tt(c,p);var d=Ce(u);it(d,(function(){It("Cannot construct "+u+" due to unbound types",[i])})),Re([e,t,s],i?[i]:[],(function(t){var s,r;t=t[0],r=i?(s=t.registeredClass).instancePrototype:et.prototype;var n=De(d,(function(){if(Object.getPrototypeOf(this)!==h)throw new Ne("Use 'new' to construct "+u);if(void 0===c.constructor_body)throw new Ne(u+" has no accessible constructor");var e=c.constructor_body[arguments.length];if(void 0===e)throw new Ne("Tried to invoke ctor of "+u+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(c.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),h=Object.create(r,{constructor:{value:n}});n.prototype=h;var c=new rt(u,n,h,p,s,o,a,l),m=new bt(u,c,!0,!1,!1),f=new bt(u+"*",c,!1,!1,!1),g=new bt(u+" const*",c,!1,!0,!1);return tt[e]={pointerType:f,constPointerType:g},xt(d,n),[m,f,g]}))},q:function(e,t,s,i,r,o){w(t>0);var n=Ct(t,s);r=Tt(i,r);var a=[o],h=[];Re([],[e],(function(e){var s="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new Ne("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=function(){It("Cannot construct "+e.name+" due to unbound types",n)},Re([],n,(function(i){return e.registeredClass.constructor_body[t-1]=function(){arguments.length!==t-1&&ke(s+" called with "+arguments.length+" arguments, expected "+(t-1)),h.length=0,a.length=t;for(var e=1;e<t;++e)a[e]=i[e].toWireType(h,arguments[e-1]);var o=r.apply(null,a);return Pe(h),i[0].fromWireType(o)},[]})),[]}))},b:function(e,t,s,i,r,o,n,a){var h=Ct(s,i);t=Le(t),o=Tt(r,o),Re([],[e],(function(e){var i=(e=e[0]).name+"."+t;function r(){It("Cannot call "+i+" due to unbound types",h)}t.startsWith("@@")&&(t=Symbol[t.substring(2)]),a&&e.registeredClass.pureVirtualFunctions.push(t);var l=e.registeredClass.instancePrototype,u=l[t];return void 0===u||void 0===u.overloadTable&&u.className!==e.name&&u.argCount===s-2?(r.argCount=s-2,r.className=e.name,l[t]=r):(st(l,t,i),l[t].overloadTable[s-2]=r),Re([],h,(function(r){var a=Dt(i,r,e,o,n);return void 0===l[t].overloadTable?(a.argCount=s-2,l[t]=a):l[t].overloadTable[s-2]=a,[]})),[]}))},V:function(e,t){je(e,{name:t=Le(t),fromWireType:function(e){var t=Et[e].value;return Ft(e),t},toWireType:function(e,t){return Ot(t)},argPackAdvance:8,readValueFromPointer:Te,destructorFunction:null})},Y:function(e,t,s,i){var r=Oe(s);function o(){}t=Le(t),o.values={},je(e,{name:t,constructor:o,fromWireType:function(e){return this.constructor.values[e]},toWireType:function(e,t){return t.value},argPackAdvance:8,readValueFromPointer:Bt(t,r,i),destructorFunction:null}),it(t,o)},t:function(e,t,s){var i=Lt(e,"enum");t=Le(t);var r=i.constructor,o=Object.create(i.constructor.prototype,{value:{value:s},constructor:{value:De(i.name+"_"+t,(function(){}))}});r.values[s]=o,r[t]=o},D:function(e,t,s){var i=Oe(s);je(e,{name:t=Le(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+Nt(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:kt(t,i),destructorFunction:null})},e:function(e,t,s,i,r,o){var n=Ct(t,s);e=Le(e),r=Tt(i,r),it(e,(function(){It("Cannot call "+e+" due to unbound types",n)}),t-1),Re([],n,(function(s){var i=[s[0],null].concat(s.slice(1));return xt(e,Dt(e,i,null,r,o),t-1),[]}))},n:function(e,t,s,i,r){t=Le(t),-1===r&&(r=4294967295);var o=Oe(s),n=function(e){return e};if(0===i){var a=32-8*s;n=function(e){return e<<a>>>a}}var h=t.includes("unsigned");je(e,{name:t,fromWireType:n,toWireType:function(e,s){if("number"!=typeof s&&"boolean"!=typeof s)throw new TypeError('Cannot convert "'+Nt(s)+'" to '+this.name);if(s<i||s>r)throw new TypeError('Passing a number "'+Nt(s)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+i+", "+r+"]!");return h?s>>>0:0|s},argPackAdvance:8,readValueFromPointer:jt(t,o,0!==i),destructorFunction:null})},j:function(e,t,s){var i=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function r(e){var t=N,s=t[(e>>=2)>>>0],r=t[e+1>>>0];return new i(F,r,s)}je(e,{name:s=Le(s),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{ignoreDuplicateRegistrations:!0})},E:function(e,t){var s="std::string"===(t=Le(t));je(e,{name:t,fromWireType:function(e){var t,i=N[e>>>2];if(s)for(var r=e+4,o=0;o<=i;++o){var n=e+4+o;if(o==i||0==S[n>>>0]){var a=C(r,n-r);void 0===t?t=a:(t+=String.fromCharCode(0),t+=a),r=n+1}}else{var h=new Array(i);for(o=0;o<i;++o)h[o]=String.fromCharCode(S[e+4+o>>>0]);t=h.join("")}return ns(e),t},toWireType:function(e,t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var i="string"==typeof t;i||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||ke("Cannot pass non-string to std::string");var r=(s&&i?function(){return E(t)}:function(){return t.length})(),o=os(4+r+1);if(N[(o>>>=0)>>>2]=r,s&&i)A(t,o+4,r+1);else if(i)for(var n=0;n<r;++n){var a=t.charCodeAt(n);a>255&&(ns(o),ke("String has UTF-16 code units that do not fit in 8 bits")),S[o+4+n>>>0]=a}else for(n=0;n<r;++n)S[o+4+n>>>0]=t[n];return null!==e&&e.push(ns,o),o},argPackAdvance:8,readValueFromPointer:Te,destructorFunction:function(e){ns(e)}})},v:function(e,t,s){var i,r,o,n,a;s=Le(s),2===t?(i=V,r=U,n=z,o=function(){return B},a=1):4===t&&(i=W,r=X,n=Y,o=function(){return N},a=2),je(e,{name:s,fromWireType:function(e){for(var s,r=N[e>>>2],n=o(),h=e+4,l=0;l<=r;++l){var u=e+4+l*t;if(l==r||0==n[u>>>a]){var c=i(h,u-h);void 0===s?s=c:(s+=String.fromCharCode(0),s+=c),h=u+t}}return ns(e),s},toWireType:function(e,i){"string"!=typeof i&&ke("Cannot pass non-string to C++ string type "+s);var o=n(i),h=os(4+o+t);return N[(h>>>=0)>>>2]=o>>a,r(i,h+4,o+t),null!==e&&e.push(ns,h),h},argPackAdvance:8,readValueFromPointer:Te,destructorFunction:function(e){ns(e)}})},_:function(e,t,s,i,r,o){xe[e]={name:Le(t),rawConstructor:Tt(s,i),rawDestructor:Tt(r,o),elements:[]}},g:function(e,t,s,i,r,o,n,a,h){xe[e].elements.push({getterReturnType:t,getter:Tt(s,i),getterContext:r,setterArgumentType:o,setter:Tt(n,a),setterContext:h})},p:function(e,t,s,i,r,o){Se[e]={name:Le(t),rawConstructor:Tt(s,i),rawDestructor:Tt(r,o),fields:[]}},d:function(e,t,s,i,r,o,n,a,h,l){Se[e].fields.push({fieldName:Le(t),getterReturnType:s,getter:Tt(i,r),getterContext:o,setterArgumentType:n,setter:Tt(a,h),setterContext:l})},X:function(e,t){je(e,{isVoid:!0,name:t=Le(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},l:function(e,t,s){e=Gt(e),t=Lt(t,"emval::as");var i=[],r=Ot(i);return L[s>>>2]=r,t.toWireType(i,e)},F:function(e,t,s,i){e=Gt(e);for(var r=function(e,t){for(var s=new Array(e),i=0;i<e;++i)s[i]=Lt(L[(t>>2)+i>>>0],"parameter "+i);return s}(t,s),o=new Array(t),n=0;n<t;++n){var a=r[n];o[n]=a.readValueFromPointer(i),i+=a.argPackAdvance}return Ot(e.apply(void 0,o))},a:Ft,H:function(e){return 0===e?Ot(zt()):(e=Ut(e),Ot(zt()[e]))},m:function(e,t){return Ot((e=Gt(e))[t=Gt(t)])},i:function(e){e>4&&(Et[e].refcount+=1)},L:function(e,t){return(e=Gt(e))instanceof(t=Gt(t))},G:function(e){return"number"==typeof(e=Gt(e))},z:function(){return Ot([])},f:function(e){return Ot(Ut(e))},s:function(){return Ot({})},k:function(e){Pe(Et[e].value),Ft(e)},h:function(e,t,s){e=Gt(e),t=Gt(t),s=Gt(s),e[t]=s},c:function(e,t){return Ot((e=Lt(e,"_emval_take_value")).readValueFromPointer(t))},C:function(){he()},N:function(e,t){var s;if(0===e)s=Date.now();else{if(1!==e&&4!==e)return me(28),-1;s=Ht()}return L[t>>>2]=s/1e3|0,L[t+4>>>2]=s%1e3*1e3*1e3|0,0},M:function(e,t,s){S.copyWithin(e>>>0,t>>>0,t+s>>>0)},u:function(e){var t,s,i=S.length,r=4294901760;if((e>>>=0)>r)return!1;for(var o=1;o<=4;o*=2){var n=i*(1+.2/o);if(n=Math.min(n,e+100663296),Wt(Math.min(r,((t=Math.max(e,n))%(s=65536)>0&&(t+=s-t%s),t))))return!0}return!1},R:function(e,t){try{var s=0;return Yt().forEach((function(i,r){var o=t+s;L[e+4*r>>>2]=o,function(e,t,s){for(var i=0;i<e.length;++i)R[t++>>>0]=e.charCodeAt(i);s||(R[t>>>0]=0)}(i,o),s+=i.length+1})),0}catch(e){return void 0!==ve&&e instanceof ve.ErrnoError||he(e),e.errno}},S:function(e,t){try{var s=Yt();L[e>>>2]=s.length;var i=0;return s.forEach((function(e){i+=e.length+1})),L[t>>>2]=i,0}catch(e){return void 0!==ve&&e instanceof ve.ErrnoError||he(e),e.errno}},B:function(e){try{var t=be.getStreamFromFD(e);return ve.close(t),0}catch(e){return void 0!==ve&&e instanceof ve.ErrnoError||he(e),e.errno}},U:function(e,t,s,i){try{var r=be.getStreamFromFD(e),o=be.doReadv(r,t,s);return L[i>>>2]=o,0}catch(e){return void 0!==ve&&e instanceof ve.ErrnoError||he(e),e.errno}},I:function(e,t,s,i,r){try{var o=be.getStreamFromFD(e),n=4294967296*s+(t>>>0),a=9007199254740992;return n<=-a||n>=a?-61:(ve.llseek(o,n,i),ie=[o.position>>>0,(se=o.position,+Math.abs(se)>=1?se>0?(0|Math.min(+Math.floor(se/4294967296),4294967295))>>>0:~~+Math.ceil((se-+(~~se>>>0))/4294967296)>>>0:0)],L[r>>>2]=ie[0],L[r+4>>>2]=ie[1],o.getdents&&0===n&&0===i&&(o.getdents=null),0)}catch(e){return void 0!==ve&&e instanceof ve.ErrnoError||he(e),e.errno}},T:function(e,t,s,i){try{var r=be.getStreamFromFD(e),o=be.doWritev(r,t,s);return L[i>>>2]=o,0}catch(e){return void 0!==ve&&e instanceof ve.ErrnoError||he(e),e.errno}},K:function(e){},Q:function(e,t,s,i){return $t(e,t,s,i)}};!function(){var e={a:rs};function t(e,t){var s,i=e.exports;r.asm=i,K((x=r.asm.$).buffer),G=r.asm.ha,s=r.asm.aa,Z.unshift(s),ae()}function s(e){t(e.instance)}function o(t){return function(){if(!y&&(m||f)){if("function"==typeof fetch&&!ue(ee))return fetch(ee,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ee+"'";return e.arrayBuffer()})).catch((function(){return ce(ee)}));if(h)return new Promise((function(e,t){h(ee,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return ce(ee)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){b("failed to asynchronously prepare wasm: "+e),he(e)}))}if(ne(),r.instantiateWasm)try{return r.instantiateWasm(e,t)}catch(e){return b("Module.instantiateWasm callback failed with error: "+e),!1}(y||"function"!=typeof WebAssembly.instantiateStreaming||le(ee)||ue(ee)||"function"!=typeof fetch?o(s):fetch(ee,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(s,(function(e){return b("wasm streaming compile failed: "+e),b("falling back to ArrayBuffer instantiation"),o(s)}))}))).catch(i)}(),r.___wasm_call_ctors=function(){return(r.___wasm_call_ctors=r.asm.aa).apply(null,arguments)},r._main=function(){return(r._main=r.asm.ba).apply(null,arguments)};var os=r._malloc=function(){return(os=r._malloc=r.asm.ca).apply(null,arguments)},ns=r._free=function(){return(ns=r._free=r.asm.da).apply(null,arguments)},as=r.___getTypeName=function(){return(as=r.___getTypeName=r.asm.ea).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.fa).apply(null,arguments)};var hs,ls=r.___errno_location=function(){return(ls=r.___errno_location=r.asm.ga).apply(null,arguments)};function us(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function cs(e){var t,s=r._main;try{t=s(0,0),$()||(r.onExit&&r.onExit(t),T=!0),d(t,new us(t))}catch(e){if(e instanceof us||"unwind"==e)return;var i=e;e&&"object"==typeof e&&e.stack&&(i=[e,e.stack]),b("exception thrown: "+i),d(1,e)}}function ps(e){function s(){hs||(hs=!0,r.calledRun=!0,T||(r.noFSInit||ve.init.initialized||ve.init(),ve.ignorePermissions=!1,pe(Z),pe(Q),t(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),ds&&cs(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)e=r.postRun.shift(),q.unshift(e);var e;pe(q)}()))}re>0||(function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)e=r.preRun.shift(),J.unshift(e);var e;pe(J)}(),re>0||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),s()}),1)):s()))}if(r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.ia).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.ja).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.ka).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.la).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.ma).apply(null,arguments)},r.addRunDependency=ne,r.removeRunDependency=ae,r.FS_createPath=ve.createPath,r.FS_createDataFile=ve.createDataFile,r.FS_createPreloadedFile=ve.createPreloadedFile,r.FS_createLazyFile=ve.createLazyFile,r.FS_createDevice=ve.createDevice,r.FS_unlink=ve.unlink,r.FS=ve,oe=function e(){hs||ps(),hs||(oe=e)},r.run=ps,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();var ds=!0;return r.noInitialRun&&(ds=!1),ps(),e.ready});"object"==typeof e&&"object"==typeof t?t.exports=i:"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof e&&(e.WebIFCWasm=i)}}),sb=[4288193352,1634111441,177149247,2056796094,3087945054,325726236,1674181508,277319702,753842376,2906023776,4196446775,32344328,644574406,963979645,4031249490,3299480353,2979338954,1095909175,3124254112,2938176219,635142910,3758799889,1051757585,4217484030,3999819293,3902619387,3296154744,1677625105,639361253,843113511,905975707,3221913625,3571504051,2272882330,25142252,4136498852,3640358203,1973544240,3495092785,4074379575,3426335179,1335981549,1052013943,1062813311,1945004755,3040386961,3041715199,395920057,3242481149,342316401,3518393246,1360408905,1904799276,862014818,3310460725,264262732,402227799,1003880860,1758889154,4123344466,1623761950,1658829314,2814081492,3747195512,484807127,1209101575,2853485674,24185140,1310830890,3415622556,647756555,2827207264,2143335405,1287392070,819412036,1426591983,2058353004,4278956645,182646315,2188021234,3132237377,987401354,707683696,2223149337,3508470533,900683007,263784265,1509553395,3493046030,3009204131,3319311131,2068733104,4175244083,2176052936,76236018,629592764,1154579445,377706215,1437502449,1073191201,1911478936,2474470126,3588315303,3079942009,3694346114,1687234759,310824031,3612865200,3171933400,1156407060,3740093272,1946335990,3651124850,738039164,2295281155,3219374653,90941305,2262370178,3024970846,3283111854,4021432810,979691226,3027567501,2320036040,2016517767,3053780830,4086658281,1329646415,4097777520,1529196076,3127900445,3027962421,3420628829,3856911033,1999602285,1412071761,2706606064,463610769,1404847402,331165859,4252922144,682877961,3544373492,1179482911,1004757350,4243806635,214636428,2445595289,2757150158,3136571912,1807405624,530289379,1621171031,2082059205,734778138,1235345126,3689010777,3657597509,1975003073,3979015343,2218152070,603775116,3101698114,1162798199,413509423,812556717,3824725483,2347447852,3663046924,3825984169,1620046519,3026737570,630975310,4292641817,4207607924,1530820697,2391383451,2769231204,926996030,2391406946,4156078855,3512223829,4237592921,3304561284,486154966],ib={3821786052:e=>rb.FromTape(e.ID,e.type,e.arguments),2296667514:e=>ob.FromTape(e.ID,e.type,e.arguments),3630933823:e=>nb.FromTape(e.ID,e.type,e.arguments),4288193352:e=>ab.FromTape(e.ID,e.type,e.arguments),2874132201:e=>hb.FromTape(e.ID,e.type,e.arguments),618182010:e=>lb.FromTape(e.ID,e.type,e.arguments),1635779807:e=>ub.FromTape(e.ID,e.type,e.arguments),2603310189:e=>cb.FromTape(e.ID,e.type,e.arguments),3406155212:e=>pb.FromTape(e.ID,e.type,e.arguments),1634111441:e=>db.FromTape(e.ID,e.type,e.arguments),177149247:e=>mb.FromTape(e.ID,e.type,e.arguments),1411407467:e=>fb.FromTape(e.ID,e.type,e.arguments),3352864051:e=>gb.FromTape(e.ID,e.type,e.arguments),2056796094:e=>_b.FromTape(e.ID,e.type,e.arguments),1871374353:e=>yb.FromTape(e.ID,e.type,e.arguments),3087945054:e=>vb.FromTape(e.ID,e.type,e.arguments),3001207471:e=>bb.FromTape(e.ID,e.type,e.arguments),325726236:e=>xb.FromTape(e.ID,e.type,e.arguments),749761778:e=>Pb.FromTape(e.ID,e.type,e.arguments),3199563722:e=>Tb.FromTape(e.ID,e.type,e.arguments),2483840362:e=>wb.FromTape(e.ID,e.type,e.arguments),3379348081:e=>Mb.FromTape(e.ID,e.type,e.arguments),3239324667:e=>Ib.FromTape(e.ID,e.type,e.arguments),4263986512:e=>Cb.FromTape(e.ID,e.type,e.arguments),53199957:e=>Db.FromTape(e.ID,e.type,e.arguments),2029264950:e=>Ab.FromTape(e.ID,e.type,e.arguments),3512275521:e=>Eb.FromTape(e.ID,e.type,e.arguments),1674181508:e=>Fb.FromTape(e.ID,e.type,e.arguments),669184980:e=>Rb.FromTape(e.ID,e.type,e.arguments),639542469:e=>Sb.FromTape(e.ID,e.type,e.arguments),411424972:e=>Ob.FromTape(e.ID,e.type,e.arguments),130549933:e=>Bb.FromTape(e.ID,e.type,e.arguments),3869604511:e=>Lb.FromTape(e.ID,e.type,e.arguments),3798115385:e=>Nb.FromTape(e.ID,e.type,e.arguments),1310608509:e=>kb.FromTape(e.ID,e.type,e.arguments),2705031697:e=>jb.FromTape(e.ID,e.type,e.arguments),3460190687:e=>Gb.FromTape(e.ID,e.type,e.arguments),3207858831:e=>Hb.FromTape(e.ID,e.type,e.arguments),277319702:e=>Vb.FromTape(e.ID,e.type,e.arguments),1532957894:e=>Ub.FromTape(e.ID,e.type,e.arguments),4261334040:e=>zb.FromTape(e.ID,e.type,e.arguments),3125803723:e=>Wb.FromTape(e.ID,e.type,e.arguments),2740243338:e=>Xb.FromTape(e.ID,e.type,e.arguments),1967976161:e=>Yb.FromTape(e.ID,e.type,e.arguments),2461110595:e=>Kb.FromTape(e.ID,e.type,e.arguments),2887950389:e=>Jb.FromTape(e.ID,e.type,e.arguments),167062518:e=>Zb.FromTape(e.ID,e.type,e.arguments),753842376:e=>Qb.FromTape(e.ID,e.type,e.arguments),2906023776:e=>qb.FromTape(e.ID,e.type,e.arguments),819618141:e=>$b.FromTape(e.ID,e.type,e.arguments),4196446775:e=>ex.FromTape(e.ID,e.type,e.arguments),3649138523:e=>tx.FromTape(e.ID,e.type,e.arguments),616511568:e=>sx.FromTape(e.ID,e.type,e.arguments),1334484129:e=>ix.FromTape(e.ID,e.type,e.arguments),32344328:e=>rx.FromTape(e.ID,e.type,e.arguments),231477066:e=>ox.FromTape(e.ID,e.type,e.arguments),3649129432:e=>nx.FromTape(e.ID,e.type,e.arguments),2736907675:e=>ax.FromTape(e.ID,e.type,e.arguments),4037036970:e=>hx.FromTape(e.ID,e.type,e.arguments),1136057603:e=>lx.FromTape(e.ID,e.type,e.arguments),1560379544:e=>ux.FromTape(e.ID,e.type,e.arguments),3367102660:e=>cx.FromTape(e.ID,e.type,e.arguments),1387855156:e=>px.FromTape(e.ID,e.type,e.arguments),2069777674:e=>dx.FromTape(e.ID,e.type,e.arguments),1260505505:e=>mx.FromTape(e.ID,e.type,e.arguments),4182860854:e=>fx.FromTape(e.ID,e.type,e.arguments),2581212453:e=>gx.FromTape(e.ID,e.type,e.arguments),2713105998:e=>_x.FromTape(e.ID,e.type,e.arguments),644574406:e=>yx.FromTape(e.ID,e.type,e.arguments),963979645:e=>vx.FromTape(e.ID,e.type,e.arguments),4031249490:e=>bx.FromTape(e.ID,e.type,e.arguments),3299480353:e=>xx.FromTape(e.ID,e.type,e.arguments),2979338954:e=>Px.FromTape(e.ID,e.type,e.arguments),39481116:e=>Tx.FromTape(e.ID,e.type,e.arguments),1095909175:e=>wx.FromTape(e.ID,e.type,e.arguments),1909888760:e=>Mx.FromTape(e.ID,e.type,e.arguments),1950629157:e=>Ix.FromTape(e.ID,e.type,e.arguments),3124254112:e=>Cx.FromTape(e.ID,e.type,e.arguments),1177604601:e=>Dx.FromTape(e.ID,e.type,e.arguments),2938176219:e=>Ax.FromTape(e.ID,e.type,e.arguments),2188180465:e=>Ex.FromTape(e.ID,e.type,e.arguments),2898889636:e=>Fx.FromTape(e.ID,e.type,e.arguments),635142910:e=>Rx.FromTape(e.ID,e.type,e.arguments),395041908:e=>Sx.FromTape(e.ID,e.type,e.arguments),3758799889:e=>Ox.FromTape(e.ID,e.type,e.arguments),3293546465:e=>Bx.FromTape(e.ID,e.type,e.arguments),1051757585:e=>Lx.FromTape(e.ID,e.type,e.arguments),2674252688:e=>Nx.FromTape(e.ID,e.type,e.arguments),4217484030:e=>kx.FromTape(e.ID,e.type,e.arguments),1285652485:e=>jx.FromTape(e.ID,e.type,e.arguments),3999819293:e=>Gx.FromTape(e.ID,e.type,e.arguments),3203706013:e=>Hx.FromTape(e.ID,e.type,e.arguments),1123145078:e=>Vx.FromTape(e.ID,e.type,e.arguments),574549367:e=>Ux.FromTape(e.ID,e.type,e.arguments),1675464909:e=>zx.FromTape(e.ID,e.type,e.arguments),2059837836:e=>Wx.FromTape(e.ID,e.type,e.arguments),59481748:e=>Xx.FromTape(e.ID,e.type,e.arguments),3749851601:e=>Yx.FromTape(e.ID,e.type,e.arguments),3486308946:e=>Kx.FromTape(e.ID,e.type,e.arguments),3331915920:e=>Jx.FromTape(e.ID,e.type,e.arguments),1416205885:e=>Zx.FromTape(e.ID,e.type,e.arguments),3150382593:e=>Qx.FromTape(e.ID,e.type,e.arguments),3902619387:e=>qx.FromTape(e.ID,e.type,e.arguments),2951183804:e=>$x.FromTape(e.ID,e.type,e.arguments),3296154744:e=>eP.FromTape(e.ID,e.type,e.arguments),2197970202:e=>tP.FromTape(e.ID,e.type,e.arguments),2611217952:e=>sP.FromTape(e.ID,e.type,e.arguments),2937912522:e=>iP.FromTape(e.ID,e.type,e.arguments),1383045692:e=>rP.FromTape(e.ID,e.type,e.arguments),1062206242:e=>oP.FromTape(e.ID,e.type,e.arguments),1677625105:e=>nP.FromTape(e.ID,e.type,e.arguments),3893394355:e=>aP.FromTape(e.ID,e.type,e.arguments),747523909:e=>hP.FromTape(e.ID,e.type,e.arguments),647927063:e=>lP.FromTape(e.ID,e.type,e.arguments),2205249479:e=>uP.FromTape(e.ID,e.type,e.arguments),639361253:e=>cP.FromTape(e.ID,e.type,e.arguments),2301859152:e=>pP.FromTape(e.ID,e.type,e.arguments),776857604:e=>dP.FromTape(e.ID,e.type,e.arguments),3285139300:e=>mP.FromTape(e.ID,e.type,e.arguments),3264961684:e=>fP.FromTape(e.ID,e.type,e.arguments),843113511:e=>gP.FromTape(e.ID,e.type,e.arguments),905975707:e=>_P.FromTape(e.ID,e.type,e.arguments),300633059:e=>yP.FromTape(e.ID,e.type,e.arguments),3221913625:e=>vP.FromTape(e.ID,e.type,e.arguments),400855858:e=>bP.FromTape(e.ID,e.type,e.arguments),2542286263:e=>xP.FromTape(e.ID,e.type,e.arguments),3875453745:e=>PP.FromTape(e.ID,e.type,e.arguments),3732776249:e=>TP.FromTape(e.ID,e.type,e.arguments),15328376:e=>wP.FromTape(e.ID,e.type,e.arguments),2485617015:e=>MP.FromTape(e.ID,e.type,e.arguments),1485152156:e=>IP.FromTape(e.ID,e.type,e.arguments),3571504051:e=>CP.FromTape(e.ID,e.type,e.arguments),3850581409:e=>DP.FromTape(e.ID,e.type,e.arguments),2272882330:e=>AP.FromTape(e.ID,e.type,e.arguments),2816379211:e=>EP.FromTape(e.ID,e.type,e.arguments),2510884976:e=>FP.FromTape(e.ID,e.type,e.arguments),370225590:e=>RP.FromTape(e.ID,e.type,e.arguments),1981873012:e=>SP.FromTape(e.ID,e.type,e.arguments),2859738748:e=>OP.FromTape(e.ID,e.type,e.arguments),45288368:e=>BP.FromTape(e.ID,e.type,e.arguments),2614616156:e=>LP.FromTape(e.ID,e.type,e.arguments),2732653382:e=>NP.FromTape(e.ID,e.type,e.arguments),775493141:e=>kP.FromTape(e.ID,e.type,e.arguments),1959218052:e=>jP.FromTape(e.ID,e.type,e.arguments),3898045240:e=>GP.FromTape(e.ID,e.type,e.arguments),2185764099:e=>HP.FromTape(e.ID,e.type,e.arguments),1060000209:e=>VP.FromTape(e.ID,e.type,e.arguments),4105962743:e=>UP.FromTape(e.ID,e.type,e.arguments),488727124:e=>zP.FromTape(e.ID,e.type,e.arguments),1525564444:e=>WP.FromTape(e.ID,e.type,e.arguments),2559216714:e=>XP.FromTape(e.ID,e.type,e.arguments),2574617495:e=>YP.FromTape(e.ID,e.type,e.arguments),3419103109:e=>KP.FromTape(e.ID,e.type,e.arguments),3050246964:e=>JP.FromTape(e.ID,e.type,e.arguments),3293443760:e=>ZP.FromTape(e.ID,e.type,e.arguments),25142252:e=>QP.FromTape(e.ID,e.type,e.arguments),578613899:e=>qP.FromTape(e.ID,e.type,e.arguments),2889183280:e=>$P.FromTape(e.ID,e.type,e.arguments),2713554722:e=>eT.FromTape(e.ID,e.type,e.arguments),4136498852:e=>tT.FromTape(e.ID,e.type,e.arguments),335055490:e=>sT.FromTape(e.ID,e.type,e.arguments),3640358203:e=>iT.FromTape(e.ID,e.type,e.arguments),2954562838:e=>rT.FromTape(e.ID,e.type,e.arguments),1785450214:e=>oT.FromTape(e.ID,e.type,e.arguments),1466758467:e=>nT.FromTape(e.ID,e.type,e.arguments),3895139033:e=>aT.FromTape(e.ID,e.type,e.arguments),1419761937:e=>hT.FromTape(e.ID,e.type,e.arguments),602808272:e=>lT.FromTape(e.ID,e.type,e.arguments),1973544240:e=>uT.FromTape(e.ID,e.type,e.arguments),1916426348:e=>cT.FromTape(e.ID,e.type,e.arguments),3295246426:e=>pT.FromTape(e.ID,e.type,e.arguments),1815067380:e=>dT.FromTape(e.ID,e.type,e.arguments),2506170314:e=>mT.FromTape(e.ID,e.type,e.arguments),2147822146:e=>fT.FromTape(e.ID,e.type,e.arguments),539742890:e=>gT.FromTape(e.ID,e.type,e.arguments),3495092785:e=>_T.FromTape(e.ID,e.type,e.arguments),1457835157:e=>yT.FromTape(e.ID,e.type,e.arguments),2601014836:e=>vT.FromTape(e.ID,e.type,e.arguments),2827736869:e=>bT.FromTape(e.ID,e.type,e.arguments),2629017746:e=>xT.FromTape(e.ID,e.type,e.arguments),1186437898:e=>PT.FromTape(e.ID,e.type,e.arguments),3800577675:e=>TT.FromTape(e.ID,e.type,e.arguments),1105321065:e=>wT.FromTape(e.ID,e.type,e.arguments),2367409068:e=>MT.FromTape(e.ID,e.type,e.arguments),3510044353:e=>IT.FromTape(e.ID,e.type,e.arguments),1213902940:e=>CT.FromTape(e.ID,e.type,e.arguments),4074379575:e=>DT.FromTape(e.ID,e.type,e.arguments),3961806047:e=>AT.FromTape(e.ID,e.type,e.arguments),3426335179:e=>ET.FromTape(e.ID,e.type,e.arguments),1306400036:e=>FT.FromTape(e.ID,e.type,e.arguments),3632507154:e=>RT.FromTape(e.ID,e.type,e.arguments),1765591967:e=>ST.FromTape(e.ID,e.type,e.arguments),1045800335:e=>OT.FromTape(e.ID,e.type,e.arguments),2949456006:e=>BT.FromTape(e.ID,e.type,e.arguments),32440307:e=>LT.FromTape(e.ID,e.type,e.arguments),1335981549:e=>NT.FromTape(e.ID,e.type,e.arguments),2635815018:e=>kT.FromTape(e.ID,e.type,e.arguments),1945343521:e=>jT.FromTape(e.ID,e.type,e.arguments),1052013943:e=>GT.FromTape(e.ID,e.type,e.arguments),1599208980:e=>HT.FromTape(e.ID,e.type,e.arguments),562808652:e=>VT.FromTape(e.ID,e.type,e.arguments),1062813311:e=>UT.FromTape(e.ID,e.type,e.arguments),2063403501:e=>zT.FromTape(e.ID,e.type,e.arguments),1945004755:e=>WT.FromTape(e.ID,e.type,e.arguments),3256556792:e=>XT.FromTape(e.ID,e.type,e.arguments),3040386961:e=>YT.FromTape(e.ID,e.type,e.arguments),3849074793:e=>KT.FromTape(e.ID,e.type,e.arguments),3041715199:e=>JT.FromTape(e.ID,e.type,e.arguments),3205830791:e=>ZT.FromTape(e.ID,e.type,e.arguments),1154170062:e=>QT.FromTape(e.ID,e.type,e.arguments),770865208:e=>qT.FromTape(e.ID,e.type,e.arguments),3732053477:e=>$T.FromTape(e.ID,e.type,e.arguments),395920057:e=>ew.FromTape(e.ID,e.type,e.arguments),2963535650:e=>tw.FromTape(e.ID,e.type,e.arguments),1714330368:e=>sw.FromTape(e.ID,e.type,e.arguments),3242481149:e=>iw.FromTape(e.ID,e.type,e.arguments),526551008:e=>rw.FromTape(e.ID,e.type,e.arguments),2323601079:e=>ow.FromTape(e.ID,e.type,e.arguments),445594917:e=>nw.FromTape(e.ID,e.type,e.arguments),4006246654:e=>aw.FromTape(e.ID,e.type,e.arguments),342316401:e=>hw.FromTape(e.ID,e.type,e.arguments),869906466:e=>lw.FromTape(e.ID,e.type,e.arguments),3518393246:e=>uw.FromTape(e.ID,e.type,e.arguments),3760055223:e=>cw.FromTape(e.ID,e.type,e.arguments),1360408905:e=>pw.FromTape(e.ID,e.type,e.arguments),2030761528:e=>dw.FromTape(e.ID,e.type,e.arguments),3900360178:e=>mw.FromTape(e.ID,e.type,e.arguments),476780140:e=>fw.FromTape(e.ID,e.type,e.arguments),1472233963:e=>gw.FromTape(e.ID,e.type,e.arguments),1904799276:e=>_w.FromTape(e.ID,e.type,e.arguments),663422040:e=>yw.FromTape(e.ID,e.type,e.arguments),862014818:e=>vw.FromTape(e.ID,e.type,e.arguments),2417008758:e=>bw.FromTape(e.ID,e.type,e.arguments),3310460725:e=>xw.FromTape(e.ID,e.type,e.arguments),3277789161:e=>Pw.FromTape(e.ID,e.type,e.arguments),264262732:e=>Tw.FromTape(e.ID,e.type,e.arguments),1534661035:e=>ww.FromTape(e.ID,e.type,e.arguments),402227799:e=>Mw.FromTape(e.ID,e.type,e.arguments),1217240411:e=>Iw.FromTape(e.ID,e.type,e.arguments),1003880860:e=>Cw.FromTape(e.ID,e.type,e.arguments),712377611:e=>Dw.FromTape(e.ID,e.type,e.arguments),1758889154:e=>Aw.FromTape(e.ID,e.type,e.arguments),4123344466:e=>Ew.FromTape(e.ID,e.type,e.arguments),2397081782:e=>Fw.FromTape(e.ID,e.type,e.arguments),1623761950:e=>Rw.FromTape(e.ID,e.type,e.arguments),2590856083:e=>Sw.FromTape(e.ID,e.type,e.arguments),1883228015:e=>Ow.FromTape(e.ID,e.type,e.arguments),339256511:e=>Bw.FromTape(e.ID,e.type,e.arguments),2777663545:e=>Lw.FromTape(e.ID,e.type,e.arguments),1704287377:e=>Nw.FromTape(e.ID,e.type,e.arguments),2835456948:e=>kw.FromTape(e.ID,e.type,e.arguments),1658829314:e=>jw.FromTape(e.ID,e.type,e.arguments),2107101300:e=>Gw.FromTape(e.ID,e.type,e.arguments),2814081492:e=>Hw.FromTape(e.ID,e.type,e.arguments),132023988:e=>Vw.FromTape(e.ID,e.type,e.arguments),3747195512:e=>Uw.FromTape(e.ID,e.type,e.arguments),3174744832:e=>zw.FromTape(e.ID,e.type,e.arguments),484807127:e=>Ww.FromTape(e.ID,e.type,e.arguments),3390157468:e=>Xw.FromTape(e.ID,e.type,e.arguments),4148101412:e=>Yw.FromTape(e.ID,e.type,e.arguments),211053100:e=>Kw.FromTape(e.ID,e.type,e.arguments),4024345920:e=>Jw.FromTape(e.ID,e.type,e.arguments),297599258:e=>Zw.FromTape(e.ID,e.type,e.arguments),4294318154:e=>Qw.FromTape(e.ID,e.type,e.arguments),3200245327:e=>qw.FromTape(e.ID,e.type,e.arguments),1437805879:e=>$w.FromTape(e.ID,e.type,e.arguments),1209101575:e=>eM.FromTape(e.ID,e.type,e.arguments),2853485674:e=>tM.FromTape(e.ID,e.type,e.arguments),2242383968:e=>sM.FromTape(e.ID,e.type,e.arguments),1040185647:e=>iM.FromTape(e.ID,e.type,e.arguments),3548104201:e=>rM.FromTape(e.ID,e.type,e.arguments),477187591:e=>oM.FromTape(e.ID,e.type,e.arguments),2804161546:e=>nM.FromTape(e.ID,e.type,e.arguments),2556980723:e=>aM.FromTape(e.ID,e.type,e.arguments),2047409740:e=>hM.FromTape(e.ID,e.type,e.arguments),1809719519:e=>lM.FromTape(e.ID,e.type,e.arguments),803316827:e=>uM.FromTape(e.ID,e.type,e.arguments),3008276851:e=>cM.FromTape(e.ID,e.type,e.arguments),807026263:e=>pM.FromTape(e.ID,e.type,e.arguments),3737207727:e=>dM.FromTape(e.ID,e.type,e.arguments),24185140:e=>mM.FromTape(e.ID,e.type,e.arguments),1310830890:e=>fM.FromTape(e.ID,e.type,e.arguments),4219587988:e=>gM.FromTape(e.ID,e.type,e.arguments),3415622556:e=>_M.FromTape(e.ID,e.type,e.arguments),346874300:e=>yM.FromTape(e.ID,e.type,e.arguments),647756555:e=>vM.FromTape(e.ID,e.type,e.arguments),2489546625:e=>bM.FromTape(e.ID,e.type,e.arguments),2827207264:e=>xM.FromTape(e.ID,e.type,e.arguments),2143335405:e=>PM.FromTape(e.ID,e.type,e.arguments),1287392070:e=>TM.FromTape(e.ID,e.type,e.arguments),738692330:e=>wM.FromTape(e.ID,e.type,e.arguments),374418227:e=>MM.FromTape(e.ID,e.type,e.arguments),315944413:e=>IM.FromTape(e.ID,e.type,e.arguments),819412036:e=>CM.FromTape(e.ID,e.type,e.arguments),1810631287:e=>DM.FromTape(e.ID,e.type,e.arguments),1426591983:e=>AM.FromTape(e.ID,e.type,e.arguments),4222183408:e=>EM.FromTape(e.ID,e.type,e.arguments),2652556860:e=>FM.FromTape(e.ID,e.type,e.arguments),2058353004:e=>RM.FromTape(e.ID,e.type,e.arguments),3907093117:e=>SM.FromTape(e.ID,e.type,e.arguments),4278956645:e=>OM.FromTape(e.ID,e.type,e.arguments),3198132628:e=>BM.FromTape(e.ID,e.type,e.arguments),182646315:e=>LM.FromTape(e.ID,e.type,e.arguments),4037862832:e=>NM.FromTape(e.ID,e.type,e.arguments),2188021234:e=>kM.FromTape(e.ID,e.type,e.arguments),3815607619:e=>jM.FromTape(e.ID,e.type,e.arguments),3132237377:e=>GM.FromTape(e.ID,e.type,e.arguments),1482959167:e=>HM.FromTape(e.ID,e.type,e.arguments),987401354:e=>VM.FromTape(e.ID,e.type,e.arguments),1834744321:e=>UM.FromTape(e.ID,e.type,e.arguments),707683696:e=>zM.FromTape(e.ID,e.type,e.arguments),1339347760:e=>WM.FromTape(e.ID,e.type,e.arguments),2223149337:e=>XM.FromTape(e.ID,e.type,e.arguments),2297155007:e=>YM.FromTape(e.ID,e.type,e.arguments),3508470533:e=>KM.FromTape(e.ID,e.type,e.arguments),3009222698:e=>JM.FromTape(e.ID,e.type,e.arguments),900683007:e=>ZM.FromTape(e.ID,e.type,e.arguments),1893162501:e=>QM.FromTape(e.ID,e.type,e.arguments),263784265:e=>qM.FromTape(e.ID,e.type,e.arguments),4238390223:e=>$M.FromTape(e.ID,e.type,e.arguments),1509553395:e=>eI.FromTape(e.ID,e.type,e.arguments),1268542332:e=>tI.FromTape(e.ID,e.type,e.arguments),3493046030:e=>sI.FromTape(e.ID,e.type,e.arguments),4095422895:e=>iI.FromTape(e.ID,e.type,e.arguments),987898635:e=>rI.FromTape(e.ID,e.type,e.arguments),3448662350:e=>oI.FromTape(e.ID,e.type,e.arguments),2453401579:e=>nI.FromTape(e.ID,e.type,e.arguments),4142052618:e=>aI.FromTape(e.ID,e.type,e.arguments),3590301190:e=>hI.FromTape(e.ID,e.type,e.arguments),3009204131:e=>lI.FromTape(e.ID,e.type,e.arguments),852622518:e=>uI.FromTape(e.ID,e.type,e.arguments),178086475:e=>cI.FromTape(e.ID,e.type,e.arguments),2706460486:e=>pI.FromTape(e.ID,e.type,e.arguments),812098782:e=>dI.FromTape(e.ID,e.type,e.arguments),3319311131:e=>mI.FromTape(e.ID,e.type,e.arguments),1251058090:e=>fI.FromTape(e.ID,e.type,e.arguments),2068733104:e=>gI.FromTape(e.ID,e.type,e.arguments),1806887404:e=>_I.FromTape(e.ID,e.type,e.arguments),1484403080:e=>yI.FromTape(e.ID,e.type,e.arguments),3905492369:e=>vI.FromTape(e.ID,e.type,e.arguments),3570813810:e=>bI.FromTape(e.ID,e.type,e.arguments),2571569899:e=>xI.FromTape(e.ID,e.type,e.arguments),178912537:e=>PI.FromTape(e.ID,e.type,e.arguments),2294589976:e=>TI.FromTape(e.ID,e.type,e.arguments),1437953363:e=>wI.FromTape(e.ID,e.type,e.arguments),2133299955:e=>MI.FromTape(e.ID,e.type,e.arguments),4175244083:e=>II.FromTape(e.ID,e.type,e.arguments),3946677679:e=>CI.FromTape(e.ID,e.type,e.arguments),3113134337:e=>DI.FromTape(e.ID,e.type,e.arguments),2391368822:e=>AI.FromTape(e.ID,e.type,e.arguments),3741457305:e=>EI.FromTape(e.ID,e.type,e.arguments),3020489413:e=>FI.FromTape(e.ID,e.type,e.arguments),2176052936:e=>RI.FromTape(e.ID,e.type,e.arguments),4288270099:e=>SI.FromTape(e.ID,e.type,e.arguments),572779678:e=>OI.FromTape(e.ID,e.type,e.arguments),3827777499:e=>BI.FromTape(e.ID,e.type,e.arguments),428585644:e=>LI.FromTape(e.ID,e.type,e.arguments),1585845231:e=>NI.FromTape(e.ID,e.type,e.arguments),76236018:e=>kI.FromTape(e.ID,e.type,e.arguments),1051575348:e=>jI.FromTape(e.ID,e.type,e.arguments),2655187982:e=>GI.FromTape(e.ID,e.type,e.arguments),3452421091:e=>HI.FromTape(e.ID,e.type,e.arguments),4162380809:e=>VI.FromTape(e.ID,e.type,e.arguments),629592764:e=>UI.FromTape(e.ID,e.type,e.arguments),1161773419:e=>zI.FromTape(e.ID,e.type,e.arguments),1566485204:e=>WI.FromTape(e.ID,e.type,e.arguments),1402838566:e=>XI.FromTape(e.ID,e.type,e.arguments),125510826:e=>YI.FromTape(e.ID,e.type,e.arguments),2604431987:e=>KI.FromTape(e.ID,e.type,e.arguments),4266656042:e=>JI.FromTape(e.ID,e.type,e.arguments),1520743889:e=>ZI.FromTape(e.ID,e.type,e.arguments),3422422726:e=>QI.FromTape(e.ID,e.type,e.arguments),1281925730:e=>qI.FromTape(e.ID,e.type,e.arguments),3092502836:e=>$I.FromTape(e.ID,e.type,e.arguments),388784114:e=>eC.FromTape(e.ID,e.type,e.arguments),1154579445:e=>tC.FromTape(e.ID,e.type,e.arguments),2624227202:e=>sC.FromTape(e.ID,e.type,e.arguments),1008929658:e=>iC.FromTape(e.ID,e.type,e.arguments),1425443689:e=>rC.FromTape(e.ID,e.type,e.arguments),3057273783:e=>oC.FromTape(e.ID,e.type,e.arguments),2347385850:e=>nC.FromTape(e.ID,e.type,e.arguments),1838606355:e=>aC.FromTape(e.ID,e.type,e.arguments),1847130766:e=>hC.FromTape(e.ID,e.type,e.arguments),3708119e3:e=>lC.FromTape(e.ID,e.type,e.arguments),2852063980:e=>uC.FromTape(e.ID,e.type,e.arguments),760658860:e=>cC.FromTape(e.ID,e.type,e.arguments),2022407955:e=>pC.FromTape(e.ID,e.type,e.arguments),248100487:e=>dC.FromTape(e.ID,e.type,e.arguments),3303938423:e=>mC.FromTape(e.ID,e.type,e.arguments),1303795690:e=>fC.FromTape(e.ID,e.type,e.arguments),1847252529:e=>gC.FromTape(e.ID,e.type,e.arguments),2199411900:e=>_C.FromTape(e.ID,e.type,e.arguments),2235152071:e=>yC.FromTape(e.ID,e.type,e.arguments),164193824:e=>vC.FromTape(e.ID,e.type,e.arguments),3079605661:e=>bC.FromTape(e.ID,e.type,e.arguments),3404854881:e=>xC.FromTape(e.ID,e.type,e.arguments),552965576:e=>PC.FromTape(e.ID,e.type,e.arguments),3265635763:e=>TC.FromTape(e.ID,e.type,e.arguments),853536259:e=>wC.FromTape(e.ID,e.type,e.arguments),1507914824:e=>MC.FromTape(e.ID,e.type,e.arguments),2597039031:e=>IC.FromTape(e.ID,e.type,e.arguments),377706215:e=>CC.FromTape(e.ID,e.type,e.arguments),2108223431:e=>DC.FromTape(e.ID,e.type,e.arguments),1437502449:e=>AC.FromTape(e.ID,e.type,e.arguments),1114901282:e=>EC.FromTape(e.ID,e.type,e.arguments),1073191201:e=>FC.FromTape(e.ID,e.type,e.arguments),1911478936:e=>RC.FromTape(e.ID,e.type,e.arguments),3181161470:e=>SC.FromTape(e.ID,e.type,e.arguments),3368373690:e=>OC.FromTape(e.ID,e.type,e.arguments),2998442950:e=>BC.FromTape(e.ID,e.type,e.arguments),2706619895:e=>LC.FromTape(e.ID,e.type,e.arguments),2474470126:e=>NC.FromTape(e.ID,e.type,e.arguments),977012517:e=>kC.FromTape(e.ID,e.type,e.arguments),1918398963:e=>jC.FromTape(e.ID,e.type,e.arguments),3888040117:e=>GC.FromTape(e.ID,e.type,e.arguments),219451334:e=>HC.FromTape(e.ID,e.type,e.arguments),3701648758:e=>VC.FromTape(e.ID,e.type,e.arguments),2251480897:e=>UC.FromTape(e.ID,e.type,e.arguments),4143007308:e=>zC.FromTape(e.ID,e.type,e.arguments),590820931:e=>WC.FromTape(e.ID,e.type,e.arguments),3388369263:e=>XC.FromTape(e.ID,e.type,e.arguments),3505215534:e=>YC.FromTape(e.ID,e.type,e.arguments),2485787929:e=>KC.FromTape(e.ID,e.type,e.arguments),2665983363:e=>JC.FromTape(e.ID,e.type,e.arguments),3588315303:e=>ZC.FromTape(e.ID,e.type,e.arguments),3079942009:e=>QC.FromTape(e.ID,e.type,e.arguments),4251960020:e=>qC.FromTape(e.ID,e.type,e.arguments),1411181986:e=>$C.FromTape(e.ID,e.type,e.arguments),643959842:e=>eD.FromTape(e.ID,e.type,e.arguments),1029017970:e=>tD.FromTape(e.ID,e.type,e.arguments),144952367:e=>sD.FromTape(e.ID,e.type,e.arguments),3694346114:e=>iD.FromTape(e.ID,e.type,e.arguments),2837617999:e=>rD.FromTape(e.ID,e.type,e.arguments),1207048766:e=>oD.FromTape(e.ID,e.type,e.arguments),2529465313:e=>nD.FromTape(e.ID,e.type,e.arguments),2519244187:e=>aD.FromTape(e.ID,e.type,e.arguments),1682466193:e=>hD.FromTape(e.ID,e.type,e.arguments),2382730787:e=>lD.FromTape(e.ID,e.type,e.arguments),3566463478:e=>uD.FromTape(e.ID,e.type,e.arguments),3327091369:e=>cD.FromTape(e.ID,e.type,e.arguments),2077209135:e=>pD.FromTape(e.ID,e.type,e.arguments),101040310:e=>dD.FromTape(e.ID,e.type,e.arguments),3021840470:e=>mD.FromTape(e.ID,e.type,e.arguments),2483315170:e=>fD.FromTape(e.ID,e.type,e.arguments),2226359599:e=>gD.FromTape(e.ID,e.type,e.arguments),1687234759:e=>_D.FromTape(e.ID,e.type,e.arguments),1158309216:e=>yD.FromTape(e.ID,e.type,e.arguments),310824031:e=>vD.FromTape(e.ID,e.type,e.arguments),804291784:e=>bD.FromTape(e.ID,e.type,e.arguments),3612865200:e=>xD.FromTape(e.ID,e.type,e.arguments),4231323485:e=>PD.FromTape(e.ID,e.type,e.arguments),597895409:e=>TD.FromTape(e.ID,e.type,e.arguments),2004835150:e=>wD.FromTape(e.ID,e.type,e.arguments),603570806:e=>MD.FromTape(e.ID,e.type,e.arguments),1663979128:e=>ID.FromTape(e.ID,e.type,e.arguments),220341763:e=>CD.FromTape(e.ID,e.type,e.arguments),3171933400:e=>DD.FromTape(e.ID,e.type,e.arguments),1156407060:e=>AD.FromTape(e.ID,e.type,e.arguments),4017108033:e=>ED.FromTape(e.ID,e.type,e.arguments),2067069095:e=>FD.FromTape(e.ID,e.type,e.arguments),4022376103:e=>RD.FromTape(e.ID,e.type,e.arguments),1423911732:e=>SD.FromTape(e.ID,e.type,e.arguments),2924175390:e=>OD.FromTape(e.ID,e.type,e.arguments),2775532180:e=>BD.FromTape(e.ID,e.type,e.arguments),2839578677:e=>LD.FromTape(e.ID,e.type,e.arguments),3724593414:e=>ND.FromTape(e.ID,e.type,e.arguments),3740093272:e=>kD.FromTape(e.ID,e.type,e.arguments),1946335990:e=>jD.FromTape(e.ID,e.type,e.arguments),3355820592:e=>GD.FromTape(e.ID,e.type,e.arguments),759155922:e=>HD.FromTape(e.ID,e.type,e.arguments),2559016684:e=>VD.FromTape(e.ID,e.type,e.arguments),3727388367:e=>UD.FromTape(e.ID,e.type,e.arguments),3778827333:e=>zD.FromTape(e.ID,e.type,e.arguments),3967405729:e=>WD.FromTape(e.ID,e.type,e.arguments),1775413392:e=>XD.FromTape(e.ID,e.type,e.arguments),677532197:e=>YD.FromTape(e.ID,e.type,e.arguments),2022622350:e=>KD.FromTape(e.ID,e.type,e.arguments),1304840413:e=>JD.FromTape(e.ID,e.type,e.arguments),3119450353:e=>ZD.FromTape(e.ID,e.type,e.arguments),2417041796:e=>QD.FromTape(e.ID,e.type,e.arguments),2744685151:e=>qD.FromTape(e.ID,e.type,e.arguments),569719735:e=>$D.FromTape(e.ID,e.type,e.arguments),2945172077:e=>eA.FromTape(e.ID,e.type,e.arguments),4208778838:e=>tA.FromTape(e.ID,e.type,e.arguments),673634403:e=>sA.FromTape(e.ID,e.type,e.arguments),2095639259:e=>iA.FromTape(e.ID,e.type,e.arguments),3958567839:e=>rA.FromTape(e.ID,e.type,e.arguments),2802850158:e=>oA.FromTape(e.ID,e.type,e.arguments),103090709:e=>nA.FromTape(e.ID,e.type,e.arguments),653396225:e=>aA.FromTape(e.ID,e.type,e.arguments),2904328755:e=>hA.FromTape(e.ID,e.type,e.arguments),3843373140:e=>lA.FromTape(e.ID,e.type,e.arguments),3651124850:e=>uA.FromTape(e.ID,e.type,e.arguments),2598011224:e=>cA.FromTape(e.ID,e.type,e.arguments),986844984:e=>pA.FromTape(e.ID,e.type,e.arguments),871118103:e=>dA.FromTape(e.ID,e.type,e.arguments),1680319473:e=>mA.FromTape(e.ID,e.type,e.arguments),148025276:e=>fA.FromTape(e.ID,e.type,e.arguments),4166981789:e=>gA.FromTape(e.ID,e.type,e.arguments),3710013099:e=>_A.FromTape(e.ID,e.type,e.arguments),2752243245:e=>yA.FromTape(e.ID,e.type,e.arguments),941946838:e=>vA.FromTape(e.ID,e.type,e.arguments),1451395588:e=>bA.FromTape(e.ID,e.type,e.arguments),3357820518:e=>xA.FromTape(e.ID,e.type,e.arguments),492091185:e=>PA.FromTape(e.ID,e.type,e.arguments),3650150729:e=>TA.FromTape(e.ID,e.type,e.arguments),110355661:e=>wA.FromTape(e.ID,e.type,e.arguments),3521284610:e=>MA.FromTape(e.ID,e.type,e.arguments),1482703590:e=>IA.FromTape(e.ID,e.type,e.arguments),738039164:e=>CA.FromTape(e.ID,e.type,e.arguments),2295281155:e=>DA.FromTape(e.ID,e.type,e.arguments),655969474:e=>AA.FromTape(e.ID,e.type,e.arguments),1842657554:e=>EA.FromTape(e.ID,e.type,e.arguments),3219374653:e=>FA.FromTape(e.ID,e.type,e.arguments),90941305:e=>RA.FromTape(e.ID,e.type,e.arguments),2250791053:e=>SA.FromTape(e.ID,e.type,e.arguments),2044713172:e=>OA.FromTape(e.ID,e.type,e.arguments),2093928680:e=>BA.FromTape(e.ID,e.type,e.arguments),931644368:e=>LA.FromTape(e.ID,e.type,e.arguments),2090586900:e=>NA.FromTape(e.ID,e.type,e.arguments),3252649465:e=>kA.FromTape(e.ID,e.type,e.arguments),2405470396:e=>jA.FromTape(e.ID,e.type,e.arguments),825690147:e=>GA.FromTape(e.ID,e.type,e.arguments),2262370178:e=>HA.FromTape(e.ID,e.type,e.arguments),2893384427:e=>VA.FromTape(e.ID,e.type,e.arguments),3024970846:e=>UA.FromTape(e.ID,e.type,e.arguments),3283111854:e=>zA.FromTape(e.ID,e.type,e.arguments),2324767716:e=>WA.FromTape(e.ID,e.type,e.arguments),1469900589:e=>XA.FromTape(e.ID,e.type,e.arguments),1232101972:e=>YA.FromTape(e.ID,e.type,e.arguments),683857671:e=>KA.FromTape(e.ID,e.type,e.arguments),2770003689:e=>JA.FromTape(e.ID,e.type,e.arguments),3615266464:e=>ZA.FromTape(e.ID,e.type,e.arguments),2798486643:e=>QA.FromTape(e.ID,e.type,e.arguments),3454111270:e=>qA.FromTape(e.ID,e.type,e.arguments),3915482550:e=>$A.FromTape(e.ID,e.type,e.arguments),2433181523:e=>eE.FromTape(e.ID,e.type,e.arguments),4021432810:e=>tE.FromTape(e.ID,e.type,e.arguments),3413951693:e=>sE.FromTape(e.ID,e.type,e.arguments),1580146022:e=>iE.FromTape(e.ID,e.type,e.arguments),3765753017:e=>rE.FromTape(e.ID,e.type,e.arguments),979691226:e=>oE.FromTape(e.ID,e.type,e.arguments),2572171363:e=>nE.FromTape(e.ID,e.type,e.arguments),3027567501:e=>aE.FromTape(e.ID,e.type,e.arguments),964333572:e=>hE.FromTape(e.ID,e.type,e.arguments),2320036040:e=>lE.FromTape(e.ID,e.type,e.arguments),2310774935:e=>uE.FromTape(e.ID,e.type,e.arguments),160246688:e=>cE.FromTape(e.ID,e.type,e.arguments),3939117080:e=>pE.FromTape(e.ID,e.type,e.arguments),1683148259:e=>dE.FromTape(e.ID,e.type,e.arguments),2495723537:e=>mE.FromTape(e.ID,e.type,e.arguments),1307041759:e=>fE.FromTape(e.ID,e.type,e.arguments),1027710054:e=>gE.FromTape(e.ID,e.type,e.arguments),4278684876:e=>_E.FromTape(e.ID,e.type,e.arguments),2857406711:e=>yE.FromTape(e.ID,e.type,e.arguments),205026976:e=>vE.FromTape(e.ID,e.type,e.arguments),1865459582:e=>bE.FromTape(e.ID,e.type,e.arguments),4095574036:e=>xE.FromTape(e.ID,e.type,e.arguments),919958153:e=>PE.FromTape(e.ID,e.type,e.arguments),2728634034:e=>TE.FromTape(e.ID,e.type,e.arguments),982818633:e=>wE.FromTape(e.ID,e.type,e.arguments),3840914261:e=>ME.FromTape(e.ID,e.type,e.arguments),2655215786:e=>IE.FromTape(e.ID,e.type,e.arguments),826625072:e=>CE.FromTape(e.ID,e.type,e.arguments),1204542856:e=>DE.FromTape(e.ID,e.type,e.arguments),3945020480:e=>AE.FromTape(e.ID,e.type,e.arguments),4201705270:e=>EE.FromTape(e.ID,e.type,e.arguments),3190031847:e=>FE.FromTape(e.ID,e.type,e.arguments),2127690289:e=>RE.FromTape(e.ID,e.type,e.arguments),1638771189:e=>SE.FromTape(e.ID,e.type,e.arguments),504942748:e=>OE.FromTape(e.ID,e.type,e.arguments),3678494232:e=>BE.FromTape(e.ID,e.type,e.arguments),3242617779:e=>LE.FromTape(e.ID,e.type,e.arguments),886880790:e=>NE.FromTape(e.ID,e.type,e.arguments),2802773753:e=>kE.FromTape(e.ID,e.type,e.arguments),2565941209:e=>jE.FromTape(e.ID,e.type,e.arguments),2551354335:e=>GE.FromTape(e.ID,e.type,e.arguments),693640335:e=>HE.FromTape(e.ID,e.type,e.arguments),1462361463:e=>VE.FromTape(e.ID,e.type,e.arguments),4186316022:e=>UE.FromTape(e.ID,e.type,e.arguments),307848117:e=>zE.FromTape(e.ID,e.type,e.arguments),781010003:e=>WE.FromTape(e.ID,e.type,e.arguments),3940055652:e=>XE.FromTape(e.ID,e.type,e.arguments),279856033:e=>YE.FromTape(e.ID,e.type,e.arguments),427948657:e=>KE.FromTape(e.ID,e.type,e.arguments),3268803585:e=>JE.FromTape(e.ID,e.type,e.arguments),1441486842:e=>ZE.FromTape(e.ID,e.type,e.arguments),750771296:e=>QE.FromTape(e.ID,e.type,e.arguments),1245217292:e=>qE.FromTape(e.ID,e.type,e.arguments),4122056220:e=>$E.FromTape(e.ID,e.type,e.arguments),366585022:e=>eF.FromTape(e.ID,e.type,e.arguments),3451746338:e=>tF.FromTape(e.ID,e.type,e.arguments),3523091289:e=>sF.FromTape(e.ID,e.type,e.arguments),1521410863:e=>iF.FromTape(e.ID,e.type,e.arguments),1401173127:e=>rF.FromTape(e.ID,e.type,e.arguments),478536968:e=>oF.FromTape(e.ID,e.type,e.arguments),816062949:e=>nF.FromTape(e.ID,e.type,e.arguments),1076942058:e=>aF.FromTape(e.ID,e.type,e.arguments),3377609919:e=>hF.FromTape(e.ID,e.type,e.arguments),3008791417:e=>lF.FromTape(e.ID,e.type,e.arguments),1660063152:e=>uF.FromTape(e.ID,e.type,e.arguments),2914609552:e=>cF.FromTape(e.ID,e.type,e.arguments),2943643501:e=>pF.FromTape(e.ID,e.type,e.arguments),1608871552:e=>dF.FromTape(e.ID,e.type,e.arguments),2439245199:e=>mF.FromTape(e.ID,e.type,e.arguments),1042787934:e=>fF.FromTape(e.ID,e.type,e.arguments),1856042241:e=>gF.FromTape(e.ID,e.type,e.arguments),3243963512:e=>_F.FromTape(e.ID,e.type,e.arguments),4158566097:e=>yF.FromTape(e.ID,e.type,e.arguments),3626867408:e=>vF.FromTape(e.ID,e.type,e.arguments),2016517767:e=>bF.FromTape(e.ID,e.type,e.arguments),2781568857:e=>xF.FromTape(e.ID,e.type,e.arguments),2341007311:e=>PF.FromTape(e.ID,e.type,e.arguments),2778083089:e=>TF.FromTape(e.ID,e.type,e.arguments),448429030:e=>wF.FromTape(e.ID,e.type,e.arguments),3053780830:e=>MF.FromTape(e.ID,e.type,e.arguments),1768891740:e=>IF.FromTape(e.ID,e.type,e.arguments),1054537805:e=>CF.FromTape(e.ID,e.type,e.arguments),2157484638:e=>DF.FromTape(e.ID,e.type,e.arguments),2042790032:e=>AF.FromTape(e.ID,e.type,e.arguments),4165799628:e=>EF.FromTape(e.ID,e.type,e.arguments),1862484736:e=>FF.FromTape(e.ID,e.type,e.arguments),1290935644:e=>RF.FromTape(e.ID,e.type,e.arguments),1509187699:e=>SF.FromTape(e.ID,e.type,e.arguments),4086658281:e=>OF.FromTape(e.ID,e.type,e.arguments),1783015770:e=>BF.FromTape(e.ID,e.type,e.arguments),1329646415:e=>LF.FromTape(e.ID,e.type,e.arguments),4074543187:e=>NF.FromTape(e.ID,e.type,e.arguments),867548509:e=>kF.FromTape(e.ID,e.type,e.arguments),3982875396:e=>jF.FromTape(e.ID,e.type,e.arguments),4240577450:e=>GF.FromTape(e.ID,e.type,e.arguments),4124623270:e=>HF.FromTape(e.ID,e.type,e.arguments),3692461612:e=>VF.FromTape(e.ID,e.type,e.arguments),3663146110:e=>UF.FromTape(e.ID,e.type,e.arguments),4097777520:e=>zF.FromTape(e.ID,e.type,e.arguments),1529196076:e=>WF.FromTape(e.ID,e.type,e.arguments),3127900445:e=>XF.FromTape(e.ID,e.type,e.arguments),3027962421:e=>YF.FromTape(e.ID,e.type,e.arguments),2533589738:e=>KF.FromTape(e.ID,e.type,e.arguments),2609359061:e=>JF.FromTape(e.ID,e.type,e.arguments),3420628829:e=>ZF.FromTape(e.ID,e.type,e.arguments),1072016465:e=>QF.FromTape(e.ID,e.type,e.arguments),723233188:e=>qF.FromTape(e.ID,e.type,e.arguments),3856911033:e=>$F.FromTape(e.ID,e.type,e.arguments),1999602285:e=>eR.FromTape(e.ID,e.type,e.arguments),1305183839:e=>tR.FromTape(e.ID,e.type,e.arguments),3812236995:e=>sR.FromTape(e.ID,e.type,e.arguments),1412071761:e=>iR.FromTape(e.ID,e.type,e.arguments),710998568:e=>rR.FromTape(e.ID,e.type,e.arguments),2706606064:e=>oR.FromTape(e.ID,e.type,e.arguments),3893378262:e=>nR.FromTape(e.ID,e.type,e.arguments),463610769:e=>aR.FromTape(e.ID,e.type,e.arguments),2481509218:e=>hR.FromTape(e.ID,e.type,e.arguments),451544542:e=>lR.FromTape(e.ID,e.type,e.arguments),4015995234:e=>uR.FromTape(e.ID,e.type,e.arguments),1404847402:e=>cR.FromTape(e.ID,e.type,e.arguments),3112655638:e=>pR.FromTape(e.ID,e.type,e.arguments),331165859:e=>dR.FromTape(e.ID,e.type,e.arguments),4252922144:e=>mR.FromTape(e.ID,e.type,e.arguments),1039846685:e=>fR.FromTape(e.ID,e.type,e.arguments),338393293:e=>gR.FromTape(e.ID,e.type,e.arguments),682877961:e=>_R.FromTape(e.ID,e.type,e.arguments),3544373492:e=>yR.FromTape(e.ID,e.type,e.arguments),2515109513:e=>vR.FromTape(e.ID,e.type,e.arguments),1179482911:e=>bR.FromTape(e.ID,e.type,e.arguments),2273995522:e=>xR.FromTape(e.ID,e.type,e.arguments),1004757350:e=>PR.FromTape(e.ID,e.type,e.arguments),4243806635:e=>TR.FromTape(e.ID,e.type,e.arguments),214636428:e=>wR.FromTape(e.ID,e.type,e.arguments),2445595289:e=>MR.FromTape(e.ID,e.type,e.arguments),2757150158:e=>IR.FromTape(e.ID,e.type,e.arguments),3136571912:e=>CR.FromTape(e.ID,e.type,e.arguments),1807405624:e=>DR.FromTape(e.ID,e.type,e.arguments),2162789131:e=>AR.FromTape(e.ID,e.type,e.arguments),385403989:e=>ER.FromTape(e.ID,e.type,e.arguments),3478079324:e=>FR.FromTape(e.ID,e.type,e.arguments),1252848954:e=>RR.FromTape(e.ID,e.type,e.arguments),1595516126:e=>SR.FromTape(e.ID,e.type,e.arguments),609421318:e=>OR.FromTape(e.ID,e.type,e.arguments),2668620305:e=>BR.FromTape(e.ID,e.type,e.arguments),2473145415:e=>LR.FromTape(e.ID,e.type,e.arguments),1973038258:e=>NR.FromTape(e.ID,e.type,e.arguments),1597423693:e=>kR.FromTape(e.ID,e.type,e.arguments),1190533807:e=>jR.FromTape(e.ID,e.type,e.arguments),2525727697:e=>GR.FromTape(e.ID,e.type,e.arguments),3408363356:e=>HR.FromTape(e.ID,e.type,e.arguments),530289379:e=>VR.FromTape(e.ID,e.type,e.arguments),1621171031:e=>UR.FromTape(e.ID,e.type,e.arguments),2082059205:e=>zR.FromTape(e.ID,e.type,e.arguments),734778138:e=>WR.FromTape(e.ID,e.type,e.arguments),1235345126:e=>XR.FromTape(e.ID,e.type,e.arguments),3689010777:e=>YR.FromTape(e.ID,e.type,e.arguments),2986769608:e=>KR.FromTape(e.ID,e.type,e.arguments),3657597509:e=>JR.FromTape(e.ID,e.type,e.arguments),1975003073:e=>ZR.FromTape(e.ID,e.type,e.arguments),3979015343:e=>QR.FromTape(e.ID,e.type,e.arguments),2218152070:e=>qR.FromTape(e.ID,e.type,e.arguments),603775116:e=>$R.FromTape(e.ID,e.type,e.arguments),2830218821:e=>eS.FromTape(e.ID,e.type,e.arguments),3958052878:e=>tS.FromTape(e.ID,e.type,e.arguments),3049322572:e=>sS.FromTape(e.ID,e.type,e.arguments),148013059:e=>iS.FromTape(e.ID,e.type,e.arguments),4095615324:e=>rS.FromTape(e.ID,e.type,e.arguments),2233826070:e=>oS.FromTape(e.ID,e.type,e.arguments),2513912981:e=>nS.FromTape(e.ID,e.type,e.arguments),699246055:e=>aS.FromTape(e.ID,e.type,e.arguments),2028607225:e=>hS.FromTape(e.ID,e.type,e.arguments),3101698114:e=>lS.FromTape(e.ID,e.type,e.arguments),2809605785:e=>uS.FromTape(e.ID,e.type,e.arguments),4124788165:e=>cS.FromTape(e.ID,e.type,e.arguments),2934153892:e=>pS.FromTape(e.ID,e.type,e.arguments),1300840506:e=>dS.FromTape(e.ID,e.type,e.arguments),3303107099:e=>mS.FromTape(e.ID,e.type,e.arguments),1607154358:e=>fS.FromTape(e.ID,e.type,e.arguments),1878645084:e=>gS.FromTape(e.ID,e.type,e.arguments),846575682:e=>_S.FromTape(e.ID,e.type,e.arguments),1351298697:e=>yS.FromTape(e.ID,e.type,e.arguments),626085974:e=>vS.FromTape(e.ID,e.type,e.arguments),2247615214:e=>bS.FromTape(e.ID,e.type,e.arguments),1260650574:e=>xS.FromTape(e.ID,e.type,e.arguments),1096409881:e=>PS.FromTape(e.ID,e.type,e.arguments),230924584:e=>TS.FromTape(e.ID,e.type,e.arguments),1162798199:e=>wS.FromTape(e.ID,e.type,e.arguments),2315554128:e=>MS.FromTape(e.ID,e.type,e.arguments),2254336722:e=>IS.FromTape(e.ID,e.type,e.arguments),413509423:e=>CS.FromTape(e.ID,e.type,e.arguments),1580310250:e=>DS.FromTape(e.ID,e.type,e.arguments),3071757647:e=>AS.FromTape(e.ID,e.type,e.arguments),985171141:e=>ES.FromTape(e.ID,e.type,e.arguments),2043862942:e=>FS.FromTape(e.ID,e.type,e.arguments),531007025:e=>RS.FromTape(e.ID,e.type,e.arguments),812556717:e=>SS.FromTape(e.ID,e.type,e.arguments),5716631:e=>OS.FromTape(e.ID,e.type,e.arguments),3473067441:e=>BS.FromTape(e.ID,e.type,e.arguments),1549132990:e=>LS.FromTape(e.ID,e.type,e.arguments),2771591690:e=>NS.FromTape(e.ID,e.type,e.arguments),3206491090:e=>kS.FromTape(e.ID,e.type,e.arguments),912023232:e=>jS.FromTape(e.ID,e.type,e.arguments),3824725483:e=>GS.FromTape(e.ID,e.type,e.arguments),2347447852:e=>HS.FromTape(e.ID,e.type,e.arguments),3081323446:e=>VS.FromTape(e.ID,e.type,e.arguments),3663046924:e=>US.FromTape(e.ID,e.type,e.arguments),2281632017:e=>zS.FromTape(e.ID,e.type,e.arguments),2415094496:e=>WS.FromTape(e.ID,e.type,e.arguments),2387106220:e=>XS.FromTape(e.ID,e.type,e.arguments),901063453:e=>YS.FromTape(e.ID,e.type,e.arguments),4282788508:e=>KS.FromTape(e.ID,e.type,e.arguments),3124975700:e=>JS.FromTape(e.ID,e.type,e.arguments),1447204868:e=>ZS.FromTape(e.ID,e.type,e.arguments),1983826977:e=>QS.FromTape(e.ID,e.type,e.arguments),2636378356:e=>qS.FromTape(e.ID,e.type,e.arguments),1640371178:e=>$S.FromTape(e.ID,e.type,e.arguments),280115917:e=>eO.FromTape(e.ID,e.type,e.arguments),1742049831:e=>tO.FromTape(e.ID,e.type,e.arguments),2552916305:e=>sO.FromTape(e.ID,e.type,e.arguments),1210645708:e=>iO.FromTape(e.ID,e.type,e.arguments),3611470254:e=>rO.FromTape(e.ID,e.type,e.arguments),1199560280:e=>oO.FromTape(e.ID,e.type,e.arguments),3101149627:e=>nO.FromTape(e.ID,e.type,e.arguments),581633288:e=>aO.FromTape(e.ID,e.type,e.arguments),1377556343:e=>hO.FromTape(e.ID,e.type,e.arguments),1735638870:e=>lO.FromTape(e.ID,e.type,e.arguments),1935646853:e=>uO.FromTape(e.ID,e.type,e.arguments),3825984169:e=>cO.FromTape(e.ID,e.type,e.arguments),1692211062:e=>pO.FromTape(e.ID,e.type,e.arguments),2595432518:e=>dO.FromTape(e.ID,e.type,e.arguments),1620046519:e=>mO.FromTape(e.ID,e.type,e.arguments),2097647324:e=>fO.FromTape(e.ID,e.type,e.arguments),2715220739:e=>gO.FromTape(e.ID,e.type,e.arguments),2916149573:e=>_O.FromTape(e.ID,e.type,e.arguments),1229763772:e=>yO.FromTape(e.ID,e.type,e.arguments),3593883385:e=>vO.FromTape(e.ID,e.type,e.arguments),3026737570:e=>bO.FromTape(e.ID,e.type,e.arguments),1600972822:e=>xO.FromTape(e.ID,e.type,e.arguments),1628702193:e=>PO.FromTape(e.ID,e.type,e.arguments),3736923433:e=>TO.FromTape(e.ID,e.type,e.arguments),2347495698:e=>wO.FromTape(e.ID,e.type,e.arguments),3698973494:e=>MO.FromTape(e.ID,e.type,e.arguments),427810014:e=>IO.FromTape(e.ID,e.type,e.arguments),180925521:e=>CO.FromTape(e.ID,e.type,e.arguments),630975310:e=>DO.FromTape(e.ID,e.type,e.arguments),3179687236:e=>AO.FromTape(e.ID,e.type,e.arguments),4292641817:e=>EO.FromTape(e.ID,e.type,e.arguments),1911125066:e=>FO.FromTape(e.ID,e.type,e.arguments),4207607924:e=>RO.FromTape(e.ID,e.type,e.arguments),728799441:e=>SO.FromTape(e.ID,e.type,e.arguments),1417489154:e=>OO.FromTape(e.ID,e.type,e.arguments),2799835756:e=>BO.FromTape(e.ID,e.type,e.arguments),2759199220:e=>LO.FromTape(e.ID,e.type,e.arguments),1907098498:e=>NO.FromTape(e.ID,e.type,e.arguments),1530820697:e=>kO.FromTape(e.ID,e.type,e.arguments),3956297820:e=>jO.FromTape(e.ID,e.type,e.arguments),2391383451:e=>GO.FromTape(e.ID,e.type,e.arguments),3313531582:e=>HO.FromTape(e.ID,e.type,e.arguments),2769231204:e=>VO.FromTape(e.ID,e.type,e.arguments),891718957:e=>UO.FromTape(e.ID,e.type,e.arguments),926996030:e=>zO.FromTape(e.ID,e.type,e.arguments),2391406946:e=>WO.FromTape(e.ID,e.type,e.arguments),4156078855:e=>XO.FromTape(e.ID,e.type,e.arguments),3512223829:e=>YO.FromTape(e.ID,e.type,e.arguments),1898987631:e=>KO.FromTape(e.ID,e.type,e.arguments),4237592921:e=>JO.FromTape(e.ID,e.type,e.arguments),1133259667:e=>ZO.FromTape(e.ID,e.type,e.arguments),3304561284:e=>QO.FromTape(e.ID,e.type,e.arguments),336235671:e=>qO.FromTape(e.ID,e.type,e.arguments),512836454:e=>$O.FromTape(e.ID,e.type,e.arguments),486154966:e=>eB.FromTape(e.ID,e.type,e.arguments),1299126871:e=>tB.FromTape(e.ID,e.type,e.arguments),4009809668:e=>sB.FromTape(e.ID,e.type,e.arguments),4088093105:e=>iB.FromTape(e.ID,e.type,e.arguments),1028945134:e=>rB.FromTape(e.ID,e.type,e.arguments),4218914973:e=>oB.FromTape(e.ID,e.type,e.arguments),3342526732:e=>nB.FromTape(e.ID,e.type,e.arguments),1236880293:e=>aB.FromTape(e.ID,e.type,e.arguments),2543172580:e=>hB.FromTape(e.ID,e.type,e.arguments),1033361043:e=>lB.FromTape(e.ID,e.type,e.arguments)},rb=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.PredefinedType=h,this.Status=l,this.LongDescription=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new rb(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.Status),e.push(this.LongDescription),e}},ob=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.TheActor=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new ob(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.TheActor),e}},nb=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Role=s,this.UserDefinedRole=i,this.Description=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new nb(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Role),e.push(this.UserDefinedRole),e.push(this.Description),e}},ab=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new ab(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},hb=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new hb(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},lb=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Purpose=s,this.Description=i,this.UserDefinedPurpose=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new lb(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Purpose),e.push(this.Description),e.push(this.UserDefinedPurpose),e}},ub=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Outer=s}static FromTape(e,t,s){let i=0,r=s[i++];return new ub(e,t,r)}ToTape(){let e=[];return e.push(this.Outer),e}},cb=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Outer=s,this.Voids=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new cb(e,t,r,o)}ToTape(){let e=[];return e.push(this.Outer),e.push(this.Voids),e}},pb=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Bounds=s,this.FaceSurface=i,this.SameSense=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new pb(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Bounds),e.push(this.FaceSurface),e.push(this.SameSense),e}},db=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new db(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},mb=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new mb(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},fb=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new fb(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},gb=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new gb(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},_b=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new _b(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},yb=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new yb(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},vb=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new vb(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},bb=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new bb(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},xb=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Axis=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new xb(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Axis),e.push(this.PredefinedType),e}},Pb=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.StartDistAlong=s,this.Segments=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new Pb(e,t,r,o)}ToTape(){let e=[];return e.push(this.StartDistAlong),e.push(this.Segments),e}},Tb=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.TangentialContinuity=s,this.StartTag=i,this.EndTag=r,this.CurveGeometry=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Tb(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.CurveGeometry),e}},wb=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.TangentialContinuity=s,this.StartTag=i,this.EndTag=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new wb(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e}},Mb=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.TangentialContinuity=s,this.StartTag=i,this.EndTag=r,this.StartDistAlong=o,this.HorizontalLength=n,this.StartHeight=a,this.StartGradient=h,this.Radius=l,this.IsConvex=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Mb(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.StartDistAlong),e.push(this.HorizontalLength),e.push(this.StartHeight),e.push(this.StartGradient),e.push(this.Radius),e.push(this.IsConvex),e}},Ib=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.TangentialContinuity=s,this.StartTag=i,this.EndTag=r,this.StartDistAlong=o,this.HorizontalLength=n,this.StartHeight=a,this.StartGradient=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Ib(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.StartDistAlong),e.push(this.HorizontalLength),e.push(this.StartHeight),e.push(this.StartGradient),e}},Cb=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.TangentialContinuity=s,this.StartTag=i,this.EndTag=r,this.StartDistAlong=o,this.HorizontalLength=n,this.StartHeight=a,this.StartGradient=h,this.ParabolaConstant=l,this.IsConvex=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Cb(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.StartDistAlong),e.push(this.HorizontalLength),e.push(this.StartHeight),e.push(this.StartGradient),e.push(this.ParabolaConstant),e.push(this.IsConvex),e}},Db=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Segments=s}static FromTape(e,t,s){let i=0,r=s[i++];return new Db(e,t,r)}ToTape(){let e=[];return e.push(this.Segments),e}},Ab=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.TangentialContinuity=s,this.StartTag=i,this.EndTag=r,this.StartDistAlong=o,this.HorizontalLength=n,this.StartHeight=a,this.StartGradient=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Ab(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.TangentialContinuity),e.push(this.StartTag),e.push(this.EndTag),e.push(this.StartDistAlong),e.push(this.HorizontalLength),e.push(this.StartHeight),e.push(this.StartGradient),e}},Eb=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Horizontal=s,this.Vertical=i,this.Tag=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Eb(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Horizontal),e.push(this.Vertical),e.push(this.Tag),e}},Fb=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Fb(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}},Rb=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.OuterBoundary=s,this.InnerBoundaries=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new Rb(e,t,r,o)}ToTape(){let e=[];return e.push(this.OuterBoundary),e.push(this.InnerBoundaries),e}},Sb=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.ApplicationDeveloper=s,this.Version=i,this.ApplicationFullName=r,this.ApplicationIdentifier=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Sb(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.ApplicationDeveloper),e.push(this.Version),e.push(this.ApplicationFullName),e.push(this.ApplicationIdentifier),e}},Ob=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.AppliedValue=r,this.UnitBasis=o,this.ApplicableDate=n,this.FixedUntilDate=a,this.Category=h,this.Condition=l,this.ArithmeticOperator=u,this.Components=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Ob(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.AppliedValue),e.push(this.UnitBasis),e.push(this.ApplicableDate),e.push(this.FixedUntilDate),e.push(this.Category),e.push(this.Condition),e.push(this.ArithmeticOperator),e.push(this.Components),e}},Bb=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.Identifier=s,this.Name=i,this.Description=r,this.TimeOfApproval=o,this.Status=n,this.Level=a,this.Qualifier=h,this.RequestingApproval=l,this.GivingApproval=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Bb(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.Identifier),e.push(this.Name),e.push(this.Description),e.push(this.TimeOfApproval),e.push(this.Status),e.push(this.Level),e.push(this.Qualifier),e.push(this.RequestingApproval),e.push(this.GivingApproval),e}},Lb=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.RelatingApproval=r,this.RelatedApprovals=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Lb(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingApproval),e.push(this.RelatedApprovals),e}},Nb=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.OuterCurve=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Nb(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.OuterCurve),e}},kb=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Curve=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new kb(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Curve),e}},jb=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.OuterCurve=r,this.InnerCurves=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new jb(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.OuterCurve),e.push(this.InnerCurves),e}},Gb=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.OriginalValue=h,this.CurrentValue=l,this.TotalReplacementCost=u,this.Owner=c,this.User=p,this.ResponsiblePerson=d,this.IncorporationDate=m,this.DepreciatedValue=f}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++];return new Gb(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.OriginalValue),e.push(this.CurrentValue),e.push(this.TotalReplacementCost),e.push(this.Owner),e.push(this.User),e.push(this.ResponsiblePerson),e.push(this.IncorporationDate),e.push(this.DepreciatedValue),e}},Hb=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f,g){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.BottomFlangeWidth=o,this.OverallDepth=n,this.WebThickness=a,this.BottomFlangeThickness=h,this.BottomFlangeFilletRadius=l,this.TopFlangeWidth=u,this.TopFlangeThickness=c,this.TopFlangeFilletRadius=p,this.BottomFlangeEdgeRadius=d,this.BottomFlangeSlope=m,this.TopFlangeEdgeRadius=f,this.TopFlangeSlope=g}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++];return new Hb(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.BottomFlangeWidth),e.push(this.OverallDepth),e.push(this.WebThickness),e.push(this.BottomFlangeThickness),e.push(this.BottomFlangeFilletRadius),e.push(this.TopFlangeWidth),e.push(this.TopFlangeThickness),e.push(this.TopFlangeFilletRadius),e.push(this.BottomFlangeEdgeRadius),e.push(this.BottomFlangeSlope),e.push(this.TopFlangeEdgeRadius),e.push(this.TopFlangeSlope),e}},Vb=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Vb(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},Ub=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Ub(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},zb=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Location=s,this.Axis=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new zb(e,t,r,o)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Axis),e}},Wb=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Location=s,this.RefDirection=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new Wb(e,t,r,o)}ToTape(){let e=[];return e.push(this.Location),e.push(this.RefDirection),e}},Xb=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Location=s,this.Axis=i,this.RefDirection=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Xb(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Axis),e.push(this.RefDirection),e}},Yb=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Degree=s,this.ControlPointsList=i,this.CurveForm=r,this.ClosedCurve=o,this.SelfIntersect=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Yb(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Degree),e.push(this.ControlPointsList),e.push(this.CurveForm),e.push(this.ClosedCurve),e.push(this.SelfIntersect),e}},Kb=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.Degree=s,this.ControlPointsList=i,this.CurveForm=r,this.ClosedCurve=o,this.SelfIntersect=n,this.KnotMultiplicities=a,this.Knots=h,this.KnotSpec=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new Kb(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.Degree),e.push(this.ControlPointsList),e.push(this.CurveForm),e.push(this.ClosedCurve),e.push(this.SelfIntersect),e.push(this.KnotMultiplicities),e.push(this.Knots),e.push(this.KnotSpec),e}},Jb=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.UDegree=s,this.VDegree=i,this.ControlPointsList=r,this.SurfaceForm=o,this.UClosed=n,this.VClosed=a,this.SelfIntersect=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Jb(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.UDegree),e.push(this.VDegree),e.push(this.ControlPointsList),e.push(this.SurfaceForm),e.push(this.UClosed),e.push(this.VClosed),e.push(this.SelfIntersect),e}},Zb=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.UDegree=s,this.VDegree=i,this.ControlPointsList=r,this.SurfaceForm=o,this.UClosed=n,this.VClosed=a,this.SelfIntersect=h,this.UMultiplicities=l,this.VMultiplicities=u,this.UKnots=c,this.VKnots=p,this.KnotSpec=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new Zb(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.UDegree),e.push(this.VDegree),e.push(this.ControlPointsList),e.push(this.SurfaceForm),e.push(this.UClosed),e.push(this.VClosed),e.push(this.SelfIntersect),e.push(this.UMultiplicities),e.push(this.VMultiplicities),e.push(this.UKnots),e.push(this.VKnots),e.push(this.KnotSpec),e}},Qb=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Qb(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},qb=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new qb(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},$b=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new $b(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},ex=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new ex(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},tx=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new tx(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},sx=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.RepeatS=s,this.RepeatT=i,this.Mode=r,this.TextureTransform=o,this.Parameter=n,this.RasterFormat=a,this.RasterCode=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new sx(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.RepeatS),e.push(this.RepeatT),e.push(this.Mode),e.push(this.TextureTransform),e.push(this.Parameter),e.push(this.RasterFormat),e.push(this.RasterCode),e}},ix=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Position=s,this.XLength=i,this.YLength=r,this.ZLength=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new ix(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Position),e.push(this.XLength),e.push(this.YLength),e.push(this.ZLength),e}},rx=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new rx(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},ox=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new ox(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},nx=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Operator=s,this.FirstOperand=i,this.SecondOperand=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new nx(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Operator),e.push(this.FirstOperand),e.push(this.SecondOperand),e}},ax=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Operator=s,this.FirstOperand=i,this.SecondOperand=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new ax(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Operator),e.push(this.FirstOperand),e.push(this.SecondOperand),e}},hx=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Name=s}static FromTape(e,t,s){let i=0,r=s[i++];return new hx(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},lx=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Segments=s,this.SelfIntersect=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new lx(e,t,r,o)}ToTape(){let e=[];return e.push(this.Segments),e.push(this.SelfIntersect),e}},ux=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.Name=s,this.TranslationalStiffnessByLengthX=i,this.TranslationalStiffnessByLengthY=r,this.TranslationalStiffnessByLengthZ=o,this.RotationalStiffnessByLengthX=n,this.RotationalStiffnessByLengthY=a,this.RotationalStiffnessByLengthZ=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new ux(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.TranslationalStiffnessByLengthX),e.push(this.TranslationalStiffnessByLengthY),e.push(this.TranslationalStiffnessByLengthZ),e.push(this.RotationalStiffnessByLengthX),e.push(this.RotationalStiffnessByLengthY),e.push(this.RotationalStiffnessByLengthZ),e}},cx=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.TranslationalStiffnessByAreaX=i,this.TranslationalStiffnessByAreaY=r,this.TranslationalStiffnessByAreaZ=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new cx(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.TranslationalStiffnessByAreaX),e.push(this.TranslationalStiffnessByAreaY),e.push(this.TranslationalStiffnessByAreaZ),e}},px=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.Name=s,this.TranslationalStiffnessX=i,this.TranslationalStiffnessY=r,this.TranslationalStiffnessZ=o,this.RotationalStiffnessX=n,this.RotationalStiffnessY=a,this.RotationalStiffnessZ=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new px(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.TranslationalStiffnessX),e.push(this.TranslationalStiffnessY),e.push(this.TranslationalStiffnessZ),e.push(this.RotationalStiffnessX),e.push(this.RotationalStiffnessY),e.push(this.RotationalStiffnessZ),e}},dx=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.Name=s,this.TranslationalStiffnessX=i,this.TranslationalStiffnessY=r,this.TranslationalStiffnessZ=o,this.RotationalStiffnessX=n,this.RotationalStiffnessY=a,this.RotationalStiffnessZ=h,this.WarpingStiffness=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new dx(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.TranslationalStiffnessX),e.push(this.TranslationalStiffnessY),e.push(this.TranslationalStiffnessZ),e.push(this.RotationalStiffnessX),e.push(this.RotationalStiffnessY),e.push(this.RotationalStiffnessZ),e.push(this.WarpingStiffness),e}},mx=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new mx(e,t)}ToTape(){return[]}},fx=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new fx(e,t)}ToTape(){return[]}},gx=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Corner=s,this.XDim=i,this.YDim=r,this.ZDim=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new gx(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Corner),e.push(this.XDim),e.push(this.YDim),e.push(this.ZDim),e}},_x=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.BaseSurface=s,this.AgreementFlag=i,this.Enclosure=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new _x(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.BaseSurface),e.push(this.AgreementFlag),e.push(this.Enclosure),e}},yx=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new yx(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.PredefinedType),e}},vx=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new vx(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.PredefinedType),e}},bx=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u,this.ElevationOfRefHeight=c,this.ElevationOfTerrain=p,this.BuildingAddress=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new bx(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.ElevationOfRefHeight),e.push(this.ElevationOfTerrain),e.push(this.BuildingAddress),e}},xx=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new xx(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},Px=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Px(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},Tx=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Tx(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},wx=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new wx(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},Mx=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Mx(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},Ix=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Ix(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},Cx=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u,this.Elevation=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Cx(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.Elevation),e}},Dx=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.PredefinedType=a,this.LongName=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Dx(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.LongName),e}},Ax=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Ax(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},Ex=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Ex(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},Fx=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.Depth=o,this.Width=n,this.WallThickness=a,this.Girth=h,this.InternalFilletRadius=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new Fx(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.Width),e.push(this.WallThickness),e.push(this.Girth),e.push(this.InternalFilletRadius),e}},Rx=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Rx(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},Sx=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Sx(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},Ox=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Ox(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},Bx=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Bx(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},Lx=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Lx(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},Nx=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Nx(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},kx=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new kx(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},jx=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new jx(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},Gx=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Gx(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},Hx=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Hx(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},Vx=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Coordinates=s}static FromTape(e,t,s){let i=0,r=s[i++];return new Vx(e,t,r)}ToTape(){let e=[];return e.push(this.Coordinates),e}},Ux=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new Ux(e,t)}ToTape(){return[]}},zx=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.CoordList=s,this.TagList=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new zx(e,t,r,o)}ToTape(){let e=[];return e.push(this.CoordList),e.push(this.TagList),e}},Wx=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.CoordList=s,this.TagList=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new Wx(e,t,r,o)}ToTape(){let e=[];return e.push(this.CoordList),e.push(this.TagList),e}},Xx=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Axis1=s,this.Axis2=i,this.LocalOrigin=r,this.Scale=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Xx(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e}},Yx=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Axis1=s,this.Axis2=i,this.LocalOrigin=r,this.Scale=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Yx(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e}},Kx=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Axis1=s,this.Axis2=i,this.LocalOrigin=r,this.Scale=o,this.Scale2=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Kx(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e.push(this.Scale2),e}},Jx=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Axis1=s,this.Axis2=i,this.LocalOrigin=r,this.Scale=o,this.Axis3=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Jx(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e.push(this.Axis3),e}},Zx=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.Axis1=s,this.Axis2=i,this.LocalOrigin=r,this.Scale=o,this.Axis3=n,this.Scale2=a,this.Scale3=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Zx(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.Axis1),e.push(this.Axis2),e.push(this.LocalOrigin),e.push(this.Scale),e.push(this.Axis3),e.push(this.Scale2),e.push(this.Scale3),e}},Qx=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Curve=r,this.Thickness=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Qx(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Curve),e.push(this.Thickness),e}},qx=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new qx(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},$x=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new $x(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},eP=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new eP(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},tP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new tP(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},sP=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Position=s,this.Radius=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new sP(e,t,r,o)}ToTape(){let e=[];return e.push(this.Position),e.push(this.Radius),e}},iP=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.Radius=o,this.WallThickness=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new iP(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Radius),e.push(this.WallThickness),e}},rP=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.Radius=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new rP(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Radius),e}},oP=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.StartPoint=s,this.StartDirection=i,this.SegmentLength=r,this.Radius=o,this.IsCCW=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new oP(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.StartPoint),e.push(this.StartDirection),e.push(this.SegmentLength),e.push(this.Radius),e.push(this.IsCCW),e}},nP=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new nP(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},aP=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new aP(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},hP=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.Source=s,this.Edition=i,this.EditionDate=r,this.Name=o,this.Description=n,this.Location=a,this.ReferenceTokens=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new hP(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.Source),e.push(this.Edition),e.push(this.EditionDate),e.push(this.Name),e.push(this.Description),e.push(this.Location),e.push(this.ReferenceTokens),e}},lP=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.Location=s,this.Identification=i,this.Name=r,this.ReferencedSource=o,this.Description=n,this.Sort=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new lP(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e.push(this.ReferencedSource),e.push(this.Description),e.push(this.Sort),e}},uP=class{constructor(e,t,s){this.expressID=e,this.type=t,this.CfsFaces=s}static FromTape(e,t,s){let i=0,r=s[i++];return new uP(e,t,r)}ToTape(){let e=[];return e.push(this.CfsFaces),e}},cP=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new cP(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},pP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new pP(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},dP=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Red=i,this.Green=r,this.Blue=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new dP(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Red),e.push(this.Green),e.push(this.Blue),e}},mP=class{constructor(e,t,s){this.expressID=e,this.type=t,this.ColourList=s}static FromTape(e,t,s){let i=0,r=s[i++];return new mP(e,t,r)}ToTape(){let e=[];return e.push(this.ColourList),e}},fP=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Name=s}static FromTape(e,t,s){let i=0,r=s[i++];return new fP(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},gP=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new gP(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},_P=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new _P(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},yP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new yP(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},vP=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new vP(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},bP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new bP(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},xP=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.UsageName=r,this.HasProperties=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new xP(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.UsageName),e.push(this.HasProperties),e}},PP=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.UsageName=n,this.TemplateType=a,this.HasPropertyTemplates=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new PP(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.UsageName),e.push(this.TemplateType),e.push(this.HasPropertyTemplates),e}},TP=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Segments=s,this.SelfIntersect=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new TP(e,t,r,o)}ToTape(){let e=[];return e.push(this.Segments),e.push(this.SelfIntersect),e}},wP=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Segments=s,this.SelfIntersect=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new wP(e,t,r,o)}ToTape(){let e=[];return e.push(this.Segments),e.push(this.SelfIntersect),e}},MP=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Transition=s,this.SameSense=i,this.ParentCurve=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new MP(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Transition),e.push(this.SameSense),e.push(this.ParentCurve),e}},IP=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Profiles=r,this.Label=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new IP(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Profiles),e.push(this.Label),e}},CP=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new CP(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},DP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new DP(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},AP=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new AP(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},EP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new EP(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},FP=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Position=s}static FromTape(e,t,s){let i=0,r=s[i++];return new FP(e,t,r)}ToTape(){let e=[];return e.push(this.Position),e}},RP=class{constructor(e,t,s){this.expressID=e,this.type=t,this.CfsFaces=s}static FromTape(e,t,s){let i=0,r=s[i++];return new RP(e,t,r)}ToTape(){let e=[];return e.push(this.CfsFaces),e}},SP=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.CurveOnRelatingElement=s,this.CurveOnRelatedElement=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new SP(e,t,r,o)}ToTape(){let e=[];return e.push(this.CurveOnRelatingElement),e.push(this.CurveOnRelatedElement),e}},OP=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new OP(e,t)}ToTape(){return[]}},BP=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.PointOnRelatingElement=s,this.PointOnRelatedElement=i,this.EccentricityInX=r,this.EccentricityInY=o,this.EccentricityInZ=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new BP(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.PointOnRelatingElement),e.push(this.PointOnRelatedElement),e.push(this.EccentricityInX),e.push(this.EccentricityInY),e.push(this.EccentricityInZ),e}},LP=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.PointOnRelatingElement=s,this.PointOnRelatedElement=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new LP(e,t,r,o)}ToTape(){let e=[];return e.push(this.PointOnRelatingElement),e.push(this.PointOnRelatedElement),e}},NP=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.SurfaceOnRelatingElement=s,this.SurfaceOnRelatedElement=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new NP(e,t,r,o)}ToTape(){let e=[];return e.push(this.SurfaceOnRelatingElement),e.push(this.SurfaceOnRelatedElement),e}},kP=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.VolumeOnRelatingElement=s,this.VolumeOnRelatedElement=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new kP(e,t,r,o)}ToTape(){let e=[];return e.push(this.VolumeOnRelatingElement),e.push(this.VolumeOnRelatedElement),e}},jP=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.ConstraintGrade=r,this.ConstraintSource=o,this.CreatingActor=n,this.CreationTime=a,this.UserDefinedGrade=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new jP(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.ConstraintGrade),e.push(this.ConstraintSource),e.push(this.CreatingActor),e.push(this.CreationTime),e.push(this.UserDefinedGrade),e}},GP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Usage=l,this.BaseCosts=u,this.BaseQuantity=c,this.PredefinedType=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new GP(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},HP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u,this.BaseCosts=c,this.BaseQuantity=p,this.PredefinedType=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new HP(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},VP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Usage=l,this.BaseCosts=u,this.BaseQuantity=c,this.PredefinedType=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new VP(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},UP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u,this.BaseCosts=c,this.BaseQuantity=p,this.PredefinedType=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new UP(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},zP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Usage=l,this.BaseCosts=u,this.BaseQuantity=c,this.PredefinedType=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new zP(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},WP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u,this.BaseCosts=c,this.BaseQuantity=p,this.PredefinedType=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new WP(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},XP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Usage=l,this.BaseCosts=u,this.BaseQuantity=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new XP(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e}},YP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u,this.BaseCosts=c,this.BaseQuantity=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new YP(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e}},KP=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.LongName=a,this.Phase=h,this.RepresentationContexts=l,this.UnitsInContext=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new KP(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.Phase),e.push(this.RepresentationContexts),e.push(this.UnitsInContext),e}},JP=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Dimensions=s,this.UnitType=i,this.Name=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new JP(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Dimensions),e.push(this.UnitType),e.push(this.Name),e}},ZP=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new ZP(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e}},QP=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new QP(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},qP=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new qP(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},$P=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Dimensions=s,this.UnitType=i,this.Name=r,this.ConversionFactor=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new $P(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Dimensions),e.push(this.UnitType),e.push(this.Name),e.push(this.ConversionFactor),e}},eT=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Dimensions=s,this.UnitType=i,this.Name=r,this.ConversionFactor=o,this.ConversionOffset=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new eT(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Dimensions),e.push(this.UnitType),e.push(this.Name),e.push(this.ConversionFactor),e.push(this.ConversionOffset),e}},tT=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new tT(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},sT=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new sT(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},iT=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new iT(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},rT=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new rT(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},oT=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.SourceCRS=s,this.TargetCRS=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new oT(e,t,r,o)}ToTape(){let e=[];return e.push(this.SourceCRS),e.push(this.TargetCRS),e}},nT=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.GeodeticDatum=r,this.VerticalDatum=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new nT(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.GeodeticDatum),e.push(this.VerticalDatum),e}},aT=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.PredefinedType=h,this.CostValues=l,this.CostQuantities=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new aT(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.CostValues),e.push(this.CostQuantities),e}},hT=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.PredefinedType=h,this.Status=l,this.SubmittedOn=u,this.UpdateDate=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new hT(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.Status),e.push(this.SubmittedOn),e.push(this.UpdateDate),e}},lT=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.AppliedValue=r,this.UnitBasis=o,this.ApplicableDate=n,this.FixedUntilDate=a,this.Category=h,this.Condition=l,this.ArithmeticOperator=u,this.Components=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new lT(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.AppliedValue),e.push(this.UnitBasis),e.push(this.ApplicableDate),e.push(this.FixedUntilDate),e.push(this.Category),e.push(this.Condition),e.push(this.ArithmeticOperator),e.push(this.Components),e}},uT=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new uT(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},cT=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new cT(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},pT=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Usage=l,this.BaseCosts=u,this.BaseQuantity=c,this.PredefinedType=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new pT(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},dT=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u,this.BaseCosts=c,this.BaseQuantity=p,this.PredefinedType=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new dT(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},mT=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Position=s}static FromTape(e,t,s){let i=0,r=s[i++];return new mT(e,t,r)}ToTape(){let e=[];return e.push(this.Position),e}},fT=class{constructor(e,t,s){this.expressID=e,this.type=t,this.TreeRootExpression=s}static FromTape(e,t,s){let i=0,r=s[i++];return new fT(e,t,r)}ToTape(){let e=[];return e.push(this.TreeRootExpression),e}},gT=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.RelatingMonetaryUnit=r,this.RelatedMonetaryUnit=o,this.ExchangeRate=n,this.RateDateTime=a,this.RateSource=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new gT(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingMonetaryUnit),e.push(this.RelatedMonetaryUnit),e.push(this.ExchangeRate),e.push(this.RateDateTime),e.push(this.RateSource),e}},_T=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new _T(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},yT=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new yT(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},vT=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new vT(e,t)}ToTape(){return[]}},bT=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.BasisSurface=s,this.OuterBoundary=i,this.InnerBoundaries=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new bT(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.BasisSurface),e.push(this.OuterBoundary),e.push(this.InnerBoundaries),e}},xT=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.BasisSurface=s,this.Boundaries=i,this.ImplicitOuter=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new xT(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.BasisSurface),e.push(this.Boundaries),e.push(this.ImplicitOuter),e}},PT=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.StartPoint=s,this.StartDirection=i,this.SegmentLength=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new PT(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.StartPoint),e.push(this.StartDirection),e.push(this.SegmentLength),e}},TT=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Name=s,this.CurveFont=i,this.CurveWidth=r,this.CurveColour=o,this.ModelOrDraughting=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new TT(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.CurveFont),e.push(this.CurveWidth),e.push(this.CurveColour),e.push(this.ModelOrDraughting),e}},wT=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Name=s,this.PatternList=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new wT(e,t,r,o)}ToTape(){let e=[];return e.push(this.Name),e.push(this.PatternList),e}},MT=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Name=s,this.CurveFont=i,this.CurveFontScaling=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new MT(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.CurveFont),e.push(this.CurveFontScaling),e}},IT=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.VisibleSegmentLength=s,this.InvisibleSegmentLength=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new IT(e,t,r,o)}ToTape(){let e=[];return e.push(this.VisibleSegmentLength),e.push(this.InvisibleSegmentLength),e}},CT=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Position=s,this.Radius=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new CT(e,t,r,o)}ToTape(){let e=[];return e.push(this.Position),e.push(this.Radius),e}},DT=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new DT(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},AT=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new AT(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},ET=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new ET(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},FT=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new FT(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},RT=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.ParentProfile=r,this.Operator=o,this.Label=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new RT(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.ParentProfile),e.push(this.Operator),e.push(this.Label),e}},ST=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Elements=s,this.UnitType=i,this.UserDefinedType=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new ST(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Elements),e.push(this.UnitType),e.push(this.UserDefinedType),e}},OT=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Unit=s,this.Exponent=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new OT(e,t,r,o)}ToTape(){let e=[];return e.push(this.Unit),e.push(this.Exponent),e}},BT=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.LengthExponent=s,this.MassExponent=i,this.TimeExponent=r,this.ElectricCurrentExponent=o,this.ThermodynamicTemperatureExponent=n,this.AmountOfSubstanceExponent=a,this.LuminousIntensityExponent=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new BT(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.LengthExponent),e.push(this.MassExponent),e.push(this.TimeExponent),e.push(this.ElectricCurrentExponent),e.push(this.ThermodynamicTemperatureExponent),e.push(this.AmountOfSubstanceExponent),e.push(this.LuminousIntensityExponent),e}},LT=class{constructor(e,t,s){this.expressID=e,this.type=t,this.DirectionRatios=s}static FromTape(e,t,s){let i=0,r=s[i++];return new LT(e,t,r)}ToTape(){let e=[];return e.push(this.DirectionRatios),e}},NT=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new NT(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},kT=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new kT(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},jT=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.DistanceAlong=s,this.OffsetLateral=i,this.OffsetVertical=r,this.OffsetLongitudinal=o,this.AlongHorizontal=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new jT(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.DistanceAlong),e.push(this.OffsetLateral),e.push(this.OffsetVertical),e.push(this.OffsetLongitudinal),e.push(this.AlongHorizontal),e}},GT=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new GT(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},HT=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new HT(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},VT=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.LongName=a,this.PredefinedType=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new VT(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.PredefinedType),e}},UT=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new UT(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},zT=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new zT(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},WT=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new WT(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},XT=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new XT(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},YT=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new YT(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},KT=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new KT(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},JT=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.FlowDirection=l,this.PredefinedType=u,this.SystemType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new JT(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.FlowDirection),e.push(this.PredefinedType),e.push(this.SystemType),e}},ZT=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.LongName=a,this.PredefinedType=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new ZT(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.PredefinedType),e}},QT=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y){this.expressID=e,this.type=t,this.Identification=s,this.Name=i,this.Description=r,this.Location=o,this.Purpose=n,this.IntendedUse=a,this.Scope=h,this.Revision=l,this.DocumentOwner=u,this.Editors=c,this.CreationTime=p,this.LastRevisionTime=d,this.ElectronicFormat=m,this.ValidFrom=f,this.ValidUntil=g,this.Confidentiality=_,this.Status=y}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++];return new QT(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v,b)}ToTape(){let e=[];return e.push(this.Identification),e.push(this.Name),e.push(this.Description),e.push(this.Location),e.push(this.Purpose),e.push(this.IntendedUse),e.push(this.Scope),e.push(this.Revision),e.push(this.DocumentOwner),e.push(this.Editors),e.push(this.CreationTime),e.push(this.LastRevisionTime),e.push(this.ElectronicFormat),e.push(this.ValidFrom),e.push(this.ValidUntil),e.push(this.Confidentiality),e.push(this.Status),e}},qT=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.RelatingDocument=r,this.RelatedDocuments=o,this.RelationshipType=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new qT(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingDocument),e.push(this.RelatedDocuments),e.push(this.RelationshipType),e}},$T=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Location=s,this.Identification=i,this.Name=r,this.Description=o,this.ReferencedDocument=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new $T(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e.push(this.Description),e.push(this.ReferencedDocument),e}},ew=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.OverallHeight=u,this.OverallWidth=c,this.PredefinedType=p,this.OperationType=d,this.UserDefinedOperationType=m}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new ew(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.OverallHeight),e.push(this.OverallWidth),e.push(this.PredefinedType),e.push(this.OperationType),e.push(this.UserDefinedOperationType),e}},tw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.LiningDepth=n,this.LiningThickness=a,this.ThresholdDepth=h,this.ThresholdThickness=l,this.TransomThickness=u,this.TransomOffset=c,this.LiningOffset=p,this.ThresholdOffset=d,this.CasingThickness=m,this.CasingDepth=f,this.ShapeAspectStyle=g,this.LiningToPanelOffsetX=_,this.LiningToPanelOffsetY=y}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++];return new tw(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v,b)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.LiningDepth),e.push(this.LiningThickness),e.push(this.ThresholdDepth),e.push(this.ThresholdThickness),e.push(this.TransomThickness),e.push(this.TransomOffset),e.push(this.LiningOffset),e.push(this.ThresholdOffset),e.push(this.CasingThickness),e.push(this.CasingDepth),e.push(this.ShapeAspectStyle),e.push(this.LiningToPanelOffsetX),e.push(this.LiningToPanelOffsetY),e}},sw=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.PanelDepth=n,this.PanelOperation=a,this.PanelWidth=h,this.PanelPosition=l,this.ShapeAspectStyle=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new sw(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.PanelDepth),e.push(this.PanelOperation),e.push(this.PanelWidth),e.push(this.PanelPosition),e.push(this.ShapeAspectStyle),e}},iw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.OverallHeight=u,this.OverallWidth=c,this.PredefinedType=p,this.OperationType=d,this.UserDefinedOperationType=m}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new iw(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.OverallHeight),e.push(this.OverallWidth),e.push(this.PredefinedType),e.push(this.OperationType),e.push(this.UserDefinedOperationType),e}},rw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.OperationType=u,this.ConstructionType=c,this.ParameterTakesPrecedence=p,this.Sizeable=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new rw(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.OperationType),e.push(this.ConstructionType),e.push(this.ParameterTakesPrecedence),e.push(this.Sizeable),e}},ow=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c,this.OperationType=p,this.ParameterTakesPrecedence=d,this.UserDefinedOperationType=m}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new ow(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.OperationType),e.push(this.ParameterTakesPrecedence),e.push(this.UserDefinedOperationType),e}},nw=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Name=s}static FromTape(e,t,s){let i=0,r=s[i++];return new nw(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},aw=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Name=s}static FromTape(e,t,s){let i=0,r=s[i++];return new aw(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},hw=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new hw(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},lw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new lw(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},uw=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new uw(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},cw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new cw(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},pw=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new pw(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},dw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new dw(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},mw=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.EdgeStart=s,this.EdgeEnd=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new mw(e,t,r,o)}ToTape(){let e=[];return e.push(this.EdgeStart),e.push(this.EdgeEnd),e}},fw=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.EdgeStart=s,this.EdgeEnd=i,this.EdgeGeometry=r,this.SameSense=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new fw(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.EdgeStart),e.push(this.EdgeEnd),e.push(this.EdgeGeometry),e.push(this.SameSense),e}},gw=class{constructor(e,t,s){this.expressID=e,this.type=t,this.EdgeList=s}static FromTape(e,t,s){let i=0,r=s[i++];return new gw(e,t,r)}ToTape(){let e=[];return e.push(this.EdgeList),e}},_w=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new _w(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},yw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new yw(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},vw=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new vw(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},bw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new bw(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},xw=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new xw(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},Pw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Pw(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},Tw=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Tw(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},ww=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new ww(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},Mw=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Mw(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},Iw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Iw(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},Cw=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Cw(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},Dw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Dw(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},Aw=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new Aw(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},Ew=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.AssemblyPlace=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Ew(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.AssemblyPlace),e.push(this.PredefinedType),e}},Fw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Fw(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},Rw=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new Rw(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},Sw=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Sw(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},Ow=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.MethodOfMeasurement=n,this.Quantities=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Ow(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.MethodOfMeasurement),e.push(this.Quantities),e}},Bw=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Bw(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},Lw=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Position=s}static FromTape(e,t,s){let i=0,r=s[i++];return new Lw(e,t,r)}ToTape(){let e=[];return e.push(this.Position),e}},Nw=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Position=s,this.SemiAxis1=i,this.SemiAxis2=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Nw(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Position),e.push(this.SemiAxis1),e.push(this.SemiAxis2),e}},kw=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.SemiAxis1=o,this.SemiAxis2=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new kw(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.SemiAxis1),e.push(this.SemiAxis2),e}},jw=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new jw(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},Gw=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Gw(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},Hw=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Hw(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},Vw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Vw(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},Uw=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Uw(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},zw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new zw(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},Ww=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new Ww(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},Xw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new Xw(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},Yw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.PredefinedType=l,this.EventTriggerType=u,this.UserDefinedEventTriggerType=c,this.EventOccurenceTime=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new Yw(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.PredefinedType),e.push(this.EventTriggerType),e.push(this.UserDefinedEventTriggerType),e.push(this.EventOccurenceTime),e}},Kw=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.Name=s,this.DataOrigin=i,this.UserDefinedDataOrigin=r,this.ActualDate=o,this.EarlyDate=n,this.LateDate=a,this.ScheduleDate=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Kw(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.ActualDate),e.push(this.EarlyDate),e.push(this.LateDate),e.push(this.ScheduleDate),e}},Jw=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ProcessType=u,this.PredefinedType=c,this.EventTriggerType=p,this.UserDefinedEventTriggerType=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new Jw(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ProcessType),e.push(this.PredefinedType),e.push(this.EventTriggerType),e.push(this.UserDefinedEventTriggerType),e}},Zw=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Properties=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Zw(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Properties),e}},Qw=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new Qw(e,t)}ToTape(){return[]}},qw=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Location=s,this.Identification=i,this.Name=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new qw(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e}},$w=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.RelatingReference=r,this.RelatedResourceObjects=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new $w(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingReference),e.push(this.RelatedResourceObjects),e}},eM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new eM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.PredefinedType),e}},tM=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new tM(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e}},sM=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Location=s,this.Identification=i,this.Name=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new sM(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e}},iM=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Location=s,this.Identification=i,this.Name=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new iM(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e}},rM=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Location=s,this.Identification=i,this.Name=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new rM(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e}},oM=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.SweptArea=s,this.Position=i,this.ExtrudedDirection=r,this.Depth=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new oM(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.ExtrudedDirection),e.push(this.Depth),e}},nM=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.SweptArea=s,this.Position=i,this.ExtrudedDirection=r,this.Depth=o,this.EndSweptArea=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new nM(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.ExtrudedDirection),e.push(this.Depth),e.push(this.EndSweptArea),e}},aM=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Bounds=s}static FromTape(e,t,s){let i=0,r=s[i++];return new aM(e,t,r)}ToTape(){let e=[];return e.push(this.Bounds),e}},hM=class{constructor(e,t,s){this.expressID=e,this.type=t,this.FbsmFaces=s}static FromTape(e,t,s){let i=0,r=s[i++];return new hM(e,t,r)}ToTape(){let e=[];return e.push(this.FbsmFaces),e}},lM=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Bound=s,this.Orientation=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new lM(e,t,r,o)}ToTape(){let e=[];return e.push(this.Bound),e.push(this.Orientation),e}},uM=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Bound=s,this.Orientation=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new uM(e,t,r,o)}ToTape(){let e=[];return e.push(this.Bound),e.push(this.Orientation),e}},cM=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Bounds=s,this.FaceSurface=i,this.SameSense=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new cM(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Bounds),e.push(this.FaceSurface),e.push(this.SameSense),e}},pM=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Outer=s}static FromTape(e,t,s){let i=0,r=s[i++];return new pM(e,t,r)}ToTape(){let e=[];return e.push(this.Outer),e}},dM=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Outer=s,this.Voids=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new dM(e,t,r,o)}ToTape(){let e=[];return e.push(this.Outer),e.push(this.Voids),e}},mM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new mM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e}},fM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new fM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e}},gM=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.Name=s,this.TensionFailureX=i,this.TensionFailureY=r,this.TensionFailureZ=o,this.CompressionFailureX=n,this.CompressionFailureY=a,this.CompressionFailureZ=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new gM(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.TensionFailureX),e.push(this.TensionFailureY),e.push(this.TensionFailureZ),e.push(this.CompressionFailureX),e.push(this.CompressionFailureY),e.push(this.CompressionFailureZ),e}},_M=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new _M(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},yM=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new yM(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},vM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new vM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},bM=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new bM(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},xM=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new xM(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},PM=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new PM(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},TM=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new TM(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},wM=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Name=s,this.FillStyles=i,this.ModelorDraughting=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new wM(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.FillStyles),e.push(this.ModelorDraughting),e}},MM=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.HatchLineAppearance=s,this.StartOfNextHatchLine=i,this.PointOfReferenceHatchLine=r,this.PatternStart=o,this.HatchLineAngle=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new MM(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.HatchLineAppearance),e.push(this.StartOfNextHatchLine),e.push(this.PointOfReferenceHatchLine),e.push(this.PatternStart),e.push(this.HatchLineAngle),e}},IM=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.TilingPattern=s,this.Tiles=i,this.TilingScale=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new IM(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.TilingPattern),e.push(this.Tiles),e.push(this.TilingScale),e}},CM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new CM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},DM=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new DM(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},AM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new AM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},EM=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new EM(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},FM=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.SweptArea=s,this.Position=i,this.Directrix=r,this.StartParam=o,this.EndParam=n,this.FixedReference=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new FM(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.Directrix),e.push(this.StartParam),e.push(this.EndParam),e.push(this.FixedReference),e}},RM=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new RM(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},SM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new SM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},OM=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new OM(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},BM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new BM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},LM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new LM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},NM=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new NM(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},kM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new kM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},jM=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new jM(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},GM=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new GM(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},HM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new HM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},VM=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new VM(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},UM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new UM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},zM=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new zM(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},WM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new WM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},XM=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new XM(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},YM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new YM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},KM=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new KM(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},JM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new JM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},ZM=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new ZM(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},QM=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new QM(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},qM=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new qM(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},$M=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new $M(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},eI=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new eI(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},tI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.AssemblyPlace=c,this.PredefinedType=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new tI(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.AssemblyPlace),e.push(this.PredefinedType),e}},sI=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new sI(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},iI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new iI(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},rI=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Elements=s}static FromTape(e,t,s){let i=0,r=s[i++];return new rI(e,t,r)}ToTape(){let e=[];return e.push(this.Elements),e}},oI=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.ContextIdentifier=s,this.ContextType=i,this.CoordinateSpaceDimension=r,this.Precision=o,this.WorldCoordinateSystem=n,this.TrueNorth=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new oI(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.ContextIdentifier),e.push(this.ContextType),e.push(this.CoordinateSpaceDimension),e.push(this.Precision),e.push(this.WorldCoordinateSystem),e.push(this.TrueNorth),e}},nI=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new nI(e,t)}ToTape(){return[]}},aI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.ContextIdentifier=s,this.ContextType=i,this.CoordinateSpaceDimension=r,this.Precision=o,this.WorldCoordinateSystem=n,this.TrueNorth=a,this.ParentContext=h,this.TargetScale=l,this.TargetView=u,this.UserDefinedTargetView=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new aI(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.ContextIdentifier),e.push(this.ContextType),e.push(this.CoordinateSpaceDimension),e.push(this.Precision),e.push(this.WorldCoordinateSystem),e.push(this.TrueNorth),e.push(this.ParentContext),e.push(this.TargetScale),e.push(this.TargetView),e.push(this.UserDefinedTargetView),e}},hI=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Elements=s}static FromTape(e,t,s){let i=0,r=s[i++];return new hI(e,t,r)}ToTape(){let e=[];return e.push(this.Elements),e}},lI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.UAxes=l,this.VAxes=u,this.WAxes=c,this.PredefinedType=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new lI(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.UAxes),e.push(this.VAxes),e.push(this.WAxes),e.push(this.PredefinedType),e}},uI=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.AxisTag=s,this.AxisCurve=i,this.SameSense=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new uI(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.AxisTag),e.push(this.AxisCurve),e.push(this.SameSense),e}},cI=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.PlacementRelTo=s,this.PlacementLocation=i,this.PlacementRefDirection=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new cI(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.PlacementRelTo),e.push(this.PlacementLocation),e.push(this.PlacementRefDirection),e}},pI=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new pI(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e}},dI=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.BaseSurface=s,this.AgreementFlag=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new dI(e,t,r,o)}ToTape(){let e=[];return e.push(this.BaseSurface),e.push(this.AgreementFlag),e}},mI=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new mI(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},fI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new fI(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},gI=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new gI(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},_I=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new _I(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},yI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.OverallWidth=o,this.OverallDepth=n,this.WebThickness=a,this.FlangeThickness=h,this.FilletRadius=l,this.FlangeEdgeRadius=u,this.FlangeSlope=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new yI(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.OverallWidth),e.push(this.OverallDepth),e.push(this.WebThickness),e.push(this.FlangeThickness),e.push(this.FilletRadius),e.push(this.FlangeEdgeRadius),e.push(this.FlangeSlope),e}},vI=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.RepeatS=s,this.RepeatT=i,this.Mode=r,this.TextureTransform=o,this.Parameter=n,this.URLReference=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new vI(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.RepeatS),e.push(this.RepeatT),e.push(this.Mode),e.push(this.TextureTransform),e.push(this.Parameter),e.push(this.URLReference),e}},bI=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.MappedTo=s,this.Opacity=i,this.Colours=r,this.ColourIndex=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new bI(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.MappedTo),e.push(this.Opacity),e.push(this.Colours),e.push(this.ColourIndex),e}},xI=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Points=s,this.Segments=i,this.SelfIntersect=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new xI(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Points),e.push(this.Segments),e.push(this.SelfIntersect),e}},PI=class{constructor(e,t,s){this.expressID=e,this.type=t,this.CoordIndex=s}static FromTape(e,t,s){let i=0,r=s[i++];return new PI(e,t,r)}ToTape(){let e=[];return e.push(this.CoordIndex),e}},TI=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.CoordIndex=s,this.InnerCoordIndices=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new TI(e,t,r,o)}ToTape(){let e=[];return e.push(this.CoordIndex),e.push(this.InnerCoordIndices),e}},wI=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Maps=s,this.MappedTo=i,this.TexCoords=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new wI(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Maps),e.push(this.MappedTo),e.push(this.TexCoords),e}},MI=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Maps=s,this.MappedTo=i,this.TexCoords=r,this.TexCoordIndex=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new MI(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Maps),e.push(this.MappedTo),e.push(this.TexCoords),e.push(this.TexCoordIndex),e}},II=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new II(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},CI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new CI(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},DI=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Curve3D=s,this.AssociatedGeometry=i,this.MasterRepresentation=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new DI(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Curve3D),e.push(this.AssociatedGeometry),e.push(this.MasterRepresentation),e}},AI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.PredefinedType=a,this.Jurisdiction=h,this.ResponsiblePersons=l,this.LastUpdateDate=u,this.CurrentValue=c,this.OriginalValue=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new AI(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.Jurisdiction),e.push(this.ResponsiblePersons),e.push(this.LastUpdateDate),e.push(this.CurrentValue),e.push(this.OriginalValue),e}},EI=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.StartTime=r,this.EndTime=o,this.TimeSeriesDataType=n,this.DataOrigin=a,this.UserDefinedDataOrigin=h,this.Unit=l,this.Values=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new EI(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.StartTime),e.push(this.EndTime),e.push(this.TimeSeriesDataType),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.Unit),e.push(this.Values),e}},FI=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.TimeStamp=s,this.ListValues=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new FI(e,t,r,o)}ToTape(){let e=[];return e.push(this.TimeStamp),e.push(this.ListValues),e}},RI=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new RI(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},SI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new SI(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},OI=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.Depth=o,this.Width=n,this.Thickness=a,this.FilletRadius=h,this.EdgeRadius=l,this.LegSlope=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new OI(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.Width),e.push(this.Thickness),e.push(this.FilletRadius),e.push(this.EdgeRadius),e.push(this.LegSlope),e}},BI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Usage=l,this.BaseCosts=u,this.BaseQuantity=c,this.PredefinedType=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new BI(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},LI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u,this.BaseCosts=c,this.BaseQuantity=p,this.PredefinedType=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new LI(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},NI=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Name=s,this.DataOrigin=i,this.UserDefinedDataOrigin=r,this.LagValue=o,this.DurationType=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new NI(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.LagValue),e.push(this.DurationType),e}},kI=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new kI(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},jI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new jI(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},GI=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.Name=s,this.Version=i,this.Publisher=r,this.VersionDate=o,this.Location=n,this.Description=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new GI(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Version),e.push(this.Publisher),e.push(this.VersionDate),e.push(this.Location),e.push(this.Description),e}},HI=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.Location=s,this.Identification=i,this.Name=r,this.Description=o,this.Language=n,this.ReferencedLibrary=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new HI(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.Location),e.push(this.Identification),e.push(this.Name),e.push(this.Description),e.push(this.Language),e.push(this.ReferencedLibrary),e}},VI=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.MainPlaneAngle=s,this.SecondaryPlaneAngle=i,this.LuminousIntensity=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new VI(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.MainPlaneAngle),e.push(this.SecondaryPlaneAngle),e.push(this.LuminousIntensity),e}},UI=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new UI(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},zI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new zI(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},WI=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.LightDistributionCurve=s,this.DistributionData=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new WI(e,t,r,o)}ToTape(){let e=[];return e.push(this.LightDistributionCurve),e.push(this.DistributionData),e}},XI=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.LightColour=i,this.AmbientIntensity=r,this.Intensity=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new XI(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e}},YI=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.LightColour=i,this.AmbientIntensity=r,this.Intensity=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new YI(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e}},KI=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Name=s,this.LightColour=i,this.AmbientIntensity=r,this.Intensity=o,this.Orientation=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new KI(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e.push(this.Orientation),e}},JI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.Name=s,this.LightColour=i,this.AmbientIntensity=r,this.Intensity=o,this.Position=n,this.ColourAppearance=a,this.ColourTemperature=h,this.LuminousFlux=l,this.LightEmissionSource=u,this.LightDistributionDataSource=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new JI(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e.push(this.Position),e.push(this.ColourAppearance),e.push(this.ColourTemperature),e.push(this.LuminousFlux),e.push(this.LightEmissionSource),e.push(this.LightDistributionDataSource),e}},ZI=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.Name=s,this.LightColour=i,this.AmbientIntensity=r,this.Intensity=o,this.Position=n,this.Radius=a,this.ConstantAttenuation=h,this.DistanceAttenuation=l,this.QuadricAttenuation=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new ZI(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e.push(this.Position),e.push(this.Radius),e.push(this.ConstantAttenuation),e.push(this.DistanceAttenuation),e.push(this.QuadricAttenuation),e}},QI=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m){this.expressID=e,this.type=t,this.Name=s,this.LightColour=i,this.AmbientIntensity=r,this.Intensity=o,this.Position=n,this.Radius=a,this.ConstantAttenuation=h,this.DistanceAttenuation=l,this.QuadricAttenuation=u,this.Orientation=c,this.ConcentrationExponent=p,this.SpreadAngle=d,this.BeamWidthAngle=m}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new QI(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.Name),e.push(this.LightColour),e.push(this.AmbientIntensity),e.push(this.Intensity),e.push(this.Position),e.push(this.Radius),e.push(this.ConstantAttenuation),e.push(this.DistanceAttenuation),e.push(this.QuadricAttenuation),e.push(this.Orientation),e.push(this.ConcentrationExponent),e.push(this.SpreadAngle),e.push(this.BeamWidthAngle),e}},qI=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Pnt=s,this.Dir=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new qI(e,t,r,o)}ToTape(){let e=[];return e.push(this.Pnt),e.push(this.Dir),e}},$I=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.StartPoint=s,this.StartDirection=i,this.SegmentLength=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new $I(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.StartPoint),e.push(this.StartDirection),e.push(this.SegmentLength),e}},eC=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.PlacementRelTo=s,this.PlacementMeasuredAlong=i,this.Distance=r,this.Orientation=o,this.CartesianPosition=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new eC(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.PlacementRelTo),e.push(this.PlacementMeasuredAlong),e.push(this.Distance),e.push(this.Orientation),e.push(this.CartesianPosition),e}},tC=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Axis=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new tC(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Axis),e}},sC=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.PlacementRelTo=s,this.RelativePlacement=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new sC(e,t,r,o)}ToTape(){let e=[];return e.push(this.PlacementRelTo),e.push(this.RelativePlacement),e}},iC=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new iC(e,t)}ToTape(){return[]}},rC=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Outer=s}static FromTape(e,t,s){let i=0,r=s[i++];return new rC(e,t,r)}ToTape(){let e=[];return e.push(this.Outer),e}},oC=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.SourceCRS=s,this.TargetCRS=i,this.Eastings=r,this.Northings=o,this.OrthogonalHeight=n,this.XAxisAbscissa=a,this.XAxisOrdinate=h,this.Scale=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new oC(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.SourceCRS),e.push(this.TargetCRS),e.push(this.Eastings),e.push(this.Northings),e.push(this.OrthogonalHeight),e.push(this.XAxisAbscissa),e.push(this.XAxisOrdinate),e.push(this.Scale),e}},nC=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.MappingSource=s,this.MappingTarget=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new nC(e,t,r,o)}ToTape(){let e=[];return e.push(this.MappingSource),e.push(this.MappingTarget),e}},aC=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Category=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new aC(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Category),e}},hC=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.MaterialClassifications=s,this.ClassifiedMaterial=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new hC(e,t,r,o)}ToTape(){let e=[];return e.push(this.MaterialClassifications),e.push(this.ClassifiedMaterial),e}},lC=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Material=r,this.Fraction=o,this.Category=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new lC(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Material),e.push(this.Fraction),e.push(this.Category),e}},uC=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.MaterialConstituents=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new uC(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.MaterialConstituents),e}},cC=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new cC(e,t)}ToTape(){return[]}},pC=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Representations=r,this.RepresentedMaterial=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new pC(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Representations),e.push(this.RepresentedMaterial),e}},dC=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.Material=s,this.LayerThickness=i,this.IsVentilated=r,this.Name=o,this.Description=n,this.Category=a,this.Priority=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new dC(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.Material),e.push(this.LayerThickness),e.push(this.IsVentilated),e.push(this.Name),e.push(this.Description),e.push(this.Category),e.push(this.Priority),e}},mC=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.MaterialLayers=s,this.LayerSetName=i,this.Description=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new mC(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.MaterialLayers),e.push(this.LayerSetName),e.push(this.Description),e}},fC=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.ForLayerSet=s,this.LayerSetDirection=i,this.DirectionSense=r,this.OffsetFromReferenceLine=o,this.ReferenceExtent=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new fC(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.ForLayerSet),e.push(this.LayerSetDirection),e.push(this.DirectionSense),e.push(this.OffsetFromReferenceLine),e.push(this.ReferenceExtent),e}},gC=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.Material=s,this.LayerThickness=i,this.IsVentilated=r,this.Name=o,this.Description=n,this.Category=a,this.Priority=h,this.OffsetDirection=l,this.OffsetValues=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new gC(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.Material),e.push(this.LayerThickness),e.push(this.IsVentilated),e.push(this.Name),e.push(this.Description),e.push(this.Category),e.push(this.Priority),e.push(this.OffsetDirection),e.push(this.OffsetValues),e}},_C=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Materials=s}static FromTape(e,t,s){let i=0,r=s[i++];return new _C(e,t,r)}ToTape(){let e=[];return e.push(this.Materials),e}},yC=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Material=r,this.Profile=o,this.Priority=n,this.Category=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new yC(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Material),e.push(this.Profile),e.push(this.Priority),e.push(this.Category),e}},vC=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.MaterialProfiles=r,this.CompositeProfile=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new vC(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.MaterialProfiles),e.push(this.CompositeProfile),e}},bC=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.ForProfileSet=s,this.CardinalPoint=i,this.ReferenceExtent=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new bC(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.ForProfileSet),e.push(this.CardinalPoint),e.push(this.ReferenceExtent),e}},xC=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.ForProfileSet=s,this.CardinalPoint=i,this.ReferenceExtent=r,this.ForProfileEndSet=o,this.CardinalEndPoint=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new xC(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.ForProfileSet),e.push(this.CardinalPoint),e.push(this.ReferenceExtent),e.push(this.ForProfileEndSet),e.push(this.CardinalEndPoint),e}},PC=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Material=r,this.Profile=o,this.Priority=n,this.Category=a,this.OffsetValues=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new PC(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Material),e.push(this.Profile),e.push(this.Priority),e.push(this.Category),e.push(this.OffsetValues),e}},TC=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Properties=r,this.Material=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new TC(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Properties),e.push(this.Material),e}},wC=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.RelatingMaterial=r,this.RelatedMaterials=o,this.Expression=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new wC(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingMaterial),e.push(this.RelatedMaterials),e.push(this.Expression),e}},MC=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new MC(e,t)}ToTape(){return[]}},IC=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.ValueComponent=s,this.UnitComponent=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new IC(e,t,r,o)}ToTape(){let e=[];return e.push(this.ValueComponent),e.push(this.UnitComponent),e}},CC=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.NominalDiameter=u,this.NominalLength=c,this.PredefinedType=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new CC(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.NominalDiameter),e.push(this.NominalLength),e.push(this.PredefinedType),e}},DC=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c,this.NominalDiameter=p,this.NominalLength=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new DC(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.NominalDiameter),e.push(this.NominalLength),e}},AC=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new AC(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},EC=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new EC(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},FC=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new FC(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},RC=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new RC(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},SC=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new SC(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},OC=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.ConstraintGrade=r,this.ConstraintSource=o,this.CreatingActor=n,this.CreationTime=a,this.UserDefinedGrade=h,this.Benchmark=l,this.ValueSource=u,this.DataValue=c,this.ReferencePath=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new OC(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.ConstraintGrade),e.push(this.ConstraintSource),e.push(this.CreatingActor),e.push(this.CreationTime),e.push(this.UserDefinedGrade),e.push(this.Benchmark),e.push(this.ValueSource),e.push(this.DataValue),e.push(this.ReferencePath),e}},BC=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.ParentProfile=r,this.Operator=o,this.Label=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new BC(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.ParentProfile),e.push(this.Operator),e.push(this.Label),e}},LC=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Currency=s}static FromTape(e,t,s){let i=0,r=s[i++];return new LC(e,t,r)}ToTape(){let e=[];return e.push(this.Currency),e}},NC=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new NC(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},kC=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new kC(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},jC=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Dimensions=s,this.UnitType=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new jC(e,t,r,o)}ToTape(){let e=[];return e.push(this.Dimensions),e.push(this.UnitType),e}},GC=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new GC(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e}},HC=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new HC(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},VC=class{constructor(e,t,s){this.expressID=e,this.type=t,this.PlacementRelTo=s}static FromTape(e,t,s){let i=0,r=s[i++];return new VC(e,t,r)}ToTape(){let e=[];return e.push(this.PlacementRelTo),e}},UC=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.ConstraintGrade=r,this.ConstraintSource=o,this.CreatingActor=n,this.CreationTime=a,this.UserDefinedGrade=h,this.BenchmarkValues=l,this.LogicalAggregator=u,this.ObjectiveQualifier=c,this.UserDefinedQualifier=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new UC(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.ConstraintGrade),e.push(this.ConstraintSource),e.push(this.CreatingActor),e.push(this.CreationTime),e.push(this.UserDefinedGrade),e.push(this.BenchmarkValues),e.push(this.LogicalAggregator),e.push(this.ObjectiveQualifier),e.push(this.UserDefinedQualifier),e}},zC=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.TheActor=a,this.PredefinedType=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new zC(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.TheActor),e.push(this.PredefinedType),e}},WC=class{constructor(e,t,s){this.expressID=e,this.type=t,this.BasisCurve=s}static FromTape(e,t,s){let i=0,r=s[i++];return new WC(e,t,r)}ToTape(){let e=[];return e.push(this.BasisCurve),e}},XC=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.BasisCurve=s,this.Distance=i,this.SelfIntersect=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new XC(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.BasisCurve),e.push(this.Distance),e.push(this.SelfIntersect),e}},YC=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.BasisCurve=s,this.Distance=i,this.SelfIntersect=r,this.RefDirection=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new YC(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.BasisCurve),e.push(this.Distance),e.push(this.SelfIntersect),e.push(this.RefDirection),e}},KC=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.BasisCurve=s,this.OffsetValues=i,this.Tag=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new KC(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.BasisCurve),e.push(this.OffsetValues),e.push(this.Tag),e}},JC=class{constructor(e,t,s){this.expressID=e,this.type=t,this.CfsFaces=s}static FromTape(e,t,s){let i=0,r=s[i++];return new JC(e,t,r)}ToTape(){let e=[];return e.push(this.CfsFaces),e}},ZC=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new ZC(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},QC=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new QC(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},qC=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Identification=s,this.Name=i,this.Description=r,this.Roles=o,this.Addresses=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new qC(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Identification),e.push(this.Name),e.push(this.Description),e.push(this.Roles),e.push(this.Addresses),e}},$C=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.RelatingOrganization=r,this.RelatedOrganizations=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new $C(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingOrganization),e.push(this.RelatedOrganizations),e}},eD=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.LateralAxisDirection=s,this.VerticalAxisDirection=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new eD(e,t,r,o)}ToTape(){let e=[];return e.push(this.LateralAxisDirection),e.push(this.VerticalAxisDirection),e}},tD=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.EdgeStart=s,this.EdgeEnd=i,this.EdgeElement=r,this.Orientation=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new tD(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.EdgeStart),e.push(this.EdgeEnd),e.push(this.EdgeElement),e.push(this.Orientation),e}},sD=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Segments=s,this.SelfIntersect=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new sD(e,t,r,o)}ToTape(){let e=[];return e.push(this.Segments),e.push(this.SelfIntersect),e}},iD=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new iD(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},rD=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new rD(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},oD=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.OwningUser=s,this.OwningApplication=i,this.State=r,this.ChangeAction=o,this.LastModifiedDate=n,this.LastModifyingUser=a,this.LastModifyingApplication=h,this.CreationDate=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new oD(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.OwningUser),e.push(this.OwningApplication),e.push(this.State),e.push(this.ChangeAction),e.push(this.LastModifiedDate),e.push(this.LastModifyingUser),e.push(this.LastModifyingApplication),e.push(this.CreationDate),e}},nD=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new nD(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e}},aD=class{constructor(e,t,s){this.expressID=e,this.type=t,this.EdgeList=s}static FromTape(e,t,s){let i=0,r=s[i++];return new aD(e,t,r)}ToTape(){let e=[];return e.push(this.EdgeList),e}},hD=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.BasisSurface=s,this.ReferenceCurve=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new hD(e,t,r,o)}ToTape(){let e=[];return e.push(this.BasisSurface),e.push(this.ReferenceCurve),e}},lD=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LifeCyclePhase=h,this.PredefinedType=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new lD(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LifeCyclePhase),e.push(this.PredefinedType),e}},uD=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.OperationType=n,this.PanelPosition=a,this.FrameDepth=h,this.FrameThickness=l,this.ShapeAspectStyle=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new uD(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.OperationType),e.push(this.PanelPosition),e.push(this.FrameDepth),e.push(this.FrameThickness),e.push(this.ShapeAspectStyle),e}},cD=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.PredefinedType=h,this.Status=l,this.LongDescription=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new cD(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.Status),e.push(this.LongDescription),e}},pD=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.Identification=s,this.FamilyName=i,this.GivenName=r,this.MiddleNames=o,this.PrefixTitles=n,this.SuffixTitles=a,this.Roles=h,this.Addresses=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new pD(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.Identification),e.push(this.FamilyName),e.push(this.GivenName),e.push(this.MiddleNames),e.push(this.PrefixTitles),e.push(this.SuffixTitles),e.push(this.Roles),e.push(this.Addresses),e}},dD=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.ThePerson=s,this.TheOrganization=i,this.Roles=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new dD(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.ThePerson),e.push(this.TheOrganization),e.push(this.Roles),e}},mD=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.HasQuantities=r,this.Discrimination=o,this.Quality=n,this.Usage=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new mD(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.HasQuantities),e.push(this.Discrimination),e.push(this.Quality),e.push(this.Usage),e}},fD=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Name=s,this.Description=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new fD(e,t,r,o)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e}},gD=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Unit=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new gD(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e}},_D=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u,this.ConstructionType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new _D(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e.push(this.ConstructionType),e}},yD=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new yD(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},vD=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new vD(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},bD=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new bD(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},xD=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new xD(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},PD=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new PD(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},TD=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.RepeatS=s,this.RepeatT=i,this.Mode=r,this.TextureTransform=o,this.Parameter=n,this.Width=a,this.Height=h,this.ColourComponents=l,this.Pixel=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new TD(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.RepeatS),e.push(this.RepeatT),e.push(this.Mode),e.push(this.TextureTransform),e.push(this.Parameter),e.push(this.Width),e.push(this.Height),e.push(this.ColourComponents),e.push(this.Pixel),e}},wD=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Location=s}static FromTape(e,t,s){let i=0,r=s[i++];return new wD(e,t,r)}ToTape(){let e=[];return e.push(this.Location),e}},MD=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.SizeInX=s,this.SizeInY=i,this.Placement=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new MD(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.SizeInX),e.push(this.SizeInY),e.push(this.Placement),e}},ID=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.SizeInX=s,this.SizeInY=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new ID(e,t,r,o)}ToTape(){let e=[];return e.push(this.SizeInX),e.push(this.SizeInY),e}},CD=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Position=s}static FromTape(e,t,s){let i=0,r=s[i++];return new CD(e,t,r)}ToTape(){let e=[];return e.push(this.Position),e}},DD=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new DD(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},AD=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new AD(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},ED=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new ED(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},FD=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new FD(e,t)}ToTape(){return[]}},RD=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.BasisCurve=s,this.PointParameter=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new RD(e,t,r,o)}ToTape(){let e=[];return e.push(this.BasisCurve),e.push(this.PointParameter),e}},SD=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.BasisSurface=s,this.PointParameterU=i,this.PointParameterV=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new SD(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.BasisSurface),e.push(this.PointParameterU),e.push(this.PointParameterV),e}},OD=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Polygon=s}static FromTape(e,t,s){let i=0,r=s[i++];return new OD(e,t,r)}ToTape(){let e=[];return e.push(this.Polygon),e}},BD=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.BaseSurface=s,this.AgreementFlag=i,this.Position=r,this.PolygonalBoundary=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new BD(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.BaseSurface),e.push(this.AgreementFlag),e.push(this.Position),e.push(this.PolygonalBoundary),e}},LD=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Coordinates=s,this.Closed=i,this.Faces=r,this.PnIndex=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new LD(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Coordinates),e.push(this.Closed),e.push(this.Faces),e.push(this.PnIndex),e}},ND=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Points=s}static FromTape(e,t,s){let i=0,r=s[i++];return new ND(e,t,r)}ToTape(){let e=[];return e.push(this.Points),e}},kD=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new kD(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}},jD=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new jD(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}},GD=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.Purpose=s,this.Description=i,this.UserDefinedPurpose=r,this.InternalLocation=o,this.AddressLines=n,this.PostalBox=a,this.Town=h,this.Region=l,this.PostalCode=u,this.Country=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new GD(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.Purpose),e.push(this.Description),e.push(this.UserDefinedPurpose),e.push(this.InternalLocation),e.push(this.AddressLines),e.push(this.PostalBox),e.push(this.Town),e.push(this.Region),e.push(this.PostalCode),e.push(this.Country),e}},HD=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Name=s}static FromTape(e,t,s){let i=0,r=s[i++];return new HD(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},VD=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Name=s}static FromTape(e,t,s){let i=0,r=s[i++];return new VD(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},UD=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Name=s}static FromTape(e,t,s){let i=0,r=s[i++];return new UD(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},zD=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new zD(e,t)}ToTape(){return[]}},WD=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new WD(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},XD=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Name=s}static FromTape(e,t,s){let i=0,r=s[i++];return new XD(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},YD=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new YD(e,t)}ToTape(){return[]}},KD=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.AssignedItems=r,this.Identifier=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new KD(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.AssignedItems),e.push(this.Identifier),e}},JD=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.AssignedItems=r,this.Identifier=o,this.LayerOn=n,this.LayerFrozen=a,this.LayerBlocked=h,this.LayerStyles=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new JD(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.AssignedItems),e.push(this.Identifier),e.push(this.LayerOn),e.push(this.LayerFrozen),e.push(this.LayerBlocked),e.push(this.LayerStyles),e}},ZD=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Name=s}static FromTape(e,t,s){let i=0,r=s[i++];return new ZD(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},QD=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Styles=s}static FromTape(e,t,s){let i=0,r=s[i++];return new QD(e,t,r)}ToTape(){let e=[];return e.push(this.Styles),e}},qD=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.PredefinedType=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new qD(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.PredefinedType),e}},$D=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ProcessType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new $D(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ProcessType),e.push(this.PredefinedType),e}},eA=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new eA(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e}},tA=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new tA(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}},sA=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Representations=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new sA(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Representations),e}},iA=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Representations=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new iA(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Representations),e}},rA=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new rA(e,t,r,o)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e}},oA=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Properties=r,this.ProfileDefinition=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new oA(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Properties),e.push(this.ProfileDefinition),e}},nA=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.LongName=a,this.Phase=h,this.RepresentationContexts=l,this.UnitsInContext=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new nA(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.Phase),e.push(this.RepresentationContexts),e.push(this.UnitsInContext),e}},aA=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.LongName=a,this.Phase=h,this.RepresentationContexts=l,this.UnitsInContext=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new aA(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e.push(this.Phase),e.push(this.RepresentationContexts),e.push(this.UnitsInContext),e}},hA=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.PredefinedType=h,this.Status=l,this.LongDescription=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new hA(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.PredefinedType),e.push(this.Status),e.push(this.LongDescription),e}},lA=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.GeodeticDatum=r,this.VerticalDatum=o,this.MapProjection=n,this.MapZone=a,this.MapUnit=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new lA(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.GeodeticDatum),e.push(this.VerticalDatum),e.push(this.MapProjection),e.push(this.MapZone),e.push(this.MapUnit),e}},uA=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new uA(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},cA=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Name=s,this.Description=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new cA(e,t,r,o)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e}},pA=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new pA(e,t)}ToTape(){return[]}},dA=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.UpperBoundValue=r,this.LowerBoundValue=o,this.Unit=n,this.SetPointValue=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new dA(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.UpperBoundValue),e.push(this.LowerBoundValue),e.push(this.Unit),e.push(this.SetPointValue),e}},mA=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new mA(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},fA=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.DependingProperty=r,this.DependantProperty=o,this.Expression=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new fA(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.DependingProperty),e.push(this.DependantProperty),e.push(this.Expression),e}},gA=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.EnumerationValues=r,this.EnumerationReference=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new gA(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.EnumerationValues),e.push(this.EnumerationReference),e}},_A=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Name=s,this.EnumerationValues=i,this.Unit=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new _A(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.EnumerationValues),e.push(this.Unit),e}},yA=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.ListValues=r,this.Unit=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new yA(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.ListValues),e.push(this.Unit),e}},vA=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.UsageName=r,this.PropertyReference=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new vA(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.UsageName),e.push(this.PropertyReference),e}},bA=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.HasProperties=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new bA(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.HasProperties),e}},xA=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new xA(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},PA=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.TemplateType=n,this.ApplicableEntity=a,this.HasPropertyTemplates=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new PA(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.TemplateType),e.push(this.ApplicableEntity),e.push(this.HasPropertyTemplates),e}},TA=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.NominalValue=r,this.Unit=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new TA(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.NominalValue),e.push(this.Unit),e}},wA=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.DefiningValues=r,this.DefinedValues=o,this.Expression=n,this.DefiningUnit=a,this.DefinedUnit=h,this.CurveInterpolation=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new wA(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.DefiningValues),e.push(this.DefinedValues),e.push(this.Expression),e.push(this.DefiningUnit),e.push(this.DefinedUnit),e.push(this.CurveInterpolation),e}},MA=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new MA(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},IA=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new IA(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},CA=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new CA(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},DA=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new DA(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},AA=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new AA(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},EA=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new EA(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},FA=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.ProxyType=l,this.Tag=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new FA(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.ProxyType),e.push(this.Tag),e}},RA=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new RA(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},SA=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new SA(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},OA=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Unit=r,this.AreaValue=o,this.Formula=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new OA(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.AreaValue),e.push(this.Formula),e}},BA=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Unit=r,this.CountValue=o,this.Formula=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new BA(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.CountValue),e.push(this.Formula),e}},LA=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Unit=r,this.LengthValue=o,this.Formula=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new LA(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.LengthValue),e.push(this.Formula),e}},NA=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new NA(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},kA=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Unit=r,this.TimeValue=o,this.Formula=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new kA(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.TimeValue),e.push(this.Formula),e}},jA=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Unit=r,this.VolumeValue=o,this.Formula=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new jA(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.VolumeValue),e.push(this.Formula),e}},GA=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.Unit=r,this.WeightValue=o,this.Formula=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new GA(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.WeightValue),e.push(this.Formula),e}},HA=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new HA(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},VA=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new VA(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},UA=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new UA(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},zA=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new zA(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},WA=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new WA(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},XA=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new XA(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},YA=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.Degree=s,this.ControlPointsList=i,this.CurveForm=r,this.ClosedCurve=o,this.SelfIntersect=n,this.KnotMultiplicities=a,this.Knots=h,this.KnotSpec=l,this.WeightsData=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new YA(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.Degree),e.push(this.ControlPointsList),e.push(this.CurveForm),e.push(this.ClosedCurve),e.push(this.SelfIntersect),e.push(this.KnotMultiplicities),e.push(this.Knots),e.push(this.KnotSpec),e.push(this.WeightsData),e}},KA=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m){this.expressID=e,this.type=t,this.UDegree=s,this.VDegree=i,this.ControlPointsList=r,this.SurfaceForm=o,this.UClosed=n,this.VClosed=a,this.SelfIntersect=h,this.UMultiplicities=l,this.VMultiplicities=u,this.UKnots=c,this.VKnots=p,this.KnotSpec=d,this.WeightsData=m}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new KA(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.UDegree),e.push(this.VDegree),e.push(this.ControlPointsList),e.push(this.SurfaceForm),e.push(this.UClosed),e.push(this.VClosed),e.push(this.SelfIntersect),e.push(this.UMultiplicities),e.push(this.VMultiplicities),e.push(this.UKnots),e.push(this.VKnots),e.push(this.KnotSpec),e.push(this.WeightsData),e}},JA=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.XDim=o,this.YDim=n,this.WallThickness=a,this.InnerFilletRadius=h,this.OuterFilletRadius=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new JA(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.XDim),e.push(this.YDim),e.push(this.WallThickness),e.push(this.InnerFilletRadius),e.push(this.OuterFilletRadius),e}},ZA=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.XDim=o,this.YDim=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new ZA(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.XDim),e.push(this.YDim),e}},QA=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Position=s,this.XLength=i,this.YLength=r,this.Height=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new QA(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Position),e.push(this.XLength),e.push(this.YLength),e.push(this.Height),e}},qA=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.BasisSurface=s,this.U1=i,this.V1=r,this.U2=o,this.V2=n,this.Usense=a,this.Vsense=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new qA(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.BasisSurface),e.push(this.U1),e.push(this.V1),e.push(this.U2),e.push(this.V2),e.push(this.Usense),e.push(this.Vsense),e}},$A=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.RecurrenceType=s,this.DayComponent=i,this.WeekdayComponent=r,this.MonthComponent=o,this.Position=n,this.Interval=a,this.Occurrences=h,this.TimePeriods=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new $A(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.RecurrenceType),e.push(this.DayComponent),e.push(this.WeekdayComponent),e.push(this.MonthComponent),e.push(this.Position),e.push(this.Interval),e.push(this.Occurrences),e.push(this.TimePeriods),e}},eE=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.TypeIdentifier=s,this.AttributeIdentifier=i,this.InstanceName=r,this.ListPositions=o,this.InnerReference=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new eE(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.TypeIdentifier),e.push(this.AttributeIdentifier),e.push(this.InstanceName),e.push(this.ListPositions),e.push(this.InnerReference),e}},tE=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.PredefinedType=l,this.RestartDistance=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new tE(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.RestartDistance),e}},sE=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.StartTime=r,this.EndTime=o,this.TimeSeriesDataType=n,this.DataOrigin=a,this.UserDefinedDataOrigin=h,this.Unit=l,this.TimeStep=u,this.Values=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new sE(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.StartTime),e.push(this.EndTime),e.push(this.TimeSeriesDataType),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.Unit),e.push(this.TimeStep),e.push(this.Values),e}},iE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.TotalCrossSectionArea=s,this.SteelGrade=i,this.BarSurface=r,this.EffectiveDepth=o,this.NominalBarDiameter=n,this.BarCount=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new iE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.TotalCrossSectionArea),e.push(this.SteelGrade),e.push(this.BarSurface),e.push(this.EffectiveDepth),e.push(this.NominalBarDiameter),e.push(this.BarCount),e}},rE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.DefinitionType=n,this.ReinforcementSectionDefinitions=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new rE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.DefinitionType),e.push(this.ReinforcementSectionDefinitions),e}},oE=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.SteelGrade=u,this.NominalDiameter=c,this.CrossSectionArea=p,this.BarLength=d,this.PredefinedType=m,this.BarSurface=f}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++];return new oE(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.NominalDiameter),e.push(this.CrossSectionArea),e.push(this.BarLength),e.push(this.PredefinedType),e.push(this.BarSurface),e}},nE=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f,g,_){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c,this.NominalDiameter=p,this.CrossSectionArea=d,this.BarLength=m,this.BarSurface=f,this.BendingShapeCode=g,this.BendingParameters=_}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++];return new nE(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.NominalDiameter),e.push(this.CrossSectionArea),e.push(this.BarLength),e.push(this.BarSurface),e.push(this.BendingShapeCode),e.push(this.BendingParameters),e}},aE=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.SteelGrade=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new aE(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e}},hE=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new hE(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},lE=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.SteelGrade=u,this.MeshLength=c,this.MeshWidth=p,this.LongitudinalBarNominalDiameter=d,this.TransverseBarNominalDiameter=m,this.LongitudinalBarCrossSectionArea=f,this.TransverseBarCrossSectionArea=g,this.LongitudinalBarSpacing=_,this.TransverseBarSpacing=y,this.PredefinedType=v}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++],x=s[i++];return new lE(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v,b,x)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.MeshLength),e.push(this.MeshWidth),e.push(this.LongitudinalBarNominalDiameter),e.push(this.TransverseBarNominalDiameter),e.push(this.LongitudinalBarCrossSectionArea),e.push(this.TransverseBarCrossSectionArea),e.push(this.LongitudinalBarSpacing),e.push(this.TransverseBarSpacing),e.push(this.PredefinedType),e}},uE=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v,b,x){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c,this.MeshLength=p,this.MeshWidth=d,this.LongitudinalBarNominalDiameter=m,this.TransverseBarNominalDiameter=f,this.LongitudinalBarCrossSectionArea=g,this.TransverseBarCrossSectionArea=_,this.LongitudinalBarSpacing=y,this.TransverseBarSpacing=v,this.BendingShapeCode=b,this.BendingParameters=x}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++],x=s[i++],P=s[i++],T=s[i++];return new uE(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v,b,x,P,T)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.MeshLength),e.push(this.MeshWidth),e.push(this.LongitudinalBarNominalDiameter),e.push(this.TransverseBarNominalDiameter),e.push(this.LongitudinalBarCrossSectionArea),e.push(this.TransverseBarCrossSectionArea),e.push(this.LongitudinalBarSpacing),e.push(this.TransverseBarSpacing),e.push(this.BendingShapeCode),e.push(this.BendingParameters),e}},cE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingObject=n,this.RelatedObjects=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new cE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingObject),e.push(this.RelatedObjects),e}},pE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new pE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e}},dE=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a,this.RelatingActor=h,this.ActingRole=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new dE(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingActor),e.push(this.ActingRole),e}},mE=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a,this.RelatingControl=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new mE(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingControl),e}},fE=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a,this.RelatingGroup=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new fE(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingGroup),e}},gE=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a,this.RelatingGroup=h,this.Factor=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new gE(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingGroup),e.push(this.Factor),e}},_E=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a,this.RelatingProcess=h,this.QuantityInProcess=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new _E(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingProcess),e.push(this.QuantityInProcess),e}},yE=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a,this.RelatingProduct=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new yE(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingProduct),e}},vE=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a,this.RelatingResource=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new vE(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatedObjectsType),e.push(this.RelatingResource),e}},bE=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new bE(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e}},xE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingApproval=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new xE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingApproval),e}},PE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingClassification=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new PE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingClassification),e}},TE=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.Intent=a,this.RelatingConstraint=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new TE(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.Intent),e.push(this.RelatingConstraint),e}},wE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingDocument=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new wE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingDocument),e}},ME=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingLibrary=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new ME(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingLibrary),e}},IE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingMaterial=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new IE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingMaterial),e}},CE=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new CE(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},DE=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ConnectionGeometry=n,this.RelatingElement=a,this.RelatedElement=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new DE(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ConnectionGeometry),e.push(this.RelatingElement),e.push(this.RelatedElement),e}},AE=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ConnectionGeometry=n,this.RelatingElement=a,this.RelatedElement=h,this.RelatingPriorities=l,this.RelatedPriorities=u,this.RelatedConnectionType=c,this.RelatingConnectionType=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new AE(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ConnectionGeometry),e.push(this.RelatingElement),e.push(this.RelatedElement),e.push(this.RelatingPriorities),e.push(this.RelatedPriorities),e.push(this.RelatedConnectionType),e.push(this.RelatingConnectionType),e}},EE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingPort=n,this.RelatedElement=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new EE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingPort),e.push(this.RelatedElement),e}},FE=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingPort=n,this.RelatedPort=a,this.RealizingElement=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new FE(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingPort),e.push(this.RelatedPort),e.push(this.RealizingElement),e}},RE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingElement=n,this.RelatedStructuralActivity=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new RE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingElement),e.push(this.RelatedStructuralActivity),e}},SE=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingStructuralMember=n,this.RelatedStructuralConnection=a,this.AppliedCondition=h,this.AdditionalConditions=l,this.SupportedLength=u,this.ConditionCoordinateSystem=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new SE(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingStructuralMember),e.push(this.RelatedStructuralConnection),e.push(this.AppliedCondition),e.push(this.AdditionalConditions),e.push(this.SupportedLength),e.push(this.ConditionCoordinateSystem),e}},OE=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingStructuralMember=n,this.RelatedStructuralConnection=a,this.AppliedCondition=h,this.AdditionalConditions=l,this.SupportedLength=u,this.ConditionCoordinateSystem=c,this.ConnectionConstraint=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new OE(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingStructuralMember),e.push(this.RelatedStructuralConnection),e.push(this.AppliedCondition),e.push(this.AdditionalConditions),e.push(this.SupportedLength),e.push(this.ConditionCoordinateSystem),e.push(this.ConnectionConstraint),e}},BE=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ConnectionGeometry=n,this.RelatingElement=a,this.RelatedElement=h,this.RealizingElements=l,this.ConnectionType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new BE(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ConnectionGeometry),e.push(this.RelatingElement),e.push(this.RelatedElement),e.push(this.RealizingElements),e.push(this.ConnectionType),e}},LE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedElements=n,this.RelatingStructure=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new LE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedElements),e.push(this.RelatingStructure),e}},NE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingBuildingElement=n,this.RelatedCoverings=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new NE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingBuildingElement),e.push(this.RelatedCoverings),e}},kE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingSpace=n,this.RelatedCoverings=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new kE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSpace),e.push(this.RelatedCoverings),e}},jE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingContext=n,this.RelatedDefinitions=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new jE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingContext),e.push(this.RelatedDefinitions),e}},GE=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new GE(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},HE=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new HE(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},VE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingObject=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new VE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingObject),e}},UE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingPropertyDefinition=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new UE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingPropertyDefinition),e}},zE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedPropertySets=n,this.RelatingTemplate=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new zE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedPropertySets),e.push(this.RelatingTemplate),e}},WE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingType=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new WE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedObjects),e.push(this.RelatingType),e}},XE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingOpeningElement=n,this.RelatedBuildingElement=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new XE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingOpeningElement),e.push(this.RelatedBuildingElement),e}},YE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedControlElements=n,this.RelatingFlowElement=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new YE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedControlElements),e.push(this.RelatingFlowElement),e}},KE=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingElement=n,this.RelatedElement=a,this.InterferenceGeometry=h,this.InterferenceType=l,this.ImpliedOrder=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new KE(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingElement),e.push(this.RelatedElement),e.push(this.InterferenceGeometry),e.push(this.InterferenceType),e.push(this.ImpliedOrder),e}},JE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingObject=n,this.RelatedObjects=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new JE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingObject),e.push(this.RelatedObjects),e}},ZE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingPositioningElement=n,this.RelatedProducts=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new ZE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingPositioningElement),e.push(this.RelatedProducts),e}},QE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingElement=n,this.RelatedFeatureElement=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new QE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingElement),e.push(this.RelatedFeatureElement),e}},qE=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedElements=n,this.RelatingStructure=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new qE(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatedElements),e.push(this.RelatingStructure),e}},$E=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingProcess=n,this.RelatedProcess=a,this.TimeLag=h,this.SequenceType=l,this.UserDefinedSequenceType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new $E(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingProcess),e.push(this.RelatedProcess),e.push(this.TimeLag),e.push(this.SequenceType),e.push(this.UserDefinedSequenceType),e}},eF=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingSystem=n,this.RelatedBuildings=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new eF(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSystem),e.push(this.RelatedBuildings),e}},tF=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingSpace=n,this.RelatedBuildingElement=a,this.ConnectionGeometry=h,this.PhysicalOrVirtualBoundary=l,this.InternalOrExternalBoundary=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new tF(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSpace),e.push(this.RelatedBuildingElement),e.push(this.ConnectionGeometry),e.push(this.PhysicalOrVirtualBoundary),e.push(this.InternalOrExternalBoundary),e}},sF=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingSpace=n,this.RelatedBuildingElement=a,this.ConnectionGeometry=h,this.PhysicalOrVirtualBoundary=l,this.InternalOrExternalBoundary=u,this.ParentBoundary=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new sF(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSpace),e.push(this.RelatedBuildingElement),e.push(this.ConnectionGeometry),e.push(this.PhysicalOrVirtualBoundary),e.push(this.InternalOrExternalBoundary),e.push(this.ParentBoundary),e}},iF=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingSpace=n,this.RelatedBuildingElement=a,this.ConnectionGeometry=h,this.PhysicalOrVirtualBoundary=l,this.InternalOrExternalBoundary=u,this.ParentBoundary=c,this.CorrespondingBoundary=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new iF(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingSpace),e.push(this.RelatedBuildingElement),e.push(this.ConnectionGeometry),e.push(this.PhysicalOrVirtualBoundary),e.push(this.InternalOrExternalBoundary),e.push(this.ParentBoundary),e.push(this.CorrespondingBoundary),e}},rF=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingBuildingElement=n,this.RelatedOpeningElement=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new rF(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.RelatingBuildingElement),e.push(this.RelatedOpeningElement),e}},oF=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new oF(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},nF=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Transition=s,this.SameSense=i,this.ParentCurve=r,this.ParamLength=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new nF(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Transition),e.push(this.SameSense),e.push(this.ParentCurve),e.push(this.ParamLength),e}},aF=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.ContextOfItems=s,this.RepresentationIdentifier=i,this.RepresentationType=r,this.Items=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new aF(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}},hF=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.ContextIdentifier=s,this.ContextType=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new hF(e,t,r,o)}ToTape(){let e=[];return e.push(this.ContextIdentifier),e.push(this.ContextType),e}},lF=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new lF(e,t)}ToTape(){return[]}},uF=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.MappingOrigin=s,this.MappedRepresentation=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new uF(e,t,r,o)}ToTape(){let e=[];return e.push(this.MappingOrigin),e.push(this.MappedRepresentation),e}},cF=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new cF(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e}},pF=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.RelatedResourceObjects=r,this.RelatingApproval=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new pF(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatedResourceObjects),e.push(this.RelatingApproval),e}},dF=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.RelatingConstraint=r,this.RelatedResourceObjects=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new dF(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.RelatingConstraint),e.push(this.RelatedResourceObjects),e}},mF=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Name=s,this.Description=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new mF(e,t,r,o)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e}},fF=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v){this.expressID=e,this.type=t,this.Name=s,this.DataOrigin=i,this.UserDefinedDataOrigin=r,this.ScheduleWork=o,this.ScheduleUsage=n,this.ScheduleStart=a,this.ScheduleFinish=h,this.ScheduleContour=l,this.LevelingDelay=u,this.IsOverAllocated=c,this.StatusTime=p,this.ActualWork=d,this.ActualUsage=m,this.ActualStart=f,this.ActualFinish=g,this.RemainingWork=_,this.RemainingUsage=y,this.Completion=v}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++],x=s[i++];return new fF(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v,b,x)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.ScheduleWork),e.push(this.ScheduleUsage),e.push(this.ScheduleStart),e.push(this.ScheduleFinish),e.push(this.ScheduleContour),e.push(this.LevelingDelay),e.push(this.IsOverAllocated),e.push(this.StatusTime),e.push(this.ActualWork),e.push(this.ActualUsage),e.push(this.ActualStart),e.push(this.ActualFinish),e.push(this.RemainingWork),e.push(this.RemainingUsage),e.push(this.Completion),e}},gF=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.SweptArea=s,this.Position=i,this.Axis=r,this.Angle=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new gF(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.Axis),e.push(this.Angle),e}},_F=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.SweptArea=s,this.Position=i,this.Axis=r,this.Angle=o,this.EndSweptArea=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new _F(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.Axis),e.push(this.Angle),e.push(this.EndSweptArea),e}},yF=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Position=s,this.Height=i,this.BottomRadius=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new yF(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Position),e.push(this.Height),e.push(this.BottomRadius),e}},vF=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Position=s,this.Height=i,this.Radius=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new vF(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Position),e.push(this.Height),e.push(this.Radius),e}},bF=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new bF(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},xF=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new xF(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},PF=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new PF(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e}},TF=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.XDim=o,this.YDim=n,this.RoundingRadius=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new TF(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.XDim),e.push(this.YDim),e.push(this.RoundingRadius),e}},wF=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Dimensions=s,this.UnitType=i,this.Prefix=r,this.Name=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new wF(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Dimensions),e.push(this.UnitType),e.push(this.Prefix),e.push(this.Name),e}},MF=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new MF(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},IF=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new IF(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},CF=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Name=s,this.DataOrigin=i,this.UserDefinedDataOrigin=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new CF(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e}},DF=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Curve3D=s,this.AssociatedGeometry=i,this.MasterRepresentation=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new DF(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Curve3D),e.push(this.AssociatedGeometry),e.push(this.MasterRepresentation),e}},AF=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.SectionType=s,this.StartProfile=i,this.EndProfile=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new AF(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.SectionType),e.push(this.StartProfile),e.push(this.EndProfile),e}},EF=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.LongitudinalStartPosition=s,this.LongitudinalEndPosition=i,this.TransversePosition=r,this.ReinforcementRole=o,this.SectionDefinition=n,this.CrossSectionReinforcementDefinitions=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new EF(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.LongitudinalStartPosition),e.push(this.LongitudinalEndPosition),e.push(this.TransversePosition),e.push(this.ReinforcementRole),e.push(this.SectionDefinition),e.push(this.CrossSectionReinforcementDefinitions),e}},FF=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Directrix=s,this.CrossSections=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new FF(e,t,r,o)}ToTape(){let e=[];return e.push(this.Directrix),e.push(this.CrossSections),e}},RF=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Directrix=s,this.CrossSections=i,this.CrossSectionPositions=r,this.FixedAxisVertical=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new RF(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Directrix),e.push(this.CrossSections),e.push(this.CrossSectionPositions),e.push(this.FixedAxisVertical),e}},SF=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.SpineCurve=s,this.CrossSections=i,this.CrossSectionPositions=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new SF(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.SpineCurve),e.push(this.CrossSections),e.push(this.CrossSectionPositions),e}},OF=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new OF(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},BF=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new BF(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},LF=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new LF(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},NF=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new NF(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},kF=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.ShapeRepresentations=s,this.Name=i,this.Description=r,this.ProductDefinitional=o,this.PartOfProductDefinitionShape=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new kF(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.ShapeRepresentations),e.push(this.Name),e.push(this.Description),e.push(this.ProductDefinitional),e.push(this.PartOfProductDefinitionShape),e}},jF=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.ContextOfItems=s,this.RepresentationIdentifier=i,this.RepresentationType=r,this.Items=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new jF(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}},GF=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.ContextOfItems=s,this.RepresentationIdentifier=i,this.RepresentationType=r,this.Items=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new GF(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}},HF=class{constructor(e,t,s){this.expressID=e,this.type=t,this.SbsmBoundary=s}static FromTape(e,t,s){let i=0,r=s[i++];return new HF(e,t,r)}ToTape(){let e=[];return e.push(this.SbsmBoundary),e}},VF=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Name=s,this.Description=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new VF(e,t,r,o)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e}},UF=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.TemplateType=n,this.PrimaryMeasureType=a,this.SecondaryMeasureType=h,this.Enumerators=l,this.PrimaryUnit=u,this.SecondaryUnit=c,this.Expression=p,this.AccessState=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new UF(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.TemplateType),e.push(this.PrimaryMeasureType),e.push(this.SecondaryMeasureType),e.push(this.Enumerators),e.push(this.PrimaryUnit),e.push(this.SecondaryUnit),e.push(this.Expression),e.push(this.AccessState),e}},zF=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u,this.RefLatitude=c,this.RefLongitude=p,this.RefElevation=d,this.LandTitleNumber=m,this.SiteAddress=f}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++];return new zF(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.RefLatitude),e.push(this.RefLongitude),e.push(this.RefElevation),e.push(this.LandTitleNumber),e.push(this.SiteAddress),e}},WF=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new WF(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},XF=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new XF(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},YF=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new YF(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},KF=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new KF(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},JF=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.SlippageX=i,this.SlippageY=r,this.SlippageZ=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new JF(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.SlippageX),e.push(this.SlippageY),e.push(this.SlippageZ),e}},ZF=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new ZF(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},QF=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new QF(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},qF=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new qF(e,t)}ToTape(){return[]}},$F=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u,this.PredefinedType=c,this.ElevationWithFlooring=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new $F(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e.push(this.PredefinedType),e.push(this.ElevationWithFlooring),e}},eR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new eR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},tR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new tR(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},sR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c,this.LongName=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new sR(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.LongName),e}},iR=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new iR(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e}},rR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new rR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},oR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new oR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.CompositionType),e}},nR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new nR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e}},aR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new aR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.LongName),e.push(this.PredefinedType),e}},hR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c,this.LongName=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new hR(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.LongName),e}},lR=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Position=s,this.Radius=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new lR(e,t,r,o)}ToTape(){let e=[];return e.push(this.Position),e.push(this.Radius),e}},uR=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Position=s,this.Radius=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new uR(e,t,r,o)}ToTape(){let e=[];return e.push(this.Position),e.push(this.Radius),e}},cR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new cR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},pR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new pR(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},dR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new dR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},mR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.NumberOfRisers=u,this.NumberOfTreads=c,this.RiserHeight=p,this.TreadLength=d,this.PredefinedType=m}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new mR(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.NumberOfRisers),e.push(this.NumberOfTreads),e.push(this.RiserHeight),e.push(this.TreadLength),e.push(this.PredefinedType),e}},fR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new fR(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},gR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new gR(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},_R=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.DestabilizingLoad=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new _R(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e}},yR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new yR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e}},vR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.PredefinedType=a,this.OrientationOf2DPlane=h,this.LoadedBy=l,this.HasResults=u,this.SharedPlacement=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new vR(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.OrientationOf2DPlane),e.push(this.LoadedBy),e.push(this.HasResults),e.push(this.SharedPlacement),e}},bR=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedCondition=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new bR(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedCondition),e}},xR=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Name=s}static FromTape(e,t,s){let i=0,r=s[i++];return new xR(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},PR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.DestabilizingLoad=c,this.ProjectedOrTrue=p,this.PredefinedType=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new PR(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e.push(this.ProjectedOrTrue),e.push(this.PredefinedType),e}},TR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedCondition=l,this.Axis=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new TR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedCondition),e.push(this.Axis),e}},wR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.PredefinedType=l,this.Axis=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new wR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.Axis),e}},MR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.PredefinedType=l,this.Axis=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new MR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.Axis),e}},IR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new IR(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.PredefinedType),e}},CR=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new CR(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}},DR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.DestabilizingLoad=c,this.ProjectedOrTrue=p,this.PredefinedType=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new DR(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e.push(this.ProjectedOrTrue),e.push(this.PredefinedType),e}},AR=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Name=s}static FromTape(e,t,s){let i=0,r=s[i++];return new AR(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},ER=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.PredefinedType=a,this.ActionType=h,this.ActionSource=l,this.Coefficient=u,this.Purpose=c,this.SelfWeightCoefficients=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new ER(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.ActionType),e.push(this.ActionSource),e.push(this.Coefficient),e.push(this.Purpose),e.push(this.SelfWeightCoefficients),e}},FR=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Name=s,this.Values=i,this.Locations=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new FR(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Values),e.push(this.Locations),e}},RR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.PredefinedType=a,this.ActionType=h,this.ActionSource=l,this.Coefficient=u,this.Purpose=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new RR(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.PredefinedType),e.push(this.ActionType),e.push(this.ActionSource),e.push(this.Coefficient),e.push(this.Purpose),e}},SR=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.Name=s,this.LinearForceX=i,this.LinearForceY=r,this.LinearForceZ=o,this.LinearMomentX=n,this.LinearMomentY=a,this.LinearMomentZ=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new SR(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.LinearForceX),e.push(this.LinearForceY),e.push(this.LinearForceZ),e.push(this.LinearMomentX),e.push(this.LinearMomentY),e.push(this.LinearMomentZ),e}},OR=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Name=s}static FromTape(e,t,s){let i=0,r=s[i++];return new OR(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},BR=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.PlanarForceX=i,this.PlanarForceY=r,this.PlanarForceZ=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new BR(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.PlanarForceX),e.push(this.PlanarForceY),e.push(this.PlanarForceZ),e}},LR=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.Name=s,this.DisplacementX=i,this.DisplacementY=r,this.DisplacementZ=o,this.RotationalDisplacementRX=n,this.RotationalDisplacementRY=a,this.RotationalDisplacementRZ=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new LR(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DisplacementX),e.push(this.DisplacementY),e.push(this.DisplacementZ),e.push(this.RotationalDisplacementRX),e.push(this.RotationalDisplacementRY),e.push(this.RotationalDisplacementRZ),e}},NR=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.Name=s,this.DisplacementX=i,this.DisplacementY=r,this.DisplacementZ=o,this.RotationalDisplacementRX=n,this.RotationalDisplacementRY=a,this.RotationalDisplacementRZ=h,this.Distortion=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new NR(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DisplacementX),e.push(this.DisplacementY),e.push(this.DisplacementZ),e.push(this.RotationalDisplacementRX),e.push(this.RotationalDisplacementRY),e.push(this.RotationalDisplacementRZ),e.push(this.Distortion),e}},kR=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.Name=s,this.ForceX=i,this.ForceY=r,this.ForceZ=o,this.MomentX=n,this.MomentY=a,this.MomentZ=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new kR(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.Name),e.push(this.ForceX),e.push(this.ForceY),e.push(this.ForceZ),e.push(this.MomentX),e.push(this.MomentY),e.push(this.MomentZ),e}},jR=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.Name=s,this.ForceX=i,this.ForceY=r,this.ForceZ=o,this.MomentX=n,this.MomentY=a,this.MomentZ=h,this.WarpingMoment=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new jR(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.ForceX),e.push(this.ForceY),e.push(this.ForceZ),e.push(this.MomentX),e.push(this.MomentY),e.push(this.MomentZ),e.push(this.WarpingMoment),e}},GR=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Name=s}static FromTape(e,t,s){let i=0,r=s[i++];return new GR(e,t,r)}ToTape(){let e=[];return e.push(this.Name),e}},HR=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.DeltaTConstant=i,this.DeltaTY=r,this.DeltaTZ=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new HR(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DeltaTConstant),e.push(this.DeltaTY),e.push(this.DeltaTZ),e}},VR=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new VR(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e}},UR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.DestabilizingLoad=c,this.ProjectedOrTrue=p,this.PredefinedType=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new UR(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e.push(this.ProjectedOrTrue),e.push(this.PredefinedType),e}},zR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.DestabilizingLoad=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new zR(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e}},WR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedCondition=l,this.ConditionCoordinateSystem=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new WR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedCondition),e.push(this.ConditionCoordinateSystem),e}},XR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new XR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e}},YR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new YR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e}},KR=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.TheoryType=a,this.ResultForLoadGroup=h,this.IsLinear=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new KR(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.TheoryType),e.push(this.ResultForLoadGroup),e.push(this.IsLinear),e}},JR=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.DestabilizingLoad=c,this.ProjectedOrTrue=p,this.PredefinedType=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new JR(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.DestabilizingLoad),e.push(this.ProjectedOrTrue),e.push(this.PredefinedType),e}},ZR=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedCondition=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new ZR(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedCondition),e}},QR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.PredefinedType=l,this.Thickness=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new QR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.Thickness),e}},qR=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.PredefinedType=l,this.Thickness=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new qR(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.PredefinedType),e.push(this.Thickness),e}},$R=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new $R(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.AppliedLoad),e.push(this.GlobalOrLocal),e.push(this.PredefinedType),e}},eS=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.ContextOfItems=s,this.RepresentationIdentifier=i,this.RepresentationType=r,this.Items=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new eS(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}},tS=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Item=s,this.Styles=i,this.Name=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new tS(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Item),e.push(this.Styles),e.push(this.Name),e}},sS=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.ContextOfItems=s,this.RepresentationIdentifier=i,this.RepresentationType=r,this.Items=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new sS(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}},iS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Usage=l,this.BaseCosts=u,this.BaseQuantity=c,this.PredefinedType=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new iS(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Usage),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},rS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u,this.BaseCosts=c,this.BaseQuantity=p,this.PredefinedType=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new rS(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e.push(this.BaseCosts),e.push(this.BaseQuantity),e.push(this.PredefinedType),e}},oS=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.EdgeStart=s,this.EdgeEnd=i,this.ParentEdge=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new oS(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.EdgeStart),e.push(this.EdgeEnd),e.push(this.ParentEdge),e}},nS=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new nS(e,t)}ToTape(){return[]}},aS=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Curve3D=s,this.AssociatedGeometry=i,this.MasterRepresentation=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new aS(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Curve3D),e.push(this.AssociatedGeometry),e.push(this.MasterRepresentation),e}},hS=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.SweptArea=s,this.Position=i,this.Directrix=r,this.StartParam=o,this.EndParam=n,this.ReferenceSurface=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new hS(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.SweptArea),e.push(this.Position),e.push(this.Directrix),e.push(this.StartParam),e.push(this.EndParam),e.push(this.ReferenceSurface),e}},lS=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new lS(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},uS=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.SweptCurve=s,this.Position=i,this.ExtrudedDirection=r,this.Depth=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new uS(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.SweptCurve),e.push(this.Position),e.push(this.ExtrudedDirection),e.push(this.Depth),e}},cS=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.SweptCurve=s,this.Position=i,this.AxisPosition=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new cS(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.SweptCurve),e.push(this.Position),e.push(this.AxisPosition),e}},pS=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.Name=s,this.SurfaceReinforcement1=i,this.SurfaceReinforcement2=r,this.ShearReinforcement=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new pS(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.Name),e.push(this.SurfaceReinforcement1),e.push(this.SurfaceReinforcement2),e.push(this.ShearReinforcement),e}},dS=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Name=s,this.Side=i,this.Styles=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new dS(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Side),e.push(this.Styles),e}},mS=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.DiffuseTransmissionColour=s,this.DiffuseReflectionColour=i,this.TransmissionColour=r,this.ReflectanceColour=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new mS(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.DiffuseTransmissionColour),e.push(this.DiffuseReflectionColour),e.push(this.TransmissionColour),e.push(this.ReflectanceColour),e}},fS=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.RefractionIndex=s,this.DispersionFactor=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new fS(e,t,r,o)}ToTape(){let e=[];return e.push(this.RefractionIndex),e.push(this.DispersionFactor),e}},gS=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.SurfaceColour=s,this.Transparency=i,this.DiffuseColour=r,this.TransmissionColour=o,this.DiffuseTransmissionColour=n,this.ReflectionColour=a,this.SpecularColour=h,this.SpecularHighlight=l,this.ReflectanceMethod=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new gS(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.SurfaceColour),e.push(this.Transparency),e.push(this.DiffuseColour),e.push(this.TransmissionColour),e.push(this.DiffuseTransmissionColour),e.push(this.ReflectionColour),e.push(this.SpecularColour),e.push(this.SpecularHighlight),e.push(this.ReflectanceMethod),e}},_S=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.SurfaceColour=s,this.Transparency=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new _S(e,t,r,o)}ToTape(){let e=[];return e.push(this.SurfaceColour),e.push(this.Transparency),e}},yS=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Textures=s}static FromTape(e,t,s){let i=0,r=s[i++];return new yS(e,t,r)}ToTape(){let e=[];return e.push(this.Textures),e}},vS=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.RepeatS=s,this.RepeatT=i,this.Mode=r,this.TextureTransform=o,this.Parameter=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new vS(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.RepeatS),e.push(this.RepeatT),e.push(this.Mode),e.push(this.TextureTransform),e.push(this.Parameter),e}},bS=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.SweptArea=s,this.Position=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new bS(e,t,r,o)}ToTape(){let e=[];return e.push(this.SweptArea),e.push(this.Position),e}},xS=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Directrix=s,this.Radius=i,this.InnerRadius=r,this.StartParam=o,this.EndParam=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new xS(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Directrix),e.push(this.Radius),e.push(this.InnerRadius),e.push(this.StartParam),e.push(this.EndParam),e}},PS=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.Directrix=s,this.Radius=i,this.InnerRadius=r,this.StartParam=o,this.EndParam=n,this.FilletRadius=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new PS(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.Directrix),e.push(this.Radius),e.push(this.InnerRadius),e.push(this.StartParam),e.push(this.EndParam),e.push(this.FilletRadius),e}},TS=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.SweptCurve=s,this.Position=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new TS(e,t,r,o)}ToTape(){let e=[];return e.push(this.SweptCurve),e.push(this.Position),e}},wS=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new wS(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},MS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new MS(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},IS=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new IS(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e}},CS=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new CS(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},DS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new DS(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},AS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.Depth=o,this.FlangeWidth=n,this.WebThickness=a,this.FlangeThickness=h,this.FilletRadius=l,this.FlangeEdgeRadius=u,this.WebEdgeRadius=c,this.WebSlope=p,this.FlangeSlope=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new AS(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.FlangeWidth),e.push(this.WebThickness),e.push(this.FlangeThickness),e.push(this.FilletRadius),e.push(this.FlangeEdgeRadius),e.push(this.WebEdgeRadius),e.push(this.WebSlope),e.push(this.FlangeSlope),e}},ES=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Name=s,this.Rows=i,this.Columns=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new ES(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Rows),e.push(this.Columns),e}},FS=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Identifier=s,this.Name=i,this.Description=r,this.Unit=o,this.ReferencePath=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new FS(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Identifier),e.push(this.Name),e.push(this.Description),e.push(this.Unit),e.push(this.ReferencePath),e}},RS=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.RowCells=s,this.IsHeading=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new RS(e,t,r,o)}ToTape(){let e=[];return e.push(this.RowCells),e.push(this.IsHeading),e}},SS=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new SS(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},OS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new OS(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},BS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Status=l,this.WorkMethod=u,this.IsMilestone=c,this.Priority=p,this.TaskTime=d,this.PredefinedType=m}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new BS(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.LongDescription),e.push(this.Status),e.push(this.WorkMethod),e.push(this.IsMilestone),e.push(this.Priority),e.push(this.TaskTime),e.push(this.PredefinedType),e}},LS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v,b,x){this.expressID=e,this.type=t,this.Name=s,this.DataOrigin=i,this.UserDefinedDataOrigin=r,this.DurationType=o,this.ScheduleDuration=n,this.ScheduleStart=a,this.ScheduleFinish=h,this.EarlyStart=l,this.EarlyFinish=u,this.LateStart=c,this.LateFinish=p,this.FreeFloat=d,this.TotalFloat=m,this.IsCritical=f,this.StatusTime=g,this.ActualDuration=_,this.ActualStart=y,this.ActualFinish=v,this.RemainingTime=b,this.Completion=x}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++],x=s[i++],P=s[i++],T=s[i++];return new LS(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v,b,x,P,T)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.DurationType),e.push(this.ScheduleDuration),e.push(this.ScheduleStart),e.push(this.ScheduleFinish),e.push(this.EarlyStart),e.push(this.EarlyFinish),e.push(this.LateStart),e.push(this.LateFinish),e.push(this.FreeFloat),e.push(this.TotalFloat),e.push(this.IsCritical),e.push(this.StatusTime),e.push(this.ActualDuration),e.push(this.ActualStart),e.push(this.ActualFinish),e.push(this.RemainingTime),e.push(this.Completion),e}},NS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v,b,x,P){this.expressID=e,this.type=t,this.Name=s,this.DataOrigin=i,this.UserDefinedDataOrigin=r,this.DurationType=o,this.ScheduleDuration=n,this.ScheduleStart=a,this.ScheduleFinish=h,this.EarlyStart=l,this.EarlyFinish=u,this.LateStart=c,this.LateFinish=p,this.FreeFloat=d,this.TotalFloat=m,this.IsCritical=f,this.StatusTime=g,this.ActualDuration=_,this.ActualStart=y,this.ActualFinish=v,this.RemainingTime=b,this.Completion=x,this.Recurrence=P}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++],x=s[i++],P=s[i++],T=s[i++],w=s[i++];return new NS(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v,b,x,P,T,w)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.DurationType),e.push(this.ScheduleDuration),e.push(this.ScheduleStart),e.push(this.ScheduleFinish),e.push(this.EarlyStart),e.push(this.EarlyFinish),e.push(this.LateStart),e.push(this.LateFinish),e.push(this.FreeFloat),e.push(this.TotalFloat),e.push(this.IsCritical),e.push(this.StatusTime),e.push(this.ActualDuration),e.push(this.ActualStart),e.push(this.ActualFinish),e.push(this.RemainingTime),e.push(this.Completion),e.push(this.Recurrence),e}},kS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ProcessType=u,this.PredefinedType=c,this.WorkMethod=p}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++];return new kS(e,t,r,o,n,a,h,l,u,c,p,d,m)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ProcessType),e.push(this.PredefinedType),e.push(this.WorkMethod),e}},jS=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.Purpose=s,this.Description=i,this.UserDefinedPurpose=r,this.TelephoneNumbers=o,this.FacsimileNumbers=n,this.PagerNumber=a,this.ElectronicMailAddresses=h,this.WWWHomePageURL=l,this.MessagingIDs=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new jS(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.Purpose),e.push(this.Description),e.push(this.UserDefinedPurpose),e.push(this.TelephoneNumbers),e.push(this.FacsimileNumbers),e.push(this.PagerNumber),e.push(this.ElectronicMailAddresses),e.push(this.WWWHomePageURL),e.push(this.MessagingIDs),e}},GS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.SteelGrade=u,this.PredefinedType=c,this.NominalDiameter=p,this.CrossSectionArea=d,this.TensionForce=m,this.PreStress=f,this.FrictionCoefficient=g,this.AnchorageSlip=_,this.MinCurvatureRadius=y}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++];return new GS(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v,b)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.PredefinedType),e.push(this.NominalDiameter),e.push(this.CrossSectionArea),e.push(this.TensionForce),e.push(this.PreStress),e.push(this.FrictionCoefficient),e.push(this.AnchorageSlip),e.push(this.MinCurvatureRadius),e}},HS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.SteelGrade=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new HS(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.PredefinedType),e}},VS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new VS(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},US=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.SteelGrade=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new US(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.SteelGrade),e.push(this.PredefinedType),e}},zS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new zS(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},WS=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c,this.NominalDiameter=p,this.CrossSectionArea=d,this.SheathDiameter=m}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new WS(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.NominalDiameter),e.push(this.CrossSectionArea),e.push(this.SheathDiameter),e}},XS=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Coordinates=s}static FromTape(e,t,s){let i=0,r=s[i++];return new XS(e,t,r)}ToTape(){let e=[];return e.push(this.Coordinates),e}},YS=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new YS(e,t)}ToTape(){return[]}},KS=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Literal=s,this.Placement=i,this.Path=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new KS(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Literal),e.push(this.Placement),e.push(this.Path),e}},JS=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Literal=s,this.Placement=i,this.Path=r,this.Extent=o,this.BoxAlignment=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new JS(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Literal),e.push(this.Placement),e.push(this.Path),e.push(this.Extent),e.push(this.BoxAlignment),e}},ZS=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Name=s,this.TextCharacterAppearance=i,this.TextStyle=r,this.TextFontStyle=o,this.ModelOrDraughting=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new ZS(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Name),e.push(this.TextCharacterAppearance),e.push(this.TextStyle),e.push(this.TextFontStyle),e.push(this.ModelOrDraughting),e}},QS=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.Name=s,this.FontFamily=i,this.FontStyle=r,this.FontVariant=o,this.FontWeight=n,this.FontSize=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new QS(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.Name),e.push(this.FontFamily),e.push(this.FontStyle),e.push(this.FontVariant),e.push(this.FontWeight),e.push(this.FontSize),e}},qS=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Colour=s,this.BackgroundColour=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new qS(e,t,r,o)}ToTape(){let e=[];return e.push(this.Colour),e.push(this.BackgroundColour),e}},$S=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.TextIndent=s,this.TextAlign=i,this.TextDecoration=r,this.LetterSpacing=o,this.WordSpacing=n,this.TextTransform=a,this.LineHeight=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new $S(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.TextIndent),e.push(this.TextAlign),e.push(this.TextDecoration),e.push(this.LetterSpacing),e.push(this.WordSpacing),e.push(this.TextTransform),e.push(this.LineHeight),e}},eO=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Maps=s}static FromTape(e,t,s){let i=0,r=s[i++];return new eO(e,t,r)}ToTape(){let e=[];return e.push(this.Maps),e}},tO=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Maps=s,this.Mode=i,this.Parameter=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new tO(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Maps),e.push(this.Mode),e.push(this.Parameter),e}},sO=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Maps=s,this.Vertices=i,this.MappedTo=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new sO(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Maps),e.push(this.Vertices),e.push(this.MappedTo),e}},iO=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Coordinates=s}static FromTape(e,t,s){let i=0,r=s[i++];return new iO(e,t,r)}ToTape(){let e=[];return e.push(this.Coordinates),e}},rO=class{constructor(e,t,s){this.expressID=e,this.type=t,this.TexCoordsList=s}static FromTape(e,t,s){let i=0,r=s[i++];return new rO(e,t,r)}ToTape(){let e=[];return e.push(this.TexCoordsList),e}},oO=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.StartTime=s,this.EndTime=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new oO(e,t,r,o)}ToTape(){let e=[];return e.push(this.StartTime),e.push(this.EndTime),e}},nO=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.Name=s,this.Description=i,this.StartTime=r,this.EndTime=o,this.TimeSeriesDataType=n,this.DataOrigin=a,this.UserDefinedDataOrigin=h,this.Unit=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new nO(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.Name),e.push(this.Description),e.push(this.StartTime),e.push(this.EndTime),e.push(this.TimeSeriesDataType),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.Unit),e}},aO=class{constructor(e,t,s){this.expressID=e,this.type=t,this.ListValues=s}static FromTape(e,t,s){let i=0,r=s[i++];return new aO(e,t,r)}ToTape(){let e=[];return e.push(this.ListValues),e}},hO=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new hO(e,t)}ToTape(){return[]}},lO=class{constructor(e,t,s,i,r,o){this.expressID=e,this.type=t,this.ContextOfItems=s,this.RepresentationIdentifier=i,this.RepresentationType=r,this.Items=o}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new lO(e,t,r,o,n,a)}ToTape(){let e=[];return e.push(this.ContextOfItems),e.push(this.RepresentationIdentifier),e.push(this.RepresentationType),e.push(this.Items),e}},uO=class{constructor(e,t,s,i,r){this.expressID=e,this.type=t,this.Position=s,this.MajorRadius=i,this.MinorRadius=r}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new uO(e,t,r,o,n)}ToTape(){let e=[];return e.push(this.Position),e.push(this.MajorRadius),e.push(this.MinorRadius),e}},cO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new cO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},pO=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new pO(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},dO=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.StartPoint=s,this.StartDirection=i,this.SegmentLength=r,this.StartRadius=o,this.EndRadius=n,this.IsStartRadiusCCW=a,this.IsEndRadiusCCW=h,this.TransitionCurveType=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new dO(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.StartPoint),e.push(this.StartDirection),e.push(this.SegmentLength),e.push(this.StartRadius),e.push(this.EndRadius),e.push(this.IsStartRadiusCCW),e.push(this.IsEndRadiusCCW),e.push(this.TransitionCurveType),e}},mO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new mO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},fO=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new fO(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},gO=class{constructor(e,t,s,i,r,o,n,a,h){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.BottomXDim=o,this.TopXDim=n,this.YDim=a,this.TopXOffset=h}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new gO(e,t,r,o,n,a,h,l,u)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.BottomXDim),e.push(this.TopXDim),e.push(this.YDim),e.push(this.TopXOffset),e}},_O=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.Coordinates=s,this.Normals=i,this.Closed=r,this.CoordIndex=o,this.PnIndex=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new _O(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.Coordinates),e.push(this.Normals),e.push(this.Closed),e.push(this.CoordIndex),e.push(this.PnIndex),e}},yO=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.Coordinates=s,this.Normals=i,this.Closed=r,this.CoordIndex=o,this.PnIndex=n,this.Flags=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new yO(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.Coordinates),e.push(this.Normals),e.push(this.Closed),e.push(this.CoordIndex),e.push(this.PnIndex),e.push(this.Flags),e}},vO=class{constructor(e,t,s,i,r,o,n){this.expressID=e,this.type=t,this.BasisCurve=s,this.Trim1=i,this.Trim2=r,this.SenseAgreement=o,this.MasterRepresentation=n}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new vO(e,t,r,o,n,a,h)}ToTape(){let e=[];return e.push(this.BasisCurve),e.push(this.Trim1),e.push(this.Trim2),e.push(this.SenseAgreement),e.push(this.MasterRepresentation),e}},bO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new bO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},xO=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new xO(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},PO=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new PO(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e}},TO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ProcessType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new TO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ProcessType),e}},wO=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new wO(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e}},MO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new MO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.Identification),e.push(this.LongDescription),e.push(this.ResourceType),e}},IO=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.Depth=o,this.FlangeWidth=n,this.WebThickness=a,this.FlangeThickness=h,this.FilletRadius=l,this.EdgeRadius=u,this.FlangeSlope=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new IO(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.FlangeWidth),e.push(this.WebThickness),e.push(this.FlangeThickness),e.push(this.FilletRadius),e.push(this.EdgeRadius),e.push(this.FlangeSlope),e}},CO=class{constructor(e,t,s){this.expressID=e,this.type=t,this.Units=s}static FromTape(e,t,s){let i=0,r=s[i++];return new CO(e,t,r)}ToTape(){let e=[];return e.push(this.Units),e}},DO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new DO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},AO=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new AO(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},EO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new EO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},FO=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new FO(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},RO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new RO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},SO=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new SO(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},OO=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.Orientation=s,this.Magnitude=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new OO(e,t,r,o)}ToTape(){let e=[];return e.push(this.Orientation),e.push(this.Magnitude),e}},BO=class{constructor(e,t){this.expressID=e,this.type=t}static FromTape(e,t,s){return new BO(e,t)}ToTape(){return[]}},LO=class{constructor(e,t,s){this.expressID=e,this.type=t,this.LoopVertex=s}static FromTape(e,t,s){let i=0,r=s[i++];return new LO(e,t,r)}ToTape(){let e=[];return e.push(this.LoopVertex),e}},NO=class{constructor(e,t,s){this.expressID=e,this.type=t,this.VertexGeometry=s}static FromTape(e,t,s){let i=0,r=s[i++];return new NO(e,t,r)}ToTape(){let e=[];return e.push(this.VertexGeometry),e}},kO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new kO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},jO=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new jO(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},GO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new GO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},HO=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new HO(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},VO=class{constructor(e,t,s,i,r,o,n,a,h,l){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++];return new VO(e,t,r,o,n,a,h,l,u,c)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e}},UO=class{constructor(e,t,s,i){this.expressID=e,this.type=t,this.IntersectingAxes=s,this.OffsetDistances=i}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++];return new UO(e,t,r,o)}ToTape(){let e=[];return e.push(this.IntersectingAxes),e.push(this.OffsetDistances),e}},zO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new zO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},WO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new WO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},XO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new XO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},YO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new YO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},KO=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new KO(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},JO=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new JO(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.PredefinedType),e}},ZO=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++];return new ZO(e,t,r,o,n,a,h,l,u,c,p,d)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e}},QO=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.OverallHeight=u,this.OverallWidth=c,this.PredefinedType=p,this.PartitioningType=d,this.UserDefinedPartitioningType=m}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new QO(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.OverallHeight),e.push(this.OverallWidth),e.push(this.PredefinedType),e.push(this.PartitioningType),e.push(this.UserDefinedPartitioningType),e}},qO=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f,g,_){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.LiningDepth=n,this.LiningThickness=a,this.TransomThickness=h,this.MullionThickness=l,this.FirstTransomOffset=u,this.SecondTransomOffset=c,this.FirstMullionOffset=p,this.SecondMullionOffset=d,this.ShapeAspectStyle=m,this.LiningOffset=f,this.LiningToPanelOffsetX=g,this.LiningToPanelOffsetY=_}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++];return new qO(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_,y,v)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.LiningDepth),e.push(this.LiningThickness),e.push(this.TransomThickness),e.push(this.MullionThickness),e.push(this.FirstTransomOffset),e.push(this.SecondTransomOffset),e.push(this.FirstMullionOffset),e.push(this.SecondMullionOffset),e.push(this.ShapeAspectStyle),e.push(this.LiningOffset),e.push(this.LiningToPanelOffsetX),e.push(this.LiningToPanelOffsetY),e}},$O=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.OperationType=n,this.PanelPosition=a,this.FrameDepth=h,this.FrameThickness=l,this.ShapeAspectStyle=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new $O(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.OperationType),e.push(this.PanelPosition),e.push(this.FrameDepth),e.push(this.FrameThickness),e.push(this.ShapeAspectStyle),e}},eB=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.OverallHeight=u,this.OverallWidth=c,this.PredefinedType=p,this.PartitioningType=d,this.UserDefinedPartitioningType=m}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new eB(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.ObjectPlacement),e.push(this.Representation),e.push(this.Tag),e.push(this.OverallHeight),e.push(this.OverallWidth),e.push(this.PredefinedType),e.push(this.PartitioningType),e.push(this.UserDefinedPartitioningType),e}},tB=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ConstructionType=u,this.OperationType=c,this.ParameterTakesPrecedence=p,this.Sizeable=d}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++];return new tB(e,t,r,o,n,a,h,l,u,c,p,d,m,f)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ConstructionType),e.push(this.OperationType),e.push(this.ParameterTakesPrecedence),e.push(this.Sizeable),e}},sB=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=c,this.PartitioningType=p,this.ParameterTakesPrecedence=d,this.UserDefinedPartitioningType=m}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new sB(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ApplicableOccurrence),e.push(this.HasPropertySets),e.push(this.RepresentationMaps),e.push(this.Tag),e.push(this.ElementType),e.push(this.PredefinedType),e.push(this.PartitioningType),e.push(this.ParameterTakesPrecedence),e.push(this.UserDefinedPartitioningType),e}},iB=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.WorkingTimes=h,this.ExceptionTimes=l,this.PredefinedType=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new iB(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.WorkingTimes),e.push(this.ExceptionTimes),e.push(this.PredefinedType),e}},rB=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.CreationDate=h,this.Creators=l,this.Purpose=u,this.Duration=c,this.TotalFloat=p,this.StartTime=d,this.FinishTime=m}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new rB(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.CreationDate),e.push(this.Creators),e.push(this.Purpose),e.push(this.Duration),e.push(this.TotalFloat),e.push(this.StartTime),e.push(this.FinishTime),e}},oB=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.CreationDate=h,this.Creators=l,this.Purpose=u,this.Duration=c,this.TotalFloat=p,this.StartTime=d,this.FinishTime=m,this.PredefinedType=f}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++];return new oB(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.CreationDate),e.push(this.Creators),e.push(this.Purpose),e.push(this.Duration),e.push(this.TotalFloat),e.push(this.StartTime),e.push(this.FinishTime),e.push(this.PredefinedType),e}},nB=class{constructor(e,t,s,i,r,o,n,a,h,l,u,c,p,d,m,f){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.CreationDate=h,this.Creators=l,this.Purpose=u,this.Duration=c,this.TotalFloat=p,this.StartTime=d,this.FinishTime=m,this.PredefinedType=f}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++];return new nB(e,t,r,o,n,a,h,l,u,c,p,d,m,f,g,_)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.Identification),e.push(this.CreationDate),e.push(this.Creators),e.push(this.Purpose),e.push(this.Duration),e.push(this.TotalFloat),e.push(this.StartTime),e.push(this.FinishTime),e.push(this.PredefinedType),e}},aB=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.Name=s,this.DataOrigin=i,this.UserDefinedDataOrigin=r,this.RecurrencePattern=o,this.Start=n,this.Finish=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new aB(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.Name),e.push(this.DataOrigin),e.push(this.UserDefinedDataOrigin),e.push(this.RecurrencePattern),e.push(this.Start),e.push(this.Finish),e}},hB=class{constructor(e,t,s,i,r,o,n,a,h,l,u){this.expressID=e,this.type=t,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.Depth=o,this.FlangeWidth=n,this.WebThickness=a,this.FlangeThickness=h,this.FilletRadius=l,this.EdgeRadius=u}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],c=s[i++],p=s[i++];return new hB(e,t,r,o,n,a,h,l,u,c,p)}ToTape(){let e=[];return e.push(this.ProfileType),e.push(this.ProfileName),e.push(this.Position),e.push(this.Depth),e.push(this.FlangeWidth),e.push(this.WebThickness),e.push(this.FlangeThickness),e.push(this.FilletRadius),e.push(this.EdgeRadius),e}},lB=class{constructor(e,t,s,i,r,o,n,a){this.expressID=e,this.type=t,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.LongName=a}static FromTape(e,t,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new lB(e,t,r,o,n,a,h,l)}ToTape(){let e=[];return e.push(this.GlobalId),e.push(this.OwnerHistory),e.push(this.Name),e.push(this.Description),e.push(this.ObjectType),e.push(this.LongName),e}},uB={103090709:"IFCPROJECT",4097777520:"IFCSITE",4031249490:"IFCBUILDING",3124254112:"IFCBUILDINGSTOREY",3856911033:"IFCSPACE",1674181508:"IFCANNOTATION",25142252:"IFCCONTROLLER",32344328:"IFCBOILER",76236018:"IFCLAMP",90941305:"IFCPUMP",177149247:"IFCAIRTERMINALBOX",182646315:"IFCFLOWINSTRUMENT",263784265:"IFCFURNISHINGELEMENT",264262732:"IFCELECTRICGENERATOR",277319702:"IFCAUDIOVISUALAPPLIANCE",310824031:"IFCPIPEFITTING",331165859:"IFCSTAIR",342316401:"IFCDUCTFITTING",377706215:"IFCMECHANICALFASTENER",395920057:"IFCDOOR",402227799:"IFCELECTRICMOTOR",413509423:"IFCSYSTEMFURNITUREELEMENT",484807127:"IFCEVAPORATOR",486154966:"IFCWINDOWSTANDARDCASE",629592764:"IFCLIGHTFIXTURE",630975310:"IFCUNITARYCONTROLELEMENT",635142910:"IFCCABLECARRIERFITTING",639361253:"IFCCOIL",647756555:"IFCFASTENER",707683696:"IFCFLOWSTORAGEDEVICE",738039164:"IFCPROTECTIVEDEVICE",753842376:"IFCBEAM",812556717:"IFCTANK",819412036:"IFCFILTER",843113511:"IFCCOLUMN",862014818:"IFCELECTRICDISTRIBUTIONBOARD",900683007:"IFCFOOTING",905975707:"IFCCOLUMNSTANDARDCASE",926996030:"IFCVOIDINGFEATURE",979691226:"IFCREINFORCINGBAR",987401354:"IFCFLOWSEGMENT",1003880860:"IFCELECTRICTIMECONTROL",1051757585:"IFCCABLEFITTING",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",1073191201:"IFCMEMBER",1095909175:"IFCBUILDINGELEMENTPROXY",1156407060:"IFCPLATESTANDARDCASE",1162798199:"IFCSWITCHINGDEVICE",1329646415:"IFCSHADINGDEVICE",1335981549:"IFCDISCRETEACCESSORY",1360408905:"IFCDUCTSILENCER",1404847402:"IFCSTACKTERMINAL",1426591983:"IFCFIRESUPPRESSIONTERMINAL",1437502449:"IFCMEDICALDEVICE",1509553395:"IFCFURNITURE",1529196076:"IFCSLAB",1620046519:"IFCTRANSPORTELEMENT",1634111441:"IFCAIRTERMINAL",1658829314:"IFCENERGYCONVERSIONDEVICE",1677625105:"IFCCIVILELEMENT",1687234759:"IFCPILE",1904799276:"IFCELECTRICAPPLIANCE",1911478936:"IFCMEMBERSTANDARDCASE",1945004755:"IFCDISTRIBUTIONELEMENT",1973544240:"IFCCOVERING",1999602285:"IFCSPACEHEATER",2016517767:"IFCROOF",2056796094:"IFCAIRTOAIRHEATRECOVERY",2058353004:"IFCFLOWCONTROLLER",2068733104:"IFCHUMIDIFIER",2176052936:"IFCJUNCTIONBOX",2188021234:"IFCFLOWMETER",2223149337:"IFCFLOWTERMINAL",2262370178:"IFCRAILING",2272882330:"IFCCONDENSER",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",2320036040:"IFCREINFORCINGMESH",2347447852:"IFCTENDONANCHOR",2391383451:"IFCVIBRATIONISOLATOR",2391406946:"IFCWALL",2474470126:"IFCMOTORCONNECTION",2769231204:"IFCVIRTUALELEMENT",2814081492:"IFCENGINE",2906023776:"IFCBEAMSTANDARDCASE",2938176219:"IFCBURNER",2979338954:"IFCBUILDINGELEMENTPART",3024970846:"IFCRAMP",3026737570:"IFCTUBEBUNDLE",3027962421:"IFCSLABSTANDARDCASE",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",3053780830:"IFCSANITARYTERMINAL",3079942009:"IFCOPENINGSTANDARDCASE",3087945054:"IFCALARM",3101698114:"IFCSURFACEFEATURE",3127900445:"IFCSLABELEMENTEDCASE",3132237377:"IFCFLOWMOVINGDEVICE",3171933400:"IFCPLATE",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",3242481149:"IFCDOORSTANDARDCASE",3283111854:"IFCRAMPFLIGHT",3296154744:"IFCCHIMNEY",3304561284:"IFCWINDOW",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",3319311131:"IFCHEATEXCHANGER",3415622556:"IFCFAN",3420628829:"IFCSOLARDEVICE",3493046030:"IFCGEOGRAPHICELEMENT",3495092785:"IFCCURTAINWALL",3508470533:"IFCFLOWTREATMENTDEVICE",3512223829:"IFCWALLSTANDARDCASE",3518393246:"IFCDUCTSEGMENT",3571504051:"IFCCOMPRESSOR",3588315303:"IFCOPENINGELEMENT",3612865200:"IFCPIPESEGMENT",3640358203:"IFCCOOLINGTOWER",3651124850:"IFCPROJECTIONELEMENT",3694346114:"IFCOUTLET",3747195512:"IFCEVAPORATIVECOOLER",3758799889:"IFCCABLECARRIERSEGMENT",3824725483:"IFCTENDON",3825984169:"IFCTRANSFORMER",3902619387:"IFCCHILLER",4074379575:"IFCDAMPER",4086658281:"IFCSENSOR",4123344466:"IFCELEMENTASSEMBLY",4136498852:"IFCCOOLEDBEAM",4156078855:"IFCWALLELEMENTEDCASE",4175244083:"IFCINTERCEPTOR",4207607924:"IFCVALVE",4217484030:"IFCCABLESEGMENT",4237592921:"IFCWASTETERMINAL",4252922144:"IFCSTAIRFLIGHT",4278956645:"IFCFLOWFITTING",4288193352:"IFCACTUATOR",4292641817:"IFCUNITARYEQUIPMENT",3009204131:"IFCGRID"},cB={3821786052:"IFCACTIONREQUEST",2296667514:"IFCACTOR",3630933823:"IFCACTORROLE",4288193352:"IFCACTUATOR",2874132201:"IFCACTUATORTYPE",618182010:"IFCADDRESS",1635779807:"IFCADVANCEDBREP",2603310189:"IFCADVANCEDBREPWITHVOIDS",3406155212:"IFCADVANCEDFACE",1634111441:"IFCAIRTERMINAL",177149247:"IFCAIRTERMINALBOX",1411407467:"IFCAIRTERMINALBOXTYPE",3352864051:"IFCAIRTERMINALTYPE",2056796094:"IFCAIRTOAIRHEATRECOVERY",1871374353:"IFCAIRTOAIRHEATRECOVERYTYPE",3087945054:"IFCALARM",3001207471:"IFCALARMTYPE",325726236:"IFCALIGNMENT",749761778:"IFCALIGNMENT2DHORIZONTAL",3199563722:"IFCALIGNMENT2DHORIZONTALSEGMENT",2483840362:"IFCALIGNMENT2DSEGMENT",3379348081:"IFCALIGNMENT2DVERSEGCIRCULARARC",3239324667:"IFCALIGNMENT2DVERSEGLINE",4263986512:"IFCALIGNMENT2DVERSEGPARABOLICARC",53199957:"IFCALIGNMENT2DVERTICAL",2029264950:"IFCALIGNMENT2DVERTICALSEGMENT",3512275521:"IFCALIGNMENTCURVE",1674181508:"IFCANNOTATION",669184980:"IFCANNOTATIONFILLAREA",639542469:"IFCAPPLICATION",411424972:"IFCAPPLIEDVALUE",130549933:"IFCAPPROVAL",3869604511:"IFCAPPROVALRELATIONSHIP",3798115385:"IFCARBITRARYCLOSEDPROFILEDEF",1310608509:"IFCARBITRARYOPENPROFILEDEF",2705031697:"IFCARBITRARYPROFILEDEFWITHVOIDS",3460190687:"IFCASSET",3207858831:"IFCASYMMETRICISHAPEPROFILEDEF",277319702:"IFCAUDIOVISUALAPPLIANCE",1532957894:"IFCAUDIOVISUALAPPLIANCETYPE",4261334040:"IFCAXIS1PLACEMENT",3125803723:"IFCAXIS2PLACEMENT2D",2740243338:"IFCAXIS2PLACEMENT3D",1967976161:"IFCBSPLINECURVE",2461110595:"IFCBSPLINECURVEWITHKNOTS",2887950389:"IFCBSPLINESURFACE",167062518:"IFCBSPLINESURFACEWITHKNOTS",753842376:"IFCBEAM",2906023776:"IFCBEAMSTANDARDCASE",819618141:"IFCBEAMTYPE",4196446775:"IFCBEARING",3649138523:"IFCBEARINGTYPE",616511568:"IFCBLOBTEXTURE",1334484129:"IFCBLOCK",32344328:"IFCBOILER",231477066:"IFCBOILERTYPE",3649129432:"IFCBOOLEANCLIPPINGRESULT",2736907675:"IFCBOOLEANRESULT",4037036970:"IFCBOUNDARYCONDITION",1136057603:"IFCBOUNDARYCURVE",1560379544:"IFCBOUNDARYEDGECONDITION",3367102660:"IFCBOUNDARYFACECONDITION",1387855156:"IFCBOUNDARYNODECONDITION",2069777674:"IFCBOUNDARYNODECONDITIONWARPING",1260505505:"IFCBOUNDEDCURVE",4182860854:"IFCBOUNDEDSURFACE",2581212453:"IFCBOUNDINGBOX",2713105998:"IFCBOXEDHALFSPACE",644574406:"IFCBRIDGE",963979645:"IFCBRIDGEPART",4031249490:"IFCBUILDING",3299480353:"IFCBUILDINGELEMENT",2979338954:"IFCBUILDINGELEMENTPART",39481116:"IFCBUILDINGELEMENTPARTTYPE",1095909175:"IFCBUILDINGELEMENTPROXY",1909888760:"IFCBUILDINGELEMENTPROXYTYPE",1950629157:"IFCBUILDINGELEMENTTYPE",3124254112:"IFCBUILDINGSTOREY",1177604601:"IFCBUILDINGSYSTEM",2938176219:"IFCBURNER",2188180465:"IFCBURNERTYPE",2898889636:"IFCCSHAPEPROFILEDEF",635142910:"IFCCABLECARRIERFITTING",395041908:"IFCCABLECARRIERFITTINGTYPE",3758799889:"IFCCABLECARRIERSEGMENT",3293546465:"IFCCABLECARRIERSEGMENTTYPE",1051757585:"IFCCABLEFITTING",2674252688:"IFCCABLEFITTINGTYPE",4217484030:"IFCCABLESEGMENT",1285652485:"IFCCABLESEGMENTTYPE",3999819293:"IFCCAISSONFOUNDATION",3203706013:"IFCCAISSONFOUNDATIONTYPE",1123145078:"IFCCARTESIANPOINT",574549367:"IFCCARTESIANPOINTLIST",1675464909:"IFCCARTESIANPOINTLIST2D",2059837836:"IFCCARTESIANPOINTLIST3D",59481748:"IFCCARTESIANTRANSFORMATIONOPERATOR",3749851601:"IFCCARTESIANTRANSFORMATIONOPERATOR2D",3486308946:"IFCCARTESIANTRANSFORMATIONOPERATOR2DNONUNIFORM",3331915920:"IFCCARTESIANTRANSFORMATIONOPERATOR3D",1416205885:"IFCCARTESIANTRANSFORMATIONOPERATOR3DNONUNIFORM",3150382593:"IFCCENTERLINEPROFILEDEF",3902619387:"IFCCHILLER",2951183804:"IFCCHILLERTYPE",3296154744:"IFCCHIMNEY",2197970202:"IFCCHIMNEYTYPE",2611217952:"IFCCIRCLE",2937912522:"IFCCIRCLEHOLLOWPROFILEDEF",1383045692:"IFCCIRCLEPROFILEDEF",1062206242:"IFCCIRCULARARCSEGMENT2D",1677625105:"IFCCIVILELEMENT",3893394355:"IFCCIVILELEMENTTYPE",747523909:"IFCCLASSIFICATION",647927063:"IFCCLASSIFICATIONREFERENCE",2205249479:"IFCCLOSEDSHELL",639361253:"IFCCOIL",2301859152:"IFCCOILTYPE",776857604:"IFCCOLOURRGB",3285139300:"IFCCOLOURRGBLIST",3264961684:"IFCCOLOURSPECIFICATION",843113511:"IFCCOLUMN",905975707:"IFCCOLUMNSTANDARDCASE",300633059:"IFCCOLUMNTYPE",3221913625:"IFCCOMMUNICATIONSAPPLIANCE",400855858:"IFCCOMMUNICATIONSAPPLIANCETYPE",2542286263:"IFCCOMPLEXPROPERTY",3875453745:"IFCCOMPLEXPROPERTYTEMPLATE",3732776249:"IFCCOMPOSITECURVE",15328376:"IFCCOMPOSITECURVEONSURFACE",2485617015:"IFCCOMPOSITECURVESEGMENT",1485152156:"IFCCOMPOSITEPROFILEDEF",3571504051:"IFCCOMPRESSOR",3850581409:"IFCCOMPRESSORTYPE",2272882330:"IFCCONDENSER",2816379211:"IFCCONDENSERTYPE",2510884976:"IFCCONIC",370225590:"IFCCONNECTEDFACESET",1981873012:"IFCCONNECTIONCURVEGEOMETRY",2859738748:"IFCCONNECTIONGEOMETRY",45288368:"IFCCONNECTIONPOINTECCENTRICITY",2614616156:"IFCCONNECTIONPOINTGEOMETRY",2732653382:"IFCCONNECTIONSURFACEGEOMETRY",775493141:"IFCCONNECTIONVOLUMEGEOMETRY",1959218052:"IFCCONSTRAINT",3898045240:"IFCCONSTRUCTIONEQUIPMENTRESOURCE",2185764099:"IFCCONSTRUCTIONEQUIPMENTRESOURCETYPE",1060000209:"IFCCONSTRUCTIONMATERIALRESOURCE",4105962743:"IFCCONSTRUCTIONMATERIALRESOURCETYPE",488727124:"IFCCONSTRUCTIONPRODUCTRESOURCE",1525564444:"IFCCONSTRUCTIONPRODUCTRESOURCETYPE",2559216714:"IFCCONSTRUCTIONRESOURCE",2574617495:"IFCCONSTRUCTIONRESOURCETYPE",3419103109:"IFCCONTEXT",3050246964:"IFCCONTEXTDEPENDENTUNIT",3293443760:"IFCCONTROL",25142252:"IFCCONTROLLER",578613899:"IFCCONTROLLERTYPE",2889183280:"IFCCONVERSIONBASEDUNIT",2713554722:"IFCCONVERSIONBASEDUNITWITHOFFSET",4136498852:"IFCCOOLEDBEAM",335055490:"IFCCOOLEDBEAMTYPE",3640358203:"IFCCOOLINGTOWER",2954562838:"IFCCOOLINGTOWERTYPE",1785450214:"IFCCOORDINATEOPERATION",1466758467:"IFCCOORDINATEREFERENCESYSTEM",3895139033:"IFCCOSTITEM",1419761937:"IFCCOSTSCHEDULE",602808272:"IFCCOSTVALUE",1973544240:"IFCCOVERING",1916426348:"IFCCOVERINGTYPE",3295246426:"IFCCREWRESOURCE",1815067380:"IFCCREWRESOURCETYPE",2506170314:"IFCCSGPRIMITIVE3D",2147822146:"IFCCSGSOLID",539742890:"IFCCURRENCYRELATIONSHIP",3495092785:"IFCCURTAINWALL",1457835157:"IFCCURTAINWALLTYPE",2601014836:"IFCCURVE",2827736869:"IFCCURVEBOUNDEDPLANE",2629017746:"IFCCURVEBOUNDEDSURFACE",1186437898:"IFCCURVESEGMENT2D",3800577675:"IFCCURVESTYLE",1105321065:"IFCCURVESTYLEFONT",2367409068:"IFCCURVESTYLEFONTANDSCALING",3510044353:"IFCCURVESTYLEFONTPATTERN",1213902940:"IFCCYLINDRICALSURFACE",4074379575:"IFCDAMPER",3961806047:"IFCDAMPERTYPE",3426335179:"IFCDEEPFOUNDATION",1306400036:"IFCDEEPFOUNDATIONTYPE",3632507154:"IFCDERIVEDPROFILEDEF",1765591967:"IFCDERIVEDUNIT",1045800335:"IFCDERIVEDUNITELEMENT",2949456006:"IFCDIMENSIONALEXPONENTS",32440307:"IFCDIRECTION",1335981549:"IFCDISCRETEACCESSORY",2635815018:"IFCDISCRETEACCESSORYTYPE",1945343521:"IFCDISTANCEEXPRESSION",1052013943:"IFCDISTRIBUTIONCHAMBERELEMENT",1599208980:"IFCDISTRIBUTIONCHAMBERELEMENTTYPE",562808652:"IFCDISTRIBUTIONCIRCUIT",1062813311:"IFCDISTRIBUTIONCONTROLELEMENT",2063403501:"IFCDISTRIBUTIONCONTROLELEMENTTYPE",1945004755:"IFCDISTRIBUTIONELEMENT",3256556792:"IFCDISTRIBUTIONELEMENTTYPE",3040386961:"IFCDISTRIBUTIONFLOWELEMENT",3849074793:"IFCDISTRIBUTIONFLOWELEMENTTYPE",3041715199:"IFCDISTRIBUTIONPORT",3205830791:"IFCDISTRIBUTIONSYSTEM",1154170062:"IFCDOCUMENTINFORMATION",770865208:"IFCDOCUMENTINFORMATIONRELATIONSHIP",3732053477:"IFCDOCUMENTREFERENCE",395920057:"IFCDOOR",2963535650:"IFCDOORLININGPROPERTIES",1714330368:"IFCDOORPANELPROPERTIES",3242481149:"IFCDOORSTANDARDCASE",526551008:"IFCDOORSTYLE",2323601079:"IFCDOORTYPE",445594917:"IFCDRAUGHTINGPREDEFINEDCOLOUR",4006246654:"IFCDRAUGHTINGPREDEFINEDCURVEFONT",342316401:"IFCDUCTFITTING",869906466:"IFCDUCTFITTINGTYPE",3518393246:"IFCDUCTSEGMENT",3760055223:"IFCDUCTSEGMENTTYPE",1360408905:"IFCDUCTSILENCER",2030761528:"IFCDUCTSILENCERTYPE",3900360178:"IFCEDGE",476780140:"IFCEDGECURVE",1472233963:"IFCEDGELOOP",1904799276:"IFCELECTRICAPPLIANCE",663422040:"IFCELECTRICAPPLIANCETYPE",862014818:"IFCELECTRICDISTRIBUTIONBOARD",2417008758:"IFCELECTRICDISTRIBUTIONBOARDTYPE",3310460725:"IFCELECTRICFLOWSTORAGEDEVICE",3277789161:"IFCELECTRICFLOWSTORAGEDEVICETYPE",264262732:"IFCELECTRICGENERATOR",1534661035:"IFCELECTRICGENERATORTYPE",402227799:"IFCELECTRICMOTOR",1217240411:"IFCELECTRICMOTORTYPE",1003880860:"IFCELECTRICTIMECONTROL",712377611:"IFCELECTRICTIMECONTROLTYPE",1758889154:"IFCELEMENT",4123344466:"IFCELEMENTASSEMBLY",2397081782:"IFCELEMENTASSEMBLYTYPE",1623761950:"IFCELEMENTCOMPONENT",2590856083:"IFCELEMENTCOMPONENTTYPE",1883228015:"IFCELEMENTQUANTITY",339256511:"IFCELEMENTTYPE",2777663545:"IFCELEMENTARYSURFACE",1704287377:"IFCELLIPSE",2835456948:"IFCELLIPSEPROFILEDEF",1658829314:"IFCENERGYCONVERSIONDEVICE",2107101300:"IFCENERGYCONVERSIONDEVICETYPE",2814081492:"IFCENGINE",132023988:"IFCENGINETYPE",3747195512:"IFCEVAPORATIVECOOLER",3174744832:"IFCEVAPORATIVECOOLERTYPE",484807127:"IFCEVAPORATOR",3390157468:"IFCEVAPORATORTYPE",4148101412:"IFCEVENT",211053100:"IFCEVENTTIME",4024345920:"IFCEVENTTYPE",297599258:"IFCEXTENDEDPROPERTIES",4294318154:"IFCEXTERNALINFORMATION",3200245327:"IFCEXTERNALREFERENCE",1437805879:"IFCEXTERNALREFERENCERELATIONSHIP",1209101575:"IFCEXTERNALSPATIALELEMENT",2853485674:"IFCEXTERNALSPATIALSTRUCTUREELEMENT",2242383968:"IFCEXTERNALLYDEFINEDHATCHSTYLE",1040185647:"IFCEXTERNALLYDEFINEDSURFACESTYLE",3548104201:"IFCEXTERNALLYDEFINEDTEXTFONT",477187591:"IFCEXTRUDEDAREASOLID",2804161546:"IFCEXTRUDEDAREASOLIDTAPERED",2556980723:"IFCFACE",2047409740:"IFCFACEBASEDSURFACEMODEL",1809719519:"IFCFACEBOUND",803316827:"IFCFACEOUTERBOUND",3008276851:"IFCFACESURFACE",807026263:"IFCFACETEDBREP",3737207727:"IFCFACETEDBREPWITHVOIDS",24185140:"IFCFACILITY",1310830890:"IFCFACILITYPART",4219587988:"IFCFAILURECONNECTIONCONDITION",3415622556:"IFCFAN",346874300:"IFCFANTYPE",647756555:"IFCFASTENER",2489546625:"IFCFASTENERTYPE",2827207264:"IFCFEATUREELEMENT",2143335405:"IFCFEATUREELEMENTADDITION",1287392070:"IFCFEATUREELEMENTSUBTRACTION",738692330:"IFCFILLAREASTYLE",374418227:"IFCFILLAREASTYLEHATCHING",315944413:"IFCFILLAREASTYLETILES",819412036:"IFCFILTER",1810631287:"IFCFILTERTYPE",1426591983:"IFCFIRESUPPRESSIONTERMINAL",4222183408:"IFCFIRESUPPRESSIONTERMINALTYPE",2652556860:"IFCFIXEDREFERENCESWEPTAREASOLID",2058353004:"IFCFLOWCONTROLLER",3907093117:"IFCFLOWCONTROLLERTYPE",4278956645:"IFCFLOWFITTING",3198132628:"IFCFLOWFITTINGTYPE",182646315:"IFCFLOWINSTRUMENT",4037862832:"IFCFLOWINSTRUMENTTYPE",2188021234:"IFCFLOWMETER",3815607619:"IFCFLOWMETERTYPE",3132237377:"IFCFLOWMOVINGDEVICE",1482959167:"IFCFLOWMOVINGDEVICETYPE",987401354:"IFCFLOWSEGMENT",1834744321:"IFCFLOWSEGMENTTYPE",707683696:"IFCFLOWSTORAGEDEVICE",1339347760:"IFCFLOWSTORAGEDEVICETYPE",2223149337:"IFCFLOWTERMINAL",2297155007:"IFCFLOWTERMINALTYPE",3508470533:"IFCFLOWTREATMENTDEVICE",3009222698:"IFCFLOWTREATMENTDEVICETYPE",900683007:"IFCFOOTING",1893162501:"IFCFOOTINGTYPE",263784265:"IFCFURNISHINGELEMENT",4238390223:"IFCFURNISHINGELEMENTTYPE",1509553395:"IFCFURNITURE",1268542332:"IFCFURNITURETYPE",3493046030:"IFCGEOGRAPHICELEMENT",4095422895:"IFCGEOGRAPHICELEMENTTYPE",987898635:"IFCGEOMETRICCURVESET",3448662350:"IFCGEOMETRICREPRESENTATIONCONTEXT",2453401579:"IFCGEOMETRICREPRESENTATIONITEM",4142052618:"IFCGEOMETRICREPRESENTATIONSUBCONTEXT",3590301190:"IFCGEOMETRICSET",3009204131:"IFCGRID",852622518:"IFCGRIDAXIS",178086475:"IFCGRIDPLACEMENT",2706460486:"IFCGROUP",812098782:"IFCHALFSPACESOLID",3319311131:"IFCHEATEXCHANGER",1251058090:"IFCHEATEXCHANGERTYPE",2068733104:"IFCHUMIDIFIER",1806887404:"IFCHUMIDIFIERTYPE",1484403080:"IFCISHAPEPROFILEDEF",3905492369:"IFCIMAGETEXTURE",3570813810:"IFCINDEXEDCOLOURMAP",2571569899:"IFCINDEXEDPOLYCURVE",178912537:"IFCINDEXEDPOLYGONALFACE",2294589976:"IFCINDEXEDPOLYGONALFACEWITHVOIDS",1437953363:"IFCINDEXEDTEXTUREMAP",2133299955:"IFCINDEXEDTRIANGLETEXTUREMAP",4175244083:"IFCINTERCEPTOR",3946677679:"IFCINTERCEPTORTYPE",3113134337:"IFCINTERSECTIONCURVE",2391368822:"IFCINVENTORY",3741457305:"IFCIRREGULARTIMESERIES",3020489413:"IFCIRREGULARTIMESERIESVALUE",2176052936:"IFCJUNCTIONBOX",4288270099:"IFCJUNCTIONBOXTYPE",572779678:"IFCLSHAPEPROFILEDEF",3827777499:"IFCLABORRESOURCE",428585644:"IFCLABORRESOURCETYPE",1585845231:"IFCLAGTIME",76236018:"IFCLAMP",1051575348:"IFCLAMPTYPE",2655187982:"IFCLIBRARYINFORMATION",3452421091:"IFCLIBRARYREFERENCE",4162380809:"IFCLIGHTDISTRIBUTIONDATA",629592764:"IFCLIGHTFIXTURE",1161773419:"IFCLIGHTFIXTURETYPE",1566485204:"IFCLIGHTINTENSITYDISTRIBUTION",1402838566:"IFCLIGHTSOURCE",125510826:"IFCLIGHTSOURCEAMBIENT",2604431987:"IFCLIGHTSOURCEDIRECTIONAL",4266656042:"IFCLIGHTSOURCEGONIOMETRIC",1520743889:"IFCLIGHTSOURCEPOSITIONAL",3422422726:"IFCLIGHTSOURCESPOT",1281925730:"IFCLINE",3092502836:"IFCLINESEGMENT2D",388784114:"IFCLINEARPLACEMENT",1154579445:"IFCLINEARPOSITIONINGELEMENT",2624227202:"IFCLOCALPLACEMENT",1008929658:"IFCLOOP",1425443689:"IFCMANIFOLDSOLIDBREP",3057273783:"IFCMAPCONVERSION",2347385850:"IFCMAPPEDITEM",1838606355:"IFCMATERIAL",1847130766:"IFCMATERIALCLASSIFICATIONRELATIONSHIP",3708119e3:"IFCMATERIALCONSTITUENT",2852063980:"IFCMATERIALCONSTITUENTSET",760658860:"IFCMATERIALDEFINITION",2022407955:"IFCMATERIALDEFINITIONREPRESENTATION",248100487:"IFCMATERIALLAYER",3303938423:"IFCMATERIALLAYERSET",1303795690:"IFCMATERIALLAYERSETUSAGE",1847252529:"IFCMATERIALLAYERWITHOFFSETS",2199411900:"IFCMATERIALLIST",2235152071:"IFCMATERIALPROFILE",164193824:"IFCMATERIALPROFILESET",3079605661:"IFCMATERIALPROFILESETUSAGE",3404854881:"IFCMATERIALPROFILESETUSAGETAPERING",552965576:"IFCMATERIALPROFILEWITHOFFSETS",3265635763:"IFCMATERIALPROPERTIES",853536259:"IFCMATERIALRELATIONSHIP",1507914824:"IFCMATERIALUSAGEDEFINITION",2597039031:"IFCMEASUREWITHUNIT",377706215:"IFCMECHANICALFASTENER",2108223431:"IFCMECHANICALFASTENERTYPE",1437502449:"IFCMEDICALDEVICE",1114901282:"IFCMEDICALDEVICETYPE",1073191201:"IFCMEMBER",1911478936:"IFCMEMBERSTANDARDCASE",3181161470:"IFCMEMBERTYPE",3368373690:"IFCMETRIC",2998442950:"IFCMIRROREDPROFILEDEF",2706619895:"IFCMONETARYUNIT",2474470126:"IFCMOTORCONNECTION",977012517:"IFCMOTORCONNECTIONTYPE",1918398963:"IFCNAMEDUNIT",3888040117:"IFCOBJECT",219451334:"IFCOBJECTDEFINITION",3701648758:"IFCOBJECTPLACEMENT",2251480897:"IFCOBJECTIVE",4143007308:"IFCOCCUPANT",590820931:"IFCOFFSETCURVE",3388369263:"IFCOFFSETCURVE2D",3505215534:"IFCOFFSETCURVE3D",2485787929:"IFCOFFSETCURVEBYDISTANCES",2665983363:"IFCOPENSHELL",3588315303:"IFCOPENINGELEMENT",3079942009:"IFCOPENINGSTANDARDCASE",4251960020:"IFCORGANIZATION",1411181986:"IFCORGANIZATIONRELATIONSHIP",643959842:"IFCORIENTATIONEXPRESSION",1029017970:"IFCORIENTEDEDGE",144952367:"IFCOUTERBOUNDARYCURVE",3694346114:"IFCOUTLET",2837617999:"IFCOUTLETTYPE",1207048766:"IFCOWNERHISTORY",2529465313:"IFCPARAMETERIZEDPROFILEDEF",2519244187:"IFCPATH",1682466193:"IFCPCURVE",2382730787:"IFCPERFORMANCEHISTORY",3566463478:"IFCPERMEABLECOVERINGPROPERTIES",3327091369:"IFCPERMIT",2077209135:"IFCPERSON",101040310:"IFCPERSONANDORGANIZATION",3021840470:"IFCPHYSICALCOMPLEXQUANTITY",2483315170:"IFCPHYSICALQUANTITY",2226359599:"IFCPHYSICALSIMPLEQUANTITY",1687234759:"IFCPILE",1158309216:"IFCPILETYPE",310824031:"IFCPIPEFITTING",804291784:"IFCPIPEFITTINGTYPE",3612865200:"IFCPIPESEGMENT",4231323485:"IFCPIPESEGMENTTYPE",597895409:"IFCPIXELTEXTURE",2004835150:"IFCPLACEMENT",603570806:"IFCPLANARBOX",1663979128:"IFCPLANAREXTENT",220341763:"IFCPLANE",3171933400:"IFCPLATE",1156407060:"IFCPLATESTANDARDCASE",4017108033:"IFCPLATETYPE",2067069095:"IFCPOINT",4022376103:"IFCPOINTONCURVE",1423911732:"IFCPOINTONSURFACE",2924175390:"IFCPOLYLOOP",2775532180:"IFCPOLYGONALBOUNDEDHALFSPACE",2839578677:"IFCPOLYGONALFACESET",3724593414:"IFCPOLYLINE",3740093272:"IFCPORT",1946335990:"IFCPOSITIONINGELEMENT",3355820592:"IFCPOSTALADDRESS",759155922:"IFCPREDEFINEDCOLOUR",2559016684:"IFCPREDEFINEDCURVEFONT",3727388367:"IFCPREDEFINEDITEM",3778827333:"IFCPREDEFINEDPROPERTIES",3967405729:"IFCPREDEFINEDPROPERTYSET",1775413392:"IFCPREDEFINEDTEXTFONT",677532197:"IFCPRESENTATIONITEM",2022622350:"IFCPRESENTATIONLAYERASSIGNMENT",1304840413:"IFCPRESENTATIONLAYERWITHSTYLE",3119450353:"IFCPRESENTATIONSTYLE",2417041796:"IFCPRESENTATIONSTYLEASSIGNMENT",2744685151:"IFCPROCEDURE",569719735:"IFCPROCEDURETYPE",2945172077:"IFCPROCESS",4208778838:"IFCPRODUCT",673634403:"IFCPRODUCTDEFINITIONSHAPE",2095639259:"IFCPRODUCTREPRESENTATION",3958567839:"IFCPROFILEDEF",2802850158:"IFCPROFILEPROPERTIES",103090709:"IFCPROJECT",653396225:"IFCPROJECTLIBRARY",2904328755:"IFCPROJECTORDER",3843373140:"IFCPROJECTEDCRS",3651124850:"IFCPROJECTIONELEMENT",2598011224:"IFCPROPERTY",986844984:"IFCPROPERTYABSTRACTION",871118103:"IFCPROPERTYBOUNDEDVALUE",1680319473:"IFCPROPERTYDEFINITION",148025276:"IFCPROPERTYDEPENDENCYRELATIONSHIP",4166981789:"IFCPROPERTYENUMERATEDVALUE",3710013099:"IFCPROPERTYENUMERATION",2752243245:"IFCPROPERTYLISTVALUE",941946838:"IFCPROPERTYREFERENCEVALUE",1451395588:"IFCPROPERTYSET",3357820518:"IFCPROPERTYSETDEFINITION",492091185:"IFCPROPERTYSETTEMPLATE",3650150729:"IFCPROPERTYSINGLEVALUE",110355661:"IFCPROPERTYTABLEVALUE",3521284610:"IFCPROPERTYTEMPLATE",1482703590:"IFCPROPERTYTEMPLATEDEFINITION",738039164:"IFCPROTECTIVEDEVICE",2295281155:"IFCPROTECTIVEDEVICETRIPPINGUNIT",655969474:"IFCPROTECTIVEDEVICETRIPPINGUNITTYPE",1842657554:"IFCPROTECTIVEDEVICETYPE",3219374653:"IFCPROXY",90941305:"IFCPUMP",2250791053:"IFCPUMPTYPE",2044713172:"IFCQUANTITYAREA",2093928680:"IFCQUANTITYCOUNT",931644368:"IFCQUANTITYLENGTH",2090586900:"IFCQUANTITYSET",3252649465:"IFCQUANTITYTIME",2405470396:"IFCQUANTITYVOLUME",825690147:"IFCQUANTITYWEIGHT",2262370178:"IFCRAILING",2893384427:"IFCRAILINGTYPE",3024970846:"IFCRAMP",3283111854:"IFCRAMPFLIGHT",2324767716:"IFCRAMPFLIGHTTYPE",1469900589:"IFCRAMPTYPE",1232101972:"IFCRATIONALBSPLINECURVEWITHKNOTS",683857671:"IFCRATIONALBSPLINESURFACEWITHKNOTS",2770003689:"IFCRECTANGLEHOLLOWPROFILEDEF",3615266464:"IFCRECTANGLEPROFILEDEF",2798486643:"IFCRECTANGULARPYRAMID",3454111270:"IFCRECTANGULARTRIMMEDSURFACE",3915482550:"IFCRECURRENCEPATTERN",2433181523:"IFCREFERENCE",4021432810:"IFCREFERENT",3413951693:"IFCREGULARTIMESERIES",1580146022:"IFCREINFORCEMENTBARPROPERTIES",3765753017:"IFCREINFORCEMENTDEFINITIONPROPERTIES",979691226:"IFCREINFORCINGBAR",2572171363:"IFCREINFORCINGBARTYPE",3027567501:"IFCREINFORCINGELEMENT",964333572:"IFCREINFORCINGELEMENTTYPE",2320036040:"IFCREINFORCINGMESH",2310774935:"IFCREINFORCINGMESHTYPE",160246688:"IFCRELAGGREGATES",3939117080:"IFCRELASSIGNS",1683148259:"IFCRELASSIGNSTOACTOR",2495723537:"IFCRELASSIGNSTOCONTROL",1307041759:"IFCRELASSIGNSTOGROUP",1027710054:"IFCRELASSIGNSTOGROUPBYFACTOR",4278684876:"IFCRELASSIGNSTOPROCESS",2857406711:"IFCRELASSIGNSTOPRODUCT",205026976:"IFCRELASSIGNSTORESOURCE",1865459582:"IFCRELASSOCIATES",4095574036:"IFCRELASSOCIATESAPPROVAL",919958153:"IFCRELASSOCIATESCLASSIFICATION",2728634034:"IFCRELASSOCIATESCONSTRAINT",982818633:"IFCRELASSOCIATESDOCUMENT",3840914261:"IFCRELASSOCIATESLIBRARY",2655215786:"IFCRELASSOCIATESMATERIAL",826625072:"IFCRELCONNECTS",1204542856:"IFCRELCONNECTSELEMENTS",3945020480:"IFCRELCONNECTSPATHELEMENTS",4201705270:"IFCRELCONNECTSPORTTOELEMENT",3190031847:"IFCRELCONNECTSPORTS",2127690289:"IFCRELCONNECTSSTRUCTURALACTIVITY",1638771189:"IFCRELCONNECTSSTRUCTURALMEMBER",504942748:"IFCRELCONNECTSWITHECCENTRICITY",3678494232:"IFCRELCONNECTSWITHREALIZINGELEMENTS",3242617779:"IFCRELCONTAINEDINSPATIALSTRUCTURE",886880790:"IFCRELCOVERSBLDGELEMENTS",2802773753:"IFCRELCOVERSSPACES",2565941209:"IFCRELDECLARES",2551354335:"IFCRELDECOMPOSES",693640335:"IFCRELDEFINES",1462361463:"IFCRELDEFINESBYOBJECT",4186316022:"IFCRELDEFINESBYPROPERTIES",307848117:"IFCRELDEFINESBYTEMPLATE",781010003:"IFCRELDEFINESBYTYPE",3940055652:"IFCRELFILLSELEMENT",279856033:"IFCRELFLOWCONTROLELEMENTS",427948657:"IFCRELINTERFERESELEMENTS",3268803585:"IFCRELNESTS",1441486842:"IFCRELPOSITIONS",750771296:"IFCRELPROJECTSELEMENT",1245217292:"IFCRELREFERENCEDINSPATIALSTRUCTURE",4122056220:"IFCRELSEQUENCE",366585022:"IFCRELSERVICESBUILDINGS",3451746338:"IFCRELSPACEBOUNDARY",3523091289:"IFCRELSPACEBOUNDARY1STLEVEL",1521410863:"IFCRELSPACEBOUNDARY2NDLEVEL",1401173127:"IFCRELVOIDSELEMENT",478536968:"IFCRELATIONSHIP",816062949:"IFCREPARAMETRISEDCOMPOSITECURVESEGMENT",1076942058:"IFCREPRESENTATION",3377609919:"IFCREPRESENTATIONCONTEXT",3008791417:"IFCREPRESENTATIONITEM",1660063152:"IFCREPRESENTATIONMAP",2914609552:"IFCRESOURCE",2943643501:"IFCRESOURCEAPPROVALRELATIONSHIP",1608871552:"IFCRESOURCECONSTRAINTRELATIONSHIP",2439245199:"IFCRESOURCELEVELRELATIONSHIP",1042787934:"IFCRESOURCETIME",1856042241:"IFCREVOLVEDAREASOLID",3243963512:"IFCREVOLVEDAREASOLIDTAPERED",4158566097:"IFCRIGHTCIRCULARCONE",3626867408:"IFCRIGHTCIRCULARCYLINDER",2016517767:"IFCROOF",2781568857:"IFCROOFTYPE",2341007311:"IFCROOT",2778083089:"IFCROUNDEDRECTANGLEPROFILEDEF",448429030:"IFCSIUNIT",3053780830:"IFCSANITARYTERMINAL",1768891740:"IFCSANITARYTERMINALTYPE",1054537805:"IFCSCHEDULINGTIME",2157484638:"IFCSEAMCURVE",2042790032:"IFCSECTIONPROPERTIES",4165799628:"IFCSECTIONREINFORCEMENTPROPERTIES",1862484736:"IFCSECTIONEDSOLID",1290935644:"IFCSECTIONEDSOLIDHORIZONTAL",1509187699:"IFCSECTIONEDSPINE",4086658281:"IFCSENSOR",1783015770:"IFCSENSORTYPE",1329646415:"IFCSHADINGDEVICE",4074543187:"IFCSHADINGDEVICETYPE",867548509:"IFCSHAPEASPECT",3982875396:"IFCSHAPEMODEL",4240577450:"IFCSHAPEREPRESENTATION",4124623270:"IFCSHELLBASEDSURFACEMODEL",3692461612:"IFCSIMPLEPROPERTY",3663146110:"IFCSIMPLEPROPERTYTEMPLATE",4097777520:"IFCSITE",1529196076:"IFCSLAB",3127900445:"IFCSLABELEMENTEDCASE",3027962421:"IFCSLABSTANDARDCASE",2533589738:"IFCSLABTYPE",2609359061:"IFCSLIPPAGECONNECTIONCONDITION",3420628829:"IFCSOLARDEVICE",1072016465:"IFCSOLARDEVICETYPE",723233188:"IFCSOLIDMODEL",3856911033:"IFCSPACE",1999602285:"IFCSPACEHEATER",1305183839:"IFCSPACEHEATERTYPE",3812236995:"IFCSPACETYPE",1412071761:"IFCSPATIALELEMENT",710998568:"IFCSPATIALELEMENTTYPE",2706606064:"IFCSPATIALSTRUCTUREELEMENT",3893378262:"IFCSPATIALSTRUCTUREELEMENTTYPE",463610769:"IFCSPATIALZONE",2481509218:"IFCSPATIALZONETYPE",451544542:"IFCSPHERE",4015995234:"IFCSPHERICALSURFACE",1404847402:"IFCSTACKTERMINAL",3112655638:"IFCSTACKTERMINALTYPE",331165859:"IFCSTAIR",4252922144:"IFCSTAIRFLIGHT",1039846685:"IFCSTAIRFLIGHTTYPE",338393293:"IFCSTAIRTYPE",682877961:"IFCSTRUCTURALACTION",3544373492:"IFCSTRUCTURALACTIVITY",2515109513:"IFCSTRUCTURALANALYSISMODEL",1179482911:"IFCSTRUCTURALCONNECTION",2273995522:"IFCSTRUCTURALCONNECTIONCONDITION",1004757350:"IFCSTRUCTURALCURVEACTION",4243806635:"IFCSTRUCTURALCURVECONNECTION",214636428:"IFCSTRUCTURALCURVEMEMBER",2445595289:"IFCSTRUCTURALCURVEMEMBERVARYING",2757150158:"IFCSTRUCTURALCURVEREACTION",3136571912:"IFCSTRUCTURALITEM",1807405624:"IFCSTRUCTURALLINEARACTION",2162789131:"IFCSTRUCTURALLOAD",385403989:"IFCSTRUCTURALLOADCASE",3478079324:"IFCSTRUCTURALLOADCONFIGURATION",1252848954:"IFCSTRUCTURALLOADGROUP",1595516126:"IFCSTRUCTURALLOADLINEARFORCE",609421318:"IFCSTRUCTURALLOADORRESULT",2668620305:"IFCSTRUCTURALLOADPLANARFORCE",2473145415:"IFCSTRUCTURALLOADSINGLEDISPLACEMENT",1973038258:"IFCSTRUCTURALLOADSINGLEDISPLACEMENTDISTORTION",1597423693:"IFCSTRUCTURALLOADSINGLEFORCE",1190533807:"IFCSTRUCTURALLOADSINGLEFORCEWARPING",2525727697:"IFCSTRUCTURALLOADSTATIC",3408363356:"IFCSTRUCTURALLOADTEMPERATURE",530289379:"IFCSTRUCTURALMEMBER",1621171031:"IFCSTRUCTURALPLANARACTION",2082059205:"IFCSTRUCTURALPOINTACTION",734778138:"IFCSTRUCTURALPOINTCONNECTION",1235345126:"IFCSTRUCTURALPOINTREACTION",3689010777:"IFCSTRUCTURALREACTION",2986769608:"IFCSTRUCTURALRESULTGROUP",3657597509:"IFCSTRUCTURALSURFACEACTION",1975003073:"IFCSTRUCTURALSURFACECONNECTION",3979015343:"IFCSTRUCTURALSURFACEMEMBER",2218152070:"IFCSTRUCTURALSURFACEMEMBERVARYING",603775116:"IFCSTRUCTURALSURFACEREACTION",2830218821:"IFCSTYLEMODEL",3958052878:"IFCSTYLEDITEM",3049322572:"IFCSTYLEDREPRESENTATION",148013059:"IFCSUBCONTRACTRESOURCE",4095615324:"IFCSUBCONTRACTRESOURCETYPE",2233826070:"IFCSUBEDGE",2513912981:"IFCSURFACE",699246055:"IFCSURFACECURVE",2028607225:"IFCSURFACECURVESWEPTAREASOLID",3101698114:"IFCSURFACEFEATURE",2809605785:"IFCSURFACEOFLINEAREXTRUSION",4124788165:"IFCSURFACEOFREVOLUTION",2934153892:"IFCSURFACEREINFORCEMENTAREA",1300840506:"IFCSURFACESTYLE",3303107099:"IFCSURFACESTYLELIGHTING",1607154358:"IFCSURFACESTYLEREFRACTION",1878645084:"IFCSURFACESTYLERENDERING",846575682:"IFCSURFACESTYLESHADING",1351298697:"IFCSURFACESTYLEWITHTEXTURES",626085974:"IFCSURFACETEXTURE",2247615214:"IFCSWEPTAREASOLID",1260650574:"IFCSWEPTDISKSOLID",1096409881:"IFCSWEPTDISKSOLIDPOLYGONAL",230924584:"IFCSWEPTSURFACE",1162798199:"IFCSWITCHINGDEVICE",2315554128:"IFCSWITCHINGDEVICETYPE",2254336722:"IFCSYSTEM",413509423:"IFCSYSTEMFURNITUREELEMENT",1580310250:"IFCSYSTEMFURNITUREELEMENTTYPE",3071757647:"IFCTSHAPEPROFILEDEF",985171141:"IFCTABLE",2043862942:"IFCTABLECOLUMN",531007025:"IFCTABLEROW",812556717:"IFCTANK",5716631:"IFCTANKTYPE",3473067441:"IFCTASK",1549132990:"IFCTASKTIME",2771591690:"IFCTASKTIMERECURRING",3206491090:"IFCTASKTYPE",912023232:"IFCTELECOMADDRESS",3824725483:"IFCTENDON",2347447852:"IFCTENDONANCHOR",3081323446:"IFCTENDONANCHORTYPE",3663046924:"IFCTENDONCONDUIT",2281632017:"IFCTENDONCONDUITTYPE",2415094496:"IFCTENDONTYPE",2387106220:"IFCTESSELLATEDFACESET",901063453:"IFCTESSELLATEDITEM",4282788508:"IFCTEXTLITERAL",3124975700:"IFCTEXTLITERALWITHEXTENT",1447204868:"IFCTEXTSTYLE",1983826977:"IFCTEXTSTYLEFONTMODEL",2636378356:"IFCTEXTSTYLEFORDEFINEDFONT",1640371178:"IFCTEXTSTYLETEXTMODEL",280115917:"IFCTEXTURECOORDINATE",1742049831:"IFCTEXTURECOORDINATEGENERATOR",2552916305:"IFCTEXTUREMAP",1210645708:"IFCTEXTUREVERTEX",3611470254:"IFCTEXTUREVERTEXLIST",1199560280:"IFCTIMEPERIOD",3101149627:"IFCTIMESERIES",581633288:"IFCTIMESERIESVALUE",1377556343:"IFCTOPOLOGICALREPRESENTATIONITEM",1735638870:"IFCTOPOLOGYREPRESENTATION",1935646853:"IFCTOROIDALSURFACE",3825984169:"IFCTRANSFORMER",1692211062:"IFCTRANSFORMERTYPE",2595432518:"IFCTRANSITIONCURVESEGMENT2D",1620046519:"IFCTRANSPORTELEMENT",2097647324:"IFCTRANSPORTELEMENTTYPE",2715220739:"IFCTRAPEZIUMPROFILEDEF",2916149573:"IFCTRIANGULATEDFACESET",1229763772:"IFCTRIANGULATEDIRREGULARNETWORK",3593883385:"IFCTRIMMEDCURVE",3026737570:"IFCTUBEBUNDLE",1600972822:"IFCTUBEBUNDLETYPE",1628702193:"IFCTYPEOBJECT",3736923433:"IFCTYPEPROCESS",2347495698:"IFCTYPEPRODUCT",3698973494:"IFCTYPERESOURCE",427810014:"IFCUSHAPEPROFILEDEF",180925521:"IFCUNITASSIGNMENT",630975310:"IFCUNITARYCONTROLELEMENT",3179687236:"IFCUNITARYCONTROLELEMENTTYPE",4292641817:"IFCUNITARYEQUIPMENT",1911125066:"IFCUNITARYEQUIPMENTTYPE",4207607924:"IFCVALVE",728799441:"IFCVALVETYPE",1417489154:"IFCVECTOR",2799835756:"IFCVERTEX",2759199220:"IFCVERTEXLOOP",1907098498:"IFCVERTEXPOINT",1530820697:"IFCVIBRATIONDAMPER",3956297820:"IFCVIBRATIONDAMPERTYPE",2391383451:"IFCVIBRATIONISOLATOR",3313531582:"IFCVIBRATIONISOLATORTYPE",2769231204:"IFCVIRTUALELEMENT",891718957:"IFCVIRTUALGRIDINTERSECTION",926996030:"IFCVOIDINGFEATURE",2391406946:"IFCWALL",4156078855:"IFCWALLELEMENTEDCASE",3512223829:"IFCWALLSTANDARDCASE",1898987631:"IFCWALLTYPE",4237592921:"IFCWASTETERMINAL",1133259667:"IFCWASTETERMINALTYPE",3304561284:"IFCWINDOW",336235671:"IFCWINDOWLININGPROPERTIES",512836454:"IFCWINDOWPANELPROPERTIES",486154966:"IFCWINDOWSTANDARDCASE",1299126871:"IFCWINDOWSTYLE",4009809668:"IFCWINDOWTYPE",4088093105:"IFCWORKCALENDAR",1028945134:"IFCWORKCONTROL",4218914973:"IFCWORKPLAN",3342526732:"IFCWORKSCHEDULE",1236880293:"IFCWORKTIME",2543172580:"IFCZSHAPEPROFILEDEF",1033361043:"IFCZONE"},pB={aggregates:{name:160246688,relating:"RelatingObject",related:"RelatedObjects",key:"children"},spatial:{name:3242617779,relating:"RelatingStructure",related:"RelatedElements",key:"children"},psets:{name:4186316022,relating:"RelatingPropertyDefinition",related:"RelatedObjects",key:"hasPsets"},materials:{name:2655215786,relating:"RelatingMaterial",related:"RelatedObjects",key:"hasMaterial"},type:{name:781010003,relating:"RelatingType",related:"RelatedObjects",key:"hasType"}},dB=class{constructor(e){this.api=e}getIfcType(e){return cB[e]}getItemProperties(e,t,s=!1){return qv(this,null,(function*(){return this.api.GetLine(e,t,s)}))}getPropertySets(e,t,s=!1){return qv(this,null,(function*(){return yield this.getProperty(e,t,s,pB.psets)}))}getTypeProperties(e,t,s=!1){return qv(this,null,(function*(){return yield this.getProperty(e,t,s,pB.type)}))}getMaterialsProperties(e,t,s=!1){return qv(this,null,(function*(){return yield this.getProperty(e,t,s,pB.materials)}))}getSpatialStructure(e,t){return qv(this,null,(function*(){yield this.getAllTypesOfModel(e);const s=yield this.getSpatialTreeChunks(e),i=(yield this.api.GetLineIDsWithType(e,103090709)).get(0),r=dB.newIfcProject(i);return yield this.getSpatialNode(e,r,s,t),this.cleanupTypes(),r}))}getAllItemsOfType(e,t,s){return qv(this,null,(function*(){let i=[];const r=yield this.api.GetLineIDsWithType(e,t);for(let e=0;e<r.size();e++)i.push(r.get(e));if(!s)return i;const o=[];for(let t=0;t<i.length;t++)o.push(yield this.api.GetLine(e,i[t]));return o}))}getProperty(e,t,s=!1,i){return qv(this,null,(function*(){const r=yield this.getAllRelatedItemsOfType(e,t,i),o=[];for(let t=0;t<r.length;t++)o.push(yield this.api.GetLine(e,r[t],s));return o}))}getChunks(e,t,s){return qv(this,null,(function*(){const i=yield this.api.GetLineIDsWithType(e,s.name);for(let r=0;r<i.size();r++){const o=yield this.api.GetLine(e,i.get(r),!1);this.saveChunk(t,s,o)}}))}static isRelated(e,t,s){const i=t[s.related];if(Array.isArray(i)){return i.map((e=>e.value)).includes(e)}return i.value===e}static newIfcProject(e){return{expressID:e,type:"IFCPROJECT",children:[]}}getSpatialNode(e,t,s,i){return qv(this,null,(function*(){yield this.getChildren(e,t,s,pB.aggregates,i),yield this.getChildren(e,t,s,pB.spatial,i)}))}getChildren(e,t,s,i,r){return qv(this,null,(function*(){const o=s[t.expressID];if(null==o)return;const n=i.key,a=[];for(let t=0;t<o.length;t++){const i=o[t];let n=this.newNode(i);if(r){const t=yield this.getItemProperties(e,n.expressID);n=Jv(Jv({},t),n)}yield this.getSpatialNode(e,n,s,r),a.push(n)}t[n]=a}))}newNode(e){return{expressID:e,type:this.getNodeType(e),children:[]}}getNodeType(e){const t=this.types[e];return uB[t]}getSpatialTreeChunks(e){return qv(this,null,(function*(){const t={};return yield this.getChunks(e,t,pB.aggregates),yield this.getChunks(e,t,pB.spatial),t}))}saveChunk(e,t,s){const i=s[t.relating].value,r=s[t.related].map((e=>e.value));null==e[i]?e[i]=r:e[i]=e[i].concat(r)}getRelated(e,t,s){const i=e[t.relating];Array.isArray(i)?i.forEach((e=>s.push(e.value))):s.push(i.value)}getAllRelatedItemsOfType(e,t,s){return qv(this,null,(function*(){const i=yield this.api.GetLineIDsWithType(e,s.name),r=[];for(let o=0;o<i.size();o++){const n=yield this.api.GetLine(e,i.get(o));dB.isRelated(t,n,s)&&this.getRelated(n,s,r)}return r}))}cleanupTypes(){this.types={}}getAllTypesOfModel(e){return qv(this,null,(function*(){const t={},s=Object.keys(uB).map((e=>parseInt(e)));for(let i=0;i<s.length;i++){const r=s[i],o=yield this.api.GetLineIDsWithType(e,r),n=o.size();for(let e=0;e<n;e++)t[o.get(e)]=r}this.types=t}))}};Uv="undefined"!=typeof self&&self.crossOriginIsolated?eb():tb();class mB{constructor(){}getIFC(e,t,s){var i=()=>{};t=t||i,s=s||i;const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const e=!!r[2];var o=r[3];o=window.decodeURIComponent(o),e&&(o=window.atob(o));try{const e=new ArrayBuffer(o.length),s=new Uint8Array(e);for(var n=0;n<o.length;n++)s[n]=o.charCodeAt(n);t(e)}catch(e){s(e)}}else{const i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t(i.response):s("getXKT error : "+i.response))},i.send(null)}}}class fB extends n{constructor(e,t={}){super("ifcLoader",e,t),this.dataSource=t.dataSource,this.objectDefaults=t.objectDefaults,this.includeTypes=t.includeTypes,this.excludeTypes=t.excludeTypes,this.excludeUnclassifiedObjects=t.excludeUnclassifiedObjects,this._ifcAPI=new class{constructor(){this.wasmModule=void 0,this.fs=void 0,this.wasmPath="",this.isWasmPathAbsolute=!1,this.ifcGuidMap=new Map,this.properties=new dB(this)}Init(e){return qv(this,null,(function*(){if(Uv){let t=(e,t)=>e.endsWith(".wasm")?this.isWasmPathAbsolute?this.wasmPath+e:t+this.wasmPath+e:t+e;this.wasmModule=yield Uv({noInitialRun:!0,locateFile:e||t}),this.fs=this.wasmModule.FS}else console.error("Could not find wasm module at './web-ifc' from web-ifc-api.ts")}))}OpenModel(e,t){let s=Jv({COORDINATE_TO_ORIGIN:!1,USE_FAST_BOOLS:!1,CIRCLE_SEGMENTS_LOW:5,CIRCLE_SEGMENTS_MEDIUM:8,CIRCLE_SEGMENTS_HIGH:12,BOOL_ABORT_THRESHOLD:1e4},t),i=0;return this.wasmModule.OpenModel(s,((t,s)=>{let r=Math.min(e.byteLength-i,s),o=this.wasmModule.HEAPU8.subarray(t,t+s),n=e.subarray(i,i+r);return o.set(n),i+=r,r}))}CreateModel(e){let t=Jv({COORDINATE_TO_ORIGIN:!1,USE_FAST_BOOLS:!1,CIRCLE_SEGMENTS_LOW:5,CIRCLE_SEGMENTS_MEDIUM:8,CIRCLE_SEGMENTS_HIGH:12,BOOL_ABORT_THRESHOLD:1e4},e);return this.wasmModule.CreateModel(t)}ExportFileAsIFC(e){this.wasmModule.ExportFileAsIFC(e);let t=this.fs.readFile("/export.ifc");return this.wasmModule.FS_unlink("/export.ifc"),t}GetGeometry(e,t){return this.wasmModule.GetGeometry(e,t)}GetLine(e,t,s=!1){let i=this.GetRawLineData(e,t),r=ib[i.type](i);return s&&this.FlattenLine(e,r),r}GetAndClearErrors(e){return this.wasmModule.GetAndClearErrors(e)}WriteLine(e,t){Object.keys(t).forEach((s=>{let i=t[s];if(i&&void 0!==i.expressID)this.WriteLine(e,i),t[s]={type:5,value:i.expressID};else if(Array.isArray(i)&&i.length>0)for(let r=0;r<i.length;r++)void 0!==i[r].expressID&&(this.WriteLine(e,i[r]),t[s][r]={type:5,value:i[r].expressID})}));let s={ID:t.expressID,type:t.type,arguments:t.ToTape()};this.WriteRawLineData(e,s)}FlattenLine(e,t){Object.keys(t).forEach((s=>{let i=t[s];if(i&&5===i.type)t[s]=this.GetLine(e,i.value,!0);else if(Array.isArray(i)&&i.length>0&&5===i[0].type)for(let r=0;r<i.length;r++)t[s][r]=this.GetLine(e,i[r].value,!0)}))}GetRawLineData(e,t){return this.wasmModule.GetLine(e,t)}WriteRawLineData(e,t){return this.wasmModule.WriteLine(e,t.ID,t.type,t.arguments)}GetLineIDsWithType(e,t){return this.wasmModule.GetLineIDsWithType(e,t)}GetAllLines(e){return this.wasmModule.GetAllLines(e)}SetGeometryTransformation(e,t){16==t.length?this.wasmModule.SetGeometryTransformation(e,t):console.log(`Bad transformation matrix size: ${t.length}`)}GetCoordinationMatrix(e){return this.wasmModule.GetCoordinationMatrix(e)}GetVertexArray(e,t){return this.getSubArray(this.wasmModule.HEAPF32,e,t)}GetIndexArray(e,t){return this.getSubArray(this.wasmModule.HEAPU32,e,t)}getSubArray(e,t,s){return e.subarray(t/4,t/4+s).slice(0)}CloseModel(e){this.ifcGuidMap.delete(e),this.wasmModule.CloseModel(e)}StreamAllMeshes(e,t){this.wasmModule.StreamAllMeshes(e,t)}StreamAllMeshesWithTypes(e,t,s){this.wasmModule.StreamAllMeshesWithTypes(e,t,s)}IsModelOpen(e){return this.wasmModule.IsModelOpen(e)}LoadAllGeometry(e){return this.wasmModule.LoadAllGeometry(e)}GetFlatMesh(e,t){return this.wasmModule.GetFlatMesh(e,t)}CreateIfcGuidToExpressIdMapping(e){const t=new Map;for(let s=0;s<sb.length;s++){const i=sb[s],r=this.GetLineIDsWithType(e,i),o=r.size();for(let s=0;s<o;s++){const i=r.get(s),o=this.GetLine(e,i).GlobalId.value;t.set(i,o),t.set(o,i)}}this.ifcGuidMap.set(e,t)}SetWasmPath(e,t=!1){this.wasmPath=e,this.isWasmPathAbsolute=t}},t.wasmPath&&this._ifcAPI.SetWasmPath(t.wasmPath),this._ifcAPI.Init().then((()=>{this.fire("initialized",!0,!1)})).catch((e=>{this.error(e)}))}get supportedVersions(){return["2x3","4"]}get dataSource(){return this._dataSource}set dataSource(e){this._dataSource=e||new mB}get objectDefaults(){return this._objectDefaults}set objectDefaults(e){this._objectDefaults=e||K_}get includeTypes(){return this._includeTypes}set includeTypes(e){this._includeTypes=e}get excludeTypes(){return this._excludeTypes}set excludeTypes(e){this._excludeTypes=e}get excludeUnclassifiedObjects(){return this._excludeUnclassifiedObjects}set excludeUnclassifiedObjects(e){this._excludeUnclassifiedObjects=!!e}get globalizeObjectIds(){return this._globalizeObjectIds}set globalizeObjectIds(e){this._globalizeObjectIds=!!e}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new Hc(this.viewer.scene,y.apply(e,{isModel:!0}));if(!e.src&&!e.ifc)return this.error("load() param expected: src or IFC"),t;const s={autoNormals:!0};if(!1!==e.loadMetadata){const t=e.includeTypes||this._includeTypes,i=e.excludeTypes||this._excludeTypes,r=e.objectDefaults||this._objectDefaults;if(t){s.includeTypesMap={};for(let e=0,i=t.length;e<i;e++)s.includeTypesMap[t[e]]=!0}if(i){s.excludeTypesMap={};for(let e=0,t=i.length;e<t;e++)s.excludeTypesMap[i[e]]=!0}r&&(s.objectDefaults=r),s.excludeUnclassifiedObjects=void 0!==e.excludeUnclassifiedObjects?!!e.excludeUnclassifiedObjects:this._excludeUnclassifiedObjects,s.globalizeObjectIds=void 0!==e.globalizeObjectIds?!!e.globalizeObjectIds:this._globalizeObjectIds}return this.on("initialized",(()=>{e.src?this._loadModel(e.src,e,s,t):this._parseModel(e.ifc,e,s,t)})),t}_loadModel(e,t,s,i){const r=this.viewer.scene.canvas.spinner;r.processes++,this._dataSource.getIFC(t.src,(e=>{this._parseModel(e,t,s,i),r.processes--}),(e=>{r.processes--,this.error(e),i.fire("error",e)}))}_parseModel(e,t,s,i){if(i.destroyed)return;const r=t.stats||{};r.sourceFormat="IFC",r.schemaVersion="",r.title="",r.author="",r.created="",r.numMetaObjects=0,r.numPropertySets=0,r.numObjects=0,r.numGeometries=0,r.numTriangles=0,r.numVertices=0,s.wasmPath&&this._ifcAPI.SetWasmPath(s.wasmPath);const o=new Uint8Array(e),n=this._ifcAPI.OpenModel(o),a=this._ifcAPI.GetLineIDsWithType(n,103090709).get(0),h=!1!==t.loadMetadata,l={modelID:n,sceneModel:i,loadMetadata:h,metadata:h?{id:"",projectId:""+a,author:"",createdAt:"",schema:"",creatingApplication:"",metaObjects:[],propertySets:[]}:null,metaObjects:{},options:s,log:function(e){},nextId:0,stats:r};if(h){if(s.includeTypes){l.includeTypes={};for(let e=0,t=s.includeTypes.length;e<t;e++)l.includeTypes[s.includeTypes[e]]=!0}if(s.excludeTypes){l.excludeTypes={};for(let e=0,t=s.excludeTypes.length;e<t;e++)l.excludeTypes[s.excludeTypes[e]]=!0}this._parseMetaObjects(l),this._parsePropertySets(l)}if(this._parseGeometry(l),i.finalize(),h){const e=i.id;this.viewer.metaScene.createMetaModel(e,l.metadata,s)}i.scene.once("tick",(()=>{i.destroyed||(i.scene.fire("modelLoaded",i.id),i.fire("loaded",!0,!1))}))}_parseMetaObjects(e){const t=this._ifcAPI.GetLineIDsWithType(e.modelID,103090709).get(0),s=this._ifcAPI.GetLine(e.modelID,t);this._parseSpatialChildren(e,s)}_parseSpatialChildren(e,t,s){const i=t.__proto__.constructor.name;if(e.includeTypes&&!e.includeTypes[i])return;if(e.excludeTypes&&e.excludeTypes[i])return;this._createMetaObject(e,t,s);const r=t.GlobalId.value;this._parseRelatedItemsOfType(e,t.expressID,"RelatingObject","RelatedObjects",160246688,r),this._parseRelatedItemsOfType(e,t.expressID,"RelatingStructure","RelatedElements",3242617779,r)}_createMetaObject(e,t,s){const i=t.GlobalId.value,r=t.__proto__.constructor.name,o={id:i,name:r,type:t.Name&&""!==t.Name.value?t.Name.value:r,parent:s};e.metadata.metaObjects.push(o),e.metaObjects[i]=o,e.stats.numMetaObjects++}_parseRelatedItemsOfType(e,t,s,i,r,o){const n=this._ifcAPI.GetLineIDsWithType(e.modelID,r);for(let r=0;r<n.size();r++){const a=n.get(r),h=this._ifcAPI.GetLine(e.modelID,a),l=h[s];let u=!1;if(Array.isArray(l)){u=l.map((e=>e.value)).includes(t)}else u=l.value===t;if(u){const t=h[i];if(Array.isArray(t))t.forEach((t=>{const s=this._ifcAPI.GetLine(e.modelID,t.value);this._parseSpatialChildren(e,s,o)}));else{const s=this._ifcAPI.GetLine(e.modelID,t.value);this._parseSpatialChildren(e,s,o)}}}}_parsePropertySets(e){const t=this._ifcAPI.GetLineIDsWithType(e.modelID,4186316022);for(let s=0;s<t.size();s++){let i=t.get(s),r=this._ifcAPI.GetLine(e.modelID,i,!0);if(r){const t=r.RelatingPropertyDefinition;if(!t)continue;const s=t.GlobalId.value,i=t.HasProperties;if(i&&i.length>0){const o="Default",n=t.Name.value,a=[];for(let e=0,t=i.length;e<t;e++){const t=i[e],s=t.Name,r=t.NominalValue;if(s&&r){const e={name:s.value,type:r.type,value:r.value,valueType:r.valueType};t.Description?e.description=t.Description.value:r.description&&(e.description=r.description),a.push(e)}}const h={id:s,type:o,name:n,properties:a};e.metadata.propertySets.push(h),e.stats.numPropertySets++;const l=r.RelatedObjects;if(!l||0===l.length)return;for(let t=0,i=l.length;t<i;t++){const i=l[t].GlobalId.value,r=e.metaObjects[i];r&&(r.propertySetIds||(r.propertySetIds=[]),r.propertySetIds.push(s))}}}}}_parseGeometry(e){this._ifcAPI.StreamAllMeshes(e.modelID,(t=>{const s=t.expressID,i=t.geometries,r=[],o=this._ifcAPI.GetLine(e.modelID,s).GlobalId.value;if(e.loadMetadata){const t=o,s=e.metaObjects[t];if(e.includeTypes&&(!s||!e.includeTypes[s.type]))return;if(e.excludeTypes&&(!s||e.excludeTypes[s.type]))return}const n=p.mat4(),a=p.vec3();for(let t=0,s=i.size();t<s;t++){const s=i.get(t),o=this._ifcAPI.GetGeometry(e.modelID,s.geometryExpressID),h=this._ifcAPI.GetVertexArray(o.GetVertexData(),o.GetVertexDataSize()),l=this._ifcAPI.GetIndexArray(o.GetIndexData(),o.GetIndexDataSize()),u=new Float64Array(h.length/2),c=new Float32Array(h.length/2);for(let e=0,t=0,s=h.length/6;e<s;e++,t+=3)u[t+0]=h[6*e+0],u[t+1]=h[6*e+1],u[t+2]=h[6*e+2];n.set(s.flatTransformation),p.transformPositions3(n,u);const d=W(u,u,a);if(!e.options.autoNormals)for(let e=0,t=0,s=h.length/6;e<s;e++,t+=3)c[t+0]=h[6*e+3],c[t+1]=h[6*e+4],c[t+2]=h[6*e+5];e.stats.numGeometries++,e.stats.numVertices+=u.length/3,e.stats.numTriangles+=l.length/3;const m="mesh"+e.nextId++;e.sceneModel.createMesh({id:m,primitive:"triangles",origin:d?a:null,positions:u,normals:e.options.autoNormals?null:c,indices:l,color:[s.color.x,s.color.y,s.color.z],opacity:s.color.w}),r.push(m)}const h=e.options.globalizeObjectIds?p.globalizeObjectId(e.sceneModel.id,o):o;e.sceneModel.createEntity({id:h,meshIds:r,isObject:!0}),e.stats.numObjects++}))}}class gB{constructor(){}getLAS(e,t,s){var i=()=>{};t=t||i,s=s||i;const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const e=!!r[2];var o=r[3];o=window.decodeURIComponent(o),e&&(o=window.atob(o));try{const e=new ArrayBuffer(o.length),s=new Uint8Array(e);for(var n=0;n<o.length;n++)s[n]=o.charCodeAt(n);t(e)}catch(e){s(e)}}else{const i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t(i.response):s("getXKT error : "+i.response))},i.send(null)}}}const _B={name:"LAS",id:"las",module:"las",version:"3.2.6",worker:!0,extensions:["las","laz"],mimeTypes:["application/octet-stream"],text:!0,binary:!0,tests:["LAS"],options:{las:{shape:"mesh",fp64:!1,skip:1,colorDepth:8}}};class yB extends n{constructor(e,t={}){super("lasLoader",e,t),this.dataSource=t.dataSource,this.skip=t.skip,this.fp64=t.fp64,this.colorDepth=t.colorDepth}get dataSource(){return this._dataSource}set dataSource(e){this._dataSource=e||new gB}get skip(){return this._skip}set skip(e){this._skip=e||1}get fp64(){return this._fp64}set fp64(e){this._fp64=!!e}get colorDepth(){return this._colorDepth}set colorDepth(e){this._colorDepth=e||"auto"}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new Hc(this.viewer.scene,y.apply(e,{isModel:!0}));if(!e.src&&!e.las)return this.error("load() param expected: src or las"),t;const s={las:{skip:this._skip,fp64:this._fp64,colorDepth:this._colorDepth}};if(e.src)this._loadModel(e.src,e,s,t);else{const i=this.viewer.scene.canvas.spinner;i.processes++,this._parseModel(e.las,e,s,t).then((()=>{i.processes--}),(e=>{i.processes--,this.error(e),t.fire("error",e)}))}return t}_loadModel(e,t,s,i){const r=this.viewer.scene.canvas.spinner;r.processes++,this._dataSource.getLAS(t.src,(e=>{this._parseModel(e,t,s,i).then((()=>{r.processes--}),(e=>{r.processes--,this.error(e),i.fire("error",e)}))}),(e=>{r.processes--,this.error(e),i.fire("error",e)}))}_parseModel(e,t,s,i){function r(e){const s=e.value;if(t.rotateX&&s)for(let e=0,t=s.length;e<t;e+=3){const t=s[e+1];s[e+1]=s[e+2],s[e+2]=t}return s}function o(e,t){const s=e.value,i=e.size,r=t.value,o=4*r.length,n=new Uint8Array(o);for(let e=0,t=0,o=0,a=r.length;e<a;e++,o+=i,t+=4)n[t+0]=s[o+0],n[t+1]=s[o+1],n[t+2]=s[o+2],n[t+3]=Math.round(r[e]/65536*255);return n}function n(e){const t=e.intensity,s=4*t.length,i=new Uint8Array(s);for(let e=0,s=0,r=t.length;e<r;e++,s+=4)i[s+0]=0,i[s+1]=0,i[s+2]=0,i[s+3]=Math.round(t[e]/65536*255);return i}return new Promise(((a,h)=>{if(i.destroyed)return void h();const l=t.stats||{};l.sourceFormat="LAS",l.schemaVersion="",l.title="",l.author="",l.created="",l.numMetaObjects=0,l.numPropertySets=0,l.numObjects=0,l.numGeometries=0,l.numTriangles=0,l.numVertices=0;try{ef(e,_B,s).then((e=>{const l=e.attributes,u=e.loaderData,c=void 0!==u.pointsFormatId?u.pointsFormatId:-1;if(!l.POSITION)return i.finalize(),void h("No positions found in file");let d,m;switch(c){case 0:d=r(l.POSITION),m=n(l.intensity);break;case 1:if(!l.intensity)return i.finalize(),void h("No positions found in file");d=r(l.POSITION),m=n(l.intensity);break;case 2:case 3:if(!l.intensity)return i.finalize(),void h("No positions found in file");d=r(l.POSITION),m=o(l.COLOR_0,l.intensity)}i.createMesh({id:"pointsMesh",primitive:"points",positions:d,colorsCompressed:m});const f=p.createUUID();if(i.createEntity({id:f,meshIds:["pointsMesh"],isObject:!0}),i.finalize(),!1!==t.loadMetadata){const e=p.createUUID(),t={projectId:"",author:"",createdAt:"",schema:"",creatingApplication:"",metaObjects:[{id:e,name:"Model",type:"Model"},{id:f,name:"PointCloud (LAS)",type:"PointCloud",parent:e}],propertySets:[]},r=i.id;this.viewer.metaScene.createMetaModel(r,t,s)}i.scene.once("tick",(()=>{i.destroyed||(i.scene.fire("modelLoaded",i.id),i.fire("loaded",!0,!1))})),a()}))}catch(e){i.finalize(),h(e)}}))}}class vB{constructor(){}getCityJSON(e,t,s){y.loadJSON(e,(e=>{t(e)}),(function(e){s(e)}))}}function bB(e,t,s){s=s||2;var i,r,o,n,a,h,l,u=t&&t.length,c=u?t[0]*s:e.length,p=xB(e,0,c,s,!0),d=[];if(!p||p.next===p.prev)return d;if(u&&(p=function(e,t,s,i){var r,o,n,a=[];for(r=0,o=t.length;r<o;r++)(n=xB(e,t[r]*i,r<o-1?t[r+1]*i:e.length,i,!1))===n.next&&(n.steiner=!0),a.push(RB(n));for(a.sort(DB),r=0;r<a.length;r++)AB(a[r],s),s=PB(s,s.next);return s}(e,t,p,s)),e.length>80*s){i=o=e[0],r=n=e[1];for(var m=s;m<c;m+=s)(a=e[m])<i&&(i=a),(h=e[m+1])<r&&(r=h),a>o&&(o=a),h>n&&(n=h);l=0!==(l=Math.max(o-i,n-r))?1/l:0}return TB(p,d,s,i,r,l),d}function xB(e,t,s,i,r){var o,n;if(r===WB(e,t,s,i)>0)for(o=t;o<s;o+=i)n=VB(o,e[o],e[o+1],n);else for(o=s-i;o>=t;o-=i)n=VB(o,e[o],e[o+1],n);return n&&LB(n,n.next)&&(UB(n),n=n.next),n}function PB(e,t){if(!e)return e;t||(t=e);var s,i=e;do{if(s=!1,i.steiner||!LB(i,i.next)&&0!==BB(i.prev,i,i.next))i=i.next;else{if(UB(i),(i=t=i.prev)===i.next)break;s=!0}}while(s||i!==t);return t}function TB(e,t,s,i,r,o,n){if(e){!n&&o&&function(e,t,s,i){var r=e;do{null===r.z&&(r.z=FB(r.x,r.y,t,s,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){var t,s,i,r,o,n,a,h,l=1;do{for(s=e,e=null,o=null,n=0;s;){for(n++,i=s,a=0,t=0;t<l&&(a++,i=i.nextZ);t++);for(h=l;a>0||h>0&&i;)0!==a&&(0===h||!i||s.z<=i.z)?(r=s,s=s.nextZ,a--):(r=i,i=i.nextZ,h--),o?o.nextZ=r:e=r,r.prevZ=o,o=r;s=i}o.nextZ=null,l*=2}while(n>1)}(r)}(e,i,r,o);for(var a,h,l=e;e.prev!==e.next;)if(a=e.prev,h=e.next,o?MB(e,i,r,o):wB(e))t.push(a.i/s),t.push(e.i/s),t.push(h.i/s),UB(e),e=h.next,l=h.next;else if((e=h)===l){n?1===n?TB(e=IB(PB(e),t,s),t,s,i,r,o,2):2===n&&CB(e,t,s,i,r,o):TB(PB(e),t,s,i,r,o,1);break}}}function wB(e){var t=e.prev,s=e,i=e.next;if(BB(t,s,i)>=0)return!1;for(var r=e.next.next;r!==e.prev;){if(SB(t.x,t.y,s.x,s.y,i.x,i.y,r.x,r.y)&&BB(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function MB(e,t,s,i){var r=e.prev,o=e,n=e.next;if(BB(r,o,n)>=0)return!1;for(var a=r.x<o.x?r.x<n.x?r.x:n.x:o.x<n.x?o.x:n.x,h=r.y<o.y?r.y<n.y?r.y:n.y:o.y<n.y?o.y:n.y,l=r.x>o.x?r.x>n.x?r.x:n.x:o.x>n.x?o.x:n.x,u=r.y>o.y?r.y>n.y?r.y:n.y:o.y>n.y?o.y:n.y,c=FB(a,h,t,s,i),p=FB(l,u,t,s,i),d=e.prevZ,m=e.nextZ;d&&d.z>=c&&m&&m.z<=p;){if(d!==e.prev&&d!==e.next&&SB(r.x,r.y,o.x,o.y,n.x,n.y,d.x,d.y)&&BB(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,m!==e.prev&&m!==e.next&&SB(r.x,r.y,o.x,o.y,n.x,n.y,m.x,m.y)&&BB(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;d&&d.z>=c;){if(d!==e.prev&&d!==e.next&&SB(r.x,r.y,o.x,o.y,n.x,n.y,d.x,d.y)&&BB(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;m&&m.z<=p;){if(m!==e.prev&&m!==e.next&&SB(r.x,r.y,o.x,o.y,n.x,n.y,m.x,m.y)&&BB(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function IB(e,t,s){var i=e;do{var r=i.prev,o=i.next.next;!LB(r,o)&&NB(r,i,i.next,o)&&GB(r,o)&&GB(o,r)&&(t.push(r.i/s),t.push(i.i/s),t.push(o.i/s),UB(i),UB(i.next),i=e=o),i=i.next}while(i!==e);return PB(i)}function CB(e,t,s,i,r,o){var n=e;do{for(var a=n.next.next;a!==n.prev;){if(n.i!==a.i&&OB(n,a)){var h=HB(n,a);return n=PB(n,n.next),h=PB(h,h.next),TB(n,t,s,i,r,o),void TB(h,t,s,i,r,o)}a=a.next}n=n.next}while(n!==e)}function DB(e,t){return e.x-t.x}function AB(e,t){if(t=function(e,t){var s,i=t,r=e.x,o=e.y,n=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>n){if(n=a,a===r){if(o===i.y)return i;if(o===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!s)return null;if(r===n)return s;var h,l=s,u=s.x,c=s.y,p=1/0;i=s;do{r>=i.x&&i.x>=u&&r!==i.x&&SB(o<c?r:n,o,u,c,o<c?n:r,o,i.x,i.y)&&(h=Math.abs(o-i.y)/(r-i.x),GB(i,e)&&(h<p||h===p&&(i.x>s.x||i.x===s.x&&EB(s,i)))&&(s=i,p=h)),i=i.next}while(i!==l);return s}(e,t),t){var s=HB(t,e);PB(t,t.next),PB(s,s.next)}}function EB(e,t){return BB(e.prev,e,t.prev)<0&&BB(t.next,e,e.next)<0}function FB(e,t,s,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function RB(e){var t=e,s=e;do{(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next}while(t!==e);return s}function SB(e,t,s,i,r,o,n,a){return(r-n)*(t-a)-(e-n)*(o-a)>=0&&(e-n)*(i-a)-(s-n)*(t-a)>=0&&(s-n)*(o-a)-(r-n)*(i-a)>=0}function OB(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var s=e;do{if(s.i!==e.i&&s.next.i!==e.i&&s.i!==t.i&&s.next.i!==t.i&&NB(s,s.next,e,t))return!0;s=s.next}while(s!==e);return!1}(e,t)&&(GB(e,t)&&GB(t,e)&&function(e,t){var s=e,i=!1,r=(e.x+t.x)/2,o=(e.y+t.y)/2;do{s.y>o!=s.next.y>o&&s.next.y!==s.y&&r<(s.next.x-s.x)*(o-s.y)/(s.next.y-s.y)+s.x&&(i=!i),s=s.next}while(s!==e);return i}(e,t)&&(BB(e.prev,e,t.prev)||BB(e,t.prev,t))||LB(e,t)&&BB(e.prev,e,e.next)>0&&BB(t.prev,t,t.next)>0)}function BB(e,t,s){return(t.y-e.y)*(s.x-t.x)-(t.x-e.x)*(s.y-t.y)}function LB(e,t){return e.x===t.x&&e.y===t.y}function NB(e,t,s,i){var r=jB(BB(e,t,s)),o=jB(BB(e,t,i)),n=jB(BB(s,i,e)),a=jB(BB(s,i,t));return r!==o&&n!==a||(!(0!==r||!kB(e,s,t))||(!(0!==o||!kB(e,i,t))||(!(0!==n||!kB(s,e,i))||!(0!==a||!kB(s,t,i)))))}function kB(e,t,s){return t.x<=Math.max(e.x,s.x)&&t.x>=Math.min(e.x,s.x)&&t.y<=Math.max(e.y,s.y)&&t.y>=Math.min(e.y,s.y)}function jB(e){return e>0?1:e<0?-1:0}function GB(e,t){return BB(e.prev,e,e.next)<0?BB(e,t,e.next)>=0&&BB(e,e.prev,t)>=0:BB(e,t,e.prev)<0||BB(e,e.next,t)<0}function HB(e,t){var s=new zB(e.i,e.x,e.y),i=new zB(t.i,t.x,t.y),r=e.next,o=t.prev;return e.next=t,t.prev=e,s.next=r,r.prev=s,i.next=s,s.prev=i,o.next=i,i.prev=o,i}function VB(e,t,s,i){var r=new zB(e,t,s);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function UB(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function zB(e,t,s){this.i=e,this.x=t,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function WB(e,t,s,i){for(var r=0,o=t,n=s-i;o<s;o+=i)r+=(e[n]-e[o])*(e[o+1]+e[n+1]),n=o;return r}bB.deviation=function(e,t,s,i){var r=t&&t.length,o=r?t[0]*s:e.length,n=Math.abs(WB(e,0,o,s));if(r)for(var a=0,h=t.length;a<h;a++){var l=t[a]*s,u=a<h-1?t[a+1]*s:e.length;n-=Math.abs(WB(e,l,u,s))}var c=0;for(a=0;a<i.length;a+=3){var p=i[a]*s,d=i[a+1]*s,m=i[a+2]*s;c+=Math.abs((e[p]-e[m])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[m+1]-e[p+1]))}return 0===n&&0===c?0:Math.abs((c-n)/n)},bB.flatten=function(e){for(var t=e[0][0].length,s={vertices:[],holes:[],dimensions:t},i=0,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)for(var n=0;n<t;n++)s.vertices.push(e[r][o][n]);r>0&&(i+=e[r-1].length,s.holes.push(i))}return s};const XB=p.vec2(),YB=p.vec3(),KB=p.vec3(),JB=p.vec3();class ZB extends n{constructor(e,t={}){super("cityJSONLoader",e,t),this.dataSource=t.dataSource}get dataSource(){return this._dataSource}set dataSource(e){this._dataSource=e||new vB}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new Hc(this.viewer.scene,y.apply(e,{isModel:!0}));if(!e.src&&!e.cityJSON)return this.error("load() param expected: src or cityJSON"),t;const s={};if(e.src)this._loadModel(e.src,e,s,t);else{const i=this.viewer.scene.canvas.spinner;i.processes++,this._parseModel(e.cityJSON,e,s,t),i.processes--}return t}_loadModel(e,t,s,i){const r=this.viewer.scene.canvas.spinner;r.processes++,this._dataSource.getCityJSON(t.src,(e=>{this._parseModel(e,t,s,i),r.processes--}),(e=>{r.processes--,this.error(e),i.fire("error",e)}))}_parseModel(e,t,s,i){if(i.destroyed)return;const r=e.transform?this._transformVertices(e.vertices,e.transform,s.rotateX):e.vertices,o=t.stats||{};o.sourceFormat=e.type||"CityJSON",o.schemaVersion=e.version||"",o.title="",o.author="",o.created="",o.numMetaObjects=0,o.numPropertySets=0,o.numObjects=0,o.numGeometries=0,o.numTriangles=0,o.numVertices=0;const n=!1!==t.loadMetadata,a=n?{id:p.createUUID(),name:"Model",type:"Model"}:null,h=n?{id:"",projectId:"",author:"",createdAt:"",schema:e.version||"",creatingApplication:"",metaObjects:[a],propertySets:[]}:null,l={data:e,vertices:r,sceneModel:i,loadMetadata:n,metadata:h,rootMetaObject:a,nextId:0,stats:o};if(this._parseCityJSON(l),i.finalize(),n){const e=i.id;this.viewer.metaScene.createMetaModel(e,l.metadata,s)}i.scene.once("tick",(()=>{i.destroyed||(i.scene.fire("modelLoaded",i.id),i.fire("loaded",!0,!1))}))}_transformVertices(e,t,s){const i=[],r=t.scale||p.vec3([1,1,1]),o=t.translate||p.vec3([0,0,0]);for(let t=0,n=0;t<e.length;t++,n+=3){const n=e[t][0]*r[0]+o[0],a=e[t][1]*r[1]+o[1],h=e[t][2]*r[2]+o[2];s?i.push([n,h,a]):i.push([n,a,h])}return i}_parseCityJSON(e){const t=e.data.CityObjects;for(const s in t)if(t.hasOwnProperty(s)){const i=t[s];this._parseCityObject(e,i,s)}}_parseCityObject(e,t,s){const i=e.sceneModel,r=e.data;if(e.loadMetadata){const i=s,r=t.type,o=r+" : "+s,n=t.parents?t.parents[0]:e.rootMetaObject.id;e.metadata.metaObjects.push({id:i,name:o,type:r,parent:n})}if(e.stats.numMetaObjects++,!(t.geometry&&t.geometry.length>0))return;const o=[];for(let s=0,i=t.geometry.length;s<i;s++){const i=t.geometry[s];let n,a;const h=r.appearance;if(h){const e=h.materials;if(e){const t=i.material;if(t){const i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r.value)n=e[r.value];else{const t=r.values;if(t){a=[];for(let i=0,r=t.length;i<r;i++){const i=e[t[s]];a.push(i)}}}}}}}a?this._parseGeometrySurfacesWithOwnMaterials(e,i,a,o):this._parseGeometrySurfacesWithSharedMaterial(e,i,n,o)}o.length>0&&(i.createEntity({id:s,meshIds:o,isObject:!0}),e.stats.numObjects++)}_parseGeometrySurfacesWithOwnMaterials(e,t,s,i){switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":const r=t.boundaries;this._parseSurfacesWithOwnMaterials(e,s,r,i);break;case"Solid":const o=t.boundaries;for(let t=0;t<o.length;t++){const r=o[t];this._parseSurfacesWithOwnMaterials(e,s,r,i)}break;case"MultiSolid":case"CompositeSolid":const n=t.boundaries;for(let t=0;t<n.length;t++)for(let r=0;r<n[t].length;r++){const o=n[t][r];this._parseSurfacesWithOwnMaterials(e,s,o,i)}}}_parseSurfacesWithOwnMaterials(e,t,s,i){const r=e.vertices,o=e.sceneModel;for(let n=0;n<s.length;n++){const a=s[n],h=t[n]||{diffuseColor:[.8,.8,.8],transparency:1},l=[],u=[],c=[],d={positions:[],indices:[]};for(let t=0;t<a.length;t++){l.length>0&&u.push(l.length);const s=this._extractLocalIndices(e,a[t],c,d);l.push(...s)}if(3===l.length)d.indices.push(l[0]),d.indices.push(l[1]),d.indices.push(l[2]);else if(l.length>3){const e=[];for(let t=0;t<l.length;t++)e.push({x:r[c[l[t]]][0],y:r[c[l[t]]][1],z:r[c[l[t]]][2]});const t=this._getNormalOfPositions(e,p.vec3());let s=[];for(let i=0;i<e.length;i++)this._to2D(e[i],t,XB),s.unshift(XB[0]),s.unshift(XB[1]);const i=bB(s,u,2);for(let e=0;e<i.length;e+=3)d.indices.unshift(l[i[e]]),d.indices.unshift(l[i[e+1]]),d.indices.unshift(l[i[e+2]])}const m=""+e.nextId++;o.createMesh({id:m,primitive:"triangles",positions:d.positions,indices:d.indices,color:h&&h.diffuseColor?h.diffuseColor:[.8,.8,.8],opacity:h&&void 0!==h.transparency?1-h.transparency:1}),i.push(m),e.stats.numGeometries++,e.stats.numVertices+=d.positions.length/3,e.stats.numTriangles+=d.indices.length/3}}_parseGeometrySurfacesWithSharedMaterial(e,t,s,i){const r=e.sceneModel,o=[],n={positions:[],indices:[]};switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":const s=t.boundaries;this._parseSurfacesWithSharedMaterial(e,s,o,n);break;case"Solid":const i=t.boundaries;for(let t=0;t<i.length;t++){const s=i[t];this._parseSurfacesWithSharedMaterial(e,s,o,n)}break;case"MultiSolid":case"CompositeSolid":const r=t.boundaries;for(let t=0;t<r.length;t++)for(let s=0;s<r[t].length;s++){const i=r[t][s];this._parseSurfacesWithSharedMaterial(e,i,o,n)}}if(n.positions.length>0&&n.indices.length>0){const t=""+e.nextId++;r.createMesh({id:t,primitive:"triangles",positions:n.positions,indices:n.indices,color:s&&s.diffuseColor?s.diffuseColor:[.8,.8,.8],opacity:1}),i.push(t),e.stats.numGeometries++,e.stats.numVertices+=n.positions.length/3,e.stats.numTriangles+=n.indices.length/3}}_parseSurfacesWithSharedMaterial(e,t,s,i){const r=e.vertices;for(let o=0;o<t.length;o++){let n=[],a=[];for(let r=0;r<t[o].length;r++){n.length>0&&a.push(n.length);const h=this._extractLocalIndices(e,t[o][r],s,i);n.push(...h)}if(3===n.length)i.indices.push(n[0]),i.indices.push(n[1]),i.indices.push(n[2]);else if(n.length>3){let e=[];for(let t=0;t<n.length;t++)e.push({x:r[s[n[t]]][0],y:r[s[n[t]]][1],z:r[s[n[t]]][2]});const t=this._getNormalOfPositions(e,p.vec3());let o=[];for(let s=0;s<e.length;s++)this._to2D(e[s],t,XB),o.unshift(XB[0]),o.unshift(XB[1]);const h=bB(o,a,2);for(let e=0;e<h.length;e+=3)i.indices.unshift(n[h[e]]),i.indices.unshift(n[h[e+1]]),i.indices.unshift(n[h[e+2]])}}}_extractLocalIndices(e,t,s,i){const r=e.vertices,o=[];for(let e=0,n=t.length;e<n;e++){const n=t[e];if(s.includes(n)){const e=s.indexOf(n);o.push(e)}else i.positions.push(r[n][0]),i.positions.push(r[n][1]),i.positions.push(r[n][2]),o.push(s.length),s.push(n)}return o}_getNormalOfPositions(e,t){for(let s=0;s<e.length;s++){let i=s+1;i===e.length&&(i=0),t[0]+=(e[s].y-e[i].y)*(e[s].z+e[i].z),t[1]+=(e[s].z-e[i].z)*(e[s].x+e[i].x),t[2]+=(e[s].x-e[i].x)*(e[s].y+e[i].y)}return p.normalizeVec3(t)}_to2D(e,t,s){const i=YB,r=KB,o=JB;i[0]=e.x,i[1]=e.y,i[2]=e.z,r[0]=t.x,r[1]=t.y,r[2]=t.z,o[0]=1.1,o[1]=1.1,o[2]=1.1;p.lenVec3(p.subVec3(o,r))<.01&&(o[0]+=1,o[1]+=2,o[2]+=3);const n=p.dotVec3(o,r),a=p.mulVec3Scalar(r,n,p.vec3());o[0]-=a[0],o[1]-=a[1],o[2]-=a[2],p.normalizeVec3(o);const h=p.cross3Vec3(r,o,p.vec3()),l=p.dotVec3(i,o),u=p.dotVec3(i,h);s[0]=l,s[1]=u}}export{mr as AlphaFormat,xi as AmbientLight,re as AngleMeasurementsPlugin,le as AnnotationsPlugin,en as AxisGizmoPlugin,Xn as BCFViewpointsPlugin,Gn as Bitmap,rr as ByteType,Oa as CameraMemento,na as CameraPath,da as CameraPathAnimation,ZB as CityJSONLoaderPlugin,Wi as ClampToEdgeWrapping,A as Component,io as CompressedMediaType,Bp as Configs,o as ContextMenu,ja as CubicBezierCurve,ia as Curve,fi as DataTextureSceneModel,Ic as DefaultLoadingManager,vr as DepthFormat,br as DepthStencilFormat,bi as DirLight,kp as DistanceMeasurementsPlugin,Oi as EdgeMaterial,Ri as EmphasisMaterial,jp as FastNavPlugin,lr as FloatType,An as Fresnel,Fa as Frustum,Ea as FrustumPlane,eo as GIFMediaType,Gp as GLTFDefaultDataSource,J_ as GLTFLoaderPlugin,ur as HalfFloatType,ya as ImagePlane,ar as IntType,to as JPEGMediaType,Rc as KTX2TextureTranscoder,yB as LASLoaderPlugin,dn as LambertMaterial,Ma as LightMap,Hn as LineSet,qr as LinearEncoding,qi as LinearFilter,sr as LinearMipMapLinearFilter,er as LinearMipMapNearestFilter,tr as LinearMipmapLinearFilter,$i as LinearMipmapNearestFilter,Cc as Loader,Mc as LoadingManager,ea as LocaleService,yr as LuminanceAlphaFormat,_r as LuminanceFormat,e as Map,J as Marker,Ko as Mesh,gn as MetallicMaterial,Xi as MirroredRepeatWrapping,La as ModelMemento,$_ as NavCubePlugin,Yi as NearestFilter,Qi as NearestMipMapLinearFilter,Ki as NearestMipMapNearestFilter,Zi as NearestMipmapLinearFilter,Ji as NearestMipmapNearestFilter,pn as Node,hy as OBJLoaderPlugin,ka as ObjectsMemento,so as PNGMediaType,Ga as Path,Vc as PerformanceModel,Ei as PhongMaterial,n as Plugin,va as PointLight,Ha as QuadraticBezierCurve,d as Queue,gr as RGBAFormat,Mr as RGBAIntegerFormat,Kr as RGBA_ASTC_10x10_Format,Wr as RGBA_ASTC_10x5_Format,Xr as RGBA_ASTC_10x6_Format,Yr as RGBA_ASTC_10x8_Format,Jr as RGBA_ASTC_12x10_Format,Zr as RGBA_ASTC_12x12_Format,Nr as RGBA_ASTC_4x4_Format,kr as RGBA_ASTC_5x4_Format,jr as RGBA_ASTC_5x5_Format,Gr as RGBA_ASTC_6x5_Format,Hr as RGBA_ASTC_6x6_Format,Vr as RGBA_ASTC_8x5_Format,Ur as RGBA_ASTC_8x6_Format,zr as RGBA_ASTC_8x8_Format,Qr as RGBA_BPTC_Format,Lr as RGBA_ETC2_EAC_Format,Sr as RGBA_PVRTC_2BPPV1_Format,Rr as RGBA_PVRTC_4BPPV1_Format,Cr as RGBA_S3TC_DXT1_Format,Dr as RGBA_S3TC_DXT3_Format,Ar as RGBA_S3TC_DXT5_Format,fr as RGBFormat,Or as RGB_ETC1_Format,Br as RGB_ETC2_Format,Fr as RGB_PVRTC_2BPPV1_Format,Er as RGB_PVRTC_4BPPV1_Format,Ir as RGB_S3TC_DXT1_Format,Tr as RGFormat,wr as RGIntegerFormat,Mi as ReadableGeometry,xr as RedFormat,Pr as RedIntegerFormat,wa as ReflectionMap,zi as RepeatWrapping,yy as STLDefaultDataSource,Cy as STLLoaderPlugin,Va as SceneModel,tn as SectionPlane,gy as SectionPlanesPlugin,or as ShortType,Uc as Skybox,_y as SkyboxesPlugin,vn as SpecularMaterial,ra as SplineCurve,Ia as SpriteMarker,Sy as StoreyViewsPlugin,Dn as Texture,zc as TextureTranscoder,By as TreeViewPlugin,ir as UnsignedByteType,dr as UnsignedInt248Type,hr as UnsignedIntType,cr as UnsignedShort4444Type,pr as UnsignedShort5551Type,nr as UnsignedShortType,Rn as VBOGeometry,Hc as VBOSceneModel,jy as ViewCullPlugin,Op as Viewer,fB as WebIFCLoaderPlugin,Ec as WorkerPool,Gy as XKTDefaultDataSource,Cv as XKTLoaderPlugin,Vv as XML3DLoaderPlugin,Ii as buildBoxGeometry,Ln as buildBoxLinesGeometry,Zo as buildCylinderGeometry,Nn as buildGridGeometry,kn as buildPlaneGeometry,Qo as buildSphereGeometry,jn as buildTorusGeometry,$o as buildVectorTextGeometry,Sa as frustumIntersectsAABB3,Oc as getKTX2TextureTranscoder,On as load3DSGeometry,Bn as loadOBJGeometry,p as math,$r as sRGBEncoding,Ra as setFrustum,m as stats,y as utils};
